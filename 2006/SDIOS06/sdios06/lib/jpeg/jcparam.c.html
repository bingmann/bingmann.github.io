<?xml version="1.0" encoding="iso-8859-1"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta content="text/html; charset=iso-8859-1" http-equiv="content-type" /><title>/2006/SDIOS06/sdios06/lib/jpeg/jcparam.c - panthema.net</title><link rel="stylesheet" type="text/css" href="/css/base.css" /><link rel="alternate" type="application/rss+xml" title="panthema.net Weblog Feed RSS 2.0" href="http://panthema.net/xmlfeed/weblog-rss20.xml" /><link rel="alternate" type="application/atom+xml" title="panthema.net Weblog Feed Atom 1.0" href="http://panthema.net/xmlfeed/weblog-atom10.xml" /><script type="text/javascript" src="/js/base.js"></script><script type="text/javascript">/* <!-- */makeIEHover = function() {var lis = document.getElementById('ptnav').getElementsByTagName('li');for (var i = 0; i < lis.length; i++) {lis[i].onmouseover = function() {this.className += ' sfhover';};lis[i].onmouseout = function() {this.className = this.className.replace(new RegExp(' sfhover\b'), '');};}};if (window.attachEvent) window.attachEvent('onload', makeIEHover);/* --> */</script></head><body style="background-image: url(/img/bgfractal2.jpg)"><div class="pttopbar"><div style="float: right"><ul id="ptnav"><li class="top"><a class="ni" href="/">Weblog</a><ul style="margin-left: -6px; margin-top: 4px" class="nx"><li><a href="/2013/">2013</a></li><li><a href="/2012/">2012</a></li><li><a href="/2011/">2011</a></li><li><a href="/2010/">2010</a></li><li><a href="/2009/">2009</a></li><li><a href="/2008/">2008</a></li><li><a href="/2007/">2007</a></li><li><a href="/2006/">2006</a></li><li class="nt"><a href="/2005/">2005</a></li><li class="ns"><a href="/xmlfeed/weblog-rss20.xml">RSS Feed</a></li><li class="nt"><a href="/xmlfeed/weblog-atom10.xml">XML Atom</a></li><li class="ns"><a href="/search.html">Search</a></li></ul></li><li class="top"><a class="ni" href="/tags/">Tags</a><div style="width: 14em; margin-left: -9em; margin-top: 4px"><a style="font-size: 10pt" href="/tags/algebra.html">algebra</a> <a style="font-size: 16pt" href="/tags/c++.html">c++</a> <a style="font-size: 12pt" href="/tags/code-example.html">code-example</a> <a style="font-size: 14pt" href="/tags/code-snippet.html">code-snippet</a> <a style="font-size: 11pt" href="/tags/coding_tricks.html">coding tricks</a> <a style="font-size: 10pt" href="/tags/compsci.html">compsci</a> <a style="font-size: 10pt" href="/tags/compsci_study_thesis.html">compsci study thesis</a> <a style="font-size: 9pt" href="/tags/crypto-speedtest.html">crypto-speedtest</a> <a style="font-size: 10pt" href="/tags/cryptography.html">cryptography</a> <a style="font-size: 9pt" href="/tags/cryptote.html">cryptote</a> <a style="font-size: 12pt" href="/tags/flex-bison-cpp-example.html">flex-bison-cpp-example</a> <a style="font-size: 12pt" href="/tags/frontpage.html">frontpage</a> <a style="font-size: 13pt" href="/tags/fun.html">fun</a> <a style="font-size: 10pt" href="/tags/graphviz.html">graphviz</a> <a style="font-size: 9pt" href="http://www.hmtg.de">hartmetall</a> <a style="font-size: 9pt" href="/tags/helppc.html">helppc</a> <a style="font-size: 9pt" href="/tags/hifi_selbstbau.html">hifi selbstbau</a> <a style="font-size: 10pt" href="/tags/latex.html">latex</a> <a style="font-size: 10pt" href="/tags/librivox.html">librivox</a> <a style="font-size: 10pt" href="/tags/linux.html">linux</a> <a style="font-size: 10pt" href="/tags/maths.html">maths</a> <a style="font-size: 9pt" href="/tags/music.html">music</a> <a style="font-size: 10pt" href="/tags/netfundamentals.html">netfundamentals</a> <a style="font-size: 11pt" href="/tags/ns-3.html">ns-3</a> <a style="font-size: 9pt" href="/tags/parallel-string-sorting.html">parallel-string-sorting</a> <a style="font-size: 9pt" href="/tags/qtsqlview.html">qtsqlview</a> <a style="font-size: 10pt" href="/tags/research.html">research</a> <a style="font-size: 11pt" href="/tags/sdios06.html">sdios06</a> <a style="font-size: 9pt" href="/tags/sdlfractal.html">sdlfractal</a> <a style="font-size: 11pt" href="/tags/sorting.html">sorting</a> <a style="font-size: 10pt" href="/tags/stringology.html">stringology</a> <a style="font-size: 16pt" href="/tags/stx-btree.html">stx-btree</a> <a style="font-size: 9pt" href="/tags/stx-exparser.html">stx-exparser</a> <a style="font-size: 10pt" href="/tags/stxxl.html">stxxl</a> <a style="font-size: 15pt" href="/tags/talk.html">talk</a> <a style="font-size: 10pt" href="/tags/tutorium.html">tutorium</a> <a style="font-size: 16pt" href="/tags/university.html">university</a> <a style="font-size: 13pt" href="/tags/utilities.html">utilities</a> <a style="font-size: 9pt" href="/tags/webdesign.html">webdesign</a> </div></li><li class="top"> <a class="ni" href="#">Projects</a> <ul style="margin-left: -8em; margin-top: 4px;" class="nx"> <li><a href="/2009/cryptote/">CryptoTE</a></li> <li><a href="/2009/digup/">digup</a></li> <li><a href="/2013/disk-filltest/">disk-filltest</a></li> <li><a href="/2012/1119-eSAIS-Inducing-Suffix-and-LCP-Arrays-in-External-Memory/">eSAIS-LCP</a></li> <li><a href="/2007/flex-bison-cpp-example/">Flex Bison C++ Example</a></li> <li><a href="/2013/malloc_count/">malloc_count</a></li> <li><a href="/2013/parallel-string-sorting/">parallel-string-sorting</a></li> <li><a href="/2013/pmbw/">Parallel Memory Bandwidth</a></li> <li><a href="/2013/sound-of-sorting/">The Sound of Sorting</a></li> <li><a href="/2007/stx-btree/">STX B+ Tree</a></li> <li><a href="/2010/stx-cbtreedb/">STX Constant BTreeDB</a></li> <li><a href="/2010/stx-execpipe/">STX ExecPipe</a></li> <li><a href="/2007/stx-exparser/">STX Expression Parser</a></li> <li class="nt"><a href="/2013/1212-stxxl-1.4.0/">STXXL 1.4</a></li> <li class="ns"><a href="/search.html">Search</a></li> </ul></li><li class="top"> <a class="ni" href="#">Research</a> <ul style="margin-left: -16em; margin-top: 4px" class="nx"> <li><a href="/2012/1119-eSAIS-Inducing-Suffix-and-LCP-Arrays-in-External-Memory/">eSAIS-LCP - External Memory Suffix Sorting</a></li> <li><a href="/2013/parallel-string-sorting/">pS5 - Parallel String Sorting</a></li> <li><a href="/tags/stxxl.html">STXXL - External Memory Algorithms</a></li> <li class="ns"><a href="/search.html">Search</a></li> </ul></li><li class="top"> <a class="ni" href="/about/">About</a> <ul style="margin-left: -6em; margin-top: 4px" class="nx"> <li><a href="/about/">Timo Bingmann</a></li> <li><a href="/about/impressum.html">Impressum</a></li> </ul></li></ul></div><div style="padding: 6px"><a href="/">panthema</a>  / <a href="/2006/">2006</a> / <a href="/2006/SDIOS06/">SDIOS06</a> / <a href="/2006/SDIOS06/sdios06/">sdios06</a> / <a href="/2006/SDIOS06/sdios06/lib/">lib</a> / <a href="/2006/SDIOS06/sdios06/lib/jpeg/">jpeg</a> / <a href="/2006/SDIOS06/sdios06/lib/jpeg/jcparam.c.html">jcparam.c</a> (<a href="/2006/SDIOS06/sdios06/lib/jpeg/jcparam.c">Download File</a>)</div></div><div class="ptfullwidth"><pre class="codesnippet" style="font-family: monospace"><tt><span class="comment">/*</span>
<span class="comment"> * jcparam.c</span>
<span class="comment"> *</span>
<span class="comment"> * Copyright (C) 1991-1998, Thomas G. Lane.</span>
<span class="comment"> * This file is part of the Independent JPEG Group's software.</span>
<span class="comment"> * For conditions of distribution and use, see the accompanying README file.</span>
<span class="comment"> *</span>
<span class="comment"> * This file contains optional default-setting code for the JPEG compressor.</span>
<span class="comment"> * Applications do not have to use this file, but those that don't use it</span>
<span class="comment"> * must know a lot more about the innards of the JPEG code.</span>
<span class="comment"> */</span>

<span class="preproc">#define</span><span class="normal"> JPEG_INTERNALS</span>
<span class="preproc">#include</span><span class="normal"> </span><span class="string">"jinclude.h"</span>
<span class="preproc">#include</span><span class="normal"> </span><span class="string">"jpeglib.h"</span>


<span class="comment">/*</span>
<span class="comment"> * Quantization table setup routines</span>
<span class="comment"> */</span>

<span class="function">GLOBAL</span><span class="symbol">(</span><span class="type">void</span><span class="symbol">)</span>
<span class="function">jpeg_add_quant_table</span><span class="normal"> </span><span class="symbol">(</span><span class="usertype">j_compress_ptr</span><span class="normal"> cinfo</span><span class="symbol">,</span><span class="normal"> </span><span class="type">int</span><span class="normal"> which_tbl</span><span class="symbol">,</span>
<span class="normal">		      </span><span class="keyword">const</span><span class="normal"> </span><span class="type">unsigned</span><span class="normal"> </span><span class="type">int</span><span class="normal"> </span><span class="symbol">*</span><span class="normal">basic_table</span><span class="symbol">,</span>
<span class="normal">		      </span><span class="type">int</span><span class="normal"> scale_factor</span><span class="symbol">,</span><span class="normal"> </span><span class="usertype">boolean</span><span class="normal"> force_baseline</span><span class="symbol">)</span>
<span class="comment">/* Define a quantization table equal to the basic_table times</span>
<span class="comment"> * a scale factor (given as a percentage).</span>
<span class="comment"> * If force_baseline is TRUE, the computed quantization table entries</span>
<span class="comment"> * are limited to 1..255 for JPEG baseline compatibility.</span>
<span class="comment"> */</span>
<span class="cbracket">{</span>
<span class="normal">  JQUANT_TBL </span><span class="symbol">**</span><span class="normal"> qtblptr</span><span class="symbol">;</span>
<span class="normal">  </span><span class="type">int</span><span class="normal"> i</span><span class="symbol">;</span>
<span class="normal">  </span><span class="type">long</span><span class="normal"> temp</span><span class="symbol">;</span>

<span class="normal">  </span><span class="comment">/* Safety check to ensure start_compress not called yet. */</span>
<span class="normal">  </span><span class="keyword">if</span><span class="normal"> </span><span class="symbol">(</span><span class="normal">cinfo</span><span class="symbol">-&gt;</span><span class="normal">global_state </span><span class="symbol">!=</span><span class="normal"> CSTATE_START</span><span class="symbol">)</span>
<span class="normal">    </span><span class="function">ERREXIT1</span><span class="symbol">(</span><span class="normal">cinfo</span><span class="symbol">,</span><span class="normal"> JERR_BAD_STATE</span><span class="symbol">,</span><span class="normal"> cinfo</span><span class="symbol">-&gt;</span><span class="normal">global_state</span><span class="symbol">);</span>

<span class="normal">  </span><span class="keyword">if</span><span class="normal"> </span><span class="symbol">(</span><span class="normal">which_tbl </span><span class="symbol">&lt;</span><span class="normal"> </span><span class="number">0</span><span class="normal"> </span><span class="symbol">||</span><span class="normal"> which_tbl </span><span class="symbol">&gt;=</span><span class="normal"> NUM_QUANT_TBLS</span><span class="symbol">)</span>
<span class="normal">    </span><span class="function">ERREXIT1</span><span class="symbol">(</span><span class="normal">cinfo</span><span class="symbol">,</span><span class="normal"> JERR_DQT_INDEX</span><span class="symbol">,</span><span class="normal"> which_tbl</span><span class="symbol">);</span>

<span class="normal">  qtblptr </span><span class="symbol">=</span><span class="normal"> </span><span class="symbol">&amp;</span><span class="normal"> cinfo</span><span class="symbol">-&gt;</span><span class="normal">quant_tbl_ptrs</span><span class="symbol">[</span><span class="normal">which_tbl</span><span class="symbol">];</span>

<span class="normal">  </span><span class="keyword">if</span><span class="normal"> </span><span class="symbol">(*</span><span class="normal">qtblptr </span><span class="symbol">==</span><span class="normal"> NULL</span><span class="symbol">)</span>
<span class="normal">    </span><span class="symbol">*</span><span class="normal">qtblptr </span><span class="symbol">=</span><span class="normal"> </span><span class="function">jpeg_alloc_quant_table</span><span class="symbol">((</span><span class="normal">j_common_ptr</span><span class="symbol">)</span><span class="normal"> cinfo</span><span class="symbol">);</span>

<span class="normal">  </span><span class="keyword">for</span><span class="normal"> </span><span class="symbol">(</span><span class="normal">i </span><span class="symbol">=</span><span class="normal"> </span><span class="number">0</span><span class="symbol">;</span><span class="normal"> i </span><span class="symbol">&lt;</span><span class="normal"> DCTSIZE2</span><span class="symbol">;</span><span class="normal"> i</span><span class="symbol">++)</span><span class="normal"> </span><span class="cbracket">{</span>
<span class="normal">    temp </span><span class="symbol">=</span><span class="normal"> </span><span class="symbol">((</span><span class="type">long</span><span class="symbol">)</span><span class="normal"> basic_table</span><span class="symbol">[</span><span class="normal">i</span><span class="symbol">]</span><span class="normal"> </span><span class="symbol">*</span><span class="normal"> scale_factor </span><span class="symbol">+</span><span class="normal"> </span><span class="number">50L</span><span class="symbol">)</span><span class="normal"> </span><span class="symbol">/</span><span class="normal"> </span><span class="number">100L</span><span class="symbol">;</span>
<span class="normal">    </span><span class="comment">/* limit the values to the valid range */</span>
<span class="normal">    </span><span class="keyword">if</span><span class="normal"> </span><span class="symbol">(</span><span class="normal">temp </span><span class="symbol">&lt;=</span><span class="normal"> </span><span class="number">0L</span><span class="symbol">)</span><span class="normal"> temp </span><span class="symbol">=</span><span class="normal"> </span><span class="number">1L</span><span class="symbol">;</span>
<span class="normal">    </span><span class="keyword">if</span><span class="normal"> </span><span class="symbol">(</span><span class="normal">temp </span><span class="symbol">&gt;</span><span class="normal"> </span><span class="number">32767L</span><span class="symbol">)</span><span class="normal"> temp </span><span class="symbol">=</span><span class="normal"> </span><span class="number">32767L</span><span class="symbol">;</span><span class="normal"> </span><span class="comment">/* max quantizer needed for 12 bits */</span>
<span class="normal">    </span><span class="keyword">if</span><span class="normal"> </span><span class="symbol">(</span><span class="normal">force_baseline </span><span class="symbol">&amp;&amp;</span><span class="normal"> temp </span><span class="symbol">&gt;</span><span class="normal"> </span><span class="number">255L</span><span class="symbol">)</span>
<span class="normal">      temp </span><span class="symbol">=</span><span class="normal"> </span><span class="number">255L</span><span class="symbol">;</span><span class="normal">		</span><span class="comment">/* limit to baseline range if requested */</span>
<span class="normal">    </span><span class="symbol">(*</span><span class="normal">qtblptr</span><span class="symbol">)-&gt;</span><span class="normal">quantval</span><span class="symbol">[</span><span class="normal">i</span><span class="symbol">]</span><span class="normal"> </span><span class="symbol">=</span><span class="normal"> </span><span class="symbol">(</span><span class="normal">UINT16</span><span class="symbol">)</span><span class="normal"> temp</span><span class="symbol">;</span>
<span class="normal">  </span><span class="cbracket">}</span>

<span class="normal">  </span><span class="comment">/* Initialize sent_table FALSE so table will be written to JPEG file. */</span>
<span class="normal">  </span><span class="symbol">(*</span><span class="normal">qtblptr</span><span class="symbol">)-&gt;</span><span class="normal">sent_table </span><span class="symbol">=</span><span class="normal"> FALSE</span><span class="symbol">;</span>
<span class="cbracket">}</span>


<span class="function">GLOBAL</span><span class="symbol">(</span><span class="type">void</span><span class="symbol">)</span>
<span class="function">jpeg_set_linear_quality</span><span class="normal"> </span><span class="symbol">(</span><span class="usertype">j_compress_ptr</span><span class="normal"> cinfo</span><span class="symbol">,</span><span class="normal"> </span><span class="type">int</span><span class="normal"> scale_factor</span><span class="symbol">,</span>
<span class="normal">			 </span><span class="usertype">boolean</span><span class="normal"> force_baseline</span><span class="symbol">)</span>
<span class="comment">/* Set or change the 'quality' (quantization) setting, using default tables</span>
<span class="comment"> * and a straight percentage-scaling quality scale.  In most cases it's better</span>
<span class="comment"> * to use jpeg_set_quality (below); this entry point is provided for</span>
<span class="comment"> * applications that insist on a linear percentage scaling.</span>
<span class="comment"> */</span>
<span class="cbracket">{</span>
<span class="normal">  </span><span class="comment">/* These are the sample quantization tables given in JPEG spec section K.1.</span>
<span class="comment">   * The spec says that the values given produce "good" quality, and</span>
<span class="comment">   * when divided by 2, "very good" quality.</span>
<span class="comment">   */</span>
<span class="normal">  </span><span class="keyword">static</span><span class="normal"> </span><span class="keyword">const</span><span class="normal"> </span><span class="type">unsigned</span><span class="normal"> </span><span class="type">int</span><span class="normal"> std_luminance_quant_tbl</span><span class="symbol">[</span><span class="normal">DCTSIZE2</span><span class="symbol">]</span><span class="normal"> </span><span class="symbol">=</span><span class="normal"> </span><span class="cbracket">{</span>
<span class="normal">    </span><span class="number">16</span><span class="symbol">,</span><span class="normal">  </span><span class="number">11</span><span class="symbol">,</span><span class="normal">  </span><span class="number">10</span><span class="symbol">,</span><span class="normal">  </span><span class="number">16</span><span class="symbol">,</span><span class="normal">  </span><span class="number">24</span><span class="symbol">,</span><span class="normal">  </span><span class="number">40</span><span class="symbol">,</span><span class="normal">  </span><span class="number">51</span><span class="symbol">,</span><span class="normal">  </span><span class="number">61</span><span class="symbol">,</span>
<span class="normal">    </span><span class="number">12</span><span class="symbol">,</span><span class="normal">  </span><span class="number">12</span><span class="symbol">,</span><span class="normal">  </span><span class="number">14</span><span class="symbol">,</span><span class="normal">  </span><span class="number">19</span><span class="symbol">,</span><span class="normal">  </span><span class="number">26</span><span class="symbol">,</span><span class="normal">  </span><span class="number">58</span><span class="symbol">,</span><span class="normal">  </span><span class="number">60</span><span class="symbol">,</span><span class="normal">  </span><span class="number">55</span><span class="symbol">,</span>
<span class="normal">    </span><span class="number">14</span><span class="symbol">,</span><span class="normal">  </span><span class="number">13</span><span class="symbol">,</span><span class="normal">  </span><span class="number">16</span><span class="symbol">,</span><span class="normal">  </span><span class="number">24</span><span class="symbol">,</span><span class="normal">  </span><span class="number">40</span><span class="symbol">,</span><span class="normal">  </span><span class="number">57</span><span class="symbol">,</span><span class="normal">  </span><span class="number">69</span><span class="symbol">,</span><span class="normal">  </span><span class="number">56</span><span class="symbol">,</span>
<span class="normal">    </span><span class="number">14</span><span class="symbol">,</span><span class="normal">  </span><span class="number">17</span><span class="symbol">,</span><span class="normal">  </span><span class="number">22</span><span class="symbol">,</span><span class="normal">  </span><span class="number">29</span><span class="symbol">,</span><span class="normal">  </span><span class="number">51</span><span class="symbol">,</span><span class="normal">  </span><span class="number">87</span><span class="symbol">,</span><span class="normal">  </span><span class="number">80</span><span class="symbol">,</span><span class="normal">  </span><span class="number">62</span><span class="symbol">,</span>
<span class="normal">    </span><span class="number">18</span><span class="symbol">,</span><span class="normal">  </span><span class="number">22</span><span class="symbol">,</span><span class="normal">  </span><span class="number">37</span><span class="symbol">,</span><span class="normal">  </span><span class="number">56</span><span class="symbol">,</span><span class="normal">  </span><span class="number">68</span><span class="symbol">,</span><span class="normal"> </span><span class="number">109</span><span class="symbol">,</span><span class="normal"> </span><span class="number">103</span><span class="symbol">,</span><span class="normal">  </span><span class="number">77</span><span class="symbol">,</span>
<span class="normal">    </span><span class="number">24</span><span class="symbol">,</span><span class="normal">  </span><span class="number">35</span><span class="symbol">,</span><span class="normal">  </span><span class="number">55</span><span class="symbol">,</span><span class="normal">  </span><span class="number">64</span><span class="symbol">,</span><span class="normal">  </span><span class="number">81</span><span class="symbol">,</span><span class="normal"> </span><span class="number">104</span><span class="symbol">,</span><span class="normal"> </span><span class="number">113</span><span class="symbol">,</span><span class="normal">  </span><span class="number">92</span><span class="symbol">,</span>
<span class="normal">    </span><span class="number">49</span><span class="symbol">,</span><span class="normal">  </span><span class="number">64</span><span class="symbol">,</span><span class="normal">  </span><span class="number">78</span><span class="symbol">,</span><span class="normal">  </span><span class="number">87</span><span class="symbol">,</span><span class="normal"> </span><span class="number">103</span><span class="symbol">,</span><span class="normal"> </span><span class="number">121</span><span class="symbol">,</span><span class="normal"> </span><span class="number">120</span><span class="symbol">,</span><span class="normal"> </span><span class="number">101</span><span class="symbol">,</span>
<span class="normal">    </span><span class="number">72</span><span class="symbol">,</span><span class="normal">  </span><span class="number">92</span><span class="symbol">,</span><span class="normal">  </span><span class="number">95</span><span class="symbol">,</span><span class="normal">  </span><span class="number">98</span><span class="symbol">,</span><span class="normal"> </span><span class="number">112</span><span class="symbol">,</span><span class="normal"> </span><span class="number">100</span><span class="symbol">,</span><span class="normal"> </span><span class="number">103</span><span class="symbol">,</span><span class="normal">  </span><span class="number">99</span>
<span class="normal">  </span><span class="cbracket">}</span><span class="symbol">;</span>
<span class="normal">  </span><span class="keyword">static</span><span class="normal"> </span><span class="keyword">const</span><span class="normal"> </span><span class="type">unsigned</span><span class="normal"> </span><span class="type">int</span><span class="normal"> std_chrominance_quant_tbl</span><span class="symbol">[</span><span class="normal">DCTSIZE2</span><span class="symbol">]</span><span class="normal"> </span><span class="symbol">=</span><span class="normal"> </span><span class="cbracket">{</span>
<span class="normal">    </span><span class="number">17</span><span class="symbol">,</span><span class="normal">  </span><span class="number">18</span><span class="symbol">,</span><span class="normal">  </span><span class="number">24</span><span class="symbol">,</span><span class="normal">  </span><span class="number">47</span><span class="symbol">,</span><span class="normal">  </span><span class="number">99</span><span class="symbol">,</span><span class="normal">  </span><span class="number">99</span><span class="symbol">,</span><span class="normal">  </span><span class="number">99</span><span class="symbol">,</span><span class="normal">  </span><span class="number">99</span><span class="symbol">,</span>
<span class="normal">    </span><span class="number">18</span><span class="symbol">,</span><span class="normal">  </span><span class="number">21</span><span class="symbol">,</span><span class="normal">  </span><span class="number">26</span><span class="symbol">,</span><span class="normal">  </span><span class="number">66</span><span class="symbol">,</span><span class="normal">  </span><span class="number">99</span><span class="symbol">,</span><span class="normal">  </span><span class="number">99</span><span class="symbol">,</span><span class="normal">  </span><span class="number">99</span><span class="symbol">,</span><span class="normal">  </span><span class="number">99</span><span class="symbol">,</span>
<span class="normal">    </span><span class="number">24</span><span class="symbol">,</span><span class="normal">  </span><span class="number">26</span><span class="symbol">,</span><span class="normal">  </span><span class="number">56</span><span class="symbol">,</span><span class="normal">  </span><span class="number">99</span><span class="symbol">,</span><span class="normal">  </span><span class="number">99</span><span class="symbol">,</span><span class="normal">  </span><span class="number">99</span><span class="symbol">,</span><span class="normal">  </span><span class="number">99</span><span class="symbol">,</span><span class="normal">  </span><span class="number">99</span><span class="symbol">,</span>
<span class="normal">    </span><span class="number">47</span><span class="symbol">,</span><span class="normal">  </span><span class="number">66</span><span class="symbol">,</span><span class="normal">  </span><span class="number">99</span><span class="symbol">,</span><span class="normal">  </span><span class="number">99</span><span class="symbol">,</span><span class="normal">  </span><span class="number">99</span><span class="symbol">,</span><span class="normal">  </span><span class="number">99</span><span class="symbol">,</span><span class="normal">  </span><span class="number">99</span><span class="symbol">,</span><span class="normal">  </span><span class="number">99</span><span class="symbol">,</span>
<span class="normal">    </span><span class="number">99</span><span class="symbol">,</span><span class="normal">  </span><span class="number">99</span><span class="symbol">,</span><span class="normal">  </span><span class="number">99</span><span class="symbol">,</span><span class="normal">  </span><span class="number">99</span><span class="symbol">,</span><span class="normal">  </span><span class="number">99</span><span class="symbol">,</span><span class="normal">  </span><span class="number">99</span><span class="symbol">,</span><span class="normal">  </span><span class="number">99</span><span class="symbol">,</span><span class="normal">  </span><span class="number">99</span><span class="symbol">,</span>
<span class="normal">    </span><span class="number">99</span><span class="symbol">,</span><span class="normal">  </span><span class="number">99</span><span class="symbol">,</span><span class="normal">  </span><span class="number">99</span><span class="symbol">,</span><span class="normal">  </span><span class="number">99</span><span class="symbol">,</span><span class="normal">  </span><span class="number">99</span><span class="symbol">,</span><span class="normal">  </span><span class="number">99</span><span class="symbol">,</span><span class="normal">  </span><span class="number">99</span><span class="symbol">,</span><span class="normal">  </span><span class="number">99</span><span class="symbol">,</span>
<span class="normal">    </span><span class="number">99</span><span class="symbol">,</span><span class="normal">  </span><span class="number">99</span><span class="symbol">,</span><span class="normal">  </span><span class="number">99</span><span class="symbol">,</span><span class="normal">  </span><span class="number">99</span><span class="symbol">,</span><span class="normal">  </span><span class="number">99</span><span class="symbol">,</span><span class="normal">  </span><span class="number">99</span><span class="symbol">,</span><span class="normal">  </span><span class="number">99</span><span class="symbol">,</span><span class="normal">  </span><span class="number">99</span><span class="symbol">,</span>
<span class="normal">    </span><span class="number">99</span><span class="symbol">,</span><span class="normal">  </span><span class="number">99</span><span class="symbol">,</span><span class="normal">  </span><span class="number">99</span><span class="symbol">,</span><span class="normal">  </span><span class="number">99</span><span class="symbol">,</span><span class="normal">  </span><span class="number">99</span><span class="symbol">,</span><span class="normal">  </span><span class="number">99</span><span class="symbol">,</span><span class="normal">  </span><span class="number">99</span><span class="symbol">,</span><span class="normal">  </span><span class="number">99</span>
<span class="normal">  </span><span class="cbracket">}</span><span class="symbol">;</span>

<span class="normal">  </span><span class="comment">/* Set up two quantization tables using the specified scaling */</span>
<span class="normal">  </span><span class="function">jpeg_add_quant_table</span><span class="symbol">(</span><span class="normal">cinfo</span><span class="symbol">,</span><span class="normal"> </span><span class="number">0</span><span class="symbol">,</span><span class="normal"> std_luminance_quant_tbl</span><span class="symbol">,</span>
<span class="normal">		       scale_factor</span><span class="symbol">,</span><span class="normal"> force_baseline</span><span class="symbol">);</span>
<span class="normal">  </span><span class="function">jpeg_add_quant_table</span><span class="symbol">(</span><span class="normal">cinfo</span><span class="symbol">,</span><span class="normal"> </span><span class="number">1</span><span class="symbol">,</span><span class="normal"> std_chrominance_quant_tbl</span><span class="symbol">,</span>
<span class="normal">		       scale_factor</span><span class="symbol">,</span><span class="normal"> force_baseline</span><span class="symbol">);</span>
<span class="cbracket">}</span>


<span class="function">GLOBAL</span><span class="symbol">(</span><span class="type">int</span><span class="symbol">)</span>
<span class="function">jpeg_quality_scaling</span><span class="normal"> </span><span class="symbol">(</span><span class="type">int</span><span class="normal"> quality</span><span class="symbol">)</span>
<span class="comment">/* Convert a user-specified quality rating to a percentage scaling factor</span>
<span class="comment"> * for an underlying quantization table, using our recommended scaling curve.</span>
<span class="comment"> * The input 'quality' factor should be 0 (terrible) to 100 (very good).</span>
<span class="comment"> */</span>
<span class="cbracket">{</span>
<span class="normal">  </span><span class="comment">/* Safety limit on quality factor.  Convert 0 to 1 to avoid zero divide. */</span>
<span class="normal">  </span><span class="keyword">if</span><span class="normal"> </span><span class="symbol">(</span><span class="normal">quality </span><span class="symbol">&lt;=</span><span class="normal"> </span><span class="number">0</span><span class="symbol">)</span><span class="normal"> quality </span><span class="symbol">=</span><span class="normal"> </span><span class="number">1</span><span class="symbol">;</span>
<span class="normal">  </span><span class="keyword">if</span><span class="normal"> </span><span class="symbol">(</span><span class="normal">quality </span><span class="symbol">&gt;</span><span class="normal"> </span><span class="number">100</span><span class="symbol">)</span><span class="normal"> quality </span><span class="symbol">=</span><span class="normal"> </span><span class="number">100</span><span class="symbol">;</span>

<span class="normal">  </span><span class="comment">/* The basic table is used as-is (scaling 100) for a quality of 50.</span>
<span class="comment">   * Qualities 50..100 are converted to scaling percentage 200 - 2*Q;</span>
<span class="comment">   * note that at Q=100 the scaling is 0, which will cause jpeg_add_quant_table</span>
<span class="comment">   * to make all the table entries 1 (hence, minimum quantization loss).</span>
<span class="comment">   * Qualities 1..50 are converted to scaling percentage 5000/Q.</span>
<span class="comment">   */</span>
<span class="normal">  </span><span class="keyword">if</span><span class="normal"> </span><span class="symbol">(</span><span class="normal">quality </span><span class="symbol">&lt;</span><span class="normal"> </span><span class="number">50</span><span class="symbol">)</span>
<span class="normal">    quality </span><span class="symbol">=</span><span class="normal"> </span><span class="number">5000</span><span class="normal"> </span><span class="symbol">/</span><span class="normal"> quality</span><span class="symbol">;</span>
<span class="normal">  </span><span class="keyword">else</span>
<span class="normal">    quality </span><span class="symbol">=</span><span class="normal"> </span><span class="number">200</span><span class="normal"> </span><span class="symbol">-</span><span class="normal"> quality</span><span class="symbol">*</span><span class="number">2</span><span class="symbol">;</span>

<span class="normal">  </span><span class="keyword">return</span><span class="normal"> quality</span><span class="symbol">;</span>
<span class="cbracket">}</span>


<span class="function">GLOBAL</span><span class="symbol">(</span><span class="type">void</span><span class="symbol">)</span>
<span class="function">jpeg_set_quality</span><span class="normal"> </span><span class="symbol">(</span><span class="usertype">j_compress_ptr</span><span class="normal"> cinfo</span><span class="symbol">,</span><span class="normal"> </span><span class="type">int</span><span class="normal"> quality</span><span class="symbol">,</span><span class="normal"> </span><span class="usertype">boolean</span><span class="normal"> force_baseline</span><span class="symbol">)</span>
<span class="comment">/* Set or change the 'quality' (quantization) setting, using default tables.</span>
<span class="comment"> * This is the standard quality-adjusting entry point for typical user</span>
<span class="comment"> * interfaces; only those who want detailed control over quantization tables</span>
<span class="comment"> * would use the preceding three routines directly.</span>
<span class="comment"> */</span>
<span class="cbracket">{</span>
<span class="normal">  </span><span class="comment">/* Convert user 0-100 rating to percentage scaling */</span>
<span class="normal">  quality </span><span class="symbol">=</span><span class="normal"> </span><span class="function">jpeg_quality_scaling</span><span class="symbol">(</span><span class="normal">quality</span><span class="symbol">);</span>

<span class="normal">  </span><span class="comment">/* Set up standard quality tables */</span>
<span class="normal">  </span><span class="function">jpeg_set_linear_quality</span><span class="symbol">(</span><span class="normal">cinfo</span><span class="symbol">,</span><span class="normal"> quality</span><span class="symbol">,</span><span class="normal"> force_baseline</span><span class="symbol">);</span>
<span class="cbracket">}</span>


<span class="comment">/*</span>
<span class="comment"> * Huffman table setup routines</span>
<span class="comment"> */</span>

<span class="function">LOCAL</span><span class="symbol">(</span><span class="type">void</span><span class="symbol">)</span>
<span class="function">add_huff_table</span><span class="normal"> </span><span class="symbol">(</span><span class="usertype">j_compress_ptr</span><span class="normal"> cinfo</span><span class="symbol">,</span>
<span class="normal">		</span><span class="usertype">JHUFF_TBL</span><span class="normal"> </span><span class="symbol">**</span><span class="normal">htblptr</span><span class="symbol">,</span><span class="normal"> </span><span class="keyword">const</span><span class="normal"> </span><span class="usertype">UINT8</span><span class="normal"> </span><span class="symbol">*</span><span class="normal">bits</span><span class="symbol">,</span><span class="normal"> </span><span class="keyword">const</span><span class="normal"> </span><span class="usertype">UINT8</span><span class="normal"> </span><span class="symbol">*</span><span class="normal">val</span><span class="symbol">)</span>
<span class="comment">/* Define a Huffman table */</span>
<span class="cbracket">{</span>
<span class="normal">  </span><span class="type">int</span><span class="normal"> nsymbols</span><span class="symbol">,</span><span class="normal"> len</span><span class="symbol">;</span>

<span class="normal">  </span><span class="keyword">if</span><span class="normal"> </span><span class="symbol">(*</span><span class="normal">htblptr </span><span class="symbol">==</span><span class="normal"> NULL</span><span class="symbol">)</span>
<span class="normal">    </span><span class="symbol">*</span><span class="normal">htblptr </span><span class="symbol">=</span><span class="normal"> </span><span class="function">jpeg_alloc_huff_table</span><span class="symbol">((</span><span class="normal">j_common_ptr</span><span class="symbol">)</span><span class="normal"> cinfo</span><span class="symbol">);</span>

<span class="normal">  </span><span class="comment">/* Copy the number-of-symbols-of-each-code-length counts */</span>
<span class="normal">  </span><span class="function">MEMCOPY</span><span class="symbol">((*</span><span class="normal">htblptr</span><span class="symbol">)-&gt;</span><span class="normal">bits</span><span class="symbol">,</span><span class="normal"> bits</span><span class="symbol">,</span><span class="normal"> </span><span class="function">SIZEOF</span><span class="symbol">((*</span><span class="normal">htblptr</span><span class="symbol">)-&gt;</span><span class="normal">bits</span><span class="symbol">));</span>

<span class="normal">  </span><span class="comment">/* Validate the counts.  We do this here mainly so we can copy the right</span>
<span class="comment">   * number of symbols from the val[] array, without risking marching off</span>
<span class="comment">   * the end of memory.  jchuff.c will do a more thorough test later.</span>
<span class="comment">   */</span>
<span class="normal">  nsymbols </span><span class="symbol">=</span><span class="normal"> </span><span class="number">0</span><span class="symbol">;</span>
<span class="normal">  </span><span class="keyword">for</span><span class="normal"> </span><span class="symbol">(</span><span class="normal">len </span><span class="symbol">=</span><span class="normal"> </span><span class="number">1</span><span class="symbol">;</span><span class="normal"> len </span><span class="symbol">&lt;=</span><span class="normal"> </span><span class="number">16</span><span class="symbol">;</span><span class="normal"> len</span><span class="symbol">++)</span>
<span class="normal">    nsymbols </span><span class="symbol">+=</span><span class="normal"> bits</span><span class="symbol">[</span><span class="normal">len</span><span class="symbol">];</span>
<span class="normal">  </span><span class="keyword">if</span><span class="normal"> </span><span class="symbol">(</span><span class="normal">nsymbols </span><span class="symbol">&lt;</span><span class="normal"> </span><span class="number">1</span><span class="normal"> </span><span class="symbol">||</span><span class="normal"> nsymbols </span><span class="symbol">&gt;</span><span class="normal"> </span><span class="number">256</span><span class="symbol">)</span>
<span class="normal">    </span><span class="function">ERREXIT</span><span class="symbol">(</span><span class="normal">cinfo</span><span class="symbol">,</span><span class="normal"> JERR_BAD_HUFF_TABLE</span><span class="symbol">);</span>

<span class="normal">  </span><span class="function">MEMCOPY</span><span class="symbol">((*</span><span class="normal">htblptr</span><span class="symbol">)-&gt;</span><span class="normal">huffval</span><span class="symbol">,</span><span class="normal"> val</span><span class="symbol">,</span><span class="normal"> nsymbols </span><span class="symbol">*</span><span class="normal"> </span><span class="function">SIZEOF</span><span class="symbol">(</span><span class="normal">UINT8</span><span class="symbol">));</span>

<span class="normal">  </span><span class="comment">/* Initialize sent_table FALSE so table will be written to JPEG file. */</span>
<span class="normal">  </span><span class="symbol">(*</span><span class="normal">htblptr</span><span class="symbol">)-&gt;</span><span class="normal">sent_table </span><span class="symbol">=</span><span class="normal"> FALSE</span><span class="symbol">;</span>
<span class="cbracket">}</span>


<span class="function">LOCAL</span><span class="symbol">(</span><span class="type">void</span><span class="symbol">)</span>
<span class="function">std_huff_tables</span><span class="normal"> </span><span class="symbol">(</span><span class="usertype">j_compress_ptr</span><span class="normal"> cinfo</span><span class="symbol">)</span>
<span class="comment">/* Set up the standard Huffman tables (cf. JPEG standard section K.3) */</span>
<span class="comment">/* IMPORTANT: these are only valid for 8-bit data precision! */</span>
<span class="cbracket">{</span>
<span class="normal">  </span><span class="keyword">static</span><span class="normal"> </span><span class="keyword">const</span><span class="normal"> </span><span class="usertype">UINT8</span><span class="normal"> bits_dc_luminance</span><span class="symbol">[</span><span class="number">17</span><span class="symbol">]</span><span class="normal"> </span><span class="symbol">=</span>
<span class="normal">    </span><span class="cbracket">{</span><span class="normal"> </span><span class="comment">/* 0-base */</span><span class="normal"> </span><span class="number">0</span><span class="symbol">,</span><span class="normal"> </span><span class="number">0</span><span class="symbol">,</span><span class="normal"> </span><span class="number">1</span><span class="symbol">,</span><span class="normal"> </span><span class="number">5</span><span class="symbol">,</span><span class="normal"> </span><span class="number">1</span><span class="symbol">,</span><span class="normal"> </span><span class="number">1</span><span class="symbol">,</span><span class="normal"> </span><span class="number">1</span><span class="symbol">,</span><span class="normal"> </span><span class="number">1</span><span class="symbol">,</span><span class="normal"> </span><span class="number">1</span><span class="symbol">,</span><span class="normal"> </span><span class="number">1</span><span class="symbol">,</span><span class="normal"> </span><span class="number">0</span><span class="symbol">,</span><span class="normal"> </span><span class="number">0</span><span class="symbol">,</span><span class="normal"> </span><span class="number">0</span><span class="symbol">,</span><span class="normal"> </span><span class="number">0</span><span class="symbol">,</span><span class="normal"> </span><span class="number">0</span><span class="symbol">,</span><span class="normal"> </span><span class="number">0</span><span class="symbol">,</span><span class="normal"> </span><span class="number">0</span><span class="normal"> </span><span class="cbracket">}</span><span class="symbol">;</span>
<span class="normal">  </span><span class="keyword">static</span><span class="normal"> </span><span class="keyword">const</span><span class="normal"> </span><span class="usertype">UINT8</span><span class="normal"> val_dc_luminance</span><span class="symbol">[]</span><span class="normal"> </span><span class="symbol">=</span>
<span class="normal">    </span><span class="cbracket">{</span><span class="normal"> </span><span class="number">0</span><span class="symbol">,</span><span class="normal"> </span><span class="number">1</span><span class="symbol">,</span><span class="normal"> </span><span class="number">2</span><span class="symbol">,</span><span class="normal"> </span><span class="number">3</span><span class="symbol">,</span><span class="normal"> </span><span class="number">4</span><span class="symbol">,</span><span class="normal"> </span><span class="number">5</span><span class="symbol">,</span><span class="normal"> </span><span class="number">6</span><span class="symbol">,</span><span class="normal"> </span><span class="number">7</span><span class="symbol">,</span><span class="normal"> </span><span class="number">8</span><span class="symbol">,</span><span class="normal"> </span><span class="number">9</span><span class="symbol">,</span><span class="normal"> </span><span class="number">10</span><span class="symbol">,</span><span class="normal"> </span><span class="number">11</span><span class="normal"> </span><span class="cbracket">}</span><span class="symbol">;</span>
<span class="normal">  </span>
<span class="normal">  </span><span class="keyword">static</span><span class="normal"> </span><span class="keyword">const</span><span class="normal"> </span><span class="usertype">UINT8</span><span class="normal"> bits_dc_chrominance</span><span class="symbol">[</span><span class="number">17</span><span class="symbol">]</span><span class="normal"> </span><span class="symbol">=</span>
<span class="normal">    </span><span class="cbracket">{</span><span class="normal"> </span><span class="comment">/* 0-base */</span><span class="normal"> </span><span class="number">0</span><span class="symbol">,</span><span class="normal"> </span><span class="number">0</span><span class="symbol">,</span><span class="normal"> </span><span class="number">3</span><span class="symbol">,</span><span class="normal"> </span><span class="number">1</span><span class="symbol">,</span><span class="normal"> </span><span class="number">1</span><span class="symbol">,</span><span class="normal"> </span><span class="number">1</span><span class="symbol">,</span><span class="normal"> </span><span class="number">1</span><span class="symbol">,</span><span class="normal"> </span><span class="number">1</span><span class="symbol">,</span><span class="normal"> </span><span class="number">1</span><span class="symbol">,</span><span class="normal"> </span><span class="number">1</span><span class="symbol">,</span><span class="normal"> </span><span class="number">1</span><span class="symbol">,</span><span class="normal"> </span><span class="number">1</span><span class="symbol">,</span><span class="normal"> </span><span class="number">0</span><span class="symbol">,</span><span class="normal"> </span><span class="number">0</span><span class="symbol">,</span><span class="normal"> </span><span class="number">0</span><span class="symbol">,</span><span class="normal"> </span><span class="number">0</span><span class="symbol">,</span><span class="normal"> </span><span class="number">0</span><span class="normal"> </span><span class="cbracket">}</span><span class="symbol">;</span>
<span class="normal">  </span><span class="keyword">static</span><span class="normal"> </span><span class="keyword">const</span><span class="normal"> </span><span class="usertype">UINT8</span><span class="normal"> val_dc_chrominance</span><span class="symbol">[]</span><span class="normal"> </span><span class="symbol">=</span>
<span class="normal">    </span><span class="cbracket">{</span><span class="normal"> </span><span class="number">0</span><span class="symbol">,</span><span class="normal"> </span><span class="number">1</span><span class="symbol">,</span><span class="normal"> </span><span class="number">2</span><span class="symbol">,</span><span class="normal"> </span><span class="number">3</span><span class="symbol">,</span><span class="normal"> </span><span class="number">4</span><span class="symbol">,</span><span class="normal"> </span><span class="number">5</span><span class="symbol">,</span><span class="normal"> </span><span class="number">6</span><span class="symbol">,</span><span class="normal"> </span><span class="number">7</span><span class="symbol">,</span><span class="normal"> </span><span class="number">8</span><span class="symbol">,</span><span class="normal"> </span><span class="number">9</span><span class="symbol">,</span><span class="normal"> </span><span class="number">10</span><span class="symbol">,</span><span class="normal"> </span><span class="number">11</span><span class="normal"> </span><span class="cbracket">}</span><span class="symbol">;</span>
<span class="normal">  </span>
<span class="normal">  </span><span class="keyword">static</span><span class="normal"> </span><span class="keyword">const</span><span class="normal"> </span><span class="usertype">UINT8</span><span class="normal"> bits_ac_luminance</span><span class="symbol">[</span><span class="number">17</span><span class="symbol">]</span><span class="normal"> </span><span class="symbol">=</span>
<span class="normal">    </span><span class="cbracket">{</span><span class="normal"> </span><span class="comment">/* 0-base */</span><span class="normal"> </span><span class="number">0</span><span class="symbol">,</span><span class="normal"> </span><span class="number">0</span><span class="symbol">,</span><span class="normal"> </span><span class="number">2</span><span class="symbol">,</span><span class="normal"> </span><span class="number">1</span><span class="symbol">,</span><span class="normal"> </span><span class="number">3</span><span class="symbol">,</span><span class="normal"> </span><span class="number">3</span><span class="symbol">,</span><span class="normal"> </span><span class="number">2</span><span class="symbol">,</span><span class="normal"> </span><span class="number">4</span><span class="symbol">,</span><span class="normal"> </span><span class="number">3</span><span class="symbol">,</span><span class="normal"> </span><span class="number">5</span><span class="symbol">,</span><span class="normal"> </span><span class="number">5</span><span class="symbol">,</span><span class="normal"> </span><span class="number">4</span><span class="symbol">,</span><span class="normal"> </span><span class="number">4</span><span class="symbol">,</span><span class="normal"> </span><span class="number">0</span><span class="symbol">,</span><span class="normal"> </span><span class="number">0</span><span class="symbol">,</span><span class="normal"> </span><span class="number">1</span><span class="symbol">,</span><span class="normal"> </span><span class="number">0x7d</span><span class="normal"> </span><span class="cbracket">}</span><span class="symbol">;</span>
<span class="normal">  </span><span class="keyword">static</span><span class="normal"> </span><span class="keyword">const</span><span class="normal"> </span><span class="usertype">UINT8</span><span class="normal"> val_ac_luminance</span><span class="symbol">[]</span><span class="normal"> </span><span class="symbol">=</span>
<span class="normal">    </span><span class="cbracket">{</span><span class="normal"> </span><span class="number">0x01</span><span class="symbol">,</span><span class="normal"> </span><span class="number">0x02</span><span class="symbol">,</span><span class="normal"> </span><span class="number">0x03</span><span class="symbol">,</span><span class="normal"> </span><span class="number">0x00</span><span class="symbol">,</span><span class="normal"> </span><span class="number">0x04</span><span class="symbol">,</span><span class="normal"> </span><span class="number">0x11</span><span class="symbol">,</span><span class="normal"> </span><span class="number">0x05</span><span class="symbol">,</span><span class="normal"> </span><span class="number">0x12</span><span class="symbol">,</span>
<span class="normal">      </span><span class="number">0x21</span><span class="symbol">,</span><span class="normal"> </span><span class="number">0x31</span><span class="symbol">,</span><span class="normal"> </span><span class="number">0x41</span><span class="symbol">,</span><span class="normal"> </span><span class="number">0x06</span><span class="symbol">,</span><span class="normal"> </span><span class="number">0x13</span><span class="symbol">,</span><span class="normal"> </span><span class="number">0x51</span><span class="symbol">,</span><span class="normal"> </span><span class="number">0x61</span><span class="symbol">,</span><span class="normal"> </span><span class="number">0x07</span><span class="symbol">,</span>
<span class="normal">      </span><span class="number">0x22</span><span class="symbol">,</span><span class="normal"> </span><span class="number">0x71</span><span class="symbol">,</span><span class="normal"> </span><span class="number">0x14</span><span class="symbol">,</span><span class="normal"> </span><span class="number">0x32</span><span class="symbol">,</span><span class="normal"> </span><span class="number">0x81</span><span class="symbol">,</span><span class="normal"> </span><span class="number">0x91</span><span class="symbol">,</span><span class="normal"> </span><span class="number">0xa1</span><span class="symbol">,</span><span class="normal"> </span><span class="number">0x08</span><span class="symbol">,</span>
<span class="normal">      </span><span class="number">0x23</span><span class="symbol">,</span><span class="normal"> </span><span class="number">0x42</span><span class="symbol">,</span><span class="normal"> </span><span class="number">0xb1</span><span class="symbol">,</span><span class="normal"> </span><span class="number">0xc1</span><span class="symbol">,</span><span class="normal"> </span><span class="number">0x15</span><span class="symbol">,</span><span class="normal"> </span><span class="number">0x52</span><span class="symbol">,</span><span class="normal"> </span><span class="number">0xd1</span><span class="symbol">,</span><span class="normal"> </span><span class="number">0xf0</span><span class="symbol">,</span>
<span class="normal">      </span><span class="number">0x24</span><span class="symbol">,</span><span class="normal"> </span><span class="number">0x33</span><span class="symbol">,</span><span class="normal"> </span><span class="number">0x62</span><span class="symbol">,</span><span class="normal"> </span><span class="number">0x72</span><span class="symbol">,</span><span class="normal"> </span><span class="number">0x82</span><span class="symbol">,</span><span class="normal"> </span><span class="number">0x09</span><span class="symbol">,</span><span class="normal"> </span><span class="number">0x0a</span><span class="symbol">,</span><span class="normal"> </span><span class="number">0x16</span><span class="symbol">,</span>
<span class="normal">      </span><span class="number">0x17</span><span class="symbol">,</span><span class="normal"> </span><span class="number">0x18</span><span class="symbol">,</span><span class="normal"> </span><span class="number">0x19</span><span class="symbol">,</span><span class="normal"> </span><span class="number">0x1a</span><span class="symbol">,</span><span class="normal"> </span><span class="number">0x25</span><span class="symbol">,</span><span class="normal"> </span><span class="number">0x26</span><span class="symbol">,</span><span class="normal"> </span><span class="number">0x27</span><span class="symbol">,</span><span class="normal"> </span><span class="number">0x28</span><span class="symbol">,</span>
<span class="normal">      </span><span class="number">0x29</span><span class="symbol">,</span><span class="normal"> </span><span class="number">0x2a</span><span class="symbol">,</span><span class="normal"> </span><span class="number">0x34</span><span class="symbol">,</span><span class="normal"> </span><span class="number">0x35</span><span class="symbol">,</span><span class="normal"> </span><span class="number">0x36</span><span class="symbol">,</span><span class="normal"> </span><span class="number">0x37</span><span class="symbol">,</span><span class="normal"> </span><span class="number">0x38</span><span class="symbol">,</span><span class="normal"> </span><span class="number">0x39</span><span class="symbol">,</span>
<span class="normal">      </span><span class="number">0x3a</span><span class="symbol">,</span><span class="normal"> </span><span class="number">0x43</span><span class="symbol">,</span><span class="normal"> </span><span class="number">0x44</span><span class="symbol">,</span><span class="normal"> </span><span class="number">0x45</span><span class="symbol">,</span><span class="normal"> </span><span class="number">0x46</span><span class="symbol">,</span><span class="normal"> </span><span class="number">0x47</span><span class="symbol">,</span><span class="normal"> </span><span class="number">0x48</span><span class="symbol">,</span><span class="normal"> </span><span class="number">0x49</span><span class="symbol">,</span>
<span class="normal">      </span><span class="number">0x4a</span><span class="symbol">,</span><span class="normal"> </span><span class="number">0x53</span><span class="symbol">,</span><span class="normal"> </span><span class="number">0x54</span><span class="symbol">,</span><span class="normal"> </span><span class="number">0x55</span><span class="symbol">,</span><span class="normal"> </span><span class="number">0x56</span><span class="symbol">,</span><span class="normal"> </span><span class="number">0x57</span><span class="symbol">,</span><span class="normal"> </span><span class="number">0x58</span><span class="symbol">,</span><span class="normal"> </span><span class="number">0x59</span><span class="symbol">,</span>
<span class="normal">      </span><span class="number">0x5a</span><span class="symbol">,</span><span class="normal"> </span><span class="number">0x63</span><span class="symbol">,</span><span class="normal"> </span><span class="number">0x64</span><span class="symbol">,</span><span class="normal"> </span><span class="number">0x65</span><span class="symbol">,</span><span class="normal"> </span><span class="number">0x66</span><span class="symbol">,</span><span class="normal"> </span><span class="number">0x67</span><span class="symbol">,</span><span class="normal"> </span><span class="number">0x68</span><span class="symbol">,</span><span class="normal"> </span><span class="number">0x69</span><span class="symbol">,</span>
<span class="normal">      </span><span class="number">0x6a</span><span class="symbol">,</span><span class="normal"> </span><span class="number">0x73</span><span class="symbol">,</span><span class="normal"> </span><span class="number">0x74</span><span class="symbol">,</span><span class="normal"> </span><span class="number">0x75</span><span class="symbol">,</span><span class="normal"> </span><span class="number">0x76</span><span class="symbol">,</span><span class="normal"> </span><span class="number">0x77</span><span class="symbol">,</span><span class="normal"> </span><span class="number">0x78</span><span class="symbol">,</span><span class="normal"> </span><span class="number">0x79</span><span class="symbol">,</span>
<span class="normal">      </span><span class="number">0x7a</span><span class="symbol">,</span><span class="normal"> </span><span class="number">0x83</span><span class="symbol">,</span><span class="normal"> </span><span class="number">0x84</span><span class="symbol">,</span><span class="normal"> </span><span class="number">0x85</span><span class="symbol">,</span><span class="normal"> </span><span class="number">0x86</span><span class="symbol">,</span><span class="normal"> </span><span class="number">0x87</span><span class="symbol">,</span><span class="normal"> </span><span class="number">0x88</span><span class="symbol">,</span><span class="normal"> </span><span class="number">0x89</span><span class="symbol">,</span>
<span class="normal">      </span><span class="number">0x8a</span><span class="symbol">,</span><span class="normal"> </span><span class="number">0x92</span><span class="symbol">,</span><span class="normal"> </span><span class="number">0x93</span><span class="symbol">,</span><span class="normal"> </span><span class="number">0x94</span><span class="symbol">,</span><span class="normal"> </span><span class="number">0x95</span><span class="symbol">,</span><span class="normal"> </span><span class="number">0x96</span><span class="symbol">,</span><span class="normal"> </span><span class="number">0x97</span><span class="symbol">,</span><span class="normal"> </span><span class="number">0x98</span><span class="symbol">,</span>
<span class="normal">      </span><span class="number">0x99</span><span class="symbol">,</span><span class="normal"> </span><span class="number">0x9a</span><span class="symbol">,</span><span class="normal"> </span><span class="number">0xa2</span><span class="symbol">,</span><span class="normal"> </span><span class="number">0xa3</span><span class="symbol">,</span><span class="normal"> </span><span class="number">0xa4</span><span class="symbol">,</span><span class="normal"> </span><span class="number">0xa5</span><span class="symbol">,</span><span class="normal"> </span><span class="number">0xa6</span><span class="symbol">,</span><span class="normal"> </span><span class="number">0xa7</span><span class="symbol">,</span>
<span class="normal">      </span><span class="number">0xa8</span><span class="symbol">,</span><span class="normal"> </span><span class="number">0xa9</span><span class="symbol">,</span><span class="normal"> </span><span class="number">0xaa</span><span class="symbol">,</span><span class="normal"> </span><span class="number">0xb2</span><span class="symbol">,</span><span class="normal"> </span><span class="number">0xb3</span><span class="symbol">,</span><span class="normal"> </span><span class="number">0xb4</span><span class="symbol">,</span><span class="normal"> </span><span class="number">0xb5</span><span class="symbol">,</span><span class="normal"> </span><span class="number">0xb6</span><span class="symbol">,</span>
<span class="normal">      </span><span class="number">0xb7</span><span class="symbol">,</span><span class="normal"> </span><span class="number">0xb8</span><span class="symbol">,</span><span class="normal"> </span><span class="number">0xb9</span><span class="symbol">,</span><span class="normal"> </span><span class="number">0xba</span><span class="symbol">,</span><span class="normal"> </span><span class="number">0xc2</span><span class="symbol">,</span><span class="normal"> </span><span class="number">0xc3</span><span class="symbol">,</span><span class="normal"> </span><span class="number">0xc4</span><span class="symbol">,</span><span class="normal"> </span><span class="number">0xc5</span><span class="symbol">,</span>
<span class="normal">      </span><span class="number">0xc6</span><span class="symbol">,</span><span class="normal"> </span><span class="number">0xc7</span><span class="symbol">,</span><span class="normal"> </span><span class="number">0xc8</span><span class="symbol">,</span><span class="normal"> </span><span class="number">0xc9</span><span class="symbol">,</span><span class="normal"> </span><span class="number">0xca</span><span class="symbol">,</span><span class="normal"> </span><span class="number">0xd2</span><span class="symbol">,</span><span class="normal"> </span><span class="number">0xd3</span><span class="symbol">,</span><span class="normal"> </span><span class="number">0xd4</span><span class="symbol">,</span>
<span class="normal">      </span><span class="number">0xd5</span><span class="symbol">,</span><span class="normal"> </span><span class="number">0xd6</span><span class="symbol">,</span><span class="normal"> </span><span class="number">0xd7</span><span class="symbol">,</span><span class="normal"> </span><span class="number">0xd8</span><span class="symbol">,</span><span class="normal"> </span><span class="number">0xd9</span><span class="symbol">,</span><span class="normal"> </span><span class="number">0xda</span><span class="symbol">,</span><span class="normal"> </span><span class="number">0xe1</span><span class="symbol">,</span><span class="normal"> </span><span class="number">0xe2</span><span class="symbol">,</span>
<span class="normal">      </span><span class="number">0xe3</span><span class="symbol">,</span><span class="normal"> </span><span class="number">0xe4</span><span class="symbol">,</span><span class="normal"> </span><span class="number">0xe5</span><span class="symbol">,</span><span class="normal"> </span><span class="number">0xe6</span><span class="symbol">,</span><span class="normal"> </span><span class="number">0xe7</span><span class="symbol">,</span><span class="normal"> </span><span class="number">0xe8</span><span class="symbol">,</span><span class="normal"> </span><span class="number">0xe9</span><span class="symbol">,</span><span class="normal"> </span><span class="number">0xea</span><span class="symbol">,</span>
<span class="normal">      </span><span class="number">0xf1</span><span class="symbol">,</span><span class="normal"> </span><span class="number">0xf2</span><span class="symbol">,</span><span class="normal"> </span><span class="number">0xf3</span><span class="symbol">,</span><span class="normal"> </span><span class="number">0xf4</span><span class="symbol">,</span><span class="normal"> </span><span class="number">0xf5</span><span class="symbol">,</span><span class="normal"> </span><span class="number">0xf6</span><span class="symbol">,</span><span class="normal"> </span><span class="number">0xf7</span><span class="symbol">,</span><span class="normal"> </span><span class="number">0xf8</span><span class="symbol">,</span>
<span class="normal">      </span><span class="number">0xf9</span><span class="symbol">,</span><span class="normal"> </span><span class="number">0xfa</span><span class="normal"> </span><span class="cbracket">}</span><span class="symbol">;</span>
<span class="normal">  </span>
<span class="normal">  </span><span class="keyword">static</span><span class="normal"> </span><span class="keyword">const</span><span class="normal"> </span><span class="usertype">UINT8</span><span class="normal"> bits_ac_chrominance</span><span class="symbol">[</span><span class="number">17</span><span class="symbol">]</span><span class="normal"> </span><span class="symbol">=</span>
<span class="normal">    </span><span class="cbracket">{</span><span class="normal"> </span><span class="comment">/* 0-base */</span><span class="normal"> </span><span class="number">0</span><span class="symbol">,</span><span class="normal"> </span><span class="number">0</span><span class="symbol">,</span><span class="normal"> </span><span class="number">2</span><span class="symbol">,</span><span class="normal"> </span><span class="number">1</span><span class="symbol">,</span><span class="normal"> </span><span class="number">2</span><span class="symbol">,</span><span class="normal"> </span><span class="number">4</span><span class="symbol">,</span><span class="normal"> </span><span class="number">4</span><span class="symbol">,</span><span class="normal"> </span><span class="number">3</span><span class="symbol">,</span><span class="normal"> </span><span class="number">4</span><span class="symbol">,</span><span class="normal"> </span><span class="number">7</span><span class="symbol">,</span><span class="normal"> </span><span class="number">5</span><span class="symbol">,</span><span class="normal"> </span><span class="number">4</span><span class="symbol">,</span><span class="normal"> </span><span class="number">4</span><span class="symbol">,</span><span class="normal"> </span><span class="number">0</span><span class="symbol">,</span><span class="normal"> </span><span class="number">1</span><span class="symbol">,</span><span class="normal"> </span><span class="number">2</span><span class="symbol">,</span><span class="normal"> </span><span class="number">0x77</span><span class="normal"> </span><span class="cbracket">}</span><span class="symbol">;</span>
<span class="normal">  </span><span class="keyword">static</span><span class="normal"> </span><span class="keyword">const</span><span class="normal"> </span><span class="usertype">UINT8</span><span class="normal"> val_ac_chrominance</span><span class="symbol">[]</span><span class="normal"> </span><span class="symbol">=</span>
<span class="normal">    </span><span class="cbracket">{</span><span class="normal"> </span><span class="number">0x00</span><span class="symbol">,</span><span class="normal"> </span><span class="number">0x01</span><span class="symbol">,</span><span class="normal"> </span><span class="number">0x02</span><span class="symbol">,</span><span class="normal"> </span><span class="number">0x03</span><span class="symbol">,</span><span class="normal"> </span><span class="number">0x11</span><span class="symbol">,</span><span class="normal"> </span><span class="number">0x04</span><span class="symbol">,</span><span class="normal"> </span><span class="number">0x05</span><span class="symbol">,</span><span class="normal"> </span><span class="number">0x21</span><span class="symbol">,</span>
<span class="normal">      </span><span class="number">0x31</span><span class="symbol">,</span><span class="normal"> </span><span class="number">0x06</span><span class="symbol">,</span><span class="normal"> </span><span class="number">0x12</span><span class="symbol">,</span><span class="normal"> </span><span class="number">0x41</span><span class="symbol">,</span><span class="normal"> </span><span class="number">0x51</span><span class="symbol">,</span><span class="normal"> </span><span class="number">0x07</span><span class="symbol">,</span><span class="normal"> </span><span class="number">0x61</span><span class="symbol">,</span><span class="normal"> </span><span class="number">0x71</span><span class="symbol">,</span>
<span class="normal">      </span><span class="number">0x13</span><span class="symbol">,</span><span class="normal"> </span><span class="number">0x22</span><span class="symbol">,</span><span class="normal"> </span><span class="number">0x32</span><span class="symbol">,</span><span class="normal"> </span><span class="number">0x81</span><span class="symbol">,</span><span class="normal"> </span><span class="number">0x08</span><span class="symbol">,</span><span class="normal"> </span><span class="number">0x14</span><span class="symbol">,</span><span class="normal"> </span><span class="number">0x42</span><span class="symbol">,</span><span class="normal"> </span><span class="number">0x91</span><span class="symbol">,</span>
<span class="normal">      </span><span class="number">0xa1</span><span class="symbol">,</span><span class="normal"> </span><span class="number">0xb1</span><span class="symbol">,</span><span class="normal"> </span><span class="number">0xc1</span><span class="symbol">,</span><span class="normal"> </span><span class="number">0x09</span><span class="symbol">,</span><span class="normal"> </span><span class="number">0x23</span><span class="symbol">,</span><span class="normal"> </span><span class="number">0x33</span><span class="symbol">,</span><span class="normal"> </span><span class="number">0x52</span><span class="symbol">,</span><span class="normal"> </span><span class="number">0xf0</span><span class="symbol">,</span>
<span class="normal">      </span><span class="number">0x15</span><span class="symbol">,</span><span class="normal"> </span><span class="number">0x62</span><span class="symbol">,</span><span class="normal"> </span><span class="number">0x72</span><span class="symbol">,</span><span class="normal"> </span><span class="number">0xd1</span><span class="symbol">,</span><span class="normal"> </span><span class="number">0x0a</span><span class="symbol">,</span><span class="normal"> </span><span class="number">0x16</span><span class="symbol">,</span><span class="normal"> </span><span class="number">0x24</span><span class="symbol">,</span><span class="normal"> </span><span class="number">0x34</span><span class="symbol">,</span>
<span class="normal">      </span><span class="number">0xe1</span><span class="symbol">,</span><span class="normal"> </span><span class="number">0x25</span><span class="symbol">,</span><span class="normal"> </span><span class="number">0xf1</span><span class="symbol">,</span><span class="normal"> </span><span class="number">0x17</span><span class="symbol">,</span><span class="normal"> </span><span class="number">0x18</span><span class="symbol">,</span><span class="normal"> </span><span class="number">0x19</span><span class="symbol">,</span><span class="normal"> </span><span class="number">0x1a</span><span class="symbol">,</span><span class="normal"> </span><span class="number">0x26</span><span class="symbol">,</span>
<span class="normal">      </span><span class="number">0x27</span><span class="symbol">,</span><span class="normal"> </span><span class="number">0x28</span><span class="symbol">,</span><span class="normal"> </span><span class="number">0x29</span><span class="symbol">,</span><span class="normal"> </span><span class="number">0x2a</span><span class="symbol">,</span><span class="normal"> </span><span class="number">0x35</span><span class="symbol">,</span><span class="normal"> </span><span class="number">0x36</span><span class="symbol">,</span><span class="normal"> </span><span class="number">0x37</span><span class="symbol">,</span><span class="normal"> </span><span class="number">0x38</span><span class="symbol">,</span>
<span class="normal">      </span><span class="number">0x39</span><span class="symbol">,</span><span class="normal"> </span><span class="number">0x3a</span><span class="symbol">,</span><span class="normal"> </span><span class="number">0x43</span><span class="symbol">,</span><span class="normal"> </span><span class="number">0x44</span><span class="symbol">,</span><span class="normal"> </span><span class="number">0x45</span><span class="symbol">,</span><span class="normal"> </span><span class="number">0x46</span><span class="symbol">,</span><span class="normal"> </span><span class="number">0x47</span><span class="symbol">,</span><span class="normal"> </span><span class="number">0x48</span><span class="symbol">,</span>
<span class="normal">      </span><span class="number">0x49</span><span class="symbol">,</span><span class="normal"> </span><span class="number">0x4a</span><span class="symbol">,</span><span class="normal"> </span><span class="number">0x53</span><span class="symbol">,</span><span class="normal"> </span><span class="number">0x54</span><span class="symbol">,</span><span class="normal"> </span><span class="number">0x55</span><span class="symbol">,</span><span class="normal"> </span><span class="number">0x56</span><span class="symbol">,</span><span class="normal"> </span><span class="number">0x57</span><span class="symbol">,</span><span class="normal"> </span><span class="number">0x58</span><span class="symbol">,</span>
<span class="normal">      </span><span class="number">0x59</span><span class="symbol">,</span><span class="normal"> </span><span class="number">0x5a</span><span class="symbol">,</span><span class="normal"> </span><span class="number">0x63</span><span class="symbol">,</span><span class="normal"> </span><span class="number">0x64</span><span class="symbol">,</span><span class="normal"> </span><span class="number">0x65</span><span class="symbol">,</span><span class="normal"> </span><span class="number">0x66</span><span class="symbol">,</span><span class="normal"> </span><span class="number">0x67</span><span class="symbol">,</span><span class="normal"> </span><span class="number">0x68</span><span class="symbol">,</span>
<span class="normal">      </span><span class="number">0x69</span><span class="symbol">,</span><span class="normal"> </span><span class="number">0x6a</span><span class="symbol">,</span><span class="normal"> </span><span class="number">0x73</span><span class="symbol">,</span><span class="normal"> </span><span class="number">0x74</span><span class="symbol">,</span><span class="normal"> </span><span class="number">0x75</span><span class="symbol">,</span><span class="normal"> </span><span class="number">0x76</span><span class="symbol">,</span><span class="normal"> </span><span class="number">0x77</span><span class="symbol">,</span><span class="normal"> </span><span class="number">0x78</span><span class="symbol">,</span>
<span class="normal">      </span><span class="number">0x79</span><span class="symbol">,</span><span class="normal"> </span><span class="number">0x7a</span><span class="symbol">,</span><span class="normal"> </span><span class="number">0x82</span><span class="symbol">,</span><span class="normal"> </span><span class="number">0x83</span><span class="symbol">,</span><span class="normal"> </span><span class="number">0x84</span><span class="symbol">,</span><span class="normal"> </span><span class="number">0x85</span><span class="symbol">,</span><span class="normal"> </span><span class="number">0x86</span><span class="symbol">,</span><span class="normal"> </span><span class="number">0x87</span><span class="symbol">,</span>
<span class="normal">      </span><span class="number">0x88</span><span class="symbol">,</span><span class="normal"> </span><span class="number">0x89</span><span class="symbol">,</span><span class="normal"> </span><span class="number">0x8a</span><span class="symbol">,</span><span class="normal"> </span><span class="number">0x92</span><span class="symbol">,</span><span class="normal"> </span><span class="number">0x93</span><span class="symbol">,</span><span class="normal"> </span><span class="number">0x94</span><span class="symbol">,</span><span class="normal"> </span><span class="number">0x95</span><span class="symbol">,</span><span class="normal"> </span><span class="number">0x96</span><span class="symbol">,</span>
<span class="normal">      </span><span class="number">0x97</span><span class="symbol">,</span><span class="normal"> </span><span class="number">0x98</span><span class="symbol">,</span><span class="normal"> </span><span class="number">0x99</span><span class="symbol">,</span><span class="normal"> </span><span class="number">0x9a</span><span class="symbol">,</span><span class="normal"> </span><span class="number">0xa2</span><span class="symbol">,</span><span class="normal"> </span><span class="number">0xa3</span><span class="symbol">,</span><span class="normal"> </span><span class="number">0xa4</span><span class="symbol">,</span><span class="normal"> </span><span class="number">0xa5</span><span class="symbol">,</span>
<span class="normal">      </span><span class="number">0xa6</span><span class="symbol">,</span><span class="normal"> </span><span class="number">0xa7</span><span class="symbol">,</span><span class="normal"> </span><span class="number">0xa8</span><span class="symbol">,</span><span class="normal"> </span><span class="number">0xa9</span><span class="symbol">,</span><span class="normal"> </span><span class="number">0xaa</span><span class="symbol">,</span><span class="normal"> </span><span class="number">0xb2</span><span class="symbol">,</span><span class="normal"> </span><span class="number">0xb3</span><span class="symbol">,</span><span class="normal"> </span><span class="number">0xb4</span><span class="symbol">,</span>
<span class="normal">      </span><span class="number">0xb5</span><span class="symbol">,</span><span class="normal"> </span><span class="number">0xb6</span><span class="symbol">,</span><span class="normal"> </span><span class="number">0xb7</span><span class="symbol">,</span><span class="normal"> </span><span class="number">0xb8</span><span class="symbol">,</span><span class="normal"> </span><span class="number">0xb9</span><span class="symbol">,</span><span class="normal"> </span><span class="number">0xba</span><span class="symbol">,</span><span class="normal"> </span><span class="number">0xc2</span><span class="symbol">,</span><span class="normal"> </span><span class="number">0xc3</span><span class="symbol">,</span>
<span class="normal">      </span><span class="number">0xc4</span><span class="symbol">,</span><span class="normal"> </span><span class="number">0xc5</span><span class="symbol">,</span><span class="normal"> </span><span class="number">0xc6</span><span class="symbol">,</span><span class="normal"> </span><span class="number">0xc7</span><span class="symbol">,</span><span class="normal"> </span><span class="number">0xc8</span><span class="symbol">,</span><span class="normal"> </span><span class="number">0xc9</span><span class="symbol">,</span><span class="normal"> </span><span class="number">0xca</span><span class="symbol">,</span><span class="normal"> </span><span class="number">0xd2</span><span class="symbol">,</span>
<span class="normal">      </span><span class="number">0xd3</span><span class="symbol">,</span><span class="normal"> </span><span class="number">0xd4</span><span class="symbol">,</span><span class="normal"> </span><span class="number">0xd5</span><span class="symbol">,</span><span class="normal"> </span><span class="number">0xd6</span><span class="symbol">,</span><span class="normal"> </span><span class="number">0xd7</span><span class="symbol">,</span><span class="normal"> </span><span class="number">0xd8</span><span class="symbol">,</span><span class="normal"> </span><span class="number">0xd9</span><span class="symbol">,</span><span class="normal"> </span><span class="number">0xda</span><span class="symbol">,</span>
<span class="normal">      </span><span class="number">0xe2</span><span class="symbol">,</span><span class="normal"> </span><span class="number">0xe3</span><span class="symbol">,</span><span class="normal"> </span><span class="number">0xe4</span><span class="symbol">,</span><span class="normal"> </span><span class="number">0xe5</span><span class="symbol">,</span><span class="normal"> </span><span class="number">0xe6</span><span class="symbol">,</span><span class="normal"> </span><span class="number">0xe7</span><span class="symbol">,</span><span class="normal"> </span><span class="number">0xe8</span><span class="symbol">,</span><span class="normal"> </span><span class="number">0xe9</span><span class="symbol">,</span>
<span class="normal">      </span><span class="number">0xea</span><span class="symbol">,</span><span class="normal"> </span><span class="number">0xf2</span><span class="symbol">,</span><span class="normal"> </span><span class="number">0xf3</span><span class="symbol">,</span><span class="normal"> </span><span class="number">0xf4</span><span class="symbol">,</span><span class="normal"> </span><span class="number">0xf5</span><span class="symbol">,</span><span class="normal"> </span><span class="number">0xf6</span><span class="symbol">,</span><span class="normal"> </span><span class="number">0xf7</span><span class="symbol">,</span><span class="normal"> </span><span class="number">0xf8</span><span class="symbol">,</span>
<span class="normal">      </span><span class="number">0xf9</span><span class="symbol">,</span><span class="normal"> </span><span class="number">0xfa</span><span class="normal"> </span><span class="cbracket">}</span><span class="symbol">;</span>
<span class="normal">  </span>
<span class="normal">  </span><span class="function">add_huff_table</span><span class="symbol">(</span><span class="normal">cinfo</span><span class="symbol">,</span><span class="normal"> </span><span class="symbol">&amp;</span><span class="normal">cinfo</span><span class="symbol">-&gt;</span><span class="normal">dc_huff_tbl_ptrs</span><span class="symbol">[</span><span class="number">0</span><span class="symbol">],</span>
<span class="normal">		 bits_dc_luminance</span><span class="symbol">,</span><span class="normal"> val_dc_luminance</span><span class="symbol">);</span>
<span class="normal">  </span><span class="function">add_huff_table</span><span class="symbol">(</span><span class="normal">cinfo</span><span class="symbol">,</span><span class="normal"> </span><span class="symbol">&amp;</span><span class="normal">cinfo</span><span class="symbol">-&gt;</span><span class="normal">ac_huff_tbl_ptrs</span><span class="symbol">[</span><span class="number">0</span><span class="symbol">],</span>
<span class="normal">		 bits_ac_luminance</span><span class="symbol">,</span><span class="normal"> val_ac_luminance</span><span class="symbol">);</span>
<span class="normal">  </span><span class="function">add_huff_table</span><span class="symbol">(</span><span class="normal">cinfo</span><span class="symbol">,</span><span class="normal"> </span><span class="symbol">&amp;</span><span class="normal">cinfo</span><span class="symbol">-&gt;</span><span class="normal">dc_huff_tbl_ptrs</span><span class="symbol">[</span><span class="number">1</span><span class="symbol">],</span>
<span class="normal">		 bits_dc_chrominance</span><span class="symbol">,</span><span class="normal"> val_dc_chrominance</span><span class="symbol">);</span>
<span class="normal">  </span><span class="function">add_huff_table</span><span class="symbol">(</span><span class="normal">cinfo</span><span class="symbol">,</span><span class="normal"> </span><span class="symbol">&amp;</span><span class="normal">cinfo</span><span class="symbol">-&gt;</span><span class="normal">ac_huff_tbl_ptrs</span><span class="symbol">[</span><span class="number">1</span><span class="symbol">],</span>
<span class="normal">		 bits_ac_chrominance</span><span class="symbol">,</span><span class="normal"> val_ac_chrominance</span><span class="symbol">);</span>
<span class="cbracket">}</span>


<span class="comment">/*</span>
<span class="comment"> * Default parameter setup for compression.</span>
<span class="comment"> *</span>
<span class="comment"> * Applications that don't choose to use this routine must do their</span>
<span class="comment"> * own setup of all these parameters.  Alternately, you can call this</span>
<span class="comment"> * to establish defaults and then alter parameters selectively.  This</span>
<span class="comment"> * is the recommended approach since, if we add any new parameters,</span>
<span class="comment"> * your code will still work (they'll be set to reasonable defaults).</span>
<span class="comment"> */</span>

<span class="function">GLOBAL</span><span class="symbol">(</span><span class="type">void</span><span class="symbol">)</span>
<span class="function">jpeg_set_defaults</span><span class="normal"> </span><span class="symbol">(</span><span class="usertype">j_compress_ptr</span><span class="normal"> cinfo</span><span class="symbol">)</span>
<span class="cbracket">{</span>
<span class="normal">  </span><span class="type">int</span><span class="normal"> i</span><span class="symbol">;</span>

<span class="normal">  </span><span class="comment">/* Safety check to ensure start_compress not called yet. */</span>
<span class="normal">  </span><span class="keyword">if</span><span class="normal"> </span><span class="symbol">(</span><span class="normal">cinfo</span><span class="symbol">-&gt;</span><span class="normal">global_state </span><span class="symbol">!=</span><span class="normal"> CSTATE_START</span><span class="symbol">)</span>
<span class="normal">    </span><span class="function">ERREXIT1</span><span class="symbol">(</span><span class="normal">cinfo</span><span class="symbol">,</span><span class="normal"> JERR_BAD_STATE</span><span class="symbol">,</span><span class="normal"> cinfo</span><span class="symbol">-&gt;</span><span class="normal">global_state</span><span class="symbol">);</span>

<span class="normal">  </span><span class="comment">/* Allocate comp_info array large enough for maximum component count.</span>
<span class="comment">   * Array is made permanent in case application wants to compress</span>
<span class="comment">   * multiple images at same param settings.</span>
<span class="comment">   */</span>
<span class="normal">  </span><span class="keyword">if</span><span class="normal"> </span><span class="symbol">(</span><span class="normal">cinfo</span><span class="symbol">-&gt;</span><span class="normal">comp_info </span><span class="symbol">==</span><span class="normal"> NULL</span><span class="symbol">)</span>
<span class="normal">    cinfo</span><span class="symbol">-&gt;</span><span class="normal">comp_info </span><span class="symbol">=</span><span class="normal"> </span><span class="symbol">(</span><span class="normal">jpeg_component_info </span><span class="symbol">*)</span>
<span class="normal">      </span><span class="symbol">(*</span><span class="normal">cinfo</span><span class="symbol">-&gt;</span><span class="normal">mem</span><span class="symbol">-&gt;</span><span class="normal">alloc_small</span><span class="symbol">)</span><span class="normal"> </span><span class="symbol">((</span><span class="normal">j_common_ptr</span><span class="symbol">)</span><span class="normal"> cinfo</span><span class="symbol">,</span><span class="normal"> JPOOL_PERMANENT</span><span class="symbol">,</span>
<span class="normal">				  MAX_COMPONENTS </span><span class="symbol">*</span><span class="normal"> </span><span class="function">SIZEOF</span><span class="symbol">(</span><span class="normal">jpeg_component_info</span><span class="symbol">));</span>

<span class="normal">  </span><span class="comment">/* Initialize everything not dependent on the color space */</span>

<span class="normal">  cinfo</span><span class="symbol">-&gt;</span><span class="normal">data_precision </span><span class="symbol">=</span><span class="normal"> BITS_IN_JSAMPLE</span><span class="symbol">;</span>
<span class="normal">  </span><span class="comment">/* Set up two quantization tables using default quality of 75 */</span>
<span class="normal">  </span><span class="function">jpeg_set_quality</span><span class="symbol">(</span><span class="normal">cinfo</span><span class="symbol">,</span><span class="normal"> </span><span class="number">75</span><span class="symbol">,</span><span class="normal"> TRUE</span><span class="symbol">);</span>
<span class="normal">  </span><span class="comment">/* Set up two Huffman tables */</span>
<span class="normal">  </span><span class="function">std_huff_tables</span><span class="symbol">(</span><span class="normal">cinfo</span><span class="symbol">);</span>

<span class="normal">  </span><span class="comment">/* Initialize default arithmetic coding conditioning */</span>
<span class="normal">  </span><span class="keyword">for</span><span class="normal"> </span><span class="symbol">(</span><span class="normal">i </span><span class="symbol">=</span><span class="normal"> </span><span class="number">0</span><span class="symbol">;</span><span class="normal"> i </span><span class="symbol">&lt;</span><span class="normal"> NUM_ARITH_TBLS</span><span class="symbol">;</span><span class="normal"> i</span><span class="symbol">++)</span><span class="normal"> </span><span class="cbracket">{</span>
<span class="normal">    cinfo</span><span class="symbol">-&gt;</span><span class="normal">arith_dc_L</span><span class="symbol">[</span><span class="normal">i</span><span class="symbol">]</span><span class="normal"> </span><span class="symbol">=</span><span class="normal"> </span><span class="number">0</span><span class="symbol">;</span>
<span class="normal">    cinfo</span><span class="symbol">-&gt;</span><span class="normal">arith_dc_U</span><span class="symbol">[</span><span class="normal">i</span><span class="symbol">]</span><span class="normal"> </span><span class="symbol">=</span><span class="normal"> </span><span class="number">1</span><span class="symbol">;</span>
<span class="normal">    cinfo</span><span class="symbol">-&gt;</span><span class="normal">arith_ac_K</span><span class="symbol">[</span><span class="normal">i</span><span class="symbol">]</span><span class="normal"> </span><span class="symbol">=</span><span class="normal"> </span><span class="number">5</span><span class="symbol">;</span>
<span class="normal">  </span><span class="cbracket">}</span>

<span class="normal">  </span><span class="comment">/* Default is no multiple-scan output */</span>
<span class="normal">  cinfo</span><span class="symbol">-&gt;</span><span class="normal">scan_info </span><span class="symbol">=</span><span class="normal"> NULL</span><span class="symbol">;</span>
<span class="normal">  cinfo</span><span class="symbol">-&gt;</span><span class="normal">num_scans </span><span class="symbol">=</span><span class="normal"> </span><span class="number">0</span><span class="symbol">;</span>

<span class="normal">  </span><span class="comment">/* Expect normal source image, not raw downsampled data */</span>
<span class="normal">  cinfo</span><span class="symbol">-&gt;</span><span class="normal">raw_data_in </span><span class="symbol">=</span><span class="normal"> FALSE</span><span class="symbol">;</span>

<span class="normal">  </span><span class="comment">/* Use Huffman coding, not arithmetic coding, by default */</span>
<span class="normal">  cinfo</span><span class="symbol">-&gt;</span><span class="normal">arith_code </span><span class="symbol">=</span><span class="normal"> FALSE</span><span class="symbol">;</span>

<span class="normal">  </span><span class="comment">/* By default, don't do extra passes to optimize entropy coding */</span>
<span class="normal">  cinfo</span><span class="symbol">-&gt;</span><span class="normal">optimize_coding </span><span class="symbol">=</span><span class="normal"> FALSE</span><span class="symbol">;</span>
<span class="normal">  </span><span class="comment">/* The standard Huffman tables are only valid for 8-bit data precision.</span>
<span class="comment">   * If the precision is higher, force optimization on so that usable</span>
<span class="comment">   * tables will be computed.  This test can be removed if default tables</span>
<span class="comment">   * are supplied that are valid for the desired precision.</span>
<span class="comment">   */</span>
<span class="normal">  </span><span class="keyword">if</span><span class="normal"> </span><span class="symbol">(</span><span class="normal">cinfo</span><span class="symbol">-&gt;</span><span class="normal">data_precision </span><span class="symbol">&gt;</span><span class="normal"> </span><span class="number">8</span><span class="symbol">)</span>
<span class="normal">    cinfo</span><span class="symbol">-&gt;</span><span class="normal">optimize_coding </span><span class="symbol">=</span><span class="normal"> TRUE</span><span class="symbol">;</span>

<span class="normal">  </span><span class="comment">/* By default, use the simpler non-cosited sampling alignment */</span>
<span class="normal">  cinfo</span><span class="symbol">-&gt;</span><span class="normal">CCIR601_sampling </span><span class="symbol">=</span><span class="normal"> FALSE</span><span class="symbol">;</span>

<span class="normal">  </span><span class="comment">/* No input smoothing */</span>
<span class="normal">  cinfo</span><span class="symbol">-&gt;</span><span class="normal">smoothing_factor </span><span class="symbol">=</span><span class="normal"> </span><span class="number">0</span><span class="symbol">;</span>

<span class="normal">  </span><span class="comment">/* DCT algorithm preference */</span>
<span class="normal">  cinfo</span><span class="symbol">-&gt;</span><span class="normal">dct_method </span><span class="symbol">=</span><span class="normal"> JDCT_DEFAULT</span><span class="symbol">;</span>

<span class="normal">  </span><span class="comment">/* No restart markers */</span>
<span class="normal">  cinfo</span><span class="symbol">-&gt;</span><span class="normal">restart_interval </span><span class="symbol">=</span><span class="normal"> </span><span class="number">0</span><span class="symbol">;</span>
<span class="normal">  cinfo</span><span class="symbol">-&gt;</span><span class="normal">restart_in_rows </span><span class="symbol">=</span><span class="normal"> </span><span class="number">0</span><span class="symbol">;</span>

<span class="normal">  </span><span class="comment">/* Fill in default JFIF marker parameters.  Note that whether the marker</span>
<span class="comment">   * will actually be written is determined by jpeg_set_colorspace.</span>
<span class="comment">   *</span>
<span class="comment">   * By default, the library emits JFIF version code 1.01.</span>
<span class="comment">   * An application that wants to emit JFIF 1.02 extension markers should set</span>
<span class="comment">   * JFIF_minor_version to 2.  We could probably get away with just defaulting</span>
<span class="comment">   * to 1.02, but there may still be some decoders in use that will complain</span>
<span class="comment">   * about that; saying 1.01 should minimize compatibility problems.</span>
<span class="comment">   */</span>
<span class="normal">  cinfo</span><span class="symbol">-&gt;</span><span class="normal">JFIF_major_version </span><span class="symbol">=</span><span class="normal"> </span><span class="number">1</span><span class="symbol">;</span><span class="normal"> </span><span class="comment">/* Default JFIF version = 1.01 */</span>
<span class="normal">  cinfo</span><span class="symbol">-&gt;</span><span class="normal">JFIF_minor_version </span><span class="symbol">=</span><span class="normal"> </span><span class="number">1</span><span class="symbol">;</span>
<span class="normal">  cinfo</span><span class="symbol">-&gt;</span><span class="normal">density_unit </span><span class="symbol">=</span><span class="normal"> </span><span class="number">0</span><span class="symbol">;</span><span class="normal">	</span><span class="comment">/* Pixel size is unknown by default */</span>
<span class="normal">  cinfo</span><span class="symbol">-&gt;</span><span class="normal">X_density </span><span class="symbol">=</span><span class="normal"> </span><span class="number">1</span><span class="symbol">;</span><span class="normal">		</span><span class="comment">/* Pixel aspect ratio is square by default */</span>
<span class="normal">  cinfo</span><span class="symbol">-&gt;</span><span class="normal">Y_density </span><span class="symbol">=</span><span class="normal"> </span><span class="number">1</span><span class="symbol">;</span>

<span class="normal">  </span><span class="comment">/* Choose JPEG colorspace based on input space, set defaults accordingly */</span>

<span class="normal">  </span><span class="function">jpeg_default_colorspace</span><span class="symbol">(</span><span class="normal">cinfo</span><span class="symbol">);</span>
<span class="cbracket">}</span>


<span class="comment">/*</span>
<span class="comment"> * Select an appropriate JPEG colorspace for in_color_space.</span>
<span class="comment"> */</span>

<span class="function">GLOBAL</span><span class="symbol">(</span><span class="type">void</span><span class="symbol">)</span>
<span class="function">jpeg_default_colorspace</span><span class="normal"> </span><span class="symbol">(</span><span class="usertype">j_compress_ptr</span><span class="normal"> cinfo</span><span class="symbol">)</span>
<span class="cbracket">{</span>
<span class="normal">  </span><span class="keyword">switch</span><span class="normal"> </span><span class="symbol">(</span><span class="normal">cinfo</span><span class="symbol">-&gt;</span><span class="normal">in_color_space</span><span class="symbol">)</span><span class="normal"> </span><span class="cbracket">{</span>
<span class="normal">  </span><span class="keyword">case</span><span class="normal"> JCS_GRAYSCALE</span><span class="symbol">:</span>
<span class="normal">    </span><span class="function">jpeg_set_colorspace</span><span class="symbol">(</span><span class="normal">cinfo</span><span class="symbol">,</span><span class="normal"> JCS_GRAYSCALE</span><span class="symbol">);</span>
<span class="normal">    </span><span class="keyword">break</span><span class="symbol">;</span>
<span class="normal">  </span><span class="keyword">case</span><span class="normal"> JCS_RGB</span><span class="symbol">:</span>
<span class="normal">    </span><span class="function">jpeg_set_colorspace</span><span class="symbol">(</span><span class="normal">cinfo</span><span class="symbol">,</span><span class="normal"> JCS_YCbCr</span><span class="symbol">);</span>
<span class="normal">    </span><span class="keyword">break</span><span class="symbol">;</span>
<span class="normal">  </span><span class="keyword">case</span><span class="normal"> JCS_YCbCr</span><span class="symbol">:</span>
<span class="normal">    </span><span class="function">jpeg_set_colorspace</span><span class="symbol">(</span><span class="normal">cinfo</span><span class="symbol">,</span><span class="normal"> JCS_YCbCr</span><span class="symbol">);</span>
<span class="normal">    </span><span class="keyword">break</span><span class="symbol">;</span>
<span class="normal">  </span><span class="keyword">case</span><span class="normal"> JCS_CMYK</span><span class="symbol">:</span>
<span class="normal">    </span><span class="function">jpeg_set_colorspace</span><span class="symbol">(</span><span class="normal">cinfo</span><span class="symbol">,</span><span class="normal"> JCS_CMYK</span><span class="symbol">);</span><span class="normal"> </span><span class="comment">/* By default, no translation */</span>
<span class="normal">    </span><span class="keyword">break</span><span class="symbol">;</span>
<span class="normal">  </span><span class="keyword">case</span><span class="normal"> JCS_YCCK</span><span class="symbol">:</span>
<span class="normal">    </span><span class="function">jpeg_set_colorspace</span><span class="symbol">(</span><span class="normal">cinfo</span><span class="symbol">,</span><span class="normal"> JCS_YCCK</span><span class="symbol">);</span>
<span class="normal">    </span><span class="keyword">break</span><span class="symbol">;</span>
<span class="normal">  </span><span class="keyword">case</span><span class="normal"> JCS_UNKNOWN</span><span class="symbol">:</span>
<span class="normal">    </span><span class="function">jpeg_set_colorspace</span><span class="symbol">(</span><span class="normal">cinfo</span><span class="symbol">,</span><span class="normal"> JCS_UNKNOWN</span><span class="symbol">);</span>
<span class="normal">    </span><span class="keyword">break</span><span class="symbol">;</span>
<span class="label">  default:</span>
<span class="normal">    </span><span class="function">ERREXIT</span><span class="symbol">(</span><span class="normal">cinfo</span><span class="symbol">,</span><span class="normal"> JERR_BAD_IN_COLORSPACE</span><span class="symbol">);</span>
<span class="normal">  </span><span class="cbracket">}</span>
<span class="cbracket">}</span>


<span class="comment">/*</span>
<span class="comment"> * Set the JPEG colorspace, and choose colorspace-dependent default values.</span>
<span class="comment"> */</span>

<span class="function">GLOBAL</span><span class="symbol">(</span><span class="type">void</span><span class="symbol">)</span>
<span class="function">jpeg_set_colorspace</span><span class="normal"> </span><span class="symbol">(</span><span class="usertype">j_compress_ptr</span><span class="normal"> cinfo</span><span class="symbol">,</span><span class="normal"> </span><span class="usertype">J_COLOR_SPACE</span><span class="normal"> colorspace</span><span class="symbol">)</span>
<span class="cbracket">{</span>
<span class="normal">  jpeg_component_info </span><span class="symbol">*</span><span class="normal"> compptr</span><span class="symbol">;</span>
<span class="normal">  </span><span class="type">int</span><span class="normal"> ci</span><span class="symbol">;</span>

<span class="preproc">#define</span><span class="normal"> </span><span class="function">SET_COMP</span><span class="symbol">(</span><span class="normal">index</span><span class="symbol">,</span><span class="normal">id</span><span class="symbol">,</span><span class="normal">hsamp</span><span class="symbol">,</span><span class="normal">vsamp</span><span class="symbol">,</span><span class="normal">quant</span><span class="symbol">,</span><span class="normal">dctbl</span><span class="symbol">,</span><span class="normal">actbl</span><span class="symbol">)</span><span class="normal">  </span><span class="symbol">\</span>
<span class="normal">  </span><span class="symbol">(</span><span class="normal">compptr </span><span class="symbol">=</span><span class="normal"> </span><span class="symbol">&amp;</span><span class="normal">cinfo</span><span class="symbol">-&gt;</span><span class="normal">comp_info</span><span class="symbol">[</span><span class="normal">index</span><span class="symbol">],</span><span class="normal"> </span><span class="symbol">\</span>
<span class="normal">   compptr</span><span class="symbol">-&gt;</span><span class="normal">component_id </span><span class="symbol">=</span><span class="normal"> </span><span class="symbol">(</span><span class="normal">id</span><span class="symbol">),</span><span class="normal"> </span><span class="symbol">\</span>
<span class="normal">   compptr</span><span class="symbol">-&gt;</span><span class="normal">h_samp_factor </span><span class="symbol">=</span><span class="normal"> </span><span class="symbol">(</span><span class="normal">hsamp</span><span class="symbol">),</span><span class="normal"> </span><span class="symbol">\</span>
<span class="normal">   compptr</span><span class="symbol">-&gt;</span><span class="normal">v_samp_factor </span><span class="symbol">=</span><span class="normal"> </span><span class="symbol">(</span><span class="normal">vsamp</span><span class="symbol">),</span><span class="normal"> </span><span class="symbol">\</span>
<span class="normal">   compptr</span><span class="symbol">-&gt;</span><span class="normal">quant_tbl_no </span><span class="symbol">=</span><span class="normal"> </span><span class="symbol">(</span><span class="normal">quant</span><span class="symbol">),</span><span class="normal"> </span><span class="symbol">\</span>
<span class="normal">   compptr</span><span class="symbol">-&gt;</span><span class="normal">dc_tbl_no </span><span class="symbol">=</span><span class="normal"> </span><span class="symbol">(</span><span class="normal">dctbl</span><span class="symbol">),</span><span class="normal"> </span><span class="symbol">\</span>
<span class="normal">   compptr</span><span class="symbol">-&gt;</span><span class="normal">ac_tbl_no </span><span class="symbol">=</span><span class="normal"> </span><span class="symbol">(</span><span class="normal">actbl</span><span class="symbol">)</span><span class="normal"> </span><span class="symbol">)</span>

<span class="normal">  </span><span class="comment">/* Safety check to ensure start_compress not called yet. */</span>
<span class="normal">  </span><span class="keyword">if</span><span class="normal"> </span><span class="symbol">(</span><span class="normal">cinfo</span><span class="symbol">-&gt;</span><span class="normal">global_state </span><span class="symbol">!=</span><span class="normal"> CSTATE_START</span><span class="symbol">)</span>
<span class="normal">    </span><span class="function">ERREXIT1</span><span class="symbol">(</span><span class="normal">cinfo</span><span class="symbol">,</span><span class="normal"> JERR_BAD_STATE</span><span class="symbol">,</span><span class="normal"> cinfo</span><span class="symbol">-&gt;</span><span class="normal">global_state</span><span class="symbol">);</span>

<span class="normal">  </span><span class="comment">/* For all colorspaces, we use Q and Huff tables 0 for luminance components,</span>
<span class="comment">   * tables 1 for chrominance components.</span>
<span class="comment">   */</span>

<span class="normal">  cinfo</span><span class="symbol">-&gt;</span><span class="normal">jpeg_color_space </span><span class="symbol">=</span><span class="normal"> colorspace</span><span class="symbol">;</span>

<span class="normal">  cinfo</span><span class="symbol">-&gt;</span><span class="normal">write_JFIF_header </span><span class="symbol">=</span><span class="normal"> FALSE</span><span class="symbol">;</span><span class="normal"> </span><span class="comment">/* No marker for non-JFIF colorspaces */</span>
<span class="normal">  cinfo</span><span class="symbol">-&gt;</span><span class="normal">write_Adobe_marker </span><span class="symbol">=</span><span class="normal"> FALSE</span><span class="symbol">;</span><span class="normal"> </span><span class="comment">/* write no Adobe marker by default */</span>

<span class="normal">  </span><span class="keyword">switch</span><span class="normal"> </span><span class="symbol">(</span><span class="normal">colorspace</span><span class="symbol">)</span><span class="normal"> </span><span class="cbracket">{</span>
<span class="normal">  </span><span class="keyword">case</span><span class="normal"> JCS_GRAYSCALE</span><span class="symbol">:</span>
<span class="normal">    cinfo</span><span class="symbol">-&gt;</span><span class="normal">write_JFIF_header </span><span class="symbol">=</span><span class="normal"> TRUE</span><span class="symbol">;</span><span class="normal"> </span><span class="comment">/* Write a JFIF marker */</span>
<span class="normal">    cinfo</span><span class="symbol">-&gt;</span><span class="normal">num_components </span><span class="symbol">=</span><span class="normal"> </span><span class="number">1</span><span class="symbol">;</span>
<span class="normal">    </span><span class="comment">/* JFIF specifies component ID 1 */</span>
<span class="normal">    </span><span class="function">SET_COMP</span><span class="symbol">(</span><span class="number">0</span><span class="symbol">,</span><span class="normal"> </span><span class="number">1</span><span class="symbol">,</span><span class="normal"> </span><span class="number">1</span><span class="symbol">,</span><span class="number">1</span><span class="symbol">,</span><span class="normal"> </span><span class="number">0</span><span class="symbol">,</span><span class="normal"> </span><span class="number">0</span><span class="symbol">,</span><span class="number">0</span><span class="symbol">);</span>
<span class="normal">    </span><span class="keyword">break</span><span class="symbol">;</span>
<span class="normal">  </span><span class="keyword">case</span><span class="normal"> JCS_RGB</span><span class="symbol">:</span>
<span class="normal">    cinfo</span><span class="symbol">-&gt;</span><span class="normal">write_Adobe_marker </span><span class="symbol">=</span><span class="normal"> TRUE</span><span class="symbol">;</span><span class="normal"> </span><span class="comment">/* write Adobe marker to flag RGB */</span>
<span class="normal">    cinfo</span><span class="symbol">-&gt;</span><span class="normal">num_components </span><span class="symbol">=</span><span class="normal"> </span><span class="number">3</span><span class="symbol">;</span>
<span class="normal">    </span><span class="function">SET_COMP</span><span class="symbol">(</span><span class="number">0</span><span class="symbol">,</span><span class="normal"> </span><span class="number">0x52</span><span class="normal"> </span><span class="comment">/* 'R' */</span><span class="symbol">,</span><span class="normal"> </span><span class="number">1</span><span class="symbol">,</span><span class="number">1</span><span class="symbol">,</span><span class="normal"> </span><span class="number">0</span><span class="symbol">,</span><span class="normal"> </span><span class="number">0</span><span class="symbol">,</span><span class="number">0</span><span class="symbol">);</span>
<span class="normal">    </span><span class="function">SET_COMP</span><span class="symbol">(</span><span class="number">1</span><span class="symbol">,</span><span class="normal"> </span><span class="number">0x47</span><span class="normal"> </span><span class="comment">/* 'G' */</span><span class="symbol">,</span><span class="normal"> </span><span class="number">1</span><span class="symbol">,</span><span class="number">1</span><span class="symbol">,</span><span class="normal"> </span><span class="number">0</span><span class="symbol">,</span><span class="normal"> </span><span class="number">0</span><span class="symbol">,</span><span class="number">0</span><span class="symbol">);</span>
<span class="normal">    </span><span class="function">SET_COMP</span><span class="symbol">(</span><span class="number">2</span><span class="symbol">,</span><span class="normal"> </span><span class="number">0x42</span><span class="normal"> </span><span class="comment">/* 'B' */</span><span class="symbol">,</span><span class="normal"> </span><span class="number">1</span><span class="symbol">,</span><span class="number">1</span><span class="symbol">,</span><span class="normal"> </span><span class="number">0</span><span class="symbol">,</span><span class="normal"> </span><span class="number">0</span><span class="symbol">,</span><span class="number">0</span><span class="symbol">);</span>
<span class="normal">    </span><span class="keyword">break</span><span class="symbol">;</span>
<span class="normal">  </span><span class="keyword">case</span><span class="normal"> JCS_YCbCr</span><span class="symbol">:</span>
<span class="normal">    cinfo</span><span class="symbol">-&gt;</span><span class="normal">write_JFIF_header </span><span class="symbol">=</span><span class="normal"> TRUE</span><span class="symbol">;</span><span class="normal"> </span><span class="comment">/* Write a JFIF marker */</span>
<span class="normal">    cinfo</span><span class="symbol">-&gt;</span><span class="normal">num_components </span><span class="symbol">=</span><span class="normal"> </span><span class="number">3</span><span class="symbol">;</span>
<span class="normal">    </span><span class="comment">/* JFIF specifies component IDs 1,2,3 */</span>
<span class="normal">    </span><span class="comment">/* We default to 2x2 subsamples of chrominance */</span>
<span class="normal">    </span><span class="function">SET_COMP</span><span class="symbol">(</span><span class="number">0</span><span class="symbol">,</span><span class="normal"> </span><span class="number">1</span><span class="symbol">,</span><span class="normal"> </span><span class="number">2</span><span class="symbol">,</span><span class="number">2</span><span class="symbol">,</span><span class="normal"> </span><span class="number">0</span><span class="symbol">,</span><span class="normal"> </span><span class="number">0</span><span class="symbol">,</span><span class="number">0</span><span class="symbol">);</span>
<span class="normal">    </span><span class="function">SET_COMP</span><span class="symbol">(</span><span class="number">1</span><span class="symbol">,</span><span class="normal"> </span><span class="number">2</span><span class="symbol">,</span><span class="normal"> </span><span class="number">1</span><span class="symbol">,</span><span class="number">1</span><span class="symbol">,</span><span class="normal"> </span><span class="number">1</span><span class="symbol">,</span><span class="normal"> </span><span class="number">1</span><span class="symbol">,</span><span class="number">1</span><span class="symbol">);</span>
<span class="normal">    </span><span class="function">SET_COMP</span><span class="symbol">(</span><span class="number">2</span><span class="symbol">,</span><span class="normal"> </span><span class="number">3</span><span class="symbol">,</span><span class="normal"> </span><span class="number">1</span><span class="symbol">,</span><span class="number">1</span><span class="symbol">,</span><span class="normal"> </span><span class="number">1</span><span class="symbol">,</span><span class="normal"> </span><span class="number">1</span><span class="symbol">,</span><span class="number">1</span><span class="symbol">);</span>
<span class="normal">    </span><span class="keyword">break</span><span class="symbol">;</span>
<span class="normal">  </span><span class="keyword">case</span><span class="normal"> JCS_CMYK</span><span class="symbol">:</span>
<span class="normal">    cinfo</span><span class="symbol">-&gt;</span><span class="normal">write_Adobe_marker </span><span class="symbol">=</span><span class="normal"> TRUE</span><span class="symbol">;</span><span class="normal"> </span><span class="comment">/* write Adobe marker to flag CMYK */</span>
<span class="normal">    cinfo</span><span class="symbol">-&gt;</span><span class="normal">num_components </span><span class="symbol">=</span><span class="normal"> </span><span class="number">4</span><span class="symbol">;</span>
<span class="normal">    </span><span class="function">SET_COMP</span><span class="symbol">(</span><span class="number">0</span><span class="symbol">,</span><span class="normal"> </span><span class="number">0x43</span><span class="normal"> </span><span class="comment">/* 'C' */</span><span class="symbol">,</span><span class="normal"> </span><span class="number">1</span><span class="symbol">,</span><span class="number">1</span><span class="symbol">,</span><span class="normal"> </span><span class="number">0</span><span class="symbol">,</span><span class="normal"> </span><span class="number">0</span><span class="symbol">,</span><span class="number">0</span><span class="symbol">);</span>
<span class="normal">    </span><span class="function">SET_COMP</span><span class="symbol">(</span><span class="number">1</span><span class="symbol">,</span><span class="normal"> </span><span class="number">0x4D</span><span class="normal"> </span><span class="comment">/* 'M' */</span><span class="symbol">,</span><span class="normal"> </span><span class="number">1</span><span class="symbol">,</span><span class="number">1</span><span class="symbol">,</span><span class="normal"> </span><span class="number">0</span><span class="symbol">,</span><span class="normal"> </span><span class="number">0</span><span class="symbol">,</span><span class="number">0</span><span class="symbol">);</span>
<span class="normal">    </span><span class="function">SET_COMP</span><span class="symbol">(</span><span class="number">2</span><span class="symbol">,</span><span class="normal"> </span><span class="number">0x59</span><span class="normal"> </span><span class="comment">/* 'Y' */</span><span class="symbol">,</span><span class="normal"> </span><span class="number">1</span><span class="symbol">,</span><span class="number">1</span><span class="symbol">,</span><span class="normal"> </span><span class="number">0</span><span class="symbol">,</span><span class="normal"> </span><span class="number">0</span><span class="symbol">,</span><span class="number">0</span><span class="symbol">);</span>
<span class="normal">    </span><span class="function">SET_COMP</span><span class="symbol">(</span><span class="number">3</span><span class="symbol">,</span><span class="normal"> </span><span class="number">0x4B</span><span class="normal"> </span><span class="comment">/* 'K' */</span><span class="symbol">,</span><span class="normal"> </span><span class="number">1</span><span class="symbol">,</span><span class="number">1</span><span class="symbol">,</span><span class="normal"> </span><span class="number">0</span><span class="symbol">,</span><span class="normal"> </span><span class="number">0</span><span class="symbol">,</span><span class="number">0</span><span class="symbol">);</span>
<span class="normal">    </span><span class="keyword">break</span><span class="symbol">;</span>
<span class="normal">  </span><span class="keyword">case</span><span class="normal"> JCS_YCCK</span><span class="symbol">:</span>
<span class="normal">    cinfo</span><span class="symbol">-&gt;</span><span class="normal">write_Adobe_marker </span><span class="symbol">=</span><span class="normal"> TRUE</span><span class="symbol">;</span><span class="normal"> </span><span class="comment">/* write Adobe marker to flag YCCK */</span>
<span class="normal">    cinfo</span><span class="symbol">-&gt;</span><span class="normal">num_components </span><span class="symbol">=</span><span class="normal"> </span><span class="number">4</span><span class="symbol">;</span>
<span class="normal">    </span><span class="function">SET_COMP</span><span class="symbol">(</span><span class="number">0</span><span class="symbol">,</span><span class="normal"> </span><span class="number">1</span><span class="symbol">,</span><span class="normal"> </span><span class="number">2</span><span class="symbol">,</span><span class="number">2</span><span class="symbol">,</span><span class="normal"> </span><span class="number">0</span><span class="symbol">,</span><span class="normal"> </span><span class="number">0</span><span class="symbol">,</span><span class="number">0</span><span class="symbol">);</span>
<span class="normal">    </span><span class="function">SET_COMP</span><span class="symbol">(</span><span class="number">1</span><span class="symbol">,</span><span class="normal"> </span><span class="number">2</span><span class="symbol">,</span><span class="normal"> </span><span class="number">1</span><span class="symbol">,</span><span class="number">1</span><span class="symbol">,</span><span class="normal"> </span><span class="number">1</span><span class="symbol">,</span><span class="normal"> </span><span class="number">1</span><span class="symbol">,</span><span class="number">1</span><span class="symbol">);</span>
<span class="normal">    </span><span class="function">SET_COMP</span><span class="symbol">(</span><span class="number">2</span><span class="symbol">,</span><span class="normal"> </span><span class="number">3</span><span class="symbol">,</span><span class="normal"> </span><span class="number">1</span><span class="symbol">,</span><span class="number">1</span><span class="symbol">,</span><span class="normal"> </span><span class="number">1</span><span class="symbol">,</span><span class="normal"> </span><span class="number">1</span><span class="symbol">,</span><span class="number">1</span><span class="symbol">);</span>
<span class="normal">    </span><span class="function">SET_COMP</span><span class="symbol">(</span><span class="number">3</span><span class="symbol">,</span><span class="normal"> </span><span class="number">4</span><span class="symbol">,</span><span class="normal"> </span><span class="number">2</span><span class="symbol">,</span><span class="number">2</span><span class="symbol">,</span><span class="normal"> </span><span class="number">0</span><span class="symbol">,</span><span class="normal"> </span><span class="number">0</span><span class="symbol">,</span><span class="number">0</span><span class="symbol">);</span>
<span class="normal">    </span><span class="keyword">break</span><span class="symbol">;</span>
<span class="normal">  </span><span class="keyword">case</span><span class="normal"> JCS_UNKNOWN</span><span class="symbol">:</span>
<span class="normal">    cinfo</span><span class="symbol">-&gt;</span><span class="normal">num_components </span><span class="symbol">=</span><span class="normal"> cinfo</span><span class="symbol">-&gt;</span><span class="normal">input_components</span><span class="symbol">;</span>
<span class="normal">    </span><span class="keyword">if</span><span class="normal"> </span><span class="symbol">(</span><span class="normal">cinfo</span><span class="symbol">-&gt;</span><span class="normal">num_components </span><span class="symbol">&lt;</span><span class="normal"> </span><span class="number">1</span><span class="normal"> </span><span class="symbol">||</span><span class="normal"> cinfo</span><span class="symbol">-&gt;</span><span class="normal">num_components </span><span class="symbol">&gt;</span><span class="normal"> MAX_COMPONENTS</span><span class="symbol">)</span>
<span class="normal">      </span><span class="function">ERREXIT2</span><span class="symbol">(</span><span class="normal">cinfo</span><span class="symbol">,</span><span class="normal"> JERR_COMPONENT_COUNT</span><span class="symbol">,</span><span class="normal"> cinfo</span><span class="symbol">-&gt;</span><span class="normal">num_components</span><span class="symbol">,</span>
<span class="normal">	       MAX_COMPONENTS</span><span class="symbol">);</span>
<span class="normal">    </span><span class="keyword">for</span><span class="normal"> </span><span class="symbol">(</span><span class="normal">ci </span><span class="symbol">=</span><span class="normal"> </span><span class="number">0</span><span class="symbol">;</span><span class="normal"> ci </span><span class="symbol">&lt;</span><span class="normal"> cinfo</span><span class="symbol">-&gt;</span><span class="normal">num_components</span><span class="symbol">;</span><span class="normal"> ci</span><span class="symbol">++)</span><span class="normal"> </span><span class="cbracket">{</span>
<span class="normal">      </span><span class="function">SET_COMP</span><span class="symbol">(</span><span class="normal">ci</span><span class="symbol">,</span><span class="normal"> ci</span><span class="symbol">,</span><span class="normal"> </span><span class="number">1</span><span class="symbol">,</span><span class="number">1</span><span class="symbol">,</span><span class="normal"> </span><span class="number">0</span><span class="symbol">,</span><span class="normal"> </span><span class="number">0</span><span class="symbol">,</span><span class="number">0</span><span class="symbol">);</span>
<span class="normal">    </span><span class="cbracket">}</span>
<span class="normal">    </span><span class="keyword">break</span><span class="symbol">;</span>
<span class="label">  default:</span>
<span class="normal">    </span><span class="function">ERREXIT</span><span class="symbol">(</span><span class="normal">cinfo</span><span class="symbol">,</span><span class="normal"> JERR_BAD_J_COLORSPACE</span><span class="symbol">);</span>
<span class="normal">  </span><span class="cbracket">}</span>
<span class="cbracket">}</span>


<span class="preproc">#ifdef</span><span class="normal"> C_PROGRESSIVE_SUPPORTED</span>

<span class="function">LOCAL</span><span class="symbol">(</span><span class="normal">jpeg_scan_info </span><span class="symbol">*)</span>
<span class="function">fill_a_scan</span><span class="normal"> </span><span class="symbol">(</span><span class="normal">jpeg_scan_info </span><span class="symbol">*</span><span class="normal"> scanptr</span><span class="symbol">,</span><span class="normal"> </span><span class="type">int</span><span class="normal"> ci</span><span class="symbol">,</span>
<span class="normal">	     </span><span class="type">int</span><span class="normal"> Ss</span><span class="symbol">,</span><span class="normal"> </span><span class="type">int</span><span class="normal"> Se</span><span class="symbol">,</span><span class="normal"> </span><span class="type">int</span><span class="normal"> Ah</span><span class="symbol">,</span><span class="normal"> </span><span class="type">int</span><span class="normal"> Al</span><span class="symbol">)</span>
<span class="comment">/* Support routine: generate one scan for specified component */</span>
<span class="cbracket">{</span>
<span class="normal">  scanptr</span><span class="symbol">-&gt;</span><span class="normal">comps_in_scan </span><span class="symbol">=</span><span class="normal"> </span><span class="number">1</span><span class="symbol">;</span>
<span class="normal">  scanptr</span><span class="symbol">-&gt;</span><span class="normal">component_index</span><span class="symbol">[</span><span class="number">0</span><span class="symbol">]</span><span class="normal"> </span><span class="symbol">=</span><span class="normal"> ci</span><span class="symbol">;</span>
<span class="normal">  scanptr</span><span class="symbol">-&gt;</span><span class="normal">Ss </span><span class="symbol">=</span><span class="normal"> Ss</span><span class="symbol">;</span>
<span class="normal">  scanptr</span><span class="symbol">-&gt;</span><span class="normal">Se </span><span class="symbol">=</span><span class="normal"> Se</span><span class="symbol">;</span>
<span class="normal">  scanptr</span><span class="symbol">-&gt;</span><span class="normal">Ah </span><span class="symbol">=</span><span class="normal"> Ah</span><span class="symbol">;</span>
<span class="normal">  scanptr</span><span class="symbol">-&gt;</span><span class="normal">Al </span><span class="symbol">=</span><span class="normal"> Al</span><span class="symbol">;</span>
<span class="normal">  scanptr</span><span class="symbol">++;</span>
<span class="normal">  </span><span class="keyword">return</span><span class="normal"> scanptr</span><span class="symbol">;</span>
<span class="cbracket">}</span>

<span class="function">LOCAL</span><span class="symbol">(</span><span class="normal">jpeg_scan_info </span><span class="symbol">*)</span>
<span class="function">fill_scans</span><span class="normal"> </span><span class="symbol">(</span><span class="normal">jpeg_scan_info </span><span class="symbol">*</span><span class="normal"> scanptr</span><span class="symbol">,</span><span class="normal"> </span><span class="type">int</span><span class="normal"> ncomps</span><span class="symbol">,</span>
<span class="normal">	    </span><span class="type">int</span><span class="normal"> Ss</span><span class="symbol">,</span><span class="normal"> </span><span class="type">int</span><span class="normal"> Se</span><span class="symbol">,</span><span class="normal"> </span><span class="type">int</span><span class="normal"> Ah</span><span class="symbol">,</span><span class="normal"> </span><span class="type">int</span><span class="normal"> Al</span><span class="symbol">)</span>
<span class="comment">/* Support routine: generate one scan for each component */</span>
<span class="cbracket">{</span>
<span class="normal">  </span><span class="type">int</span><span class="normal"> ci</span><span class="symbol">;</span>

<span class="normal">  </span><span class="keyword">for</span><span class="normal"> </span><span class="symbol">(</span><span class="normal">ci </span><span class="symbol">=</span><span class="normal"> </span><span class="number">0</span><span class="symbol">;</span><span class="normal"> ci </span><span class="symbol">&lt;</span><span class="normal"> ncomps</span><span class="symbol">;</span><span class="normal"> ci</span><span class="symbol">++)</span><span class="normal"> </span><span class="cbracket">{</span>
<span class="normal">    scanptr</span><span class="symbol">-&gt;</span><span class="normal">comps_in_scan </span><span class="symbol">=</span><span class="normal"> </span><span class="number">1</span><span class="symbol">;</span>
<span class="normal">    scanptr</span><span class="symbol">-&gt;</span><span class="normal">component_index</span><span class="symbol">[</span><span class="number">0</span><span class="symbol">]</span><span class="normal"> </span><span class="symbol">=</span><span class="normal"> ci</span><span class="symbol">;</span>
<span class="normal">    scanptr</span><span class="symbol">-&gt;</span><span class="normal">Ss </span><span class="symbol">=</span><span class="normal"> Ss</span><span class="symbol">;</span>
<span class="normal">    scanptr</span><span class="symbol">-&gt;</span><span class="normal">Se </span><span class="symbol">=</span><span class="normal"> Se</span><span class="symbol">;</span>
<span class="normal">    scanptr</span><span class="symbol">-&gt;</span><span class="normal">Ah </span><span class="symbol">=</span><span class="normal"> Ah</span><span class="symbol">;</span>
<span class="normal">    scanptr</span><span class="symbol">-&gt;</span><span class="normal">Al </span><span class="symbol">=</span><span class="normal"> Al</span><span class="symbol">;</span>
<span class="normal">    scanptr</span><span class="symbol">++;</span>
<span class="normal">  </span><span class="cbracket">}</span>
<span class="normal">  </span><span class="keyword">return</span><span class="normal"> scanptr</span><span class="symbol">;</span>
<span class="cbracket">}</span>

<span class="function">LOCAL</span><span class="symbol">(</span><span class="normal">jpeg_scan_info </span><span class="symbol">*)</span>
<span class="function">fill_dc_scans</span><span class="normal"> </span><span class="symbol">(</span><span class="normal">jpeg_scan_info </span><span class="symbol">*</span><span class="normal"> scanptr</span><span class="symbol">,</span><span class="normal"> </span><span class="type">int</span><span class="normal"> ncomps</span><span class="symbol">,</span><span class="normal"> </span><span class="type">int</span><span class="normal"> Ah</span><span class="symbol">,</span><span class="normal"> </span><span class="type">int</span><span class="normal"> Al</span><span class="symbol">)</span>
<span class="comment">/* Support routine: generate interleaved DC scan if possible, else N scans */</span>
<span class="cbracket">{</span>
<span class="normal">  </span><span class="type">int</span><span class="normal"> ci</span><span class="symbol">;</span>

<span class="normal">  </span><span class="keyword">if</span><span class="normal"> </span><span class="symbol">(</span><span class="normal">ncomps </span><span class="symbol">&lt;=</span><span class="normal"> MAX_COMPS_IN_SCAN</span><span class="symbol">)</span><span class="normal"> </span><span class="cbracket">{</span>
<span class="normal">    </span><span class="comment">/* Single interleaved DC scan */</span>
<span class="normal">    scanptr</span><span class="symbol">-&gt;</span><span class="normal">comps_in_scan </span><span class="symbol">=</span><span class="normal"> ncomps</span><span class="symbol">;</span>
<span class="normal">    </span><span class="keyword">for</span><span class="normal"> </span><span class="symbol">(</span><span class="normal">ci </span><span class="symbol">=</span><span class="normal"> </span><span class="number">0</span><span class="symbol">;</span><span class="normal"> ci </span><span class="symbol">&lt;</span><span class="normal"> ncomps</span><span class="symbol">;</span><span class="normal"> ci</span><span class="symbol">++)</span>
<span class="normal">      scanptr</span><span class="symbol">-&gt;</span><span class="normal">component_index</span><span class="symbol">[</span><span class="normal">ci</span><span class="symbol">]</span><span class="normal"> </span><span class="symbol">=</span><span class="normal"> ci</span><span class="symbol">;</span>
<span class="normal">    scanptr</span><span class="symbol">-&gt;</span><span class="normal">Ss </span><span class="symbol">=</span><span class="normal"> scanptr</span><span class="symbol">-&gt;</span><span class="normal">Se </span><span class="symbol">=</span><span class="normal"> </span><span class="number">0</span><span class="symbol">;</span>
<span class="normal">    scanptr</span><span class="symbol">-&gt;</span><span class="normal">Ah </span><span class="symbol">=</span><span class="normal"> Ah</span><span class="symbol">;</span>
<span class="normal">    scanptr</span><span class="symbol">-&gt;</span><span class="normal">Al </span><span class="symbol">=</span><span class="normal"> Al</span><span class="symbol">;</span>
<span class="normal">    scanptr</span><span class="symbol">++;</span>
<span class="normal">  </span><span class="cbracket">}</span><span class="normal"> </span><span class="keyword">else</span><span class="normal"> </span><span class="cbracket">{</span>
<span class="normal">    </span><span class="comment">/* Noninterleaved DC scan for each component */</span>
<span class="normal">    scanptr </span><span class="symbol">=</span><span class="normal"> </span><span class="function">fill_scans</span><span class="symbol">(</span><span class="normal">scanptr</span><span class="symbol">,</span><span class="normal"> ncomps</span><span class="symbol">,</span><span class="normal"> </span><span class="number">0</span><span class="symbol">,</span><span class="normal"> </span><span class="number">0</span><span class="symbol">,</span><span class="normal"> Ah</span><span class="symbol">,</span><span class="normal"> Al</span><span class="symbol">);</span>
<span class="normal">  </span><span class="cbracket">}</span>
<span class="normal">  </span><span class="keyword">return</span><span class="normal"> scanptr</span><span class="symbol">;</span>
<span class="cbracket">}</span>


<span class="comment">/*</span>
<span class="comment"> * Create a recommended progressive-JPEG script.</span>
<span class="comment"> * cinfo-&gt;num_components and cinfo-&gt;jpeg_color_space must be correct.</span>
<span class="comment"> */</span>

<span class="function">GLOBAL</span><span class="symbol">(</span><span class="type">void</span><span class="symbol">)</span>
<span class="function">jpeg_simple_progression</span><span class="normal"> </span><span class="symbol">(</span><span class="usertype">j_compress_ptr</span><span class="normal"> cinfo</span><span class="symbol">)</span>
<span class="cbracket">{</span>
<span class="normal">  </span><span class="type">int</span><span class="normal"> ncomps </span><span class="symbol">=</span><span class="normal"> cinfo</span><span class="symbol">-&gt;</span><span class="normal">num_components</span><span class="symbol">;</span>
<span class="normal">  </span><span class="type">int</span><span class="normal"> nscans</span><span class="symbol">;</span>
<span class="normal">  jpeg_scan_info </span><span class="symbol">*</span><span class="normal"> scanptr</span><span class="symbol">;</span>

<span class="normal">  </span><span class="comment">/* Safety check to ensure start_compress not called yet. */</span>
<span class="normal">  </span><span class="keyword">if</span><span class="normal"> </span><span class="symbol">(</span><span class="normal">cinfo</span><span class="symbol">-&gt;</span><span class="normal">global_state </span><span class="symbol">!=</span><span class="normal"> CSTATE_START</span><span class="symbol">)</span>
<span class="normal">    </span><span class="function">ERREXIT1</span><span class="symbol">(</span><span class="normal">cinfo</span><span class="symbol">,</span><span class="normal"> JERR_BAD_STATE</span><span class="symbol">,</span><span class="normal"> cinfo</span><span class="symbol">-&gt;</span><span class="normal">global_state</span><span class="symbol">);</span>

<span class="normal">  </span><span class="comment">/* Figure space needed for script.  Calculation must match code below! */</span>
<span class="normal">  </span><span class="keyword">if</span><span class="normal"> </span><span class="symbol">(</span><span class="normal">ncomps </span><span class="symbol">==</span><span class="normal"> </span><span class="number">3</span><span class="normal"> </span><span class="symbol">&amp;&amp;</span><span class="normal"> cinfo</span><span class="symbol">-&gt;</span><span class="normal">jpeg_color_space </span><span class="symbol">==</span><span class="normal"> JCS_YCbCr</span><span class="symbol">)</span><span class="normal"> </span><span class="cbracket">{</span>
<span class="normal">    </span><span class="comment">/* Custom script for YCbCr color images. */</span>
<span class="normal">    nscans </span><span class="symbol">=</span><span class="normal"> </span><span class="number">10</span><span class="symbol">;</span>
<span class="normal">  </span><span class="cbracket">}</span><span class="normal"> </span><span class="keyword">else</span><span class="normal"> </span><span class="cbracket">{</span>
<span class="normal">    </span><span class="comment">/* All-purpose script for other color spaces. */</span>
<span class="normal">    </span><span class="keyword">if</span><span class="normal"> </span><span class="symbol">(</span><span class="normal">ncomps </span><span class="symbol">&gt;</span><span class="normal"> MAX_COMPS_IN_SCAN</span><span class="symbol">)</span>
<span class="normal">      nscans </span><span class="symbol">=</span><span class="normal"> </span><span class="number">6</span><span class="normal"> </span><span class="symbol">*</span><span class="normal"> ncomps</span><span class="symbol">;</span><span class="normal">	</span><span class="comment">/* 2 DC + 4 AC scans per component */</span>
<span class="normal">    </span><span class="keyword">else</span>
<span class="normal">      nscans </span><span class="symbol">=</span><span class="normal"> </span><span class="number">2</span><span class="normal"> </span><span class="symbol">+</span><span class="normal"> </span><span class="number">4</span><span class="normal"> </span><span class="symbol">*</span><span class="normal"> ncomps</span><span class="symbol">;</span><span class="normal">	</span><span class="comment">/* 2 DC scans; 4 AC scans per component */</span>
<span class="normal">  </span><span class="cbracket">}</span>

<span class="normal">  </span><span class="comment">/* Allocate space for script.</span>
<span class="comment">   * We need to put it in the permanent pool in case the application performs</span>
<span class="comment">   * multiple compressions without changing the settings.  To avoid a memory</span>
<span class="comment">   * leak if jpeg_simple_progression is called repeatedly for the same JPEG</span>
<span class="comment">   * object, we try to re-use previously allocated space, and we allocate</span>
<span class="comment">   * enough space to handle YCbCr even if initially asked for grayscale.</span>
<span class="comment">   */</span>
<span class="normal">  </span><span class="keyword">if</span><span class="normal"> </span><span class="symbol">(</span><span class="normal">cinfo</span><span class="symbol">-&gt;</span><span class="normal">script_space </span><span class="symbol">==</span><span class="normal"> NULL </span><span class="symbol">||</span><span class="normal"> cinfo</span><span class="symbol">-&gt;</span><span class="normal">script_space_size </span><span class="symbol">&lt;</span><span class="normal"> nscans</span><span class="symbol">)</span><span class="normal"> </span><span class="cbracket">{</span>
<span class="normal">    cinfo</span><span class="symbol">-&gt;</span><span class="normal">script_space_size </span><span class="symbol">=</span><span class="normal"> </span><span class="function">MAX</span><span class="symbol">(</span><span class="normal">nscans</span><span class="symbol">,</span><span class="normal"> </span><span class="number">10</span><span class="symbol">);</span>
<span class="normal">    cinfo</span><span class="symbol">-&gt;</span><span class="normal">script_space </span><span class="symbol">=</span><span class="normal"> </span><span class="symbol">(</span><span class="normal">jpeg_scan_info </span><span class="symbol">*)</span>
<span class="normal">      </span><span class="symbol">(*</span><span class="normal">cinfo</span><span class="symbol">-&gt;</span><span class="normal">mem</span><span class="symbol">-&gt;</span><span class="normal">alloc_small</span><span class="symbol">)</span><span class="normal"> </span><span class="symbol">((</span><span class="normal">j_common_ptr</span><span class="symbol">)</span><span class="normal"> cinfo</span><span class="symbol">,</span><span class="normal"> JPOOL_PERMANENT</span><span class="symbol">,</span>
<span class="normal">			cinfo</span><span class="symbol">-&gt;</span><span class="normal">script_space_size </span><span class="symbol">*</span><span class="normal"> </span><span class="function">SIZEOF</span><span class="symbol">(</span><span class="normal">jpeg_scan_info</span><span class="symbol">));</span>
<span class="normal">  </span><span class="cbracket">}</span>
<span class="normal">  scanptr </span><span class="symbol">=</span><span class="normal"> cinfo</span><span class="symbol">-&gt;</span><span class="normal">script_space</span><span class="symbol">;</span>
<span class="normal">  cinfo</span><span class="symbol">-&gt;</span><span class="normal">scan_info </span><span class="symbol">=</span><span class="normal"> scanptr</span><span class="symbol">;</span>
<span class="normal">  cinfo</span><span class="symbol">-&gt;</span><span class="normal">num_scans </span><span class="symbol">=</span><span class="normal"> nscans</span><span class="symbol">;</span>

<span class="normal">  </span><span class="keyword">if</span><span class="normal"> </span><span class="symbol">(</span><span class="normal">ncomps </span><span class="symbol">==</span><span class="normal"> </span><span class="number">3</span><span class="normal"> </span><span class="symbol">&amp;&amp;</span><span class="normal"> cinfo</span><span class="symbol">-&gt;</span><span class="normal">jpeg_color_space </span><span class="symbol">==</span><span class="normal"> JCS_YCbCr</span><span class="symbol">)</span><span class="normal"> </span><span class="cbracket">{</span>
<span class="normal">    </span><span class="comment">/* Custom script for YCbCr color images. */</span>
<span class="normal">    </span><span class="comment">/* Initial DC scan */</span>
<span class="normal">    scanptr </span><span class="symbol">=</span><span class="normal"> </span><span class="function">fill_dc_scans</span><span class="symbol">(</span><span class="normal">scanptr</span><span class="symbol">,</span><span class="normal"> ncomps</span><span class="symbol">,</span><span class="normal"> </span><span class="number">0</span><span class="symbol">,</span><span class="normal"> </span><span class="number">1</span><span class="symbol">);</span>
<span class="normal">    </span><span class="comment">/* Initial AC scan: get some luma data out in a hurry */</span>
<span class="normal">    scanptr </span><span class="symbol">=</span><span class="normal"> </span><span class="function">fill_a_scan</span><span class="symbol">(</span><span class="normal">scanptr</span><span class="symbol">,</span><span class="normal"> </span><span class="number">0</span><span class="symbol">,</span><span class="normal"> </span><span class="number">1</span><span class="symbol">,</span><span class="normal"> </span><span class="number">5</span><span class="symbol">,</span><span class="normal"> </span><span class="number">0</span><span class="symbol">,</span><span class="normal"> </span><span class="number">2</span><span class="symbol">);</span>
<span class="normal">    </span><span class="comment">/* Chroma data is too small to be worth expending many scans on */</span>
<span class="normal">    scanptr </span><span class="symbol">=</span><span class="normal"> </span><span class="function">fill_a_scan</span><span class="symbol">(</span><span class="normal">scanptr</span><span class="symbol">,</span><span class="normal"> </span><span class="number">2</span><span class="symbol">,</span><span class="normal"> </span><span class="number">1</span><span class="symbol">,</span><span class="normal"> </span><span class="number">63</span><span class="symbol">,</span><span class="normal"> </span><span class="number">0</span><span class="symbol">,</span><span class="normal"> </span><span class="number">1</span><span class="symbol">);</span>
<span class="normal">    scanptr </span><span class="symbol">=</span><span class="normal"> </span><span class="function">fill_a_scan</span><span class="symbol">(</span><span class="normal">scanptr</span><span class="symbol">,</span><span class="normal"> </span><span class="number">1</span><span class="symbol">,</span><span class="normal"> </span><span class="number">1</span><span class="symbol">,</span><span class="normal"> </span><span class="number">63</span><span class="symbol">,</span><span class="normal"> </span><span class="number">0</span><span class="symbol">,</span><span class="normal"> </span><span class="number">1</span><span class="symbol">);</span>
<span class="normal">    </span><span class="comment">/* Complete spectral selection for luma AC */</span>
<span class="normal">    scanptr </span><span class="symbol">=</span><span class="normal"> </span><span class="function">fill_a_scan</span><span class="symbol">(</span><span class="normal">scanptr</span><span class="symbol">,</span><span class="normal"> </span><span class="number">0</span><span class="symbol">,</span><span class="normal"> </span><span class="number">6</span><span class="symbol">,</span><span class="normal"> </span><span class="number">63</span><span class="symbol">,</span><span class="normal"> </span><span class="number">0</span><span class="symbol">,</span><span class="normal"> </span><span class="number">2</span><span class="symbol">);</span>
<span class="normal">    </span><span class="comment">/* Refine next bit of luma AC */</span>
<span class="normal">    scanptr </span><span class="symbol">=</span><span class="normal"> </span><span class="function">fill_a_scan</span><span class="symbol">(</span><span class="normal">scanptr</span><span class="symbol">,</span><span class="normal"> </span><span class="number">0</span><span class="symbol">,</span><span class="normal"> </span><span class="number">1</span><span class="symbol">,</span><span class="normal"> </span><span class="number">63</span><span class="symbol">,</span><span class="normal"> </span><span class="number">2</span><span class="symbol">,</span><span class="normal"> </span><span class="number">1</span><span class="symbol">);</span>
<span class="normal">    </span><span class="comment">/* Finish DC successive approximation */</span>
<span class="normal">    scanptr </span><span class="symbol">=</span><span class="normal"> </span><span class="function">fill_dc_scans</span><span class="symbol">(</span><span class="normal">scanptr</span><span class="symbol">,</span><span class="normal"> ncomps</span><span class="symbol">,</span><span class="normal"> </span><span class="number">1</span><span class="symbol">,</span><span class="normal"> </span><span class="number">0</span><span class="symbol">);</span>
<span class="normal">    </span><span class="comment">/* Finish AC successive approximation */</span>
<span class="normal">    scanptr </span><span class="symbol">=</span><span class="normal"> </span><span class="function">fill_a_scan</span><span class="symbol">(</span><span class="normal">scanptr</span><span class="symbol">,</span><span class="normal"> </span><span class="number">2</span><span class="symbol">,</span><span class="normal"> </span><span class="number">1</span><span class="symbol">,</span><span class="normal"> </span><span class="number">63</span><span class="symbol">,</span><span class="normal"> </span><span class="number">1</span><span class="symbol">,</span><span class="normal"> </span><span class="number">0</span><span class="symbol">);</span>
<span class="normal">    scanptr </span><span class="symbol">=</span><span class="normal"> </span><span class="function">fill_a_scan</span><span class="symbol">(</span><span class="normal">scanptr</span><span class="symbol">,</span><span class="normal"> </span><span class="number">1</span><span class="symbol">,</span><span class="normal"> </span><span class="number">1</span><span class="symbol">,</span><span class="normal"> </span><span class="number">63</span><span class="symbol">,</span><span class="normal"> </span><span class="number">1</span><span class="symbol">,</span><span class="normal"> </span><span class="number">0</span><span class="symbol">);</span>
<span class="normal">    </span><span class="comment">/* Luma bottom bit comes last since it's usually largest scan */</span>
<span class="normal">    scanptr </span><span class="symbol">=</span><span class="normal"> </span><span class="function">fill_a_scan</span><span class="symbol">(</span><span class="normal">scanptr</span><span class="symbol">,</span><span class="normal"> </span><span class="number">0</span><span class="symbol">,</span><span class="normal"> </span><span class="number">1</span><span class="symbol">,</span><span class="normal"> </span><span class="number">63</span><span class="symbol">,</span><span class="normal"> </span><span class="number">1</span><span class="symbol">,</span><span class="normal"> </span><span class="number">0</span><span class="symbol">);</span>
<span class="normal">  </span><span class="cbracket">}</span><span class="normal"> </span><span class="keyword">else</span><span class="normal"> </span><span class="cbracket">{</span>
<span class="normal">    </span><span class="comment">/* All-purpose script for other color spaces. */</span>
<span class="normal">    </span><span class="comment">/* Successive approximation first pass */</span>
<span class="normal">    scanptr </span><span class="symbol">=</span><span class="normal"> </span><span class="function">fill_dc_scans</span><span class="symbol">(</span><span class="normal">scanptr</span><span class="symbol">,</span><span class="normal"> ncomps</span><span class="symbol">,</span><span class="normal"> </span><span class="number">0</span><span class="symbol">,</span><span class="normal"> </span><span class="number">1</span><span class="symbol">);</span>
<span class="normal">    scanptr </span><span class="symbol">=</span><span class="normal"> </span><span class="function">fill_scans</span><span class="symbol">(</span><span class="normal">scanptr</span><span class="symbol">,</span><span class="normal"> ncomps</span><span class="symbol">,</span><span class="normal"> </span><span class="number">1</span><span class="symbol">,</span><span class="normal"> </span><span class="number">5</span><span class="symbol">,</span><span class="normal"> </span><span class="number">0</span><span class="symbol">,</span><span class="normal"> </span><span class="number">2</span><span class="symbol">);</span>
<span class="normal">    scanptr </span><span class="symbol">=</span><span class="normal"> </span><span class="function">fill_scans</span><span class="symbol">(</span><span class="normal">scanptr</span><span class="symbol">,</span><span class="normal"> ncomps</span><span class="symbol">,</span><span class="normal"> </span><span class="number">6</span><span class="symbol">,</span><span class="normal"> </span><span class="number">63</span><span class="symbol">,</span><span class="normal"> </span><span class="number">0</span><span class="symbol">,</span><span class="normal"> </span><span class="number">2</span><span class="symbol">);</span>
<span class="normal">    </span><span class="comment">/* Successive approximation second pass */</span>
<span class="normal">    scanptr </span><span class="symbol">=</span><span class="normal"> </span><span class="function">fill_scans</span><span class="symbol">(</span><span class="normal">scanptr</span><span class="symbol">,</span><span class="normal"> ncomps</span><span class="symbol">,</span><span class="normal"> </span><span class="number">1</span><span class="symbol">,</span><span class="normal"> </span><span class="number">63</span><span class="symbol">,</span><span class="normal"> </span><span class="number">2</span><span class="symbol">,</span><span class="normal"> </span><span class="number">1</span><span class="symbol">);</span>
<span class="normal">    </span><span class="comment">/* Successive approximation final pass */</span>
<span class="normal">    scanptr </span><span class="symbol">=</span><span class="normal"> </span><span class="function">fill_dc_scans</span><span class="symbol">(</span><span class="normal">scanptr</span><span class="symbol">,</span><span class="normal"> ncomps</span><span class="symbol">,</span><span class="normal"> </span><span class="number">1</span><span class="symbol">,</span><span class="normal"> </span><span class="number">0</span><span class="symbol">);</span>
<span class="normal">    scanptr </span><span class="symbol">=</span><span class="normal"> </span><span class="function">fill_scans</span><span class="symbol">(</span><span class="normal">scanptr</span><span class="symbol">,</span><span class="normal"> ncomps</span><span class="symbol">,</span><span class="normal"> </span><span class="number">1</span><span class="symbol">,</span><span class="normal"> </span><span class="number">63</span><span class="symbol">,</span><span class="normal"> </span><span class="number">1</span><span class="symbol">,</span><span class="normal"> </span><span class="number">0</span><span class="symbol">);</span>
<span class="normal">  </span><span class="cbracket">}</span>
<span class="cbracket">}</span>

<span class="preproc">#endif</span><span class="normal"> </span><span class="comment">/* C_PROGRESSIVE_SUPPORTED */</span>
</tt></pre></div><div style="text-align: right; padding: 8pt; font-size: 12px"><a href="/xmlfeed/weblog-rss20.xml"><img src="/img/xmlfeed-rss20.png" alt="RSS 2.0 Weblog Feed" height="15" width="80" /></a> <a href="/xmlfeed/weblog-atom10.xml"><img src="/img/xmlfeed-atom10.png" alt="Atom 1.0 Weblog Feed" height="15" width="80" /></a> <a href="http://validator.w3.org/check?uri=referer"><img src="/img/w3c-xhtml10.png" alt="Valid XHTML 1.1" height="15" width="80" /></a> <a href="http://jigsaw.w3.org/css-validator/check/referer"><img src="/img/w3c-css.png" alt="Valid CSS (2.1)" height="15" width="80" /></a><br/>Copyright 2005-2013 <a href="/about/">Timo Bingmann</a> - <a href="/about/impressum.html">Impressum</a></div><script type="text/javascript">var _paq = _paq || []; _paq.push(["trackPageView"]); _paq.push(["enableLinkTracking"]);(function() {var u=(("https:" == document.location.protocol) ? "https" : "http") + "://panthema.net/wik-331/"; _paq.push(["setTrackerUrl", u+"js/"]); _paq.push(["setSiteId", "2"]);var d=document, g=d.createElement("script"), s=d.getElementsByTagName("script")[0]; g.type="text/javascript";g.defer=true; g.async=true; g.src=u+"js/"; s.parentNode.insertBefore(g,s);})();</script><noscript><p><img src="http://panthema.net/wik-331/js/?idsite=2&amp;rec=1" style="border:0" alt="" /></p></noscript></body></html>