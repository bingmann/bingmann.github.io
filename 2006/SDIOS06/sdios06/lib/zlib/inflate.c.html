<?xml version="1.0" encoding="iso-8859-1"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta content="text/html; charset=iso-8859-1" http-equiv="content-type" /><meta name="viewport" content="initial-scale=1"><title>/2006/SDIOS06/sdios06/lib/zlib/inflate.c - panthema.net</title><link rel="stylesheet" type="text/css" href="/css/base.css" /><link rel="stylesheet" type="text/css" href="/css/fonts.css" /><link rel="alternate" type="application/rss+xml" title="panthema.net Weblog Feed RSS 2.0" href="http://panthema.net/xmlfeed/weblog-rss20.xml" /><link rel="alternate" type="application/atom+xml" title="panthema.net Weblog Feed Atom 1.0" href="http://panthema.net/xmlfeed/weblog-atom10.xml" /><script type="text/javascript" src="/js/base.js"></script><script type="text/javascript">/* <!-- */makeIEHover = function() {var lis = document.getElementById('ptnav').getElementsByTagName('li');for (var i = 0; i < lis.length; i++) {lis[i].onmouseover = function() {this.className += ' sfhover';};lis[i].onmouseout = function() {this.className = this.className.replace(new RegExp(' sfhover\b'), '');};}};if (window.attachEvent) window.attachEvent('onload', makeIEHover);/* --> */</script></head><body style="background-image: url(/img/bgfractal2.jpg)" lang="en"><div class="pttopbar"><div style="float: right"><ul id="ptnav"><li class="top"><a class="ni" href="/"><i class="icon-book"></i> Weblog</a><ul style="margin-left: -6px; margin-top: 4px" class="nx"><li><a href="/2019/">2019</a></li><li><a href="/2018/">2018</a></li><li><a href="/2017/">2017</a></li><li><a href="/2016/">2016</a></li><li><a href="/2015/">2015</a></li><li><a href="/2014/">2014</a></li><li><a href="/2013/">2013</a></li><li><a href="/2012/">2012</a></li><li><a href="/2011/">2011</a></li><li><a href="/2010/">2010</a></li><li><a href="/2009/">2009</a></li><li><a href="/2008/">2008</a></li><li><a href="/2007/">2007</a></li><li><a href="/2006/">2006</a></li><li class="nt"><a href="/2005/">2005</a></li><li class="ns"><a href="/xmlfeed/weblog-rss20.xml">RSS Feed</a></li><li class="nt"><a href="/xmlfeed/weblog-atom10.xml">XML Atom</a></li><li class="ns"><a href="/search.html">Search</a></li></ul></li><li class="top"><a class="ni" href="/tags/"><i class="icon-tags"></i> Tags</a><div style="width: 14em; margin-left: -9em; margin-top: 4px"><a style="font-size: 10pt" href="/tags/algebra.html">algebra</a> <a style="font-size: 16pt" href="/tags/c++.html">c++</a> <a style="font-size: 12pt" href="/tags/code-example.html">code-example</a> <a style="font-size: 14pt" href="/tags/code-snippet.html">code-snippet</a> <a style="font-size: 11pt" href="/tags/coding_tricks.html">coding tricks</a> <a style="font-size: 10pt" href="/tags/compsci.html">compsci</a> <a style="font-size: 10pt" href="/tags/compsci_study_thesis.html">compsci study thesis</a> <a style="font-size: 9pt" href="/tags/crypto-speedtest.html">crypto-speedtest</a> <a style="font-size: 10pt" href="/tags/cryptography.html">cryptography</a> <a style="font-size: 9pt" href="/tags/cryptote.html">cryptote</a> <a style="font-size: 11pt" href="/tags/dissertation.html">dissertation</a> <a style="font-size: 12pt" href="/tags/flex-bison-cpp-example.html">flex-bison-cpp-example</a> <a style="font-size: 16pt" href="/tags/frontpage.html">frontpage</a> <a style="font-size: 15pt" href="/tags/fun.html">fun</a> <a style="font-size: 10pt" href="/tags/graphviz.html">graphviz</a> <a style="font-size: 9pt" href="http://www.hmtg.de">hartmetall</a> <a style="font-size: 9pt" href="/tags/helppc.html">helppc</a> <a style="font-size: 9pt" href="/tags/hifi_selbstbau.html">hifi selbstbau</a> <a style="font-size: 10pt" href="/tags/latex.html">latex</a> <a style="font-size: 10pt" href="/tags/librivox.html">librivox</a> <a style="font-size: 10pt" href="/tags/linux.html">linux</a> <a style="font-size: 9pt" href="/tags/market.html">market</a> <a style="font-size: 9pt" href="/tags/massive-sorting.html">massive-sorting</a> <a style="font-size: 11pt" href="/tags/maths.html">maths</a> <a style="font-size: 9pt" href="/tags/music.html">music</a> <a style="font-size: 10pt" href="/tags/netfundamentals.html">netfundamentals</a> <a style="font-size: 11pt" href="/tags/ns-3.html">ns-3</a> <a style="font-size: 10pt" href="/tags/parallel-string-sorting.html">parallel-string-sorting</a> <a style="font-size: 14pt" href="/tags/parsing.html">parsing</a> <a style="font-size: 9pt" href="/tags/qtsqlview.html">qtsqlview</a> <a style="font-size: 14pt" href="/tags/research.html">research</a> <a style="font-size: 11pt" href="/tags/sdios06.html">sdios06</a> <a style="font-size: 9pt" href="/tags/sdlfractal.html">sdlfractal</a> <a style="font-size: 14pt" href="/tags/sorting.html">sorting</a> <a style="font-size: 11pt" href="/tags/sound_of_sorting.html">sound of sorting</a> <a style="font-size: 10pt" href="/tags/stringology.html">stringology</a> <a style="font-size: 16pt" href="/tags/stx-btree.html">stx-btree</a> <a style="font-size: 16pt" href="/tags/stxxl.html">stxxl</a> <a style="font-size: 16pt" href="/tags/talk.html">talk</a> <a style="font-size: 15pt" href="/tags/thrill.html">thrill</a> <a style="font-size: 10pt" href="/tags/tutorium.html">tutorium</a> <a style="font-size: 16pt" href="/tags/university.html">university</a> <a style="font-size: 13pt" href="/tags/utilities.html">utilities</a> <a style="font-size: 10pt" href="/tags/vncrec.html">vncrec</a> <a style="font-size: 9pt" href="/tags/webdesign.html">webdesign</a> </div></li><li class="top"> <a class="ni" href="#"><i class="icon-cubes"></i> Projects</a> <ul style="margin-left: -8em; margin-top: 4px;" class="nx"> <li><a href="/2009/cryptote/">CryptoTE</a></li> <li><a href="/2009/digup/">digup</a></li> <li><a href="/2013/disk-filltest/">disk-filltest</a></li> <li><a href="/2012/1119-eSAIS-Inducing-Suffix-and-LCP-Arrays-in-External-Memory/">eSAIS-LCP</a></li> <li><a href="/2007/flex-bison-cpp-example/">Flex Bison C++ Example</a></li> <li><a href="/2013/malloc_count/">malloc_count</a></li> <li><a href="/2016/0114-diploma-thesis/">On Bispanning Graphs</a></li> <li><a href="/2013/pmbw/">Parallel Memory Bandwidth</a></li> <li><a href="/2013/parallel-string-sorting/">Parallel String Sorting</a></li> <li><a href="/2014/sqlplot-tools/">SqlPlotTools</a></li> <li><a href="/2013/sound-of-sorting/">The Sound of Sorting</a></li> <li><a href="/2007/stx-btree/">STX B+ Tree</a></li> <li><a href="/2010/stx-cbtreedb/">STX Constant BTreeDB</a></li> <li><a href="/2010/stx-execpipe/">STX ExecPipe</a></li> <li><a href="/2007/stx-exparser/">STX Expression Parser</a></li> <li><a href="/tags/stxxl.html">STXXL 1.4</a></li> <li><a href="/tags/thrill.html">Thrill - Big Data Framework</a></li> <li class="nt"><a href="/2014/vncrec-rgb/">VNCrec RGB 0.4</a></li> <li class="ns"><a href="/search.html">Search</a></li> </ul></li><li class="top"> <a class="ni" href="/publications.html"><i class="icon-graduation-cap"></i> Publications</a></li><li class="top"> <a class="ni" href="/about/"><i class="icon-info-circled"></i> About</a> <ul style="margin-left: -6em; margin-top: 4px" class="nx"> <li><a href="/about/">Timo Bingmann</a></li> <li><a href="/about/impressum.html">Impressum</a></li> </ul></li><li class="top"> <a class="ni" href="/subscribe.html"><i class="icon-rss-squared"></i> Subscribe</a></li></ul></div><div style="padding: 6px"><a href="/">panthema</a>  / <a href="/2006/">2006</a> / <a href="/2006/SDIOS06/">SDIOS06</a> / <a href="/2006/SDIOS06/sdios06/">sdios06</a> / <a href="/2006/SDIOS06/sdios06/lib/">lib</a> / <a href="/2006/SDIOS06/sdios06/lib/zlib/">zlib</a> / <a href="/2006/SDIOS06/sdios06/lib/zlib/inflate.c.html">inflate.c</a> (<a href="/2006/SDIOS06/sdios06/lib/zlib/inflate.c">Download File</a>)</div></div><div class="ptfullwidth"><pre class="codesnippet" style="font-family: monospace"><tt><span class="comment">/* inflate.c -- zlib decompression</span>
<span class="comment"> * Copyright (C) 1995-2005 Mark Adler</span>
<span class="comment"> * For conditions of distribution and use, see copyright notice in zlib.h</span>
<span class="comment"> */</span>

<span class="comment">/*</span>
<span class="comment"> * Change history:</span>
<span class="comment"> *</span>
<span class="comment"> * 1.2.beta0    24 Nov 2002</span>
<span class="comment"> * - First version -- complete rewrite of inflate to simplify code, avoid</span>
<span class="comment"> *   creation of window when not needed, minimize use of window when it is</span>
<span class="comment"> *   needed, make inffast.c even faster, implement gzip decoding, and to</span>
<span class="comment"> *   improve code readability and style over the previous zlib inflate code</span>
<span class="comment"> *</span>
<span class="comment"> * 1.2.beta1    25 Nov 2002</span>
<span class="comment"> * - Use pointers for available input and output checking in inffast.c</span>
<span class="comment"> * - Remove input and output counters in inffast.c</span>
<span class="comment"> * - Change inffast.c entry and loop from avail_in &gt;= 7 to &gt;= 6</span>
<span class="comment"> * - Remove unnecessary second byte pull from length extra in inffast.c</span>
<span class="comment"> * - Unroll direct copy to three copies per loop in inffast.c</span>
<span class="comment"> *</span>
<span class="comment"> * 1.2.beta2    4 Dec 2002</span>
<span class="comment"> * - Change external routine names to reduce potential conflicts</span>
<span class="comment"> * - Correct filename to inffixed.h for fixed tables in inflate.c</span>
<span class="comment"> * - Make hbuf[] unsigned char to match parameter type in inflate.c</span>
<span class="comment"> * - Change strm-&gt;next_out[-state-&gt;offset] to *(strm-&gt;next_out - state-&gt;offset)</span>
<span class="comment"> *   to avoid negation problem on Alphas (64 bit) in inflate.c</span>
<span class="comment"> *</span>
<span class="comment"> * 1.2.beta3    22 Dec 2002</span>
<span class="comment"> * - Add comments on state-&gt;bits assertion in inffast.c</span>
<span class="comment"> * - Add comments on op field in inftrees.h</span>
<span class="comment"> * - Fix bug in reuse of allocated window after inflateReset()</span>
<span class="comment"> * - Remove bit fields--back to byte structure for speed</span>
<span class="comment"> * - Remove distance extra == 0 check in inflate_fast()--only helps for lengths</span>
<span class="comment"> * - Change post-increments to pre-increments in inflate_fast(), PPC biased?</span>
<span class="comment"> * - Add compile time option, POSTINC, to use post-increments instead (Intel?)</span>
<span class="comment"> * - Make MATCH copy in inflate() much faster for when inflate_fast() not used</span>
<span class="comment"> * - Use local copies of stream next and avail values, as well as local bit</span>
<span class="comment"> *   buffer and bit count in inflate()--for speed when inflate_fast() not used</span>
<span class="comment"> *</span>
<span class="comment"> * 1.2.beta4    1 Jan 2003</span>
<span class="comment"> * - Split ptr - 257 statements in inflate_table() to avoid compiler warnings</span>
<span class="comment"> * - Move a comment on output buffer sizes from inffast.c to inflate.c</span>
<span class="comment"> * - Add comments in inffast.c to introduce the inflate_fast() routine</span>
<span class="comment"> * - Rearrange window copies in inflate_fast() for speed and simplification</span>
<span class="comment"> * - Unroll last copy for window match in inflate_fast()</span>
<span class="comment"> * - Use local copies of window variables in inflate_fast() for speed</span>
<span class="comment"> * - Pull out common write == 0 case for speed in inflate_fast()</span>
<span class="comment"> * - Make op and len in inflate_fast() unsigned for consistency</span>
<span class="comment"> * - Add FAR to lcode and dcode declarations in inflate_fast()</span>
<span class="comment"> * - Simplified bad distance check in inflate_fast()</span>
<span class="comment"> * - Added inflateBackInit(), inflateBack(), and inflateBackEnd() in new</span>
<span class="comment"> *   source file infback.c to provide a call-back interface to inflate for</span>
<span class="comment"> *   programs like gzip and unzip -- uses window as output buffer to avoid</span>
<span class="comment"> *   window copying</span>
<span class="comment"> *</span>
<span class="comment"> * 1.2.beta5    1 Jan 2003</span>
<span class="comment"> * - Improved inflateBack() interface to allow the caller to provide initial</span>
<span class="comment"> *   input in strm.</span>
<span class="comment"> * - Fixed stored blocks bug in inflateBack()</span>
<span class="comment"> *</span>
<span class="comment"> * 1.2.beta6    4 Jan 2003</span>
<span class="comment"> * - Added comments in inffast.c on effectiveness of POSTINC</span>
<span class="comment"> * - Typecasting all around to reduce compiler warnings</span>
<span class="comment"> * - Changed loops from while (1) or do {} while (1) to for (;;), again to</span>
<span class="comment"> *   make compilers happy</span>
<span class="comment"> * - Changed type of window in inflateBackInit() to unsigned char *</span>
<span class="comment"> *</span>
<span class="comment"> * 1.2.beta7    27 Jan 2003</span>
<span class="comment"> * - Changed many types to unsigned or unsigned short to avoid warnings</span>
<span class="comment"> * - Added inflateCopy() function</span>
<span class="comment"> *</span>
<span class="comment"> * 1.2.0        9 Mar 2003</span>
<span class="comment"> * - Changed inflateBack() interface to provide separate opaque descriptors</span>
<span class="comment"> *   for the in() and out() functions</span>
<span class="comment"> * - Changed inflateBack() argument and in_func typedef to swap the length</span>
<span class="comment"> *   and buffer address return values for the input function</span>
<span class="comment"> * - Check next_in and next_out for Z_NULL on entry to inflate()</span>
<span class="comment"> *</span>
<span class="comment"> * The history for versions after 1.2.0 are in ChangeLog in zlib distribution.</span>
<span class="comment"> */</span>

<span class="preproc">#include</span><span class="normal"> </span><span class="string">"zutil.h"</span>
<span class="preproc">#include</span><span class="normal"> </span><span class="string">"inftrees.h"</span>
<span class="preproc">#include</span><span class="normal"> </span><span class="string">"inflate.h"</span>
<span class="preproc">#include</span><span class="normal"> </span><span class="string">"inffast.h"</span>

<span class="preproc">#ifdef</span><span class="normal"> MAKEFIXED</span>
<span class="preproc">#  ifndef</span><span class="normal"> BUILDFIXED</span>
<span class="preproc">#    define</span><span class="normal"> BUILDFIXED</span>
<span class="preproc">#  endif</span>
<span class="preproc">#endif</span>

<span class="comment">/* function prototypes */</span>
<span class="normal">local </span><span class="type">void</span><span class="normal"> </span><span class="usertype">fixedtables</span><span class="normal"> </span><span class="function">OF</span><span class="symbol">((</span><span class="keyword">struct</span><span class="normal"> </span><span class="classname">inflate_state</span><span class="normal"> </span><span class="usertype">FAR</span><span class="normal"> </span><span class="symbol">*</span><span class="normal">state</span><span class="symbol">));</span>
<span class="normal">local </span><span class="type">int</span><span class="normal"> </span><span class="usertype">updatewindow</span><span class="normal"> </span><span class="function">OF</span><span class="symbol">((</span><span class="usertype">z_streamp</span><span class="normal"> strm</span><span class="symbol">,</span><span class="normal"> </span><span class="type">unsigned</span><span class="normal"> out</span><span class="symbol">));</span>
<span class="preproc">#ifdef</span><span class="normal"> BUILDFIXED</span>
<span class="normal">   </span><span class="type">void</span><span class="normal"> </span><span class="usertype">makefixed</span><span class="normal"> </span><span class="function">OF</span><span class="symbol">((</span><span class="type">void</span><span class="symbol">));</span>
<span class="preproc">#endif</span>
<span class="normal">local </span><span class="type">unsigned</span><span class="normal"> </span><span class="usertype">syncsearch</span><span class="normal"> </span><span class="function">OF</span><span class="symbol">((</span><span class="type">unsigned</span><span class="normal"> </span><span class="usertype">FAR</span><span class="normal"> </span><span class="symbol">*</span><span class="normal">have</span><span class="symbol">,</span><span class="normal"> </span><span class="type">unsigned</span><span class="normal"> </span><span class="type">char</span><span class="normal"> </span><span class="usertype">FAR</span><span class="normal"> </span><span class="symbol">*</span><span class="normal">buf</span><span class="symbol">,</span>
<span class="normal">                              </span><span class="type">unsigned</span><span class="normal"> len</span><span class="symbol">));</span>

<span class="type">int</span><span class="normal"> </span><span class="usertype">ZEXPORT</span><span class="normal"> </span><span class="function">inflateReset</span><span class="symbol">(</span><span class="normal">strm</span><span class="symbol">)</span>
<span class="usertype">z_streamp</span><span class="normal"> strm</span><span class="symbol">;</span>
<span class="cbracket">{</span>
<span class="normal">    </span><span class="keyword">struct</span><span class="normal"> </span><span class="classname">inflate_state</span><span class="normal"> </span><span class="usertype">FAR</span><span class="normal"> </span><span class="symbol">*</span><span class="normal">state</span><span class="symbol">;</span>

<span class="normal">    </span><span class="keyword">if</span><span class="normal"> </span><span class="symbol">(</span><span class="normal">strm </span><span class="symbol">==</span><span class="normal"> Z_NULL </span><span class="symbol">||</span><span class="normal"> strm</span><span class="symbol">-&gt;</span><span class="normal">state </span><span class="symbol">==</span><span class="normal"> Z_NULL</span><span class="symbol">)</span><span class="normal"> </span><span class="keyword">return</span><span class="normal"> Z_STREAM_ERROR</span><span class="symbol">;</span>
<span class="normal">    state </span><span class="symbol">=</span><span class="normal"> </span><span class="symbol">(</span><span class="keyword">struct</span><span class="normal"> </span><span class="classname">inflate_state</span><span class="normal"> FAR </span><span class="symbol">*)</span><span class="normal">strm</span><span class="symbol">-&gt;</span><span class="normal">state</span><span class="symbol">;</span>
<span class="normal">    strm</span><span class="symbol">-&gt;</span><span class="normal">total_in </span><span class="symbol">=</span><span class="normal"> strm</span><span class="symbol">-&gt;</span><span class="normal">total_out </span><span class="symbol">=</span><span class="normal"> state</span><span class="symbol">-&gt;</span><span class="normal">total </span><span class="symbol">=</span><span class="normal"> </span><span class="number">0</span><span class="symbol">;</span>
<span class="normal">    strm</span><span class="symbol">-&gt;</span><span class="normal">msg </span><span class="symbol">=</span><span class="normal"> Z_NULL</span><span class="symbol">;</span>
<span class="normal">    strm</span><span class="symbol">-&gt;</span><span class="normal">adler </span><span class="symbol">=</span><span class="normal"> </span><span class="number">1</span><span class="symbol">;</span><span class="normal">        </span><span class="comment">/* to support ill-conceived Java test suite */</span>
<span class="normal">    state</span><span class="symbol">-&gt;</span><span class="normal">mode </span><span class="symbol">=</span><span class="normal"> HEAD</span><span class="symbol">;</span>
<span class="normal">    state</span><span class="symbol">-&gt;</span><span class="normal">last </span><span class="symbol">=</span><span class="normal"> </span><span class="number">0</span><span class="symbol">;</span>
<span class="normal">    state</span><span class="symbol">-&gt;</span><span class="normal">havedict </span><span class="symbol">=</span><span class="normal"> </span><span class="number">0</span><span class="symbol">;</span>
<span class="normal">    state</span><span class="symbol">-&gt;</span><span class="normal">dmax </span><span class="symbol">=</span><span class="normal"> 32768U</span><span class="symbol">;</span>
<span class="normal">    state</span><span class="symbol">-&gt;</span><span class="normal">head </span><span class="symbol">=</span><span class="normal"> Z_NULL</span><span class="symbol">;</span>
<span class="normal">    state</span><span class="symbol">-&gt;</span><span class="normal">wsize </span><span class="symbol">=</span><span class="normal"> </span><span class="number">0</span><span class="symbol">;</span>
<span class="normal">    state</span><span class="symbol">-&gt;</span><span class="normal">whave </span><span class="symbol">=</span><span class="normal"> </span><span class="number">0</span><span class="symbol">;</span>
<span class="normal">    state</span><span class="symbol">-&gt;</span><span class="normal">write </span><span class="symbol">=</span><span class="normal"> </span><span class="number">0</span><span class="symbol">;</span>
<span class="normal">    state</span><span class="symbol">-&gt;</span><span class="normal">hold </span><span class="symbol">=</span><span class="normal"> </span><span class="number">0</span><span class="symbol">;</span>
<span class="normal">    state</span><span class="symbol">-&gt;</span><span class="normal">bits </span><span class="symbol">=</span><span class="normal"> </span><span class="number">0</span><span class="symbol">;</span>
<span class="normal">    state</span><span class="symbol">-&gt;</span><span class="normal">lencode </span><span class="symbol">=</span><span class="normal"> state</span><span class="symbol">-&gt;</span><span class="normal">distcode </span><span class="symbol">=</span><span class="normal"> state</span><span class="symbol">-&gt;</span><span class="normal">next </span><span class="symbol">=</span><span class="normal"> state</span><span class="symbol">-&gt;</span><span class="normal">codes</span><span class="symbol">;</span>
<span class="normal">    </span><span class="function">Tracev</span><span class="symbol">((</span><span class="normal">stderr</span><span class="symbol">,</span><span class="normal"> </span><span class="string">"inflate: reset</span><span class="specialchar">\n</span><span class="string">"</span><span class="symbol">));</span>
<span class="normal">    </span><span class="keyword">return</span><span class="normal"> Z_OK</span><span class="symbol">;</span>
<span class="cbracket">}</span>

<span class="type">int</span><span class="normal"> </span><span class="usertype">ZEXPORT</span><span class="normal"> </span><span class="function">inflatePrime</span><span class="symbol">(</span><span class="normal">strm</span><span class="symbol">,</span><span class="normal"> bits</span><span class="symbol">,</span><span class="normal"> value</span><span class="symbol">)</span>
<span class="usertype">z_streamp</span><span class="normal"> strm</span><span class="symbol">;</span>
<span class="type">int</span><span class="normal"> bits</span><span class="symbol">;</span>
<span class="type">int</span><span class="normal"> value</span><span class="symbol">;</span>
<span class="cbracket">{</span>
<span class="normal">    </span><span class="keyword">struct</span><span class="normal"> </span><span class="classname">inflate_state</span><span class="normal"> </span><span class="usertype">FAR</span><span class="normal"> </span><span class="symbol">*</span><span class="normal">state</span><span class="symbol">;</span>

<span class="normal">    </span><span class="keyword">if</span><span class="normal"> </span><span class="symbol">(</span><span class="normal">strm </span><span class="symbol">==</span><span class="normal"> Z_NULL </span><span class="symbol">||</span><span class="normal"> strm</span><span class="symbol">-&gt;</span><span class="normal">state </span><span class="symbol">==</span><span class="normal"> Z_NULL</span><span class="symbol">)</span><span class="normal"> </span><span class="keyword">return</span><span class="normal"> Z_STREAM_ERROR</span><span class="symbol">;</span>
<span class="normal">    state </span><span class="symbol">=</span><span class="normal"> </span><span class="symbol">(</span><span class="keyword">struct</span><span class="normal"> </span><span class="classname">inflate_state</span><span class="normal"> FAR </span><span class="symbol">*)</span><span class="normal">strm</span><span class="symbol">-&gt;</span><span class="normal">state</span><span class="symbol">;</span>
<span class="normal">    </span><span class="keyword">if</span><span class="normal"> </span><span class="symbol">(</span><span class="normal">bits </span><span class="symbol">&gt;</span><span class="normal"> </span><span class="number">16</span><span class="normal"> </span><span class="symbol">||</span><span class="normal"> state</span><span class="symbol">-&gt;</span><span class="normal">bits </span><span class="symbol">+</span><span class="normal"> bits </span><span class="symbol">&gt;</span><span class="normal"> </span><span class="number">32</span><span class="symbol">)</span><span class="normal"> </span><span class="keyword">return</span><span class="normal"> Z_STREAM_ERROR</span><span class="symbol">;</span>
<span class="normal">    value </span><span class="symbol">&amp;=</span><span class="normal"> </span><span class="symbol">(</span><span class="number">1L</span><span class="normal"> </span><span class="symbol">&lt;&lt;</span><span class="normal"> bits</span><span class="symbol">)</span><span class="normal"> </span><span class="symbol">-</span><span class="normal"> </span><span class="number">1</span><span class="symbol">;</span>
<span class="normal">    state</span><span class="symbol">-&gt;</span><span class="normal">hold </span><span class="symbol">+=</span><span class="normal"> value </span><span class="symbol">&lt;&lt;</span><span class="normal"> state</span><span class="symbol">-&gt;</span><span class="normal">bits</span><span class="symbol">;</span>
<span class="normal">    state</span><span class="symbol">-&gt;</span><span class="normal">bits </span><span class="symbol">+=</span><span class="normal"> bits</span><span class="symbol">;</span>
<span class="normal">    </span><span class="keyword">return</span><span class="normal"> Z_OK</span><span class="symbol">;</span>
<span class="cbracket">}</span>

<span class="type">int</span><span class="normal"> </span><span class="usertype">ZEXPORT</span><span class="normal"> </span><span class="function">inflateInit2_</span><span class="symbol">(</span><span class="normal">strm</span><span class="symbol">,</span><span class="normal"> windowBits</span><span class="symbol">,</span><span class="normal"> version</span><span class="symbol">,</span><span class="normal"> stream_size</span><span class="symbol">)</span>
<span class="usertype">z_streamp</span><span class="normal"> strm</span><span class="symbol">;</span>
<span class="type">int</span><span class="normal"> windowBits</span><span class="symbol">;</span>
<span class="keyword">const</span><span class="normal"> </span><span class="type">char</span><span class="normal"> </span><span class="symbol">*</span><span class="normal">version</span><span class="symbol">;</span>
<span class="type">int</span><span class="normal"> stream_size</span><span class="symbol">;</span>
<span class="cbracket">{</span>
<span class="normal">    </span><span class="keyword">struct</span><span class="normal"> </span><span class="classname">inflate_state</span><span class="normal"> </span><span class="usertype">FAR</span><span class="normal"> </span><span class="symbol">*</span><span class="normal">state</span><span class="symbol">;</span>

<span class="normal">    </span><span class="keyword">if</span><span class="normal"> </span><span class="symbol">(</span><span class="normal">version </span><span class="symbol">==</span><span class="normal"> Z_NULL </span><span class="symbol">||</span><span class="normal"> version</span><span class="symbol">[</span><span class="number">0</span><span class="symbol">]</span><span class="normal"> </span><span class="symbol">!=</span><span class="normal"> ZLIB_VERSION</span><span class="symbol">[</span><span class="number">0</span><span class="symbol">]</span><span class="normal"> </span><span class="symbol">||</span>
<span class="normal">        stream_size </span><span class="symbol">!=</span><span class="normal"> </span><span class="symbol">(</span><span class="type">int</span><span class="symbol">)(</span><span class="keyword">sizeof</span><span class="symbol">(</span><span class="normal">z_stream</span><span class="symbol">)))</span>
<span class="normal">        </span><span class="keyword">return</span><span class="normal"> Z_VERSION_ERROR</span><span class="symbol">;</span>
<span class="normal">    </span><span class="keyword">if</span><span class="normal"> </span><span class="symbol">(</span><span class="normal">strm </span><span class="symbol">==</span><span class="normal"> Z_NULL</span><span class="symbol">)</span><span class="normal"> </span><span class="keyword">return</span><span class="normal"> Z_STREAM_ERROR</span><span class="symbol">;</span>
<span class="normal">    strm</span><span class="symbol">-&gt;</span><span class="normal">msg </span><span class="symbol">=</span><span class="normal"> Z_NULL</span><span class="symbol">;</span><span class="normal">                 </span><span class="comment">/* in case we return an error */</span>
<span class="normal">    </span><span class="keyword">if</span><span class="normal"> </span><span class="symbol">(</span><span class="normal">strm</span><span class="symbol">-&gt;</span><span class="normal">zalloc </span><span class="symbol">==</span><span class="normal"> </span><span class="symbol">(</span><span class="normal">alloc_func</span><span class="symbol">)</span><span class="number">0</span><span class="symbol">)</span><span class="normal"> </span><span class="cbracket">{</span>
<span class="normal">        strm</span><span class="symbol">-&gt;</span><span class="normal">zalloc </span><span class="symbol">=</span><span class="normal"> zcalloc</span><span class="symbol">;</span>
<span class="normal">        strm</span><span class="symbol">-&gt;</span><span class="normal">opaque </span><span class="symbol">=</span><span class="normal"> </span><span class="symbol">(</span><span class="normal">voidpf</span><span class="symbol">)</span><span class="number">0</span><span class="symbol">;</span>
<span class="normal">    </span><span class="cbracket">}</span>
<span class="normal">    </span><span class="keyword">if</span><span class="normal"> </span><span class="symbol">(</span><span class="normal">strm</span><span class="symbol">-&gt;</span><span class="normal">zfree </span><span class="symbol">==</span><span class="normal"> </span><span class="symbol">(</span><span class="normal">free_func</span><span class="symbol">)</span><span class="number">0</span><span class="symbol">)</span><span class="normal"> strm</span><span class="symbol">-&gt;</span><span class="normal">zfree </span><span class="symbol">=</span><span class="normal"> zcfree</span><span class="symbol">;</span>
<span class="normal">    state </span><span class="symbol">=</span><span class="normal"> </span><span class="symbol">(</span><span class="keyword">struct</span><span class="normal"> </span><span class="classname">inflate_state</span><span class="normal"> FAR </span><span class="symbol">*)</span>
<span class="normal">            </span><span class="function">ZALLOC</span><span class="symbol">(</span><span class="normal">strm</span><span class="symbol">,</span><span class="normal"> </span><span class="number">1</span><span class="symbol">,</span><span class="normal"> </span><span class="keyword">sizeof</span><span class="symbol">(</span><span class="keyword">struct</span><span class="normal"> </span><span class="classname">inflate_state</span><span class="symbol">));</span>
<span class="normal">    </span><span class="keyword">if</span><span class="normal"> </span><span class="symbol">(</span><span class="normal">state </span><span class="symbol">==</span><span class="normal"> Z_NULL</span><span class="symbol">)</span><span class="normal"> </span><span class="keyword">return</span><span class="normal"> Z_MEM_ERROR</span><span class="symbol">;</span>
<span class="normal">    </span><span class="function">Tracev</span><span class="symbol">((</span><span class="normal">stderr</span><span class="symbol">,</span><span class="normal"> </span><span class="string">"inflate: allocated</span><span class="specialchar">\n</span><span class="string">"</span><span class="symbol">));</span>
<span class="normal">    strm</span><span class="symbol">-&gt;</span><span class="normal">state </span><span class="symbol">=</span><span class="normal"> </span><span class="symbol">(</span><span class="keyword">struct</span><span class="normal"> </span><span class="classname">internal_state</span><span class="normal"> FAR </span><span class="symbol">*)</span><span class="normal">state</span><span class="symbol">;</span>
<span class="normal">    </span><span class="keyword">if</span><span class="normal"> </span><span class="symbol">(</span><span class="normal">windowBits </span><span class="symbol">&lt;</span><span class="normal"> </span><span class="number">0</span><span class="symbol">)</span><span class="normal"> </span><span class="cbracket">{</span>
<span class="normal">        state</span><span class="symbol">-&gt;</span><span class="normal">wrap </span><span class="symbol">=</span><span class="normal"> </span><span class="number">0</span><span class="symbol">;</span>
<span class="normal">        windowBits </span><span class="symbol">=</span><span class="normal"> </span><span class="symbol">-</span><span class="normal">windowBits</span><span class="symbol">;</span>
<span class="normal">    </span><span class="cbracket">}</span>
<span class="normal">    </span><span class="keyword">else</span><span class="normal"> </span><span class="cbracket">{</span>
<span class="normal">        state</span><span class="symbol">-&gt;</span><span class="normal">wrap </span><span class="symbol">=</span><span class="normal"> </span><span class="symbol">(</span><span class="normal">windowBits </span><span class="symbol">&gt;&gt;</span><span class="normal"> </span><span class="number">4</span><span class="symbol">)</span><span class="normal"> </span><span class="symbol">+</span><span class="normal"> </span><span class="number">1</span><span class="symbol">;</span>
<span class="preproc">#ifdef</span><span class="normal"> GUNZIP</span>
<span class="normal">        </span><span class="keyword">if</span><span class="normal"> </span><span class="symbol">(</span><span class="normal">windowBits </span><span class="symbol">&lt;</span><span class="normal"> </span><span class="number">48</span><span class="symbol">)</span><span class="normal"> windowBits </span><span class="symbol">&amp;=</span><span class="normal"> </span><span class="number">15</span><span class="symbol">;</span>
<span class="preproc">#endif</span>
<span class="normal">    </span><span class="cbracket">}</span>
<span class="normal">    </span><span class="keyword">if</span><span class="normal"> </span><span class="symbol">(</span><span class="normal">windowBits </span><span class="symbol">&lt;</span><span class="normal"> </span><span class="number">8</span><span class="normal"> </span><span class="symbol">||</span><span class="normal"> windowBits </span><span class="symbol">&gt;</span><span class="normal"> </span><span class="number">15</span><span class="symbol">)</span><span class="normal"> </span><span class="cbracket">{</span>
<span class="normal">        </span><span class="function">ZFREE</span><span class="symbol">(</span><span class="normal">strm</span><span class="symbol">,</span><span class="normal"> state</span><span class="symbol">);</span>
<span class="normal">        strm</span><span class="symbol">-&gt;</span><span class="normal">state </span><span class="symbol">=</span><span class="normal"> Z_NULL</span><span class="symbol">;</span>
<span class="normal">        </span><span class="keyword">return</span><span class="normal"> Z_STREAM_ERROR</span><span class="symbol">;</span>
<span class="normal">    </span><span class="cbracket">}</span>
<span class="normal">    state</span><span class="symbol">-&gt;</span><span class="normal">wbits </span><span class="symbol">=</span><span class="normal"> </span><span class="symbol">(</span><span class="type">unsigned</span><span class="symbol">)</span><span class="normal">windowBits</span><span class="symbol">;</span>
<span class="normal">    state</span><span class="symbol">-&gt;</span><span class="normal">window </span><span class="symbol">=</span><span class="normal"> Z_NULL</span><span class="symbol">;</span>
<span class="normal">    </span><span class="keyword">return</span><span class="normal"> </span><span class="function">inflateReset</span><span class="symbol">(</span><span class="normal">strm</span><span class="symbol">);</span>
<span class="cbracket">}</span>

<span class="type">int</span><span class="normal"> </span><span class="usertype">ZEXPORT</span><span class="normal"> </span><span class="function">inflateInit_</span><span class="symbol">(</span><span class="normal">strm</span><span class="symbol">,</span><span class="normal"> version</span><span class="symbol">,</span><span class="normal"> stream_size</span><span class="symbol">)</span>
<span class="usertype">z_streamp</span><span class="normal"> strm</span><span class="symbol">;</span>
<span class="keyword">const</span><span class="normal"> </span><span class="type">char</span><span class="normal"> </span><span class="symbol">*</span><span class="normal">version</span><span class="symbol">;</span>
<span class="type">int</span><span class="normal"> stream_size</span><span class="symbol">;</span>
<span class="cbracket">{</span>
<span class="normal">    </span><span class="keyword">return</span><span class="normal"> </span><span class="function">inflateInit2_</span><span class="symbol">(</span><span class="normal">strm</span><span class="symbol">,</span><span class="normal"> DEF_WBITS</span><span class="symbol">,</span><span class="normal"> version</span><span class="symbol">,</span><span class="normal"> stream_size</span><span class="symbol">);</span>
<span class="cbracket">}</span>

<span class="comment">/*</span>
<span class="comment">   Return state with length and distance decoding tables and index sizes set to</span>
<span class="comment">   fixed code decoding.  Normally this returns fixed tables from inffixed.h.</span>
<span class="comment">   If BUILDFIXED is defined, then instead this routine builds the tables the</span>
<span class="comment">   first time it's called, and returns those tables the first time and</span>
<span class="comment">   thereafter.  This reduces the size of the code by about 2K bytes, in</span>
<span class="comment">   exchange for a little execution time.  However, BUILDFIXED should not be</span>
<span class="comment">   used for threaded applications, since the rewriting of the tables and virgin</span>
<span class="comment">   may not be thread-safe.</span>
<span class="comment"> */</span>
<span class="normal">local </span><span class="usertype">void</span><span class="normal"> </span><span class="function">fixedtables</span><span class="symbol">(</span><span class="normal">state</span><span class="symbol">)</span>
<span class="keyword">struct</span><span class="normal"> </span><span class="classname">inflate_state</span><span class="normal"> </span><span class="usertype">FAR</span><span class="normal"> </span><span class="symbol">*</span><span class="normal">state</span><span class="symbol">;</span>
<span class="cbracket">{</span>
<span class="preproc">#ifdef</span><span class="normal"> BUILDFIXED</span>
<span class="normal">    </span><span class="keyword">static</span><span class="normal"> </span><span class="type">int</span><span class="normal"> virgin </span><span class="symbol">=</span><span class="normal"> </span><span class="number">1</span><span class="symbol">;</span>
<span class="normal">    </span><span class="keyword">static</span><span class="normal"> </span><span class="usertype">code</span><span class="normal"> </span><span class="symbol">*</span><span class="normal">lenfix</span><span class="symbol">,</span><span class="normal"> </span><span class="symbol">*</span><span class="normal">distfix</span><span class="symbol">;</span>
<span class="normal">    </span><span class="keyword">static</span><span class="normal"> </span><span class="usertype">code</span><span class="normal"> fixed</span><span class="symbol">[</span><span class="number">544</span><span class="symbol">];</span>

<span class="normal">    </span><span class="comment">/* build fixed huffman tables if first call (may not be thread safe) */</span>
<span class="normal">    </span><span class="keyword">if</span><span class="normal"> </span><span class="symbol">(</span><span class="normal">virgin</span><span class="symbol">)</span><span class="normal"> </span><span class="cbracket">{</span>
<span class="normal">        </span><span class="type">unsigned</span><span class="normal"> sym</span><span class="symbol">,</span><span class="normal"> bits</span><span class="symbol">;</span>
<span class="normal">        </span><span class="keyword">static</span><span class="normal"> </span><span class="usertype">code</span><span class="normal"> </span><span class="symbol">*</span><span class="normal">next</span><span class="symbol">;</span>

<span class="normal">        </span><span class="comment">/* literal/length table */</span>
<span class="normal">        sym </span><span class="symbol">=</span><span class="normal"> </span><span class="number">0</span><span class="symbol">;</span>
<span class="normal">        </span><span class="keyword">while</span><span class="normal"> </span><span class="symbol">(</span><span class="normal">sym </span><span class="symbol">&lt;</span><span class="normal"> </span><span class="number">144</span><span class="symbol">)</span><span class="normal"> state</span><span class="symbol">-&gt;</span><span class="normal">lens</span><span class="symbol">[</span><span class="normal">sym</span><span class="symbol">++]</span><span class="normal"> </span><span class="symbol">=</span><span class="normal"> </span><span class="number">8</span><span class="symbol">;</span>
<span class="normal">        </span><span class="keyword">while</span><span class="normal"> </span><span class="symbol">(</span><span class="normal">sym </span><span class="symbol">&lt;</span><span class="normal"> </span><span class="number">256</span><span class="symbol">)</span><span class="normal"> state</span><span class="symbol">-&gt;</span><span class="normal">lens</span><span class="symbol">[</span><span class="normal">sym</span><span class="symbol">++]</span><span class="normal"> </span><span class="symbol">=</span><span class="normal"> </span><span class="number">9</span><span class="symbol">;</span>
<span class="normal">        </span><span class="keyword">while</span><span class="normal"> </span><span class="symbol">(</span><span class="normal">sym </span><span class="symbol">&lt;</span><span class="normal"> </span><span class="number">280</span><span class="symbol">)</span><span class="normal"> state</span><span class="symbol">-&gt;</span><span class="normal">lens</span><span class="symbol">[</span><span class="normal">sym</span><span class="symbol">++]</span><span class="normal"> </span><span class="symbol">=</span><span class="normal"> </span><span class="number">7</span><span class="symbol">;</span>
<span class="normal">        </span><span class="keyword">while</span><span class="normal"> </span><span class="symbol">(</span><span class="normal">sym </span><span class="symbol">&lt;</span><span class="normal"> </span><span class="number">288</span><span class="symbol">)</span><span class="normal"> state</span><span class="symbol">-&gt;</span><span class="normal">lens</span><span class="symbol">[</span><span class="normal">sym</span><span class="symbol">++]</span><span class="normal"> </span><span class="symbol">=</span><span class="normal"> </span><span class="number">8</span><span class="symbol">;</span>
<span class="normal">        next </span><span class="symbol">=</span><span class="normal"> fixed</span><span class="symbol">;</span>
<span class="normal">        lenfix </span><span class="symbol">=</span><span class="normal"> next</span><span class="symbol">;</span>
<span class="normal">        bits </span><span class="symbol">=</span><span class="normal"> </span><span class="number">9</span><span class="symbol">;</span>
<span class="normal">        </span><span class="function">inflate_table</span><span class="symbol">(</span><span class="normal">LENS</span><span class="symbol">,</span><span class="normal"> state</span><span class="symbol">-&gt;</span><span class="normal">lens</span><span class="symbol">,</span><span class="normal"> </span><span class="number">288</span><span class="symbol">,</span><span class="normal"> </span><span class="symbol">&amp;(</span><span class="normal">next</span><span class="symbol">),</span><span class="normal"> </span><span class="symbol">&amp;(</span><span class="normal">bits</span><span class="symbol">),</span><span class="normal"> state</span><span class="symbol">-&gt;</span><span class="normal">work</span><span class="symbol">);</span>

<span class="normal">        </span><span class="comment">/* distance table */</span>
<span class="normal">        sym </span><span class="symbol">=</span><span class="normal"> </span><span class="number">0</span><span class="symbol">;</span>
<span class="normal">        </span><span class="keyword">while</span><span class="normal"> </span><span class="symbol">(</span><span class="normal">sym </span><span class="symbol">&lt;</span><span class="normal"> </span><span class="number">32</span><span class="symbol">)</span><span class="normal"> state</span><span class="symbol">-&gt;</span><span class="normal">lens</span><span class="symbol">[</span><span class="normal">sym</span><span class="symbol">++]</span><span class="normal"> </span><span class="symbol">=</span><span class="normal"> </span><span class="number">5</span><span class="symbol">;</span>
<span class="normal">        distfix </span><span class="symbol">=</span><span class="normal"> next</span><span class="symbol">;</span>
<span class="normal">        bits </span><span class="symbol">=</span><span class="normal"> </span><span class="number">5</span><span class="symbol">;</span>
<span class="normal">        </span><span class="function">inflate_table</span><span class="symbol">(</span><span class="normal">DISTS</span><span class="symbol">,</span><span class="normal"> state</span><span class="symbol">-&gt;</span><span class="normal">lens</span><span class="symbol">,</span><span class="normal"> </span><span class="number">32</span><span class="symbol">,</span><span class="normal"> </span><span class="symbol">&amp;(</span><span class="normal">next</span><span class="symbol">),</span><span class="normal"> </span><span class="symbol">&amp;(</span><span class="normal">bits</span><span class="symbol">),</span><span class="normal"> state</span><span class="symbol">-&gt;</span><span class="normal">work</span><span class="symbol">);</span>

<span class="normal">        </span><span class="comment">/* do this just once */</span>
<span class="normal">        virgin </span><span class="symbol">=</span><span class="normal"> </span><span class="number">0</span><span class="symbol">;</span>
<span class="normal">    </span><span class="cbracket">}</span>
<span class="preproc">#else</span><span class="normal"> </span><span class="comment">/* !BUILDFIXED */</span>
<span class="preproc">#   include</span><span class="normal"> </span><span class="string">"inffixed.h"</span>
<span class="preproc">#endif</span><span class="normal"> </span><span class="comment">/* BUILDFIXED */</span>
<span class="normal">    state</span><span class="symbol">-&gt;</span><span class="normal">lencode </span><span class="symbol">=</span><span class="normal"> lenfix</span><span class="symbol">;</span>
<span class="normal">    state</span><span class="symbol">-&gt;</span><span class="normal">lenbits </span><span class="symbol">=</span><span class="normal"> </span><span class="number">9</span><span class="symbol">;</span>
<span class="normal">    state</span><span class="symbol">-&gt;</span><span class="normal">distcode </span><span class="symbol">=</span><span class="normal"> distfix</span><span class="symbol">;</span>
<span class="normal">    state</span><span class="symbol">-&gt;</span><span class="normal">distbits </span><span class="symbol">=</span><span class="normal"> </span><span class="number">5</span><span class="symbol">;</span>
<span class="cbracket">}</span>

<span class="preproc">#ifdef</span><span class="normal"> MAKEFIXED</span>
<span class="preproc">#include</span><span class="normal"> </span><span class="string">&lt;stdio.h&gt;</span>

<span class="comment">/*</span>
<span class="comment">   Write out the inffixed.h that is #include'd above.  Defining MAKEFIXED also</span>
<span class="comment">   defines BUILDFIXED, so the tables are built on the fly.  makefixed() writes</span>
<span class="comment">   those tables to stdout, which would be piped to inffixed.h.  A small program</span>
<span class="comment">   can simply call makefixed to do this:</span>

<span class="comment">    void makefixed(void);</span>

<span class="comment">    int main(void)</span>
<span class="comment">    {</span>
<span class="comment">        makefixed();</span>
<span class="comment">        return 0;</span>
<span class="comment">    }</span>

<span class="comment">   Then that can be linked with zlib built with MAKEFIXED defined and run:</span>

<span class="comment">    a.out &gt; inffixed.h</span>
<span class="comment"> */</span>
<span class="type">void</span><span class="normal"> </span><span class="function">makefixed</span><span class="symbol">()</span>
<span class="cbracket">{</span>
<span class="normal">    </span><span class="type">unsigned</span><span class="normal"> low</span><span class="symbol">,</span><span class="normal"> size</span><span class="symbol">;</span>
<span class="normal">    </span><span class="keyword">struct</span><span class="normal"> </span><span class="classname">inflate_state</span><span class="normal"> state</span><span class="symbol">;</span>

<span class="normal">    </span><span class="function">fixedtables</span><span class="symbol">(&amp;</span><span class="normal">state</span><span class="symbol">);</span>
<span class="normal">    </span><span class="function">puts</span><span class="symbol">(</span><span class="string">"    /* inffixed.h -- table for decoding fixed codes"</span><span class="symbol">);</span>
<span class="normal">    </span><span class="function">puts</span><span class="symbol">(</span><span class="string">"     * Generated automatically by makefixed()."</span><span class="symbol">);</span>
<span class="normal">    </span><span class="function">puts</span><span class="symbol">(</span><span class="string">"     */"</span><span class="symbol">);</span>
<span class="normal">    </span><span class="function">puts</span><span class="symbol">(</span><span class="string">""</span><span class="symbol">);</span>
<span class="normal">    </span><span class="function">puts</span><span class="symbol">(</span><span class="string">"    /* WARNING: this file should *not* be used by applications."</span><span class="symbol">);</span>
<span class="normal">    </span><span class="function">puts</span><span class="symbol">(</span><span class="string">"       It is part of the implementation of this library and is"</span><span class="symbol">);</span>
<span class="normal">    </span><span class="function">puts</span><span class="symbol">(</span><span class="string">"       subject to change. Applications should only use zlib.h."</span><span class="symbol">);</span>
<span class="normal">    </span><span class="function">puts</span><span class="symbol">(</span><span class="string">"     */"</span><span class="symbol">);</span>
<span class="normal">    </span><span class="function">puts</span><span class="symbol">(</span><span class="string">""</span><span class="symbol">);</span>
<span class="normal">    size </span><span class="symbol">=</span><span class="normal"> 1U </span><span class="symbol">&lt;&lt;</span><span class="normal"> </span><span class="number">9</span><span class="symbol">;</span>
<span class="normal">    </span><span class="function">printf</span><span class="symbol">(</span><span class="string">"    static const code lenfix[%u] = {"</span><span class="symbol">,</span><span class="normal"> size</span><span class="symbol">);</span>
<span class="normal">    low </span><span class="symbol">=</span><span class="normal"> </span><span class="number">0</span><span class="symbol">;</span>
<span class="normal">    </span><span class="keyword">for</span><span class="normal"> </span><span class="symbol">(;;)</span><span class="normal"> </span><span class="cbracket">{</span>
<span class="normal">        </span><span class="keyword">if</span><span class="normal"> </span><span class="symbol">((</span><span class="normal">low </span><span class="symbol">%</span><span class="normal"> </span><span class="number">7</span><span class="symbol">)</span><span class="normal"> </span><span class="symbol">==</span><span class="normal"> </span><span class="number">0</span><span class="symbol">)</span><span class="normal"> </span><span class="function">printf</span><span class="symbol">(</span><span class="string">"</span><span class="specialchar">\n</span><span class="string">        "</span><span class="symbol">);</span>
<span class="normal">        </span><span class="function">printf</span><span class="symbol">(</span><span class="string">"{%u,%u,%d}"</span><span class="symbol">,</span><span class="normal"> state</span><span class="symbol">.</span><span class="normal">lencode</span><span class="symbol">[</span><span class="normal">low</span><span class="symbol">].</span><span class="normal">op</span><span class="symbol">,</span><span class="normal"> state</span><span class="symbol">.</span><span class="normal">lencode</span><span class="symbol">[</span><span class="normal">low</span><span class="symbol">].</span><span class="normal">bits</span><span class="symbol">,</span>
<span class="normal">               state</span><span class="symbol">.</span><span class="normal">lencode</span><span class="symbol">[</span><span class="normal">low</span><span class="symbol">].</span><span class="normal">val</span><span class="symbol">);</span>
<span class="normal">        </span><span class="keyword">if</span><span class="normal"> </span><span class="symbol">(++</span><span class="normal">low </span><span class="symbol">==</span><span class="normal"> size</span><span class="symbol">)</span><span class="normal"> </span><span class="keyword">break</span><span class="symbol">;</span>
<span class="normal">        </span><span class="function">putchar</span><span class="symbol">(</span><span class="string">','</span><span class="symbol">);</span>
<span class="normal">    </span><span class="cbracket">}</span>
<span class="normal">    </span><span class="function">puts</span><span class="symbol">(</span><span class="string">"</span><span class="specialchar">\n</span><span class="string">    };"</span><span class="symbol">);</span>
<span class="normal">    size </span><span class="symbol">=</span><span class="normal"> 1U </span><span class="symbol">&lt;&lt;</span><span class="normal"> </span><span class="number">5</span><span class="symbol">;</span>
<span class="normal">    </span><span class="function">printf</span><span class="symbol">(</span><span class="string">"</span><span class="specialchar">\n</span><span class="string">    static const code distfix[%u] = {"</span><span class="symbol">,</span><span class="normal"> size</span><span class="symbol">);</span>
<span class="normal">    low </span><span class="symbol">=</span><span class="normal"> </span><span class="number">0</span><span class="symbol">;</span>
<span class="normal">    </span><span class="keyword">for</span><span class="normal"> </span><span class="symbol">(;;)</span><span class="normal"> </span><span class="cbracket">{</span>
<span class="normal">        </span><span class="keyword">if</span><span class="normal"> </span><span class="symbol">((</span><span class="normal">low </span><span class="symbol">%</span><span class="normal"> </span><span class="number">6</span><span class="symbol">)</span><span class="normal"> </span><span class="symbol">==</span><span class="normal"> </span><span class="number">0</span><span class="symbol">)</span><span class="normal"> </span><span class="function">printf</span><span class="symbol">(</span><span class="string">"</span><span class="specialchar">\n</span><span class="string">        "</span><span class="symbol">);</span>
<span class="normal">        </span><span class="function">printf</span><span class="symbol">(</span><span class="string">"{%u,%u,%d}"</span><span class="symbol">,</span><span class="normal"> state</span><span class="symbol">.</span><span class="normal">distcode</span><span class="symbol">[</span><span class="normal">low</span><span class="symbol">].</span><span class="normal">op</span><span class="symbol">,</span><span class="normal"> state</span><span class="symbol">.</span><span class="normal">distcode</span><span class="symbol">[</span><span class="normal">low</span><span class="symbol">].</span><span class="normal">bits</span><span class="symbol">,</span>
<span class="normal">               state</span><span class="symbol">.</span><span class="normal">distcode</span><span class="symbol">[</span><span class="normal">low</span><span class="symbol">].</span><span class="normal">val</span><span class="symbol">);</span>
<span class="normal">        </span><span class="keyword">if</span><span class="normal"> </span><span class="symbol">(++</span><span class="normal">low </span><span class="symbol">==</span><span class="normal"> size</span><span class="symbol">)</span><span class="normal"> </span><span class="keyword">break</span><span class="symbol">;</span>
<span class="normal">        </span><span class="function">putchar</span><span class="symbol">(</span><span class="string">','</span><span class="symbol">);</span>
<span class="normal">    </span><span class="cbracket">}</span>
<span class="normal">    </span><span class="function">puts</span><span class="symbol">(</span><span class="string">"</span><span class="specialchar">\n</span><span class="string">    };"</span><span class="symbol">);</span>
<span class="cbracket">}</span>
<span class="preproc">#endif</span><span class="normal"> </span><span class="comment">/* MAKEFIXED */</span>

<span class="comment">/*</span>
<span class="comment">   Update the window with the last wsize (normally 32K) bytes written before</span>
<span class="comment">   returning.  If window does not exist yet, create it.  This is only called</span>
<span class="comment">   when a window is already in use, or when output has been written during this</span>
<span class="comment">   inflate call, but the end of the deflate stream has not been reached yet.</span>
<span class="comment">   It is also called to create a window for dictionary data when a dictionary</span>
<span class="comment">   is loaded.</span>

<span class="comment">   Providing output buffers larger than 32K to inflate() should provide a speed</span>
<span class="comment">   advantage, since only the last 32K of output is copied to the sliding window</span>
<span class="comment">   upon return from inflate(), and since all distances after the first 32K of</span>
<span class="comment">   output will fall in the output data, making match copies simpler and faster.</span>
<span class="comment">   The advantage may be dependent on the size of the processor's data caches.</span>
<span class="comment"> */</span>
<span class="normal">local </span><span class="usertype">int</span><span class="normal"> </span><span class="function">updatewindow</span><span class="symbol">(</span><span class="normal">strm</span><span class="symbol">,</span><span class="normal"> out</span><span class="symbol">)</span>
<span class="usertype">z_streamp</span><span class="normal"> strm</span><span class="symbol">;</span>
<span class="type">unsigned</span><span class="normal"> out</span><span class="symbol">;</span>
<span class="cbracket">{</span>
<span class="normal">    </span><span class="keyword">struct</span><span class="normal"> </span><span class="classname">inflate_state</span><span class="normal"> </span><span class="usertype">FAR</span><span class="normal"> </span><span class="symbol">*</span><span class="normal">state</span><span class="symbol">;</span>
<span class="normal">    </span><span class="type">unsigned</span><span class="normal"> copy</span><span class="symbol">,</span><span class="normal"> dist</span><span class="symbol">;</span>

<span class="normal">    state </span><span class="symbol">=</span><span class="normal"> </span><span class="symbol">(</span><span class="keyword">struct</span><span class="normal"> </span><span class="classname">inflate_state</span><span class="normal"> FAR </span><span class="symbol">*)</span><span class="normal">strm</span><span class="symbol">-&gt;</span><span class="normal">state</span><span class="symbol">;</span>

<span class="normal">    </span><span class="comment">/* if it hasn't been done already, allocate space for the window */</span>
<span class="normal">    </span><span class="keyword">if</span><span class="normal"> </span><span class="symbol">(</span><span class="normal">state</span><span class="symbol">-&gt;</span><span class="normal">window </span><span class="symbol">==</span><span class="normal"> Z_NULL</span><span class="symbol">)</span><span class="normal"> </span><span class="cbracket">{</span>
<span class="normal">        state</span><span class="symbol">-&gt;</span><span class="normal">window </span><span class="symbol">=</span><span class="normal"> </span><span class="symbol">(</span><span class="type">unsigned</span><span class="normal"> </span><span class="type">char</span><span class="normal"> FAR </span><span class="symbol">*)</span>
<span class="normal">                        </span><span class="function">ZALLOC</span><span class="symbol">(</span><span class="normal">strm</span><span class="symbol">,</span><span class="normal"> 1U </span><span class="symbol">&lt;&lt;</span><span class="normal"> state</span><span class="symbol">-&gt;</span><span class="normal">wbits</span><span class="symbol">,</span>
<span class="normal">                               </span><span class="keyword">sizeof</span><span class="symbol">(</span><span class="type">unsigned</span><span class="normal"> </span><span class="type">char</span><span class="symbol">));</span>
<span class="normal">        </span><span class="keyword">if</span><span class="normal"> </span><span class="symbol">(</span><span class="normal">state</span><span class="symbol">-&gt;</span><span class="normal">window </span><span class="symbol">==</span><span class="normal"> Z_NULL</span><span class="symbol">)</span><span class="normal"> </span><span class="keyword">return</span><span class="normal"> </span><span class="number">1</span><span class="symbol">;</span>
<span class="normal">    </span><span class="cbracket">}</span>

<span class="normal">    </span><span class="comment">/* if window not in use yet, initialize */</span>
<span class="normal">    </span><span class="keyword">if</span><span class="normal"> </span><span class="symbol">(</span><span class="normal">state</span><span class="symbol">-&gt;</span><span class="normal">wsize </span><span class="symbol">==</span><span class="normal"> </span><span class="number">0</span><span class="symbol">)</span><span class="normal"> </span><span class="cbracket">{</span>
<span class="normal">        state</span><span class="symbol">-&gt;</span><span class="normal">wsize </span><span class="symbol">=</span><span class="normal"> 1U </span><span class="symbol">&lt;&lt;</span><span class="normal"> state</span><span class="symbol">-&gt;</span><span class="normal">wbits</span><span class="symbol">;</span>
<span class="normal">        state</span><span class="symbol">-&gt;</span><span class="normal">write </span><span class="symbol">=</span><span class="normal"> </span><span class="number">0</span><span class="symbol">;</span>
<span class="normal">        state</span><span class="symbol">-&gt;</span><span class="normal">whave </span><span class="symbol">=</span><span class="normal"> </span><span class="number">0</span><span class="symbol">;</span>
<span class="normal">    </span><span class="cbracket">}</span>

<span class="normal">    </span><span class="comment">/* copy state-&gt;wsize or less output bytes into the circular window */</span>
<span class="normal">    copy </span><span class="symbol">=</span><span class="normal"> out </span><span class="symbol">-</span><span class="normal"> strm</span><span class="symbol">-&gt;</span><span class="normal">avail_out</span><span class="symbol">;</span>
<span class="normal">    </span><span class="keyword">if</span><span class="normal"> </span><span class="symbol">(</span><span class="normal">copy </span><span class="symbol">&gt;=</span><span class="normal"> state</span><span class="symbol">-&gt;</span><span class="normal">wsize</span><span class="symbol">)</span><span class="normal"> </span><span class="cbracket">{</span>
<span class="normal">        </span><span class="function">zmemcpy</span><span class="symbol">(</span><span class="normal">state</span><span class="symbol">-&gt;</span><span class="normal">window</span><span class="symbol">,</span><span class="normal"> strm</span><span class="symbol">-&gt;</span><span class="normal">next_out </span><span class="symbol">-</span><span class="normal"> state</span><span class="symbol">-&gt;</span><span class="normal">wsize</span><span class="symbol">,</span><span class="normal"> state</span><span class="symbol">-&gt;</span><span class="normal">wsize</span><span class="symbol">);</span>
<span class="normal">        state</span><span class="symbol">-&gt;</span><span class="normal">write </span><span class="symbol">=</span><span class="normal"> </span><span class="number">0</span><span class="symbol">;</span>
<span class="normal">        state</span><span class="symbol">-&gt;</span><span class="normal">whave </span><span class="symbol">=</span><span class="normal"> state</span><span class="symbol">-&gt;</span><span class="normal">wsize</span><span class="symbol">;</span>
<span class="normal">    </span><span class="cbracket">}</span>
<span class="normal">    </span><span class="keyword">else</span><span class="normal"> </span><span class="cbracket">{</span>
<span class="normal">        dist </span><span class="symbol">=</span><span class="normal"> state</span><span class="symbol">-&gt;</span><span class="normal">wsize </span><span class="symbol">-</span><span class="normal"> state</span><span class="symbol">-&gt;</span><span class="normal">write</span><span class="symbol">;</span>
<span class="normal">        </span><span class="keyword">if</span><span class="normal"> </span><span class="symbol">(</span><span class="normal">dist </span><span class="symbol">&gt;</span><span class="normal"> copy</span><span class="symbol">)</span><span class="normal"> dist </span><span class="symbol">=</span><span class="normal"> copy</span><span class="symbol">;</span>
<span class="normal">        </span><span class="function">zmemcpy</span><span class="symbol">(</span><span class="normal">state</span><span class="symbol">-&gt;</span><span class="normal">window </span><span class="symbol">+</span><span class="normal"> state</span><span class="symbol">-&gt;</span><span class="normal">write</span><span class="symbol">,</span><span class="normal"> strm</span><span class="symbol">-&gt;</span><span class="normal">next_out </span><span class="symbol">-</span><span class="normal"> copy</span><span class="symbol">,</span><span class="normal"> dist</span><span class="symbol">);</span>
<span class="normal">        copy </span><span class="symbol">-=</span><span class="normal"> dist</span><span class="symbol">;</span>
<span class="normal">        </span><span class="keyword">if</span><span class="normal"> </span><span class="symbol">(</span><span class="normal">copy</span><span class="symbol">)</span><span class="normal"> </span><span class="cbracket">{</span>
<span class="normal">            </span><span class="function">zmemcpy</span><span class="symbol">(</span><span class="normal">state</span><span class="symbol">-&gt;</span><span class="normal">window</span><span class="symbol">,</span><span class="normal"> strm</span><span class="symbol">-&gt;</span><span class="normal">next_out </span><span class="symbol">-</span><span class="normal"> copy</span><span class="symbol">,</span><span class="normal"> copy</span><span class="symbol">);</span>
<span class="normal">            state</span><span class="symbol">-&gt;</span><span class="normal">write </span><span class="symbol">=</span><span class="normal"> copy</span><span class="symbol">;</span>
<span class="normal">            state</span><span class="symbol">-&gt;</span><span class="normal">whave </span><span class="symbol">=</span><span class="normal"> state</span><span class="symbol">-&gt;</span><span class="normal">wsize</span><span class="symbol">;</span>
<span class="normal">        </span><span class="cbracket">}</span>
<span class="normal">        </span><span class="keyword">else</span><span class="normal"> </span><span class="cbracket">{</span>
<span class="normal">            state</span><span class="symbol">-&gt;</span><span class="normal">write </span><span class="symbol">+=</span><span class="normal"> dist</span><span class="symbol">;</span>
<span class="normal">            </span><span class="keyword">if</span><span class="normal"> </span><span class="symbol">(</span><span class="normal">state</span><span class="symbol">-&gt;</span><span class="normal">write </span><span class="symbol">==</span><span class="normal"> state</span><span class="symbol">-&gt;</span><span class="normal">wsize</span><span class="symbol">)</span><span class="normal"> state</span><span class="symbol">-&gt;</span><span class="normal">write </span><span class="symbol">=</span><span class="normal"> </span><span class="number">0</span><span class="symbol">;</span>
<span class="normal">            </span><span class="keyword">if</span><span class="normal"> </span><span class="symbol">(</span><span class="normal">state</span><span class="symbol">-&gt;</span><span class="normal">whave </span><span class="symbol">&lt;</span><span class="normal"> state</span><span class="symbol">-&gt;</span><span class="normal">wsize</span><span class="symbol">)</span><span class="normal"> state</span><span class="symbol">-&gt;</span><span class="normal">whave </span><span class="symbol">+=</span><span class="normal"> dist</span><span class="symbol">;</span>
<span class="normal">        </span><span class="cbracket">}</span>
<span class="normal">    </span><span class="cbracket">}</span>
<span class="normal">    </span><span class="keyword">return</span><span class="normal"> </span><span class="number">0</span><span class="symbol">;</span>
<span class="cbracket">}</span>

<span class="comment">/* Macros for inflate(): */</span>

<span class="comment">/* check function to use adler32() for zlib or crc32() for gzip */</span>
<span class="preproc">#ifdef</span><span class="normal"> GUNZIP</span>
<span class="preproc">#  define</span><span class="normal"> </span><span class="function">UPDATE</span><span class="symbol">(</span><span class="normal">check</span><span class="symbol">,</span><span class="normal"> buf</span><span class="symbol">,</span><span class="normal"> len</span><span class="symbol">)</span><span class="normal"> </span><span class="symbol">\</span>
<span class="normal">    </span><span class="symbol">(</span><span class="normal">state</span><span class="symbol">-&gt;</span><span class="normal">flags </span><span class="symbol">?</span><span class="normal"> </span><span class="function">crc32</span><span class="symbol">(</span><span class="normal">check</span><span class="symbol">,</span><span class="normal"> buf</span><span class="symbol">,</span><span class="normal"> len</span><span class="symbol">)</span><span class="normal"> </span><span class="symbol">:</span><span class="normal"> </span><span class="function">adler32</span><span class="symbol">(</span><span class="normal">check</span><span class="symbol">,</span><span class="normal"> buf</span><span class="symbol">,</span><span class="normal"> len</span><span class="symbol">))</span>
<span class="preproc">#else</span>
<span class="preproc">#  define</span><span class="normal"> </span><span class="function">UPDATE</span><span class="symbol">(</span><span class="normal">check</span><span class="symbol">,</span><span class="normal"> buf</span><span class="symbol">,</span><span class="normal"> len</span><span class="symbol">)</span><span class="normal"> </span><span class="function">adler32</span><span class="symbol">(</span><span class="normal">check</span><span class="symbol">,</span><span class="normal"> buf</span><span class="symbol">,</span><span class="normal"> len</span><span class="symbol">)</span>
<span class="preproc">#endif</span>

<span class="comment">/* check macros for header crc */</span>
<span class="preproc">#ifdef</span><span class="normal"> GUNZIP</span>
<span class="preproc">#  define</span><span class="normal"> </span><span class="function">CRC2</span><span class="symbol">(</span><span class="normal">check</span><span class="symbol">,</span><span class="normal"> word</span><span class="symbol">)</span><span class="normal"> </span><span class="symbol">\</span>
<span class="normal">    </span><span class="keyword">do</span><span class="normal"> </span><span class="cbracket">{</span><span class="normal"> </span><span class="symbol">\</span>
<span class="normal">        hbuf</span><span class="symbol">[</span><span class="number">0</span><span class="symbol">]</span><span class="normal"> </span><span class="symbol">=</span><span class="normal"> </span><span class="symbol">(</span><span class="type">unsigned</span><span class="normal"> </span><span class="type">char</span><span class="symbol">)(</span><span class="normal">word</span><span class="symbol">);</span><span class="normal"> </span><span class="symbol">\</span>
<span class="normal">        hbuf</span><span class="symbol">[</span><span class="number">1</span><span class="symbol">]</span><span class="normal"> </span><span class="symbol">=</span><span class="normal"> </span><span class="symbol">(</span><span class="type">unsigned</span><span class="normal"> </span><span class="type">char</span><span class="symbol">)((</span><span class="normal">word</span><span class="symbol">)</span><span class="normal"> </span><span class="symbol">&gt;&gt;</span><span class="normal"> </span><span class="number">8</span><span class="symbol">);</span><span class="normal"> </span><span class="symbol">\</span>
<span class="normal">        check </span><span class="symbol">=</span><span class="normal"> </span><span class="function">crc32</span><span class="symbol">(</span><span class="normal">check</span><span class="symbol">,</span><span class="normal"> hbuf</span><span class="symbol">,</span><span class="normal"> </span><span class="number">2</span><span class="symbol">);</span><span class="normal"> </span><span class="symbol">\</span>
<span class="normal">    </span><span class="cbracket">}</span><span class="normal"> </span><span class="keyword">while</span><span class="normal"> </span><span class="symbol">(</span><span class="number">0</span><span class="symbol">)</span>

<span class="preproc">#  define</span><span class="normal"> </span><span class="function">CRC4</span><span class="symbol">(</span><span class="normal">check</span><span class="symbol">,</span><span class="normal"> word</span><span class="symbol">)</span><span class="normal"> </span><span class="symbol">\</span>
<span class="normal">    </span><span class="keyword">do</span><span class="normal"> </span><span class="cbracket">{</span><span class="normal"> </span><span class="symbol">\</span>
<span class="normal">        hbuf</span><span class="symbol">[</span><span class="number">0</span><span class="symbol">]</span><span class="normal"> </span><span class="symbol">=</span><span class="normal"> </span><span class="symbol">(</span><span class="type">unsigned</span><span class="normal"> </span><span class="type">char</span><span class="symbol">)(</span><span class="normal">word</span><span class="symbol">);</span><span class="normal"> </span><span class="symbol">\</span>
<span class="normal">        hbuf</span><span class="symbol">[</span><span class="number">1</span><span class="symbol">]</span><span class="normal"> </span><span class="symbol">=</span><span class="normal"> </span><span class="symbol">(</span><span class="type">unsigned</span><span class="normal"> </span><span class="type">char</span><span class="symbol">)((</span><span class="normal">word</span><span class="symbol">)</span><span class="normal"> </span><span class="symbol">&gt;&gt;</span><span class="normal"> </span><span class="number">8</span><span class="symbol">);</span><span class="normal"> </span><span class="symbol">\</span>
<span class="normal">        hbuf</span><span class="symbol">[</span><span class="number">2</span><span class="symbol">]</span><span class="normal"> </span><span class="symbol">=</span><span class="normal"> </span><span class="symbol">(</span><span class="type">unsigned</span><span class="normal"> </span><span class="type">char</span><span class="symbol">)((</span><span class="normal">word</span><span class="symbol">)</span><span class="normal"> </span><span class="symbol">&gt;&gt;</span><span class="normal"> </span><span class="number">16</span><span class="symbol">);</span><span class="normal"> </span><span class="symbol">\</span>
<span class="normal">        hbuf</span><span class="symbol">[</span><span class="number">3</span><span class="symbol">]</span><span class="normal"> </span><span class="symbol">=</span><span class="normal"> </span><span class="symbol">(</span><span class="type">unsigned</span><span class="normal"> </span><span class="type">char</span><span class="symbol">)((</span><span class="normal">word</span><span class="symbol">)</span><span class="normal"> </span><span class="symbol">&gt;&gt;</span><span class="normal"> </span><span class="number">24</span><span class="symbol">);</span><span class="normal"> </span><span class="symbol">\</span>
<span class="normal">        check </span><span class="symbol">=</span><span class="normal"> </span><span class="function">crc32</span><span class="symbol">(</span><span class="normal">check</span><span class="symbol">,</span><span class="normal"> hbuf</span><span class="symbol">,</span><span class="normal"> </span><span class="number">4</span><span class="symbol">);</span><span class="normal"> </span><span class="symbol">\</span>
<span class="normal">    </span><span class="cbracket">}</span><span class="normal"> </span><span class="keyword">while</span><span class="normal"> </span><span class="symbol">(</span><span class="number">0</span><span class="symbol">)</span>
<span class="preproc">#endif</span>

<span class="comment">/* Load registers with state in inflate() for speed */</span>
<span class="preproc">#define</span><span class="normal"> </span><span class="function">LOAD</span><span class="symbol">()</span><span class="normal"> </span><span class="symbol">\</span>
<span class="normal">    </span><span class="keyword">do</span><span class="normal"> </span><span class="cbracket">{</span><span class="normal"> </span><span class="symbol">\</span>
<span class="normal">        put </span><span class="symbol">=</span><span class="normal"> strm</span><span class="symbol">-&gt;</span><span class="normal">next_out</span><span class="symbol">;</span><span class="normal"> </span><span class="symbol">\</span>
<span class="normal">        left </span><span class="symbol">=</span><span class="normal"> strm</span><span class="symbol">-&gt;</span><span class="normal">avail_out</span><span class="symbol">;</span><span class="normal"> </span><span class="symbol">\</span>
<span class="normal">        next </span><span class="symbol">=</span><span class="normal"> strm</span><span class="symbol">-&gt;</span><span class="normal">next_in</span><span class="symbol">;</span><span class="normal"> </span><span class="symbol">\</span>
<span class="normal">        have </span><span class="symbol">=</span><span class="normal"> strm</span><span class="symbol">-&gt;</span><span class="normal">avail_in</span><span class="symbol">;</span><span class="normal"> </span><span class="symbol">\</span>
<span class="normal">        hold </span><span class="symbol">=</span><span class="normal"> state</span><span class="symbol">-&gt;</span><span class="normal">hold</span><span class="symbol">;</span><span class="normal"> </span><span class="symbol">\</span>
<span class="normal">        bits </span><span class="symbol">=</span><span class="normal"> state</span><span class="symbol">-&gt;</span><span class="normal">bits</span><span class="symbol">;</span><span class="normal"> </span><span class="symbol">\</span>
<span class="normal">    </span><span class="cbracket">}</span><span class="normal"> </span><span class="keyword">while</span><span class="normal"> </span><span class="symbol">(</span><span class="number">0</span><span class="symbol">)</span>

<span class="comment">/* Restore state from registers in inflate() */</span>
<span class="preproc">#define</span><span class="normal"> </span><span class="function">RESTORE</span><span class="symbol">()</span><span class="normal"> </span><span class="symbol">\</span>
<span class="normal">    </span><span class="keyword">do</span><span class="normal"> </span><span class="cbracket">{</span><span class="normal"> </span><span class="symbol">\</span>
<span class="normal">        strm</span><span class="symbol">-&gt;</span><span class="normal">next_out </span><span class="symbol">=</span><span class="normal"> put</span><span class="symbol">;</span><span class="normal"> </span><span class="symbol">\</span>
<span class="normal">        strm</span><span class="symbol">-&gt;</span><span class="normal">avail_out </span><span class="symbol">=</span><span class="normal"> left</span><span class="symbol">;</span><span class="normal"> </span><span class="symbol">\</span>
<span class="normal">        strm</span><span class="symbol">-&gt;</span><span class="normal">next_in </span><span class="symbol">=</span><span class="normal"> next</span><span class="symbol">;</span><span class="normal"> </span><span class="symbol">\</span>
<span class="normal">        strm</span><span class="symbol">-&gt;</span><span class="normal">avail_in </span><span class="symbol">=</span><span class="normal"> have</span><span class="symbol">;</span><span class="normal"> </span><span class="symbol">\</span>
<span class="normal">        state</span><span class="symbol">-&gt;</span><span class="normal">hold </span><span class="symbol">=</span><span class="normal"> hold</span><span class="symbol">;</span><span class="normal"> </span><span class="symbol">\</span>
<span class="normal">        state</span><span class="symbol">-&gt;</span><span class="normal">bits </span><span class="symbol">=</span><span class="normal"> bits</span><span class="symbol">;</span><span class="normal"> </span><span class="symbol">\</span>
<span class="normal">    </span><span class="cbracket">}</span><span class="normal"> </span><span class="keyword">while</span><span class="normal"> </span><span class="symbol">(</span><span class="number">0</span><span class="symbol">)</span>

<span class="comment">/* Clear the input bit accumulator */</span>
<span class="preproc">#define</span><span class="normal"> </span><span class="function">INITBITS</span><span class="symbol">()</span><span class="normal"> </span><span class="symbol">\</span>
<span class="normal">    </span><span class="keyword">do</span><span class="normal"> </span><span class="cbracket">{</span><span class="normal"> </span><span class="symbol">\</span>
<span class="normal">        hold </span><span class="symbol">=</span><span class="normal"> </span><span class="number">0</span><span class="symbol">;</span><span class="normal"> </span><span class="symbol">\</span>
<span class="normal">        bits </span><span class="symbol">=</span><span class="normal"> </span><span class="number">0</span><span class="symbol">;</span><span class="normal"> </span><span class="symbol">\</span>
<span class="normal">    </span><span class="cbracket">}</span><span class="normal"> </span><span class="keyword">while</span><span class="normal"> </span><span class="symbol">(</span><span class="number">0</span><span class="symbol">)</span>

<span class="comment">/* Get a byte of input into the bit accumulator, or return from inflate()</span>
<span class="comment">   if there is no input available. */</span>
<span class="preproc">#define</span><span class="normal"> </span><span class="function">PULLBYTE</span><span class="symbol">()</span><span class="normal"> </span><span class="symbol">\</span>
<span class="normal">    </span><span class="keyword">do</span><span class="normal"> </span><span class="cbracket">{</span><span class="normal"> </span><span class="symbol">\</span>
<span class="normal">        </span><span class="keyword">if</span><span class="normal"> </span><span class="symbol">(</span><span class="normal">have </span><span class="symbol">==</span><span class="normal"> </span><span class="number">0</span><span class="symbol">)</span><span class="normal"> </span><span class="keyword">goto</span><span class="normal"> inf_leave</span><span class="symbol">;</span><span class="normal"> </span><span class="symbol">\</span>
<span class="normal">        have</span><span class="symbol">--;</span><span class="normal"> </span><span class="symbol">\</span>
<span class="normal">        hold </span><span class="symbol">+=</span><span class="normal"> </span><span class="symbol">(</span><span class="type">unsigned</span><span class="normal"> </span><span class="type">long</span><span class="symbol">)(*</span><span class="normal">next</span><span class="symbol">++)</span><span class="normal"> </span><span class="symbol">&lt;&lt;</span><span class="normal"> bits</span><span class="symbol">;</span><span class="normal"> </span><span class="symbol">\</span>
<span class="normal">        bits </span><span class="symbol">+=</span><span class="normal"> </span><span class="number">8</span><span class="symbol">;</span><span class="normal"> </span><span class="symbol">\</span>
<span class="normal">    </span><span class="cbracket">}</span><span class="normal"> </span><span class="keyword">while</span><span class="normal"> </span><span class="symbol">(</span><span class="number">0</span><span class="symbol">)</span>

<span class="comment">/* Assure that there are at least n bits in the bit accumulator.  If there is</span>
<span class="comment">   not enough available input to do that, then return from inflate(). */</span>
<span class="preproc">#define</span><span class="normal"> </span><span class="function">NEEDBITS</span><span class="symbol">(</span><span class="normal">n</span><span class="symbol">)</span><span class="normal"> </span><span class="symbol">\</span>
<span class="normal">    </span><span class="keyword">do</span><span class="normal"> </span><span class="cbracket">{</span><span class="normal"> </span><span class="symbol">\</span>
<span class="normal">        </span><span class="keyword">while</span><span class="normal"> </span><span class="symbol">(</span><span class="normal">bits </span><span class="symbol">&lt;</span><span class="normal"> </span><span class="symbol">(</span><span class="type">unsigned</span><span class="symbol">)(</span><span class="normal">n</span><span class="symbol">))</span><span class="normal"> </span><span class="symbol">\</span>
<span class="normal">            </span><span class="function">PULLBYTE</span><span class="symbol">();</span><span class="normal"> </span><span class="symbol">\</span>
<span class="normal">    </span><span class="cbracket">}</span><span class="normal"> </span><span class="keyword">while</span><span class="normal"> </span><span class="symbol">(</span><span class="number">0</span><span class="symbol">)</span>

<span class="comment">/* Return the low n bits of the bit accumulator (n &lt; 16) */</span>
<span class="preproc">#define</span><span class="normal"> </span><span class="function">BITS</span><span class="symbol">(</span><span class="normal">n</span><span class="symbol">)</span><span class="normal"> </span><span class="symbol">\</span>
<span class="normal">    </span><span class="symbol">((</span><span class="type">unsigned</span><span class="symbol">)</span><span class="normal">hold </span><span class="symbol">&amp;</span><span class="normal"> </span><span class="symbol">((</span><span class="normal">1U </span><span class="symbol">&lt;&lt;</span><span class="normal"> </span><span class="symbol">(</span><span class="normal">n</span><span class="symbol">))</span><span class="normal"> </span><span class="symbol">-</span><span class="normal"> </span><span class="number">1</span><span class="symbol">))</span>

<span class="comment">/* Remove n bits from the bit accumulator */</span>
<span class="preproc">#define</span><span class="normal"> </span><span class="function">DROPBITS</span><span class="symbol">(</span><span class="normal">n</span><span class="symbol">)</span><span class="normal"> </span><span class="symbol">\</span>
<span class="normal">    </span><span class="keyword">do</span><span class="normal"> </span><span class="cbracket">{</span><span class="normal"> </span><span class="symbol">\</span>
<span class="normal">        hold </span><span class="symbol">&gt;&gt;=</span><span class="normal"> </span><span class="symbol">(</span><span class="normal">n</span><span class="symbol">);</span><span class="normal"> </span><span class="symbol">\</span>
<span class="normal">        bits </span><span class="symbol">-=</span><span class="normal"> </span><span class="symbol">(</span><span class="type">unsigned</span><span class="symbol">)(</span><span class="normal">n</span><span class="symbol">);</span><span class="normal"> </span><span class="symbol">\</span>
<span class="normal">    </span><span class="cbracket">}</span><span class="normal"> </span><span class="keyword">while</span><span class="normal"> </span><span class="symbol">(</span><span class="number">0</span><span class="symbol">)</span>

<span class="comment">/* Remove zero to seven bits as needed to go to a byte boundary */</span>
<span class="preproc">#define</span><span class="normal"> </span><span class="function">BYTEBITS</span><span class="symbol">()</span><span class="normal"> </span><span class="symbol">\</span>
<span class="normal">    </span><span class="keyword">do</span><span class="normal"> </span><span class="cbracket">{</span><span class="normal"> </span><span class="symbol">\</span>
<span class="normal">        hold </span><span class="symbol">&gt;&gt;=</span><span class="normal"> bits </span><span class="symbol">&amp;</span><span class="normal"> </span><span class="number">7</span><span class="symbol">;</span><span class="normal"> </span><span class="symbol">\</span>
<span class="normal">        bits </span><span class="symbol">-=</span><span class="normal"> bits </span><span class="symbol">&amp;</span><span class="normal"> </span><span class="number">7</span><span class="symbol">;</span><span class="normal"> </span><span class="symbol">\</span>
<span class="normal">    </span><span class="cbracket">}</span><span class="normal"> </span><span class="keyword">while</span><span class="normal"> </span><span class="symbol">(</span><span class="number">0</span><span class="symbol">)</span>

<span class="comment">/* Reverse the bytes in a 32-bit value */</span>
<span class="preproc">#define</span><span class="normal"> </span><span class="function">REVERSE</span><span class="symbol">(</span><span class="normal">q</span><span class="symbol">)</span><span class="normal"> </span><span class="symbol">\</span>
<span class="normal">    </span><span class="symbol">((((</span><span class="normal">q</span><span class="symbol">)</span><span class="normal"> </span><span class="symbol">&gt;&gt;</span><span class="normal"> </span><span class="number">24</span><span class="symbol">)</span><span class="normal"> </span><span class="symbol">&amp;</span><span class="normal"> </span><span class="number">0xff</span><span class="symbol">)</span><span class="normal"> </span><span class="symbol">+</span><span class="normal"> </span><span class="symbol">(((</span><span class="normal">q</span><span class="symbol">)</span><span class="normal"> </span><span class="symbol">&gt;&gt;</span><span class="normal"> </span><span class="number">8</span><span class="symbol">)</span><span class="normal"> </span><span class="symbol">&amp;</span><span class="normal"> </span><span class="number">0xff00</span><span class="symbol">)</span><span class="normal"> </span><span class="symbol">+</span><span class="normal"> </span><span class="symbol">\</span>
<span class="normal">     </span><span class="symbol">(((</span><span class="normal">q</span><span class="symbol">)</span><span class="normal"> </span><span class="symbol">&amp;</span><span class="normal"> </span><span class="number">0xff00</span><span class="symbol">)</span><span class="normal"> </span><span class="symbol">&lt;&lt;</span><span class="normal"> </span><span class="number">8</span><span class="symbol">)</span><span class="normal"> </span><span class="symbol">+</span><span class="normal"> </span><span class="symbol">(((</span><span class="normal">q</span><span class="symbol">)</span><span class="normal"> </span><span class="symbol">&amp;</span><span class="normal"> </span><span class="number">0xff</span><span class="symbol">)</span><span class="normal"> </span><span class="symbol">&lt;&lt;</span><span class="normal"> </span><span class="number">24</span><span class="symbol">))</span>

<span class="comment">/*</span>
<span class="comment">   inflate() uses a state machine to process as much input data and generate as</span>
<span class="comment">   much output data as possible before returning.  The state machine is</span>
<span class="comment">   structured roughly as follows:</span>

<span class="comment">    for (;;) switch (state) {</span>
<span class="comment">    ...</span>
<span class="comment">    case STATEn:</span>
<span class="comment">        if (not enough input data or output space to make progress)</span>
<span class="comment">            return;</span>
<span class="comment">        ... make progress ...</span>
<span class="comment">        state = STATEm;</span>
<span class="comment">        break;</span>
<span class="comment">    ...</span>
<span class="comment">    }</span>

<span class="comment">   so when inflate() is called again, the same case is attempted again, and</span>
<span class="comment">   if the appropriate resources are provided, the machine proceeds to the</span>
<span class="comment">   next state.  The NEEDBITS() macro is usually the way the state evaluates</span>
<span class="comment">   whether it can proceed or should return.  NEEDBITS() does the return if</span>
<span class="comment">   the requested bits are not available.  The typical use of the BITS macros</span>
<span class="comment">   is:</span>

<span class="comment">        NEEDBITS(n);</span>
<span class="comment">        ... do something with BITS(n) ...</span>
<span class="comment">        DROPBITS(n);</span>

<span class="comment">   where NEEDBITS(n) either returns from inflate() if there isn't enough</span>
<span class="comment">   input left to load n bits into the accumulator, or it continues.  BITS(n)</span>
<span class="comment">   gives the low n bits in the accumulator.  When done, DROPBITS(n) drops</span>
<span class="comment">   the low n bits off the accumulator.  INITBITS() clears the accumulator</span>
<span class="comment">   and sets the number of available bits to zero.  BYTEBITS() discards just</span>
<span class="comment">   enough bits to put the accumulator on a byte boundary.  After BYTEBITS()</span>
<span class="comment">   and a NEEDBITS(8), then BITS(8) would return the next byte in the stream.</span>

<span class="comment">   NEEDBITS(n) uses PULLBYTE() to get an available byte of input, or to return</span>
<span class="comment">   if there is no input available.  The decoding of variable length codes uses</span>
<span class="comment">   PULLBYTE() directly in order to pull just enough bytes to decode the next</span>
<span class="comment">   code, and no more.</span>

<span class="comment">   Some states loop until they get enough input, making sure that enough</span>
<span class="comment">   state information is maintained to continue the loop where it left off</span>
<span class="comment">   if NEEDBITS() returns in the loop.  For example, want, need, and keep</span>
<span class="comment">   would all have to actually be part of the saved state in case NEEDBITS()</span>
<span class="comment">   returns:</span>

<span class="comment">    case STATEw:</span>
<span class="comment">        while (want &lt; need) {</span>
<span class="comment">            NEEDBITS(n);</span>
<span class="comment">            keep[want++] = BITS(n);</span>
<span class="comment">            DROPBITS(n);</span>
<span class="comment">        }</span>
<span class="comment">        state = STATEx;</span>
<span class="comment">    case STATEx:</span>

<span class="comment">   As shown above, if the next state is also the next case, then the break</span>
<span class="comment">   is omitted.</span>

<span class="comment">   A state may also return if there is not enough output space available to</span>
<span class="comment">   complete that state.  Those states are copying stored data, writing a</span>
<span class="comment">   literal byte, and copying a matching string.</span>

<span class="comment">   When returning, a "goto inf_leave" is used to update the total counters,</span>
<span class="comment">   update the check value, and determine whether any progress has been made</span>
<span class="comment">   during that inflate() call in order to return the proper return code.</span>
<span class="comment">   Progress is defined as a change in either strm-&gt;avail_in or strm-&gt;avail_out.</span>
<span class="comment">   When there is a window, goto inf_leave will update the window with the last</span>
<span class="comment">   output written.  If a goto inf_leave occurs in the middle of decompression</span>
<span class="comment">   and there is no window currently, goto inf_leave will create one and copy</span>
<span class="comment">   output to the window for the next call of inflate().</span>

<span class="comment">   In this implementation, the flush parameter of inflate() only affects the</span>
<span class="comment">   return code (per zlib.h).  inflate() always writes as much as possible to</span>
<span class="comment">   strm-&gt;next_out, given the space available and the provided input--the effect</span>
<span class="comment">   documented in zlib.h of Z_SYNC_FLUSH.  Furthermore, inflate() always defers</span>
<span class="comment">   the allocation of and copying into a sliding window until necessary, which</span>
<span class="comment">   provides the effect documented in zlib.h for Z_FINISH when the entire input</span>
<span class="comment">   stream available.  So the only thing the flush parameter actually does is:</span>
<span class="comment">   when flush is set to Z_FINISH, inflate() cannot return Z_OK.  Instead it</span>
<span class="comment">   will return Z_BUF_ERROR if it has not reached the end of the stream.</span>
<span class="comment"> */</span>

<span class="type">int</span><span class="normal"> </span><span class="usertype">ZEXPORT</span><span class="normal"> </span><span class="function">inflate</span><span class="symbol">(</span><span class="normal">strm</span><span class="symbol">,</span><span class="normal"> flush</span><span class="symbol">)</span>
<span class="usertype">z_streamp</span><span class="normal"> strm</span><span class="symbol">;</span>
<span class="type">int</span><span class="normal"> flush</span><span class="symbol">;</span>
<span class="cbracket">{</span>
<span class="normal">    </span><span class="keyword">struct</span><span class="normal"> </span><span class="classname">inflate_state</span><span class="normal"> </span><span class="usertype">FAR</span><span class="normal"> </span><span class="symbol">*</span><span class="normal">state</span><span class="symbol">;</span>
<span class="normal">    </span><span class="type">unsigned</span><span class="normal"> </span><span class="type">char</span><span class="normal"> </span><span class="usertype">FAR</span><span class="normal"> </span><span class="symbol">*</span><span class="normal">next</span><span class="symbol">;</span><span class="normal">    </span><span class="comment">/* next input */</span>
<span class="normal">    </span><span class="type">unsigned</span><span class="normal"> </span><span class="type">char</span><span class="normal"> </span><span class="usertype">FAR</span><span class="normal"> </span><span class="symbol">*</span><span class="normal">put</span><span class="symbol">;</span><span class="normal">     </span><span class="comment">/* next output */</span>
<span class="normal">    </span><span class="type">unsigned</span><span class="normal"> have</span><span class="symbol">,</span><span class="normal"> left</span><span class="symbol">;</span><span class="normal">        </span><span class="comment">/* available input and output */</span>
<span class="normal">    </span><span class="type">unsigned</span><span class="normal"> </span><span class="type">long</span><span class="normal"> hold</span><span class="symbol">;</span><span class="normal">         </span><span class="comment">/* bit buffer */</span>
<span class="normal">    </span><span class="type">unsigned</span><span class="normal"> bits</span><span class="symbol">;</span><span class="normal">              </span><span class="comment">/* bits in bit buffer */</span>
<span class="normal">    </span><span class="type">unsigned</span><span class="normal"> in</span><span class="symbol">,</span><span class="normal"> out</span><span class="symbol">;</span><span class="normal">           </span><span class="comment">/* save starting available input and output */</span>
<span class="normal">    </span><span class="type">unsigned</span><span class="normal"> copy</span><span class="symbol">;</span><span class="normal">              </span><span class="comment">/* number of stored or match bytes to copy */</span>
<span class="normal">    </span><span class="type">unsigned</span><span class="normal"> </span><span class="type">char</span><span class="normal"> </span><span class="usertype">FAR</span><span class="normal"> </span><span class="symbol">*</span><span class="normal">from</span><span class="symbol">;</span><span class="normal">    </span><span class="comment">/* where to copy match bytes from */</span>
<span class="normal">    </span><span class="usertype">code</span><span class="normal"> this</span><span class="symbol">;</span><span class="normal">                  </span><span class="comment">/* current decoding table entry */</span>
<span class="normal">    </span><span class="usertype">code</span><span class="normal"> last</span><span class="symbol">;</span><span class="normal">                  </span><span class="comment">/* parent table entry */</span>
<span class="normal">    </span><span class="type">unsigned</span><span class="normal"> len</span><span class="symbol">;</span><span class="normal">               </span><span class="comment">/* length to copy for repeats, bits to drop */</span>
<span class="normal">    </span><span class="type">int</span><span class="normal"> ret</span><span class="symbol">;</span><span class="normal">                    </span><span class="comment">/* return code */</span>
<span class="preproc">#ifdef</span><span class="normal"> GUNZIP</span>
<span class="normal">    </span><span class="type">unsigned</span><span class="normal"> </span><span class="type">char</span><span class="normal"> hbuf</span><span class="symbol">[</span><span class="number">4</span><span class="symbol">];</span><span class="normal">      </span><span class="comment">/* buffer for gzip header crc calculation */</span>
<span class="preproc">#endif</span>
<span class="normal">    </span><span class="keyword">static</span><span class="normal"> </span><span class="keyword">const</span><span class="normal"> </span><span class="type">unsigned</span><span class="normal"> </span><span class="type">short</span><span class="normal"> order</span><span class="symbol">[</span><span class="number">19</span><span class="symbol">]</span><span class="normal"> </span><span class="symbol">=</span><span class="normal"> </span><span class="comment">/* permutation of code lengths */</span>
<span class="normal">        </span><span class="cbracket">{</span><span class="number">16</span><span class="symbol">,</span><span class="normal"> </span><span class="number">17</span><span class="symbol">,</span><span class="normal"> </span><span class="number">18</span><span class="symbol">,</span><span class="normal"> </span><span class="number">0</span><span class="symbol">,</span><span class="normal"> </span><span class="number">8</span><span class="symbol">,</span><span class="normal"> </span><span class="number">7</span><span class="symbol">,</span><span class="normal"> </span><span class="number">9</span><span class="symbol">,</span><span class="normal"> </span><span class="number">6</span><span class="symbol">,</span><span class="normal"> </span><span class="number">10</span><span class="symbol">,</span><span class="normal"> </span><span class="number">5</span><span class="symbol">,</span><span class="normal"> </span><span class="number">11</span><span class="symbol">,</span><span class="normal"> </span><span class="number">4</span><span class="symbol">,</span><span class="normal"> </span><span class="number">12</span><span class="symbol">,</span><span class="normal"> </span><span class="number">3</span><span class="symbol">,</span><span class="normal"> </span><span class="number">13</span><span class="symbol">,</span><span class="normal"> </span><span class="number">2</span><span class="symbol">,</span><span class="normal"> </span><span class="number">14</span><span class="symbol">,</span><span class="normal"> </span><span class="number">1</span><span class="symbol">,</span><span class="normal"> </span><span class="number">15</span><span class="cbracket">}</span><span class="symbol">;</span>

<span class="normal">    </span><span class="keyword">if</span><span class="normal"> </span><span class="symbol">(</span><span class="normal">strm </span><span class="symbol">==</span><span class="normal"> Z_NULL </span><span class="symbol">||</span><span class="normal"> strm</span><span class="symbol">-&gt;</span><span class="normal">state </span><span class="symbol">==</span><span class="normal"> Z_NULL </span><span class="symbol">||</span><span class="normal"> strm</span><span class="symbol">-&gt;</span><span class="normal">next_out </span><span class="symbol">==</span><span class="normal"> Z_NULL </span><span class="symbol">||</span>
<span class="normal">        </span><span class="symbol">(</span><span class="normal">strm</span><span class="symbol">-&gt;</span><span class="normal">next_in </span><span class="symbol">==</span><span class="normal"> Z_NULL </span><span class="symbol">&amp;&amp;</span><span class="normal"> strm</span><span class="symbol">-&gt;</span><span class="normal">avail_in </span><span class="symbol">!=</span><span class="normal"> </span><span class="number">0</span><span class="symbol">))</span>
<span class="normal">        </span><span class="keyword">return</span><span class="normal"> Z_STREAM_ERROR</span><span class="symbol">;</span>

<span class="normal">    state </span><span class="symbol">=</span><span class="normal"> </span><span class="symbol">(</span><span class="keyword">struct</span><span class="normal"> </span><span class="classname">inflate_state</span><span class="normal"> FAR </span><span class="symbol">*)</span><span class="normal">strm</span><span class="symbol">-&gt;</span><span class="normal">state</span><span class="symbol">;</span>
<span class="normal">    </span><span class="keyword">if</span><span class="normal"> </span><span class="symbol">(</span><span class="normal">state</span><span class="symbol">-&gt;</span><span class="normal">mode </span><span class="symbol">==</span><span class="normal"> TYPE</span><span class="symbol">)</span><span class="normal"> state</span><span class="symbol">-&gt;</span><span class="normal">mode </span><span class="symbol">=</span><span class="normal"> TYPEDO</span><span class="symbol">;</span><span class="normal">      </span><span class="comment">/* skip check */</span>
<span class="normal">    </span><span class="function">LOAD</span><span class="symbol">();</span>
<span class="normal">    in </span><span class="symbol">=</span><span class="normal"> have</span><span class="symbol">;</span>
<span class="normal">    out </span><span class="symbol">=</span><span class="normal"> left</span><span class="symbol">;</span>
<span class="normal">    ret </span><span class="symbol">=</span><span class="normal"> Z_OK</span><span class="symbol">;</span>
<span class="normal">    </span><span class="keyword">for</span><span class="normal"> </span><span class="symbol">(;;)</span>
<span class="normal">        </span><span class="keyword">switch</span><span class="normal"> </span><span class="symbol">(</span><span class="normal">state</span><span class="symbol">-&gt;</span><span class="normal">mode</span><span class="symbol">)</span><span class="normal"> </span><span class="cbracket">{</span>
<span class="normal">        </span><span class="keyword">case</span><span class="normal"> HEAD</span><span class="symbol">:</span>
<span class="normal">            </span><span class="keyword">if</span><span class="normal"> </span><span class="symbol">(</span><span class="normal">state</span><span class="symbol">-&gt;</span><span class="normal">wrap </span><span class="symbol">==</span><span class="normal"> </span><span class="number">0</span><span class="symbol">)</span><span class="normal"> </span><span class="cbracket">{</span>
<span class="normal">                state</span><span class="symbol">-&gt;</span><span class="normal">mode </span><span class="symbol">=</span><span class="normal"> TYPEDO</span><span class="symbol">;</span>
<span class="normal">                </span><span class="keyword">break</span><span class="symbol">;</span>
<span class="normal">            </span><span class="cbracket">}</span>
<span class="normal">            </span><span class="function">NEEDBITS</span><span class="symbol">(</span><span class="number">16</span><span class="symbol">);</span>
<span class="preproc">#ifdef</span><span class="normal"> GUNZIP</span>
<span class="normal">            </span><span class="keyword">if</span><span class="normal"> </span><span class="symbol">((</span><span class="normal">state</span><span class="symbol">-&gt;</span><span class="normal">wrap </span><span class="symbol">&amp;</span><span class="normal"> </span><span class="number">2</span><span class="symbol">)</span><span class="normal"> </span><span class="symbol">&amp;&amp;</span><span class="normal"> hold </span><span class="symbol">==</span><span class="normal"> </span><span class="number">0x8b1f</span><span class="symbol">)</span><span class="normal"> </span><span class="cbracket">{</span><span class="normal">  </span><span class="comment">/* gzip header */</span>
<span class="normal">                state</span><span class="symbol">-&gt;</span><span class="normal">check </span><span class="symbol">=</span><span class="normal"> </span><span class="function">crc32</span><span class="symbol">(</span><span class="number">0L</span><span class="symbol">,</span><span class="normal"> Z_NULL</span><span class="symbol">,</span><span class="normal"> </span><span class="number">0</span><span class="symbol">);</span>
<span class="normal">                </span><span class="function">CRC2</span><span class="symbol">(</span><span class="normal">state</span><span class="symbol">-&gt;</span><span class="normal">check</span><span class="symbol">,</span><span class="normal"> hold</span><span class="symbol">);</span>
<span class="normal">                </span><span class="function">INITBITS</span><span class="symbol">();</span>
<span class="normal">                state</span><span class="symbol">-&gt;</span><span class="normal">mode </span><span class="symbol">=</span><span class="normal"> FLAGS</span><span class="symbol">;</span>
<span class="normal">                </span><span class="keyword">break</span><span class="symbol">;</span>
<span class="normal">            </span><span class="cbracket">}</span>
<span class="normal">            state</span><span class="symbol">-&gt;</span><span class="normal">flags </span><span class="symbol">=</span><span class="normal"> </span><span class="number">0</span><span class="symbol">;</span><span class="normal">           </span><span class="comment">/* expect zlib header */</span>
<span class="normal">            </span><span class="keyword">if</span><span class="normal"> </span><span class="symbol">(</span><span class="normal">state</span><span class="symbol">-&gt;</span><span class="normal">head </span><span class="symbol">!=</span><span class="normal"> Z_NULL</span><span class="symbol">)</span>
<span class="normal">                state</span><span class="symbol">-&gt;</span><span class="normal">head</span><span class="symbol">-&gt;</span><span class="normal">done </span><span class="symbol">=</span><span class="normal"> </span><span class="symbol">-</span><span class="number">1</span><span class="symbol">;</span>
<span class="normal">            </span><span class="keyword">if</span><span class="normal"> </span><span class="symbol">(!(</span><span class="normal">state</span><span class="symbol">-&gt;</span><span class="normal">wrap </span><span class="symbol">&amp;</span><span class="normal"> </span><span class="number">1</span><span class="symbol">)</span><span class="normal"> </span><span class="symbol">||</span><span class="normal">   </span><span class="comment">/* check if zlib header allowed */</span>
<span class="preproc">#else</span>
<span class="normal">            </span><span class="keyword">if</span><span class="normal"> </span><span class="symbol">(</span>
<span class="preproc">#endif</span>
<span class="normal">                </span><span class="symbol">((</span><span class="function">BITS</span><span class="symbol">(</span><span class="number">8</span><span class="symbol">)</span><span class="normal"> </span><span class="symbol">&lt;&lt;</span><span class="normal"> </span><span class="number">8</span><span class="symbol">)</span><span class="normal"> </span><span class="symbol">+</span><span class="normal"> </span><span class="symbol">(</span><span class="normal">hold </span><span class="symbol">&gt;&gt;</span><span class="normal"> </span><span class="number">8</span><span class="symbol">))</span><span class="normal"> </span><span class="symbol">%</span><span class="normal"> </span><span class="number">31</span><span class="symbol">)</span><span class="normal"> </span><span class="cbracket">{</span>
<span class="normal">                strm</span><span class="symbol">-&gt;</span><span class="normal">msg </span><span class="symbol">=</span><span class="normal"> </span><span class="symbol">(</span><span class="type">char</span><span class="normal"> </span><span class="symbol">*)</span><span class="string">"incorrect header check"</span><span class="symbol">;</span>
<span class="normal">                state</span><span class="symbol">-&gt;</span><span class="normal">mode </span><span class="symbol">=</span><span class="normal"> BAD</span><span class="symbol">;</span>
<span class="normal">                </span><span class="keyword">break</span><span class="symbol">;</span>
<span class="normal">            </span><span class="cbracket">}</span>
<span class="normal">            </span><span class="keyword">if</span><span class="normal"> </span><span class="symbol">(</span><span class="function">BITS</span><span class="symbol">(</span><span class="number">4</span><span class="symbol">)</span><span class="normal"> </span><span class="symbol">!=</span><span class="normal"> Z_DEFLATED</span><span class="symbol">)</span><span class="normal"> </span><span class="cbracket">{</span>
<span class="normal">                strm</span><span class="symbol">-&gt;</span><span class="normal">msg </span><span class="symbol">=</span><span class="normal"> </span><span class="symbol">(</span><span class="type">char</span><span class="normal"> </span><span class="symbol">*)</span><span class="string">"unknown compression method"</span><span class="symbol">;</span>
<span class="normal">                state</span><span class="symbol">-&gt;</span><span class="normal">mode </span><span class="symbol">=</span><span class="normal"> BAD</span><span class="symbol">;</span>
<span class="normal">                </span><span class="keyword">break</span><span class="symbol">;</span>
<span class="normal">            </span><span class="cbracket">}</span>
<span class="normal">            </span><span class="function">DROPBITS</span><span class="symbol">(</span><span class="number">4</span><span class="symbol">);</span>
<span class="normal">            len </span><span class="symbol">=</span><span class="normal"> </span><span class="function">BITS</span><span class="symbol">(</span><span class="number">4</span><span class="symbol">)</span><span class="normal"> </span><span class="symbol">+</span><span class="normal"> </span><span class="number">8</span><span class="symbol">;</span>
<span class="normal">            </span><span class="keyword">if</span><span class="normal"> </span><span class="symbol">(</span><span class="normal">len </span><span class="symbol">&gt;</span><span class="normal"> state</span><span class="symbol">-&gt;</span><span class="normal">wbits</span><span class="symbol">)</span><span class="normal"> </span><span class="cbracket">{</span>
<span class="normal">                strm</span><span class="symbol">-&gt;</span><span class="normal">msg </span><span class="symbol">=</span><span class="normal"> </span><span class="symbol">(</span><span class="type">char</span><span class="normal"> </span><span class="symbol">*)</span><span class="string">"invalid window size"</span><span class="symbol">;</span>
<span class="normal">                state</span><span class="symbol">-&gt;</span><span class="normal">mode </span><span class="symbol">=</span><span class="normal"> BAD</span><span class="symbol">;</span>
<span class="normal">                </span><span class="keyword">break</span><span class="symbol">;</span>
<span class="normal">            </span><span class="cbracket">}</span>
<span class="normal">            state</span><span class="symbol">-&gt;</span><span class="normal">dmax </span><span class="symbol">=</span><span class="normal"> 1U </span><span class="symbol">&lt;&lt;</span><span class="normal"> len</span><span class="symbol">;</span>
<span class="normal">            </span><span class="function">Tracev</span><span class="symbol">((</span><span class="normal">stderr</span><span class="symbol">,</span><span class="normal"> </span><span class="string">"inflate:   zlib header ok</span><span class="specialchar">\n</span><span class="string">"</span><span class="symbol">));</span>
<span class="normal">            strm</span><span class="symbol">-&gt;</span><span class="normal">adler </span><span class="symbol">=</span><span class="normal"> state</span><span class="symbol">-&gt;</span><span class="normal">check </span><span class="symbol">=</span><span class="normal"> </span><span class="function">adler32</span><span class="symbol">(</span><span class="number">0L</span><span class="symbol">,</span><span class="normal"> Z_NULL</span><span class="symbol">,</span><span class="normal"> </span><span class="number">0</span><span class="symbol">);</span>
<span class="normal">            state</span><span class="symbol">-&gt;</span><span class="normal">mode </span><span class="symbol">=</span><span class="normal"> hold </span><span class="symbol">&amp;</span><span class="normal"> </span><span class="number">0x200</span><span class="normal"> </span><span class="symbol">?</span><span class="normal"> DICTID </span><span class="symbol">:</span><span class="normal"> TYPE</span><span class="symbol">;</span>
<span class="normal">            </span><span class="function">INITBITS</span><span class="symbol">();</span>
<span class="normal">            </span><span class="keyword">break</span><span class="symbol">;</span>
<span class="preproc">#ifdef</span><span class="normal"> GUNZIP</span>
<span class="normal">        </span><span class="keyword">case</span><span class="normal"> FLAGS</span><span class="symbol">:</span>
<span class="normal">            </span><span class="function">NEEDBITS</span><span class="symbol">(</span><span class="number">16</span><span class="symbol">);</span>
<span class="normal">            state</span><span class="symbol">-&gt;</span><span class="normal">flags </span><span class="symbol">=</span><span class="normal"> </span><span class="symbol">(</span><span class="type">int</span><span class="symbol">)(</span><span class="normal">hold</span><span class="symbol">);</span>
<span class="normal">            </span><span class="keyword">if</span><span class="normal"> </span><span class="symbol">((</span><span class="normal">state</span><span class="symbol">-&gt;</span><span class="normal">flags </span><span class="symbol">&amp;</span><span class="normal"> </span><span class="number">0xff</span><span class="symbol">)</span><span class="normal"> </span><span class="symbol">!=</span><span class="normal"> Z_DEFLATED</span><span class="symbol">)</span><span class="normal"> </span><span class="cbracket">{</span>
<span class="normal">                strm</span><span class="symbol">-&gt;</span><span class="normal">msg </span><span class="symbol">=</span><span class="normal"> </span><span class="symbol">(</span><span class="type">char</span><span class="normal"> </span><span class="symbol">*)</span><span class="string">"unknown compression method"</span><span class="symbol">;</span>
<span class="normal">                state</span><span class="symbol">-&gt;</span><span class="normal">mode </span><span class="symbol">=</span><span class="normal"> BAD</span><span class="symbol">;</span>
<span class="normal">                </span><span class="keyword">break</span><span class="symbol">;</span>
<span class="normal">            </span><span class="cbracket">}</span>
<span class="normal">            </span><span class="keyword">if</span><span class="normal"> </span><span class="symbol">(</span><span class="normal">state</span><span class="symbol">-&gt;</span><span class="normal">flags </span><span class="symbol">&amp;</span><span class="normal"> </span><span class="number">0xe000</span><span class="symbol">)</span><span class="normal"> </span><span class="cbracket">{</span>
<span class="normal">                strm</span><span class="symbol">-&gt;</span><span class="normal">msg </span><span class="symbol">=</span><span class="normal"> </span><span class="symbol">(</span><span class="type">char</span><span class="normal"> </span><span class="symbol">*)</span><span class="string">"unknown header flags set"</span><span class="symbol">;</span>
<span class="normal">                state</span><span class="symbol">-&gt;</span><span class="normal">mode </span><span class="symbol">=</span><span class="normal"> BAD</span><span class="symbol">;</span>
<span class="normal">                </span><span class="keyword">break</span><span class="symbol">;</span>
<span class="normal">            </span><span class="cbracket">}</span>
<span class="normal">            </span><span class="keyword">if</span><span class="normal"> </span><span class="symbol">(</span><span class="normal">state</span><span class="symbol">-&gt;</span><span class="normal">head </span><span class="symbol">!=</span><span class="normal"> Z_NULL</span><span class="symbol">)</span>
<span class="normal">                state</span><span class="symbol">-&gt;</span><span class="normal">head</span><span class="symbol">-&gt;</span><span class="normal">text </span><span class="symbol">=</span><span class="normal"> </span><span class="symbol">(</span><span class="type">int</span><span class="symbol">)((</span><span class="normal">hold </span><span class="symbol">&gt;&gt;</span><span class="normal"> </span><span class="number">8</span><span class="symbol">)</span><span class="normal"> </span><span class="symbol">&amp;</span><span class="normal"> </span><span class="number">1</span><span class="symbol">);</span>
<span class="normal">            </span><span class="keyword">if</span><span class="normal"> </span><span class="symbol">(</span><span class="normal">state</span><span class="symbol">-&gt;</span><span class="normal">flags </span><span class="symbol">&amp;</span><span class="normal"> </span><span class="number">0x0200</span><span class="symbol">)</span><span class="normal"> </span><span class="function">CRC2</span><span class="symbol">(</span><span class="normal">state</span><span class="symbol">-&gt;</span><span class="normal">check</span><span class="symbol">,</span><span class="normal"> hold</span><span class="symbol">);</span>
<span class="normal">            </span><span class="function">INITBITS</span><span class="symbol">();</span>
<span class="normal">            state</span><span class="symbol">-&gt;</span><span class="normal">mode </span><span class="symbol">=</span><span class="normal"> TIME</span><span class="symbol">;</span>
<span class="normal">        </span><span class="keyword">case</span><span class="normal"> TIME</span><span class="symbol">:</span>
<span class="normal">            </span><span class="function">NEEDBITS</span><span class="symbol">(</span><span class="number">32</span><span class="symbol">);</span>
<span class="normal">            </span><span class="keyword">if</span><span class="normal"> </span><span class="symbol">(</span><span class="normal">state</span><span class="symbol">-&gt;</span><span class="normal">head </span><span class="symbol">!=</span><span class="normal"> Z_NULL</span><span class="symbol">)</span>
<span class="normal">                state</span><span class="symbol">-&gt;</span><span class="normal">head</span><span class="symbol">-&gt;</span><span class="normal">time </span><span class="symbol">=</span><span class="normal"> hold</span><span class="symbol">;</span>
<span class="normal">            </span><span class="keyword">if</span><span class="normal"> </span><span class="symbol">(</span><span class="normal">state</span><span class="symbol">-&gt;</span><span class="normal">flags </span><span class="symbol">&amp;</span><span class="normal"> </span><span class="number">0x0200</span><span class="symbol">)</span><span class="normal"> </span><span class="function">CRC4</span><span class="symbol">(</span><span class="normal">state</span><span class="symbol">-&gt;</span><span class="normal">check</span><span class="symbol">,</span><span class="normal"> hold</span><span class="symbol">);</span>
<span class="normal">            </span><span class="function">INITBITS</span><span class="symbol">();</span>
<span class="normal">            state</span><span class="symbol">-&gt;</span><span class="normal">mode </span><span class="symbol">=</span><span class="normal"> OS</span><span class="symbol">;</span>
<span class="normal">        </span><span class="keyword">case</span><span class="normal"> OS</span><span class="symbol">:</span>
<span class="normal">            </span><span class="function">NEEDBITS</span><span class="symbol">(</span><span class="number">16</span><span class="symbol">);</span>
<span class="normal">            </span><span class="keyword">if</span><span class="normal"> </span><span class="symbol">(</span><span class="normal">state</span><span class="symbol">-&gt;</span><span class="normal">head </span><span class="symbol">!=</span><span class="normal"> Z_NULL</span><span class="symbol">)</span><span class="normal"> </span><span class="cbracket">{</span>
<span class="normal">                state</span><span class="symbol">-&gt;</span><span class="normal">head</span><span class="symbol">-&gt;</span><span class="normal">xflags </span><span class="symbol">=</span><span class="normal"> </span><span class="symbol">(</span><span class="type">int</span><span class="symbol">)(</span><span class="normal">hold </span><span class="symbol">&amp;</span><span class="normal"> </span><span class="number">0xff</span><span class="symbol">);</span>
<span class="normal">                state</span><span class="symbol">-&gt;</span><span class="normal">head</span><span class="symbol">-&gt;</span><span class="normal">os </span><span class="symbol">=</span><span class="normal"> </span><span class="symbol">(</span><span class="type">int</span><span class="symbol">)(</span><span class="normal">hold </span><span class="symbol">&gt;&gt;</span><span class="normal"> </span><span class="number">8</span><span class="symbol">);</span>
<span class="normal">            </span><span class="cbracket">}</span>
<span class="normal">            </span><span class="keyword">if</span><span class="normal"> </span><span class="symbol">(</span><span class="normal">state</span><span class="symbol">-&gt;</span><span class="normal">flags </span><span class="symbol">&amp;</span><span class="normal"> </span><span class="number">0x0200</span><span class="symbol">)</span><span class="normal"> </span><span class="function">CRC2</span><span class="symbol">(</span><span class="normal">state</span><span class="symbol">-&gt;</span><span class="normal">check</span><span class="symbol">,</span><span class="normal"> hold</span><span class="symbol">);</span>
<span class="normal">            </span><span class="function">INITBITS</span><span class="symbol">();</span>
<span class="normal">            state</span><span class="symbol">-&gt;</span><span class="normal">mode </span><span class="symbol">=</span><span class="normal"> EXLEN</span><span class="symbol">;</span>
<span class="normal">        </span><span class="keyword">case</span><span class="normal"> EXLEN</span><span class="symbol">:</span>
<span class="normal">            </span><span class="keyword">if</span><span class="normal"> </span><span class="symbol">(</span><span class="normal">state</span><span class="symbol">-&gt;</span><span class="normal">flags </span><span class="symbol">&amp;</span><span class="normal"> </span><span class="number">0x0400</span><span class="symbol">)</span><span class="normal"> </span><span class="cbracket">{</span>
<span class="normal">                </span><span class="function">NEEDBITS</span><span class="symbol">(</span><span class="number">16</span><span class="symbol">);</span>
<span class="normal">                state</span><span class="symbol">-&gt;</span><span class="normal">length </span><span class="symbol">=</span><span class="normal"> </span><span class="symbol">(</span><span class="type">unsigned</span><span class="symbol">)(</span><span class="normal">hold</span><span class="symbol">);</span>
<span class="normal">                </span><span class="keyword">if</span><span class="normal"> </span><span class="symbol">(</span><span class="normal">state</span><span class="symbol">-&gt;</span><span class="normal">head </span><span class="symbol">!=</span><span class="normal"> Z_NULL</span><span class="symbol">)</span>
<span class="normal">                    state</span><span class="symbol">-&gt;</span><span class="normal">head</span><span class="symbol">-&gt;</span><span class="normal">extra_len </span><span class="symbol">=</span><span class="normal"> </span><span class="symbol">(</span><span class="type">unsigned</span><span class="symbol">)</span><span class="normal">hold</span><span class="symbol">;</span>
<span class="normal">                </span><span class="keyword">if</span><span class="normal"> </span><span class="symbol">(</span><span class="normal">state</span><span class="symbol">-&gt;</span><span class="normal">flags </span><span class="symbol">&amp;</span><span class="normal"> </span><span class="number">0x0200</span><span class="symbol">)</span><span class="normal"> </span><span class="function">CRC2</span><span class="symbol">(</span><span class="normal">state</span><span class="symbol">-&gt;</span><span class="normal">check</span><span class="symbol">,</span><span class="normal"> hold</span><span class="symbol">);</span>
<span class="normal">                </span><span class="function">INITBITS</span><span class="symbol">();</span>
<span class="normal">            </span><span class="cbracket">}</span>
<span class="normal">            </span><span class="keyword">else</span><span class="normal"> </span><span class="keyword">if</span><span class="normal"> </span><span class="symbol">(</span><span class="normal">state</span><span class="symbol">-&gt;</span><span class="normal">head </span><span class="symbol">!=</span><span class="normal"> Z_NULL</span><span class="symbol">)</span>
<span class="normal">                state</span><span class="symbol">-&gt;</span><span class="normal">head</span><span class="symbol">-&gt;</span><span class="normal">extra </span><span class="symbol">=</span><span class="normal"> Z_NULL</span><span class="symbol">;</span>
<span class="normal">            state</span><span class="symbol">-&gt;</span><span class="normal">mode </span><span class="symbol">=</span><span class="normal"> EXTRA</span><span class="symbol">;</span>
<span class="normal">        </span><span class="keyword">case</span><span class="normal"> EXTRA</span><span class="symbol">:</span>
<span class="normal">            </span><span class="keyword">if</span><span class="normal"> </span><span class="symbol">(</span><span class="normal">state</span><span class="symbol">-&gt;</span><span class="normal">flags </span><span class="symbol">&amp;</span><span class="normal"> </span><span class="number">0x0400</span><span class="symbol">)</span><span class="normal"> </span><span class="cbracket">{</span>
<span class="normal">                copy </span><span class="symbol">=</span><span class="normal"> state</span><span class="symbol">-&gt;</span><span class="normal">length</span><span class="symbol">;</span>
<span class="normal">                </span><span class="keyword">if</span><span class="normal"> </span><span class="symbol">(</span><span class="normal">copy </span><span class="symbol">&gt;</span><span class="normal"> have</span><span class="symbol">)</span><span class="normal"> copy </span><span class="symbol">=</span><span class="normal"> have</span><span class="symbol">;</span>
<span class="normal">                </span><span class="keyword">if</span><span class="normal"> </span><span class="symbol">(</span><span class="normal">copy</span><span class="symbol">)</span><span class="normal"> </span><span class="cbracket">{</span>
<span class="normal">                    </span><span class="keyword">if</span><span class="normal"> </span><span class="symbol">(</span><span class="normal">state</span><span class="symbol">-&gt;</span><span class="normal">head </span><span class="symbol">!=</span><span class="normal"> Z_NULL </span><span class="symbol">&amp;&amp;</span>
<span class="normal">                        state</span><span class="symbol">-&gt;</span><span class="normal">head</span><span class="symbol">-&gt;</span><span class="normal">extra </span><span class="symbol">!=</span><span class="normal"> Z_NULL</span><span class="symbol">)</span><span class="normal"> </span><span class="cbracket">{</span>
<span class="normal">                        len </span><span class="symbol">=</span><span class="normal"> state</span><span class="symbol">-&gt;</span><span class="normal">head</span><span class="symbol">-&gt;</span><span class="normal">extra_len </span><span class="symbol">-</span><span class="normal"> state</span><span class="symbol">-&gt;</span><span class="normal">length</span><span class="symbol">;</span>
<span class="normal">                        </span><span class="function">zmemcpy</span><span class="symbol">(</span><span class="normal">state</span><span class="symbol">-&gt;</span><span class="normal">head</span><span class="symbol">-&gt;</span><span class="normal">extra </span><span class="symbol">+</span><span class="normal"> len</span><span class="symbol">,</span><span class="normal"> next</span><span class="symbol">,</span>
<span class="normal">                                len </span><span class="symbol">+</span><span class="normal"> copy </span><span class="symbol">&gt;</span><span class="normal"> state</span><span class="symbol">-&gt;</span><span class="normal">head</span><span class="symbol">-&gt;</span><span class="normal">extra_max </span><span class="symbol">?</span>
<span class="normal">                                state</span><span class="symbol">-&gt;</span><span class="normal">head</span><span class="symbol">-&gt;</span><span class="normal">extra_max </span><span class="symbol">-</span><span class="normal"> len </span><span class="symbol">:</span><span class="normal"> copy</span><span class="symbol">);</span>
<span class="normal">                    </span><span class="cbracket">}</span>
<span class="normal">                    </span><span class="keyword">if</span><span class="normal"> </span><span class="symbol">(</span><span class="normal">state</span><span class="symbol">-&gt;</span><span class="normal">flags </span><span class="symbol">&amp;</span><span class="normal"> </span><span class="number">0x0200</span><span class="symbol">)</span>
<span class="normal">                        state</span><span class="symbol">-&gt;</span><span class="normal">check </span><span class="symbol">=</span><span class="normal"> </span><span class="function">crc32</span><span class="symbol">(</span><span class="normal">state</span><span class="symbol">-&gt;</span><span class="normal">check</span><span class="symbol">,</span><span class="normal"> next</span><span class="symbol">,</span><span class="normal"> copy</span><span class="symbol">);</span>
<span class="normal">                    have </span><span class="symbol">-=</span><span class="normal"> copy</span><span class="symbol">;</span>
<span class="normal">                    next </span><span class="symbol">+=</span><span class="normal"> copy</span><span class="symbol">;</span>
<span class="normal">                    state</span><span class="symbol">-&gt;</span><span class="normal">length </span><span class="symbol">-=</span><span class="normal"> copy</span><span class="symbol">;</span>
<span class="normal">                </span><span class="cbracket">}</span>
<span class="normal">                </span><span class="keyword">if</span><span class="normal"> </span><span class="symbol">(</span><span class="normal">state</span><span class="symbol">-&gt;</span><span class="normal">length</span><span class="symbol">)</span><span class="normal"> </span><span class="keyword">goto</span><span class="normal"> inf_leave</span><span class="symbol">;</span>
<span class="normal">            </span><span class="cbracket">}</span>
<span class="normal">            state</span><span class="symbol">-&gt;</span><span class="normal">length </span><span class="symbol">=</span><span class="normal"> </span><span class="number">0</span><span class="symbol">;</span>
<span class="normal">            state</span><span class="symbol">-&gt;</span><span class="normal">mode </span><span class="symbol">=</span><span class="normal"> NAME</span><span class="symbol">;</span>
<span class="normal">        </span><span class="keyword">case</span><span class="normal"> NAME</span><span class="symbol">:</span>
<span class="normal">            </span><span class="keyword">if</span><span class="normal"> </span><span class="symbol">(</span><span class="normal">state</span><span class="symbol">-&gt;</span><span class="normal">flags </span><span class="symbol">&amp;</span><span class="normal"> </span><span class="number">0x0800</span><span class="symbol">)</span><span class="normal"> </span><span class="cbracket">{</span>
<span class="normal">                </span><span class="keyword">if</span><span class="normal"> </span><span class="symbol">(</span><span class="normal">have </span><span class="symbol">==</span><span class="normal"> </span><span class="number">0</span><span class="symbol">)</span><span class="normal"> </span><span class="keyword">goto</span><span class="normal"> inf_leave</span><span class="symbol">;</span>
<span class="normal">                copy </span><span class="symbol">=</span><span class="normal"> </span><span class="number">0</span><span class="symbol">;</span>
<span class="normal">                </span><span class="keyword">do</span><span class="normal"> </span><span class="cbracket">{</span>
<span class="normal">                    len </span><span class="symbol">=</span><span class="normal"> </span><span class="symbol">(</span><span class="type">unsigned</span><span class="symbol">)(</span><span class="normal">next</span><span class="symbol">[</span><span class="normal">copy</span><span class="symbol">++]);</span>
<span class="normal">                    </span><span class="keyword">if</span><span class="normal"> </span><span class="symbol">(</span><span class="normal">state</span><span class="symbol">-&gt;</span><span class="normal">head </span><span class="symbol">!=</span><span class="normal"> Z_NULL </span><span class="symbol">&amp;&amp;</span>
<span class="normal">                            state</span><span class="symbol">-&gt;</span><span class="normal">head</span><span class="symbol">-&gt;</span><span class="normal">name </span><span class="symbol">!=</span><span class="normal"> Z_NULL </span><span class="symbol">&amp;&amp;</span>
<span class="normal">                            state</span><span class="symbol">-&gt;</span><span class="normal">length </span><span class="symbol">&lt;</span><span class="normal"> state</span><span class="symbol">-&gt;</span><span class="normal">head</span><span class="symbol">-&gt;</span><span class="normal">name_max</span><span class="symbol">)</span>
<span class="normal">                        state</span><span class="symbol">-&gt;</span><span class="normal">head</span><span class="symbol">-&gt;</span><span class="normal">name</span><span class="symbol">[</span><span class="normal">state</span><span class="symbol">-&gt;</span><span class="normal">length</span><span class="symbol">++]</span><span class="normal"> </span><span class="symbol">=</span><span class="normal"> len</span><span class="symbol">;</span>
<span class="normal">                </span><span class="cbracket">}</span><span class="normal"> </span><span class="keyword">while</span><span class="normal"> </span><span class="symbol">(</span><span class="normal">len </span><span class="symbol">&amp;&amp;</span><span class="normal"> copy </span><span class="symbol">&lt;</span><span class="normal"> have</span><span class="symbol">);</span>
<span class="normal">                </span><span class="keyword">if</span><span class="normal"> </span><span class="symbol">(</span><span class="normal">state</span><span class="symbol">-&gt;</span><span class="normal">flags </span><span class="symbol">&amp;</span><span class="normal"> </span><span class="number">0x0200</span><span class="symbol">)</span>
<span class="normal">                    state</span><span class="symbol">-&gt;</span><span class="normal">check </span><span class="symbol">=</span><span class="normal"> </span><span class="function">crc32</span><span class="symbol">(</span><span class="normal">state</span><span class="symbol">-&gt;</span><span class="normal">check</span><span class="symbol">,</span><span class="normal"> next</span><span class="symbol">,</span><span class="normal"> copy</span><span class="symbol">);</span>
<span class="normal">                have </span><span class="symbol">-=</span><span class="normal"> copy</span><span class="symbol">;</span>
<span class="normal">                next </span><span class="symbol">+=</span><span class="normal"> copy</span><span class="symbol">;</span>
<span class="normal">                </span><span class="keyword">if</span><span class="normal"> </span><span class="symbol">(</span><span class="normal">len</span><span class="symbol">)</span><span class="normal"> </span><span class="keyword">goto</span><span class="normal"> inf_leave</span><span class="symbol">;</span>
<span class="normal">            </span><span class="cbracket">}</span>
<span class="normal">            </span><span class="keyword">else</span><span class="normal"> </span><span class="keyword">if</span><span class="normal"> </span><span class="symbol">(</span><span class="normal">state</span><span class="symbol">-&gt;</span><span class="normal">head </span><span class="symbol">!=</span><span class="normal"> Z_NULL</span><span class="symbol">)</span>
<span class="normal">                state</span><span class="symbol">-&gt;</span><span class="normal">head</span><span class="symbol">-&gt;</span><span class="normal">name </span><span class="symbol">=</span><span class="normal"> Z_NULL</span><span class="symbol">;</span>
<span class="normal">            state</span><span class="symbol">-&gt;</span><span class="normal">length </span><span class="symbol">=</span><span class="normal"> </span><span class="number">0</span><span class="symbol">;</span>
<span class="normal">            state</span><span class="symbol">-&gt;</span><span class="normal">mode </span><span class="symbol">=</span><span class="normal"> COMMENT</span><span class="symbol">;</span>
<span class="normal">        </span><span class="keyword">case</span><span class="normal"> COMMENT</span><span class="symbol">:</span>
<span class="normal">            </span><span class="keyword">if</span><span class="normal"> </span><span class="symbol">(</span><span class="normal">state</span><span class="symbol">-&gt;</span><span class="normal">flags </span><span class="symbol">&amp;</span><span class="normal"> </span><span class="number">0x1000</span><span class="symbol">)</span><span class="normal"> </span><span class="cbracket">{</span>
<span class="normal">                </span><span class="keyword">if</span><span class="normal"> </span><span class="symbol">(</span><span class="normal">have </span><span class="symbol">==</span><span class="normal"> </span><span class="number">0</span><span class="symbol">)</span><span class="normal"> </span><span class="keyword">goto</span><span class="normal"> inf_leave</span><span class="symbol">;</span>
<span class="normal">                copy </span><span class="symbol">=</span><span class="normal"> </span><span class="number">0</span><span class="symbol">;</span>
<span class="normal">                </span><span class="keyword">do</span><span class="normal"> </span><span class="cbracket">{</span>
<span class="normal">                    len </span><span class="symbol">=</span><span class="normal"> </span><span class="symbol">(</span><span class="type">unsigned</span><span class="symbol">)(</span><span class="normal">next</span><span class="symbol">[</span><span class="normal">copy</span><span class="symbol">++]);</span>
<span class="normal">                    </span><span class="keyword">if</span><span class="normal"> </span><span class="symbol">(</span><span class="normal">state</span><span class="symbol">-&gt;</span><span class="normal">head </span><span class="symbol">!=</span><span class="normal"> Z_NULL </span><span class="symbol">&amp;&amp;</span>
<span class="normal">                            state</span><span class="symbol">-&gt;</span><span class="normal">head</span><span class="symbol">-&gt;</span><span class="normal">comment </span><span class="symbol">!=</span><span class="normal"> Z_NULL </span><span class="symbol">&amp;&amp;</span>
<span class="normal">                            state</span><span class="symbol">-&gt;</span><span class="normal">length </span><span class="symbol">&lt;</span><span class="normal"> state</span><span class="symbol">-&gt;</span><span class="normal">head</span><span class="symbol">-&gt;</span><span class="normal">comm_max</span><span class="symbol">)</span>
<span class="normal">                        state</span><span class="symbol">-&gt;</span><span class="normal">head</span><span class="symbol">-&gt;</span><span class="normal">comment</span><span class="symbol">[</span><span class="normal">state</span><span class="symbol">-&gt;</span><span class="normal">length</span><span class="symbol">++]</span><span class="normal"> </span><span class="symbol">=</span><span class="normal"> len</span><span class="symbol">;</span>
<span class="normal">                </span><span class="cbracket">}</span><span class="normal"> </span><span class="keyword">while</span><span class="normal"> </span><span class="symbol">(</span><span class="normal">len </span><span class="symbol">&amp;&amp;</span><span class="normal"> copy </span><span class="symbol">&lt;</span><span class="normal"> have</span><span class="symbol">);</span>
<span class="normal">                </span><span class="keyword">if</span><span class="normal"> </span><span class="symbol">(</span><span class="normal">state</span><span class="symbol">-&gt;</span><span class="normal">flags </span><span class="symbol">&amp;</span><span class="normal"> </span><span class="number">0x0200</span><span class="symbol">)</span>
<span class="normal">                    state</span><span class="symbol">-&gt;</span><span class="normal">check </span><span class="symbol">=</span><span class="normal"> </span><span class="function">crc32</span><span class="symbol">(</span><span class="normal">state</span><span class="symbol">-&gt;</span><span class="normal">check</span><span class="symbol">,</span><span class="normal"> next</span><span class="symbol">,</span><span class="normal"> copy</span><span class="symbol">);</span>
<span class="normal">                have </span><span class="symbol">-=</span><span class="normal"> copy</span><span class="symbol">;</span>
<span class="normal">                next </span><span class="symbol">+=</span><span class="normal"> copy</span><span class="symbol">;</span>
<span class="normal">                </span><span class="keyword">if</span><span class="normal"> </span><span class="symbol">(</span><span class="normal">len</span><span class="symbol">)</span><span class="normal"> </span><span class="keyword">goto</span><span class="normal"> inf_leave</span><span class="symbol">;</span>
<span class="normal">            </span><span class="cbracket">}</span>
<span class="normal">            </span><span class="keyword">else</span><span class="normal"> </span><span class="keyword">if</span><span class="normal"> </span><span class="symbol">(</span><span class="normal">state</span><span class="symbol">-&gt;</span><span class="normal">head </span><span class="symbol">!=</span><span class="normal"> Z_NULL</span><span class="symbol">)</span>
<span class="normal">                state</span><span class="symbol">-&gt;</span><span class="normal">head</span><span class="symbol">-&gt;</span><span class="normal">comment </span><span class="symbol">=</span><span class="normal"> Z_NULL</span><span class="symbol">;</span>
<span class="normal">            state</span><span class="symbol">-&gt;</span><span class="normal">mode </span><span class="symbol">=</span><span class="normal"> HCRC</span><span class="symbol">;</span>
<span class="normal">        </span><span class="keyword">case</span><span class="normal"> HCRC</span><span class="symbol">:</span>
<span class="normal">            </span><span class="keyword">if</span><span class="normal"> </span><span class="symbol">(</span><span class="normal">state</span><span class="symbol">-&gt;</span><span class="normal">flags </span><span class="symbol">&amp;</span><span class="normal"> </span><span class="number">0x0200</span><span class="symbol">)</span><span class="normal"> </span><span class="cbracket">{</span>
<span class="normal">                </span><span class="function">NEEDBITS</span><span class="symbol">(</span><span class="number">16</span><span class="symbol">);</span>
<span class="normal">                </span><span class="keyword">if</span><span class="normal"> </span><span class="symbol">(</span><span class="normal">hold </span><span class="symbol">!=</span><span class="normal"> </span><span class="symbol">(</span><span class="normal">state</span><span class="symbol">-&gt;</span><span class="normal">check </span><span class="symbol">&amp;</span><span class="normal"> </span><span class="number">0xffff</span><span class="symbol">))</span><span class="normal"> </span><span class="cbracket">{</span>
<span class="normal">                    strm</span><span class="symbol">-&gt;</span><span class="normal">msg </span><span class="symbol">=</span><span class="normal"> </span><span class="symbol">(</span><span class="type">char</span><span class="normal"> </span><span class="symbol">*)</span><span class="string">"header crc mismatch"</span><span class="symbol">;</span>
<span class="normal">                    state</span><span class="symbol">-&gt;</span><span class="normal">mode </span><span class="symbol">=</span><span class="normal"> BAD</span><span class="symbol">;</span>
<span class="normal">                    </span><span class="keyword">break</span><span class="symbol">;</span>
<span class="normal">                </span><span class="cbracket">}</span>
<span class="normal">                </span><span class="function">INITBITS</span><span class="symbol">();</span>
<span class="normal">            </span><span class="cbracket">}</span>
<span class="normal">            </span><span class="keyword">if</span><span class="normal"> </span><span class="symbol">(</span><span class="normal">state</span><span class="symbol">-&gt;</span><span class="normal">head </span><span class="symbol">!=</span><span class="normal"> Z_NULL</span><span class="symbol">)</span><span class="normal"> </span><span class="cbracket">{</span>
<span class="normal">                state</span><span class="symbol">-&gt;</span><span class="normal">head</span><span class="symbol">-&gt;</span><span class="normal">hcrc </span><span class="symbol">=</span><span class="normal"> </span><span class="symbol">(</span><span class="type">int</span><span class="symbol">)((</span><span class="normal">state</span><span class="symbol">-&gt;</span><span class="normal">flags </span><span class="symbol">&gt;&gt;</span><span class="normal"> </span><span class="number">9</span><span class="symbol">)</span><span class="normal"> </span><span class="symbol">&amp;</span><span class="normal"> </span><span class="number">1</span><span class="symbol">);</span>
<span class="normal">                state</span><span class="symbol">-&gt;</span><span class="normal">head</span><span class="symbol">-&gt;</span><span class="normal">done </span><span class="symbol">=</span><span class="normal"> </span><span class="number">1</span><span class="symbol">;</span>
<span class="normal">            </span><span class="cbracket">}</span>
<span class="normal">            strm</span><span class="symbol">-&gt;</span><span class="normal">adler </span><span class="symbol">=</span><span class="normal"> state</span><span class="symbol">-&gt;</span><span class="normal">check </span><span class="symbol">=</span><span class="normal"> </span><span class="function">crc32</span><span class="symbol">(</span><span class="number">0L</span><span class="symbol">,</span><span class="normal"> Z_NULL</span><span class="symbol">,</span><span class="normal"> </span><span class="number">0</span><span class="symbol">);</span>
<span class="normal">            state</span><span class="symbol">-&gt;</span><span class="normal">mode </span><span class="symbol">=</span><span class="normal"> TYPE</span><span class="symbol">;</span>
<span class="normal">            </span><span class="keyword">break</span><span class="symbol">;</span>
<span class="preproc">#endif</span>
<span class="normal">        </span><span class="keyword">case</span><span class="normal"> DICTID</span><span class="symbol">:</span>
<span class="normal">            </span><span class="function">NEEDBITS</span><span class="symbol">(</span><span class="number">32</span><span class="symbol">);</span>
<span class="normal">            strm</span><span class="symbol">-&gt;</span><span class="normal">adler </span><span class="symbol">=</span><span class="normal"> state</span><span class="symbol">-&gt;</span><span class="normal">check </span><span class="symbol">=</span><span class="normal"> </span><span class="function">REVERSE</span><span class="symbol">(</span><span class="normal">hold</span><span class="symbol">);</span>
<span class="normal">            </span><span class="function">INITBITS</span><span class="symbol">();</span>
<span class="normal">            state</span><span class="symbol">-&gt;</span><span class="normal">mode </span><span class="symbol">=</span><span class="normal"> DICT</span><span class="symbol">;</span>
<span class="normal">        </span><span class="keyword">case</span><span class="normal"> DICT</span><span class="symbol">:</span>
<span class="normal">            </span><span class="keyword">if</span><span class="normal"> </span><span class="symbol">(</span><span class="normal">state</span><span class="symbol">-&gt;</span><span class="normal">havedict </span><span class="symbol">==</span><span class="normal"> </span><span class="number">0</span><span class="symbol">)</span><span class="normal"> </span><span class="cbracket">{</span>
<span class="normal">                </span><span class="function">RESTORE</span><span class="symbol">();</span>
<span class="normal">                </span><span class="keyword">return</span><span class="normal"> Z_NEED_DICT</span><span class="symbol">;</span>
<span class="normal">            </span><span class="cbracket">}</span>
<span class="normal">            strm</span><span class="symbol">-&gt;</span><span class="normal">adler </span><span class="symbol">=</span><span class="normal"> state</span><span class="symbol">-&gt;</span><span class="normal">check </span><span class="symbol">=</span><span class="normal"> </span><span class="function">adler32</span><span class="symbol">(</span><span class="number">0L</span><span class="symbol">,</span><span class="normal"> Z_NULL</span><span class="symbol">,</span><span class="normal"> </span><span class="number">0</span><span class="symbol">);</span>
<span class="normal">            state</span><span class="symbol">-&gt;</span><span class="normal">mode </span><span class="symbol">=</span><span class="normal"> TYPE</span><span class="symbol">;</span>
<span class="normal">        </span><span class="keyword">case</span><span class="normal"> TYPE</span><span class="symbol">:</span>
<span class="normal">            </span><span class="keyword">if</span><span class="normal"> </span><span class="symbol">(</span><span class="normal">flush </span><span class="symbol">==</span><span class="normal"> Z_BLOCK</span><span class="symbol">)</span><span class="normal"> </span><span class="keyword">goto</span><span class="normal"> inf_leave</span><span class="symbol">;</span>
<span class="normal">        </span><span class="keyword">case</span><span class="normal"> TYPEDO</span><span class="symbol">:</span>
<span class="normal">            </span><span class="keyword">if</span><span class="normal"> </span><span class="symbol">(</span><span class="normal">state</span><span class="symbol">-&gt;</span><span class="normal">last</span><span class="symbol">)</span><span class="normal"> </span><span class="cbracket">{</span>
<span class="normal">                </span><span class="function">BYTEBITS</span><span class="symbol">();</span>
<span class="normal">                state</span><span class="symbol">-&gt;</span><span class="normal">mode </span><span class="symbol">=</span><span class="normal"> CHECK</span><span class="symbol">;</span>
<span class="normal">                </span><span class="keyword">break</span><span class="symbol">;</span>
<span class="normal">            </span><span class="cbracket">}</span>
<span class="normal">            </span><span class="function">NEEDBITS</span><span class="symbol">(</span><span class="number">3</span><span class="symbol">);</span>
<span class="normal">            state</span><span class="symbol">-&gt;</span><span class="normal">last </span><span class="symbol">=</span><span class="normal"> </span><span class="function">BITS</span><span class="symbol">(</span><span class="number">1</span><span class="symbol">);</span>
<span class="normal">            </span><span class="function">DROPBITS</span><span class="symbol">(</span><span class="number">1</span><span class="symbol">);</span>
<span class="normal">            </span><span class="keyword">switch</span><span class="normal"> </span><span class="symbol">(</span><span class="function">BITS</span><span class="symbol">(</span><span class="number">2</span><span class="symbol">))</span><span class="normal"> </span><span class="cbracket">{</span>
<span class="normal">            </span><span class="keyword">case</span><span class="normal"> </span><span class="number">0</span><span class="symbol">:</span><span class="normal">                             </span><span class="comment">/* stored block */</span>
<span class="normal">                </span><span class="function">Tracev</span><span class="symbol">((</span><span class="normal">stderr</span><span class="symbol">,</span><span class="normal"> </span><span class="string">"inflate:     stored block%s</span><span class="specialchar">\n</span><span class="string">"</span><span class="symbol">,</span>
<span class="normal">                        state</span><span class="symbol">-&gt;</span><span class="normal">last </span><span class="symbol">?</span><span class="normal"> </span><span class="string">" (last)"</span><span class="normal"> </span><span class="symbol">:</span><span class="normal"> </span><span class="string">""</span><span class="symbol">));</span>
<span class="normal">                state</span><span class="symbol">-&gt;</span><span class="normal">mode </span><span class="symbol">=</span><span class="normal"> STORED</span><span class="symbol">;</span>
<span class="normal">                </span><span class="keyword">break</span><span class="symbol">;</span>
<span class="normal">            </span><span class="keyword">case</span><span class="normal"> </span><span class="number">1</span><span class="symbol">:</span><span class="normal">                             </span><span class="comment">/* fixed block */</span>
<span class="normal">                </span><span class="function">fixedtables</span><span class="symbol">(</span><span class="normal">state</span><span class="symbol">);</span>
<span class="normal">                </span><span class="function">Tracev</span><span class="symbol">((</span><span class="normal">stderr</span><span class="symbol">,</span><span class="normal"> </span><span class="string">"inflate:     fixed codes block%s</span><span class="specialchar">\n</span><span class="string">"</span><span class="symbol">,</span>
<span class="normal">                        state</span><span class="symbol">-&gt;</span><span class="normal">last </span><span class="symbol">?</span><span class="normal"> </span><span class="string">" (last)"</span><span class="normal"> </span><span class="symbol">:</span><span class="normal"> </span><span class="string">""</span><span class="symbol">));</span>
<span class="normal">                state</span><span class="symbol">-&gt;</span><span class="normal">mode </span><span class="symbol">=</span><span class="normal"> LEN</span><span class="symbol">;</span><span class="normal">              </span><span class="comment">/* decode codes */</span>
<span class="normal">                </span><span class="keyword">break</span><span class="symbol">;</span>
<span class="normal">            </span><span class="keyword">case</span><span class="normal"> </span><span class="number">2</span><span class="symbol">:</span><span class="normal">                             </span><span class="comment">/* dynamic block */</span>
<span class="normal">                </span><span class="function">Tracev</span><span class="symbol">((</span><span class="normal">stderr</span><span class="symbol">,</span><span class="normal"> </span><span class="string">"inflate:     dynamic codes block%s</span><span class="specialchar">\n</span><span class="string">"</span><span class="symbol">,</span>
<span class="normal">                        state</span><span class="symbol">-&gt;</span><span class="normal">last </span><span class="symbol">?</span><span class="normal"> </span><span class="string">" (last)"</span><span class="normal"> </span><span class="symbol">:</span><span class="normal"> </span><span class="string">""</span><span class="symbol">));</span>
<span class="normal">                state</span><span class="symbol">-&gt;</span><span class="normal">mode </span><span class="symbol">=</span><span class="normal"> TABLE</span><span class="symbol">;</span>
<span class="normal">                </span><span class="keyword">break</span><span class="symbol">;</span>
<span class="normal">            </span><span class="keyword">case</span><span class="normal"> </span><span class="number">3</span><span class="symbol">:</span>
<span class="normal">                strm</span><span class="symbol">-&gt;</span><span class="normal">msg </span><span class="symbol">=</span><span class="normal"> </span><span class="symbol">(</span><span class="type">char</span><span class="normal"> </span><span class="symbol">*)</span><span class="string">"invalid block type"</span><span class="symbol">;</span>
<span class="normal">                state</span><span class="symbol">-&gt;</span><span class="normal">mode </span><span class="symbol">=</span><span class="normal"> BAD</span><span class="symbol">;</span>
<span class="normal">            </span><span class="cbracket">}</span>
<span class="normal">            </span><span class="function">DROPBITS</span><span class="symbol">(</span><span class="number">2</span><span class="symbol">);</span>
<span class="normal">            </span><span class="keyword">break</span><span class="symbol">;</span>
<span class="normal">        </span><span class="keyword">case</span><span class="normal"> STORED</span><span class="symbol">:</span>
<span class="normal">            </span><span class="function">BYTEBITS</span><span class="symbol">();</span><span class="normal">                         </span><span class="comment">/* go to byte boundary */</span>
<span class="normal">            </span><span class="function">NEEDBITS</span><span class="symbol">(</span><span class="number">32</span><span class="symbol">);</span>
<span class="normal">            </span><span class="keyword">if</span><span class="normal"> </span><span class="symbol">((</span><span class="normal">hold </span><span class="symbol">&amp;</span><span class="normal"> </span><span class="number">0xffff</span><span class="symbol">)</span><span class="normal"> </span><span class="symbol">!=</span><span class="normal"> </span><span class="symbol">((</span><span class="normal">hold </span><span class="symbol">&gt;&gt;</span><span class="normal"> </span><span class="number">16</span><span class="symbol">)</span><span class="normal"> </span><span class="symbol">^</span><span class="normal"> </span><span class="number">0xffff</span><span class="symbol">))</span><span class="normal"> </span><span class="cbracket">{</span>
<span class="normal">                strm</span><span class="symbol">-&gt;</span><span class="normal">msg </span><span class="symbol">=</span><span class="normal"> </span><span class="symbol">(</span><span class="type">char</span><span class="normal"> </span><span class="symbol">*)</span><span class="string">"invalid stored block lengths"</span><span class="symbol">;</span>
<span class="normal">                state</span><span class="symbol">-&gt;</span><span class="normal">mode </span><span class="symbol">=</span><span class="normal"> BAD</span><span class="symbol">;</span>
<span class="normal">                </span><span class="keyword">break</span><span class="symbol">;</span>
<span class="normal">            </span><span class="cbracket">}</span>
<span class="normal">            state</span><span class="symbol">-&gt;</span><span class="normal">length </span><span class="symbol">=</span><span class="normal"> </span><span class="symbol">(</span><span class="type">unsigned</span><span class="symbol">)</span><span class="normal">hold </span><span class="symbol">&amp;</span><span class="normal"> </span><span class="number">0xffff</span><span class="symbol">;</span>
<span class="normal">            </span><span class="function">Tracev</span><span class="symbol">((</span><span class="normal">stderr</span><span class="symbol">,</span><span class="normal"> </span><span class="string">"inflate:       stored length %u</span><span class="specialchar">\n</span><span class="string">"</span><span class="symbol">,</span>
<span class="normal">                    state</span><span class="symbol">-&gt;</span><span class="normal">length</span><span class="symbol">));</span>
<span class="normal">            </span><span class="function">INITBITS</span><span class="symbol">();</span>
<span class="normal">            state</span><span class="symbol">-&gt;</span><span class="normal">mode </span><span class="symbol">=</span><span class="normal"> COPY</span><span class="symbol">;</span>
<span class="normal">        </span><span class="keyword">case</span><span class="normal"> COPY</span><span class="symbol">:</span>
<span class="normal">            copy </span><span class="symbol">=</span><span class="normal"> state</span><span class="symbol">-&gt;</span><span class="normal">length</span><span class="symbol">;</span>
<span class="normal">            </span><span class="keyword">if</span><span class="normal"> </span><span class="symbol">(</span><span class="normal">copy</span><span class="symbol">)</span><span class="normal"> </span><span class="cbracket">{</span>
<span class="normal">                </span><span class="keyword">if</span><span class="normal"> </span><span class="symbol">(</span><span class="normal">copy </span><span class="symbol">&gt;</span><span class="normal"> have</span><span class="symbol">)</span><span class="normal"> copy </span><span class="symbol">=</span><span class="normal"> have</span><span class="symbol">;</span>
<span class="normal">                </span><span class="keyword">if</span><span class="normal"> </span><span class="symbol">(</span><span class="normal">copy </span><span class="symbol">&gt;</span><span class="normal"> left</span><span class="symbol">)</span><span class="normal"> copy </span><span class="symbol">=</span><span class="normal"> left</span><span class="symbol">;</span>
<span class="normal">                </span><span class="keyword">if</span><span class="normal"> </span><span class="symbol">(</span><span class="normal">copy </span><span class="symbol">==</span><span class="normal"> </span><span class="number">0</span><span class="symbol">)</span><span class="normal"> </span><span class="keyword">goto</span><span class="normal"> inf_leave</span><span class="symbol">;</span>
<span class="normal">                </span><span class="function">zmemcpy</span><span class="symbol">(</span><span class="normal">put</span><span class="symbol">,</span><span class="normal"> next</span><span class="symbol">,</span><span class="normal"> copy</span><span class="symbol">);</span>
<span class="normal">                have </span><span class="symbol">-=</span><span class="normal"> copy</span><span class="symbol">;</span>
<span class="normal">                next </span><span class="symbol">+=</span><span class="normal"> copy</span><span class="symbol">;</span>
<span class="normal">                left </span><span class="symbol">-=</span><span class="normal"> copy</span><span class="symbol">;</span>
<span class="normal">                put </span><span class="symbol">+=</span><span class="normal"> copy</span><span class="symbol">;</span>
<span class="normal">                state</span><span class="symbol">-&gt;</span><span class="normal">length </span><span class="symbol">-=</span><span class="normal"> copy</span><span class="symbol">;</span>
<span class="normal">                </span><span class="keyword">break</span><span class="symbol">;</span>
<span class="normal">            </span><span class="cbracket">}</span>
<span class="normal">            </span><span class="function">Tracev</span><span class="symbol">((</span><span class="normal">stderr</span><span class="symbol">,</span><span class="normal"> </span><span class="string">"inflate:       stored end</span><span class="specialchar">\n</span><span class="string">"</span><span class="symbol">));</span>
<span class="normal">            state</span><span class="symbol">-&gt;</span><span class="normal">mode </span><span class="symbol">=</span><span class="normal"> TYPE</span><span class="symbol">;</span>
<span class="normal">            </span><span class="keyword">break</span><span class="symbol">;</span>
<span class="normal">        </span><span class="keyword">case</span><span class="normal"> TABLE</span><span class="symbol">:</span>
<span class="normal">            </span><span class="function">NEEDBITS</span><span class="symbol">(</span><span class="number">14</span><span class="symbol">);</span>
<span class="normal">            state</span><span class="symbol">-&gt;</span><span class="normal">nlen </span><span class="symbol">=</span><span class="normal"> </span><span class="function">BITS</span><span class="symbol">(</span><span class="number">5</span><span class="symbol">)</span><span class="normal"> </span><span class="symbol">+</span><span class="normal"> </span><span class="number">257</span><span class="symbol">;</span>
<span class="normal">            </span><span class="function">DROPBITS</span><span class="symbol">(</span><span class="number">5</span><span class="symbol">);</span>
<span class="normal">            state</span><span class="symbol">-&gt;</span><span class="normal">ndist </span><span class="symbol">=</span><span class="normal"> </span><span class="function">BITS</span><span class="symbol">(</span><span class="number">5</span><span class="symbol">)</span><span class="normal"> </span><span class="symbol">+</span><span class="normal"> </span><span class="number">1</span><span class="symbol">;</span>
<span class="normal">            </span><span class="function">DROPBITS</span><span class="symbol">(</span><span class="number">5</span><span class="symbol">);</span>
<span class="normal">            state</span><span class="symbol">-&gt;</span><span class="normal">ncode </span><span class="symbol">=</span><span class="normal"> </span><span class="function">BITS</span><span class="symbol">(</span><span class="number">4</span><span class="symbol">)</span><span class="normal"> </span><span class="symbol">+</span><span class="normal"> </span><span class="number">4</span><span class="symbol">;</span>
<span class="normal">            </span><span class="function">DROPBITS</span><span class="symbol">(</span><span class="number">4</span><span class="symbol">);</span>
<span class="preproc">#ifndef</span><span class="normal"> PKZIP_BUG_WORKAROUND</span>
<span class="normal">            </span><span class="keyword">if</span><span class="normal"> </span><span class="symbol">(</span><span class="normal">state</span><span class="symbol">-&gt;</span><span class="normal">nlen </span><span class="symbol">&gt;</span><span class="normal"> </span><span class="number">286</span><span class="normal"> </span><span class="symbol">||</span><span class="normal"> state</span><span class="symbol">-&gt;</span><span class="normal">ndist </span><span class="symbol">&gt;</span><span class="normal"> </span><span class="number">30</span><span class="symbol">)</span><span class="normal"> </span><span class="cbracket">{</span>
<span class="normal">                strm</span><span class="symbol">-&gt;</span><span class="normal">msg </span><span class="symbol">=</span><span class="normal"> </span><span class="symbol">(</span><span class="type">char</span><span class="normal"> </span><span class="symbol">*)</span><span class="string">"too many length or distance symbols"</span><span class="symbol">;</span>
<span class="normal">                state</span><span class="symbol">-&gt;</span><span class="normal">mode </span><span class="symbol">=</span><span class="normal"> BAD</span><span class="symbol">;</span>
<span class="normal">                </span><span class="keyword">break</span><span class="symbol">;</span>
<span class="normal">            </span><span class="cbracket">}</span>
<span class="preproc">#endif</span>
<span class="normal">            </span><span class="function">Tracev</span><span class="symbol">((</span><span class="normal">stderr</span><span class="symbol">,</span><span class="normal"> </span><span class="string">"inflate:       table sizes ok</span><span class="specialchar">\n</span><span class="string">"</span><span class="symbol">));</span>
<span class="normal">            state</span><span class="symbol">-&gt;</span><span class="normal">have </span><span class="symbol">=</span><span class="normal"> </span><span class="number">0</span><span class="symbol">;</span>
<span class="normal">            state</span><span class="symbol">-&gt;</span><span class="normal">mode </span><span class="symbol">=</span><span class="normal"> LENLENS</span><span class="symbol">;</span>
<span class="normal">        </span><span class="keyword">case</span><span class="normal"> LENLENS</span><span class="symbol">:</span>
<span class="normal">            </span><span class="keyword">while</span><span class="normal"> </span><span class="symbol">(</span><span class="normal">state</span><span class="symbol">-&gt;</span><span class="normal">have </span><span class="symbol">&lt;</span><span class="normal"> state</span><span class="symbol">-&gt;</span><span class="normal">ncode</span><span class="symbol">)</span><span class="normal"> </span><span class="cbracket">{</span>
<span class="normal">                </span><span class="function">NEEDBITS</span><span class="symbol">(</span><span class="number">3</span><span class="symbol">);</span>
<span class="normal">                state</span><span class="symbol">-&gt;</span><span class="normal">lens</span><span class="symbol">[</span><span class="normal">order</span><span class="symbol">[</span><span class="normal">state</span><span class="symbol">-&gt;</span><span class="normal">have</span><span class="symbol">++]]</span><span class="normal"> </span><span class="symbol">=</span><span class="normal"> </span><span class="symbol">(</span><span class="type">unsigned</span><span class="normal"> </span><span class="type">short</span><span class="symbol">)</span><span class="function">BITS</span><span class="symbol">(</span><span class="number">3</span><span class="symbol">);</span>
<span class="normal">                </span><span class="function">DROPBITS</span><span class="symbol">(</span><span class="number">3</span><span class="symbol">);</span>
<span class="normal">            </span><span class="cbracket">}</span>
<span class="normal">            </span><span class="keyword">while</span><span class="normal"> </span><span class="symbol">(</span><span class="normal">state</span><span class="symbol">-&gt;</span><span class="normal">have </span><span class="symbol">&lt;</span><span class="normal"> </span><span class="number">19</span><span class="symbol">)</span>
<span class="normal">                state</span><span class="symbol">-&gt;</span><span class="normal">lens</span><span class="symbol">[</span><span class="normal">order</span><span class="symbol">[</span><span class="normal">state</span><span class="symbol">-&gt;</span><span class="normal">have</span><span class="symbol">++]]</span><span class="normal"> </span><span class="symbol">=</span><span class="normal"> </span><span class="number">0</span><span class="symbol">;</span>
<span class="normal">            state</span><span class="symbol">-&gt;</span><span class="normal">next </span><span class="symbol">=</span><span class="normal"> state</span><span class="symbol">-&gt;</span><span class="normal">codes</span><span class="symbol">;</span>
<span class="normal">            state</span><span class="symbol">-&gt;</span><span class="normal">lencode </span><span class="symbol">=</span><span class="normal"> </span><span class="symbol">(</span><span class="normal">code </span><span class="usertype">const</span><span class="normal"> FAR </span><span class="symbol">*)(</span><span class="normal">state</span><span class="symbol">-&gt;</span><span class="normal">next</span><span class="symbol">);</span>
<span class="normal">            state</span><span class="symbol">-&gt;</span><span class="normal">lenbits </span><span class="symbol">=</span><span class="normal"> </span><span class="number">7</span><span class="symbol">;</span>
<span class="normal">            ret </span><span class="symbol">=</span><span class="normal"> </span><span class="function">inflate_table</span><span class="symbol">(</span><span class="normal">CODES</span><span class="symbol">,</span><span class="normal"> state</span><span class="symbol">-&gt;</span><span class="normal">lens</span><span class="symbol">,</span><span class="normal"> </span><span class="number">19</span><span class="symbol">,</span><span class="normal"> </span><span class="symbol">&amp;(</span><span class="normal">state</span><span class="symbol">-&gt;</span><span class="normal">next</span><span class="symbol">),</span>
<span class="normal">                                </span><span class="symbol">&amp;(</span><span class="normal">state</span><span class="symbol">-&gt;</span><span class="normal">lenbits</span><span class="symbol">),</span><span class="normal"> state</span><span class="symbol">-&gt;</span><span class="normal">work</span><span class="symbol">);</span>
<span class="normal">            </span><span class="keyword">if</span><span class="normal"> </span><span class="symbol">(</span><span class="normal">ret</span><span class="symbol">)</span><span class="normal"> </span><span class="cbracket">{</span>
<span class="normal">                strm</span><span class="symbol">-&gt;</span><span class="normal">msg </span><span class="symbol">=</span><span class="normal"> </span><span class="symbol">(</span><span class="type">char</span><span class="normal"> </span><span class="symbol">*)</span><span class="string">"invalid code lengths set"</span><span class="symbol">;</span>
<span class="normal">                state</span><span class="symbol">-&gt;</span><span class="normal">mode </span><span class="symbol">=</span><span class="normal"> BAD</span><span class="symbol">;</span>
<span class="normal">                </span><span class="keyword">break</span><span class="symbol">;</span>
<span class="normal">            </span><span class="cbracket">}</span>
<span class="normal">            </span><span class="function">Tracev</span><span class="symbol">((</span><span class="normal">stderr</span><span class="symbol">,</span><span class="normal"> </span><span class="string">"inflate:       code lengths ok</span><span class="specialchar">\n</span><span class="string">"</span><span class="symbol">));</span>
<span class="normal">            state</span><span class="symbol">-&gt;</span><span class="normal">have </span><span class="symbol">=</span><span class="normal"> </span><span class="number">0</span><span class="symbol">;</span>
<span class="normal">            state</span><span class="symbol">-&gt;</span><span class="normal">mode </span><span class="symbol">=</span><span class="normal"> CODELENS</span><span class="symbol">;</span>
<span class="normal">        </span><span class="keyword">case</span><span class="normal"> CODELENS</span><span class="symbol">:</span>
<span class="normal">            </span><span class="keyword">while</span><span class="normal"> </span><span class="symbol">(</span><span class="normal">state</span><span class="symbol">-&gt;</span><span class="normal">have </span><span class="symbol">&lt;</span><span class="normal"> state</span><span class="symbol">-&gt;</span><span class="normal">nlen </span><span class="symbol">+</span><span class="normal"> state</span><span class="symbol">-&gt;</span><span class="normal">ndist</span><span class="symbol">)</span><span class="normal"> </span><span class="cbracket">{</span>
<span class="normal">                </span><span class="keyword">for</span><span class="normal"> </span><span class="symbol">(;;)</span><span class="normal"> </span><span class="cbracket">{</span>
<span class="normal">                    this </span><span class="symbol">=</span><span class="normal"> state</span><span class="symbol">-&gt;</span><span class="normal">lencode</span><span class="symbol">[</span><span class="function">BITS</span><span class="symbol">(</span><span class="normal">state</span><span class="symbol">-&gt;</span><span class="normal">lenbits</span><span class="symbol">)];</span>
<span class="normal">                    </span><span class="keyword">if</span><span class="normal"> </span><span class="symbol">((</span><span class="type">unsigned</span><span class="symbol">)(</span><span class="normal">this</span><span class="symbol">.</span><span class="normal">bits</span><span class="symbol">)</span><span class="normal"> </span><span class="symbol">&lt;=</span><span class="normal"> bits</span><span class="symbol">)</span><span class="normal"> </span><span class="keyword">break</span><span class="symbol">;</span>
<span class="normal">                    </span><span class="function">PULLBYTE</span><span class="symbol">();</span>
<span class="normal">                </span><span class="cbracket">}</span>
<span class="normal">                </span><span class="keyword">if</span><span class="normal"> </span><span class="symbol">(</span><span class="normal">this</span><span class="symbol">.</span><span class="normal">val </span><span class="symbol">&lt;</span><span class="normal"> </span><span class="number">16</span><span class="symbol">)</span><span class="normal"> </span><span class="cbracket">{</span>
<span class="normal">                    </span><span class="function">NEEDBITS</span><span class="symbol">(</span><span class="normal">this</span><span class="symbol">.</span><span class="normal">bits</span><span class="symbol">);</span>
<span class="normal">                    </span><span class="function">DROPBITS</span><span class="symbol">(</span><span class="normal">this</span><span class="symbol">.</span><span class="normal">bits</span><span class="symbol">);</span>
<span class="normal">                    state</span><span class="symbol">-&gt;</span><span class="normal">lens</span><span class="symbol">[</span><span class="normal">state</span><span class="symbol">-&gt;</span><span class="normal">have</span><span class="symbol">++]</span><span class="normal"> </span><span class="symbol">=</span><span class="normal"> this</span><span class="symbol">.</span><span class="normal">val</span><span class="symbol">;</span>
<span class="normal">                </span><span class="cbracket">}</span>
<span class="normal">                </span><span class="keyword">else</span><span class="normal"> </span><span class="cbracket">{</span>
<span class="normal">                    </span><span class="keyword">if</span><span class="normal"> </span><span class="symbol">(</span><span class="normal">this</span><span class="symbol">.</span><span class="normal">val </span><span class="symbol">==</span><span class="normal"> </span><span class="number">16</span><span class="symbol">)</span><span class="normal"> </span><span class="cbracket">{</span>
<span class="normal">                        </span><span class="function">NEEDBITS</span><span class="symbol">(</span><span class="normal">this</span><span class="symbol">.</span><span class="normal">bits </span><span class="symbol">+</span><span class="normal"> </span><span class="number">2</span><span class="symbol">);</span>
<span class="normal">                        </span><span class="function">DROPBITS</span><span class="symbol">(</span><span class="normal">this</span><span class="symbol">.</span><span class="normal">bits</span><span class="symbol">);</span>
<span class="normal">                        </span><span class="keyword">if</span><span class="normal"> </span><span class="symbol">(</span><span class="normal">state</span><span class="symbol">-&gt;</span><span class="normal">have </span><span class="symbol">==</span><span class="normal"> </span><span class="number">0</span><span class="symbol">)</span><span class="normal"> </span><span class="cbracket">{</span>
<span class="normal">                            strm</span><span class="symbol">-&gt;</span><span class="normal">msg </span><span class="symbol">=</span><span class="normal"> </span><span class="symbol">(</span><span class="type">char</span><span class="normal"> </span><span class="symbol">*)</span><span class="string">"invalid bit length repeat"</span><span class="symbol">;</span>
<span class="normal">                            state</span><span class="symbol">-&gt;</span><span class="normal">mode </span><span class="symbol">=</span><span class="normal"> BAD</span><span class="symbol">;</span>
<span class="normal">                            </span><span class="keyword">break</span><span class="symbol">;</span>
<span class="normal">                        </span><span class="cbracket">}</span>
<span class="normal">                        len </span><span class="symbol">=</span><span class="normal"> state</span><span class="symbol">-&gt;</span><span class="normal">lens</span><span class="symbol">[</span><span class="normal">state</span><span class="symbol">-&gt;</span><span class="normal">have </span><span class="symbol">-</span><span class="normal"> </span><span class="number">1</span><span class="symbol">];</span>
<span class="normal">                        copy </span><span class="symbol">=</span><span class="normal"> </span><span class="number">3</span><span class="normal"> </span><span class="symbol">+</span><span class="normal"> </span><span class="function">BITS</span><span class="symbol">(</span><span class="number">2</span><span class="symbol">);</span>
<span class="normal">                        </span><span class="function">DROPBITS</span><span class="symbol">(</span><span class="number">2</span><span class="symbol">);</span>
<span class="normal">                    </span><span class="cbracket">}</span>
<span class="normal">                    </span><span class="keyword">else</span><span class="normal"> </span><span class="keyword">if</span><span class="normal"> </span><span class="symbol">(</span><span class="normal">this</span><span class="symbol">.</span><span class="normal">val </span><span class="symbol">==</span><span class="normal"> </span><span class="number">17</span><span class="symbol">)</span><span class="normal"> </span><span class="cbracket">{</span>
<span class="normal">                        </span><span class="function">NEEDBITS</span><span class="symbol">(</span><span class="normal">this</span><span class="symbol">.</span><span class="normal">bits </span><span class="symbol">+</span><span class="normal"> </span><span class="number">3</span><span class="symbol">);</span>
<span class="normal">                        </span><span class="function">DROPBITS</span><span class="symbol">(</span><span class="normal">this</span><span class="symbol">.</span><span class="normal">bits</span><span class="symbol">);</span>
<span class="normal">                        len </span><span class="symbol">=</span><span class="normal"> </span><span class="number">0</span><span class="symbol">;</span>
<span class="normal">                        copy </span><span class="symbol">=</span><span class="normal"> </span><span class="number">3</span><span class="normal"> </span><span class="symbol">+</span><span class="normal"> </span><span class="function">BITS</span><span class="symbol">(</span><span class="number">3</span><span class="symbol">);</span>
<span class="normal">                        </span><span class="function">DROPBITS</span><span class="symbol">(</span><span class="number">3</span><span class="symbol">);</span>
<span class="normal">                    </span><span class="cbracket">}</span>
<span class="normal">                    </span><span class="keyword">else</span><span class="normal"> </span><span class="cbracket">{</span>
<span class="normal">                        </span><span class="function">NEEDBITS</span><span class="symbol">(</span><span class="normal">this</span><span class="symbol">.</span><span class="normal">bits </span><span class="symbol">+</span><span class="normal"> </span><span class="number">7</span><span class="symbol">);</span>
<span class="normal">                        </span><span class="function">DROPBITS</span><span class="symbol">(</span><span class="normal">this</span><span class="symbol">.</span><span class="normal">bits</span><span class="symbol">);</span>
<span class="normal">                        len </span><span class="symbol">=</span><span class="normal"> </span><span class="number">0</span><span class="symbol">;</span>
<span class="normal">                        copy </span><span class="symbol">=</span><span class="normal"> </span><span class="number">11</span><span class="normal"> </span><span class="symbol">+</span><span class="normal"> </span><span class="function">BITS</span><span class="symbol">(</span><span class="number">7</span><span class="symbol">);</span>
<span class="normal">                        </span><span class="function">DROPBITS</span><span class="symbol">(</span><span class="number">7</span><span class="symbol">);</span>
<span class="normal">                    </span><span class="cbracket">}</span>
<span class="normal">                    </span><span class="keyword">if</span><span class="normal"> </span><span class="symbol">(</span><span class="normal">state</span><span class="symbol">-&gt;</span><span class="normal">have </span><span class="symbol">+</span><span class="normal"> copy </span><span class="symbol">&gt;</span><span class="normal"> state</span><span class="symbol">-&gt;</span><span class="normal">nlen </span><span class="symbol">+</span><span class="normal"> state</span><span class="symbol">-&gt;</span><span class="normal">ndist</span><span class="symbol">)</span><span class="normal"> </span><span class="cbracket">{</span>
<span class="normal">                        strm</span><span class="symbol">-&gt;</span><span class="normal">msg </span><span class="symbol">=</span><span class="normal"> </span><span class="symbol">(</span><span class="type">char</span><span class="normal"> </span><span class="symbol">*)</span><span class="string">"invalid bit length repeat"</span><span class="symbol">;</span>
<span class="normal">                        state</span><span class="symbol">-&gt;</span><span class="normal">mode </span><span class="symbol">=</span><span class="normal"> BAD</span><span class="symbol">;</span>
<span class="normal">                        </span><span class="keyword">break</span><span class="symbol">;</span>
<span class="normal">                    </span><span class="cbracket">}</span>
<span class="normal">                    </span><span class="keyword">while</span><span class="normal"> </span><span class="symbol">(</span><span class="normal">copy</span><span class="symbol">--)</span>
<span class="normal">                        state</span><span class="symbol">-&gt;</span><span class="normal">lens</span><span class="symbol">[</span><span class="normal">state</span><span class="symbol">-&gt;</span><span class="normal">have</span><span class="symbol">++]</span><span class="normal"> </span><span class="symbol">=</span><span class="normal"> </span><span class="symbol">(</span><span class="type">unsigned</span><span class="normal"> </span><span class="type">short</span><span class="symbol">)</span><span class="normal">len</span><span class="symbol">;</span>
<span class="normal">                </span><span class="cbracket">}</span>
<span class="normal">            </span><span class="cbracket">}</span>

<span class="normal">            </span><span class="comment">/* handle error breaks in while */</span>
<span class="normal">            </span><span class="keyword">if</span><span class="normal"> </span><span class="symbol">(</span><span class="normal">state</span><span class="symbol">-&gt;</span><span class="normal">mode </span><span class="symbol">==</span><span class="normal"> BAD</span><span class="symbol">)</span><span class="normal"> </span><span class="keyword">break</span><span class="symbol">;</span>

<span class="normal">            </span><span class="comment">/* build code tables */</span>
<span class="normal">            state</span><span class="symbol">-&gt;</span><span class="normal">next </span><span class="symbol">=</span><span class="normal"> state</span><span class="symbol">-&gt;</span><span class="normal">codes</span><span class="symbol">;</span>
<span class="normal">            state</span><span class="symbol">-&gt;</span><span class="normal">lencode </span><span class="symbol">=</span><span class="normal"> </span><span class="symbol">(</span><span class="normal">code </span><span class="usertype">const</span><span class="normal"> FAR </span><span class="symbol">*)(</span><span class="normal">state</span><span class="symbol">-&gt;</span><span class="normal">next</span><span class="symbol">);</span>
<span class="normal">            state</span><span class="symbol">-&gt;</span><span class="normal">lenbits </span><span class="symbol">=</span><span class="normal"> </span><span class="number">9</span><span class="symbol">;</span>
<span class="normal">            ret </span><span class="symbol">=</span><span class="normal"> </span><span class="function">inflate_table</span><span class="symbol">(</span><span class="normal">LENS</span><span class="symbol">,</span><span class="normal"> state</span><span class="symbol">-&gt;</span><span class="normal">lens</span><span class="symbol">,</span><span class="normal"> state</span><span class="symbol">-&gt;</span><span class="normal">nlen</span><span class="symbol">,</span><span class="normal"> </span><span class="symbol">&amp;(</span><span class="normal">state</span><span class="symbol">-&gt;</span><span class="normal">next</span><span class="symbol">),</span>
<span class="normal">                                </span><span class="symbol">&amp;(</span><span class="normal">state</span><span class="symbol">-&gt;</span><span class="normal">lenbits</span><span class="symbol">),</span><span class="normal"> state</span><span class="symbol">-&gt;</span><span class="normal">work</span><span class="symbol">);</span>
<span class="normal">            </span><span class="keyword">if</span><span class="normal"> </span><span class="symbol">(</span><span class="normal">ret</span><span class="symbol">)</span><span class="normal"> </span><span class="cbracket">{</span>
<span class="normal">                strm</span><span class="symbol">-&gt;</span><span class="normal">msg </span><span class="symbol">=</span><span class="normal"> </span><span class="symbol">(</span><span class="type">char</span><span class="normal"> </span><span class="symbol">*)</span><span class="string">"invalid literal/lengths set"</span><span class="symbol">;</span>
<span class="normal">                state</span><span class="symbol">-&gt;</span><span class="normal">mode </span><span class="symbol">=</span><span class="normal"> BAD</span><span class="symbol">;</span>
<span class="normal">                </span><span class="keyword">break</span><span class="symbol">;</span>
<span class="normal">            </span><span class="cbracket">}</span>
<span class="normal">            state</span><span class="symbol">-&gt;</span><span class="normal">distcode </span><span class="symbol">=</span><span class="normal"> </span><span class="symbol">(</span><span class="normal">code </span><span class="usertype">const</span><span class="normal"> FAR </span><span class="symbol">*)(</span><span class="normal">state</span><span class="symbol">-&gt;</span><span class="normal">next</span><span class="symbol">);</span>
<span class="normal">            state</span><span class="symbol">-&gt;</span><span class="normal">distbits </span><span class="symbol">=</span><span class="normal"> </span><span class="number">6</span><span class="symbol">;</span>
<span class="normal">            ret </span><span class="symbol">=</span><span class="normal"> </span><span class="function">inflate_table</span><span class="symbol">(</span><span class="normal">DISTS</span><span class="symbol">,</span><span class="normal"> state</span><span class="symbol">-&gt;</span><span class="normal">lens </span><span class="symbol">+</span><span class="normal"> state</span><span class="symbol">-&gt;</span><span class="normal">nlen</span><span class="symbol">,</span><span class="normal"> state</span><span class="symbol">-&gt;</span><span class="normal">ndist</span><span class="symbol">,</span>
<span class="normal">                            </span><span class="symbol">&amp;(</span><span class="normal">state</span><span class="symbol">-&gt;</span><span class="normal">next</span><span class="symbol">),</span><span class="normal"> </span><span class="symbol">&amp;(</span><span class="normal">state</span><span class="symbol">-&gt;</span><span class="normal">distbits</span><span class="symbol">),</span><span class="normal"> state</span><span class="symbol">-&gt;</span><span class="normal">work</span><span class="symbol">);</span>
<span class="normal">            </span><span class="keyword">if</span><span class="normal"> </span><span class="symbol">(</span><span class="normal">ret</span><span class="symbol">)</span><span class="normal"> </span><span class="cbracket">{</span>
<span class="normal">                strm</span><span class="symbol">-&gt;</span><span class="normal">msg </span><span class="symbol">=</span><span class="normal"> </span><span class="symbol">(</span><span class="type">char</span><span class="normal"> </span><span class="symbol">*)</span><span class="string">"invalid distances set"</span><span class="symbol">;</span>
<span class="normal">                state</span><span class="symbol">-&gt;</span><span class="normal">mode </span><span class="symbol">=</span><span class="normal"> BAD</span><span class="symbol">;</span>
<span class="normal">                </span><span class="keyword">break</span><span class="symbol">;</span>
<span class="normal">            </span><span class="cbracket">}</span>
<span class="normal">            </span><span class="function">Tracev</span><span class="symbol">((</span><span class="normal">stderr</span><span class="symbol">,</span><span class="normal"> </span><span class="string">"inflate:       codes ok</span><span class="specialchar">\n</span><span class="string">"</span><span class="symbol">));</span>
<span class="normal">            state</span><span class="symbol">-&gt;</span><span class="normal">mode </span><span class="symbol">=</span><span class="normal"> LEN</span><span class="symbol">;</span>
<span class="normal">        </span><span class="keyword">case</span><span class="normal"> LEN</span><span class="symbol">:</span>
<span class="normal">            </span><span class="keyword">if</span><span class="normal"> </span><span class="symbol">(</span><span class="normal">have </span><span class="symbol">&gt;=</span><span class="normal"> </span><span class="number">6</span><span class="normal"> </span><span class="symbol">&amp;&amp;</span><span class="normal"> left </span><span class="symbol">&gt;=</span><span class="normal"> </span><span class="number">258</span><span class="symbol">)</span><span class="normal"> </span><span class="cbracket">{</span>
<span class="normal">                </span><span class="function">RESTORE</span><span class="symbol">();</span>
<span class="normal">                </span><span class="function">inflate_fast</span><span class="symbol">(</span><span class="normal">strm</span><span class="symbol">,</span><span class="normal"> out</span><span class="symbol">);</span>
<span class="normal">                </span><span class="function">LOAD</span><span class="symbol">();</span>
<span class="normal">                </span><span class="keyword">break</span><span class="symbol">;</span>
<span class="normal">            </span><span class="cbracket">}</span>
<span class="normal">            </span><span class="keyword">for</span><span class="normal"> </span><span class="symbol">(;;)</span><span class="normal"> </span><span class="cbracket">{</span>
<span class="normal">                this </span><span class="symbol">=</span><span class="normal"> state</span><span class="symbol">-&gt;</span><span class="normal">lencode</span><span class="symbol">[</span><span class="function">BITS</span><span class="symbol">(</span><span class="normal">state</span><span class="symbol">-&gt;</span><span class="normal">lenbits</span><span class="symbol">)];</span>
<span class="normal">                </span><span class="keyword">if</span><span class="normal"> </span><span class="symbol">((</span><span class="type">unsigned</span><span class="symbol">)(</span><span class="normal">this</span><span class="symbol">.</span><span class="normal">bits</span><span class="symbol">)</span><span class="normal"> </span><span class="symbol">&lt;=</span><span class="normal"> bits</span><span class="symbol">)</span><span class="normal"> </span><span class="keyword">break</span><span class="symbol">;</span>
<span class="normal">                </span><span class="function">PULLBYTE</span><span class="symbol">();</span>
<span class="normal">            </span><span class="cbracket">}</span>
<span class="normal">            </span><span class="keyword">if</span><span class="normal"> </span><span class="symbol">(</span><span class="normal">this</span><span class="symbol">.</span><span class="normal">op </span><span class="symbol">&amp;&amp;</span><span class="normal"> </span><span class="symbol">(</span><span class="normal">this</span><span class="symbol">.</span><span class="normal">op </span><span class="symbol">&amp;</span><span class="normal"> </span><span class="number">0xf0</span><span class="symbol">)</span><span class="normal"> </span><span class="symbol">==</span><span class="normal"> </span><span class="number">0</span><span class="symbol">)</span><span class="normal"> </span><span class="cbracket">{</span>
<span class="normal">                last </span><span class="symbol">=</span><span class="normal"> this</span><span class="symbol">;</span>
<span class="normal">                </span><span class="keyword">for</span><span class="normal"> </span><span class="symbol">(;;)</span><span class="normal"> </span><span class="cbracket">{</span>
<span class="normal">                    this </span><span class="symbol">=</span><span class="normal"> state</span><span class="symbol">-&gt;</span><span class="normal">lencode</span><span class="symbol">[</span><span class="normal">last</span><span class="symbol">.</span><span class="normal">val </span><span class="symbol">+</span>
<span class="normal">                            </span><span class="symbol">(</span><span class="function">BITS</span><span class="symbol">(</span><span class="normal">last</span><span class="symbol">.</span><span class="normal">bits </span><span class="symbol">+</span><span class="normal"> last</span><span class="symbol">.</span><span class="normal">op</span><span class="symbol">)</span><span class="normal"> </span><span class="symbol">&gt;&gt;</span><span class="normal"> last</span><span class="symbol">.</span><span class="normal">bits</span><span class="symbol">)];</span>
<span class="normal">                    </span><span class="keyword">if</span><span class="normal"> </span><span class="symbol">((</span><span class="type">unsigned</span><span class="symbol">)(</span><span class="normal">last</span><span class="symbol">.</span><span class="normal">bits </span><span class="symbol">+</span><span class="normal"> this</span><span class="symbol">.</span><span class="normal">bits</span><span class="symbol">)</span><span class="normal"> </span><span class="symbol">&lt;=</span><span class="normal"> bits</span><span class="symbol">)</span><span class="normal"> </span><span class="keyword">break</span><span class="symbol">;</span>
<span class="normal">                    </span><span class="function">PULLBYTE</span><span class="symbol">();</span>
<span class="normal">                </span><span class="cbracket">}</span>
<span class="normal">                </span><span class="function">DROPBITS</span><span class="symbol">(</span><span class="normal">last</span><span class="symbol">.</span><span class="normal">bits</span><span class="symbol">);</span>
<span class="normal">            </span><span class="cbracket">}</span>
<span class="normal">            </span><span class="function">DROPBITS</span><span class="symbol">(</span><span class="normal">this</span><span class="symbol">.</span><span class="normal">bits</span><span class="symbol">);</span>
<span class="normal">            state</span><span class="symbol">-&gt;</span><span class="normal">length </span><span class="symbol">=</span><span class="normal"> </span><span class="symbol">(</span><span class="type">unsigned</span><span class="symbol">)</span><span class="normal">this</span><span class="symbol">.</span><span class="normal">val</span><span class="symbol">;</span>
<span class="normal">            </span><span class="keyword">if</span><span class="normal"> </span><span class="symbol">((</span><span class="type">int</span><span class="symbol">)(</span><span class="normal">this</span><span class="symbol">.</span><span class="normal">op</span><span class="symbol">)</span><span class="normal"> </span><span class="symbol">==</span><span class="normal"> </span><span class="number">0</span><span class="symbol">)</span><span class="normal"> </span><span class="cbracket">{</span>
<span class="normal">                </span><span class="function">Tracevv</span><span class="symbol">((</span><span class="normal">stderr</span><span class="symbol">,</span><span class="normal"> this</span><span class="symbol">.</span><span class="normal">val </span><span class="symbol">&gt;=</span><span class="normal"> </span><span class="number">0x20</span><span class="normal"> </span><span class="symbol">&amp;&amp;</span><span class="normal"> this</span><span class="symbol">.</span><span class="normal">val </span><span class="symbol">&lt;</span><span class="normal"> </span><span class="number">0x7f</span><span class="normal"> </span><span class="symbol">?</span>
<span class="normal">                        </span><span class="string">"inflate:         literal '%c'</span><span class="specialchar">\n</span><span class="string">"</span><span class="normal"> </span><span class="symbol">:</span>
<span class="normal">                        </span><span class="string">"inflate:         literal 0x%02x</span><span class="specialchar">\n</span><span class="string">"</span><span class="symbol">,</span><span class="normal"> this</span><span class="symbol">.</span><span class="normal">val</span><span class="symbol">));</span>
<span class="normal">                state</span><span class="symbol">-&gt;</span><span class="normal">mode </span><span class="symbol">=</span><span class="normal"> LIT</span><span class="symbol">;</span>
<span class="normal">                </span><span class="keyword">break</span><span class="symbol">;</span>
<span class="normal">            </span><span class="cbracket">}</span>
<span class="normal">            </span><span class="keyword">if</span><span class="normal"> </span><span class="symbol">(</span><span class="normal">this</span><span class="symbol">.</span><span class="normal">op </span><span class="symbol">&amp;</span><span class="normal"> </span><span class="number">32</span><span class="symbol">)</span><span class="normal"> </span><span class="cbracket">{</span>
<span class="normal">                </span><span class="function">Tracevv</span><span class="symbol">((</span><span class="normal">stderr</span><span class="symbol">,</span><span class="normal"> </span><span class="string">"inflate:         end of block</span><span class="specialchar">\n</span><span class="string">"</span><span class="symbol">));</span>
<span class="normal">                state</span><span class="symbol">-&gt;</span><span class="normal">mode </span><span class="symbol">=</span><span class="normal"> TYPE</span><span class="symbol">;</span>
<span class="normal">                </span><span class="keyword">break</span><span class="symbol">;</span>
<span class="normal">            </span><span class="cbracket">}</span>
<span class="normal">            </span><span class="keyword">if</span><span class="normal"> </span><span class="symbol">(</span><span class="normal">this</span><span class="symbol">.</span><span class="normal">op </span><span class="symbol">&amp;</span><span class="normal"> </span><span class="number">64</span><span class="symbol">)</span><span class="normal"> </span><span class="cbracket">{</span>
<span class="normal">                strm</span><span class="symbol">-&gt;</span><span class="normal">msg </span><span class="symbol">=</span><span class="normal"> </span><span class="symbol">(</span><span class="type">char</span><span class="normal"> </span><span class="symbol">*)</span><span class="string">"invalid literal/length code"</span><span class="symbol">;</span>
<span class="normal">                state</span><span class="symbol">-&gt;</span><span class="normal">mode </span><span class="symbol">=</span><span class="normal"> BAD</span><span class="symbol">;</span>
<span class="normal">                </span><span class="keyword">break</span><span class="symbol">;</span>
<span class="normal">            </span><span class="cbracket">}</span>
<span class="normal">            state</span><span class="symbol">-&gt;</span><span class="normal">extra </span><span class="symbol">=</span><span class="normal"> </span><span class="symbol">(</span><span class="type">unsigned</span><span class="symbol">)(</span><span class="normal">this</span><span class="symbol">.</span><span class="normal">op</span><span class="symbol">)</span><span class="normal"> </span><span class="symbol">&amp;</span><span class="normal"> </span><span class="number">15</span><span class="symbol">;</span>
<span class="normal">            state</span><span class="symbol">-&gt;</span><span class="normal">mode </span><span class="symbol">=</span><span class="normal"> LENEXT</span><span class="symbol">;</span>
<span class="normal">        </span><span class="keyword">case</span><span class="normal"> LENEXT</span><span class="symbol">:</span>
<span class="normal">            </span><span class="keyword">if</span><span class="normal"> </span><span class="symbol">(</span><span class="normal">state</span><span class="symbol">-&gt;</span><span class="normal">extra</span><span class="symbol">)</span><span class="normal"> </span><span class="cbracket">{</span>
<span class="normal">                </span><span class="function">NEEDBITS</span><span class="symbol">(</span><span class="normal">state</span><span class="symbol">-&gt;</span><span class="normal">extra</span><span class="symbol">);</span>
<span class="normal">                state</span><span class="symbol">-&gt;</span><span class="normal">length </span><span class="symbol">+=</span><span class="normal"> </span><span class="function">BITS</span><span class="symbol">(</span><span class="normal">state</span><span class="symbol">-&gt;</span><span class="normal">extra</span><span class="symbol">);</span>
<span class="normal">                </span><span class="function">DROPBITS</span><span class="symbol">(</span><span class="normal">state</span><span class="symbol">-&gt;</span><span class="normal">extra</span><span class="symbol">);</span>
<span class="normal">            </span><span class="cbracket">}</span>
<span class="normal">            </span><span class="function">Tracevv</span><span class="symbol">((</span><span class="normal">stderr</span><span class="symbol">,</span><span class="normal"> </span><span class="string">"inflate:         length %u</span><span class="specialchar">\n</span><span class="string">"</span><span class="symbol">,</span><span class="normal"> state</span><span class="symbol">-&gt;</span><span class="normal">length</span><span class="symbol">));</span>
<span class="normal">            state</span><span class="symbol">-&gt;</span><span class="normal">mode </span><span class="symbol">=</span><span class="normal"> DIST</span><span class="symbol">;</span>
<span class="normal">        </span><span class="keyword">case</span><span class="normal"> DIST</span><span class="symbol">:</span>
<span class="normal">            </span><span class="keyword">for</span><span class="normal"> </span><span class="symbol">(;;)</span><span class="normal"> </span><span class="cbracket">{</span>
<span class="normal">                this </span><span class="symbol">=</span><span class="normal"> state</span><span class="symbol">-&gt;</span><span class="normal">distcode</span><span class="symbol">[</span><span class="function">BITS</span><span class="symbol">(</span><span class="normal">state</span><span class="symbol">-&gt;</span><span class="normal">distbits</span><span class="symbol">)];</span>
<span class="normal">                </span><span class="keyword">if</span><span class="normal"> </span><span class="symbol">((</span><span class="type">unsigned</span><span class="symbol">)(</span><span class="normal">this</span><span class="symbol">.</span><span class="normal">bits</span><span class="symbol">)</span><span class="normal"> </span><span class="symbol">&lt;=</span><span class="normal"> bits</span><span class="symbol">)</span><span class="normal"> </span><span class="keyword">break</span><span class="symbol">;</span>
<span class="normal">                </span><span class="function">PULLBYTE</span><span class="symbol">();</span>
<span class="normal">            </span><span class="cbracket">}</span>
<span class="normal">            </span><span class="keyword">if</span><span class="normal"> </span><span class="symbol">((</span><span class="normal">this</span><span class="symbol">.</span><span class="normal">op </span><span class="symbol">&amp;</span><span class="normal"> </span><span class="number">0xf0</span><span class="symbol">)</span><span class="normal"> </span><span class="symbol">==</span><span class="normal"> </span><span class="number">0</span><span class="symbol">)</span><span class="normal"> </span><span class="cbracket">{</span>
<span class="normal">                last </span><span class="symbol">=</span><span class="normal"> this</span><span class="symbol">;</span>
<span class="normal">                </span><span class="keyword">for</span><span class="normal"> </span><span class="symbol">(;;)</span><span class="normal"> </span><span class="cbracket">{</span>
<span class="normal">                    this </span><span class="symbol">=</span><span class="normal"> state</span><span class="symbol">-&gt;</span><span class="normal">distcode</span><span class="symbol">[</span><span class="normal">last</span><span class="symbol">.</span><span class="normal">val </span><span class="symbol">+</span>
<span class="normal">                            </span><span class="symbol">(</span><span class="function">BITS</span><span class="symbol">(</span><span class="normal">last</span><span class="symbol">.</span><span class="normal">bits </span><span class="symbol">+</span><span class="normal"> last</span><span class="symbol">.</span><span class="normal">op</span><span class="symbol">)</span><span class="normal"> </span><span class="symbol">&gt;&gt;</span><span class="normal"> last</span><span class="symbol">.</span><span class="normal">bits</span><span class="symbol">)];</span>
<span class="normal">                    </span><span class="keyword">if</span><span class="normal"> </span><span class="symbol">((</span><span class="type">unsigned</span><span class="symbol">)(</span><span class="normal">last</span><span class="symbol">.</span><span class="normal">bits </span><span class="symbol">+</span><span class="normal"> this</span><span class="symbol">.</span><span class="normal">bits</span><span class="symbol">)</span><span class="normal"> </span><span class="symbol">&lt;=</span><span class="normal"> bits</span><span class="symbol">)</span><span class="normal"> </span><span class="keyword">break</span><span class="symbol">;</span>
<span class="normal">                    </span><span class="function">PULLBYTE</span><span class="symbol">();</span>
<span class="normal">                </span><span class="cbracket">}</span>
<span class="normal">                </span><span class="function">DROPBITS</span><span class="symbol">(</span><span class="normal">last</span><span class="symbol">.</span><span class="normal">bits</span><span class="symbol">);</span>
<span class="normal">            </span><span class="cbracket">}</span>
<span class="normal">            </span><span class="function">DROPBITS</span><span class="symbol">(</span><span class="normal">this</span><span class="symbol">.</span><span class="normal">bits</span><span class="symbol">);</span>
<span class="normal">            </span><span class="keyword">if</span><span class="normal"> </span><span class="symbol">(</span><span class="normal">this</span><span class="symbol">.</span><span class="normal">op </span><span class="symbol">&amp;</span><span class="normal"> </span><span class="number">64</span><span class="symbol">)</span><span class="normal"> </span><span class="cbracket">{</span>
<span class="normal">                strm</span><span class="symbol">-&gt;</span><span class="normal">msg </span><span class="symbol">=</span><span class="normal"> </span><span class="symbol">(</span><span class="type">char</span><span class="normal"> </span><span class="symbol">*)</span><span class="string">"invalid distance code"</span><span class="symbol">;</span>
<span class="normal">                state</span><span class="symbol">-&gt;</span><span class="normal">mode </span><span class="symbol">=</span><span class="normal"> BAD</span><span class="symbol">;</span>
<span class="normal">                </span><span class="keyword">break</span><span class="symbol">;</span>
<span class="normal">            </span><span class="cbracket">}</span>
<span class="normal">            state</span><span class="symbol">-&gt;</span><span class="normal">offset </span><span class="symbol">=</span><span class="normal"> </span><span class="symbol">(</span><span class="type">unsigned</span><span class="symbol">)</span><span class="normal">this</span><span class="symbol">.</span><span class="normal">val</span><span class="symbol">;</span>
<span class="normal">            state</span><span class="symbol">-&gt;</span><span class="normal">extra </span><span class="symbol">=</span><span class="normal"> </span><span class="symbol">(</span><span class="type">unsigned</span><span class="symbol">)(</span><span class="normal">this</span><span class="symbol">.</span><span class="normal">op</span><span class="symbol">)</span><span class="normal"> </span><span class="symbol">&amp;</span><span class="normal"> </span><span class="number">15</span><span class="symbol">;</span>
<span class="normal">            state</span><span class="symbol">-&gt;</span><span class="normal">mode </span><span class="symbol">=</span><span class="normal"> DISTEXT</span><span class="symbol">;</span>
<span class="normal">        </span><span class="keyword">case</span><span class="normal"> DISTEXT</span><span class="symbol">:</span>
<span class="normal">            </span><span class="keyword">if</span><span class="normal"> </span><span class="symbol">(</span><span class="normal">state</span><span class="symbol">-&gt;</span><span class="normal">extra</span><span class="symbol">)</span><span class="normal"> </span><span class="cbracket">{</span>
<span class="normal">                </span><span class="function">NEEDBITS</span><span class="symbol">(</span><span class="normal">state</span><span class="symbol">-&gt;</span><span class="normal">extra</span><span class="symbol">);</span>
<span class="normal">                state</span><span class="symbol">-&gt;</span><span class="normal">offset </span><span class="symbol">+=</span><span class="normal"> </span><span class="function">BITS</span><span class="symbol">(</span><span class="normal">state</span><span class="symbol">-&gt;</span><span class="normal">extra</span><span class="symbol">);</span>
<span class="normal">                </span><span class="function">DROPBITS</span><span class="symbol">(</span><span class="normal">state</span><span class="symbol">-&gt;</span><span class="normal">extra</span><span class="symbol">);</span>
<span class="normal">            </span><span class="cbracket">}</span>
<span class="preproc">#ifdef</span><span class="normal"> INFLATE_STRICT</span>
<span class="normal">            </span><span class="keyword">if</span><span class="normal"> </span><span class="symbol">(</span><span class="normal">state</span><span class="symbol">-&gt;</span><span class="normal">offset </span><span class="symbol">&gt;</span><span class="normal"> state</span><span class="symbol">-&gt;</span><span class="normal">dmax</span><span class="symbol">)</span><span class="normal"> </span><span class="cbracket">{</span>
<span class="normal">                strm</span><span class="symbol">-&gt;</span><span class="normal">msg </span><span class="symbol">=</span><span class="normal"> </span><span class="symbol">(</span><span class="type">char</span><span class="normal"> </span><span class="symbol">*)</span><span class="string">"invalid distance too far back"</span><span class="symbol">;</span>
<span class="normal">                state</span><span class="symbol">-&gt;</span><span class="normal">mode </span><span class="symbol">=</span><span class="normal"> BAD</span><span class="symbol">;</span>
<span class="normal">                </span><span class="keyword">break</span><span class="symbol">;</span>
<span class="normal">            </span><span class="cbracket">}</span>
<span class="preproc">#endif</span>
<span class="normal">            </span><span class="keyword">if</span><span class="normal"> </span><span class="symbol">(</span><span class="normal">state</span><span class="symbol">-&gt;</span><span class="normal">offset </span><span class="symbol">&gt;</span><span class="normal"> state</span><span class="symbol">-&gt;</span><span class="normal">whave </span><span class="symbol">+</span><span class="normal"> out </span><span class="symbol">-</span><span class="normal"> left</span><span class="symbol">)</span><span class="normal"> </span><span class="cbracket">{</span>
<span class="normal">                strm</span><span class="symbol">-&gt;</span><span class="normal">msg </span><span class="symbol">=</span><span class="normal"> </span><span class="symbol">(</span><span class="type">char</span><span class="normal"> </span><span class="symbol">*)</span><span class="string">"invalid distance too far back"</span><span class="symbol">;</span>
<span class="normal">                state</span><span class="symbol">-&gt;</span><span class="normal">mode </span><span class="symbol">=</span><span class="normal"> BAD</span><span class="symbol">;</span>
<span class="normal">                </span><span class="keyword">break</span><span class="symbol">;</span>
<span class="normal">            </span><span class="cbracket">}</span>
<span class="normal">            </span><span class="function">Tracevv</span><span class="symbol">((</span><span class="normal">stderr</span><span class="symbol">,</span><span class="normal"> </span><span class="string">"inflate:         distance %u</span><span class="specialchar">\n</span><span class="string">"</span><span class="symbol">,</span><span class="normal"> state</span><span class="symbol">-&gt;</span><span class="normal">offset</span><span class="symbol">));</span>
<span class="normal">            state</span><span class="symbol">-&gt;</span><span class="normal">mode </span><span class="symbol">=</span><span class="normal"> MATCH</span><span class="symbol">;</span>
<span class="normal">        </span><span class="keyword">case</span><span class="normal"> MATCH</span><span class="symbol">:</span>
<span class="normal">            </span><span class="keyword">if</span><span class="normal"> </span><span class="symbol">(</span><span class="normal">left </span><span class="symbol">==</span><span class="normal"> </span><span class="number">0</span><span class="symbol">)</span><span class="normal"> </span><span class="keyword">goto</span><span class="normal"> inf_leave</span><span class="symbol">;</span>
<span class="normal">            copy </span><span class="symbol">=</span><span class="normal"> out </span><span class="symbol">-</span><span class="normal"> left</span><span class="symbol">;</span>
<span class="normal">            </span><span class="keyword">if</span><span class="normal"> </span><span class="symbol">(</span><span class="normal">state</span><span class="symbol">-&gt;</span><span class="normal">offset </span><span class="symbol">&gt;</span><span class="normal"> copy</span><span class="symbol">)</span><span class="normal"> </span><span class="cbracket">{</span><span class="normal">         </span><span class="comment">/* copy from window */</span>
<span class="normal">                copy </span><span class="symbol">=</span><span class="normal"> state</span><span class="symbol">-&gt;</span><span class="normal">offset </span><span class="symbol">-</span><span class="normal"> copy</span><span class="symbol">;</span>
<span class="normal">                </span><span class="keyword">if</span><span class="normal"> </span><span class="symbol">(</span><span class="normal">copy </span><span class="symbol">&gt;</span><span class="normal"> state</span><span class="symbol">-&gt;</span><span class="normal">write</span><span class="symbol">)</span><span class="normal"> </span><span class="cbracket">{</span>
<span class="normal">                    copy </span><span class="symbol">-=</span><span class="normal"> state</span><span class="symbol">-&gt;</span><span class="normal">write</span><span class="symbol">;</span>
<span class="normal">                    from </span><span class="symbol">=</span><span class="normal"> state</span><span class="symbol">-&gt;</span><span class="normal">window </span><span class="symbol">+</span><span class="normal"> </span><span class="symbol">(</span><span class="normal">state</span><span class="symbol">-&gt;</span><span class="normal">wsize </span><span class="symbol">-</span><span class="normal"> copy</span><span class="symbol">);</span>
<span class="normal">                </span><span class="cbracket">}</span>
<span class="normal">                </span><span class="keyword">else</span>
<span class="normal">                    from </span><span class="symbol">=</span><span class="normal"> state</span><span class="symbol">-&gt;</span><span class="normal">window </span><span class="symbol">+</span><span class="normal"> </span><span class="symbol">(</span><span class="normal">state</span><span class="symbol">-&gt;</span><span class="normal">write </span><span class="symbol">-</span><span class="normal"> copy</span><span class="symbol">);</span>
<span class="normal">                </span><span class="keyword">if</span><span class="normal"> </span><span class="symbol">(</span><span class="normal">copy </span><span class="symbol">&gt;</span><span class="normal"> state</span><span class="symbol">-&gt;</span><span class="normal">length</span><span class="symbol">)</span><span class="normal"> copy </span><span class="symbol">=</span><span class="normal"> state</span><span class="symbol">-&gt;</span><span class="normal">length</span><span class="symbol">;</span>
<span class="normal">            </span><span class="cbracket">}</span>
<span class="normal">            </span><span class="keyword">else</span><span class="normal"> </span><span class="cbracket">{</span><span class="normal">                              </span><span class="comment">/* copy from output */</span>
<span class="normal">                from </span><span class="symbol">=</span><span class="normal"> put </span><span class="symbol">-</span><span class="normal"> state</span><span class="symbol">-&gt;</span><span class="normal">offset</span><span class="symbol">;</span>
<span class="normal">                copy </span><span class="symbol">=</span><span class="normal"> state</span><span class="symbol">-&gt;</span><span class="normal">length</span><span class="symbol">;</span>
<span class="normal">            </span><span class="cbracket">}</span>
<span class="normal">            </span><span class="keyword">if</span><span class="normal"> </span><span class="symbol">(</span><span class="normal">copy </span><span class="symbol">&gt;</span><span class="normal"> left</span><span class="symbol">)</span><span class="normal"> copy </span><span class="symbol">=</span><span class="normal"> left</span><span class="symbol">;</span>
<span class="normal">            left </span><span class="symbol">-=</span><span class="normal"> copy</span><span class="symbol">;</span>
<span class="normal">            state</span><span class="symbol">-&gt;</span><span class="normal">length </span><span class="symbol">-=</span><span class="normal"> copy</span><span class="symbol">;</span>
<span class="normal">            </span><span class="keyword">do</span><span class="normal"> </span><span class="cbracket">{</span>
<span class="normal">                </span><span class="symbol">*</span><span class="normal">put</span><span class="symbol">++</span><span class="normal"> </span><span class="symbol">=</span><span class="normal"> </span><span class="symbol">*</span><span class="normal">from</span><span class="symbol">++;</span>
<span class="normal">            </span><span class="cbracket">}</span><span class="normal"> </span><span class="keyword">while</span><span class="normal"> </span><span class="symbol">(--</span><span class="normal">copy</span><span class="symbol">);</span>
<span class="normal">            </span><span class="keyword">if</span><span class="normal"> </span><span class="symbol">(</span><span class="normal">state</span><span class="symbol">-&gt;</span><span class="normal">length </span><span class="symbol">==</span><span class="normal"> </span><span class="number">0</span><span class="symbol">)</span><span class="normal"> state</span><span class="symbol">-&gt;</span><span class="normal">mode </span><span class="symbol">=</span><span class="normal"> LEN</span><span class="symbol">;</span>
<span class="normal">            </span><span class="keyword">break</span><span class="symbol">;</span>
<span class="normal">        </span><span class="keyword">case</span><span class="normal"> LIT</span><span class="symbol">:</span>
<span class="normal">            </span><span class="keyword">if</span><span class="normal"> </span><span class="symbol">(</span><span class="normal">left </span><span class="symbol">==</span><span class="normal"> </span><span class="number">0</span><span class="symbol">)</span><span class="normal"> </span><span class="keyword">goto</span><span class="normal"> inf_leave</span><span class="symbol">;</span>
<span class="normal">            </span><span class="symbol">*</span><span class="normal">put</span><span class="symbol">++</span><span class="normal"> </span><span class="symbol">=</span><span class="normal"> </span><span class="symbol">(</span><span class="type">unsigned</span><span class="normal"> </span><span class="type">char</span><span class="symbol">)(</span><span class="normal">state</span><span class="symbol">-&gt;</span><span class="normal">length</span><span class="symbol">);</span>
<span class="normal">            left</span><span class="symbol">--;</span>
<span class="normal">            state</span><span class="symbol">-&gt;</span><span class="normal">mode </span><span class="symbol">=</span><span class="normal"> LEN</span><span class="symbol">;</span>
<span class="normal">            </span><span class="keyword">break</span><span class="symbol">;</span>
<span class="normal">        </span><span class="keyword">case</span><span class="normal"> CHECK</span><span class="symbol">:</span>
<span class="normal">            </span><span class="keyword">if</span><span class="normal"> </span><span class="symbol">(</span><span class="normal">state</span><span class="symbol">-&gt;</span><span class="normal">wrap</span><span class="symbol">)</span><span class="normal"> </span><span class="cbracket">{</span>
<span class="normal">                </span><span class="function">NEEDBITS</span><span class="symbol">(</span><span class="number">32</span><span class="symbol">);</span>
<span class="normal">                out </span><span class="symbol">-=</span><span class="normal"> left</span><span class="symbol">;</span>
<span class="normal">                strm</span><span class="symbol">-&gt;</span><span class="normal">total_out </span><span class="symbol">+=</span><span class="normal"> out</span><span class="symbol">;</span>
<span class="normal">                state</span><span class="symbol">-&gt;</span><span class="normal">total </span><span class="symbol">+=</span><span class="normal"> out</span><span class="symbol">;</span>
<span class="normal">                </span><span class="keyword">if</span><span class="normal"> </span><span class="symbol">(</span><span class="normal">out</span><span class="symbol">)</span>
<span class="normal">                    strm</span><span class="symbol">-&gt;</span><span class="normal">adler </span><span class="symbol">=</span><span class="normal"> state</span><span class="symbol">-&gt;</span><span class="normal">check </span><span class="symbol">=</span>
<span class="normal">                        </span><span class="function">UPDATE</span><span class="symbol">(</span><span class="normal">state</span><span class="symbol">-&gt;</span><span class="normal">check</span><span class="symbol">,</span><span class="normal"> put </span><span class="symbol">-</span><span class="normal"> out</span><span class="symbol">,</span><span class="normal"> out</span><span class="symbol">);</span>
<span class="normal">                out </span><span class="symbol">=</span><span class="normal"> left</span><span class="symbol">;</span>
<span class="normal">                </span><span class="keyword">if</span><span class="normal"> </span><span class="symbol">((</span>
<span class="preproc">#ifdef</span><span class="normal"> GUNZIP</span>
<span class="normal">                     state</span><span class="symbol">-&gt;</span><span class="normal">flags </span><span class="symbol">?</span><span class="normal"> hold </span><span class="symbol">:</span>
<span class="preproc">#endif</span>
<span class="normal">                     </span><span class="function">REVERSE</span><span class="symbol">(</span><span class="normal">hold</span><span class="symbol">))</span><span class="normal"> </span><span class="symbol">!=</span><span class="normal"> state</span><span class="symbol">-&gt;</span><span class="normal">check</span><span class="symbol">)</span><span class="normal"> </span><span class="cbracket">{</span>
<span class="normal">                    strm</span><span class="symbol">-&gt;</span><span class="normal">msg </span><span class="symbol">=</span><span class="normal"> </span><span class="symbol">(</span><span class="type">char</span><span class="normal"> </span><span class="symbol">*)</span><span class="string">"incorrect data check"</span><span class="symbol">;</span>
<span class="normal">                    state</span><span class="symbol">-&gt;</span><span class="normal">mode </span><span class="symbol">=</span><span class="normal"> BAD</span><span class="symbol">;</span>
<span class="normal">                    </span><span class="keyword">break</span><span class="symbol">;</span>
<span class="normal">                </span><span class="cbracket">}</span>
<span class="normal">                </span><span class="function">INITBITS</span><span class="symbol">();</span>
<span class="normal">                </span><span class="function">Tracev</span><span class="symbol">((</span><span class="normal">stderr</span><span class="symbol">,</span><span class="normal"> </span><span class="string">"inflate:   check matches trailer</span><span class="specialchar">\n</span><span class="string">"</span><span class="symbol">));</span>
<span class="normal">            </span><span class="cbracket">}</span>
<span class="preproc">#ifdef</span><span class="normal"> GUNZIP</span>
<span class="normal">            state</span><span class="symbol">-&gt;</span><span class="normal">mode </span><span class="symbol">=</span><span class="normal"> LENGTH</span><span class="symbol">;</span>
<span class="normal">        </span><span class="keyword">case</span><span class="normal"> LENGTH</span><span class="symbol">:</span>
<span class="normal">            </span><span class="keyword">if</span><span class="normal"> </span><span class="symbol">(</span><span class="normal">state</span><span class="symbol">-&gt;</span><span class="normal">wrap </span><span class="symbol">&amp;&amp;</span><span class="normal"> state</span><span class="symbol">-&gt;</span><span class="normal">flags</span><span class="symbol">)</span><span class="normal"> </span><span class="cbracket">{</span>
<span class="normal">                </span><span class="function">NEEDBITS</span><span class="symbol">(</span><span class="number">32</span><span class="symbol">);</span>
<span class="normal">                </span><span class="keyword">if</span><span class="normal"> </span><span class="symbol">(</span><span class="normal">hold </span><span class="symbol">!=</span><span class="normal"> </span><span class="symbol">(</span><span class="normal">state</span><span class="symbol">-&gt;</span><span class="normal">total </span><span class="symbol">&amp;</span><span class="normal"> 0xffffffffUL</span><span class="symbol">))</span><span class="normal"> </span><span class="cbracket">{</span>
<span class="normal">                    strm</span><span class="symbol">-&gt;</span><span class="normal">msg </span><span class="symbol">=</span><span class="normal"> </span><span class="symbol">(</span><span class="type">char</span><span class="normal"> </span><span class="symbol">*)</span><span class="string">"incorrect length check"</span><span class="symbol">;</span>
<span class="normal">                    state</span><span class="symbol">-&gt;</span><span class="normal">mode </span><span class="symbol">=</span><span class="normal"> BAD</span><span class="symbol">;</span>
<span class="normal">                    </span><span class="keyword">break</span><span class="symbol">;</span>
<span class="normal">                </span><span class="cbracket">}</span>
<span class="normal">                </span><span class="function">INITBITS</span><span class="symbol">();</span>
<span class="normal">                </span><span class="function">Tracev</span><span class="symbol">((</span><span class="normal">stderr</span><span class="symbol">,</span><span class="normal"> </span><span class="string">"inflate:   length matches trailer</span><span class="specialchar">\n</span><span class="string">"</span><span class="symbol">));</span>
<span class="normal">            </span><span class="cbracket">}</span>
<span class="preproc">#endif</span>
<span class="normal">            state</span><span class="symbol">-&gt;</span><span class="normal">mode </span><span class="symbol">=</span><span class="normal"> DONE</span><span class="symbol">;</span>
<span class="normal">        </span><span class="keyword">case</span><span class="normal"> DONE</span><span class="symbol">:</span>
<span class="normal">            ret </span><span class="symbol">=</span><span class="normal"> Z_STREAM_END</span><span class="symbol">;</span>
<span class="normal">            </span><span class="keyword">goto</span><span class="normal"> inf_leave</span><span class="symbol">;</span>
<span class="normal">        </span><span class="keyword">case</span><span class="normal"> BAD</span><span class="symbol">:</span>
<span class="normal">            ret </span><span class="symbol">=</span><span class="normal"> Z_DATA_ERROR</span><span class="symbol">;</span>
<span class="normal">            </span><span class="keyword">goto</span><span class="normal"> inf_leave</span><span class="symbol">;</span>
<span class="normal">        </span><span class="keyword">case</span><span class="normal"> MEM</span><span class="symbol">:</span>
<span class="normal">            </span><span class="keyword">return</span><span class="normal"> Z_MEM_ERROR</span><span class="symbol">;</span>
<span class="normal">        </span><span class="keyword">case</span><span class="normal"> SYNC</span><span class="symbol">:</span>
<span class="label">        default:</span>
<span class="normal">            </span><span class="keyword">return</span><span class="normal"> Z_STREAM_ERROR</span><span class="symbol">;</span>
<span class="normal">        </span><span class="cbracket">}</span>

<span class="normal">    </span><span class="comment">/*</span>
<span class="comment">       Return from inflate(), updating the total counts and the check value.</span>
<span class="comment">       If there was no progress during the inflate() call, return a buffer</span>
<span class="comment">       error.  Call updatewindow() to create and/or update the window state.</span>
<span class="comment">       Note: a memory error from inflate() is non-recoverable.</span>
<span class="comment">     */</span>
<span class="normal">  inf_leave</span><span class="symbol">:</span>
<span class="normal">    </span><span class="function">RESTORE</span><span class="symbol">();</span>
<span class="normal">    </span><span class="keyword">if</span><span class="normal"> </span><span class="symbol">(</span><span class="normal">state</span><span class="symbol">-&gt;</span><span class="normal">wsize </span><span class="symbol">||</span><span class="normal"> </span><span class="symbol">(</span><span class="normal">state</span><span class="symbol">-&gt;</span><span class="normal">mode </span><span class="symbol">&lt;</span><span class="normal"> CHECK </span><span class="symbol">&amp;&amp;</span><span class="normal"> out </span><span class="symbol">!=</span><span class="normal"> strm</span><span class="symbol">-&gt;</span><span class="normal">avail_out</span><span class="symbol">))</span>
<span class="normal">        </span><span class="keyword">if</span><span class="normal"> </span><span class="symbol">(</span><span class="function">updatewindow</span><span class="symbol">(</span><span class="normal">strm</span><span class="symbol">,</span><span class="normal"> out</span><span class="symbol">))</span><span class="normal"> </span><span class="cbracket">{</span>
<span class="normal">            state</span><span class="symbol">-&gt;</span><span class="normal">mode </span><span class="symbol">=</span><span class="normal"> MEM</span><span class="symbol">;</span>
<span class="normal">            </span><span class="keyword">return</span><span class="normal"> Z_MEM_ERROR</span><span class="symbol">;</span>
<span class="normal">        </span><span class="cbracket">}</span>
<span class="normal">    in </span><span class="symbol">-=</span><span class="normal"> strm</span><span class="symbol">-&gt;</span><span class="normal">avail_in</span><span class="symbol">;</span>
<span class="normal">    out </span><span class="symbol">-=</span><span class="normal"> strm</span><span class="symbol">-&gt;</span><span class="normal">avail_out</span><span class="symbol">;</span>
<span class="normal">    strm</span><span class="symbol">-&gt;</span><span class="normal">total_in </span><span class="symbol">+=</span><span class="normal"> in</span><span class="symbol">;</span>
<span class="normal">    strm</span><span class="symbol">-&gt;</span><span class="normal">total_out </span><span class="symbol">+=</span><span class="normal"> out</span><span class="symbol">;</span>
<span class="normal">    state</span><span class="symbol">-&gt;</span><span class="normal">total </span><span class="symbol">+=</span><span class="normal"> out</span><span class="symbol">;</span>
<span class="normal">    </span><span class="keyword">if</span><span class="normal"> </span><span class="symbol">(</span><span class="normal">state</span><span class="symbol">-&gt;</span><span class="normal">wrap </span><span class="symbol">&amp;&amp;</span><span class="normal"> out</span><span class="symbol">)</span>
<span class="normal">        strm</span><span class="symbol">-&gt;</span><span class="normal">adler </span><span class="symbol">=</span><span class="normal"> state</span><span class="symbol">-&gt;</span><span class="normal">check </span><span class="symbol">=</span>
<span class="normal">            </span><span class="function">UPDATE</span><span class="symbol">(</span><span class="normal">state</span><span class="symbol">-&gt;</span><span class="normal">check</span><span class="symbol">,</span><span class="normal"> strm</span><span class="symbol">-&gt;</span><span class="normal">next_out </span><span class="symbol">-</span><span class="normal"> out</span><span class="symbol">,</span><span class="normal"> out</span><span class="symbol">);</span>
<span class="normal">    strm</span><span class="symbol">-&gt;</span><span class="normal">data_type </span><span class="symbol">=</span><span class="normal"> state</span><span class="symbol">-&gt;</span><span class="normal">bits </span><span class="symbol">+</span><span class="normal"> </span><span class="symbol">(</span><span class="normal">state</span><span class="symbol">-&gt;</span><span class="normal">last </span><span class="symbol">?</span><span class="normal"> </span><span class="number">64</span><span class="normal"> </span><span class="symbol">:</span><span class="normal"> </span><span class="number">0</span><span class="symbol">)</span><span class="normal"> </span><span class="symbol">+</span>
<span class="normal">                      </span><span class="symbol">(</span><span class="normal">state</span><span class="symbol">-&gt;</span><span class="normal">mode </span><span class="symbol">==</span><span class="normal"> TYPE </span><span class="symbol">?</span><span class="normal"> </span><span class="number">128</span><span class="normal"> </span><span class="symbol">:</span><span class="normal"> </span><span class="number">0</span><span class="symbol">);</span>
<span class="normal">    </span><span class="keyword">if</span><span class="normal"> </span><span class="symbol">(((</span><span class="normal">in </span><span class="symbol">==</span><span class="normal"> </span><span class="number">0</span><span class="normal"> </span><span class="symbol">&amp;&amp;</span><span class="normal"> out </span><span class="symbol">==</span><span class="normal"> </span><span class="number">0</span><span class="symbol">)</span><span class="normal"> </span><span class="symbol">||</span><span class="normal"> flush </span><span class="symbol">==</span><span class="normal"> Z_FINISH</span><span class="symbol">)</span><span class="normal"> </span><span class="symbol">&amp;&amp;</span><span class="normal"> ret </span><span class="symbol">==</span><span class="normal"> Z_OK</span><span class="symbol">)</span>
<span class="normal">        ret </span><span class="symbol">=</span><span class="normal"> Z_BUF_ERROR</span><span class="symbol">;</span>
<span class="normal">    </span><span class="keyword">return</span><span class="normal"> ret</span><span class="symbol">;</span>
<span class="cbracket">}</span>

<span class="type">int</span><span class="normal"> </span><span class="usertype">ZEXPORT</span><span class="normal"> </span><span class="function">inflateEnd</span><span class="symbol">(</span><span class="normal">strm</span><span class="symbol">)</span>
<span class="usertype">z_streamp</span><span class="normal"> strm</span><span class="symbol">;</span>
<span class="cbracket">{</span>
<span class="normal">    </span><span class="keyword">struct</span><span class="normal"> </span><span class="classname">inflate_state</span><span class="normal"> </span><span class="usertype">FAR</span><span class="normal"> </span><span class="symbol">*</span><span class="normal">state</span><span class="symbol">;</span>
<span class="normal">    </span><span class="keyword">if</span><span class="normal"> </span><span class="symbol">(</span><span class="normal">strm </span><span class="symbol">==</span><span class="normal"> Z_NULL </span><span class="symbol">||</span><span class="normal"> strm</span><span class="symbol">-&gt;</span><span class="normal">state </span><span class="symbol">==</span><span class="normal"> Z_NULL </span><span class="symbol">||</span><span class="normal"> strm</span><span class="symbol">-&gt;</span><span class="normal">zfree </span><span class="symbol">==</span><span class="normal"> </span><span class="symbol">(</span><span class="normal">free_func</span><span class="symbol">)</span><span class="number">0</span><span class="symbol">)</span>
<span class="normal">        </span><span class="keyword">return</span><span class="normal"> Z_STREAM_ERROR</span><span class="symbol">;</span>
<span class="normal">    state </span><span class="symbol">=</span><span class="normal"> </span><span class="symbol">(</span><span class="keyword">struct</span><span class="normal"> </span><span class="classname">inflate_state</span><span class="normal"> FAR </span><span class="symbol">*)</span><span class="normal">strm</span><span class="symbol">-&gt;</span><span class="normal">state</span><span class="symbol">;</span>
<span class="normal">    </span><span class="keyword">if</span><span class="normal"> </span><span class="symbol">(</span><span class="normal">state</span><span class="symbol">-&gt;</span><span class="normal">window </span><span class="symbol">!=</span><span class="normal"> Z_NULL</span><span class="symbol">)</span><span class="normal"> </span><span class="function">ZFREE</span><span class="symbol">(</span><span class="normal">strm</span><span class="symbol">,</span><span class="normal"> state</span><span class="symbol">-&gt;</span><span class="normal">window</span><span class="symbol">);</span>
<span class="normal">    </span><span class="function">ZFREE</span><span class="symbol">(</span><span class="normal">strm</span><span class="symbol">,</span><span class="normal"> strm</span><span class="symbol">-&gt;</span><span class="normal">state</span><span class="symbol">);</span>
<span class="normal">    strm</span><span class="symbol">-&gt;</span><span class="normal">state </span><span class="symbol">=</span><span class="normal"> Z_NULL</span><span class="symbol">;</span>
<span class="normal">    </span><span class="function">Tracev</span><span class="symbol">((</span><span class="normal">stderr</span><span class="symbol">,</span><span class="normal"> </span><span class="string">"inflate: end</span><span class="specialchar">\n</span><span class="string">"</span><span class="symbol">));</span>
<span class="normal">    </span><span class="keyword">return</span><span class="normal"> Z_OK</span><span class="symbol">;</span>
<span class="cbracket">}</span>

<span class="type">int</span><span class="normal"> </span><span class="usertype">ZEXPORT</span><span class="normal"> </span><span class="function">inflateSetDictionary</span><span class="symbol">(</span><span class="normal">strm</span><span class="symbol">,</span><span class="normal"> dictionary</span><span class="symbol">,</span><span class="normal"> dictLength</span><span class="symbol">)</span>
<span class="usertype">z_streamp</span><span class="normal"> strm</span><span class="symbol">;</span>
<span class="keyword">const</span><span class="normal"> </span><span class="usertype">Bytef</span><span class="normal"> </span><span class="symbol">*</span><span class="normal">dictionary</span><span class="symbol">;</span>
<span class="usertype">uInt</span><span class="normal"> dictLength</span><span class="symbol">;</span>
<span class="cbracket">{</span>
<span class="normal">    </span><span class="keyword">struct</span><span class="normal"> </span><span class="classname">inflate_state</span><span class="normal"> </span><span class="usertype">FAR</span><span class="normal"> </span><span class="symbol">*</span><span class="normal">state</span><span class="symbol">;</span>
<span class="normal">    </span><span class="type">unsigned</span><span class="normal"> </span><span class="type">long</span><span class="normal"> id</span><span class="symbol">;</span>

<span class="normal">    </span><span class="comment">/* check state */</span>
<span class="normal">    </span><span class="keyword">if</span><span class="normal"> </span><span class="symbol">(</span><span class="normal">strm </span><span class="symbol">==</span><span class="normal"> Z_NULL </span><span class="symbol">||</span><span class="normal"> strm</span><span class="symbol">-&gt;</span><span class="normal">state </span><span class="symbol">==</span><span class="normal"> Z_NULL</span><span class="symbol">)</span><span class="normal"> </span><span class="keyword">return</span><span class="normal"> Z_STREAM_ERROR</span><span class="symbol">;</span>
<span class="normal">    state </span><span class="symbol">=</span><span class="normal"> </span><span class="symbol">(</span><span class="keyword">struct</span><span class="normal"> </span><span class="classname">inflate_state</span><span class="normal"> FAR </span><span class="symbol">*)</span><span class="normal">strm</span><span class="symbol">-&gt;</span><span class="normal">state</span><span class="symbol">;</span>
<span class="normal">    </span><span class="keyword">if</span><span class="normal"> </span><span class="symbol">(</span><span class="normal">state</span><span class="symbol">-&gt;</span><span class="normal">wrap </span><span class="symbol">!=</span><span class="normal"> </span><span class="number">0</span><span class="normal"> </span><span class="symbol">&amp;&amp;</span><span class="normal"> state</span><span class="symbol">-&gt;</span><span class="normal">mode </span><span class="symbol">!=</span><span class="normal"> DICT</span><span class="symbol">)</span>
<span class="normal">        </span><span class="keyword">return</span><span class="normal"> Z_STREAM_ERROR</span><span class="symbol">;</span>

<span class="normal">    </span><span class="comment">/* check for correct dictionary id */</span>
<span class="normal">    </span><span class="keyword">if</span><span class="normal"> </span><span class="symbol">(</span><span class="normal">state</span><span class="symbol">-&gt;</span><span class="normal">mode </span><span class="symbol">==</span><span class="normal"> DICT</span><span class="symbol">)</span><span class="normal"> </span><span class="cbracket">{</span>
<span class="normal">        id </span><span class="symbol">=</span><span class="normal"> </span><span class="function">adler32</span><span class="symbol">(</span><span class="number">0L</span><span class="symbol">,</span><span class="normal"> Z_NULL</span><span class="symbol">,</span><span class="normal"> </span><span class="number">0</span><span class="symbol">);</span>
<span class="normal">        id </span><span class="symbol">=</span><span class="normal"> </span><span class="function">adler32</span><span class="symbol">(</span><span class="normal">id</span><span class="symbol">,</span><span class="normal"> dictionary</span><span class="symbol">,</span><span class="normal"> dictLength</span><span class="symbol">);</span>
<span class="normal">        </span><span class="keyword">if</span><span class="normal"> </span><span class="symbol">(</span><span class="normal">id </span><span class="symbol">!=</span><span class="normal"> state</span><span class="symbol">-&gt;</span><span class="normal">check</span><span class="symbol">)</span>
<span class="normal">            </span><span class="keyword">return</span><span class="normal"> Z_DATA_ERROR</span><span class="symbol">;</span>
<span class="normal">    </span><span class="cbracket">}</span>

<span class="normal">    </span><span class="comment">/* copy dictionary to window */</span>
<span class="normal">    </span><span class="keyword">if</span><span class="normal"> </span><span class="symbol">(</span><span class="function">updatewindow</span><span class="symbol">(</span><span class="normal">strm</span><span class="symbol">,</span><span class="normal"> strm</span><span class="symbol">-&gt;</span><span class="normal">avail_out</span><span class="symbol">))</span><span class="normal"> </span><span class="cbracket">{</span>
<span class="normal">        state</span><span class="symbol">-&gt;</span><span class="normal">mode </span><span class="symbol">=</span><span class="normal"> MEM</span><span class="symbol">;</span>
<span class="normal">        </span><span class="keyword">return</span><span class="normal"> Z_MEM_ERROR</span><span class="symbol">;</span>
<span class="normal">    </span><span class="cbracket">}</span>
<span class="normal">    </span><span class="keyword">if</span><span class="normal"> </span><span class="symbol">(</span><span class="normal">dictLength </span><span class="symbol">&gt;</span><span class="normal"> state</span><span class="symbol">-&gt;</span><span class="normal">wsize</span><span class="symbol">)</span><span class="normal"> </span><span class="cbracket">{</span>
<span class="normal">        </span><span class="function">zmemcpy</span><span class="symbol">(</span><span class="normal">state</span><span class="symbol">-&gt;</span><span class="normal">window</span><span class="symbol">,</span><span class="normal"> dictionary </span><span class="symbol">+</span><span class="normal"> dictLength </span><span class="symbol">-</span><span class="normal"> state</span><span class="symbol">-&gt;</span><span class="normal">wsize</span><span class="symbol">,</span>
<span class="normal">                state</span><span class="symbol">-&gt;</span><span class="normal">wsize</span><span class="symbol">);</span>
<span class="normal">        state</span><span class="symbol">-&gt;</span><span class="normal">whave </span><span class="symbol">=</span><span class="normal"> state</span><span class="symbol">-&gt;</span><span class="normal">wsize</span><span class="symbol">;</span>
<span class="normal">    </span><span class="cbracket">}</span>
<span class="normal">    </span><span class="keyword">else</span><span class="normal"> </span><span class="cbracket">{</span>
<span class="normal">        </span><span class="function">zmemcpy</span><span class="symbol">(</span><span class="normal">state</span><span class="symbol">-&gt;</span><span class="normal">window </span><span class="symbol">+</span><span class="normal"> state</span><span class="symbol">-&gt;</span><span class="normal">wsize </span><span class="symbol">-</span><span class="normal"> dictLength</span><span class="symbol">,</span><span class="normal"> dictionary</span><span class="symbol">,</span>
<span class="normal">                dictLength</span><span class="symbol">);</span>
<span class="normal">        state</span><span class="symbol">-&gt;</span><span class="normal">whave </span><span class="symbol">=</span><span class="normal"> dictLength</span><span class="symbol">;</span>
<span class="normal">    </span><span class="cbracket">}</span>
<span class="normal">    state</span><span class="symbol">-&gt;</span><span class="normal">havedict </span><span class="symbol">=</span><span class="normal"> </span><span class="number">1</span><span class="symbol">;</span>
<span class="normal">    </span><span class="function">Tracev</span><span class="symbol">((</span><span class="normal">stderr</span><span class="symbol">,</span><span class="normal"> </span><span class="string">"inflate:   dictionary set</span><span class="specialchar">\n</span><span class="string">"</span><span class="symbol">));</span>
<span class="normal">    </span><span class="keyword">return</span><span class="normal"> Z_OK</span><span class="symbol">;</span>
<span class="cbracket">}</span>

<span class="type">int</span><span class="normal"> </span><span class="usertype">ZEXPORT</span><span class="normal"> </span><span class="function">inflateGetHeader</span><span class="symbol">(</span><span class="normal">strm</span><span class="symbol">,</span><span class="normal"> head</span><span class="symbol">)</span>
<span class="usertype">z_streamp</span><span class="normal"> strm</span><span class="symbol">;</span>
<span class="usertype">gz_headerp</span><span class="normal"> head</span><span class="symbol">;</span>
<span class="cbracket">{</span>
<span class="normal">    </span><span class="keyword">struct</span><span class="normal"> </span><span class="classname">inflate_state</span><span class="normal"> </span><span class="usertype">FAR</span><span class="normal"> </span><span class="symbol">*</span><span class="normal">state</span><span class="symbol">;</span>

<span class="normal">    </span><span class="comment">/* check state */</span>
<span class="normal">    </span><span class="keyword">if</span><span class="normal"> </span><span class="symbol">(</span><span class="normal">strm </span><span class="symbol">==</span><span class="normal"> Z_NULL </span><span class="symbol">||</span><span class="normal"> strm</span><span class="symbol">-&gt;</span><span class="normal">state </span><span class="symbol">==</span><span class="normal"> Z_NULL</span><span class="symbol">)</span><span class="normal"> </span><span class="keyword">return</span><span class="normal"> Z_STREAM_ERROR</span><span class="symbol">;</span>
<span class="normal">    state </span><span class="symbol">=</span><span class="normal"> </span><span class="symbol">(</span><span class="keyword">struct</span><span class="normal"> </span><span class="classname">inflate_state</span><span class="normal"> FAR </span><span class="symbol">*)</span><span class="normal">strm</span><span class="symbol">-&gt;</span><span class="normal">state</span><span class="symbol">;</span>
<span class="normal">    </span><span class="keyword">if</span><span class="normal"> </span><span class="symbol">((</span><span class="normal">state</span><span class="symbol">-&gt;</span><span class="normal">wrap </span><span class="symbol">&amp;</span><span class="normal"> </span><span class="number">2</span><span class="symbol">)</span><span class="normal"> </span><span class="symbol">==</span><span class="normal"> </span><span class="number">0</span><span class="symbol">)</span><span class="normal"> </span><span class="keyword">return</span><span class="normal"> Z_STREAM_ERROR</span><span class="symbol">;</span>

<span class="normal">    </span><span class="comment">/* save header structure */</span>
<span class="normal">    state</span><span class="symbol">-&gt;</span><span class="normal">head </span><span class="symbol">=</span><span class="normal"> head</span><span class="symbol">;</span>
<span class="normal">    head</span><span class="symbol">-&gt;</span><span class="normal">done </span><span class="symbol">=</span><span class="normal"> </span><span class="number">0</span><span class="symbol">;</span>
<span class="normal">    </span><span class="keyword">return</span><span class="normal"> Z_OK</span><span class="symbol">;</span>
<span class="cbracket">}</span>

<span class="comment">/*</span>
<span class="comment">   Search buf[0..len-1] for the pattern: 0, 0, 0xff, 0xff.  Return when found</span>
<span class="comment">   or when out of input.  When called, *have is the number of pattern bytes</span>
<span class="comment">   found in order so far, in 0..3.  On return *have is updated to the new</span>
<span class="comment">   state.  If on return *have equals four, then the pattern was found and the</span>
<span class="comment">   return value is how many bytes were read including the last byte of the</span>
<span class="comment">   pattern.  If *have is less than four, then the pattern has not been found</span>
<span class="comment">   yet and the return value is len.  In the latter case, syncsearch() can be</span>
<span class="comment">   called again with more data and the *have state.  *have is initialized to</span>
<span class="comment">   zero for the first call.</span>
<span class="comment"> */</span>
<span class="normal">local </span><span class="usertype">unsigned</span><span class="normal"> </span><span class="function">syncsearch</span><span class="symbol">(</span><span class="normal">have</span><span class="symbol">,</span><span class="normal"> buf</span><span class="symbol">,</span><span class="normal"> len</span><span class="symbol">)</span>
<span class="type">unsigned</span><span class="normal"> </span><span class="usertype">FAR</span><span class="normal"> </span><span class="symbol">*</span><span class="normal">have</span><span class="symbol">;</span>
<span class="type">unsigned</span><span class="normal"> </span><span class="type">char</span><span class="normal"> </span><span class="usertype">FAR</span><span class="normal"> </span><span class="symbol">*</span><span class="normal">buf</span><span class="symbol">;</span>
<span class="type">unsigned</span><span class="normal"> len</span><span class="symbol">;</span>
<span class="cbracket">{</span>
<span class="normal">    </span><span class="type">unsigned</span><span class="normal"> got</span><span class="symbol">;</span>
<span class="normal">    </span><span class="type">unsigned</span><span class="normal"> next</span><span class="symbol">;</span>

<span class="normal">    got </span><span class="symbol">=</span><span class="normal"> </span><span class="symbol">*</span><span class="normal">have</span><span class="symbol">;</span>
<span class="normal">    next </span><span class="symbol">=</span><span class="normal"> </span><span class="number">0</span><span class="symbol">;</span>
<span class="normal">    </span><span class="keyword">while</span><span class="normal"> </span><span class="symbol">(</span><span class="normal">next </span><span class="symbol">&lt;</span><span class="normal"> len </span><span class="symbol">&amp;&amp;</span><span class="normal"> got </span><span class="symbol">&lt;</span><span class="normal"> </span><span class="number">4</span><span class="symbol">)</span><span class="normal"> </span><span class="cbracket">{</span>
<span class="normal">        </span><span class="keyword">if</span><span class="normal"> </span><span class="symbol">((</span><span class="type">int</span><span class="symbol">)(</span><span class="normal">buf</span><span class="symbol">[</span><span class="normal">next</span><span class="symbol">])</span><span class="normal"> </span><span class="symbol">==</span><span class="normal"> </span><span class="symbol">(</span><span class="normal">got </span><span class="symbol">&lt;</span><span class="normal"> </span><span class="number">2</span><span class="normal"> </span><span class="symbol">?</span><span class="normal"> </span><span class="number">0</span><span class="normal"> </span><span class="symbol">:</span><span class="normal"> </span><span class="number">0xff</span><span class="symbol">))</span>
<span class="normal">            got</span><span class="symbol">++;</span>
<span class="normal">        </span><span class="keyword">else</span><span class="normal"> </span><span class="keyword">if</span><span class="normal"> </span><span class="symbol">(</span><span class="normal">buf</span><span class="symbol">[</span><span class="normal">next</span><span class="symbol">])</span>
<span class="normal">            got </span><span class="symbol">=</span><span class="normal"> </span><span class="number">0</span><span class="symbol">;</span>
<span class="normal">        </span><span class="keyword">else</span>
<span class="normal">            got </span><span class="symbol">=</span><span class="normal"> </span><span class="number">4</span><span class="normal"> </span><span class="symbol">-</span><span class="normal"> got</span><span class="symbol">;</span>
<span class="normal">        next</span><span class="symbol">++;</span>
<span class="normal">    </span><span class="cbracket">}</span>
<span class="normal">    </span><span class="symbol">*</span><span class="normal">have </span><span class="symbol">=</span><span class="normal"> got</span><span class="symbol">;</span>
<span class="normal">    </span><span class="keyword">return</span><span class="normal"> next</span><span class="symbol">;</span>
<span class="cbracket">}</span>

<span class="type">int</span><span class="normal"> </span><span class="usertype">ZEXPORT</span><span class="normal"> </span><span class="function">inflateSync</span><span class="symbol">(</span><span class="normal">strm</span><span class="symbol">)</span>
<span class="usertype">z_streamp</span><span class="normal"> strm</span><span class="symbol">;</span>
<span class="cbracket">{</span>
<span class="normal">    </span><span class="type">unsigned</span><span class="normal"> len</span><span class="symbol">;</span><span class="normal">               </span><span class="comment">/* number of bytes to look at or looked at */</span>
<span class="normal">    </span><span class="type">unsigned</span><span class="normal"> </span><span class="type">long</span><span class="normal"> in</span><span class="symbol">,</span><span class="normal"> out</span><span class="symbol">;</span><span class="normal">      </span><span class="comment">/* temporary to save total_in and total_out */</span>
<span class="normal">    </span><span class="type">unsigned</span><span class="normal"> </span><span class="type">char</span><span class="normal"> buf</span><span class="symbol">[</span><span class="number">4</span><span class="symbol">];</span><span class="normal">       </span><span class="comment">/* to restore bit buffer to byte string */</span>
<span class="normal">    </span><span class="keyword">struct</span><span class="normal"> </span><span class="classname">inflate_state</span><span class="normal"> </span><span class="usertype">FAR</span><span class="normal"> </span><span class="symbol">*</span><span class="normal">state</span><span class="symbol">;</span>

<span class="normal">    </span><span class="comment">/* check parameters */</span>
<span class="normal">    </span><span class="keyword">if</span><span class="normal"> </span><span class="symbol">(</span><span class="normal">strm </span><span class="symbol">==</span><span class="normal"> Z_NULL </span><span class="symbol">||</span><span class="normal"> strm</span><span class="symbol">-&gt;</span><span class="normal">state </span><span class="symbol">==</span><span class="normal"> Z_NULL</span><span class="symbol">)</span><span class="normal"> </span><span class="keyword">return</span><span class="normal"> Z_STREAM_ERROR</span><span class="symbol">;</span>
<span class="normal">    state </span><span class="symbol">=</span><span class="normal"> </span><span class="symbol">(</span><span class="keyword">struct</span><span class="normal"> </span><span class="classname">inflate_state</span><span class="normal"> FAR </span><span class="symbol">*)</span><span class="normal">strm</span><span class="symbol">-&gt;</span><span class="normal">state</span><span class="symbol">;</span>
<span class="normal">    </span><span class="keyword">if</span><span class="normal"> </span><span class="symbol">(</span><span class="normal">strm</span><span class="symbol">-&gt;</span><span class="normal">avail_in </span><span class="symbol">==</span><span class="normal"> </span><span class="number">0</span><span class="normal"> </span><span class="symbol">&amp;&amp;</span><span class="normal"> state</span><span class="symbol">-&gt;</span><span class="normal">bits </span><span class="symbol">&lt;</span><span class="normal"> </span><span class="number">8</span><span class="symbol">)</span><span class="normal"> </span><span class="keyword">return</span><span class="normal"> Z_BUF_ERROR</span><span class="symbol">;</span>

<span class="normal">    </span><span class="comment">/* if first time, start search in bit buffer */</span>
<span class="normal">    </span><span class="keyword">if</span><span class="normal"> </span><span class="symbol">(</span><span class="normal">state</span><span class="symbol">-&gt;</span><span class="normal">mode </span><span class="symbol">!=</span><span class="normal"> SYNC</span><span class="symbol">)</span><span class="normal"> </span><span class="cbracket">{</span>
<span class="normal">        state</span><span class="symbol">-&gt;</span><span class="normal">mode </span><span class="symbol">=</span><span class="normal"> SYNC</span><span class="symbol">;</span>
<span class="normal">        state</span><span class="symbol">-&gt;</span><span class="normal">hold </span><span class="symbol">&lt;&lt;=</span><span class="normal"> state</span><span class="symbol">-&gt;</span><span class="normal">bits </span><span class="symbol">&amp;</span><span class="normal"> </span><span class="number">7</span><span class="symbol">;</span>
<span class="normal">        state</span><span class="symbol">-&gt;</span><span class="normal">bits </span><span class="symbol">-=</span><span class="normal"> state</span><span class="symbol">-&gt;</span><span class="normal">bits </span><span class="symbol">&amp;</span><span class="normal"> </span><span class="number">7</span><span class="symbol">;</span>
<span class="normal">        len </span><span class="symbol">=</span><span class="normal"> </span><span class="number">0</span><span class="symbol">;</span>
<span class="normal">        </span><span class="keyword">while</span><span class="normal"> </span><span class="symbol">(</span><span class="normal">state</span><span class="symbol">-&gt;</span><span class="normal">bits </span><span class="symbol">&gt;=</span><span class="normal"> </span><span class="number">8</span><span class="symbol">)</span><span class="normal"> </span><span class="cbracket">{</span>
<span class="normal">            buf</span><span class="symbol">[</span><span class="normal">len</span><span class="symbol">++]</span><span class="normal"> </span><span class="symbol">=</span><span class="normal"> </span><span class="symbol">(</span><span class="type">unsigned</span><span class="normal"> </span><span class="type">char</span><span class="symbol">)(</span><span class="normal">state</span><span class="symbol">-&gt;</span><span class="normal">hold</span><span class="symbol">);</span>
<span class="normal">            state</span><span class="symbol">-&gt;</span><span class="normal">hold </span><span class="symbol">&gt;&gt;=</span><span class="normal"> </span><span class="number">8</span><span class="symbol">;</span>
<span class="normal">            state</span><span class="symbol">-&gt;</span><span class="normal">bits </span><span class="symbol">-=</span><span class="normal"> </span><span class="number">8</span><span class="symbol">;</span>
<span class="normal">        </span><span class="cbracket">}</span>
<span class="normal">        state</span><span class="symbol">-&gt;</span><span class="normal">have </span><span class="symbol">=</span><span class="normal"> </span><span class="number">0</span><span class="symbol">;</span>
<span class="normal">        </span><span class="function">syncsearch</span><span class="symbol">(&amp;(</span><span class="normal">state</span><span class="symbol">-&gt;</span><span class="normal">have</span><span class="symbol">),</span><span class="normal"> buf</span><span class="symbol">,</span><span class="normal"> len</span><span class="symbol">);</span>
<span class="normal">    </span><span class="cbracket">}</span>

<span class="normal">    </span><span class="comment">/* search available input */</span>
<span class="normal">    len </span><span class="symbol">=</span><span class="normal"> </span><span class="function">syncsearch</span><span class="symbol">(&amp;(</span><span class="normal">state</span><span class="symbol">-&gt;</span><span class="normal">have</span><span class="symbol">),</span><span class="normal"> strm</span><span class="symbol">-&gt;</span><span class="normal">next_in</span><span class="symbol">,</span><span class="normal"> strm</span><span class="symbol">-&gt;</span><span class="normal">avail_in</span><span class="symbol">);</span>
<span class="normal">    strm</span><span class="symbol">-&gt;</span><span class="normal">avail_in </span><span class="symbol">-=</span><span class="normal"> len</span><span class="symbol">;</span>
<span class="normal">    strm</span><span class="symbol">-&gt;</span><span class="normal">next_in </span><span class="symbol">+=</span><span class="normal"> len</span><span class="symbol">;</span>
<span class="normal">    strm</span><span class="symbol">-&gt;</span><span class="normal">total_in </span><span class="symbol">+=</span><span class="normal"> len</span><span class="symbol">;</span>

<span class="normal">    </span><span class="comment">/* return no joy or set up to restart inflate() on a new block */</span>
<span class="normal">    </span><span class="keyword">if</span><span class="normal"> </span><span class="symbol">(</span><span class="normal">state</span><span class="symbol">-&gt;</span><span class="normal">have </span><span class="symbol">!=</span><span class="normal"> </span><span class="number">4</span><span class="symbol">)</span><span class="normal"> </span><span class="keyword">return</span><span class="normal"> Z_DATA_ERROR</span><span class="symbol">;</span>
<span class="normal">    in </span><span class="symbol">=</span><span class="normal"> strm</span><span class="symbol">-&gt;</span><span class="normal">total_in</span><span class="symbol">;</span><span class="normal">  out </span><span class="symbol">=</span><span class="normal"> strm</span><span class="symbol">-&gt;</span><span class="normal">total_out</span><span class="symbol">;</span>
<span class="normal">    </span><span class="function">inflateReset</span><span class="symbol">(</span><span class="normal">strm</span><span class="symbol">);</span>
<span class="normal">    strm</span><span class="symbol">-&gt;</span><span class="normal">total_in </span><span class="symbol">=</span><span class="normal"> in</span><span class="symbol">;</span><span class="normal">  strm</span><span class="symbol">-&gt;</span><span class="normal">total_out </span><span class="symbol">=</span><span class="normal"> out</span><span class="symbol">;</span>
<span class="normal">    state</span><span class="symbol">-&gt;</span><span class="normal">mode </span><span class="symbol">=</span><span class="normal"> TYPE</span><span class="symbol">;</span>
<span class="normal">    </span><span class="keyword">return</span><span class="normal"> Z_OK</span><span class="symbol">;</span>
<span class="cbracket">}</span>

<span class="comment">/*</span>
<span class="comment">   Returns true if inflate is currently at the end of a block generated by</span>
<span class="comment">   Z_SYNC_FLUSH or Z_FULL_FLUSH. This function is used by one PPP</span>
<span class="comment">   implementation to provide an additional safety check. PPP uses</span>
<span class="comment">   Z_SYNC_FLUSH but removes the length bytes of the resulting empty stored</span>
<span class="comment">   block. When decompressing, PPP checks that at the end of input packet,</span>
<span class="comment">   inflate is waiting for these length bytes.</span>
<span class="comment"> */</span>
<span class="type">int</span><span class="normal"> </span><span class="usertype">ZEXPORT</span><span class="normal"> </span><span class="function">inflateSyncPoint</span><span class="symbol">(</span><span class="normal">strm</span><span class="symbol">)</span>
<span class="usertype">z_streamp</span><span class="normal"> strm</span><span class="symbol">;</span>
<span class="cbracket">{</span>
<span class="normal">    </span><span class="keyword">struct</span><span class="normal"> </span><span class="classname">inflate_state</span><span class="normal"> </span><span class="usertype">FAR</span><span class="normal"> </span><span class="symbol">*</span><span class="normal">state</span><span class="symbol">;</span>

<span class="normal">    </span><span class="keyword">if</span><span class="normal"> </span><span class="symbol">(</span><span class="normal">strm </span><span class="symbol">==</span><span class="normal"> Z_NULL </span><span class="symbol">||</span><span class="normal"> strm</span><span class="symbol">-&gt;</span><span class="normal">state </span><span class="symbol">==</span><span class="normal"> Z_NULL</span><span class="symbol">)</span><span class="normal"> </span><span class="keyword">return</span><span class="normal"> Z_STREAM_ERROR</span><span class="symbol">;</span>
<span class="normal">    state </span><span class="symbol">=</span><span class="normal"> </span><span class="symbol">(</span><span class="keyword">struct</span><span class="normal"> </span><span class="classname">inflate_state</span><span class="normal"> FAR </span><span class="symbol">*)</span><span class="normal">strm</span><span class="symbol">-&gt;</span><span class="normal">state</span><span class="symbol">;</span>
<span class="normal">    </span><span class="keyword">return</span><span class="normal"> state</span><span class="symbol">-&gt;</span><span class="normal">mode </span><span class="symbol">==</span><span class="normal"> STORED </span><span class="symbol">&amp;&amp;</span><span class="normal"> state</span><span class="symbol">-&gt;</span><span class="normal">bits </span><span class="symbol">==</span><span class="normal"> </span><span class="number">0</span><span class="symbol">;</span>
<span class="cbracket">}</span>

<span class="type">int</span><span class="normal"> </span><span class="usertype">ZEXPORT</span><span class="normal"> </span><span class="function">inflateCopy</span><span class="symbol">(</span><span class="normal">dest</span><span class="symbol">,</span><span class="normal"> source</span><span class="symbol">)</span>
<span class="usertype">z_streamp</span><span class="normal"> dest</span><span class="symbol">;</span>
<span class="usertype">z_streamp</span><span class="normal"> source</span><span class="symbol">;</span>
<span class="cbracket">{</span>
<span class="normal">    </span><span class="keyword">struct</span><span class="normal"> </span><span class="classname">inflate_state</span><span class="normal"> </span><span class="usertype">FAR</span><span class="normal"> </span><span class="symbol">*</span><span class="normal">state</span><span class="symbol">;</span>
<span class="normal">    </span><span class="keyword">struct</span><span class="normal"> </span><span class="classname">inflate_state</span><span class="normal"> </span><span class="usertype">FAR</span><span class="normal"> </span><span class="symbol">*</span><span class="normal">copy</span><span class="symbol">;</span>
<span class="normal">    </span><span class="type">unsigned</span><span class="normal"> </span><span class="type">char</span><span class="normal"> </span><span class="usertype">FAR</span><span class="normal"> </span><span class="symbol">*</span><span class="normal">window</span><span class="symbol">;</span>
<span class="normal">    </span><span class="type">unsigned</span><span class="normal"> wsize</span><span class="symbol">;</span>

<span class="normal">    </span><span class="comment">/* check input */</span>
<span class="normal">    </span><span class="keyword">if</span><span class="normal"> </span><span class="symbol">(</span><span class="normal">dest </span><span class="symbol">==</span><span class="normal"> Z_NULL </span><span class="symbol">||</span><span class="normal"> source </span><span class="symbol">==</span><span class="normal"> Z_NULL </span><span class="symbol">||</span><span class="normal"> source</span><span class="symbol">-&gt;</span><span class="normal">state </span><span class="symbol">==</span><span class="normal"> Z_NULL </span><span class="symbol">||</span>
<span class="normal">        source</span><span class="symbol">-&gt;</span><span class="normal">zalloc </span><span class="symbol">==</span><span class="normal"> </span><span class="symbol">(</span><span class="normal">alloc_func</span><span class="symbol">)</span><span class="number">0</span><span class="normal"> </span><span class="symbol">||</span><span class="normal"> source</span><span class="symbol">-&gt;</span><span class="normal">zfree </span><span class="symbol">==</span><span class="normal"> </span><span class="symbol">(</span><span class="normal">free_func</span><span class="symbol">)</span><span class="number">0</span><span class="symbol">)</span>
<span class="normal">        </span><span class="keyword">return</span><span class="normal"> Z_STREAM_ERROR</span><span class="symbol">;</span>
<span class="normal">    state </span><span class="symbol">=</span><span class="normal"> </span><span class="symbol">(</span><span class="keyword">struct</span><span class="normal"> </span><span class="classname">inflate_state</span><span class="normal"> FAR </span><span class="symbol">*)</span><span class="normal">source</span><span class="symbol">-&gt;</span><span class="normal">state</span><span class="symbol">;</span>

<span class="normal">    </span><span class="comment">/* allocate space */</span>
<span class="normal">    copy </span><span class="symbol">=</span><span class="normal"> </span><span class="symbol">(</span><span class="keyword">struct</span><span class="normal"> </span><span class="classname">inflate_state</span><span class="normal"> FAR </span><span class="symbol">*)</span>
<span class="normal">           </span><span class="function">ZALLOC</span><span class="symbol">(</span><span class="normal">source</span><span class="symbol">,</span><span class="normal"> </span><span class="number">1</span><span class="symbol">,</span><span class="normal"> </span><span class="keyword">sizeof</span><span class="symbol">(</span><span class="keyword">struct</span><span class="normal"> </span><span class="classname">inflate_state</span><span class="symbol">));</span>
<span class="normal">    </span><span class="keyword">if</span><span class="normal"> </span><span class="symbol">(</span><span class="normal">copy </span><span class="symbol">==</span><span class="normal"> Z_NULL</span><span class="symbol">)</span><span class="normal"> </span><span class="keyword">return</span><span class="normal"> Z_MEM_ERROR</span><span class="symbol">;</span>
<span class="normal">    window </span><span class="symbol">=</span><span class="normal"> Z_NULL</span><span class="symbol">;</span>
<span class="normal">    </span><span class="keyword">if</span><span class="normal"> </span><span class="symbol">(</span><span class="normal">state</span><span class="symbol">-&gt;</span><span class="normal">window </span><span class="symbol">!=</span><span class="normal"> Z_NULL</span><span class="symbol">)</span><span class="normal"> </span><span class="cbracket">{</span>
<span class="normal">        window </span><span class="symbol">=</span><span class="normal"> </span><span class="symbol">(</span><span class="type">unsigned</span><span class="normal"> </span><span class="type">char</span><span class="normal"> FAR </span><span class="symbol">*)</span>
<span class="normal">                 </span><span class="function">ZALLOC</span><span class="symbol">(</span><span class="normal">source</span><span class="symbol">,</span><span class="normal"> 1U </span><span class="symbol">&lt;&lt;</span><span class="normal"> state</span><span class="symbol">-&gt;</span><span class="normal">wbits</span><span class="symbol">,</span><span class="normal"> </span><span class="keyword">sizeof</span><span class="symbol">(</span><span class="type">unsigned</span><span class="normal"> </span><span class="type">char</span><span class="symbol">));</span>
<span class="normal">        </span><span class="keyword">if</span><span class="normal"> </span><span class="symbol">(</span><span class="normal">window </span><span class="symbol">==</span><span class="normal"> Z_NULL</span><span class="symbol">)</span><span class="normal"> </span><span class="cbracket">{</span>
<span class="normal">            </span><span class="function">ZFREE</span><span class="symbol">(</span><span class="normal">source</span><span class="symbol">,</span><span class="normal"> copy</span><span class="symbol">);</span>
<span class="normal">            </span><span class="keyword">return</span><span class="normal"> Z_MEM_ERROR</span><span class="symbol">;</span>
<span class="normal">        </span><span class="cbracket">}</span>
<span class="normal">    </span><span class="cbracket">}</span>

<span class="normal">    </span><span class="comment">/* copy state */</span>
<span class="normal">    </span><span class="function">zmemcpy</span><span class="symbol">(</span><span class="normal">dest</span><span class="symbol">,</span><span class="normal"> source</span><span class="symbol">,</span><span class="normal"> </span><span class="keyword">sizeof</span><span class="symbol">(</span><span class="normal">z_stream</span><span class="symbol">));</span>
<span class="normal">    </span><span class="function">zmemcpy</span><span class="symbol">(</span><span class="normal">copy</span><span class="symbol">,</span><span class="normal"> state</span><span class="symbol">,</span><span class="normal"> </span><span class="keyword">sizeof</span><span class="symbol">(</span><span class="keyword">struct</span><span class="normal"> </span><span class="classname">inflate_state</span><span class="symbol">));</span>
<span class="normal">    </span><span class="keyword">if</span><span class="normal"> </span><span class="symbol">(</span><span class="normal">state</span><span class="symbol">-&gt;</span><span class="normal">lencode </span><span class="symbol">&gt;=</span><span class="normal"> state</span><span class="symbol">-&gt;</span><span class="normal">codes </span><span class="symbol">&amp;&amp;</span>
<span class="normal">        state</span><span class="symbol">-&gt;</span><span class="normal">lencode </span><span class="symbol">&lt;=</span><span class="normal"> state</span><span class="symbol">-&gt;</span><span class="normal">codes </span><span class="symbol">+</span><span class="normal"> ENOUGH </span><span class="symbol">-</span><span class="normal"> </span><span class="number">1</span><span class="symbol">)</span><span class="normal"> </span><span class="cbracket">{</span>
<span class="normal">        copy</span><span class="symbol">-&gt;</span><span class="normal">lencode </span><span class="symbol">=</span><span class="normal"> copy</span><span class="symbol">-&gt;</span><span class="normal">codes </span><span class="symbol">+</span><span class="normal"> </span><span class="symbol">(</span><span class="normal">state</span><span class="symbol">-&gt;</span><span class="normal">lencode </span><span class="symbol">-</span><span class="normal"> state</span><span class="symbol">-&gt;</span><span class="normal">codes</span><span class="symbol">);</span>
<span class="normal">        copy</span><span class="symbol">-&gt;</span><span class="normal">distcode </span><span class="symbol">=</span><span class="normal"> copy</span><span class="symbol">-&gt;</span><span class="normal">codes </span><span class="symbol">+</span><span class="normal"> </span><span class="symbol">(</span><span class="normal">state</span><span class="symbol">-&gt;</span><span class="normal">distcode </span><span class="symbol">-</span><span class="normal"> state</span><span class="symbol">-&gt;</span><span class="normal">codes</span><span class="symbol">);</span>
<span class="normal">    </span><span class="cbracket">}</span>
<span class="normal">    copy</span><span class="symbol">-&gt;</span><span class="normal">next </span><span class="symbol">=</span><span class="normal"> copy</span><span class="symbol">-&gt;</span><span class="normal">codes </span><span class="symbol">+</span><span class="normal"> </span><span class="symbol">(</span><span class="normal">state</span><span class="symbol">-&gt;</span><span class="normal">next </span><span class="symbol">-</span><span class="normal"> state</span><span class="symbol">-&gt;</span><span class="normal">codes</span><span class="symbol">);</span>
<span class="normal">    </span><span class="keyword">if</span><span class="normal"> </span><span class="symbol">(</span><span class="normal">window </span><span class="symbol">!=</span><span class="normal"> Z_NULL</span><span class="symbol">)</span><span class="normal"> </span><span class="cbracket">{</span>
<span class="normal">        wsize </span><span class="symbol">=</span><span class="normal"> 1U </span><span class="symbol">&lt;&lt;</span><span class="normal"> state</span><span class="symbol">-&gt;</span><span class="normal">wbits</span><span class="symbol">;</span>
<span class="normal">        </span><span class="function">zmemcpy</span><span class="symbol">(</span><span class="normal">window</span><span class="symbol">,</span><span class="normal"> state</span><span class="symbol">-&gt;</span><span class="normal">window</span><span class="symbol">,</span><span class="normal"> wsize</span><span class="symbol">);</span>
<span class="normal">    </span><span class="cbracket">}</span>
<span class="normal">    copy</span><span class="symbol">-&gt;</span><span class="normal">window </span><span class="symbol">=</span><span class="normal"> window</span><span class="symbol">;</span>
<span class="normal">    dest</span><span class="symbol">-&gt;</span><span class="normal">state </span><span class="symbol">=</span><span class="normal"> </span><span class="symbol">(</span><span class="keyword">struct</span><span class="normal"> </span><span class="classname">internal_state</span><span class="normal"> FAR </span><span class="symbol">*)</span><span class="normal">copy</span><span class="symbol">;</span>
<span class="normal">    </span><span class="keyword">return</span><span class="normal"> Z_OK</span><span class="symbol">;</span>
<span class="cbracket">}</span>
</tt></pre></div><div style="text-align: right; padding: 8pt; font-size: 13px"><a href="/xmlfeed/weblog-rss20.xml"><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAFAAAAAPAgMAAAAOp6AcAAAADFBMVEVmZmb/ZgD///+JjnlbTUWmAAAACXBIWXMAAABIAAAASABGyWs+AAAACXZwQWcAAABQAAAADwCexKkxAAAAWUlEQVQYlWNgwAa0VmGAFQyqoSCQ/x8J/CBFMCt0ZdTU/F/7/+1HEkydFpoKVPn+93sUlUujQvP/7UcRTAuNDJ2a//s/imDqtKVZofm/1qGYSZk7sfodGwAAiobBJtffoNAAAAAASUVORK5CYII=" alt="RSS 2.0 Weblog Feed" width="80" height="15"/></a> <a href="/xmlfeed/weblog-atom10.xml"><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAFAAAAAPAgMAAAAOp6AcAAAADFBMVEVmZmb/ZgD///+JjnlbTUWmAAAAaklEQVQYlWNgwAa0VmGAFQyqoSCQ/x8J/CBFMDV16rTQ/H/7V//69+//v/3/9oMEI6cuAwr+fv/+/b5d///v//0eJBgWOhMo+Gs9UPAdXDBy6lSYyn9wQZCZS0GCYDPXQcykzJ1Y/Y4NAABKvL80wyoMPgAAAABJRU5ErkJggg==" alt="Atom 1.0 Weblog Feed" width="80" height="15"/></a> <a href="http://validator.w3.org/check?uri=referer"><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAFAAAAAPCAMAAABEF7i9AAAB1FBMVEUHQIgIRY0MN4QNRYoSRYsXUpIYVJQeUpUhWpgjUJMjWpgmU5QnXJkuYZ0uYpwwV5YyZJ4zaKM3ZaA5aaI6aqM6a6E8ZqA8Z6BAbaRBbqdCbaVHd61KSkpKcaZQUFBUf69UgbBVVVVXfq9Yg7NZhbJZh7RagrNeXVxeh7RfjLdgYGBiiLZmZmZnZ2doirhpkbt0m8F3m8B3ncJ5lb55ocR+ocSDgX+Do8eEpMqGhoaHp8iIpMeJjnmJpseKqMeOqsqPsdCQrcyVlZWVsM2Zs9CZtNCfu9ahoaGhuNShudSivNSjtMWjvNSmpqWnpqSrw9qvxNqyxdmyxdyzsK6zs7Ozx9y0xt21yN22tra4y+K80eK/v7/AwMDExMTEy9DH2ejK2+jM2ujN3uvP0dLR0NDR3uvS3uvS3+zU4u3V1dXY2dnY4u7Y4+3b5e/d3d3d5u/d5/De3t7f39/h4uLj4uHj6/Ll7PXm7fTn7/Xo7/Tp7/bq7Ozr6unr8ffw8PDw9vvx9fny+P7z8/Pz9vnz9vv3+fv4+vz5+vz6+vr6+/36/P36///7+/77/Pz7/f37/f78/Pz8/f38/f79/f39/f79/f/9/v79///+/v7+/v////3///+tYR2LAAABKklEQVQ4y2PQoTJg0JlNVYDPQBsyAMTAqaFes8tdsmdPCtA3MDStr3GKKK6myMAprgJ9pcpWs/MlRExYJBvNZLR0sigycHYOV1S7mtjsQJ4gf+HIFPXoWMs6qIGzIRiKZs9GFoEaMRuZhhrYqqJXy8uZYauRxC/VHew7e3YTPAxnI5swG6JxNrKBNjB1EFmIgV0+HA6C8pqqzhXG7BbJJROQIwViMYQ7G2oDQQNn57JyG7kxiCfObrBmS5+BHMuYLkTzMnYDm5WY4lOZZRPKZocxes+aPbuwCFsYohiICLvZsKBAMrDTQ7K/StveU8icTzrOL8JdLpOyWJ49u8Bx9ozw8DY7UYW03hhdxZAOSg2c3jN79rSJs1vSKmfOnpFXNJmynELlvExlAADnaZpLFGEC2wAAAABJRU5ErkJggg==" alt="Valid XHTML 1.1" width="80" height="15"/></a> <a href="http://jigsaw.w3.org/css-validator/check/referer"><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAFAAAAAPCAMAAABEF7i9AAAB1FBMVEUHQIgIRY0MN4QNRYoSRYsXUpIYVJQeUpUhWpgjUJMjWpgmU5QnXJkuYZ0uYpwwV5YyZJ4zaKM3ZaA5aaI6aqM6a6E8ZqA8Z6BAbaRBbqdCbaVHd61KSkpKcaZQUFBUf69UgbBVVVVXfq9Yg7NZhbJZh7RagrNeXVxeh7RfjLdgYGBiiLZmZmZnZ2doirhpkbt0m8F3m8B3ncJ5lb55ocR+ocSDgX+Do8eEpMqGhoaHp8iIpMeJjnmJpseKqMeOqsqPsdCQrcyVlZWVsM2Zs9CZtNCfu9ahoaGhuNShudSivNSjtMWjvNSmpqWnpqSrw9qvxNqyxdmyxdyzsK6zs7Ozx9y0xt21yN22tra4y+K80eK/v7/AwMDExMTEy9DH2ejK2+jM2ujN3uvP0dLR0NDR3uvS3uvS3+zU4u3V1dXY2dnY4u7Y4+3b5e/d3d3d5u/d5/De3t7f39/h4uLj4uHj6/Ll7PXm7fTn7/Xo7/Tp7/bq7Ozr6unr8ffw8PDw9vvx9fny+P7z8/Pz9vnz9vv3+fv4+vz5+vz6+vr6+/36/P36///7+/77/Pz7/f37/f78/Pz8/f38/f79/f39/f79/f/9/v79///+/v7+/v////3///+tYR2LAAABEUlEQVQ4y2PQoTJg0JlNVYDPQBsyAMTAqaFes8tdsmdPCtA3MDStr3GKKK6myMAprgJ9pcpWs/MlRExYJBvNZLR0sigycHYOV1S7mtjsQJ4gf+HIFPXoWMs6mIEQCsIjwhKoga0qerW8nBm2Gkn8Ut3BvrNnN8HCcDYM2cBIogzs8uFwEJTXVHWuMGa3SC6ZgIgUqCEwdxJr4OxcVm4jNwbxxNkN1mzpM2ajGIjsPGK9PLtZiSk+lVk2oWx2GKP3rNmzC4tQwpDoIIQb2Okh2V+lbe8pZM4nHecX4S6XSVksz55d4Dh7Rnh4m52oQlpvjK5iSAelBk7vmT172sTZLWmVM2fPyCuaTFlOoXJepjIAANlljDGY/l5pAAAAAElFTkSuQmCC" alt="Valid CSS (2.1)" width="80" height="15"/></a><br/>Copyright 2005-2019 <a href="/about/">Timo Bingmann</a> - <a href="/about/impressum.html">Impressum</a></div></body></html>