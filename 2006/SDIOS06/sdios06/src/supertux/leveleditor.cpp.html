<?xml version="1.0" encoding="iso-8859-1"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta content="text/html; charset=iso-8859-1" http-equiv="content-type" /><meta name="viewport" content="initial-scale=1"><title>/2006/SDIOS06/sdios06/src/supertux/leveleditor.cpp - panthema.net</title><link rel="stylesheet" type="text/css" href="/css/base.css" /><link rel="stylesheet" type="text/css" href="/css/fonts.css" /><link rel="alternate" type="application/rss+xml" title="panthema.net Weblog Feed RSS 2.0" href="http://panthema.net/xmlfeed/weblog-rss20.xml" /><link rel="alternate" type="application/atom+xml" title="panthema.net Weblog Feed Atom 1.0" href="http://panthema.net/xmlfeed/weblog-atom10.xml" /><script type="text/javascript" src="/js/base.js"></script><script type="text/javascript">/* <!-- */makeIEHover = function() {var lis = document.getElementById('ptnav').getElementsByTagName('li');for (var i = 0; i < lis.length; i++) {lis[i].onmouseover = function() {this.className += ' sfhover';};lis[i].onmouseout = function() {this.className = this.className.replace(new RegExp(' sfhover\b'), '');};}};if (window.attachEvent) window.attachEvent('onload', makeIEHover);/* --> */</script></head><body style="background-image: url(/img/bgfractal6.jpg)" lang="en"><div class="pttopbar"><div style="float: right"><ul id="ptnav"><li class="top"><a class="ni" href="/"><i class="icon-book"></i> Weblog</a><ul style="margin-left: -6px; margin-top: 4px" class="nx"><li><a href="/2020/">2020</a></li><li><a href="/2019/">2019</a></li><li><a href="/2018/">2018</a></li><li><a href="/2017/">2017</a></li><li><a href="/2016/">2016</a></li><li><a href="/2015/">2015</a></li><li><a href="/2014/">2014</a></li><li><a href="/2013/">2013</a></li><li><a href="/2012/">2012</a></li><li><a href="/2011/">2011</a></li><li><a href="/2010/">2010</a></li><li><a href="/2009/">2009</a></li><li><a href="/2008/">2008</a></li><li><a href="/2007/">2007</a></li><li><a href="/2006/">2006</a></li><li class="nt"><a href="/2005/">2005</a></li><li class="ns"><a href="/xmlfeed/weblog-rss20.xml">RSS Feed</a></li><li class="nt"><a href="/xmlfeed/weblog-atom10.xml">XML Atom</a></li><li class="ns"><a href="/search.html">Search</a></li></ul></li><li class="top"><a class="ni" href="/tags/"><i class="icon-tags"></i> Tags</a><div style="width: 14em; margin-left: -9em; margin-top: 4px"><a style="font-size: 10pt" href="/tags/algebra.html">algebra</a> <a style="font-size: 10pt" href="/tags/blinken-algorithms.html">blinken-algorithms</a> <a style="font-size: 16pt" href="/tags/c++.html">c++</a> <a style="font-size: 12pt" href="/tags/code-example.html">code-example</a> <a style="font-size: 14pt" href="/tags/code-snippet.html">code-snippet</a> <a style="font-size: 11pt" href="/tags/coding_tricks.html">coding tricks</a> <a style="font-size: 10pt" href="/tags/compsci.html">compsci</a> <a style="font-size: 10pt" href="/tags/compsci_study_thesis.html">compsci study thesis</a> <a style="font-size: 9pt" href="/tags/crypto-speedtest.html">crypto-speedtest</a> <a style="font-size: 10pt" href="/tags/cryptography.html">cryptography</a> <a style="font-size: 9pt" href="/tags/cryptote.html">cryptote</a> <a style="font-size: 11pt" href="/tags/dissertation.html">dissertation</a> <a style="font-size: 10pt" href="/tags/electronics.html">electronics</a> <a style="font-size: 12pt" href="/tags/flex-bison-cpp-example.html">flex-bison-cpp-example</a> <a style="font-size: 16pt" href="/tags/frontpage.html">frontpage</a> <a style="font-size: 15pt" href="/tags/fun.html">fun</a> <a style="font-size: 10pt" href="/tags/graphviz.html">graphviz</a> <a style="font-size: 9pt" href="http://www.hmtg.de">hartmetall</a> <a style="font-size: 9pt" href="/tags/helppc.html">helppc</a> <a style="font-size: 9pt" href="/tags/hifi_selbstbau.html">hifi selbstbau</a> <a style="font-size: 10pt" href="/tags/latex.html">latex</a> <a style="font-size: 10pt" href="/tags/LEDs.html">LEDs</a> <a style="font-size: 10pt" href="/tags/librivox.html">librivox</a> <a style="font-size: 10pt" href="/tags/linux.html">linux</a> <a style="font-size: 9pt" href="/tags/market.html">market</a> <a style="font-size: 9pt" href="/tags/massive-sorting.html">massive-sorting</a> <a style="font-size: 11pt" href="/tags/maths.html">maths</a> <a style="font-size: 9pt" href="/tags/music.html">music</a> <a style="font-size: 10pt" href="/tags/netfundamentals.html">netfundamentals</a> <a style="font-size: 11pt" href="/tags/ns-3.html">ns-3</a> <a style="font-size: 10pt" href="/tags/parallel-string-sorting.html">parallel-string-sorting</a> <a style="font-size: 14pt" href="/tags/parsing.html">parsing</a> <a style="font-size: 9pt" href="/tags/qtsqlview.html">qtsqlview</a> <a style="font-size: 14pt" href="/tags/research.html">research</a> <a style="font-size: 11pt" href="/tags/sdios06.html">sdios06</a> <a style="font-size: 9pt" href="/tags/sdlfractal.html">sdlfractal</a> <a style="font-size: 16pt" href="/tags/sorting.html">sorting</a> <a style="font-size: 13pt" href="/tags/sound_of_sorting.html">sound of sorting</a> <a style="font-size: 10pt" href="/tags/stringology.html">stringology</a> <a style="font-size: 16pt" href="/tags/stx-btree.html">stx-btree</a> <a style="font-size: 16pt" href="/tags/stxxl.html">stxxl</a> <a style="font-size: 16pt" href="/tags/talk.html">talk</a> <a style="font-size: 15pt" href="/tags/thrill.html">thrill</a> <a style="font-size: 10pt" href="/tags/tutorium.html">tutorium</a> <a style="font-size: 16pt" href="/tags/university.html">university</a> <a style="font-size: 14pt" href="/tags/utilities.html">utilities</a> <a style="font-size: 10pt" href="/tags/vncrec.html">vncrec</a> <a style="font-size: 9pt" href="/tags/webdesign.html">webdesign</a> </div></li><li class="top"> <a class="ni" href="#"><i class="icon-cubes"></i> Projects</a> <ul style="margin-left: -8em; margin-top: 4px;" class="nx"> <li><a href="/2019/1008-COBS-A-Compact-Bit-Sliced-Signature-Index/">COBS</a></li> <li><a href="/2009/cryptote/">CryptoTE</a></li> <li><a href="/2009/digup/">digup</a></li> <li><a href="/2013/disk-filltest/">disk-filltest</a></li> <li><a href="/2012/1119-eSAIS-Inducing-Suffix-and-LCP-Arrays-in-External-Memory/">eSAIS-LCP</a></li> <li><a href="/2007/flex-bison-cpp-example/">Flex Bison C++ Example</a></li> <li><a href="/2013/malloc_count/">malloc_count</a></li> <li><a href="/2016/0114-diploma-thesis/">On Bispanning Graphs</a></li> <li><a href="/2013/pmbw/">Parallel Memory Bandwidth</a></li> <li><a href="/2013/parallel-string-sorting/">Parallel String Sorting</a></li> <li><a href="/2014/sqlplot-tools/">SqlPlotTools</a></li> <li><a href="/2013/sound-of-sorting/">The Sound of Sorting</a></li> <li><a href="/2007/stx-btree/">STX B+ Tree</a></li> <li><a href="/2010/stx-cbtreedb/">STX Constant BTreeDB</a></li> <li><a href="/2010/stx-execpipe/">STX ExecPipe</a></li> <li><a href="/2007/stx-exparser/">STX Expression Parser</a></li> <li><a href="/tags/stxxl.html">STXXL 1.4</a></li> <li><a href="/tags/thrill.html">Thrill - Big Data Framework</a></li> <li class="nt"><a href="/2014/vncrec-rgb/">VNCrec RGB 0.4</a></li> <li class="ns"><a href="/search.html">Search</a></li> </ul></li><li class="top"> <a class="ni" href="/publications.html"><i class="icon-graduation-cap"></i> Publications</a></li><li class="top"> <a class="ni" href="/about/"><i class="icon-info-circled"></i> About</a> <ul style="margin-left: -6em; margin-top: 4px" class="nx"> <li><a href="/about/">Timo Bingmann</a></li> <li><a href="/about/impressum.html">Impressum</a></li> </ul></li><li class="top"> <a class="ni" href="/subscribe.html"><i class="icon-rss-squared"></i> Subscribe</a></li></ul></div><div style="padding: 6px"><a href="/">panthema</a>  / <a href="/2006/">2006</a> / <a href="/2006/SDIOS06/">SDIOS06</a> / <a href="/2006/SDIOS06/sdios06/">sdios06</a> / <a href="/2006/SDIOS06/sdios06/src/">src</a> / <a href="/2006/SDIOS06/sdios06/src/supertux/">supertux</a> / <a href="/2006/SDIOS06/sdios06/src/supertux/leveleditor.cpp.html">leveleditor.cpp</a> (<a href="/2006/SDIOS06/sdios06/src/supertux/leveleditor.cpp">Download File</a>)</div></div><div class="ptfullwidth"><pre class="codesnippet" style="font-family: monospace"><tt><span class="comment">//  $Id: leveleditor.cpp 2631 2005-06-21 21:52:22Z wansti $</span>
<span class="comment">//</span>
<span class="comment">//  SuperTux</span>
<span class="comment">//  Copyright (C) 2003 Ricardo Cruz &lt;rick2@aeiou.pt&gt;</span>
<span class="comment">//  Copyright (C) 2003 Tobias Glaesser &lt;tobi.web@gmx.de&gt;</span>
<span class="comment">//</span>
<span class="comment">//  This program is free software; you can redistribute it and/or</span>
<span class="comment">//  modify it under the terms of the GNU General Public License</span>
<span class="comment">//  as published by the Free Software Foundation; either version 2</span>
<span class="comment">//  of the License, or (at your option) any later version.</span>
<span class="comment">//</span>
<span class="comment">//  This program is distributed in the hope that it will be useful,</span>
<span class="comment">//  but WITHOUT ANY WARRANTY; without even the implied warranty of</span>
<span class="comment">//  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the</span>
<span class="comment">//  GNU General Public License for more details.</span>
<span class="comment">//</span>
<span class="comment">//  You should have received a copy of the GNU General Public License</span>
<span class="comment">//  along with this program; if not, write to the Free Software</span>
<span class="comment">//  Foundation, Inc., 59 Temple Place - Suite 330, Boston, MA  02111-1307, USA.</span>

<span class="preproc">#ifndef</span><span class="normal"> NO_EDITOR</span>

<span class="preproc">#include</span><span class="normal"> </span><span class="string">&lt;map&gt;</span>
<span class="preproc">#include</span><span class="normal"> </span><span class="string">&lt;stdio.h&gt;</span>
<span class="preproc">#include</span><span class="normal"> </span><span class="string">&lt;stdlib.h&gt;</span>
<span class="preproc">#include</span><span class="normal"> </span><span class="string">&lt;string.h&gt;</span>
<span class="preproc">#include</span><span class="normal"> </span><span class="string">&lt;math.h&gt;</span>
<span class="preproc">#include</span><span class="normal"> </span><span class="string">&lt;errno.h&gt;</span>
<span class="preproc">#include</span><span class="normal"> </span><span class="string">&lt;SDL.h&gt;</span>
<span class="preproc">#include</span><span class="normal"> </span><span class="string">&lt;SDL_image.h&gt;</span>
<span class="preproc">#include</span><span class="normal"> </span><span class="string">"leveleditor.h"</span>

<span class="preproc">#include</span><span class="normal"> </span><span class="string">"screen.h"</span>
<span class="preproc">#include</span><span class="normal"> </span><span class="string">"defines.h"</span>
<span class="preproc">#include</span><span class="normal"> </span><span class="string">"globals.h"</span>
<span class="preproc">#include</span><span class="normal"> </span><span class="string">"setup.h"</span>
<span class="preproc">#include</span><span class="normal"> </span><span class="string">"menu.h"</span>
<span class="preproc">#include</span><span class="normal"> </span><span class="string">"level.h"</span>
<span class="preproc">#include</span><span class="normal"> </span><span class="string">"gameloop.h"</span>
<span class="preproc">#include</span><span class="normal"> </span><span class="string">"badguy.h"</span>
<span class="preproc">#include</span><span class="normal"> </span><span class="string">"scene.h"</span>
<span class="preproc">#include</span><span class="normal"> </span><span class="string">"button.h"</span>
<span class="preproc">#include</span><span class="normal"> </span><span class="string">"tile.h"</span>
<span class="preproc">#include</span><span class="normal"> </span><span class="string">"resources.h"</span>
<span class="preproc">#include</span><span class="normal"> </span><span class="string">"music_manager.h"</span>

<span class="comment">/* definitions to aid development */</span>

<span class="comment">/* definitions that affect gameplay */</span>
<span class="preproc">#define</span><span class="normal"> KEY_CURSOR_SPEED </span><span class="number">32</span>
<span class="preproc">#define</span><span class="normal"> KEY_CURSOR_FASTSPEED </span><span class="number">64</span>

<span class="comment">/* when pagedown/up pressed speed:*/</span>
<span class="preproc">#define</span><span class="normal"> PAGE_CURSOR_SPEED </span><span class="number">13</span><span class="symbol">*</span><span class="number">32</span>

<span class="preproc">#define</span><span class="normal"> MOUSE_LEFT_MARGIN </span><span class="number">80</span>
<span class="preproc">#define</span><span class="normal"> </span><span class="function">MOUSE_RIGHT_MARGIN</span><span class="normal"> </span><span class="symbol">(</span><span class="number">560</span><span class="symbol">-</span><span class="number">32</span><span class="symbol">)</span>
<span class="comment">/* right_margin should noticed that the cursor is 32 pixels,</span>
<span class="comment">   so it should subtract that value */</span>
<span class="preproc">#define</span><span class="normal"> MOUSE_POS_SPEED </span><span class="number">20</span>

<span class="comment">/* look */</span>
<span class="preproc">#define</span><span class="normal"> SELECT_W </span><span class="number">2</span><span class="normal"> </span><span class="comment">// size of the selections lines</span>
<span class="preproc">#define</span><span class="normal"> SELECT_CLR </span><span class="number">0</span><span class="symbol">,</span><span class="normal"> </span><span class="number">255</span><span class="symbol">,</span><span class="normal"> </span><span class="number">0</span><span class="symbol">,</span><span class="normal"> </span><span class="number">255</span><span class="normal">  </span><span class="comment">// lines color (R, G, B, A)</span>

<span class="comment">/* own declerations */</span>
<span class="comment">/* crutial ones (main loop) */</span>
<span class="type">int</span><span class="normal"> </span><span class="function">le_init</span><span class="symbol">();</span>
<span class="type">void</span><span class="normal"> </span><span class="function">le_quit</span><span class="symbol">();</span>
<span class="type">int</span><span class="normal"> </span><span class="function">le_load_level_subset</span><span class="symbol">(</span><span class="type">char</span><span class="normal"> </span><span class="symbol">*</span><span class="normal">filename</span><span class="symbol">);</span>
<span class="type">void</span><span class="normal"> </span><span class="function">le_drawlevel</span><span class="symbol">();</span>
<span class="type">void</span><span class="normal"> </span><span class="function">le_drawinterface</span><span class="symbol">();</span>
<span class="type">void</span><span class="normal"> </span><span class="function">le_checkevents</span><span class="symbol">();</span>
<span class="type">void</span><span class="normal"> </span><span class="function">le_change</span><span class="symbol">(</span><span class="type">float</span><span class="normal"> x</span><span class="symbol">,</span><span class="normal"> </span><span class="type">float</span><span class="normal"> y</span><span class="symbol">,</span><span class="normal"> </span><span class="type">int</span><span class="normal"> tm</span><span class="symbol">,</span><span class="normal"> </span><span class="type">unsigned</span><span class="normal"> </span><span class="type">int</span><span class="normal"> c</span><span class="symbol">);</span>
<span class="type">void</span><span class="normal"> </span><span class="function">le_testlevel</span><span class="symbol">();</span>
<span class="type">void</span><span class="normal"> </span><span class="function">le_showhelp</span><span class="symbol">();</span>
<span class="type">void</span><span class="normal"> </span><span class="function">le_set_defaults</span><span class="symbol">(</span><span class="type">void</span><span class="symbol">);</span>
<span class="type">void</span><span class="normal"> </span><span class="function">le_activate_bad_guys</span><span class="symbol">(</span><span class="type">void</span><span class="symbol">);</span>
<span class="type">void</span><span class="normal"> </span><span class="function">le_goto_level</span><span class="symbol">(</span><span class="type">int</span><span class="normal"> levelnb</span><span class="symbol">);</span>
<span class="type">void</span><span class="normal"> </span><span class="function">le_highlight_selection</span><span class="symbol">();</span>

<span class="type">void</span><span class="normal"> </span><span class="function">apply_level_settings_menu</span><span class="symbol">();</span>
<span class="type">void</span><span class="normal"> </span><span class="function">update_subset_settings_menu</span><span class="symbol">();</span>
<span class="type">void</span><span class="normal"> </span><span class="function">save_subset_settings_menu</span><span class="symbol">();</span>

<span class="keyword">struct</span><span class="normal"> </span><span class="classname">TileOrObject</span>
<span class="cbracket">{</span>
<span class="normal">  </span><span class="function">TileOrObject</span><span class="symbol">()</span><span class="normal"> </span><span class="symbol">:</span><span class="normal"> </span><span class="function">tile</span><span class="symbol">(</span><span class="number">0</span><span class="symbol">),</span><span class="normal"> </span><span class="function">obj</span><span class="symbol">(</span><span class="normal">NULL</span><span class="symbol">)</span><span class="normal"> </span><span class="cbracket">{</span><span class="normal"> is_tile </span><span class="symbol">=</span><span class="normal"> </span><span class="keyword">true</span><span class="symbol">;</span><span class="normal"> </span><span class="cbracket">}</span><span class="symbol">;</span>

<span class="normal">  </span><span class="type">void</span><span class="normal"> </span><span class="function">Tile</span><span class="symbol">(</span><span class="type">unsigned</span><span class="normal"> </span><span class="type">int</span><span class="normal"> set_to</span><span class="symbol">)</span><span class="normal"> </span><span class="cbracket">{</span><span class="normal"> tile </span><span class="symbol">=</span><span class="normal"> set_to</span><span class="symbol">;</span><span class="normal"> is_tile </span><span class="symbol">=</span><span class="normal"> </span><span class="keyword">true</span><span class="symbol">;</span><span class="normal"> </span><span class="cbracket">}</span>
<span class="normal">  </span><span class="type">void</span><span class="normal"> </span><span class="function">Object</span><span class="symbol">(</span><span class="normal">GameObject</span><span class="symbol">*</span><span class="normal"> pobj</span><span class="symbol">)</span><span class="normal"> </span><span class="cbracket">{</span><span class="normal"> obj </span><span class="symbol">=</span><span class="normal"> pobj</span><span class="symbol">;</span><span class="normal"> is_tile </span><span class="symbol">=</span><span class="normal"> </span><span class="keyword">false</span><span class="symbol">;</span><span class="normal"> </span><span class="cbracket">}</span>
<span class="normal">  </span><span class="comment">//Returns true for a tile</span>
<span class="normal">  </span><span class="type">bool</span><span class="normal"> </span><span class="function">IsTile</span><span class="symbol">()</span><span class="normal"> </span><span class="cbracket">{</span><span class="normal"> </span><span class="keyword">return</span><span class="normal"> is_tile</span><span class="symbol">;</span><span class="normal"> </span><span class="cbracket">}</span><span class="symbol">;</span>
<span class="normal">  </span><span class="comment">//Returns true for a GameObject</span>
<span class="normal">  </span><span class="type">bool</span><span class="normal"> </span><span class="function">IsObject</span><span class="symbol">()</span><span class="normal"> </span><span class="cbracket">{</span><span class="normal"> </span><span class="keyword">return</span><span class="normal"> </span><span class="symbol">!</span><span class="normal">is_tile</span><span class="symbol">;</span><span class="normal"> </span><span class="cbracket">}</span><span class="symbol">;</span>


<span class="normal">  </span><span class="type">void</span><span class="normal"> </span><span class="function">Init</span><span class="symbol">()</span><span class="normal"> </span><span class="cbracket">{</span><span class="normal"> tile </span><span class="symbol">=</span><span class="normal"> </span><span class="number">0</span><span class="symbol">;</span><span class="normal"> obj </span><span class="symbol">=</span><span class="normal"> NULL</span><span class="symbol">;</span><span class="normal"> is_tile </span><span class="symbol">=</span><span class="normal"> </span><span class="keyword">true</span><span class="symbol">;</span><span class="normal"> </span><span class="cbracket">}</span><span class="symbol">;</span>

<span class="normal">  </span><span class="type">bool</span><span class="normal"> is_tile</span><span class="symbol">;</span><span class="normal"> </span><span class="comment">//true for tile (false for object)</span>
<span class="normal">  </span><span class="type">unsigned</span><span class="normal"> </span><span class="type">int</span><span class="normal"> tile</span><span class="symbol">;</span>
<span class="normal">  GameObject</span><span class="symbol">*</span><span class="normal"> obj</span><span class="symbol">;</span>
<span class="cbracket">}</span><span class="symbol">;</span>

<span class="comment">/* leveleditor internals */</span>
<span class="keyword">static</span><span class="normal"> </span><span class="usertype">string_list_type</span><span class="normal"> level_subsets</span><span class="symbol">;</span>
<span class="keyword">static</span><span class="normal"> </span><span class="type">bool</span><span class="normal"> le_level_changed</span><span class="symbol">;</span><span class="normal">  </span><span class="comment">/* if changes, ask for saving, when quiting*/</span>
<span class="keyword">static</span><span class="normal"> </span><span class="type">bool</span><span class="normal"> show_minimap</span><span class="symbol">;</span>
<span class="keyword">static</span><span class="normal"> </span><span class="type">bool</span><span class="normal"> show_selections</span><span class="symbol">;</span>
<span class="keyword">static</span><span class="normal"> </span><span class="type">bool</span><span class="normal"> le_help_shown</span><span class="symbol">;</span>
<span class="keyword">static</span><span class="normal"> </span><span class="type">int</span><span class="normal"> pos_x</span><span class="symbol">,</span><span class="normal"> cursor_x</span><span class="symbol">,</span><span class="normal"> cursor_y</span><span class="symbol">,</span><span class="normal"> fire</span><span class="symbol">;</span>
<span class="keyword">static</span><span class="normal"> </span><span class="type">int</span><span class="normal"> le_level</span><span class="symbol">;</span>
<span class="keyword">static</span><span class="normal"> World</span><span class="symbol">*</span><span class="normal"> le_world</span><span class="symbol">;</span>
<span class="keyword">static</span><span class="normal"> LevelSubset</span><span class="symbol">*</span><span class="normal"> le_level_subset</span><span class="symbol">;</span>
<span class="keyword">static</span><span class="normal"> </span><span class="type">int</span><span class="normal"> le_show_grid</span><span class="symbol">;</span>
<span class="keyword">static</span><span class="normal"> </span><span class="type">int</span><span class="normal"> le_frame</span><span class="symbol">;</span>
<span class="keyword">static</span><span class="normal"> Surface</span><span class="symbol">*</span><span class="normal"> le_selection</span><span class="symbol">;</span>
<span class="keyword">static</span><span class="normal"> </span><span class="type">int</span><span class="normal"> done</span><span class="symbol">;</span>
<span class="keyword">static</span><span class="normal"> </span><span class="usertype">TileOrObject</span><span class="normal"> le_current</span><span class="symbol">;</span>
<span class="keyword">static</span><span class="normal"> </span><span class="type">bool</span><span class="normal"> le_mouse_pressed</span><span class="symbol">[</span><span class="number">2</span><span class="symbol">];</span>
<span class="keyword">static</span><span class="normal"> </span><span class="type">bool</span><span class="normal"> le_mouse_clicked</span><span class="symbol">[</span><span class="number">2</span><span class="symbol">];</span>
<span class="keyword">static</span><span class="normal"> Button</span><span class="symbol">*</span><span class="normal"> le_save_level_bt</span><span class="symbol">;</span>
<span class="keyword">static</span><span class="normal"> Button</span><span class="symbol">*</span><span class="normal"> le_exit_bt</span><span class="symbol">;</span>
<span class="keyword">static</span><span class="normal"> Button</span><span class="symbol">*</span><span class="normal"> le_test_level_bt</span><span class="symbol">;</span>
<span class="keyword">static</span><span class="normal"> Button</span><span class="symbol">*</span><span class="normal"> le_next_level_bt</span><span class="symbol">;</span>
<span class="keyword">static</span><span class="normal"> Button</span><span class="symbol">*</span><span class="normal"> le_previous_level_bt</span><span class="symbol">;</span>
<span class="keyword">static</span><span class="normal"> Button</span><span class="symbol">*</span><span class="normal"> le_move_right_bt</span><span class="symbol">;</span>
<span class="keyword">static</span><span class="normal"> Button</span><span class="symbol">*</span><span class="normal"> le_move_left_bt</span><span class="symbol">;</span>
<span class="keyword">static</span><span class="normal"> Button</span><span class="symbol">*</span><span class="normal"> le_rubber_bt</span><span class="symbol">;</span>
<span class="keyword">static</span><span class="normal"> Button</span><span class="symbol">*</span><span class="normal"> le_select_mode_one_bt</span><span class="symbol">;</span>
<span class="keyword">static</span><span class="normal"> Button</span><span class="symbol">*</span><span class="normal"> le_select_mode_two_bt</span><span class="symbol">;</span>
<span class="keyword">static</span><span class="normal"> Button</span><span class="symbol">*</span><span class="normal"> le_settings_bt</span><span class="symbol">;</span>
<span class="keyword">static</span><span class="normal"> Button</span><span class="symbol">*</span><span class="normal"> le_tilegroup_bt</span><span class="symbol">;</span>
<span class="keyword">static</span><span class="normal"> Button</span><span class="symbol">*</span><span class="normal"> le_objects_bt</span><span class="symbol">;</span>
<span class="keyword">static</span><span class="normal"> Button</span><span class="symbol">*</span><span class="normal"> le_object_select_bt</span><span class="symbol">;</span>
<span class="keyword">static</span><span class="normal"> Button</span><span class="symbol">*</span><span class="normal"> le_object_properties_bt</span><span class="symbol">;</span>
<span class="keyword">static</span><span class="normal"> ButtonPanel</span><span class="symbol">*</span><span class="normal"> le_tilemap_panel</span><span class="symbol">;</span>
<span class="keyword">static</span><span class="normal"> Menu</span><span class="symbol">*</span><span class="normal"> leveleditor_menu</span><span class="symbol">;</span>
<span class="keyword">static</span><span class="normal"> Menu</span><span class="symbol">*</span><span class="normal"> subset_load_menu</span><span class="symbol">;</span>
<span class="keyword">static</span><span class="normal"> Menu</span><span class="symbol">*</span><span class="normal"> subset_new_menu</span><span class="symbol">;</span>
<span class="keyword">static</span><span class="normal"> Menu</span><span class="symbol">*</span><span class="normal"> subset_settings_menu</span><span class="symbol">;</span>
<span class="keyword">static</span><span class="normal"> Menu</span><span class="symbol">*</span><span class="normal"> level_settings_menu</span><span class="symbol">;</span>
<span class="keyword">static</span><span class="normal"> Menu</span><span class="symbol">*</span><span class="normal"> select_tilegroup_menu</span><span class="symbol">;</span>
<span class="keyword">static</span><span class="normal"> Menu</span><span class="symbol">*</span><span class="normal"> select_objects_menu</span><span class="symbol">;</span>
<span class="keyword">static</span><span class="normal"> </span><span class="usertype">Timer</span><span class="normal"> select_tilegroup_menu_effect</span><span class="symbol">;</span>
<span class="keyword">static</span><span class="normal"> </span><span class="usertype">Timer</span><span class="normal"> select_objects_menu_effect</span><span class="symbol">;</span>
<span class="keyword">static</span><span class="normal"> </span><span class="usertype">Timer</span><span class="normal"> display_level_info</span><span class="symbol">;</span>
<span class="keyword">typedef</span><span class="normal"> std</span><span class="symbol">::</span><span class="usertype">map&lt;std::string, ButtonPanel*&gt;</span><span class="normal"> ButtonPanelMap</span><span class="symbol">;</span>
<span class="keyword">static</span><span class="normal"> </span><span class="usertype">ButtonPanelMap</span><span class="normal"> tilegroups_map</span><span class="symbol">;</span>
<span class="keyword">static</span><span class="normal"> </span><span class="usertype">ButtonPanelMap</span><span class="normal"> objects_map</span><span class="symbol">;</span>
<span class="keyword">static</span><span class="normal"> std</span><span class="symbol">::</span><span class="usertype">string</span><span class="normal"> cur_tilegroup</span><span class="symbol">;</span>
<span class="keyword">static</span><span class="normal"> std</span><span class="symbol">::</span><span class="usertype">string</span><span class="normal"> cur_objects</span><span class="symbol">;</span>
<span class="keyword">static</span><span class="normal"> MouseCursor</span><span class="symbol">*</span><span class="normal"> mouse_select_object</span><span class="symbol">;</span>
<span class="keyword">static</span><span class="normal"> GameObject</span><span class="symbol">*</span><span class="normal"> selected_game_object</span><span class="symbol">;</span>

<span class="keyword">static</span><span class="normal"> </span><span class="usertype">square</span><span class="normal"> selection</span><span class="symbol">;</span>
<span class="keyword">static</span><span class="normal"> </span><span class="type">int</span><span class="normal"> le_selection_mode</span><span class="symbol">;</span>
<span class="keyword">static</span><span class="normal"> </span><span class="usertype">SDL_Event</span><span class="normal"> event</span><span class="symbol">;</span>
<span class="usertype">TileMapType</span><span class="normal"> active_tm</span><span class="symbol">;</span>

<span class="type">int</span><span class="normal"> </span><span class="function">leveleditor</span><span class="symbol">(</span><span class="type">char</span><span class="symbol">*</span><span class="normal"> filename</span><span class="symbol">)</span>
<span class="cbracket">{</span>
<span class="normal">  </span><span class="type">int</span><span class="normal"> last_time</span><span class="symbol">,</span><span class="normal"> now_time</span><span class="symbol">,</span><span class="normal"> i</span><span class="symbol">;</span>

<span class="normal">  le_level </span><span class="symbol">=</span><span class="normal"> </span><span class="number">1</span><span class="symbol">;</span>

<span class="normal">  </span><span class="keyword">if</span><span class="symbol">(</span><span class="function">le_init</span><span class="symbol">()</span><span class="normal"> </span><span class="symbol">!=</span><span class="normal"> </span><span class="number">0</span><span class="symbol">)</span>
<span class="normal">    </span><span class="keyword">return</span><span class="normal"> </span><span class="number">1</span><span class="symbol">;</span>

<span class="normal">  </span><span class="comment">/* Clear screen: */</span>

<span class="normal">  </span><span class="function">clearscreen</span><span class="symbol">(</span><span class="number">0</span><span class="symbol">,</span><span class="normal"> </span><span class="number">0</span><span class="symbol">,</span><span class="normal"> </span><span class="number">0</span><span class="symbol">);</span>
<span class="normal">  </span><span class="function">updatescreen</span><span class="symbol">();</span>

<span class="normal">  music_manager</span><span class="symbol">-&gt;</span><span class="function">halt_music</span><span class="symbol">();</span>

<span class="normal">  </span><span class="keyword">while</span><span class="normal"> </span><span class="symbol">(</span><span class="function">SDL_PollEvent</span><span class="symbol">(&amp;</span><span class="normal">event</span><span class="symbol">))</span>
<span class="normal">  </span><span class="cbracket">{}</span>

<span class="normal">  </span><span class="keyword">if</span><span class="symbol">(</span><span class="normal">filename </span><span class="symbol">!=</span><span class="normal"> NULL</span><span class="symbol">)</span>
<span class="normal">    </span><span class="keyword">if</span><span class="symbol">(</span><span class="function">le_load_level_subset</span><span class="symbol">(</span><span class="normal">filename</span><span class="symbol">))</span>
<span class="normal">      </span><span class="keyword">return</span><span class="normal"> </span><span class="number">1</span><span class="symbol">;</span>

<span class="normal">  </span><span class="keyword">while</span><span class="symbol">(</span><span class="keyword">true</span><span class="symbol">)</span>
<span class="normal">  </span><span class="cbracket">{</span>
<span class="normal">    last_time </span><span class="symbol">=</span><span class="normal"> </span><span class="function">SDL_GetTicks</span><span class="symbol">();</span>
<span class="normal">    le_frame</span><span class="symbol">++;</span>

<span class="normal">    </span><span class="function">le_checkevents</span><span class="symbol">();</span>

<span class="normal">    </span><span class="keyword">if</span><span class="symbol">(</span><span class="normal">Menu</span><span class="symbol">::</span><span class="function">current</span><span class="symbol">()</span><span class="normal"> </span><span class="symbol">==</span><span class="normal"> select_tilegroup_menu</span><span class="symbol">)</span>
<span class="normal">    </span><span class="cbracket">{</span>
<span class="normal">      </span><span class="keyword">if</span><span class="symbol">(</span><span class="normal">select_tilegroup_menu_effect</span><span class="symbol">.</span><span class="function">check</span><span class="symbol">())</span>
<span class="normal">      </span><span class="cbracket">{</span>
<span class="normal">        select_tilegroup_menu</span><span class="symbol">-&gt;</span><span class="function">set_pos</span><span class="symbol">(</span><span class="normal">screen</span><span class="symbol">-&gt;</span><span class="normal">w </span><span class="symbol">-</span><span class="normal"> </span><span class="number">64</span><span class="normal"> </span><span class="symbol">+</span><span class="normal"> select_tilegroup_menu_effect</span><span class="symbol">.</span><span class="function">get_left</span><span class="symbol">(),</span>
<span class="normal">                                       </span><span class="number">66</span><span class="symbol">,-</span><span class="number">0.5</span><span class="symbol">,</span><span class="number">0.5</span><span class="symbol">);</span>
<span class="normal">      </span><span class="cbracket">}</span>
<span class="normal">      </span><span class="keyword">else</span>
<span class="normal">        select_tilegroup_menu</span><span class="symbol">-&gt;</span><span class="function">set_pos</span><span class="symbol">(</span><span class="normal">screen</span><span class="symbol">-&gt;</span><span class="normal">w </span><span class="symbol">-</span><span class="normal"> </span><span class="number">64</span><span class="symbol">,</span><span class="number">66</span><span class="symbol">,-</span><span class="number">0.5</span><span class="symbol">,</span><span class="number">0.5</span><span class="symbol">);</span>
<span class="normal">    </span><span class="cbracket">}</span>
<span class="normal">    </span><span class="keyword">else</span><span class="normal"> </span><span class="keyword">if</span><span class="symbol">(</span><span class="normal">Menu</span><span class="symbol">::</span><span class="function">current</span><span class="symbol">()</span><span class="normal"> </span><span class="symbol">==</span><span class="normal"> select_objects_menu</span><span class="symbol">)</span>
<span class="normal">    </span><span class="cbracket">{</span>
<span class="normal">      </span><span class="keyword">if</span><span class="symbol">(</span><span class="normal">select_objects_menu_effect</span><span class="symbol">.</span><span class="function">check</span><span class="symbol">())</span>
<span class="normal">      </span><span class="cbracket">{</span>
<span class="normal">        select_objects_menu</span><span class="symbol">-&gt;</span><span class="function">set_pos</span><span class="symbol">(</span><span class="normal">screen</span><span class="symbol">-&gt;</span><span class="normal">w </span><span class="symbol">-</span><span class="normal"> </span><span class="number">64</span><span class="normal"> </span><span class="symbol">+</span><span class="normal"> select_objects_menu_effect</span><span class="symbol">.</span><span class="function">get_left</span><span class="symbol">(),</span><span class="number">82</span><span class="symbol">,-</span><span class="number">0.5</span><span class="symbol">,</span><span class="number">0.5</span><span class="symbol">);</span>
<span class="normal">      </span><span class="cbracket">}</span>
<span class="normal">      </span><span class="keyword">else</span>
<span class="normal">        select_objects_menu</span><span class="symbol">-&gt;</span><span class="function">set_pos</span><span class="symbol">(</span><span class="normal">screen</span><span class="symbol">-&gt;</span><span class="normal">w </span><span class="symbol">-</span><span class="normal"> </span><span class="number">64</span><span class="symbol">,</span><span class="number">82</span><span class="symbol">,-</span><span class="number">0.5</span><span class="symbol">,</span><span class="number">0.5</span><span class="symbol">);</span>
<span class="normal">    </span><span class="cbracket">}</span>

<span class="normal">    </span><span class="keyword">if</span><span class="symbol">(</span><span class="normal">le_world </span><span class="symbol">!=</span><span class="normal"> NULL</span><span class="symbol">)</span>
<span class="normal">    </span><span class="cbracket">{</span>
<span class="normal">      </span><span class="comment">/* making events results to be in order */</span>
<span class="normal">      </span><span class="keyword">if</span><span class="symbol">(</span><span class="normal">pos_x </span><span class="symbol">&lt;</span><span class="normal"> </span><span class="number">0</span><span class="symbol">)</span>
<span class="normal">        pos_x </span><span class="symbol">=</span><span class="normal"> </span><span class="number">0</span><span class="symbol">;</span>
<span class="normal">      </span><span class="keyword">if</span><span class="symbol">(</span><span class="normal">pos_x </span><span class="symbol">&gt;</span><span class="normal"> </span><span class="symbol">(</span><span class="normal">le_world</span><span class="symbol">-&gt;</span><span class="function">get_level</span><span class="symbol">()-&gt;</span><span class="normal">width </span><span class="symbol">*</span><span class="normal"> </span><span class="number">32</span><span class="normal"> </span><span class="symbol">+</span><span class="normal"> </span><span class="number">2</span><span class="symbol">*</span><span class="number">32</span><span class="symbol">)</span><span class="normal"> </span><span class="symbol">-</span><span class="normal"> screen</span><span class="symbol">-&gt;</span><span class="normal">w</span><span class="symbol">)</span>
<span class="normal">        pos_x </span><span class="symbol">=</span><span class="normal"> </span><span class="symbol">(</span><span class="normal">le_world</span><span class="symbol">-&gt;</span><span class="function">get_level</span><span class="symbol">()-&gt;</span><span class="normal">width </span><span class="symbol">*</span><span class="normal"> </span><span class="number">32</span><span class="normal"> </span><span class="symbol">+</span><span class="number">2</span><span class="symbol">*</span><span class="number">32</span><span class="symbol">)</span><span class="normal"> </span><span class="symbol">-</span><span class="normal"> screen</span><span class="symbol">-&gt;</span><span class="normal">w</span><span class="symbol">;</span>

<span class="normal">      </span><span class="comment">/* draw the level */</span>
<span class="normal">      </span><span class="function">le_drawlevel</span><span class="symbol">();</span>
<span class="normal">    </span><span class="cbracket">}</span>
<span class="normal">    </span><span class="keyword">else</span>
<span class="normal">      </span><span class="function">clearscreen</span><span class="symbol">(</span><span class="number">0</span><span class="symbol">,</span><span class="normal"> </span><span class="number">0</span><span class="symbol">,</span><span class="normal"> </span><span class="number">0</span><span class="symbol">);</span>

<span class="normal">    </span><span class="comment">/* draw editor interface */</span>
<span class="normal">    </span><span class="function">le_drawinterface</span><span class="symbol">();</span>

<span class="normal">    Menu</span><span class="symbol">*</span><span class="normal"> menu </span><span class="symbol">=</span><span class="normal"> Menu</span><span class="symbol">::</span><span class="function">current</span><span class="symbol">();</span>
<span class="normal">    </span><span class="keyword">if</span><span class="symbol">(</span><span class="normal">menu</span><span class="symbol">)</span>
<span class="normal">    </span><span class="cbracket">{</span>
<span class="normal">      menu</span><span class="symbol">-&gt;</span><span class="function">draw</span><span class="symbol">();</span>
<span class="normal">      menu</span><span class="symbol">-&gt;</span><span class="function">action</span><span class="symbol">();</span>

<span class="normal">      </span><span class="keyword">if</span><span class="symbol">(</span><span class="normal">menu </span><span class="symbol">==</span><span class="normal"> leveleditor_menu</span><span class="symbol">)</span>
<span class="normal">      </span><span class="cbracket">{</span>
<span class="normal">        </span><span class="keyword">switch</span><span class="normal"> </span><span class="symbol">(</span><span class="normal">leveleditor_menu</span><span class="symbol">-&gt;</span><span class="function">check</span><span class="symbol">())</span>
<span class="normal">        </span><span class="cbracket">{</span>
<span class="normal">        </span><span class="keyword">case</span><span class="normal"> MNID_RETURNLEVELEDITOR</span><span class="symbol">:</span>
<span class="normal">          </span><span class="keyword">if</span><span class="symbol">(</span><span class="normal">le_world </span><span class="symbol">!=</span><span class="normal"> NULL</span><span class="symbol">)</span>
<span class="normal">            Menu</span><span class="symbol">::</span><span class="function">set_current</span><span class="symbol">(</span><span class="number">0</span><span class="symbol">);</span>
<span class="normal">          </span><span class="keyword">else</span>
<span class="normal">            Menu</span><span class="symbol">::</span><span class="function">set_current</span><span class="symbol">(</span><span class="normal">leveleditor_menu</span><span class="symbol">);</span>
<span class="normal">          </span><span class="keyword">break</span><span class="symbol">;</span>
<span class="normal">        </span><span class="keyword">case</span><span class="normal"> MNID_SUBSETSETTINGS</span><span class="symbol">:</span>
<span class="normal">          </span><span class="function">update_subset_settings_menu</span><span class="symbol">();</span>
<span class="normal">          </span><span class="keyword">break</span><span class="symbol">;</span>
<span class="normal">        </span><span class="keyword">case</span><span class="normal"> MNID_QUITLEVELEDITOR</span><span class="symbol">:</span>
<span class="normal">          done </span><span class="symbol">=</span><span class="normal"> </span><span class="number">1</span><span class="symbol">;</span>
<span class="normal">          </span><span class="keyword">break</span><span class="symbol">;</span>
<span class="normal">        </span><span class="cbracket">}</span>
<span class="normal">      </span><span class="cbracket">}</span>
<span class="normal">      </span><span class="keyword">else</span><span class="normal"> </span><span class="keyword">if</span><span class="symbol">(</span><span class="normal">menu </span><span class="symbol">==</span><span class="normal"> level_settings_menu</span><span class="symbol">)</span>
<span class="normal">      </span><span class="cbracket">{</span>
<span class="normal">        </span><span class="keyword">switch</span><span class="normal"> </span><span class="symbol">(</span><span class="normal">level_settings_menu</span><span class="symbol">-&gt;</span><span class="function">check</span><span class="symbol">())</span>
<span class="normal">        </span><span class="cbracket">{</span>
<span class="normal">        </span><span class="keyword">case</span><span class="normal"> MNID_APPLY</span><span class="symbol">:</span>
<span class="normal">          </span><span class="function">apply_level_settings_menu</span><span class="symbol">();</span>
<span class="normal">          Menu</span><span class="symbol">::</span><span class="function">set_current</span><span class="symbol">(</span><span class="normal">NULL</span><span class="symbol">);</span>
<span class="normal">          </span><span class="keyword">break</span><span class="symbol">;</span>

<span class="label">        default:</span>
<span class="normal">          </span><span class="keyword">break</span><span class="symbol">;</span>
<span class="normal">        </span><span class="cbracket">}</span>
<span class="normal">      </span><span class="cbracket">}</span>
<span class="normal">      </span><span class="keyword">else</span><span class="normal"> </span><span class="keyword">if</span><span class="symbol">(</span><span class="normal">menu </span><span class="symbol">==</span><span class="normal"> select_tilegroup_menu</span><span class="symbol">)</span>
<span class="normal">      </span><span class="cbracket">{</span>
<span class="normal">        </span><span class="type">int</span><span class="normal"> it </span><span class="symbol">=</span><span class="normal"> </span><span class="symbol">-</span><span class="number">1</span><span class="symbol">;</span>
<span class="normal">        </span><span class="keyword">switch</span><span class="normal"> </span><span class="symbol">(</span><span class="normal">it </span><span class="symbol">=</span><span class="normal"> select_tilegroup_menu</span><span class="symbol">-&gt;</span><span class="function">check</span><span class="symbol">())</span>
<span class="normal">        </span><span class="cbracket">{</span>
<span class="label">        default:</span>
<span class="normal">          </span><span class="keyword">if</span><span class="symbol">(</span><span class="normal">it </span><span class="symbol">&gt;=</span><span class="normal"> </span><span class="number">0</span><span class="symbol">)</span>
<span class="normal">          </span><span class="cbracket">{</span>
<span class="normal">            cur_tilegroup </span><span class="symbol">=</span><span class="normal"> select_tilegroup_menu</span><span class="symbol">-&gt;</span><span class="function">get_item_by_id</span><span class="symbol">(</span><span class="normal">it</span><span class="symbol">).</span><span class="normal">text</span><span class="symbol">;</span>
<span class="normal">            Menu</span><span class="symbol">::</span><span class="function">set_current</span><span class="symbol">(</span><span class="number">0</span><span class="symbol">);</span>
<span class="normal">            cur_objects </span><span class="symbol">=</span><span class="normal"> </span><span class="string">""</span><span class="symbol">;</span>

<span class="normal">          </span><span class="cbracket">}</span>
<span class="normal">          </span><span class="keyword">break</span><span class="symbol">;</span>
<span class="normal">        </span><span class="cbracket">}</span>
<span class="normal">      </span><span class="cbracket">}</span>
<span class="normal">      </span><span class="keyword">else</span><span class="normal"> </span><span class="keyword">if</span><span class="symbol">(</span><span class="normal">menu </span><span class="symbol">==</span><span class="normal"> select_objects_menu</span><span class="symbol">)</span>
<span class="normal">      </span><span class="cbracket">{</span>
<span class="normal">        </span><span class="type">int</span><span class="normal"> it </span><span class="symbol">=</span><span class="normal"> </span><span class="symbol">-</span><span class="number">1</span><span class="symbol">;</span>
<span class="normal">        </span><span class="keyword">switch</span><span class="normal"> </span><span class="symbol">(</span><span class="normal">it </span><span class="symbol">=</span><span class="normal"> select_objects_menu</span><span class="symbol">-&gt;</span><span class="function">check</span><span class="symbol">())</span>
<span class="normal">        </span><span class="cbracket">{</span>
<span class="label">        default:</span>
<span class="normal">          </span><span class="keyword">if</span><span class="symbol">(</span><span class="normal">it </span><span class="symbol">&gt;=</span><span class="normal"> </span><span class="number">0</span><span class="symbol">)</span>
<span class="normal">          </span><span class="cbracket">{</span>
<span class="normal">            cur_objects </span><span class="symbol">=</span><span class="normal"> select_objects_menu</span><span class="symbol">-&gt;</span><span class="function">get_item_by_id</span><span class="symbol">(</span><span class="normal">it</span><span class="symbol">).</span><span class="normal">text</span><span class="symbol">;</span>
<span class="normal">            cur_tilegroup </span><span class="symbol">=</span><span class="normal"> </span><span class="string">""</span><span class="symbol">;</span>

<span class="normal">            Menu</span><span class="symbol">::</span><span class="function">set_current</span><span class="symbol">(</span><span class="number">0</span><span class="symbol">);</span>
<span class="normal">          </span><span class="cbracket">}</span>
<span class="normal">          </span><span class="keyword">break</span><span class="symbol">;</span>
<span class="normal">        </span><span class="cbracket">}</span>
<span class="normal">      </span><span class="cbracket">}</span>
<span class="normal">      </span><span class="keyword">else</span><span class="normal"> </span><span class="keyword">if</span><span class="symbol">(</span><span class="normal">menu </span><span class="symbol">==</span><span class="normal"> subset_load_menu</span><span class="symbol">)</span>
<span class="normal">      </span><span class="cbracket">{</span>
<span class="normal">        </span><span class="keyword">switch</span><span class="normal"> </span><span class="symbol">(</span><span class="normal">i </span><span class="symbol">=</span><span class="normal"> subset_load_menu</span><span class="symbol">-&gt;</span><span class="function">check</span><span class="symbol">())</span>
<span class="normal">        </span><span class="cbracket">{</span>
<span class="normal">        </span><span class="keyword">case</span><span class="normal"> </span><span class="number">0</span><span class="symbol">:</span>
<span class="normal">          </span><span class="keyword">break</span><span class="symbol">;</span>
<span class="label">        default:</span>
<span class="normal">          </span><span class="keyword">if</span><span class="symbol">(</span><span class="normal">i </span><span class="symbol">&gt;=</span><span class="normal"> </span><span class="number">1</span><span class="symbol">)</span>
<span class="normal">          </span><span class="cbracket">{</span>
<span class="normal">            </span><span class="keyword">if</span><span class="symbol">(</span><span class="function">le_load_level_subset</span><span class="symbol">(</span><span class="normal">level_subsets</span><span class="symbol">.</span><span class="normal">item</span><span class="symbol">[</span><span class="normal">i</span><span class="symbol">-</span><span class="number">1</span><span class="symbol">]))</span>
<span class="normal">              </span><span class="keyword">return</span><span class="normal"> </span><span class="number">1</span><span class="symbol">;</span>
<span class="normal">          </span><span class="cbracket">}</span>
<span class="normal">          </span><span class="keyword">break</span><span class="symbol">;</span>
<span class="normal">        </span><span class="cbracket">}</span>
<span class="normal">      </span><span class="cbracket">}</span>
<span class="normal">      </span><span class="keyword">else</span><span class="normal"> </span><span class="keyword">if</span><span class="symbol">(</span><span class="normal">menu </span><span class="symbol">==</span><span class="normal"> subset_new_menu</span><span class="symbol">)</span>
<span class="normal">      </span><span class="cbracket">{</span>
<span class="normal">        </span><span class="keyword">if</span><span class="symbol">(</span><span class="normal">subset_new_menu</span><span class="symbol">-&gt;</span><span class="normal">item</span><span class="symbol">[</span><span class="number">2</span><span class="symbol">].</span><span class="normal">input</span><span class="symbol">[</span><span class="number">0</span><span class="symbol">]</span><span class="normal"> </span><span class="symbol">==</span><span class="normal"> </span><span class="string">'</span><span class="specialchar">\0</span><span class="string">'</span><span class="symbol">)</span>
<span class="normal">          subset_new_menu</span><span class="symbol">-&gt;</span><span class="normal">item</span><span class="symbol">[</span><span class="number">3</span><span class="symbol">].</span><span class="normal">kind </span><span class="symbol">=</span><span class="normal"> MN_DEACTIVE</span><span class="symbol">;</span>
<span class="normal">        </span><span class="keyword">else</span>
<span class="normal">        </span><span class="cbracket">{</span>
<span class="normal">          subset_new_menu</span><span class="symbol">-&gt;</span><span class="normal">item</span><span class="symbol">[</span><span class="number">3</span><span class="symbol">].</span><span class="normal">kind </span><span class="symbol">=</span><span class="normal"> MN_ACTION</span><span class="symbol">;</span>

<span class="normal">          </span><span class="keyword">switch</span><span class="normal"> </span><span class="symbol">(</span><span class="normal">i </span><span class="symbol">=</span><span class="normal"> subset_new_menu</span><span class="symbol">-&gt;</span><span class="function">check</span><span class="symbol">())</span>
<span class="normal">          </span><span class="cbracket">{</span>
<span class="normal">          </span><span class="keyword">case</span><span class="normal"> MNID_CREATESUBSET</span><span class="symbol">:</span>
<span class="normal">            LevelSubset</span><span class="symbol">::</span><span class="function">create</span><span class="symbol">(</span><span class="normal">subset_new_menu</span><span class="symbol">-&gt;</span><span class="function">get_item_by_id</span><span class="symbol">(</span><span class="normal">MNID_SUBSETNAME</span><span class="symbol">).</span><span class="normal">input</span><span class="symbol">);</span>
<span class="normal">            le_level_subset</span><span class="symbol">-&gt;</span><span class="function">load</span><span class="symbol">(</span><span class="normal">subset_new_menu</span><span class="symbol">-&gt;</span><span class="function">get_item_by_id</span><span class="symbol">(</span><span class="normal">MNID_SUBSETNAME</span><span class="symbol">).</span><span class="normal">input</span><span class="symbol">);</span>
<span class="normal">            leveleditor_menu</span><span class="symbol">-&gt;</span><span class="function">get_item_by_id</span><span class="symbol">(</span><span class="normal">MNID_SUBSETSETTINGS</span><span class="symbol">).</span><span class="normal">kind </span><span class="symbol">=</span><span class="normal"> MN_GOTO</span><span class="symbol">;</span>
<span class="normal">            </span><span class="function">le_goto_level</span><span class="symbol">(</span><span class="number">1</span><span class="symbol">);</span>
<span class="normal">            subset_new_menu</span><span class="symbol">-&gt;</span><span class="function">get_item_by_id</span><span class="symbol">(</span><span class="normal">MNID_SUBSETNAME</span><span class="symbol">).</span><span class="function">change_input</span><span class="symbol">(</span><span class="string">""</span><span class="symbol">);</span>

<span class="normal">            Menu</span><span class="symbol">::</span><span class="function">set_current</span><span class="symbol">(</span><span class="normal">subset_settings_menu</span><span class="symbol">);</span>
<span class="normal">            </span><span class="keyword">break</span><span class="symbol">;</span>
<span class="normal">          </span><span class="cbracket">}</span>
<span class="normal">        </span><span class="cbracket">}</span>
<span class="normal">      </span><span class="cbracket">}</span>
<span class="normal">      </span><span class="keyword">else</span><span class="normal"> </span><span class="keyword">if</span><span class="symbol">(</span><span class="normal">menu </span><span class="symbol">==</span><span class="normal"> subset_settings_menu</span><span class="symbol">)</span>
<span class="normal">      </span><span class="cbracket">{</span>
<span class="normal">        </span><span class="keyword">if</span><span class="symbol">(</span><span class="normal">le_level_subset</span><span class="symbol">-&gt;</span><span class="normal">title</span><span class="symbol">.</span><span class="function">compare</span><span class="symbol">(</span><span class="normal">subset_settings_menu</span><span class="symbol">-&gt;</span><span class="function">get_item_by_id</span><span class="symbol">(</span><span class="normal">MNID_SUBSETTITLE</span><span class="symbol">).</span><span class="normal">input</span><span class="symbol">)</span><span class="normal"> </span><span class="symbol">==</span><span class="normal"> </span><span class="number">0</span><span class="normal"> </span><span class="symbol">&amp;&amp;</span><span class="normal"> le_level_subset</span><span class="symbol">-&gt;</span><span class="normal">description</span><span class="symbol">.</span><span class="function">compare</span><span class="symbol">(</span><span class="normal">subset_settings_menu</span><span class="symbol">-&gt;</span><span class="function">get_item_by_id</span><span class="symbol">(</span><span class="normal">MNID_SUBSETDESCRIPTION</span><span class="symbol">).</span><span class="normal">input</span><span class="symbol">)</span><span class="normal"> </span><span class="symbol">==</span><span class="normal"> </span><span class="number">0</span><span class="normal">  </span><span class="symbol">)</span>
<span class="normal">          subset_settings_menu</span><span class="symbol">-&gt;</span><span class="function">get_item_by_id</span><span class="symbol">(</span><span class="normal">MNID_SUBSETSAVECHANGES</span><span class="symbol">).</span><span class="normal">kind </span><span class="symbol">=</span><span class="normal"> MN_DEACTIVE</span><span class="symbol">;</span>
<span class="normal">        </span><span class="keyword">else</span>
<span class="normal">          subset_settings_menu</span><span class="symbol">-&gt;</span><span class="function">get_item_by_id</span><span class="symbol">(</span><span class="normal">MNID_SUBSETSAVECHANGES</span><span class="symbol">).</span><span class="normal">kind </span><span class="symbol">=</span><span class="normal"> MN_ACTION</span><span class="symbol">;</span>

<span class="normal">        </span><span class="keyword">switch</span><span class="normal"> </span><span class="symbol">(</span><span class="normal">i </span><span class="symbol">=</span><span class="normal"> subset_settings_menu</span><span class="symbol">-&gt;</span><span class="function">check</span><span class="symbol">())</span>
<span class="normal">        </span><span class="cbracket">{</span>
<span class="normal">        </span><span class="keyword">case</span><span class="normal"> MNID_SUBSETSAVECHANGES</span><span class="symbol">:</span>
<span class="normal">          </span><span class="function">save_subset_settings_menu</span><span class="symbol">();</span>
<span class="normal">          Menu</span><span class="symbol">::</span><span class="function">set_current</span><span class="symbol">(</span><span class="normal">leveleditor_menu</span><span class="symbol">);</span>
<span class="normal">          </span><span class="keyword">break</span><span class="symbol">;</span>
<span class="normal">        </span><span class="cbracket">}</span>
<span class="normal">      </span><span class="cbracket">}</span>
<span class="normal">    </span><span class="cbracket">}</span>

<span class="normal">    MouseCursor</span><span class="symbol">::</span><span class="function">current</span><span class="symbol">()-&gt;</span><span class="function">draw</span><span class="symbol">();</span>

<span class="normal">    </span><span class="keyword">if</span><span class="symbol">(</span><span class="normal">done</span><span class="symbol">)</span>
<span class="normal">    </span><span class="cbracket">{</span>
<span class="normal">      </span><span class="function">le_quit</span><span class="symbol">();</span>
<span class="normal">      </span><span class="keyword">return</span><span class="normal"> </span><span class="number">0</span><span class="symbol">;</span>
<span class="normal">    </span><span class="cbracket">}</span>

<span class="normal">    </span><span class="symbol">++</span><span class="normal">global_frame_counter</span><span class="symbol">;</span>

<span class="normal">    </span><span class="function">SDL_Delay</span><span class="symbol">(</span><span class="number">25</span><span class="symbol">);</span>
<span class="normal">    now_time </span><span class="symbol">=</span><span class="normal"> </span><span class="function">SDL_GetTicks</span><span class="symbol">();</span>
<span class="normal">    </span><span class="keyword">if</span><span class="normal"> </span><span class="symbol">(</span><span class="normal">now_time </span><span class="symbol">&lt;</span><span class="normal"> last_time </span><span class="symbol">+</span><span class="normal"> FPS</span><span class="symbol">)</span>
<span class="normal">      </span><span class="function">SDL_Delay</span><span class="symbol">(</span><span class="normal">last_time </span><span class="symbol">+</span><span class="normal"> FPS </span><span class="symbol">-</span><span class="normal"> now_time</span><span class="symbol">);</span><span class="normal">	</span><span class="comment">/* delay some time */</span>

<span class="normal">    </span><span class="function">flipscreen</span><span class="symbol">();</span>
<span class="normal">  </span><span class="cbracket">}</span>

<span class="normal">  </span><span class="keyword">return</span><span class="normal"> done</span><span class="symbol">;</span>
<span class="cbracket">}</span>

<span class="type">int</span><span class="normal"> </span><span class="function">le_load_level_subset</span><span class="symbol">(</span><span class="type">char</span><span class="normal"> </span><span class="symbol">*</span><span class="normal">filename</span><span class="symbol">)</span>
<span class="cbracket">{</span>
<span class="normal">  le_level_subset</span><span class="symbol">-&gt;</span><span class="function">load</span><span class="symbol">(</span><span class="normal">filename</span><span class="symbol">);</span>
<span class="normal">  leveleditor_menu</span><span class="symbol">-&gt;</span><span class="function">get_item_by_id</span><span class="symbol">(</span><span class="normal">MNID_SUBSETSETTINGS</span><span class="symbol">).</span><span class="normal">kind </span><span class="symbol">=</span><span class="normal"> MN_GOTO</span><span class="symbol">;</span>
<span class="normal">  le_level </span><span class="symbol">=</span><span class="normal"> </span><span class="number">1</span><span class="symbol">;</span>
<span class="normal">  </span><span class="function">le_goto_level</span><span class="symbol">(</span><span class="number">1</span><span class="symbol">);</span>

<span class="normal">  </span><span class="comment">//GameSession* session = new GameSession(datadir + "/levels/" + le_level_subset-&gt;name + "/level1.stl", 0, ST_GL_DEMO_GAME);</span>

<span class="normal">  Menu</span><span class="symbol">::</span><span class="function">set_current</span><span class="symbol">(</span><span class="normal">NULL</span><span class="symbol">);</span>

<span class="normal">  </span><span class="keyword">return</span><span class="normal"> </span><span class="number">0</span><span class="symbol">;</span>
<span class="cbracket">}</span>

<span class="type">void</span><span class="normal"> </span><span class="function">le_init_menus</span><span class="symbol">()</span>
<span class="cbracket">{</span>
<span class="normal">  </span><span class="type">int</span><span class="normal"> i</span><span class="symbol">;</span>

<span class="normal">  leveleditor_menu </span><span class="symbol">=</span><span class="normal"> </span><span class="keyword">new</span><span class="normal"> </span><span class="function">Menu</span><span class="symbol">();</span>
<span class="normal">  subset_load_menu </span><span class="symbol">=</span><span class="normal"> </span><span class="keyword">new</span><span class="normal"> </span><span class="function">Menu</span><span class="symbol">();</span>
<span class="normal">  subset_new_menu  </span><span class="symbol">=</span><span class="normal"> </span><span class="keyword">new</span><span class="normal"> </span><span class="function">Menu</span><span class="symbol">();</span>
<span class="normal">  subset_settings_menu </span><span class="symbol">=</span><span class="normal"> </span><span class="keyword">new</span><span class="normal"> </span><span class="function">Menu</span><span class="symbol">();</span>
<span class="normal">  level_settings_menu  </span><span class="symbol">=</span><span class="normal"> </span><span class="keyword">new</span><span class="normal"> </span><span class="function">Menu</span><span class="symbol">();</span>
<span class="normal">  select_tilegroup_menu  </span><span class="symbol">=</span><span class="normal"> </span><span class="keyword">new</span><span class="normal"> </span><span class="function">Menu</span><span class="symbol">();</span>
<span class="normal">  select_objects_menu </span><span class="symbol">=</span><span class="normal"> </span><span class="keyword">new</span><span class="normal"> </span><span class="function">Menu</span><span class="symbol">();</span>

<span class="normal">  leveleditor_menu</span><span class="symbol">-&gt;</span><span class="function">additem</span><span class="symbol">(</span><span class="normal">MN_LABEL</span><span class="symbol">,</span><span class="string">"Level Editor Menu"</span><span class="symbol">,</span><span class="number">0</span><span class="symbol">,</span><span class="number">0</span><span class="symbol">);</span>
<span class="normal">  leveleditor_menu</span><span class="symbol">-&gt;</span><span class="function">additem</span><span class="symbol">(</span><span class="normal">MN_HL</span><span class="symbol">,</span><span class="string">""</span><span class="symbol">,</span><span class="number">0</span><span class="symbol">,</span><span class="number">0</span><span class="symbol">);</span>
<span class="normal">  leveleditor_menu</span><span class="symbol">-&gt;</span><span class="function">additem</span><span class="symbol">(</span><span class="normal">MN_ACTION</span><span class="symbol">,</span><span class="string">"Return To Level Editor"</span><span class="symbol">,</span><span class="number">0</span><span class="symbol">,</span><span class="number">0</span><span class="symbol">,</span><span class="normal">MNID_RETURNLEVELEDITOR</span><span class="symbol">);</span>
<span class="normal">  leveleditor_menu</span><span class="symbol">-&gt;</span><span class="function">additem</span><span class="symbol">(</span><span class="normal">MN_DEACTIVE</span><span class="symbol">,</span><span class="string">"Level Subset Settings"</span><span class="symbol">,</span><span class="number">0</span><span class="symbol">,</span><span class="normal">subset_settings_menu</span><span class="symbol">,</span><span class="normal">MNID_SUBSETSETTINGS</span><span class="symbol">);</span>
<span class="normal">  leveleditor_menu</span><span class="symbol">-&gt;</span><span class="function">additem</span><span class="symbol">(</span><span class="normal">MN_GOTO</span><span class="symbol">,</span><span class="string">"Load Level Subset"</span><span class="symbol">,</span><span class="number">0</span><span class="symbol">,</span><span class="normal">subset_load_menu</span><span class="symbol">);</span>
<span class="normal">  leveleditor_menu</span><span class="symbol">-&gt;</span><span class="function">additem</span><span class="symbol">(</span><span class="normal">MN_GOTO</span><span class="symbol">,</span><span class="string">"New Level Subset"</span><span class="symbol">,</span><span class="number">0</span><span class="symbol">,</span><span class="normal">subset_new_menu</span><span class="symbol">);</span>
<span class="normal">  leveleditor_menu</span><span class="symbol">-&gt;</span><span class="function">additem</span><span class="symbol">(</span><span class="normal">MN_HL</span><span class="symbol">,</span><span class="string">""</span><span class="symbol">,</span><span class="number">0</span><span class="symbol">,</span><span class="number">0</span><span class="symbol">);</span>
<span class="normal">  leveleditor_menu</span><span class="symbol">-&gt;</span><span class="function">additem</span><span class="symbol">(</span><span class="normal">MN_ACTION</span><span class="symbol">,</span><span class="string">"Quit Level Editor"</span><span class="symbol">,</span><span class="number">0</span><span class="symbol">,</span><span class="number">0</span><span class="symbol">,</span><span class="normal">MNID_QUITLEVELEDITOR</span><span class="symbol">);</span>

<span class="normal">  Menu</span><span class="symbol">::</span><span class="function">set_current</span><span class="symbol">(</span><span class="normal">leveleditor_menu</span><span class="symbol">);</span>

<span class="normal">  subset_load_menu</span><span class="symbol">-&gt;</span><span class="function">additem</span><span class="symbol">(</span><span class="normal">MN_LABEL</span><span class="symbol">,</span><span class="normal"> </span><span class="string">"Load Level Subset"</span><span class="symbol">,</span><span class="normal"> </span><span class="number">0</span><span class="symbol">,</span><span class="normal"> </span><span class="number">0</span><span class="symbol">);</span>
<span class="normal">  subset_load_menu</span><span class="symbol">-&gt;</span><span class="function">additem</span><span class="symbol">(</span><span class="normal">MN_HL</span><span class="symbol">,</span><span class="normal"> </span><span class="string">""</span><span class="symbol">,</span><span class="normal"> </span><span class="number">0</span><span class="symbol">,</span><span class="normal"> </span><span class="number">0</span><span class="symbol">);</span>

<span class="normal">  </span><span class="keyword">for</span><span class="symbol">(</span><span class="normal">i </span><span class="symbol">=</span><span class="normal"> </span><span class="number">0</span><span class="symbol">;</span><span class="normal"> i </span><span class="symbol">&lt;</span><span class="normal"> level_subsets</span><span class="symbol">.</span><span class="normal">num_items</span><span class="symbol">;</span><span class="normal"> </span><span class="symbol">++</span><span class="normal">i</span><span class="symbol">)</span>
<span class="normal">  </span><span class="cbracket">{</span>
<span class="normal">    subset_load_menu</span><span class="symbol">-&gt;</span><span class="function">additem</span><span class="symbol">(</span><span class="normal">MN_ACTION</span><span class="symbol">,</span><span class="normal">level_subsets</span><span class="symbol">.</span><span class="normal">item</span><span class="symbol">[</span><span class="normal">i</span><span class="symbol">],</span><span class="number">0</span><span class="symbol">,</span><span class="number">0</span><span class="symbol">,</span><span class="normal"> i</span><span class="symbol">+</span><span class="number">1</span><span class="symbol">);</span>
<span class="normal">  </span><span class="cbracket">}</span>
<span class="normal">  subset_load_menu</span><span class="symbol">-&gt;</span><span class="function">additem</span><span class="symbol">(</span><span class="normal">MN_HL</span><span class="symbol">,</span><span class="string">""</span><span class="symbol">,</span><span class="number">0</span><span class="symbol">,</span><span class="number">0</span><span class="symbol">);</span>
<span class="normal">  subset_load_menu</span><span class="symbol">-&gt;</span><span class="function">additem</span><span class="symbol">(</span><span class="normal">MN_BACK</span><span class="symbol">,</span><span class="string">"Back"</span><span class="symbol">,</span><span class="number">0</span><span class="symbol">,</span><span class="number">0</span><span class="symbol">);</span>

<span class="normal">  subset_new_menu</span><span class="symbol">-&gt;</span><span class="function">additem</span><span class="symbol">(</span><span class="normal">MN_LABEL</span><span class="symbol">,</span><span class="string">"New Level Subset"</span><span class="symbol">,</span><span class="number">0</span><span class="symbol">,</span><span class="number">0</span><span class="symbol">);</span>
<span class="normal">  subset_new_menu</span><span class="symbol">-&gt;</span><span class="function">additem</span><span class="symbol">(</span><span class="normal">MN_HL</span><span class="symbol">,</span><span class="string">""</span><span class="symbol">,</span><span class="number">0</span><span class="symbol">,</span><span class="number">0</span><span class="symbol">);</span>
<span class="normal">  subset_new_menu</span><span class="symbol">-&gt;</span><span class="function">additem</span><span class="symbol">(</span><span class="normal">MN_TEXTFIELD</span><span class="symbol">,</span><span class="string">"Enter Name"</span><span class="symbol">,</span><span class="number">0</span><span class="symbol">,</span><span class="number">0</span><span class="symbol">,</span><span class="normal">MNID_SUBSETNAME</span><span class="symbol">);</span>
<span class="normal">  subset_new_menu</span><span class="symbol">-&gt;</span><span class="function">additem</span><span class="symbol">(</span><span class="normal">MN_ACTION</span><span class="symbol">,</span><span class="string">"Create"</span><span class="symbol">,</span><span class="number">0</span><span class="symbol">,</span><span class="number">0</span><span class="symbol">,</span><span class="normal"> MNID_CREATESUBSET</span><span class="symbol">);</span>
<span class="normal">  subset_new_menu</span><span class="symbol">-&gt;</span><span class="function">additem</span><span class="symbol">(</span><span class="normal">MN_HL</span><span class="symbol">,</span><span class="string">""</span><span class="symbol">,</span><span class="number">0</span><span class="symbol">,</span><span class="number">0</span><span class="symbol">);</span>
<span class="normal">  subset_new_menu</span><span class="symbol">-&gt;</span><span class="function">additem</span><span class="symbol">(</span><span class="normal">MN_BACK</span><span class="symbol">,</span><span class="string">"Back"</span><span class="symbol">,</span><span class="number">0</span><span class="symbol">,</span><span class="number">0</span><span class="symbol">);</span>

<span class="normal">  subset_settings_menu</span><span class="symbol">-&gt;</span><span class="function">additem</span><span class="symbol">(</span><span class="normal">MN_LABEL</span><span class="symbol">,</span><span class="string">"Level Subset Settings"</span><span class="symbol">,</span><span class="number">0</span><span class="symbol">,</span><span class="number">0</span><span class="symbol">);</span>
<span class="normal">  subset_settings_menu</span><span class="symbol">-&gt;</span><span class="function">additem</span><span class="symbol">(</span><span class="normal">MN_HL</span><span class="symbol">,</span><span class="string">""</span><span class="symbol">,</span><span class="number">0</span><span class="symbol">,</span><span class="number">0</span><span class="symbol">);</span>
<span class="normal">  subset_settings_menu</span><span class="symbol">-&gt;</span><span class="function">additem</span><span class="symbol">(</span><span class="normal">MN_TEXTFIELD</span><span class="symbol">,</span><span class="string">"Title"</span><span class="symbol">,</span><span class="number">0</span><span class="symbol">,</span><span class="number">0</span><span class="symbol">,</span><span class="normal">MNID_SUBSETTITLE</span><span class="symbol">);</span>
<span class="normal">  subset_settings_menu</span><span class="symbol">-&gt;</span><span class="function">additem</span><span class="symbol">(</span><span class="normal">MN_TEXTFIELD</span><span class="symbol">,</span><span class="string">"Description"</span><span class="symbol">,</span><span class="number">0</span><span class="symbol">,</span><span class="number">0</span><span class="symbol">,</span><span class="normal">MNID_SUBSETDESCRIPTION</span><span class="symbol">);</span>
<span class="normal">  subset_settings_menu</span><span class="symbol">-&gt;</span><span class="function">additem</span><span class="symbol">(</span><span class="normal">MN_HL</span><span class="symbol">,</span><span class="string">""</span><span class="symbol">,</span><span class="number">0</span><span class="symbol">,</span><span class="number">0</span><span class="symbol">);</span>
<span class="normal">  subset_settings_menu</span><span class="symbol">-&gt;</span><span class="function">additem</span><span class="symbol">(</span><span class="normal">MN_ACTION</span><span class="symbol">,</span><span class="string">"Save Changes"</span><span class="symbol">,</span><span class="number">0</span><span class="symbol">,</span><span class="number">0</span><span class="symbol">,</span><span class="normal">MNID_SUBSETSAVECHANGES</span><span class="symbol">);</span>
<span class="normal">  subset_settings_menu</span><span class="symbol">-&gt;</span><span class="function">additem</span><span class="symbol">(</span><span class="normal">MN_HL</span><span class="symbol">,</span><span class="string">""</span><span class="symbol">,</span><span class="number">0</span><span class="symbol">,</span><span class="number">0</span><span class="symbol">);</span>
<span class="normal">  subset_settings_menu</span><span class="symbol">-&gt;</span><span class="function">additem</span><span class="symbol">(</span><span class="normal">MN_BACK</span><span class="symbol">,</span><span class="string">"Back"</span><span class="symbol">,</span><span class="number">0</span><span class="symbol">,</span><span class="number">0</span><span class="symbol">);</span>

<span class="normal">  level_settings_menu</span><span class="symbol">-&gt;</span><span class="normal">arrange_left </span><span class="symbol">=</span><span class="normal"> </span><span class="keyword">true</span><span class="symbol">;</span>
<span class="normal">  level_settings_menu</span><span class="symbol">-&gt;</span><span class="function">additem</span><span class="symbol">(</span><span class="normal">MN_LABEL</span><span class="symbol">,</span><span class="string">"Level Settings"</span><span class="symbol">,</span><span class="number">0</span><span class="symbol">,</span><span class="number">0</span><span class="symbol">);</span>
<span class="normal">  level_settings_menu</span><span class="symbol">-&gt;</span><span class="function">additem</span><span class="symbol">(</span><span class="normal">MN_HL</span><span class="symbol">,</span><span class="string">""</span><span class="symbol">,</span><span class="number">0</span><span class="symbol">,</span><span class="number">0</span><span class="symbol">);</span>
<span class="normal">  level_settings_menu</span><span class="symbol">-&gt;</span><span class="function">additem</span><span class="symbol">(</span><span class="normal">MN_TEXTFIELD</span><span class="symbol">,</span><span class="normal">   </span><span class="string">"Name    "</span><span class="symbol">,</span><span class="number">0</span><span class="symbol">,</span><span class="number">0</span><span class="symbol">,</span><span class="normal">MNID_NAME</span><span class="symbol">);</span>
<span class="normal">  level_settings_menu</span><span class="symbol">-&gt;</span><span class="function">additem</span><span class="symbol">(</span><span class="normal">MN_TEXTFIELD</span><span class="symbol">,</span><span class="normal">   </span><span class="string">"Author  "</span><span class="symbol">,</span><span class="number">0</span><span class="symbol">,</span><span class="number">0</span><span class="symbol">,</span><span class="normal">MNID_AUTHOR</span><span class="symbol">);</span>
<span class="normal">  level_settings_menu</span><span class="symbol">-&gt;</span><span class="function">additem</span><span class="symbol">(</span><span class="normal">MN_STRINGSELECT</span><span class="symbol">,</span><span class="string">"Song    "</span><span class="symbol">,</span><span class="number">0</span><span class="symbol">,</span><span class="number">0</span><span class="symbol">,</span><span class="normal">MNID_SONG</span><span class="symbol">);</span>
<span class="normal">  level_settings_menu</span><span class="symbol">-&gt;</span><span class="function">additem</span><span class="symbol">(</span><span class="normal">MN_STRINGSELECT</span><span class="symbol">,</span><span class="string">"Bg-Image"</span><span class="symbol">,</span><span class="number">0</span><span class="symbol">,</span><span class="number">0</span><span class="symbol">,</span><span class="normal">MNID_BGIMG</span><span class="symbol">);</span>
<span class="normal">  level_settings_menu</span><span class="symbol">-&gt;</span><span class="function">additem</span><span class="symbol">(</span><span class="normal">MN_STRINGSELECT</span><span class="symbol">,</span><span class="string">"Particle"</span><span class="symbol">,</span><span class="number">0</span><span class="symbol">,</span><span class="number">0</span><span class="symbol">,</span><span class="normal">MNID_PARTICLE</span><span class="symbol">);</span>
<span class="normal">  level_settings_menu</span><span class="symbol">-&gt;</span><span class="function">additem</span><span class="symbol">(</span><span class="normal">MN_NUMFIELD</span><span class="symbol">,</span><span class="normal">    </span><span class="string">"Length  "</span><span class="symbol">,</span><span class="number">0</span><span class="symbol">,</span><span class="number">0</span><span class="symbol">,</span><span class="normal">MNID_LENGTH</span><span class="symbol">);</span>
<span class="normal">  level_settings_menu</span><span class="symbol">-&gt;</span><span class="function">additem</span><span class="symbol">(</span><span class="normal">MN_NUMFIELD</span><span class="symbol">,</span><span class="normal">    </span><span class="string">"Time    "</span><span class="symbol">,</span><span class="number">0</span><span class="symbol">,</span><span class="number">0</span><span class="symbol">,</span><span class="normal">MNID_TIME</span><span class="symbol">);</span>
<span class="normal">  level_settings_menu</span><span class="symbol">-&gt;</span><span class="function">additem</span><span class="symbol">(</span><span class="normal">MN_NUMFIELD</span><span class="symbol">,</span><span class="normal">    </span><span class="string">"Gravity "</span><span class="symbol">,</span><span class="number">0</span><span class="symbol">,</span><span class="number">0</span><span class="symbol">,</span><span class="normal">MNID_GRAVITY</span><span class="symbol">);</span>
<span class="normal">  level_settings_menu</span><span class="symbol">-&gt;</span><span class="function">additem</span><span class="symbol">(</span><span class="normal">MN_NUMFIELD</span><span class="symbol">,</span><span class="normal">    </span><span class="string">"Bg-Img-Speed"</span><span class="symbol">,</span><span class="number">0</span><span class="symbol">,</span><span class="number">0</span><span class="symbol">,</span><span class="normal">MNID_BGSPEED</span><span class="symbol">);</span>
<span class="normal">  level_settings_menu</span><span class="symbol">-&gt;</span><span class="function">additem</span><span class="symbol">(</span><span class="normal">MN_NUMFIELD</span><span class="symbol">,</span><span class="normal">    </span><span class="string">"Top Red     "</span><span class="symbol">,</span><span class="number">0</span><span class="symbol">,</span><span class="number">0</span><span class="symbol">,</span><span class="normal">MNID_TopRed</span><span class="symbol">);</span>
<span class="normal">  level_settings_menu</span><span class="symbol">-&gt;</span><span class="function">additem</span><span class="symbol">(</span><span class="normal">MN_NUMFIELD</span><span class="symbol">,</span><span class="normal">    </span><span class="string">"Top Green   "</span><span class="symbol">,</span><span class="number">0</span><span class="symbol">,</span><span class="number">0</span><span class="symbol">,</span><span class="normal">MNID_TopGreen</span><span class="symbol">);</span>
<span class="normal">  level_settings_menu</span><span class="symbol">-&gt;</span><span class="function">additem</span><span class="symbol">(</span><span class="normal">MN_NUMFIELD</span><span class="symbol">,</span><span class="normal">    </span><span class="string">"Top Blue    "</span><span class="symbol">,</span><span class="number">0</span><span class="symbol">,</span><span class="number">0</span><span class="symbol">,</span><span class="normal">MNID_TopBlue</span><span class="symbol">);</span>
<span class="normal">  level_settings_menu</span><span class="symbol">-&gt;</span><span class="function">additem</span><span class="symbol">(</span><span class="normal">MN_NUMFIELD</span><span class="symbol">,</span><span class="normal">    </span><span class="string">"Bottom Red  "</span><span class="symbol">,</span><span class="number">0</span><span class="symbol">,</span><span class="number">0</span><span class="symbol">,</span><span class="normal">MNID_BottomRed</span><span class="symbol">);</span>
<span class="normal">  level_settings_menu</span><span class="symbol">-&gt;</span><span class="function">additem</span><span class="symbol">(</span><span class="normal">MN_NUMFIELD</span><span class="symbol">,</span><span class="normal">    </span><span class="string">"Bottom Green"</span><span class="symbol">,</span><span class="number">0</span><span class="symbol">,</span><span class="number">0</span><span class="symbol">,</span><span class="normal">MNID_BottomGreen</span><span class="symbol">);</span>
<span class="normal">  level_settings_menu</span><span class="symbol">-&gt;</span><span class="function">additem</span><span class="symbol">(</span><span class="normal">MN_NUMFIELD</span><span class="symbol">,</span><span class="normal">    </span><span class="string">"Bottom Blue "</span><span class="symbol">,</span><span class="number">0</span><span class="symbol">,</span><span class="number">0</span><span class="symbol">,</span><span class="normal">MNID_BottomBlue</span><span class="symbol">);</span>
<span class="normal">  level_settings_menu</span><span class="symbol">-&gt;</span><span class="function">additem</span><span class="symbol">(</span><span class="normal">MN_HL</span><span class="symbol">,</span><span class="string">""</span><span class="symbol">,</span><span class="number">0</span><span class="symbol">,</span><span class="number">0</span><span class="symbol">);</span>
<span class="normal">  level_settings_menu</span><span class="symbol">-&gt;</span><span class="function">additem</span><span class="symbol">(</span><span class="normal">MN_ACTION</span><span class="symbol">,</span><span class="string">"Apply Changes"</span><span class="symbol">,</span><span class="number">0</span><span class="symbol">,</span><span class="number">0</span><span class="symbol">,</span><span class="normal">MNID_APPLY</span><span class="symbol">);</span>

<span class="normal">  select_tilegroup_menu</span><span class="symbol">-&gt;</span><span class="normal">arrange_left </span><span class="symbol">=</span><span class="normal"> </span><span class="keyword">true</span><span class="symbol">;</span>
<span class="normal">  select_tilegroup_menu</span><span class="symbol">-&gt;</span><span class="function">additem</span><span class="symbol">(</span><span class="normal">MN_LABEL</span><span class="symbol">,</span><span class="string">"Tilegroup"</span><span class="symbol">,</span><span class="number">0</span><span class="symbol">,</span><span class="number">0</span><span class="symbol">);</span>
<span class="normal">  select_tilegroup_menu</span><span class="symbol">-&gt;</span><span class="function">additem</span><span class="symbol">(</span><span class="normal">MN_HL</span><span class="symbol">,</span><span class="string">""</span><span class="symbol">,</span><span class="number">0</span><span class="symbol">,</span><span class="number">0</span><span class="symbol">);</span>
<span class="normal">  std</span><span class="symbol">::</span><span class="normal">set</span><span class="symbol">&lt;</span><span class="normal">TileGroup</span><span class="symbol">&gt;*</span><span class="normal"> tilegroups </span><span class="symbol">=</span><span class="normal"> TileManager</span><span class="symbol">::</span><span class="function">tilegroups</span><span class="symbol">();</span>
<span class="normal">  </span><span class="type">int</span><span class="normal"> tileid </span><span class="symbol">=</span><span class="normal"> </span><span class="number">1</span><span class="symbol">;</span>
<span class="normal">  </span><span class="keyword">for</span><span class="symbol">(</span><span class="normal">std</span><span class="symbol">::</span><span class="normal">set</span><span class="symbol">&lt;</span><span class="normal">TileGroup</span><span class="symbol">&gt;::</span><span class="usertype">iterator</span><span class="normal"> it </span><span class="symbol">=</span><span class="normal"> tilegroups</span><span class="symbol">-&gt;</span><span class="function">begin</span><span class="symbol">();</span>
<span class="normal">        it </span><span class="symbol">!=</span><span class="normal"> tilegroups</span><span class="symbol">-&gt;</span><span class="function">end</span><span class="symbol">();</span><span class="normal"> </span><span class="symbol">++</span><span class="normal">it </span><span class="symbol">)</span>
<span class="normal">    </span><span class="cbracket">{</span>
<span class="normal">      select_tilegroup_menu</span><span class="symbol">-&gt;</span><span class="function">additem</span><span class="symbol">(</span><span class="normal">MN_ACTION</span><span class="symbol">,</span><span class="normal"> it</span><span class="symbol">-&gt;</span><span class="normal">name</span><span class="symbol">,</span><span class="normal"> </span><span class="number">0</span><span class="symbol">,</span><span class="normal"> </span><span class="number">0</span><span class="symbol">,</span><span class="normal"> tileid</span><span class="symbol">);</span>
<span class="normal">      tileid</span><span class="symbol">++;</span>
<span class="normal">      tilegroups_map</span><span class="symbol">[(*</span><span class="normal">it</span><span class="symbol">).</span><span class="normal">name</span><span class="symbol">]</span><span class="normal"> </span><span class="symbol">=</span><span class="normal"> </span><span class="keyword">new</span><span class="normal"> </span><span class="function">ButtonPanel</span><span class="symbol">(</span><span class="normal">screen</span><span class="symbol">-&gt;</span><span class="normal">w </span><span class="symbol">-</span><span class="normal"> </span><span class="number">64</span><span class="symbol">,</span><span class="number">96</span><span class="symbol">,</span><span class="normal"> </span><span class="number">64</span><span class="symbol">,</span><span class="normal"> </span><span class="number">318</span><span class="symbol">);</span>
<span class="normal">      i </span><span class="symbol">=</span><span class="normal"> </span><span class="number">0</span><span class="symbol">;</span>

<span class="normal">      </span><span class="keyword">for</span><span class="symbol">(</span><span class="normal">std</span><span class="symbol">::</span><span class="normal">vector</span><span class="symbol">&lt;</span><span class="type">int</span><span class="symbol">&gt;::</span><span class="usertype">const_iterator</span><span class="normal"> sit </span><span class="symbol">=</span><span class="normal"> </span><span class="symbol">(*</span><span class="normal">it</span><span class="symbol">).</span><span class="normal">tiles</span><span class="symbol">.</span><span class="function">begin</span><span class="symbol">();</span>
<span class="normal">          sit </span><span class="symbol">!=</span><span class="normal"> </span><span class="symbol">(*</span><span class="normal">it</span><span class="symbol">).</span><span class="normal">tiles</span><span class="symbol">.</span><span class="function">end</span><span class="symbol">();</span><span class="normal"> </span><span class="symbol">++</span><span class="normal">sit</span><span class="symbol">,</span><span class="normal"> </span><span class="symbol">++</span><span class="normal">i</span><span class="symbol">)</span>
<span class="normal">      </span><span class="cbracket">{</span>
<span class="normal">        std</span><span class="symbol">::</span><span class="usertype">string</span><span class="normal"> imagefile </span><span class="symbol">=</span><span class="normal"> </span><span class="string">"/images/tilesets/"</span><span class="normal"> </span><span class="symbol">;</span>
<span class="normal">        </span><span class="type">bool</span><span class="normal"> only_editor_image </span><span class="symbol">=</span><span class="normal"> </span><span class="keyword">false</span><span class="symbol">;</span>
<span class="normal">        </span><span class="keyword">if</span><span class="symbol">(!</span><span class="normal">TileManager</span><span class="symbol">::</span><span class="function">instance</span><span class="symbol">()-&gt;</span><span class="function">get</span><span class="symbol">(*</span><span class="normal">sit</span><span class="symbol">)-&gt;</span><span class="normal">filenames</span><span class="symbol">.</span><span class="function">empty</span><span class="symbol">())</span>
<span class="normal">        </span><span class="cbracket">{</span>
<span class="normal">          imagefile </span><span class="symbol">+=</span><span class="normal"> TileManager</span><span class="symbol">::</span><span class="function">instance</span><span class="symbol">()-&gt;</span><span class="function">get</span><span class="symbol">(*</span><span class="normal">sit</span><span class="symbol">)-&gt;</span><span class="normal">filenames</span><span class="symbol">[</span><span class="number">0</span><span class="symbol">];</span>
<span class="normal">        </span><span class="cbracket">}</span>
<span class="normal">        </span><span class="keyword">else</span><span class="normal"> </span><span class="keyword">if</span><span class="symbol">(!</span><span class="normal">TileManager</span><span class="symbol">::</span><span class="function">instance</span><span class="symbol">()-&gt;</span><span class="function">get</span><span class="symbol">(*</span><span class="normal">sit</span><span class="symbol">)-&gt;</span><span class="normal">editor_filenames</span><span class="symbol">.</span><span class="function">empty</span><span class="symbol">())</span>
<span class="normal">        </span><span class="cbracket">{</span>
<span class="normal">          imagefile </span><span class="symbol">+=</span><span class="normal"> TileManager</span><span class="symbol">::</span><span class="function">instance</span><span class="symbol">()-&gt;</span><span class="function">get</span><span class="symbol">(*</span><span class="normal">sit</span><span class="symbol">)-&gt;</span><span class="normal">editor_filenames</span><span class="symbol">[</span><span class="number">0</span><span class="symbol">];</span>
<span class="normal">          only_editor_image </span><span class="symbol">=</span><span class="normal"> </span><span class="keyword">true</span><span class="symbol">;</span>
<span class="normal">        </span><span class="cbracket">}</span>
<span class="normal">        </span><span class="keyword">else</span>
<span class="normal">        </span><span class="cbracket">{</span>
<span class="normal">          imagefile </span><span class="symbol">+=</span><span class="normal"> </span><span class="string">"notile.png"</span><span class="symbol">;</span>
<span class="normal">        </span><span class="cbracket">}</span>
<span class="normal">        Button</span><span class="symbol">*</span><span class="normal"> button </span><span class="symbol">=</span><span class="normal"> </span><span class="keyword">new</span><span class="normal"> </span><span class="function">Button</span><span class="symbol">(</span><span class="normal">imagefile</span><span class="symbol">,</span><span class="normal"> it</span><span class="symbol">-&gt;</span><span class="normal">name</span><span class="symbol">,</span><span class="normal"> </span><span class="function">SDLKey</span><span class="symbol">(</span><span class="normal">SDLK_a </span><span class="symbol">+</span><span class="normal"> i</span><span class="symbol">),</span>
<span class="normal">                                    </span><span class="number">0</span><span class="symbol">,</span><span class="normal"> </span><span class="number">0</span><span class="symbol">,</span><span class="normal"> </span><span class="number">32</span><span class="symbol">,</span><span class="normal"> </span><span class="number">32</span><span class="symbol">);</span>
<span class="normal">        </span><span class="keyword">if</span><span class="symbol">(!</span><span class="normal">only_editor_image</span><span class="symbol">)</span>
<span class="normal">          </span><span class="keyword">if</span><span class="symbol">(!</span><span class="normal">TileManager</span><span class="symbol">::</span><span class="function">instance</span><span class="symbol">()-&gt;</span><span class="function">get</span><span class="symbol">(*</span><span class="normal">sit</span><span class="symbol">)-&gt;</span><span class="normal">editor_filenames</span><span class="symbol">.</span><span class="function">empty</span><span class="symbol">())</span>
<span class="normal">          </span><span class="cbracket">{</span>
<span class="normal">            imagefile </span><span class="symbol">=</span><span class="normal"> </span><span class="string">"/images/tilesets/"</span><span class="normal"> </span><span class="symbol">+</span><span class="normal"> TileManager</span><span class="symbol">::</span><span class="function">instance</span><span class="symbol">()-&gt;</span><span class="function">get</span><span class="symbol">(*</span><span class="normal">sit</span><span class="symbol">)-&gt;</span><span class="normal">editor_filenames</span><span class="symbol">[</span><span class="number">0</span><span class="symbol">];</span>
<span class="normal">            button</span><span class="symbol">-&gt;</span><span class="function">add_icon</span><span class="symbol">(</span><span class="normal">imagefile</span><span class="symbol">,</span><span class="number">32</span><span class="symbol">,</span><span class="number">32</span><span class="symbol">);</span>
<span class="normal">          </span><span class="cbracket">}</span>
<span class="normal">        tilegroups_map</span><span class="symbol">[</span><span class="normal">it</span><span class="symbol">-&gt;</span><span class="normal">name</span><span class="symbol">]-&gt;</span><span class="function">additem</span><span class="symbol">(</span><span class="normal">button</span><span class="symbol">,</span><span class="normal"> </span><span class="symbol">*</span><span class="normal">sit</span><span class="symbol">);</span>
<span class="normal">      </span><span class="cbracket">}</span>
<span class="normal">    </span><span class="cbracket">}</span>
<span class="normal">  select_tilegroup_menu</span><span class="symbol">-&gt;</span><span class="function">additem</span><span class="symbol">(</span><span class="normal">MN_HL</span><span class="symbol">,</span><span class="string">""</span><span class="symbol">,</span><span class="number">0</span><span class="symbol">,</span><span class="number">0</span><span class="symbol">);</span>

<span class="normal">  select_objects_menu</span><span class="symbol">-&gt;</span><span class="normal">arrange_left </span><span class="symbol">=</span><span class="normal"> </span><span class="keyword">true</span><span class="symbol">;</span>
<span class="normal">  select_objects_menu</span><span class="symbol">-&gt;</span><span class="function">additem</span><span class="symbol">(</span><span class="normal">MN_LABEL</span><span class="symbol">,</span><span class="string">"Objects"</span><span class="symbol">,</span><span class="number">0</span><span class="symbol">,</span><span class="number">0</span><span class="symbol">);</span>
<span class="normal">  select_objects_menu</span><span class="symbol">-&gt;</span><span class="function">additem</span><span class="symbol">(</span><span class="normal">MN_HL</span><span class="symbol">,</span><span class="string">""</span><span class="symbol">,</span><span class="number">0</span><span class="symbol">,</span><span class="number">0</span><span class="symbol">);</span>
<span class="normal">  select_objects_menu</span><span class="symbol">-&gt;</span><span class="function">additem</span><span class="symbol">(</span><span class="normal">MN_ACTION</span><span class="symbol">,</span><span class="string">"BadGuys"</span><span class="symbol">,</span><span class="number">0</span><span class="symbol">,</span><span class="number">0</span><span class="symbol">,</span><span class="number">1</span><span class="symbol">);</span>
<span class="normal">  objects_map</span><span class="symbol">[</span><span class="string">"BadGuys"</span><span class="symbol">]</span><span class="normal"> </span><span class="symbol">=</span><span class="normal"> </span><span class="keyword">new</span><span class="normal"> </span><span class="function">ButtonPanel</span><span class="symbol">(</span><span class="normal">screen</span><span class="symbol">-&gt;</span><span class="normal">w </span><span class="symbol">-</span><span class="normal"> </span><span class="number">64</span><span class="symbol">,</span><span class="number">96</span><span class="symbol">,</span><span class="normal"> </span><span class="number">64</span><span class="symbol">,</span><span class="normal"> </span><span class="number">318</span><span class="symbol">);</span>

<span class="normal">  </span><span class="keyword">for</span><span class="symbol">(</span><span class="type">int</span><span class="normal"> i </span><span class="symbol">=</span><span class="normal"> </span><span class="number">0</span><span class="symbol">;</span><span class="normal"> i </span><span class="symbol">&lt;</span><span class="normal"> NUM_BadGuyKinds</span><span class="symbol">;</span><span class="normal"> </span><span class="symbol">++</span><span class="normal">i</span><span class="symbol">)</span>
<span class="normal">  </span><span class="cbracket">{</span>
<span class="normal">    </span><span class="usertype">BadGuy</span><span class="normal"> </span><span class="function">bad_tmp</span><span class="symbol">(</span><span class="number">0</span><span class="symbol">,</span><span class="number">0</span><span class="symbol">,</span><span class="function">BadGuyKind</span><span class="symbol">(</span><span class="normal">i</span><span class="symbol">),</span><span class="keyword">false</span><span class="symbol">);</span>
<span class="normal">    objects_map</span><span class="symbol">[</span><span class="string">"BadGuys"</span><span class="symbol">]-&gt;</span><span class="function">additem</span><span class="symbol">(</span><span class="keyword">new</span><span class="normal"> </span><span class="function">Button</span><span class="symbol">(</span><span class="string">""</span><span class="symbol">,</span><span class="normal"> </span><span class="string">"BadGuy"</span><span class="symbol">,(</span><span class="normal">SDLKey</span><span class="symbol">)(</span><span class="normal">i</span><span class="symbol">+</span><span class="string">'a'</span><span class="symbol">),</span><span class="number">0</span><span class="symbol">,</span><span class="number">0</span><span class="symbol">,</span><span class="number">32</span><span class="symbol">,</span><span class="number">32</span><span class="symbol">),</span><span class="number">1000000</span><span class="symbol">+</span><span class="normal">i</span><span class="symbol">);</span>
<span class="normal">    objects_map</span><span class="symbol">[</span><span class="string">"BadGuys"</span><span class="symbol">]-&gt;</span><span class="function">manipulate_button</span><span class="symbol">(</span><span class="normal">i</span><span class="symbol">)-&gt;</span><span class="function">set_game_object</span><span class="symbol">(</span><span class="keyword">new</span><span class="normal"> </span><span class="function">BadGuy</span><span class="symbol">(</span><span class="normal">objects_map</span><span class="symbol">[</span><span class="string">"BadGuys"</span><span class="symbol">]-&gt;</span><span class="function">manipulate_button</span><span class="symbol">(</span><span class="normal">i</span><span class="symbol">)-&gt;</span><span class="function">get_pos</span><span class="symbol">().</span><span class="normal">x</span><span class="symbol">,</span><span class="normal">objects_map</span><span class="symbol">[</span><span class="string">"BadGuys"</span><span class="symbol">]-&gt;</span><span class="function">manipulate_button</span><span class="symbol">(</span><span class="normal">i</span><span class="symbol">)-&gt;</span><span class="function">get_pos</span><span class="symbol">().</span><span class="normal">y</span><span class="symbol">,</span><span class="function">BadGuyKind</span><span class="symbol">(</span><span class="normal">i</span><span class="symbol">),</span><span class="keyword">false</span><span class="symbol">));</span>
<span class="normal">  </span><span class="cbracket">}</span>

<span class="normal">  select_objects_menu</span><span class="symbol">-&gt;</span><span class="function">additem</span><span class="symbol">(</span><span class="normal">MN_HL</span><span class="symbol">,</span><span class="string">""</span><span class="symbol">,</span><span class="number">0</span><span class="symbol">,</span><span class="number">0</span><span class="symbol">);</span>

<span class="cbracket">}</span>

<span class="type">int</span><span class="normal"> </span><span class="function">le_init</span><span class="symbol">()</span>
<span class="cbracket">{</span>


<span class="normal">  level_subsets </span><span class="symbol">=</span><span class="normal"> </span><span class="function">dsubdirs</span><span class="symbol">(</span><span class="string">"/levels"</span><span class="symbol">,</span><span class="normal"> </span><span class="string">"level1.stl"</span><span class="symbol">);</span>
<span class="normal">  le_level_subset </span><span class="symbol">=</span><span class="normal"> </span><span class="keyword">new</span><span class="normal"> LevelSubset</span><span class="symbol">;</span>

<span class="normal">  le_world </span><span class="symbol">=</span><span class="normal"> NULL</span><span class="symbol">;</span>
<span class="normal">  selected_game_object </span><span class="symbol">=</span><span class="normal"> NULL</span><span class="symbol">;</span>

<span class="normal">  active_tm </span><span class="symbol">=</span><span class="normal"> TM_IA</span><span class="symbol">;</span>
<span class="normal">  le_show_grid </span><span class="symbol">=</span><span class="normal"> </span><span class="keyword">true</span><span class="symbol">;</span>
<span class="normal">  show_selections </span><span class="symbol">=</span><span class="normal"> </span><span class="keyword">true</span><span class="symbol">;</span>
<span class="normal">  scroll_x </span><span class="symbol">=</span><span class="normal"> </span><span class="number">0</span><span class="symbol">;</span>

<span class="normal">  fire </span><span class="symbol">=</span><span class="normal"> DOWN</span><span class="symbol">;</span>
<span class="normal">  done </span><span class="symbol">=</span><span class="normal"> </span><span class="number">0</span><span class="symbol">;</span>
<span class="normal">  le_frame </span><span class="symbol">=</span><span class="normal"> </span><span class="number">0</span><span class="symbol">;</span><span class="normal">	</span><span class="comment">/* support for frames in some tiles, like waves and bad guys */</span>
<span class="normal">  le_level_changed </span><span class="symbol">=</span><span class="normal"> </span><span class="keyword">false</span><span class="symbol">;</span>
<span class="normal">  le_help_shown </span><span class="symbol">=</span><span class="normal"> </span><span class="keyword">false</span><span class="symbol">;</span>

<span class="normal">  le_mouse_pressed</span><span class="symbol">[</span><span class="normal">LEFT</span><span class="symbol">]</span><span class="normal"> </span><span class="symbol">=</span><span class="normal"> </span><span class="keyword">false</span><span class="symbol">;</span>
<span class="normal">  le_mouse_pressed</span><span class="symbol">[</span><span class="normal">RIGHT</span><span class="symbol">]</span><span class="normal"> </span><span class="symbol">=</span><span class="normal"> </span><span class="keyword">false</span><span class="symbol">;</span>

<span class="normal">  le_mouse_clicked</span><span class="symbol">[</span><span class="normal">LEFT</span><span class="symbol">]</span><span class="normal"> </span><span class="symbol">=</span><span class="normal"> </span><span class="keyword">false</span><span class="symbol">;</span>
<span class="normal">  le_mouse_clicked</span><span class="symbol">[</span><span class="normal">RIGHT</span><span class="symbol">]</span><span class="normal"> </span><span class="symbol">=</span><span class="normal"> </span><span class="keyword">false</span><span class="symbol">;</span>

<span class="normal">  le_selection </span><span class="symbol">=</span><span class="normal"> </span><span class="keyword">new</span><span class="normal"> </span><span class="function">Surface</span><span class="symbol">(</span><span class="normal">datadir </span><span class="symbol">+</span><span class="normal"> </span><span class="string">"/images/icons/select.png"</span><span class="symbol">,</span><span class="normal"> USE_ALPHA</span><span class="symbol">);</span>

<span class="normal">  select_tilegroup_menu_effect</span><span class="symbol">.</span><span class="function">init</span><span class="symbol">(</span><span class="keyword">false</span><span class="symbol">);</span>
<span class="normal">  select_objects_menu_effect</span><span class="symbol">.</span><span class="function">init</span><span class="symbol">(</span><span class="keyword">false</span><span class="symbol">);</span>
<span class="normal">  display_level_info</span><span class="symbol">.</span><span class="function">init</span><span class="symbol">(</span><span class="keyword">false</span><span class="symbol">);</span>

<span class="normal">  </span><span class="comment">/* Load buttons */</span>
<span class="normal">  le_save_level_bt </span><span class="symbol">=</span><span class="normal"> </span><span class="keyword">new</span><span class="normal"> </span><span class="function">Button</span><span class="symbol">(</span><span class="string">"/images/icons/save.png"</span><span class="symbol">,</span><span class="string">"Save level"</span><span class="symbol">,</span><span class="normal"> SDLK_F6</span><span class="symbol">,</span><span class="normal">screen</span><span class="symbol">-&gt;</span><span class="normal">w</span><span class="symbol">-</span><span class="number">64</span><span class="symbol">,</span><span class="number">32</span><span class="symbol">);</span>
<span class="normal">  le_exit_bt </span><span class="symbol">=</span><span class="normal"> </span><span class="keyword">new</span><span class="normal"> </span><span class="function">Button</span><span class="symbol">(</span><span class="string">"/images/icons/exit.png"</span><span class="symbol">,</span><span class="string">"Exit"</span><span class="symbol">,</span><span class="normal"> SDLK_F10</span><span class="symbol">,</span><span class="normal">screen</span><span class="symbol">-&gt;</span><span class="normal">w</span><span class="symbol">-</span><span class="number">32</span><span class="symbol">,</span><span class="number">32</span><span class="symbol">);</span>
<span class="normal">  le_next_level_bt </span><span class="symbol">=</span><span class="normal"> </span><span class="keyword">new</span><span class="normal"> </span><span class="function">Button</span><span class="symbol">(</span><span class="string">"/images/icons/up.png"</span><span class="symbol">,</span><span class="string">"Next level"</span><span class="symbol">,</span><span class="normal"> SDLK_PAGEUP</span><span class="symbol">,</span><span class="normal">screen</span><span class="symbol">-&gt;</span><span class="normal">w</span><span class="symbol">-</span><span class="number">64</span><span class="symbol">,</span><span class="number">0</span><span class="symbol">);</span>
<span class="normal">  le_previous_level_bt </span><span class="symbol">=</span><span class="normal"> </span><span class="keyword">new</span><span class="normal"> </span><span class="function">Button</span><span class="symbol">(</span><span class="string">"/images/icons/down.png"</span><span class="symbol">,</span><span class="string">"Previous level"</span><span class="symbol">,</span><span class="normal">SDLK_PAGEDOWN</span><span class="symbol">,</span><span class="normal">screen</span><span class="symbol">-&gt;</span><span class="normal">w</span><span class="symbol">-</span><span class="number">32</span><span class="symbol">,</span><span class="number">0</span><span class="symbol">);</span>
<span class="normal">  le_rubber_bt </span><span class="symbol">=</span><span class="normal"> </span><span class="keyword">new</span><span class="normal"> </span><span class="function">Button</span><span class="symbol">(</span><span class="string">"/images/icons/rubber.png"</span><span class="symbol">,</span><span class="string">"Rubber"</span><span class="symbol">,</span><span class="normal">SDLK_DELETE</span><span class="symbol">,</span><span class="normal">screen</span><span class="symbol">-&gt;</span><span class="normal">w</span><span class="symbol">-</span><span class="number">32</span><span class="symbol">,</span><span class="number">48</span><span class="symbol">);</span>
<span class="normal">  le_select_mode_one_bt </span><span class="symbol">=</span><span class="normal"> </span><span class="keyword">new</span><span class="normal"> </span><span class="function">Button</span><span class="normal"> </span><span class="symbol">(</span><span class="string">"/images/icons/select-mode1.png"</span><span class="symbol">,</span><span class="string">"Select single tile"</span><span class="symbol">,</span><span class="normal">SDLK_F3</span><span class="symbol">,</span><span class="normal">screen</span><span class="symbol">-&gt;</span><span class="normal">w</span><span class="symbol">-</span><span class="number">64</span><span class="symbol">,</span><span class="number">48</span><span class="symbol">);</span>
<span class="normal">  le_select_mode_two_bt </span><span class="symbol">=</span><span class="normal"> </span><span class="keyword">new</span><span class="normal"> </span><span class="function">Button</span><span class="symbol">(</span><span class="string">"/images/icons/select-mode2.png"</span><span class="symbol">,</span><span class="string">"Select multiple tiles"</span><span class="symbol">,</span><span class="normal">SDLK_F3</span><span class="symbol">,</span><span class="normal">screen</span><span class="symbol">-&gt;</span><span class="normal">w</span><span class="symbol">-</span><span class="number">64</span><span class="symbol">,</span><span class="number">48</span><span class="symbol">);</span>
<span class="normal">  le_test_level_bt </span><span class="symbol">=</span><span class="normal"> </span><span class="keyword">new</span><span class="normal"> </span><span class="function">Button</span><span class="symbol">(</span><span class="string">"/images/icons/test-level.png"</span><span class="symbol">,</span><span class="string">"Test level"</span><span class="symbol">,</span><span class="normal">SDLK_F4</span><span class="symbol">,</span><span class="normal">screen</span><span class="symbol">-&gt;</span><span class="normal">w</span><span class="symbol">-</span><span class="number">64</span><span class="symbol">,</span><span class="normal">screen</span><span class="symbol">-&gt;</span><span class="normal">h </span><span class="symbol">-</span><span class="normal"> </span><span class="number">64</span><span class="symbol">);</span>
<span class="normal">  le_settings_bt </span><span class="symbol">=</span><span class="normal"> </span><span class="keyword">new</span><span class="normal"> </span><span class="function">Button</span><span class="symbol">(</span><span class="string">"/images/icons/settings.png"</span><span class="symbol">,</span><span class="string">"Level settings"</span><span class="symbol">,</span><span class="normal">SDLK_F5</span><span class="symbol">,</span><span class="normal">screen</span><span class="symbol">-&gt;</span><span class="normal">w</span><span class="symbol">-</span><span class="number">32</span><span class="symbol">,</span><span class="normal">screen</span><span class="symbol">-&gt;</span><span class="normal">h </span><span class="symbol">-</span><span class="normal"> </span><span class="number">64</span><span class="symbol">);</span>
<span class="normal">  le_move_left_bt </span><span class="symbol">=</span><span class="normal"> </span><span class="keyword">new</span><span class="normal"> </span><span class="function">Button</span><span class="symbol">(</span><span class="string">"/images/icons/left.png"</span><span class="symbol">,</span><span class="string">"Move left"</span><span class="symbol">,</span><span class="normal">SDLK_LEFT</span><span class="symbol">,</span><span class="number">0</span><span class="symbol">,</span><span class="number">0</span><span class="symbol">);</span>
<span class="normal">  le_move_right_bt </span><span class="symbol">=</span><span class="normal"> </span><span class="keyword">new</span><span class="normal"> </span><span class="function">Button</span><span class="symbol">(</span><span class="string">"/images/icons/right.png"</span><span class="symbol">,</span><span class="string">"Move right"</span><span class="symbol">,</span><span class="normal">SDLK_RIGHT</span><span class="symbol">,</span><span class="normal">screen</span><span class="symbol">-&gt;</span><span class="normal">w</span><span class="symbol">-</span><span class="number">80</span><span class="symbol">,</span><span class="number">0</span><span class="symbol">);</span>
<span class="normal">  le_tilegroup_bt </span><span class="symbol">=</span><span class="normal"> </span><span class="keyword">new</span><span class="normal"> </span><span class="function">Button</span><span class="symbol">(</span><span class="string">"/images/icons/tilegroup.png"</span><span class="symbol">,</span><span class="string">"Select Tilegroup"</span><span class="symbol">,</span><span class="normal"> SDLK_F7</span><span class="symbol">,</span><span class="normal">screen</span><span class="symbol">-&gt;</span><span class="normal">w</span><span class="symbol">-</span><span class="number">64</span><span class="symbol">,</span><span class="number">64</span><span class="symbol">);</span>
<span class="normal">  le_objects_bt </span><span class="symbol">=</span><span class="normal"> </span><span class="keyword">new</span><span class="normal"> </span><span class="function">Button</span><span class="symbol">(</span><span class="string">"/images/icons/objects.png"</span><span class="symbol">,</span><span class="string">"Select Objects"</span><span class="symbol">,</span><span class="normal"> SDLK_F8</span><span class="symbol">,</span><span class="normal">screen</span><span class="symbol">-&gt;</span><span class="normal">w</span><span class="symbol">-</span><span class="number">64</span><span class="symbol">,</span><span class="number">80</span><span class="symbol">);</span>
<span class="normal">  le_object_select_bt </span><span class="symbol">=</span><span class="normal"> </span><span class="keyword">new</span><span class="normal"> </span><span class="function">Button</span><span class="symbol">(</span><span class="string">"/images/icons/select-one.png"</span><span class="symbol">,</span><span class="string">"Select an Object"</span><span class="symbol">,</span><span class="normal"> SDLK_s</span><span class="symbol">,</span><span class="normal"> screen</span><span class="symbol">-&gt;</span><span class="normal">w </span><span class="symbol">-</span><span class="normal"> </span><span class="number">64</span><span class="symbol">,</span><span class="normal"> screen</span><span class="symbol">-&gt;</span><span class="normal">h</span><span class="symbol">-</span><span class="number">98</span><span class="symbol">);</span>
<span class="normal">  le_object_properties_bt </span><span class="symbol">=</span><span class="normal"> </span><span class="keyword">new</span><span class="normal"> </span><span class="function">Button</span><span class="symbol">(</span><span class="string">"/images/icons/properties.png"</span><span class="symbol">,</span><span class="string">"Edit object properties"</span><span class="symbol">,</span><span class="normal"> SDLK_p</span><span class="symbol">,</span><span class="normal"> screen</span><span class="symbol">-&gt;</span><span class="normal">w </span><span class="symbol">-</span><span class="normal"> </span><span class="number">32</span><span class="symbol">,</span><span class="normal"> screen</span><span class="symbol">-&gt;</span><span class="normal">h</span><span class="symbol">-</span><span class="number">98</span><span class="symbol">);</span>
<span class="normal">  le_object_properties_bt</span><span class="symbol">-&gt;</span><span class="function">set_active</span><span class="symbol">(</span><span class="keyword">false</span><span class="symbol">);</span>

<span class="normal">  mouse_select_object </span><span class="symbol">=</span><span class="normal"> </span><span class="keyword">new</span><span class="normal"> </span><span class="function">MouseCursor</span><span class="symbol">(</span><span class="normal">datadir </span><span class="symbol">+</span><span class="normal"> </span><span class="string">"/images/status/select-cursor.png"</span><span class="symbol">,</span><span class="number">1</span><span class="symbol">);</span>
<span class="normal">  mouse_select_object</span><span class="symbol">-&gt;</span><span class="function">set_mid</span><span class="symbol">(</span><span class="number">16</span><span class="symbol">,</span><span class="number">16</span><span class="symbol">);</span>

<span class="normal">  le_tilemap_panel </span><span class="symbol">=</span><span class="normal"> </span><span class="keyword">new</span><span class="normal"> </span><span class="function">ButtonPanel</span><span class="symbol">(</span><span class="normal">screen</span><span class="symbol">-&gt;</span><span class="normal">w</span><span class="symbol">-</span><span class="number">64</span><span class="symbol">,</span><span class="normal">screen</span><span class="symbol">-&gt;</span><span class="normal">h</span><span class="symbol">-</span><span class="number">32</span><span class="symbol">,</span><span class="number">32</span><span class="symbol">,</span><span class="number">32</span><span class="symbol">);</span>
<span class="normal">  le_tilemap_panel</span><span class="symbol">-&gt;</span><span class="function">set_button_size</span><span class="symbol">(</span><span class="number">32</span><span class="symbol">,</span><span class="number">10</span><span class="symbol">);</span>
<span class="normal">  le_tilemap_panel</span><span class="symbol">-&gt;</span><span class="function">additem</span><span class="symbol">(</span><span class="keyword">new</span><span class="normal"> </span><span class="function">Button</span><span class="symbol">(</span><span class="string">"/images/icons/bkgrd.png"</span><span class="symbol">,</span><span class="string">"Background"</span><span class="symbol">,</span><span class="normal">SDLK_b</span><span class="symbol">,</span><span class="number">0</span><span class="symbol">,</span><span class="number">0</span><span class="symbol">),</span><span class="normal">TM_BG</span><span class="symbol">);</span>
<span class="normal">  le_tilemap_panel</span><span class="symbol">-&gt;</span><span class="function">additem</span><span class="symbol">(</span><span class="keyword">new</span><span class="normal"> </span><span class="function">Button</span><span class="symbol">(</span><span class="string">"/images/icons/intact.png"</span><span class="symbol">,</span><span class="string">"Interactive"</span><span class="symbol">,</span><span class="normal">SDLK_i</span><span class="symbol">,</span><span class="number">0</span><span class="symbol">,</span><span class="number">0</span><span class="symbol">),</span><span class="normal">TM_IA</span><span class="symbol">);</span>
<span class="normal">  le_tilemap_panel</span><span class="symbol">-&gt;</span><span class="function">additem</span><span class="symbol">(</span><span class="keyword">new</span><span class="normal"> </span><span class="function">Button</span><span class="symbol">(</span><span class="string">"/images/icons/frgrd.png"</span><span class="symbol">,</span><span class="string">"Foreground"</span><span class="symbol">,</span><span class="normal">SDLK_f</span><span class="symbol">,</span><span class="number">0</span><span class="symbol">,</span><span class="number">0</span><span class="symbol">),</span><span class="normal">TM_FG</span><span class="symbol">);</span>
<span class="normal">  le_tilemap_panel</span><span class="symbol">-&gt;</span><span class="function">highlight_last</span><span class="symbol">(</span><span class="keyword">true</span><span class="symbol">);</span>
<span class="normal">  le_tilemap_panel</span><span class="symbol">-&gt;</span><span class="function">set_last_clicked</span><span class="symbol">(</span><span class="normal">TM_IA</span><span class="symbol">);</span>

<span class="normal">  le_current</span><span class="symbol">.</span><span class="function">Init</span><span class="symbol">();</span>

<span class="normal">  </span><span class="function">le_init_menus</span><span class="symbol">();</span>

<span class="normal">  </span><span class="function">SDL_EnableKeyRepeat</span><span class="symbol">(</span><span class="normal">SDL_DEFAULT_REPEAT_DELAY</span><span class="symbol">,</span><span class="normal"> SDL_DEFAULT_REPEAT_INTERVAL</span><span class="symbol">);</span>


<span class="normal">  </span><span class="keyword">return</span><span class="normal"> </span><span class="number">0</span><span class="symbol">;</span>
<span class="cbracket">}</span>

<span class="type">void</span><span class="normal"> </span><span class="function">update_level_settings_menu</span><span class="symbol">()</span>
<span class="cbracket">{</span>
<span class="normal">  </span><span class="type">char</span><span class="normal"> str</span><span class="symbol">[</span><span class="number">80</span><span class="symbol">];</span>
<span class="normal">  </span><span class="type">int</span><span class="normal"> i</span><span class="symbol">;</span>

<span class="normal">  level_settings_menu</span><span class="symbol">-&gt;</span><span class="function">get_item_by_id</span><span class="symbol">(</span><span class="normal">MNID_NAME</span><span class="symbol">).</span><span class="function">change_input</span><span class="symbol">(</span><span class="normal">le_world</span><span class="symbol">-&gt;</span><span class="function">get_level</span><span class="symbol">()-&gt;</span><span class="normal">name</span><span class="symbol">.</span><span class="function">c_str</span><span class="symbol">());</span>
<span class="normal">  level_settings_menu</span><span class="symbol">-&gt;</span><span class="function">get_item_by_id</span><span class="symbol">(</span><span class="normal">MNID_AUTHOR</span><span class="symbol">).</span><span class="function">change_input</span><span class="symbol">(</span><span class="normal">le_world</span><span class="symbol">-&gt;</span><span class="function">get_level</span><span class="symbol">()-&gt;</span><span class="normal">author</span><span class="symbol">.</span><span class="function">c_str</span><span class="symbol">());</span>

<span class="normal">  </span><span class="function">string_list_copy</span><span class="symbol">(</span><span class="normal">level_settings_menu</span><span class="symbol">-&gt;</span><span class="function">get_item_by_id</span><span class="symbol">(</span><span class="normal">MNID_SONG</span><span class="symbol">).</span><span class="normal">list</span><span class="symbol">,</span><span class="normal"> </span><span class="function">dfiles</span><span class="symbol">(</span><span class="string">"music/"</span><span class="symbol">,</span><span class="normal">NULL</span><span class="symbol">,</span><span class="normal"> </span><span class="string">"-fast"</span><span class="symbol">));</span>
<span class="normal">  </span><span class="function">string_list_copy</span><span class="symbol">(</span><span class="normal">level_settings_menu</span><span class="symbol">-&gt;</span><span class="function">get_item_by_id</span><span class="symbol">(</span><span class="normal">MNID_BGIMG</span><span class="symbol">).</span><span class="normal">list</span><span class="symbol">,</span><span class="normal"> </span><span class="function">dfiles</span><span class="symbol">(</span><span class="string">"images/background"</span><span class="symbol">,</span><span class="normal">NULL</span><span class="symbol">,</span><span class="normal"> NULL</span><span class="symbol">));</span>
<span class="normal">  </span><span class="function">string_list_add_item</span><span class="symbol">(</span><span class="normal">level_settings_menu</span><span class="symbol">-&gt;</span><span class="function">get_item_by_id</span><span class="symbol">(</span><span class="normal">MNID_BGIMG</span><span class="symbol">).</span><span class="normal">list</span><span class="symbol">,</span><span class="string">""</span><span class="symbol">);</span>
<span class="normal">  </span><span class="function">string_list_add_item</span><span class="symbol">(</span><span class="normal">level_settings_menu</span><span class="symbol">-&gt;</span><span class="function">get_item_by_id</span><span class="symbol">(</span><span class="normal">MNID_PARTICLE</span><span class="symbol">).</span><span class="normal">list</span><span class="symbol">,</span><span class="string">""</span><span class="symbol">);</span>
<span class="normal">  </span><span class="function">string_list_add_item</span><span class="symbol">(</span><span class="normal">level_settings_menu</span><span class="symbol">-&gt;</span><span class="function">get_item_by_id</span><span class="symbol">(</span><span class="normal">MNID_PARTICLE</span><span class="symbol">).</span><span class="normal">list</span><span class="symbol">,</span><span class="string">"snow"</span><span class="symbol">);</span>
<span class="normal">  </span><span class="function">string_list_add_item</span><span class="symbol">(</span><span class="normal">level_settings_menu</span><span class="symbol">-&gt;</span><span class="function">get_item_by_id</span><span class="symbol">(</span><span class="normal">MNID_PARTICLE</span><span class="symbol">).</span><span class="normal">list</span><span class="symbol">,</span><span class="string">"clouds"</span><span class="symbol">);</span>

<span class="normal">  </span><span class="keyword">if</span><span class="symbol">((</span><span class="normal">i </span><span class="symbol">=</span><span class="normal"> </span><span class="function">string_list_find</span><span class="symbol">(</span><span class="normal">level_settings_menu</span><span class="symbol">-&gt;</span><span class="function">get_item_by_id</span><span class="symbol">(</span><span class="normal">MNID_SONG</span><span class="symbol">).</span><span class="normal">list</span><span class="symbol">,</span><span class="normal">le_world</span><span class="symbol">-&gt;</span><span class="function">get_level</span><span class="symbol">()-&gt;</span><span class="normal">song_title</span><span class="symbol">.</span><span class="function">c_str</span><span class="symbol">()))</span><span class="normal"> </span><span class="symbol">!=</span><span class="normal"> </span><span class="symbol">-</span><span class="number">1</span><span class="symbol">)</span>
<span class="normal">    level_settings_menu</span><span class="symbol">-&gt;</span><span class="function">get_item_by_id</span><span class="symbol">(</span><span class="normal">MNID_SONG</span><span class="symbol">).</span><span class="normal">list</span><span class="symbol">-&gt;</span><span class="normal">active_item </span><span class="symbol">=</span><span class="normal"> i</span><span class="symbol">;</span>
<span class="normal">  </span><span class="keyword">if</span><span class="symbol">((</span><span class="normal">i </span><span class="symbol">=</span><span class="normal"> </span><span class="function">string_list_find</span><span class="symbol">(</span><span class="normal">level_settings_menu</span><span class="symbol">-&gt;</span><span class="function">get_item_by_id</span><span class="symbol">(</span><span class="normal">MNID_BGIMG</span><span class="symbol">).</span><span class="normal">list</span><span class="symbol">,</span><span class="normal">le_world</span><span class="symbol">-&gt;</span><span class="function">get_level</span><span class="symbol">()-&gt;</span><span class="normal">bkgd_image</span><span class="symbol">.</span><span class="function">c_str</span><span class="symbol">()))</span><span class="normal"> </span><span class="symbol">!=</span><span class="normal"> </span><span class="symbol">-</span><span class="number">1</span><span class="symbol">)</span>
<span class="normal">    level_settings_menu</span><span class="symbol">-&gt;</span><span class="function">get_item_by_id</span><span class="symbol">(</span><span class="normal">MNID_BGIMG</span><span class="symbol">).</span><span class="normal">list</span><span class="symbol">-&gt;</span><span class="normal">active_item </span><span class="symbol">=</span><span class="normal"> i</span><span class="symbol">;</span>
<span class="normal">  </span><span class="keyword">if</span><span class="symbol">((</span><span class="normal">i </span><span class="symbol">=</span><span class="normal"> </span><span class="function">string_list_find</span><span class="symbol">(</span><span class="normal">level_settings_menu</span><span class="symbol">-&gt;</span><span class="function">get_item_by_id</span><span class="symbol">(</span><span class="normal">MNID_PARTICLE</span><span class="symbol">).</span><span class="normal">list</span><span class="symbol">,</span><span class="normal">le_world</span><span class="symbol">-&gt;</span><span class="function">get_level</span><span class="symbol">()-&gt;</span><span class="normal">particle_system</span><span class="symbol">.</span><span class="function">c_str</span><span class="symbol">()))</span><span class="normal"> </span><span class="symbol">!=</span><span class="normal"> </span><span class="symbol">-</span><span class="number">1</span><span class="symbol">)</span>
<span class="normal">    level_settings_menu</span><span class="symbol">-&gt;</span><span class="function">get_item_by_id</span><span class="symbol">(</span><span class="normal">MNID_PARTICLE</span><span class="symbol">).</span><span class="normal">list</span><span class="symbol">-&gt;</span><span class="normal">active_item </span><span class="symbol">=</span><span class="normal"> i</span><span class="symbol">;</span>

<span class="normal">  </span><span class="function">sprintf</span><span class="symbol">(</span><span class="normal">str</span><span class="symbol">,</span><span class="string">"%d"</span><span class="symbol">,</span><span class="normal">le_world</span><span class="symbol">-&gt;</span><span class="function">get_level</span><span class="symbol">()-&gt;</span><span class="normal">width</span><span class="symbol">);</span>
<span class="normal">  level_settings_menu</span><span class="symbol">-&gt;</span><span class="function">get_item_by_id</span><span class="symbol">(</span><span class="normal">MNID_LENGTH</span><span class="symbol">).</span><span class="function">change_input</span><span class="symbol">(</span><span class="normal">str</span><span class="symbol">);</span>
<span class="normal">  </span><span class="function">sprintf</span><span class="symbol">(</span><span class="normal">str</span><span class="symbol">,</span><span class="string">"%d"</span><span class="symbol">,</span><span class="normal">le_world</span><span class="symbol">-&gt;</span><span class="function">get_level</span><span class="symbol">()-&gt;</span><span class="normal">time_left</span><span class="symbol">);</span>
<span class="normal">  level_settings_menu</span><span class="symbol">-&gt;</span><span class="function">get_item_by_id</span><span class="symbol">(</span><span class="normal">MNID_TIME</span><span class="symbol">).</span><span class="function">change_input</span><span class="symbol">(</span><span class="normal">str</span><span class="symbol">);</span>
<span class="normal">  </span><span class="function">sprintf</span><span class="symbol">(</span><span class="normal">str</span><span class="symbol">,</span><span class="string">"%2.0f"</span><span class="symbol">,</span><span class="normal">le_world</span><span class="symbol">-&gt;</span><span class="function">get_level</span><span class="symbol">()-&gt;</span><span class="normal">gravity</span><span class="symbol">);</span>
<span class="normal">  level_settings_menu</span><span class="symbol">-&gt;</span><span class="function">get_item_by_id</span><span class="symbol">(</span><span class="normal">MNID_GRAVITY</span><span class="symbol">).</span><span class="function">change_input</span><span class="symbol">(</span><span class="normal">str</span><span class="symbol">);</span>
<span class="normal">  </span><span class="function">sprintf</span><span class="symbol">(</span><span class="normal">str</span><span class="symbol">,</span><span class="string">"%d"</span><span class="symbol">,</span><span class="normal">le_world</span><span class="symbol">-&gt;</span><span class="function">get_level</span><span class="symbol">()-&gt;</span><span class="normal">bkgd_speed</span><span class="symbol">);</span>
<span class="normal">  level_settings_menu</span><span class="symbol">-&gt;</span><span class="function">get_item_by_id</span><span class="symbol">(</span><span class="normal">MNID_BGSPEED</span><span class="symbol">).</span><span class="function">change_input</span><span class="symbol">(</span><span class="normal">str</span><span class="symbol">);</span>
<span class="normal">  </span><span class="function">sprintf</span><span class="symbol">(</span><span class="normal">str</span><span class="symbol">,</span><span class="string">"%d"</span><span class="symbol">,</span><span class="normal">le_world</span><span class="symbol">-&gt;</span><span class="function">get_level</span><span class="symbol">()-&gt;</span><span class="normal">bkgd_top</span><span class="symbol">.</span><span class="normal">red</span><span class="symbol">);</span>
<span class="normal">  level_settings_menu</span><span class="symbol">-&gt;</span><span class="function">get_item_by_id</span><span class="symbol">(</span><span class="normal">MNID_TopRed</span><span class="symbol">).</span><span class="function">change_input</span><span class="symbol">(</span><span class="normal">str</span><span class="symbol">);</span>
<span class="normal">  </span><span class="function">sprintf</span><span class="symbol">(</span><span class="normal">str</span><span class="symbol">,</span><span class="string">"%d"</span><span class="symbol">,</span><span class="normal">le_world</span><span class="symbol">-&gt;</span><span class="function">get_level</span><span class="symbol">()-&gt;</span><span class="normal">bkgd_top</span><span class="symbol">.</span><span class="normal">green</span><span class="symbol">);</span>
<span class="normal">  level_settings_menu</span><span class="symbol">-&gt;</span><span class="function">get_item_by_id</span><span class="symbol">(</span><span class="normal">MNID_TopGreen</span><span class="symbol">).</span><span class="function">change_input</span><span class="symbol">(</span><span class="normal">str</span><span class="symbol">);</span>
<span class="normal">  </span><span class="function">sprintf</span><span class="symbol">(</span><span class="normal">str</span><span class="symbol">,</span><span class="string">"%d"</span><span class="symbol">,</span><span class="normal">le_world</span><span class="symbol">-&gt;</span><span class="function">get_level</span><span class="symbol">()-&gt;</span><span class="normal">bkgd_top</span><span class="symbol">.</span><span class="normal">blue</span><span class="symbol">);</span>
<span class="normal">  level_settings_menu</span><span class="symbol">-&gt;</span><span class="function">get_item_by_id</span><span class="symbol">(</span><span class="normal">MNID_TopBlue</span><span class="symbol">).</span><span class="function">change_input</span><span class="symbol">(</span><span class="normal">str</span><span class="symbol">);</span>
<span class="normal">  </span><span class="function">sprintf</span><span class="symbol">(</span><span class="normal">str</span><span class="symbol">,</span><span class="string">"%d"</span><span class="symbol">,</span><span class="normal">le_world</span><span class="symbol">-&gt;</span><span class="function">get_level</span><span class="symbol">()-&gt;</span><span class="normal">bkgd_bottom</span><span class="symbol">.</span><span class="normal">red</span><span class="symbol">);</span>
<span class="normal">  level_settings_menu</span><span class="symbol">-&gt;</span><span class="function">get_item_by_id</span><span class="symbol">(</span><span class="normal">MNID_BottomRed</span><span class="symbol">).</span><span class="function">change_input</span><span class="symbol">(</span><span class="normal">str</span><span class="symbol">);</span>
<span class="normal">  </span><span class="function">sprintf</span><span class="symbol">(</span><span class="normal">str</span><span class="symbol">,</span><span class="string">"%d"</span><span class="symbol">,</span><span class="normal">le_world</span><span class="symbol">-&gt;</span><span class="function">get_level</span><span class="symbol">()-&gt;</span><span class="normal">bkgd_bottom</span><span class="symbol">.</span><span class="normal">green</span><span class="symbol">);</span>
<span class="normal">  level_settings_menu</span><span class="symbol">-&gt;</span><span class="function">get_item_by_id</span><span class="symbol">(</span><span class="normal">MNID_BottomGreen</span><span class="symbol">).</span><span class="function">change_input</span><span class="symbol">(</span><span class="normal">str</span><span class="symbol">);</span>
<span class="normal">  </span><span class="function">sprintf</span><span class="symbol">(</span><span class="normal">str</span><span class="symbol">,</span><span class="string">"%d"</span><span class="symbol">,</span><span class="normal">le_world</span><span class="symbol">-&gt;</span><span class="function">get_level</span><span class="symbol">()-&gt;</span><span class="normal">bkgd_bottom</span><span class="symbol">.</span><span class="normal">blue</span><span class="symbol">);</span>
<span class="normal">  level_settings_menu</span><span class="symbol">-&gt;</span><span class="function">get_item_by_id</span><span class="symbol">(</span><span class="normal">MNID_BottomBlue</span><span class="symbol">).</span><span class="function">change_input</span><span class="symbol">(</span><span class="normal">str</span><span class="symbol">);</span>
<span class="cbracket">}</span>

<span class="type">void</span><span class="normal"> </span><span class="function">update_subset_settings_menu</span><span class="symbol">()</span>
<span class="cbracket">{</span>
<span class="normal">  subset_settings_menu</span><span class="symbol">-&gt;</span><span class="normal">item</span><span class="symbol">[</span><span class="number">2</span><span class="symbol">].</span><span class="function">change_input</span><span class="symbol">(</span><span class="normal">le_level_subset</span><span class="symbol">-&gt;</span><span class="normal">title</span><span class="symbol">.</span><span class="function">c_str</span><span class="symbol">());</span>
<span class="normal">  subset_settings_menu</span><span class="symbol">-&gt;</span><span class="normal">item</span><span class="symbol">[</span><span class="number">3</span><span class="symbol">].</span><span class="function">change_input</span><span class="symbol">(</span><span class="normal">le_level_subset</span><span class="symbol">-&gt;</span><span class="normal">description</span><span class="symbol">.</span><span class="function">c_str</span><span class="symbol">());</span>
<span class="cbracket">}</span>

<span class="type">void</span><span class="normal"> </span><span class="function">apply_level_settings_menu</span><span class="symbol">()</span>
<span class="cbracket">{</span>
<span class="normal">  </span><span class="type">int</span><span class="normal"> i</span><span class="symbol">;</span>
<span class="normal">  i </span><span class="symbol">=</span><span class="normal"> </span><span class="keyword">false</span><span class="symbol">;</span>

<span class="normal">  le_world</span><span class="symbol">-&gt;</span><span class="function">get_level</span><span class="symbol">()-&gt;</span><span class="normal">name </span><span class="symbol">=</span><span class="normal"> level_settings_menu</span><span class="symbol">-&gt;</span><span class="function">get_item_by_id</span><span class="symbol">(</span><span class="normal">MNID_NAME</span><span class="symbol">).</span><span class="normal">input</span><span class="symbol">;</span>
<span class="normal">  le_world</span><span class="symbol">-&gt;</span><span class="function">get_level</span><span class="symbol">()-&gt;</span><span class="normal">author </span><span class="symbol">=</span><span class="normal"> level_settings_menu</span><span class="symbol">-&gt;</span><span class="function">get_item_by_id</span><span class="symbol">(</span><span class="normal">MNID_AUTHOR</span><span class="symbol">).</span><span class="normal">input</span><span class="symbol">;</span>

<span class="normal">  </span><span class="keyword">if</span><span class="symbol">(</span><span class="normal">le_world</span><span class="symbol">-&gt;</span><span class="function">get_level</span><span class="symbol">()-&gt;</span><span class="normal">bkgd_image</span><span class="symbol">.</span><span class="function">compare</span><span class="symbol">(</span><span class="function">string_list_active</span><span class="symbol">(</span><span class="normal">level_settings_menu</span><span class="symbol">-&gt;</span><span class="function">get_item_by_id</span><span class="symbol">(</span><span class="normal">MNID_BGIMG</span><span class="symbol">).</span><span class="normal">list</span><span class="symbol">))</span><span class="normal"> </span><span class="symbol">!=</span><span class="normal"> </span><span class="number">0</span><span class="symbol">)</span>
<span class="normal">  </span><span class="cbracket">{</span>
<span class="normal">    le_world</span><span class="symbol">-&gt;</span><span class="function">get_level</span><span class="symbol">()-&gt;</span><span class="normal">bkgd_image </span><span class="symbol">=</span><span class="normal"> </span><span class="function">string_list_active</span><span class="symbol">(</span><span class="normal">level_settings_menu</span><span class="symbol">-&gt;</span><span class="function">get_item_by_id</span><span class="symbol">(</span><span class="normal">MNID_BGIMG</span><span class="symbol">).</span><span class="normal">list</span><span class="symbol">);</span>
<span class="normal">    i </span><span class="symbol">=</span><span class="normal"> </span><span class="keyword">true</span><span class="symbol">;</span>
<span class="normal">  </span><span class="cbracket">}</span>

<span class="normal">  </span><span class="keyword">if</span><span class="symbol">(</span><span class="normal">le_world</span><span class="symbol">-&gt;</span><span class="function">get_level</span><span class="symbol">()-&gt;</span><span class="normal">particle_system</span><span class="symbol">.</span><span class="function">compare</span><span class="symbol">(</span><span class="function">string_list_active</span><span class="symbol">(</span><span class="normal">level_settings_menu</span><span class="symbol">-&gt;</span><span class="function">get_item_by_id</span><span class="symbol">(</span><span class="normal">MNID_PARTICLE</span><span class="symbol">).</span><span class="normal">list</span><span class="symbol">))</span><span class="normal"> </span><span class="symbol">!=</span><span class="normal"> </span><span class="number">0</span><span class="symbol">)</span>
<span class="normal">  </span><span class="cbracket">{</span>
<span class="normal">    le_world</span><span class="symbol">-&gt;</span><span class="function">get_level</span><span class="symbol">()-&gt;</span><span class="normal">particle_system </span><span class="symbol">=</span><span class="normal"> </span><span class="function">string_list_active</span><span class="symbol">(</span><span class="normal">level_settings_menu</span><span class="symbol">-&gt;</span><span class="function">get_item_by_id</span><span class="symbol">(</span><span class="normal">MNID_PARTICLE</span><span class="symbol">).</span><span class="normal">list</span><span class="symbol">);</span>
<span class="normal">  </span><span class="cbracket">}</span>

<span class="normal">  </span><span class="keyword">if</span><span class="symbol">(</span><span class="normal">i</span><span class="symbol">)</span>
<span class="normal">  </span><span class="cbracket">{</span>
<span class="normal">    le_world</span><span class="symbol">-&gt;</span><span class="function">get_level</span><span class="symbol">()-&gt;</span><span class="function">load_gfx</span><span class="symbol">();</span>
<span class="normal">  </span><span class="cbracket">}</span>

<span class="normal">  le_world</span><span class="symbol">-&gt;</span><span class="function">get_level</span><span class="symbol">()-&gt;</span><span class="normal">song_title </span><span class="symbol">=</span><span class="normal"> </span><span class="function">string_list_active</span><span class="symbol">(</span><span class="normal">level_settings_menu</span><span class="symbol">-&gt;</span><span class="function">get_item_by_id</span><span class="symbol">(</span><span class="normal">MNID_SONG</span><span class="symbol">).</span><span class="normal">list</span><span class="symbol">);</span>

<span class="normal">  le_world</span><span class="symbol">-&gt;</span><span class="function">get_level</span><span class="symbol">()-&gt;</span><span class="function">change_size</span><span class="symbol">(</span><span class="function">atoi</span><span class="symbol">(</span><span class="normal">level_settings_menu</span><span class="symbol">-&gt;</span><span class="function">get_item_by_id</span><span class="symbol">(</span><span class="normal">MNID_LENGTH</span><span class="symbol">).</span><span class="normal">input</span><span class="symbol">));</span>
<span class="normal">  le_world</span><span class="symbol">-&gt;</span><span class="function">get_level</span><span class="symbol">()-&gt;</span><span class="normal">time_left </span><span class="symbol">=</span><span class="normal"> </span><span class="function">atoi</span><span class="symbol">(</span><span class="normal">level_settings_menu</span><span class="symbol">-&gt;</span><span class="function">get_item_by_id</span><span class="symbol">(</span><span class="normal">MNID_TIME</span><span class="symbol">).</span><span class="normal">input</span><span class="symbol">);</span>
<span class="normal">  le_world</span><span class="symbol">-&gt;</span><span class="function">get_level</span><span class="symbol">()-&gt;</span><span class="normal">gravity </span><span class="symbol">=</span><span class="normal"> </span><span class="function">atof</span><span class="symbol">(</span><span class="normal">level_settings_menu</span><span class="symbol">-&gt;</span><span class="function">get_item_by_id</span><span class="symbol">(</span><span class="normal">MNID_GRAVITY</span><span class="symbol">).</span><span class="normal">input</span><span class="symbol">);</span>
<span class="normal">  le_world</span><span class="symbol">-&gt;</span><span class="function">get_level</span><span class="symbol">()-&gt;</span><span class="normal">bkgd_speed </span><span class="symbol">=</span><span class="normal"> </span><span class="function">atoi</span><span class="symbol">(</span><span class="normal">level_settings_menu</span><span class="symbol">-&gt;</span><span class="function">get_item_by_id</span><span class="symbol">(</span><span class="normal">MNID_BGSPEED</span><span class="symbol">).</span><span class="normal">input</span><span class="symbol">);</span>
<span class="normal">  le_world</span><span class="symbol">-&gt;</span><span class="function">get_level</span><span class="symbol">()-&gt;</span><span class="normal">bkgd_top</span><span class="symbol">.</span><span class="normal">red </span><span class="symbol">=</span><span class="normal"> </span><span class="function">atoi</span><span class="symbol">(</span><span class="normal">level_settings_menu</span><span class="symbol">-&gt;</span><span class="function">get_item_by_id</span><span class="symbol">(</span><span class="normal">MNID_TopRed</span><span class="symbol">).</span><span class="normal">input</span><span class="symbol">);</span>
<span class="normal">  le_world</span><span class="symbol">-&gt;</span><span class="function">get_level</span><span class="symbol">()-&gt;</span><span class="normal">bkgd_top</span><span class="symbol">.</span><span class="normal">green </span><span class="symbol">=</span><span class="normal"> </span><span class="function">atoi</span><span class="symbol">(</span><span class="normal">level_settings_menu</span><span class="symbol">-&gt;</span><span class="function">get_item_by_id</span><span class="symbol">(</span><span class="normal">MNID_TopGreen</span><span class="symbol">).</span><span class="normal">input</span><span class="symbol">);</span>
<span class="normal">  le_world</span><span class="symbol">-&gt;</span><span class="function">get_level</span><span class="symbol">()-&gt;</span><span class="normal">bkgd_top</span><span class="symbol">.</span><span class="normal">blue </span><span class="symbol">=</span><span class="normal"> </span><span class="function">atoi</span><span class="symbol">(</span><span class="normal">level_settings_menu</span><span class="symbol">-&gt;</span><span class="function">get_item_by_id</span><span class="symbol">(</span><span class="normal">MNID_TopBlue</span><span class="symbol">).</span><span class="normal">input</span><span class="symbol">);</span>
<span class="normal">  le_world</span><span class="symbol">-&gt;</span><span class="function">get_level</span><span class="symbol">()-&gt;</span><span class="normal">bkgd_bottom</span><span class="symbol">.</span><span class="normal">red </span><span class="symbol">=</span><span class="normal"> </span><span class="function">atoi</span><span class="symbol">(</span><span class="normal">level_settings_menu</span><span class="symbol">-&gt;</span><span class="function">get_item_by_id</span><span class="symbol">(</span><span class="normal">MNID_BottomRed</span><span class="symbol">).</span><span class="normal">input</span><span class="symbol">);</span>
<span class="normal">  le_world</span><span class="symbol">-&gt;</span><span class="function">get_level</span><span class="symbol">()-&gt;</span><span class="normal">bkgd_bottom</span><span class="symbol">.</span><span class="normal">green </span><span class="symbol">=</span><span class="normal"> </span><span class="function">atoi</span><span class="symbol">(</span><span class="normal">level_settings_menu</span><span class="symbol">-&gt;</span><span class="function">get_item_by_id</span><span class="symbol">(</span><span class="normal">MNID_BottomGreen</span><span class="symbol">).</span><span class="normal">input</span><span class="symbol">);</span>
<span class="normal">  le_world</span><span class="symbol">-&gt;</span><span class="function">get_level</span><span class="symbol">()-&gt;</span><span class="normal">bkgd_bottom</span><span class="symbol">.</span><span class="normal">blue </span><span class="symbol">=</span><span class="normal"> </span><span class="function">atoi</span><span class="symbol">(</span><span class="normal">level_settings_menu</span><span class="symbol">-&gt;</span><span class="function">get_item_by_id</span><span class="symbol">(</span><span class="normal">MNID_BottomBlue</span><span class="symbol">).</span><span class="normal">input</span><span class="symbol">);</span>
<span class="cbracket">}</span>

<span class="type">void</span><span class="normal"> </span><span class="function">save_subset_settings_menu</span><span class="symbol">()</span>
<span class="cbracket">{</span>
<span class="normal">  le_level_subset</span><span class="symbol">-&gt;</span><span class="normal">title </span><span class="symbol">=</span><span class="normal"> subset_settings_menu</span><span class="symbol">-&gt;</span><span class="normal">item</span><span class="symbol">[</span><span class="number">2</span><span class="symbol">].</span><span class="normal">input</span><span class="symbol">;</span>
<span class="normal">  le_level_subset</span><span class="symbol">-&gt;</span><span class="normal">description </span><span class="symbol">=</span><span class="normal"> subset_settings_menu</span><span class="symbol">-&gt;</span><span class="normal">item</span><span class="symbol">[</span><span class="number">3</span><span class="symbol">].</span><span class="normal">input</span><span class="symbol">;</span>
<span class="normal">  le_level_subset</span><span class="symbol">-&gt;</span><span class="function">save</span><span class="symbol">();</span>
<span class="cbracket">}</span>

<span class="type">void</span><span class="normal"> </span><span class="function">le_unload_level</span><span class="symbol">()</span>
<span class="cbracket">{</span>
<span class="normal">  </span><span class="keyword">if</span><span class="symbol">(</span><span class="normal">le_level_changed</span><span class="symbol">)</span>
<span class="normal">  </span><span class="cbracket">{</span>
<span class="normal">    </span><span class="function">le_drawlevel</span><span class="symbol">();</span>
<span class="normal">    </span><span class="function">le_drawinterface</span><span class="symbol">();</span>
<span class="normal">    </span><span class="type">char</span><span class="normal"> str</span><span class="symbol">[</span><span class="number">1024</span><span class="symbol">];</span>
<span class="normal">    </span><span class="function">sprintf</span><span class="symbol">(</span><span class="normal">str</span><span class="symbol">,</span><span class="string">"Save changes to level %d of %s?"</span><span class="symbol">,</span><span class="normal">le_level</span><span class="symbol">,</span><span class="normal">le_level_subset</span><span class="symbol">-&gt;</span><span class="normal">name</span><span class="symbol">.</span><span class="function">c_str</span><span class="symbol">());</span>
<span class="normal">    </span><span class="keyword">if</span><span class="symbol">(</span><span class="function">confirm_dialog</span><span class="symbol">(</span><span class="normal">str</span><span class="symbol">))</span>
<span class="normal">    </span><span class="cbracket">{</span>
<span class="normal">      le_world</span><span class="symbol">-&gt;</span><span class="function">get_level</span><span class="symbol">()-&gt;</span><span class="function">save</span><span class="symbol">(</span><span class="normal">le_level_subset</span><span class="symbol">-&gt;</span><span class="normal">name</span><span class="symbol">.</span><span class="function">c_str</span><span class="symbol">(),</span><span class="normal">le_level</span><span class="symbol">);</span>
<span class="normal">    </span><span class="cbracket">}</span>
<span class="normal">  </span><span class="cbracket">}</span>

<span class="normal">  </span><span class="keyword">delete</span><span class="normal"> le_world</span><span class="symbol">;</span>
<span class="normal">  le_level_changed </span><span class="symbol">=</span><span class="normal"> </span><span class="keyword">false</span><span class="symbol">;</span>
<span class="cbracket">}</span>

<span class="type">void</span><span class="normal"> </span><span class="function">le_goto_level</span><span class="symbol">(</span><span class="type">int</span><span class="normal"> levelnb</span><span class="symbol">)</span>
<span class="cbracket">{</span>
<span class="normal">  </span><span class="function">le_unload_level</span><span class="symbol">();</span>
<span class="normal">  le_world </span><span class="symbol">=</span><span class="normal"> </span><span class="keyword">new</span><span class="normal"> </span><span class="function">World</span><span class="symbol">(</span><span class="normal">le_level_subset</span><span class="symbol">-&gt;</span><span class="normal">name</span><span class="symbol">,</span><span class="normal"> levelnb</span><span class="symbol">);</span>
<span class="normal">  display_level_info</span><span class="symbol">.</span><span class="function">start</span><span class="symbol">(</span><span class="number">2500</span><span class="symbol">);</span>
<span class="normal">  le_level </span><span class="symbol">=</span><span class="normal"> levelnb</span><span class="symbol">;</span>
<span class="cbracket">}</span>

<span class="type">void</span><span class="normal"> </span><span class="function">le_quit</span><span class="symbol">(</span><span class="type">void</span><span class="symbol">)</span>
<span class="cbracket">{</span>
<span class="normal">  </span><span class="function">SDL_EnableKeyRepeat</span><span class="symbol">(</span><span class="number">0</span><span class="symbol">,</span><span class="normal"> </span><span class="number">0</span><span class="symbol">);</span><span class="normal">    </span><span class="comment">// disables key repeating</span>

<span class="normal">  </span><span class="function">le_unload_level</span><span class="symbol">();</span>
<span class="normal">  </span><span class="keyword">delete</span><span class="normal"> le_selection</span><span class="symbol">;</span>
<span class="normal">  </span><span class="keyword">delete</span><span class="normal"> leveleditor_menu</span><span class="symbol">;</span>
<span class="normal">  </span><span class="keyword">delete</span><span class="normal"> subset_load_menu</span><span class="symbol">;</span>
<span class="normal">  </span><span class="keyword">delete</span><span class="normal"> subset_new_menu</span><span class="symbol">;</span>
<span class="normal">  </span><span class="keyword">delete</span><span class="normal"> subset_settings_menu</span><span class="symbol">;</span>
<span class="normal">  </span><span class="keyword">delete</span><span class="normal"> level_settings_menu</span><span class="symbol">;</span>
<span class="normal">  </span><span class="keyword">delete</span><span class="normal"> select_tilegroup_menu</span><span class="symbol">;</span>
<span class="normal">  </span><span class="keyword">delete</span><span class="normal"> select_objects_menu</span><span class="symbol">;</span>
<span class="normal">  </span><span class="keyword">delete</span><span class="normal"> le_save_level_bt</span><span class="symbol">;</span>
<span class="normal">  </span><span class="keyword">delete</span><span class="normal"> le_exit_bt</span><span class="symbol">;</span>
<span class="normal">  </span><span class="keyword">delete</span><span class="normal"> le_test_level_bt</span><span class="symbol">;</span>
<span class="normal">  </span><span class="keyword">delete</span><span class="normal"> le_next_level_bt</span><span class="symbol">;</span>
<span class="normal">  </span><span class="keyword">delete</span><span class="normal"> le_previous_level_bt</span><span class="symbol">;</span>
<span class="normal">  </span><span class="keyword">delete</span><span class="normal"> le_move_right_bt</span><span class="symbol">;</span>
<span class="normal">  </span><span class="keyword">delete</span><span class="normal"> le_move_left_bt</span><span class="symbol">;</span>
<span class="normal">  </span><span class="keyword">delete</span><span class="normal"> le_rubber_bt</span><span class="symbol">;</span>
<span class="normal">  </span><span class="keyword">delete</span><span class="normal"> le_select_mode_one_bt</span><span class="symbol">;</span>
<span class="normal">  </span><span class="keyword">delete</span><span class="normal"> le_select_mode_two_bt</span><span class="symbol">;</span>
<span class="normal">  </span><span class="keyword">delete</span><span class="normal"> le_settings_bt</span><span class="symbol">;</span>
<span class="normal">  </span><span class="keyword">delete</span><span class="normal"> le_tilegroup_bt</span><span class="symbol">;</span>
<span class="normal">  </span><span class="keyword">delete</span><span class="normal"> le_objects_bt</span><span class="symbol">;</span>
<span class="normal">  </span><span class="keyword">delete</span><span class="normal"> le_tilemap_panel</span><span class="symbol">;</span>
<span class="normal">  </span><span class="keyword">delete</span><span class="normal"> le_object_select_bt</span><span class="symbol">;</span>
<span class="normal">  </span><span class="keyword">delete</span><span class="normal"> le_object_properties_bt</span><span class="symbol">;</span>
<span class="normal">  </span><span class="keyword">delete</span><span class="normal"> mouse_select_object</span><span class="symbol">;</span>

<span class="normal">  </span><span class="keyword">delete</span><span class="normal"> le_level_subset</span><span class="symbol">;</span>
<span class="normal">  le_level_subset </span><span class="symbol">=</span><span class="normal"> </span><span class="number">0</span><span class="symbol">;</span>

<span class="normal">  </span><span class="keyword">for</span><span class="symbol">(</span><span class="normal">ButtonPanelMap</span><span class="symbol">::</span><span class="usertype">iterator</span><span class="normal"> i </span><span class="symbol">=</span><span class="normal"> tilegroups_map</span><span class="symbol">.</span><span class="function">begin</span><span class="symbol">();</span>
<span class="normal">      i </span><span class="symbol">!=</span><span class="normal"> tilegroups_map</span><span class="symbol">.</span><span class="function">end</span><span class="symbol">();</span><span class="normal"> </span><span class="symbol">++</span><span class="normal">i</span><span class="symbol">)</span>
<span class="normal">  </span><span class="cbracket">{</span>
<span class="normal">    </span><span class="keyword">delete</span><span class="normal"> i</span><span class="symbol">-&gt;</span><span class="normal">second</span><span class="symbol">;</span>
<span class="normal">  </span><span class="cbracket">}</span>
<span class="normal">  </span><span class="keyword">for</span><span class="symbol">(</span><span class="normal">ButtonPanelMap</span><span class="symbol">::</span><span class="usertype">iterator</span><span class="normal"> i </span><span class="symbol">=</span><span class="normal"> objects_map</span><span class="symbol">.</span><span class="function">begin</span><span class="symbol">();</span>
<span class="normal">      i </span><span class="symbol">!=</span><span class="normal"> objects_map</span><span class="symbol">.</span><span class="function">end</span><span class="symbol">();</span><span class="normal"> </span><span class="symbol">++</span><span class="normal">i</span><span class="symbol">)</span>
<span class="normal">  </span><span class="cbracket">{</span>
<span class="normal">    </span><span class="keyword">delete</span><span class="normal"> i</span><span class="symbol">-&gt;</span><span class="normal">second</span><span class="symbol">;</span>
<span class="normal">  </span><span class="cbracket">}</span>
<span class="cbracket">}</span>

<span class="type">void</span><span class="normal"> </span><span class="function">le_drawminimap</span><span class="symbol">()</span>
<span class="cbracket">{</span>
<span class="normal">  </span><span class="keyword">if</span><span class="symbol">(</span><span class="normal">le_world </span><span class="symbol">==</span><span class="normal"> NULL</span><span class="symbol">)</span>
<span class="normal">    </span><span class="keyword">return</span><span class="symbol">;</span>

<span class="normal">  </span><span class="type">int</span><span class="normal"> mini_tile_width</span><span class="symbol">;</span>
<span class="normal">  </span><span class="keyword">if</span><span class="symbol">(</span><span class="normal">screen</span><span class="symbol">-&gt;</span><span class="normal">w </span><span class="symbol">-</span><span class="normal"> </span><span class="number">64</span><span class="normal"> </span><span class="symbol">&gt;</span><span class="normal"> le_world</span><span class="symbol">-&gt;</span><span class="function">get_level</span><span class="symbol">()-&gt;</span><span class="normal">width </span><span class="symbol">*</span><span class="normal"> </span><span class="number">4</span><span class="symbol">)</span>
<span class="normal">    mini_tile_width </span><span class="symbol">=</span><span class="normal"> </span><span class="number">4</span><span class="symbol">;</span>
<span class="normal">  </span><span class="keyword">else</span><span class="normal"> </span><span class="keyword">if</span><span class="symbol">(</span><span class="normal">screen</span><span class="symbol">-&gt;</span><span class="normal">w </span><span class="symbol">-</span><span class="normal"> </span><span class="number">64</span><span class="normal"> </span><span class="symbol">&gt;</span><span class="normal"> le_world</span><span class="symbol">-&gt;</span><span class="function">get_level</span><span class="symbol">()-&gt;</span><span class="normal">width </span><span class="symbol">*</span><span class="normal"> </span><span class="number">2</span><span class="symbol">)</span>
<span class="normal">    mini_tile_width </span><span class="symbol">=</span><span class="normal"> </span><span class="number">2</span><span class="symbol">;</span>
<span class="normal">  </span><span class="keyword">else</span>
<span class="normal">    mini_tile_width </span><span class="symbol">=</span><span class="normal"> </span><span class="number">1</span><span class="symbol">;</span>
<span class="normal">  </span><span class="type">int</span><span class="normal"> left_offset </span><span class="symbol">=</span><span class="normal"> </span><span class="symbol">(</span><span class="normal">screen</span><span class="symbol">-&gt;</span><span class="normal">w </span><span class="symbol">-</span><span class="normal"> </span><span class="number">64</span><span class="normal"> </span><span class="symbol">-</span><span class="normal"> le_world</span><span class="symbol">-&gt;</span><span class="function">get_level</span><span class="symbol">()-&gt;</span><span class="normal">width</span><span class="symbol">*</span><span class="normal">mini_tile_width</span><span class="symbol">)</span><span class="normal"> </span><span class="symbol">/</span><span class="normal"> </span><span class="number">2</span><span class="symbol">;</span>

<span class="normal">  </span><span class="keyword">for</span><span class="normal"> </span><span class="symbol">(</span><span class="type">int</span><span class="normal"> y </span><span class="symbol">=</span><span class="normal"> </span><span class="number">0</span><span class="symbol">;</span><span class="normal"> y </span><span class="symbol">&lt;</span><span class="normal"> </span><span class="number">15</span><span class="symbol">;</span><span class="normal"> </span><span class="symbol">++</span><span class="normal">y</span><span class="symbol">)</span>
<span class="normal">    </span><span class="keyword">for</span><span class="normal"> </span><span class="symbol">(</span><span class="type">int</span><span class="normal"> x </span><span class="symbol">=</span><span class="normal"> </span><span class="number">0</span><span class="symbol">;</span><span class="normal"> x </span><span class="symbol">&lt;</span><span class="normal"> le_world</span><span class="symbol">-&gt;</span><span class="function">get_level</span><span class="symbol">()-&gt;</span><span class="normal">width</span><span class="symbol">;</span><span class="normal"> </span><span class="symbol">++</span><span class="normal">x</span><span class="symbol">)</span>
<span class="normal">    </span><span class="cbracket">{</span>

<span class="normal">      Tile</span><span class="symbol">::</span><span class="function">draw_stretched</span><span class="symbol">(</span><span class="normal">left_offset </span><span class="symbol">+</span><span class="normal"> mini_tile_width</span><span class="symbol">*</span><span class="normal">x</span><span class="symbol">,</span><span class="normal"> y </span><span class="symbol">*</span><span class="normal"> </span><span class="number">4</span><span class="symbol">,</span><span class="normal"> mini_tile_width </span><span class="symbol">,</span><span class="normal"> </span><span class="number">4</span><span class="symbol">,</span><span class="normal"> le_world</span><span class="symbol">-&gt;</span><span class="function">get_level</span><span class="symbol">()-&gt;</span><span class="normal">bg_tiles</span><span class="symbol">[</span><span class="normal">y</span><span class="symbol">][</span><span class="normal">x</span><span class="symbol">]);</span>

<span class="normal">      Tile</span><span class="symbol">::</span><span class="function">draw_stretched</span><span class="symbol">(</span><span class="normal">left_offset </span><span class="symbol">+</span><span class="normal"> mini_tile_width</span><span class="symbol">*</span><span class="normal">x</span><span class="symbol">,</span><span class="normal"> y </span><span class="symbol">*</span><span class="normal"> </span><span class="number">4</span><span class="symbol">,</span><span class="normal"> mini_tile_width </span><span class="symbol">,</span><span class="normal"> </span><span class="number">4</span><span class="symbol">,</span><span class="normal"> le_world</span><span class="symbol">-&gt;</span><span class="function">get_level</span><span class="symbol">()-&gt;</span><span class="normal">ia_tiles</span><span class="symbol">[</span><span class="normal">y</span><span class="symbol">][</span><span class="normal">x</span><span class="symbol">]);</span>

<span class="normal">      Tile</span><span class="symbol">::</span><span class="function">draw_stretched</span><span class="symbol">(</span><span class="normal">left_offset </span><span class="symbol">+</span><span class="normal"> mini_tile_width</span><span class="symbol">*</span><span class="normal">x</span><span class="symbol">,</span><span class="normal"> y </span><span class="symbol">*</span><span class="normal"> </span><span class="number">4</span><span class="symbol">,</span><span class="normal"> mini_tile_width </span><span class="symbol">,</span><span class="normal"> </span><span class="number">4</span><span class="symbol">,</span><span class="normal"> le_world</span><span class="symbol">-&gt;</span><span class="function">get_level</span><span class="symbol">()-&gt;</span><span class="normal">fg_tiles</span><span class="symbol">[</span><span class="normal">y</span><span class="symbol">][</span><span class="normal">x</span><span class="symbol">]);</span>

<span class="normal">    </span><span class="cbracket">}</span>

<span class="normal">  </span><span class="function">fillrect</span><span class="symbol">(</span><span class="normal">left_offset</span><span class="symbol">,</span><span class="normal"> </span><span class="number">0</span><span class="symbol">,</span><span class="normal"> le_world</span><span class="symbol">-&gt;</span><span class="function">get_level</span><span class="symbol">()-&gt;</span><span class="normal">width</span><span class="symbol">*</span><span class="normal">mini_tile_width</span><span class="symbol">,</span><span class="normal"> </span><span class="number">15</span><span class="symbol">*</span><span class="number">4</span><span class="symbol">,</span><span class="normal"> </span><span class="number">200</span><span class="symbol">,</span><span class="normal"> </span><span class="number">200</span><span class="symbol">,</span><span class="normal"> </span><span class="number">200</span><span class="symbol">,</span><span class="normal"> </span><span class="number">128</span><span class="symbol">);</span>

<span class="normal">  </span><span class="function">fillrect</span><span class="symbol">(</span><span class="normal">left_offset </span><span class="symbol">+</span><span class="normal"> </span><span class="symbol">(</span><span class="normal">pos_x</span><span class="symbol">/</span><span class="number">32</span><span class="symbol">)*</span><span class="normal">mini_tile_width</span><span class="symbol">,</span><span class="normal"> </span><span class="number">0</span><span class="symbol">,</span><span class="normal"> </span><span class="number">19</span><span class="symbol">*</span><span class="normal">mini_tile_width</span><span class="symbol">,</span><span class="normal"> </span><span class="number">1</span><span class="symbol">,</span><span class="normal"> </span><span class="number">255</span><span class="symbol">,</span><span class="normal"> </span><span class="number">255</span><span class="symbol">,</span><span class="normal"> </span><span class="number">255</span><span class="symbol">,</span><span class="normal"> </span><span class="number">255</span><span class="symbol">);</span>
<span class="normal">  </span><span class="function">fillrect</span><span class="symbol">(</span><span class="normal">left_offset </span><span class="symbol">+</span><span class="normal"> </span><span class="symbol">(</span><span class="normal">pos_x</span><span class="symbol">/</span><span class="number">32</span><span class="symbol">)*</span><span class="normal">mini_tile_width</span><span class="symbol">,</span><span class="normal"> </span><span class="number">0</span><span class="symbol">,</span><span class="normal"> </span><span class="number">1</span><span class="symbol">,</span><span class="normal"> </span><span class="number">15</span><span class="symbol">*</span><span class="number">4</span><span class="symbol">,</span><span class="normal"> </span><span class="number">255</span><span class="symbol">,</span><span class="normal"> </span><span class="number">255</span><span class="symbol">,</span><span class="normal"> </span><span class="number">255</span><span class="symbol">,</span><span class="normal"> </span><span class="number">255</span><span class="symbol">);</span>
<span class="normal">  </span><span class="function">fillrect</span><span class="symbol">(</span><span class="normal">left_offset </span><span class="symbol">+</span><span class="normal"> </span><span class="symbol">(</span><span class="normal">pos_x</span><span class="symbol">/</span><span class="number">32</span><span class="symbol">)*</span><span class="normal">mini_tile_width </span><span class="symbol">+</span><span class="normal"> </span><span class="number">19</span><span class="symbol">*</span><span class="normal">mini_tile_width</span><span class="symbol">,</span><span class="normal"> </span><span class="number">0</span><span class="symbol">,</span><span class="normal"> </span><span class="number">1</span><span class="symbol">,</span><span class="normal"> </span><span class="number">15</span><span class="symbol">*</span><span class="number">4</span><span class="symbol">,</span><span class="normal"> </span><span class="number">255</span><span class="symbol">,</span><span class="normal"> </span><span class="number">255</span><span class="symbol">,</span><span class="normal"> </span><span class="number">255</span><span class="symbol">,</span><span class="normal"> </span><span class="number">255</span><span class="symbol">);</span>
<span class="normal">  </span><span class="function">fillrect</span><span class="symbol">(</span><span class="normal">left_offset </span><span class="symbol">+</span><span class="normal"> </span><span class="symbol">(</span><span class="normal">pos_x</span><span class="symbol">/</span><span class="number">32</span><span class="symbol">)*</span><span class="normal">mini_tile_width</span><span class="symbol">,</span><span class="normal"> </span><span class="number">15</span><span class="symbol">*</span><span class="number">4</span><span class="symbol">-</span><span class="number">2</span><span class="symbol">,</span><span class="normal"> </span><span class="number">19</span><span class="symbol">*</span><span class="normal">mini_tile_width</span><span class="symbol">,</span><span class="normal"> </span><span class="number">1</span><span class="symbol">,</span><span class="normal"> </span><span class="number">255</span><span class="symbol">,</span><span class="normal"> </span><span class="number">255</span><span class="symbol">,</span><span class="normal"> </span><span class="number">255</span><span class="symbol">,</span><span class="normal"> </span><span class="number">255</span><span class="symbol">);</span>

<span class="cbracket">}</span>

<span class="type">void</span><span class="normal"> </span><span class="function">le_drawinterface</span><span class="symbol">()</span>
<span class="cbracket">{</span>
<span class="normal">  </span><span class="type">int</span><span class="normal"> x</span><span class="symbol">,</span><span class="normal">y</span><span class="symbol">;</span>
<span class="normal">  </span><span class="type">char</span><span class="normal"> str</span><span class="symbol">[</span><span class="number">80</span><span class="symbol">];</span>

<span class="normal">  </span><span class="keyword">if</span><span class="symbol">(</span><span class="normal">le_world </span><span class="symbol">!=</span><span class="normal"> NULL</span><span class="symbol">)</span>
<span class="normal">  </span><span class="cbracket">{</span>
<span class="normal">    </span><span class="comment">/* draw a grid (if selected) */</span>
<span class="normal">    </span><span class="keyword">if</span><span class="symbol">(</span><span class="normal">le_show_grid</span><span class="symbol">)</span>
<span class="normal">    </span><span class="cbracket">{</span>
<span class="normal">      </span><span class="keyword">for</span><span class="symbol">(</span><span class="normal">x </span><span class="symbol">=</span><span class="normal"> </span><span class="number">0</span><span class="symbol">;</span><span class="normal"> x </span><span class="symbol">&lt;</span><span class="normal"> </span><span class="number">19</span><span class="symbol">;</span><span class="normal"> x</span><span class="symbol">++)</span>
<span class="normal">        </span><span class="function">fillrect</span><span class="symbol">(</span><span class="normal">x</span><span class="symbol">*</span><span class="number">32</span><span class="normal"> </span><span class="symbol">-</span><span class="normal"> </span><span class="symbol">((</span><span class="type">int</span><span class="symbol">)</span><span class="normal">pos_x </span><span class="symbol">%</span><span class="normal"> </span><span class="number">32</span><span class="symbol">),</span><span class="normal"> </span><span class="number">0</span><span class="symbol">,</span><span class="normal"> </span><span class="number">1</span><span class="symbol">,</span><span class="normal"> screen</span><span class="symbol">-&gt;</span><span class="normal">h</span><span class="symbol">,</span><span class="normal"> </span><span class="number">225</span><span class="symbol">,</span><span class="normal"> </span><span class="number">225</span><span class="symbol">,</span><span class="normal"> </span><span class="number">225</span><span class="symbol">,</span><span class="number">255</span><span class="symbol">);</span>
<span class="normal">      </span><span class="keyword">for</span><span class="symbol">(</span><span class="normal">y </span><span class="symbol">=</span><span class="normal"> </span><span class="number">0</span><span class="symbol">;</span><span class="normal"> y </span><span class="symbol">&lt;</span><span class="normal"> </span><span class="number">15</span><span class="symbol">;</span><span class="normal"> y</span><span class="symbol">++)</span>
<span class="normal">        </span><span class="function">fillrect</span><span class="symbol">(</span><span class="number">0</span><span class="symbol">,</span><span class="normal"> y</span><span class="symbol">*</span><span class="number">32</span><span class="symbol">,</span><span class="normal"> screen</span><span class="symbol">-&gt;</span><span class="normal">w </span><span class="symbol">-</span><span class="normal"> </span><span class="number">32</span><span class="symbol">,</span><span class="normal"> </span><span class="number">1</span><span class="symbol">,</span><span class="normal"> </span><span class="number">225</span><span class="symbol">,</span><span class="normal"> </span><span class="number">225</span><span class="symbol">,</span><span class="normal"> </span><span class="number">225</span><span class="symbol">,</span><span class="number">255</span><span class="symbol">);</span>
<span class="normal">    </span><span class="cbracket">}</span>
<span class="normal">  </span><span class="cbracket">}</span>

<span class="normal">  </span><span class="keyword">if</span><span class="symbol">(</span><span class="normal">show_minimap</span><span class="symbol">)</span>
<span class="normal">    </span><span class="function">le_drawminimap</span><span class="symbol">();</span>

<span class="normal">  </span><span class="keyword">if</span><span class="symbol">(</span><span class="normal">show_selections </span><span class="symbol">&amp;&amp;</span><span class="normal"> MouseCursor</span><span class="symbol">::</span><span class="function">current</span><span class="symbol">()</span><span class="normal"> </span><span class="symbol">!=</span><span class="normal"> mouse_select_object</span><span class="symbol">)</span>
<span class="normal">  </span><span class="cbracket">{</span>
<span class="normal">    </span><span class="keyword">if</span><span class="symbol">(</span><span class="normal">le_selection_mode </span><span class="symbol">==</span><span class="normal"> SM_CURSOR</span><span class="symbol">)</span>
<span class="normal">    </span><span class="cbracket">{</span>
<span class="normal">      </span><span class="keyword">if</span><span class="symbol">(</span><span class="normal">le_current</span><span class="symbol">.</span><span class="function">IsTile</span><span class="symbol">())</span>
<span class="normal">        le_selection</span><span class="symbol">-&gt;</span><span class="function">draw</span><span class="symbol">(</span><span class="normal"> cursor_x </span><span class="symbol">-</span><span class="normal"> pos_x</span><span class="symbol">,</span><span class="normal"> cursor_y</span><span class="symbol">);</span>
<span class="normal">    </span><span class="cbracket">}</span>
<span class="normal">    </span><span class="keyword">else</span><span class="normal"> </span><span class="keyword">if</span><span class="symbol">(</span><span class="normal">le_selection_mode </span><span class="symbol">==</span><span class="normal"> SM_SQUARE</span><span class="symbol">)</span>
<span class="normal">    </span><span class="cbracket">{</span>
<span class="normal">      </span><span class="type">int</span><span class="normal"> w</span><span class="symbol">,</span><span class="normal"> h</span><span class="symbol">;</span>
<span class="normal">      </span><span class="function">le_highlight_selection</span><span class="symbol">();</span>
<span class="normal">      </span><span class="comment">/* draw current selection */</span>
<span class="normal">      w </span><span class="symbol">=</span><span class="normal"> selection</span><span class="symbol">.</span><span class="normal">x2 </span><span class="symbol">-</span><span class="normal"> selection</span><span class="symbol">.</span><span class="normal">x1</span><span class="symbol">;</span>
<span class="normal">      h </span><span class="symbol">=</span><span class="normal"> selection</span><span class="symbol">.</span><span class="normal">y2 </span><span class="symbol">-</span><span class="normal"> selection</span><span class="symbol">.</span><span class="normal">y1</span><span class="symbol">;</span>
<span class="normal">      </span><span class="function">fillrect</span><span class="symbol">(</span><span class="normal">selection</span><span class="symbol">.</span><span class="normal">x1 </span><span class="symbol">-</span><span class="normal"> pos_x</span><span class="symbol">,</span><span class="normal"> selection</span><span class="symbol">.</span><span class="normal">y1</span><span class="symbol">,</span><span class="normal"> w</span><span class="symbol">,</span><span class="normal"> SELECT_W</span><span class="symbol">,</span><span class="normal"> SELECT_CLR</span><span class="symbol">);</span>
<span class="normal">      </span><span class="function">fillrect</span><span class="symbol">(</span><span class="normal">selection</span><span class="symbol">.</span><span class="normal">x1 </span><span class="symbol">-</span><span class="normal"> pos_x </span><span class="symbol">+</span><span class="normal"> w</span><span class="symbol">,</span><span class="normal"> selection</span><span class="symbol">.</span><span class="normal">y1</span><span class="symbol">,</span><span class="normal"> SELECT_W</span><span class="symbol">,</span><span class="normal"> h</span><span class="symbol">,</span><span class="normal"> SELECT_CLR</span><span class="symbol">);</span>
<span class="normal">      </span><span class="function">fillrect</span><span class="symbol">(</span><span class="normal">selection</span><span class="symbol">.</span><span class="normal">x1 </span><span class="symbol">-</span><span class="normal"> pos_x</span><span class="symbol">,</span><span class="normal"> selection</span><span class="symbol">.</span><span class="normal">y1 </span><span class="symbol">+</span><span class="normal"> h</span><span class="symbol">,</span><span class="normal"> w</span><span class="symbol">,</span><span class="normal"> SELECT_W</span><span class="symbol">,</span><span class="normal"> SELECT_CLR</span><span class="symbol">);</span>
<span class="normal">      </span><span class="function">fillrect</span><span class="symbol">(</span><span class="normal">selection</span><span class="symbol">.</span><span class="normal">x1 </span><span class="symbol">-</span><span class="normal"> pos_x</span><span class="symbol">,</span><span class="normal"> selection</span><span class="symbol">.</span><span class="normal">y1</span><span class="symbol">,</span><span class="normal"> SELECT_W</span><span class="symbol">,</span><span class="normal"> h</span><span class="symbol">,</span><span class="normal"> SELECT_CLR</span><span class="symbol">);</span>
<span class="normal">    </span><span class="cbracket">}</span>
<span class="normal">  </span><span class="cbracket">}</span>


<span class="normal">  </span><span class="comment">/* draw button bar */</span>
<span class="normal">  </span><span class="function">fillrect</span><span class="symbol">(</span><span class="normal">screen</span><span class="symbol">-&gt;</span><span class="normal">w </span><span class="symbol">-</span><span class="normal"> </span><span class="number">64</span><span class="symbol">,</span><span class="normal"> </span><span class="number">0</span><span class="symbol">,</span><span class="normal"> </span><span class="number">64</span><span class="symbol">,</span><span class="normal"> screen</span><span class="symbol">-&gt;</span><span class="normal">h</span><span class="symbol">,</span><span class="normal"> </span><span class="number">50</span><span class="symbol">,</span><span class="normal"> </span><span class="number">50</span><span class="symbol">,</span><span class="normal"> </span><span class="number">50</span><span class="symbol">,</span><span class="number">255</span><span class="symbol">);</span>

<span class="normal">  </span><span class="keyword">if</span><span class="symbol">(</span><span class="normal">le_current</span><span class="symbol">.</span><span class="function">IsTile</span><span class="symbol">())</span>
<span class="normal">  </span><span class="cbracket">{</span>
<span class="normal">    Tile</span><span class="symbol">::</span><span class="function">draw</span><span class="symbol">(</span><span class="number">19</span><span class="normal"> </span><span class="symbol">*</span><span class="normal"> </span><span class="number">32</span><span class="symbol">,</span><span class="normal"> </span><span class="number">14</span><span class="normal"> </span><span class="symbol">*</span><span class="normal"> </span><span class="number">32</span><span class="symbol">,</span><span class="normal"> le_current</span><span class="symbol">.</span><span class="normal">tile</span><span class="symbol">);</span>
<span class="normal">    </span><span class="keyword">if</span><span class="symbol">(</span><span class="normal">TileManager</span><span class="symbol">::</span><span class="function">instance</span><span class="symbol">()-&gt;</span><span class="function">get</span><span class="symbol">(</span><span class="normal">le_current</span><span class="symbol">.</span><span class="normal">tile</span><span class="symbol">)-&gt;</span><span class="normal">editor_images</span><span class="symbol">.</span><span class="function">size</span><span class="symbol">()</span><span class="normal"> </span><span class="symbol">&gt;</span><span class="normal"> </span><span class="number">0</span><span class="symbol">)</span>
<span class="normal">      TileManager</span><span class="symbol">::</span><span class="function">instance</span><span class="symbol">()-&gt;</span><span class="function">get</span><span class="symbol">(</span><span class="normal">le_current</span><span class="symbol">.</span><span class="normal">tile</span><span class="symbol">)-&gt;</span><span class="normal">editor_images</span><span class="symbol">[</span><span class="number">0</span><span class="symbol">]-&gt;</span><span class="function">draw</span><span class="symbol">(</span><span class="normal"> </span><span class="number">19</span><span class="normal"> </span><span class="symbol">*</span><span class="normal"> </span><span class="number">32</span><span class="symbol">,</span><span class="normal"> </span><span class="number">14</span><span class="normal"> </span><span class="symbol">*</span><span class="normal"> </span><span class="number">32</span><span class="symbol">);</span>
<span class="normal">  </span><span class="cbracket">}</span>
<span class="normal">  </span><span class="keyword">if</span><span class="symbol">(</span><span class="normal">le_current</span><span class="symbol">.</span><span class="function">IsObject</span><span class="symbol">()</span><span class="normal"> </span><span class="symbol">&amp;&amp;</span><span class="normal"> MouseCursor</span><span class="symbol">::</span><span class="function">current</span><span class="symbol">()</span><span class="normal"> </span><span class="symbol">!=</span><span class="normal"> mouse_select_object</span><span class="symbol">)</span>
<span class="normal">  </span><span class="cbracket">{</span>
<span class="normal">    le_current</span><span class="symbol">.</span><span class="normal">obj</span><span class="symbol">-&gt;</span><span class="function">draw_on_screen</span><span class="symbol">(</span><span class="number">19</span><span class="normal"> </span><span class="symbol">*</span><span class="normal"> </span><span class="number">32</span><span class="symbol">,</span><span class="normal"> </span><span class="number">14</span><span class="normal"> </span><span class="symbol">*</span><span class="normal"> </span><span class="number">32</span><span class="symbol">);</span>
<span class="normal">    le_current</span><span class="symbol">.</span><span class="normal">obj</span><span class="symbol">-&gt;</span><span class="function">draw_on_screen</span><span class="symbol">(</span><span class="normal">cursor_x</span><span class="symbol">,</span><span class="normal">cursor_y</span><span class="symbol">);</span>
<span class="normal">  </span><span class="cbracket">}</span>

<span class="normal">  </span><span class="keyword">if</span><span class="symbol">(</span><span class="normal">mouse_select_object </span><span class="symbol">&amp;&amp;</span><span class="normal"> selected_game_object </span><span class="symbol">!=</span><span class="normal"> NULL</span><span class="symbol">)</span>
<span class="normal">  </span><span class="cbracket">{</span>
<span class="normal">    </span><span class="function">fillrect</span><span class="symbol">(</span><span class="normal">selected_game_object</span><span class="symbol">-&gt;</span><span class="normal">base</span><span class="symbol">.</span><span class="normal">x</span><span class="symbol">-</span><span class="normal">pos_x</span><span class="symbol">,</span><span class="normal">selected_game_object</span><span class="symbol">-&gt;</span><span class="normal">base</span><span class="symbol">.</span><span class="normal">y</span><span class="symbol">,</span><span class="normal">selected_game_object</span><span class="symbol">-&gt;</span><span class="normal">base</span><span class="symbol">.</span><span class="normal">width</span><span class="symbol">,</span><span class="number">3</span><span class="symbol">,</span><span class="number">255</span><span class="symbol">,</span><span class="number">0</span><span class="symbol">,</span><span class="number">0</span><span class="symbol">,</span><span class="number">255</span><span class="symbol">);</span>
<span class="normal">    </span><span class="function">fillrect</span><span class="symbol">(</span><span class="normal">selected_game_object</span><span class="symbol">-&gt;</span><span class="normal">base</span><span class="symbol">.</span><span class="normal">x</span><span class="symbol">-</span><span class="normal">pos_x</span><span class="symbol">,</span><span class="normal">selected_game_object</span><span class="symbol">-&gt;</span><span class="normal">base</span><span class="symbol">.</span><span class="normal">y</span><span class="symbol">,</span><span class="number">3</span><span class="symbol">,</span><span class="normal">selected_game_object</span><span class="symbol">-&gt;</span><span class="normal">base</span><span class="symbol">.</span><span class="normal">height</span><span class="symbol">,</span><span class="number">255</span><span class="symbol">,</span><span class="number">0</span><span class="symbol">,</span><span class="number">0</span><span class="symbol">,</span><span class="number">255</span><span class="symbol">);</span>
<span class="normal">    </span><span class="function">fillrect</span><span class="symbol">(</span><span class="normal">selected_game_object</span><span class="symbol">-&gt;</span><span class="normal">base</span><span class="symbol">.</span><span class="normal">x</span><span class="symbol">-</span><span class="normal">pos_x</span><span class="symbol">,</span><span class="normal">selected_game_object</span><span class="symbol">-&gt;</span><span class="normal">base</span><span class="symbol">.</span><span class="normal">y</span><span class="symbol">+</span><span class="normal">selected_game_object</span><span class="symbol">-&gt;</span><span class="normal">base</span><span class="symbol">.</span><span class="normal">height</span><span class="symbol">,</span><span class="normal">selected_game_object</span><span class="symbol">-&gt;</span><span class="normal">base</span><span class="symbol">.</span><span class="normal">width</span><span class="symbol">,</span><span class="number">3</span><span class="symbol">,</span><span class="number">255</span><span class="symbol">,</span><span class="number">0</span><span class="symbol">,</span><span class="number">0</span><span class="symbol">,</span><span class="number">255</span><span class="symbol">);</span>
<span class="normal">    </span><span class="function">fillrect</span><span class="symbol">(</span><span class="normal">selected_game_object</span><span class="symbol">-&gt;</span><span class="normal">base</span><span class="symbol">.</span><span class="normal">x</span><span class="symbol">-</span><span class="normal">pos_x</span><span class="symbol">+</span><span class="normal">selected_game_object</span><span class="symbol">-&gt;</span><span class="normal">base</span><span class="symbol">.</span><span class="normal">width</span><span class="symbol">,</span><span class="normal">selected_game_object</span><span class="symbol">-&gt;</span><span class="normal">base</span><span class="symbol">.</span><span class="normal">y</span><span class="symbol">,</span><span class="number">3</span><span class="symbol">,</span><span class="normal">selected_game_object</span><span class="symbol">-&gt;</span><span class="normal">base</span><span class="symbol">.</span><span class="normal">height</span><span class="symbol">,</span><span class="number">255</span><span class="symbol">,</span><span class="number">0</span><span class="symbol">,</span><span class="number">0</span><span class="symbol">,</span><span class="number">255</span><span class="symbol">);</span>
<span class="normal">  </span><span class="cbracket">}</span>

<span class="normal">  </span><span class="keyword">if</span><span class="symbol">(</span><span class="normal">le_world </span><span class="symbol">!=</span><span class="normal"> NULL</span><span class="symbol">)</span>
<span class="normal">  </span><span class="cbracket">{</span>
<span class="normal">    le_save_level_bt</span><span class="symbol">-&gt;</span><span class="function">draw</span><span class="symbol">();</span>
<span class="normal">    le_exit_bt</span><span class="symbol">-&gt;</span><span class="function">draw</span><span class="symbol">();</span>
<span class="normal">    le_test_level_bt</span><span class="symbol">-&gt;</span><span class="function">draw</span><span class="symbol">();</span>
<span class="normal">    le_next_level_bt</span><span class="symbol">-&gt;</span><span class="function">draw</span><span class="symbol">();</span>
<span class="normal">    le_previous_level_bt</span><span class="symbol">-&gt;</span><span class="function">draw</span><span class="symbol">();</span>
<span class="normal">    le_rubber_bt</span><span class="symbol">-&gt;</span><span class="function">draw</span><span class="symbol">();</span>
<span class="normal">    </span><span class="keyword">if</span><span class="symbol">(</span><span class="normal">le_selection_mode </span><span class="symbol">==</span><span class="normal"> SM_SQUARE</span><span class="symbol">)</span>
<span class="normal">      le_select_mode_one_bt</span><span class="symbol">-&gt;</span><span class="function">draw</span><span class="symbol">();</span>
<span class="normal">    </span><span class="keyword">else</span><span class="normal"> </span><span class="keyword">if</span><span class="symbol">(</span><span class="normal">le_selection_mode </span><span class="symbol">==</span><span class="normal"> SM_CURSOR</span><span class="symbol">)</span>
<span class="normal">      le_select_mode_two_bt</span><span class="symbol">-&gt;</span><span class="function">draw</span><span class="symbol">();</span>
<span class="normal">    le_settings_bt</span><span class="symbol">-&gt;</span><span class="function">draw</span><span class="symbol">();</span>
<span class="normal">    le_move_right_bt</span><span class="symbol">-&gt;</span><span class="function">draw</span><span class="symbol">();</span>
<span class="normal">    le_move_left_bt</span><span class="symbol">-&gt;</span><span class="function">draw</span><span class="symbol">();</span>
<span class="normal">    le_tilegroup_bt</span><span class="symbol">-&gt;</span><span class="function">draw</span><span class="symbol">();</span>
<span class="normal">    le_objects_bt</span><span class="symbol">-&gt;</span><span class="function">draw</span><span class="symbol">();</span>
<span class="normal">    </span><span class="keyword">if</span><span class="symbol">(!</span><span class="normal">cur_tilegroup</span><span class="symbol">.</span><span class="function">empty</span><span class="symbol">())</span>
<span class="normal">      tilegroups_map</span><span class="symbol">[</span><span class="normal">cur_tilegroup</span><span class="symbol">]-&gt;</span><span class="function">draw</span><span class="symbol">();</span>
<span class="normal">    </span><span class="keyword">else</span><span class="normal"> </span><span class="keyword">if</span><span class="symbol">(!</span><span class="normal">cur_objects</span><span class="symbol">.</span><span class="function">empty</span><span class="symbol">())</span>
<span class="normal">    </span><span class="cbracket">{</span>
<span class="normal">      objects_map</span><span class="symbol">[</span><span class="normal">cur_objects</span><span class="symbol">]-&gt;</span><span class="function">draw</span><span class="symbol">();</span>
<span class="normal">    </span><span class="cbracket">}</span>

<span class="normal">    le_tilemap_panel</span><span class="symbol">-&gt;</span><span class="function">draw</span><span class="symbol">();</span>

<span class="normal">    </span><span class="keyword">if</span><span class="symbol">(!</span><span class="normal">cur_objects</span><span class="symbol">.</span><span class="function">empty</span><span class="symbol">())</span>
<span class="normal">    </span><span class="cbracket">{</span>
<span class="normal">      le_object_select_bt</span><span class="symbol">-&gt;</span><span class="function">draw</span><span class="symbol">();</span>
<span class="normal">      le_object_properties_bt</span><span class="symbol">-&gt;</span><span class="function">draw</span><span class="symbol">();</span>
<span class="normal">    </span><span class="cbracket">}</span>

<span class="normal">    </span><span class="function">sprintf</span><span class="symbol">(</span><span class="normal">str</span><span class="symbol">,</span><span class="normal"> </span><span class="string">"%d/%d"</span><span class="symbol">,</span><span class="normal"> le_level</span><span class="symbol">,</span><span class="normal">le_level_subset</span><span class="symbol">-&gt;</span><span class="normal">levels</span><span class="symbol">);</span>
<span class="normal">    white_text</span><span class="symbol">-&gt;</span><span class="function">drawf</span><span class="symbol">(</span><span class="normal">str</span><span class="symbol">,</span><span class="normal"> </span><span class="symbol">(</span><span class="normal">le_level_subset</span><span class="symbol">-&gt;</span><span class="normal">levels </span><span class="symbol">&lt;</span><span class="normal"> </span><span class="number">10</span><span class="symbol">)</span><span class="normal"> </span><span class="symbol">?</span><span class="normal"> </span><span class="symbol">-</span><span class="number">10</span><span class="normal"> </span><span class="symbol">:</span><span class="normal"> </span><span class="number">0</span><span class="symbol">,</span><span class="normal"> </span><span class="number">16</span><span class="symbol">,</span><span class="normal"> A_RIGHT</span><span class="symbol">,</span><span class="normal"> A_TOP</span><span class="symbol">,</span><span class="normal"> </span><span class="number">0</span><span class="symbol">);</span>

<span class="normal">    </span><span class="keyword">if</span><span class="symbol">(!</span><span class="normal">le_help_shown</span><span class="symbol">)</span>
<span class="normal">      white_small_text</span><span class="symbol">-&gt;</span><span class="function">draw</span><span class="symbol">(</span><span class="string">"F1 for Help"</span><span class="symbol">,</span><span class="normal"> </span><span class="number">10</span><span class="symbol">,</span><span class="normal"> </span><span class="number">430</span><span class="symbol">,</span><span class="normal"> </span><span class="number">1</span><span class="symbol">);</span>

<span class="normal">    </span><span class="keyword">if</span><span class="symbol">(</span><span class="normal">display_level_info</span><span class="symbol">.</span><span class="function">check</span><span class="symbol">())</span>
<span class="normal">      white_text</span><span class="symbol">-&gt;</span><span class="function">drawf</span><span class="symbol">(</span><span class="normal">le_world</span><span class="symbol">-&gt;</span><span class="function">get_level</span><span class="symbol">()-&gt;</span><span class="normal">name</span><span class="symbol">.</span><span class="function">c_str</span><span class="symbol">(),</span><span class="normal"> </span><span class="number">0</span><span class="symbol">,</span><span class="normal"> </span><span class="number">0</span><span class="symbol">,</span><span class="normal"> A_HMIDDLE</span><span class="symbol">,</span><span class="normal"> A_TOP</span><span class="symbol">,</span><span class="normal"> </span><span class="number">0</span><span class="symbol">);</span>
<span class="normal">  </span><span class="cbracket">}</span>
<span class="normal">  </span><span class="keyword">else</span>
<span class="normal">  </span><span class="cbracket">{</span>
<span class="normal">    </span><span class="keyword">if</span><span class="symbol">(!</span><span class="normal">Menu</span><span class="symbol">::</span><span class="function">current</span><span class="symbol">())</span>
<span class="normal">      white_small_text</span><span class="symbol">-&gt;</span><span class="function">draw</span><span class="symbol">(</span><span class="string">"No Level Subset loaded - Press ESC and choose one in the menu"</span><span class="symbol">,</span><span class="normal"> </span><span class="number">10</span><span class="symbol">,</span><span class="normal"> </span><span class="number">430</span><span class="symbol">,</span><span class="normal"> </span><span class="number">1</span><span class="symbol">);</span>
<span class="normal">    </span><span class="keyword">else</span>
<span class="normal">      white_small_text</span><span class="symbol">-&gt;</span><span class="function">draw</span><span class="symbol">(</span><span class="string">"No Level Subset loaded"</span><span class="symbol">,</span><span class="normal"> </span><span class="number">10</span><span class="symbol">,</span><span class="normal"> </span><span class="number">430</span><span class="symbol">,</span><span class="normal"> </span><span class="number">1</span><span class="symbol">);</span>
<span class="normal">  </span><span class="cbracket">}</span>

<span class="cbracket">}</span>

<span class="type">void</span><span class="normal"> </span><span class="function">le_drawlevel</span><span class="symbol">()</span>
<span class="cbracket">{</span>
<span class="normal">  </span><span class="type">unsigned</span><span class="normal"> </span><span class="type">int</span><span class="normal"> y</span><span class="symbol">,</span><span class="normal">x</span><span class="symbol">,</span><span class="normal">s</span><span class="symbol">;</span>
<span class="normal">  </span><span class="usertype">Uint8</span><span class="normal"> a</span><span class="symbol">;</span>

<span class="normal">  </span><span class="comment">/* Draw the real background */</span>
<span class="normal">  </span><span class="keyword">if</span><span class="symbol">(</span><span class="normal">le_world</span><span class="symbol">-&gt;</span><span class="function">get_level</span><span class="symbol">()-&gt;</span><span class="normal">bkgd_image</span><span class="symbol">[</span><span class="number">0</span><span class="symbol">]</span><span class="normal"> </span><span class="symbol">!=</span><span class="normal"> </span><span class="string">'</span><span class="specialchar">\0</span><span class="string">'</span><span class="symbol">)</span>
<span class="normal">  </span><span class="cbracket">{</span>
<span class="normal">    s </span><span class="symbol">=</span><span class="normal"> </span><span class="symbol">(</span><span class="type">int</span><span class="symbol">)((</span><span class="type">float</span><span class="symbol">)</span><span class="normal">pos_x </span><span class="symbol">*</span><span class="normal"> </span><span class="symbol">((</span><span class="type">float</span><span class="symbol">)</span><span class="normal">le_world</span><span class="symbol">-&gt;</span><span class="function">get_level</span><span class="symbol">()-&gt;</span><span class="normal">bkgd_speed</span><span class="symbol">/</span><span class="number">100</span><span class="symbol">.</span><span class="normal">0f</span><span class="symbol">))</span><span class="normal"> </span><span class="symbol">%</span><span class="normal"> screen</span><span class="symbol">-&gt;</span><span class="normal">w</span><span class="symbol">;</span>
<span class="normal">    le_world</span><span class="symbol">-&gt;</span><span class="function">get_level</span><span class="symbol">()-&gt;</span><span class="normal">img_bkgd</span><span class="symbol">-&gt;</span><span class="function">draw_part</span><span class="symbol">(</span><span class="normal">s</span><span class="symbol">,</span><span class="number">0</span><span class="symbol">,</span><span class="number">0</span><span class="symbol">,</span><span class="number">0</span><span class="symbol">,</span>
<span class="normal">        le_world</span><span class="symbol">-&gt;</span><span class="function">get_level</span><span class="symbol">()-&gt;</span><span class="normal">img_bkgd</span><span class="symbol">-&gt;</span><span class="normal">w </span><span class="symbol">-</span><span class="normal"> s </span><span class="symbol">-</span><span class="normal"> </span><span class="number">32</span><span class="symbol">,</span><span class="normal"> le_world</span><span class="symbol">-&gt;</span><span class="function">get_level</span><span class="symbol">()-&gt;</span><span class="normal">img_bkgd</span><span class="symbol">-&gt;</span><span class="normal">h</span><span class="symbol">);</span>
<span class="normal">    le_world</span><span class="symbol">-&gt;</span><span class="function">get_level</span><span class="symbol">()-&gt;</span><span class="normal">img_bkgd</span><span class="symbol">-&gt;</span><span class="function">draw_part</span><span class="symbol">(</span><span class="number">0</span><span class="symbol">,</span><span class="number">0</span><span class="symbol">,</span><span class="normal">screen</span><span class="symbol">-&gt;</span><span class="normal">w </span><span class="symbol">-</span><span class="normal"> s </span><span class="symbol">-</span><span class="normal"> </span><span class="number">32</span><span class="normal"> </span><span class="symbol">,</span><span class="number">0</span><span class="symbol">,</span><span class="normal">s</span><span class="symbol">,</span>
<span class="normal">        le_world</span><span class="symbol">-&gt;</span><span class="function">get_level</span><span class="symbol">()-&gt;</span><span class="normal">img_bkgd</span><span class="symbol">-&gt;</span><span class="normal">h</span><span class="symbol">);</span>
<span class="normal">  </span><span class="cbracket">}</span>
<span class="normal">  </span><span class="keyword">else</span>
<span class="normal">  </span><span class="cbracket">{</span>
<span class="normal">    </span><span class="function">drawgradient</span><span class="symbol">(</span><span class="normal">le_world</span><span class="symbol">-&gt;</span><span class="function">get_level</span><span class="symbol">()-&gt;</span><span class="normal">bkgd_top</span><span class="symbol">,</span><span class="normal"> le_world</span><span class="symbol">-&gt;</span><span class="function">get_level</span><span class="symbol">()-&gt;</span><span class="normal">bkgd_bottom</span><span class="symbol">);</span>
<span class="normal">  </span><span class="cbracket">}</span>

<span class="normal">  </span><span class="keyword">if</span><span class="symbol">(</span><span class="normal">le_current</span><span class="symbol">.</span><span class="function">IsTile</span><span class="symbol">())</span>
<span class="normal">  </span><span class="cbracket">{</span>
<span class="normal">    Tile</span><span class="symbol">::</span><span class="function">draw</span><span class="symbol">(</span><span class="normal">cursor_x</span><span class="symbol">-</span><span class="normal">pos_x</span><span class="symbol">,</span><span class="normal"> cursor_y</span><span class="symbol">,</span><span class="normal">le_current</span><span class="symbol">.</span><span class="normal">tile</span><span class="symbol">,</span><span class="number">128</span><span class="symbol">);</span>
<span class="normal">    </span><span class="keyword">if</span><span class="symbol">(!</span><span class="normal">TileManager</span><span class="symbol">::</span><span class="function">instance</span><span class="symbol">()-&gt;</span><span class="function">get</span><span class="symbol">(</span><span class="normal">le_current</span><span class="symbol">.</span><span class="normal">tile</span><span class="symbol">)-&gt;</span><span class="normal">images</span><span class="symbol">.</span><span class="function">empty</span><span class="symbol">())</span>
<span class="normal">      </span><span class="function">fillrect</span><span class="symbol">(</span><span class="normal">cursor_x</span><span class="symbol">-</span><span class="normal">pos_x</span><span class="symbol">,</span><span class="normal">cursor_y</span><span class="symbol">,</span><span class="normal">TileManager</span><span class="symbol">::</span><span class="function">instance</span><span class="symbol">()-&gt;</span><span class="function">get</span><span class="symbol">(</span><span class="normal">le_current</span><span class="symbol">.</span><span class="normal">tile</span><span class="symbol">)-&gt;</span><span class="normal">images</span><span class="symbol">[</span><span class="number">0</span><span class="symbol">]-&gt;</span><span class="normal">w</span><span class="symbol">,</span><span class="normal">TileManager</span><span class="symbol">::</span><span class="function">instance</span><span class="symbol">()-&gt;</span><span class="function">get</span><span class="symbol">(</span><span class="normal">le_current</span><span class="symbol">.</span><span class="normal">tile</span><span class="symbol">)-&gt;</span><span class="normal">images</span><span class="symbol">[</span><span class="number">0</span><span class="symbol">]-&gt;</span><span class="normal">h</span><span class="symbol">,</span><span class="number">50</span><span class="symbol">,</span><span class="number">50</span><span class="symbol">,</span><span class="number">50</span><span class="symbol">,</span><span class="number">50</span><span class="symbol">);</span>
<span class="normal">  </span><span class="cbracket">}</span>
<span class="normal">  </span><span class="keyword">if</span><span class="symbol">(</span><span class="normal">le_current</span><span class="symbol">.</span><span class="function">IsObject</span><span class="symbol">())</span>
<span class="normal">  </span><span class="cbracket">{</span>
<span class="normal">    le_current</span><span class="symbol">.</span><span class="normal">obj</span><span class="symbol">-&gt;</span><span class="function">move_to</span><span class="symbol">(</span><span class="normal">cursor_x</span><span class="symbol">,</span><span class="normal"> cursor_y</span><span class="symbol">);</span>
<span class="normal">  </span><span class="cbracket">}</span>

<span class="normal">  </span><span class="comment">/*       clearscreen(current_level.bkgd_red, current_level.bkgd_green, current_level.bkgd_blue); */</span>

<span class="normal">  </span><span class="keyword">for</span><span class="normal"> </span><span class="symbol">(</span><span class="normal">y </span><span class="symbol">=</span><span class="normal"> </span><span class="number">0</span><span class="symbol">;</span><span class="normal"> y </span><span class="symbol">&lt;</span><span class="normal"> </span><span class="number">15</span><span class="symbol">;</span><span class="normal"> </span><span class="symbol">++</span><span class="normal">y</span><span class="symbol">)</span>
<span class="normal">    </span><span class="keyword">for</span><span class="normal"> </span><span class="symbol">(</span><span class="normal">x </span><span class="symbol">=</span><span class="normal"> </span><span class="number">0</span><span class="symbol">;</span><span class="normal"> x </span><span class="symbol">&lt;</span><span class="normal"> </span><span class="number">20</span><span class="symbol">;</span><span class="normal"> </span><span class="symbol">++</span><span class="normal">x</span><span class="symbol">)</span>
<span class="normal">    </span><span class="cbracket">{</span>

<span class="normal">      </span><span class="keyword">if</span><span class="symbol">(</span><span class="normal">active_tm </span><span class="symbol">==</span><span class="normal"> TM_BG</span><span class="symbol">)</span>
<span class="normal">        a </span><span class="symbol">=</span><span class="normal"> </span><span class="number">255</span><span class="symbol">;</span>
<span class="normal">      </span><span class="keyword">else</span>
<span class="normal">        a </span><span class="symbol">=</span><span class="normal"> </span><span class="number">128</span><span class="symbol">;</span>

<span class="normal">      Tile</span><span class="symbol">::</span><span class="function">draw</span><span class="symbol">(</span><span class="number">32</span><span class="symbol">*</span><span class="normal">x </span><span class="symbol">-</span><span class="normal"> </span><span class="function">fmodf</span><span class="symbol">(</span><span class="normal">pos_x</span><span class="symbol">,</span><span class="normal"> </span><span class="number">32</span><span class="symbol">),</span><span class="normal"> y </span><span class="symbol">*</span><span class="normal"> </span><span class="number">32</span><span class="symbol">,</span><span class="normal"> le_world</span><span class="symbol">-&gt;</span><span class="function">get_level</span><span class="symbol">()-&gt;</span><span class="normal">bg_tiles</span><span class="symbol">[</span><span class="normal">y</span><span class="symbol">][</span><span class="normal">x </span><span class="symbol">+</span><span class="normal"> </span><span class="symbol">(</span><span class="type">int</span><span class="symbol">)(</span><span class="normal">pos_x </span><span class="symbol">/</span><span class="normal"> </span><span class="number">32</span><span class="symbol">)],</span><span class="normal">a</span><span class="symbol">);</span>

<span class="normal">      </span><span class="keyword">if</span><span class="symbol">(</span><span class="normal">active_tm </span><span class="symbol">==</span><span class="normal"> TM_IA</span><span class="symbol">)</span>
<span class="normal">        a </span><span class="symbol">=</span><span class="normal"> </span><span class="number">255</span><span class="symbol">;</span>
<span class="normal">      </span><span class="keyword">else</span>
<span class="normal">        a </span><span class="symbol">=</span><span class="normal"> </span><span class="number">128</span><span class="symbol">;</span>

<span class="normal">      Tile</span><span class="symbol">::</span><span class="function">draw</span><span class="symbol">(</span><span class="number">32</span><span class="symbol">*</span><span class="normal">x </span><span class="symbol">-</span><span class="normal"> </span><span class="function">fmodf</span><span class="symbol">(</span><span class="normal">pos_x</span><span class="symbol">,</span><span class="normal"> </span><span class="number">32</span><span class="symbol">),</span><span class="normal"> y </span><span class="symbol">*</span><span class="normal"> </span><span class="number">32</span><span class="symbol">,</span><span class="normal"> le_world</span><span class="symbol">-&gt;</span><span class="function">get_level</span><span class="symbol">()-&gt;</span><span class="normal">ia_tiles</span><span class="symbol">[</span><span class="normal">y</span><span class="symbol">][</span><span class="normal">x </span><span class="symbol">+</span><span class="normal"> </span><span class="symbol">(</span><span class="type">int</span><span class="symbol">)(</span><span class="normal">pos_x </span><span class="symbol">/</span><span class="normal"> </span><span class="number">32</span><span class="symbol">)],</span><span class="normal">a</span><span class="symbol">);</span>

<span class="normal">      </span><span class="keyword">if</span><span class="symbol">(</span><span class="normal">active_tm </span><span class="symbol">==</span><span class="normal"> TM_FG</span><span class="symbol">)</span>
<span class="normal">        a </span><span class="symbol">=</span><span class="normal"> </span><span class="number">255</span><span class="symbol">;</span>
<span class="normal">      </span><span class="keyword">else</span>
<span class="normal">        a </span><span class="symbol">=</span><span class="normal"> </span><span class="number">128</span><span class="symbol">;</span>

<span class="normal">      Tile</span><span class="symbol">::</span><span class="function">draw</span><span class="symbol">(</span><span class="number">32</span><span class="symbol">*</span><span class="normal">x </span><span class="symbol">-</span><span class="normal"> </span><span class="function">fmodf</span><span class="symbol">(</span><span class="normal">pos_x</span><span class="symbol">,</span><span class="normal"> </span><span class="number">32</span><span class="symbol">),</span><span class="normal"> y </span><span class="symbol">*</span><span class="normal"> </span><span class="number">32</span><span class="symbol">,</span><span class="normal"> le_world</span><span class="symbol">-&gt;</span><span class="function">get_level</span><span class="symbol">()-&gt;</span><span class="normal">fg_tiles</span><span class="symbol">[</span><span class="normal">y</span><span class="symbol">][</span><span class="normal">x </span><span class="symbol">+</span><span class="normal"> </span><span class="symbol">(</span><span class="type">int</span><span class="symbol">)(</span><span class="normal">pos_x </span><span class="symbol">/</span><span class="normal"> </span><span class="number">32</span><span class="symbol">)],</span><span class="normal">a</span><span class="symbol">);</span>

<span class="normal">      </span><span class="comment">/* draw whats inside stuff when cursor is selecting those */</span>
<span class="normal">      </span><span class="comment">/* (draw them all the time - is this the right behaviour?) */</span>
<span class="normal">      Tile</span><span class="symbol">*</span><span class="normal"> edit_image </span><span class="symbol">=</span><span class="normal"> TileManager</span><span class="symbol">::</span><span class="function">instance</span><span class="symbol">()-&gt;</span><span class="function">get</span><span class="symbol">(</span><span class="normal">le_world</span><span class="symbol">-&gt;</span><span class="function">get_level</span><span class="symbol">()-&gt;</span><span class="normal">ia_tiles</span><span class="symbol">[</span><span class="normal">y</span><span class="symbol">][</span><span class="normal">x </span><span class="symbol">+</span><span class="normal"> </span><span class="symbol">(</span><span class="type">int</span><span class="symbol">)(</span><span class="normal">pos_x </span><span class="symbol">/</span><span class="normal"> </span><span class="number">32</span><span class="symbol">)]);</span>
<span class="normal">      </span><span class="keyword">if</span><span class="symbol">(</span><span class="normal">edit_image </span><span class="symbol">&amp;&amp;</span><span class="normal"> </span><span class="symbol">!</span><span class="normal">edit_image</span><span class="symbol">-&gt;</span><span class="normal">editor_images</span><span class="symbol">.</span><span class="function">empty</span><span class="symbol">())</span>
<span class="normal">        edit_image</span><span class="symbol">-&gt;</span><span class="normal">editor_images</span><span class="symbol">[</span><span class="number">0</span><span class="symbol">]-&gt;</span><span class="function">draw</span><span class="symbol">(</span><span class="normal"> x </span><span class="symbol">*</span><span class="normal"> </span><span class="number">32</span><span class="normal"> </span><span class="symbol">-</span><span class="normal"> </span><span class="symbol">((</span><span class="type">int</span><span class="symbol">)</span><span class="normal">pos_x </span><span class="symbol">%</span><span class="normal"> </span><span class="number">32</span><span class="symbol">),</span><span class="normal"> y</span><span class="symbol">*</span><span class="number">32</span><span class="symbol">);</span>

<span class="normal">    </span><span class="cbracket">}</span>

<span class="normal">  </span><span class="comment">/* Draw the Bad guys: */</span>
<span class="normal">  </span><span class="keyword">for</span><span class="normal"> </span><span class="symbol">(</span><span class="normal">std</span><span class="symbol">::</span><span class="normal">list</span><span class="symbol">&lt;</span><span class="normal">BadGuy</span><span class="symbol">*&gt;::</span><span class="usertype">iterator</span><span class="normal"> it </span><span class="symbol">=</span><span class="normal"> le_world</span><span class="symbol">-&gt;</span><span class="normal">bad_guys</span><span class="symbol">.</span><span class="function">begin</span><span class="symbol">();</span><span class="normal"> it </span><span class="symbol">!=</span><span class="normal"> le_world</span><span class="symbol">-&gt;</span><span class="normal">bad_guys</span><span class="symbol">.</span><span class="function">end</span><span class="symbol">();</span><span class="normal"> </span><span class="symbol">++</span><span class="normal">it</span><span class="symbol">)</span>
<span class="normal">  </span><span class="cbracket">{</span>
<span class="normal">    </span><span class="comment">/* to support frames: img_bsod_left[(frame / 5) % 4] */</span>

<span class="normal">    scroll_x </span><span class="symbol">=</span><span class="normal"> pos_x</span><span class="symbol">;</span>
<span class="normal">    </span><span class="symbol">(*</span><span class="normal">it</span><span class="symbol">)-&gt;</span><span class="function">draw</span><span class="symbol">();</span>
<span class="normal">  </span><span class="cbracket">}</span>


<span class="normal">  </span><span class="comment">/* Draw the player: */</span>
<span class="normal">  </span><span class="comment">/* for now, the position is fixed at (100, 240) */</span>
<span class="normal">  largetux</span><span class="symbol">.</span><span class="normal">walk_right</span><span class="symbol">-&gt;</span><span class="function">draw</span><span class="symbol">(</span><span class="normal"> </span><span class="number">100</span><span class="normal"> </span><span class="symbol">-</span><span class="normal"> pos_x</span><span class="symbol">,</span><span class="normal"> </span><span class="number">240</span><span class="symbol">);</span>
<span class="cbracket">}</span>

<span class="type">void</span><span class="normal"> </span><span class="function">le_change_object_properties</span><span class="symbol">(</span><span class="usertype">GameObject</span><span class="normal"> </span><span class="symbol">*</span><span class="normal">pobj</span><span class="symbol">)</span>
<span class="cbracket">{</span>
<span class="normal">  Surface</span><span class="symbol">*</span><span class="normal"> cap_screen </span><span class="symbol">=</span><span class="normal"> Surface</span><span class="symbol">::</span><span class="function">CaptureScreen</span><span class="symbol">();</span>
<span class="normal">  Menu</span><span class="symbol">*</span><span class="normal"> object_properties_menu </span><span class="symbol">=</span><span class="normal"> </span><span class="keyword">new</span><span class="normal"> </span><span class="function">Menu</span><span class="symbol">();</span>
<span class="normal">  </span><span class="type">bool</span><span class="normal"> loop </span><span class="symbol">=</span><span class="normal"> </span><span class="keyword">true</span><span class="symbol">;</span>

<span class="normal">  object_properties_menu</span><span class="symbol">-&gt;</span><span class="function">additem</span><span class="symbol">(</span><span class="normal">MN_LABEL</span><span class="symbol">,</span><span class="normal">pobj</span><span class="symbol">-&gt;</span><span class="function">type</span><span class="symbol">()</span><span class="normal"> </span><span class="symbol">+</span><span class="normal"> </span><span class="string">" Properties"</span><span class="symbol">,</span><span class="number">0</span><span class="symbol">,</span><span class="number">0</span><span class="symbol">);</span>
<span class="normal">  object_properties_menu</span><span class="symbol">-&gt;</span><span class="function">additem</span><span class="symbol">(</span><span class="normal">MN_HL</span><span class="symbol">,</span><span class="string">""</span><span class="symbol">,</span><span class="number">0</span><span class="symbol">,</span><span class="number">0</span><span class="symbol">);</span>

<span class="normal">  </span><span class="keyword">if</span><span class="symbol">(</span><span class="normal">pobj</span><span class="symbol">-&gt;</span><span class="function">type</span><span class="symbol">()</span><span class="normal"> </span><span class="symbol">==</span><span class="normal"> </span><span class="string">"BadGuy"</span><span class="symbol">)</span>
<span class="normal">  </span><span class="cbracket">{</span>
<span class="normal">    BadGuy</span><span class="symbol">*</span><span class="normal"> pbad </span><span class="symbol">=</span><span class="normal"> </span><span class="keyword">dynamic_cast</span><span class="symbol">&lt;</span><span class="normal">BadGuy</span><span class="symbol">*&gt;(</span><span class="normal">pobj</span><span class="symbol">);</span>
<span class="normal">    object_properties_menu</span><span class="symbol">-&gt;</span><span class="function">additem</span><span class="symbol">(</span><span class="normal">MN_STRINGSELECT</span><span class="symbol">,</span><span class="string">"Kind"</span><span class="symbol">,</span><span class="number">0</span><span class="symbol">,</span><span class="number">0</span><span class="symbol">,</span><span class="number">1</span><span class="symbol">);</span>
<span class="normal">    </span><span class="keyword">for</span><span class="symbol">(</span><span class="type">int</span><span class="normal"> i </span><span class="symbol">=</span><span class="normal"> </span><span class="number">0</span><span class="symbol">;</span><span class="normal"> i </span><span class="symbol">&lt;</span><span class="normal"> NUM_BadGuyKinds</span><span class="symbol">;</span><span class="normal"> </span><span class="symbol">++</span><span class="normal">i</span><span class="symbol">)</span>
<span class="normal">    </span><span class="cbracket">{</span>
<span class="normal">      </span><span class="function">string_list_add_item</span><span class="symbol">(</span><span class="normal">object_properties_menu</span><span class="symbol">-&gt;</span><span class="function">get_item_by_id</span><span class="symbol">(</span><span class="number">1</span><span class="symbol">).</span><span class="normal">list</span><span class="symbol">,</span><span class="function">badguykind_to_string</span><span class="symbol">(</span><span class="keyword">static_cast</span><span class="symbol">&lt;</span><span class="normal">BadGuyKind</span><span class="symbol">&gt;(</span><span class="normal">i</span><span class="symbol">)).</span><span class="function">c_str</span><span class="symbol">());</span>
<span class="normal">      </span><span class="keyword">if</span><span class="symbol">(</span><span class="normal">pbad</span><span class="symbol">-&gt;</span><span class="normal">kind </span><span class="symbol">==</span><span class="normal"> i</span><span class="symbol">)</span>
<span class="normal">        object_properties_menu</span><span class="symbol">-&gt;</span><span class="function">get_item_by_id</span><span class="symbol">(</span><span class="number">1</span><span class="symbol">).</span><span class="normal">list</span><span class="symbol">-&gt;</span><span class="normal">active_item </span><span class="symbol">=</span><span class="normal"> i</span><span class="symbol">;</span>
<span class="normal">    </span><span class="cbracket">}</span>
<span class="normal">    object_properties_menu</span><span class="symbol">-&gt;</span><span class="function">additem</span><span class="symbol">(</span><span class="normal">MN_TOGGLE</span><span class="symbol">,</span><span class="string">"StayOnPlatform"</span><span class="symbol">,</span><span class="normal">pbad</span><span class="symbol">-&gt;</span><span class="normal">stay_on_platform</span><span class="symbol">,</span><span class="number">0</span><span class="symbol">,</span><span class="number">2</span><span class="symbol">);</span>
<span class="normal">  </span><span class="cbracket">}</span>

<span class="normal">  object_properties_menu</span><span class="symbol">-&gt;</span><span class="function">additem</span><span class="symbol">(</span><span class="normal">MN_HL</span><span class="symbol">,</span><span class="string">""</span><span class="symbol">,</span><span class="number">0</span><span class="symbol">,</span><span class="number">0</span><span class="symbol">);</span>
<span class="normal">  object_properties_menu</span><span class="symbol">-&gt;</span><span class="function">additem</span><span class="symbol">(</span><span class="normal">MN_ACTION</span><span class="symbol">,</span><span class="string">"Ok"</span><span class="symbol">,</span><span class="number">0</span><span class="symbol">,</span><span class="number">0</span><span class="symbol">,</span><span class="number">3</span><span class="symbol">);</span>

<span class="normal">  Menu</span><span class="symbol">::</span><span class="function">set_current</span><span class="symbol">(</span><span class="normal">object_properties_menu</span><span class="symbol">);</span>

<span class="normal">  </span><span class="keyword">while</span><span class="symbol">(</span><span class="normal">loop</span><span class="symbol">)</span>
<span class="normal">  </span><span class="cbracket">{</span>
<span class="normal">    </span><span class="usertype">SDL_Event</span><span class="normal"> event</span><span class="symbol">;</span>

<span class="normal">    </span><span class="keyword">while</span><span class="normal"> </span><span class="symbol">(</span><span class="function">SDL_PollEvent</span><span class="symbol">(&amp;</span><span class="normal">event</span><span class="symbol">))</span>
<span class="normal">    </span><span class="cbracket">{</span>
<span class="normal">      object_properties_menu</span><span class="symbol">-&gt;</span><span class="function">event</span><span class="symbol">(</span><span class="normal">event</span><span class="symbol">);</span>
<span class="normal">    </span><span class="cbracket">}</span>

<span class="normal">    cap_screen</span><span class="symbol">-&gt;</span><span class="function">draw</span><span class="symbol">(</span><span class="number">0</span><span class="symbol">,</span><span class="number">0</span><span class="symbol">);</span>

<span class="normal">    object_properties_menu</span><span class="symbol">-&gt;</span><span class="function">draw</span><span class="symbol">();</span>
<span class="normal">    object_properties_menu</span><span class="symbol">-&gt;</span><span class="function">action</span><span class="symbol">();</span>

<span class="normal">    </span><span class="keyword">switch</span><span class="normal"> </span><span class="symbol">(</span><span class="normal">object_properties_menu</span><span class="symbol">-&gt;</span><span class="function">check</span><span class="symbol">())</span>
<span class="normal">    </span><span class="cbracket">{</span>
<span class="normal">    </span><span class="keyword">case</span><span class="normal"> </span><span class="number">3</span><span class="symbol">:</span>
<span class="normal">      </span><span class="keyword">if</span><span class="symbol">(</span><span class="normal">pobj</span><span class="symbol">-&gt;</span><span class="function">type</span><span class="symbol">()</span><span class="normal"> </span><span class="symbol">==</span><span class="normal"> </span><span class="string">"BadGuy"</span><span class="symbol">)</span>
<span class="normal">      </span><span class="cbracket">{</span>
<span class="normal">        BadGuy</span><span class="symbol">*</span><span class="normal"> pbad </span><span class="symbol">=</span><span class="normal"> </span><span class="keyword">dynamic_cast</span><span class="symbol">&lt;</span><span class="normal">BadGuy</span><span class="symbol">*&gt;(</span><span class="normal">pobj</span><span class="symbol">);</span>
<span class="normal">        pbad</span><span class="symbol">-&gt;</span><span class="normal">kind </span><span class="symbol">=</span><span class="normal">  </span><span class="function">badguykind_from_string</span><span class="symbol">(</span><span class="function">string_list_active</span><span class="symbol">(</span><span class="normal">object_properties_menu</span><span class="symbol">-&gt;</span><span class="function">get_item_by_id</span><span class="symbol">(</span><span class="number">1</span><span class="symbol">).</span><span class="normal">list</span><span class="symbol">));</span>
<span class="normal">        pbad</span><span class="symbol">-&gt;</span><span class="normal">stay_on_platform </span><span class="symbol">=</span><span class="normal"> object_properties_menu</span><span class="symbol">-&gt;</span><span class="function">get_item_by_id</span><span class="symbol">(</span><span class="number">2</span><span class="symbol">).</span><span class="normal">toggled</span><span class="symbol">;</span>
<span class="normal">	</span><span class="type">int</span><span class="normal"> i </span><span class="symbol">=</span><span class="normal"> </span><span class="number">0</span><span class="symbol">;</span>
<span class="normal">	std</span><span class="symbol">::</span><span class="normal">list</span><span class="symbol">&lt;</span><span class="normal">BadGuy</span><span class="symbol">*&gt;::</span><span class="usertype">iterator</span><span class="normal"> it</span><span class="symbol">;</span>
<span class="normal">        </span><span class="keyword">for</span><span class="symbol">(</span><span class="normal">it </span><span class="symbol">=</span><span class="normal"> le_world</span><span class="symbol">-&gt;</span><span class="normal">bad_guys</span><span class="symbol">.</span><span class="function">begin</span><span class="symbol">();</span><span class="normal"> it </span><span class="symbol">!=</span><span class="normal"> le_world</span><span class="symbol">-&gt;</span><span class="normal">bad_guys</span><span class="symbol">.</span><span class="function">end</span><span class="symbol">();</span><span class="normal"> </span><span class="symbol">++</span><span class="normal">it</span><span class="symbol">,</span><span class="normal"> </span><span class="symbol">++</span><span class="normal">i</span><span class="symbol">)</span>
<span class="normal">          </span><span class="keyword">if</span><span class="symbol">((*</span><span class="normal">it</span><span class="symbol">)</span><span class="normal"> </span><span class="symbol">==</span><span class="normal"> pbad</span><span class="symbol">)</span>
<span class="normal">            </span><span class="keyword">break</span><span class="symbol">;</span>
<span class="normal">        le_world</span><span class="symbol">-&gt;</span><span class="function">get_level</span><span class="symbol">()-&gt;</span><span class="normal">badguy_data</span><span class="symbol">[</span><span class="normal">i</span><span class="symbol">].</span><span class="normal">kind </span><span class="symbol">=</span><span class="normal"> pbad</span><span class="symbol">-&gt;</span><span class="normal">kind</span><span class="symbol">;</span>
<span class="normal">	le_world</span><span class="symbol">-&gt;</span><span class="function">get_level</span><span class="symbol">()-&gt;</span><span class="normal">badguy_data</span><span class="symbol">[</span><span class="normal">i</span><span class="symbol">].</span><span class="normal">stay_on_platform </span><span class="symbol">=</span><span class="normal"> pbad</span><span class="symbol">-&gt;</span><span class="normal">stay_on_platform</span><span class="symbol">;</span>
<span class="normal">	</span><span class="keyword">delete</span><span class="normal"> </span><span class="symbol">(*</span><span class="normal">it</span><span class="symbol">);</span>
<span class="normal">	</span><span class="symbol">(*</span><span class="normal">it</span><span class="symbol">)</span><span class="normal"> </span><span class="symbol">=</span><span class="normal"> </span><span class="keyword">new</span><span class="normal"> </span><span class="function">BadGuy</span><span class="symbol">(</span><span class="normal">le_world</span><span class="symbol">-&gt;</span><span class="function">get_level</span><span class="symbol">()-&gt;</span><span class="normal">badguy_data</span><span class="symbol">[</span><span class="normal">i</span><span class="symbol">].</span><span class="normal">x</span><span class="symbol">,</span><span class="normal">le_world</span><span class="symbol">-&gt;</span><span class="function">get_level</span><span class="symbol">()-&gt;</span><span class="normal">badguy_data</span><span class="symbol">[</span><span class="normal">i</span><span class="symbol">].</span><span class="normal">y</span><span class="symbol">,</span><span class="normal">le_world</span><span class="symbol">-&gt;</span><span class="function">get_level</span><span class="symbol">()-&gt;</span><span class="normal">badguy_data</span><span class="symbol">[</span><span class="normal">i</span><span class="symbol">].</span><span class="normal">kind</span><span class="symbol">,</span><span class="normal">le_world</span><span class="symbol">-&gt;</span><span class="function">get_level</span><span class="symbol">()-&gt;</span><span class="normal">badguy_data</span><span class="symbol">[</span><span class="normal">i</span><span class="symbol">].</span><span class="normal">stay_on_platform</span><span class="symbol">);</span>
<span class="normal">      </span><span class="cbracket">}</span>
<span class="normal">      loop </span><span class="symbol">=</span><span class="normal"> </span><span class="keyword">false</span><span class="symbol">;</span>
<span class="normal">      </span><span class="keyword">break</span><span class="symbol">;</span>
<span class="label">    default:</span>
<span class="normal">      </span><span class="keyword">break</span><span class="symbol">;</span>
<span class="normal">    </span><span class="cbracket">}</span>

<span class="normal">    </span><span class="keyword">if</span><span class="symbol">(</span><span class="normal">Menu</span><span class="symbol">::</span><span class="function">current</span><span class="symbol">()</span><span class="normal"> </span><span class="symbol">==</span><span class="normal"> NULL</span><span class="symbol">)</span>
<span class="normal">      loop </span><span class="symbol">=</span><span class="normal"> </span><span class="keyword">false</span><span class="symbol">;</span>

<span class="normal">    mouse_cursor</span><span class="symbol">-&gt;</span><span class="function">draw</span><span class="symbol">();</span>
<span class="normal">    </span><span class="function">flipscreen</span><span class="symbol">();</span>
<span class="normal">    </span><span class="function">SDL_Delay</span><span class="symbol">(</span><span class="number">25</span><span class="symbol">);</span>
<span class="normal">  </span><span class="cbracket">}</span>

<span class="normal">  </span><span class="keyword">delete</span><span class="normal"> cap_screen</span><span class="symbol">;</span>
<span class="normal">  Menu</span><span class="symbol">::</span><span class="function">set_current</span><span class="symbol">(</span><span class="number">0</span><span class="symbol">);</span>
<span class="normal">  </span><span class="keyword">delete</span><span class="normal"> object_properties_menu</span><span class="symbol">;</span>
<span class="cbracket">}</span>


<span class="type">void</span><span class="normal"> </span><span class="function">le_checkevents</span><span class="symbol">()</span>
<span class="cbracket">{</span>
<span class="normal">  </span><span class="usertype">SDLKey</span><span class="normal"> key</span><span class="symbol">;</span>
<span class="normal">  </span><span class="usertype">SDLMod</span><span class="normal"> keymod</span><span class="symbol">;</span>
<span class="normal">  Button</span><span class="symbol">*</span><span class="normal"> pbutton</span><span class="symbol">;</span>
<span class="normal">  </span><span class="type">int</span><span class="normal"> x</span><span class="symbol">,</span><span class="normal">y</span><span class="symbol">;</span>

<span class="normal">  keymod </span><span class="symbol">=</span><span class="normal"> </span><span class="function">SDL_GetModState</span><span class="symbol">();</span>

<span class="normal">  </span><span class="keyword">while</span><span class="symbol">(</span><span class="function">SDL_PollEvent</span><span class="symbol">(&amp;</span><span class="normal">event</span><span class="symbol">))</span>
<span class="normal">  </span><span class="cbracket">{</span>
<span class="normal">    </span><span class="keyword">if</span><span class="normal"> </span><span class="symbol">(</span><span class="normal">Menu</span><span class="symbol">::</span><span class="function">current</span><span class="symbol">())</span>
<span class="normal">    </span><span class="cbracket">{</span>
<span class="normal">      Menu</span><span class="symbol">::</span><span class="function">current</span><span class="symbol">()-&gt;</span><span class="function">event</span><span class="symbol">(</span><span class="normal">event</span><span class="symbol">);</span>
<span class="normal">      </span><span class="keyword">if</span><span class="symbol">(!</span><span class="normal">le_world </span><span class="symbol">&amp;&amp;</span><span class="normal"> </span><span class="symbol">!</span><span class="normal">Menu</span><span class="symbol">::</span><span class="function">current</span><span class="symbol">())</span>
<span class="normal">        Menu</span><span class="symbol">::</span><span class="function">set_current</span><span class="symbol">(</span><span class="normal">leveleditor_menu</span><span class="symbol">);</span>
<span class="normal">    </span><span class="cbracket">}</span>
<span class="normal">    </span><span class="keyword">else</span>
<span class="normal">    </span><span class="cbracket">{</span>
<span class="normal">      mouse_cursor</span><span class="symbol">-&gt;</span><span class="function">set_state</span><span class="symbol">(</span><span class="normal">MC_NORMAL</span><span class="symbol">);</span>

<span class="normal">      </span><span class="comment">/* testing SDL_KEYDOWN, SDL_KEYUP and SDL_QUIT events*/</span>
<span class="normal">      </span><span class="keyword">if</span><span class="symbol">(</span><span class="normal">event</span><span class="symbol">.</span><span class="normal">type </span><span class="symbol">==</span><span class="normal"> SDL_KEYDOWN</span>
<span class="normal">          </span><span class="symbol">||</span><span class="normal"> </span><span class="symbol">((</span><span class="normal">event</span><span class="symbol">.</span><span class="normal">type </span><span class="symbol">==</span><span class="normal"> SDL_MOUSEBUTTONDOWN </span><span class="symbol">||</span><span class="normal"> SDL_MOUSEMOTION</span><span class="symbol">)</span>
<span class="normal">              </span><span class="symbol">&amp;&amp;</span><span class="normal"> </span><span class="symbol">(</span><span class="normal">event</span><span class="symbol">.</span><span class="normal">motion</span><span class="symbol">.</span><span class="normal">x </span><span class="symbol">&gt;</span><span class="normal"> </span><span class="number">0</span>
<span class="normal">                  </span><span class="symbol">&amp;&amp;</span><span class="normal"> event</span><span class="symbol">.</span><span class="normal">motion</span><span class="symbol">.</span><span class="normal">x </span><span class="symbol">&lt;</span><span class="normal"> screen</span><span class="symbol">-&gt;</span><span class="normal">w </span><span class="symbol">-</span><span class="normal"> </span><span class="number">64</span><span class="normal"> </span><span class="symbol">&amp;&amp;</span>
<span class="normal">                  event</span><span class="symbol">.</span><span class="normal">motion</span><span class="symbol">.</span><span class="normal">y </span><span class="symbol">&gt;</span><span class="normal"> </span><span class="number">0</span><span class="normal"> </span><span class="symbol">&amp;&amp;</span><span class="normal"> event</span><span class="symbol">.</span><span class="normal">motion</span><span class="symbol">.</span><span class="normal">y </span><span class="symbol">&lt;</span><span class="normal"> screen</span><span class="symbol">-&gt;</span><span class="normal">h</span><span class="symbol">)))</span>
<span class="normal">      </span><span class="cbracket">{</span>
<span class="normal">        </span><span class="keyword">switch</span><span class="symbol">(</span><span class="normal">event</span><span class="symbol">.</span><span class="normal">type</span><span class="symbol">)</span>
<span class="normal">        </span><span class="cbracket">{</span>
<span class="normal">        </span><span class="keyword">case</span><span class="normal"> SDL_KEYDOWN</span><span class="symbol">:</span><span class="normal">	</span><span class="comment">// key pressed</span>
<span class="normal">          key </span><span class="symbol">=</span><span class="normal"> event</span><span class="symbol">.</span><span class="normal">key</span><span class="symbol">.</span><span class="normal">keysym</span><span class="symbol">.</span><span class="normal">sym</span><span class="symbol">;</span>
<span class="normal">          </span><span class="keyword">switch</span><span class="symbol">(</span><span class="normal">key</span><span class="symbol">)</span>
<span class="normal">          </span><span class="cbracket">{</span>
<span class="normal">          </span><span class="keyword">case</span><span class="normal"> SDLK_ESCAPE</span><span class="symbol">:</span>
<span class="normal">            Menu</span><span class="symbol">::</span><span class="function">set_current</span><span class="symbol">(</span><span class="normal">leveleditor_menu</span><span class="symbol">);</span>
<span class="normal">            </span><span class="keyword">break</span><span class="symbol">;</span>
<span class="normal">          </span><span class="keyword">case</span><span class="normal"> SDLK_LEFT</span><span class="symbol">:</span>
<span class="normal">            </span><span class="keyword">if</span><span class="symbol">(</span><span class="normal">fire </span><span class="symbol">==</span><span class="normal"> DOWN</span><span class="symbol">)</span>
<span class="normal">              cursor_x </span><span class="symbol">-=</span><span class="normal"> KEY_CURSOR_SPEED</span><span class="symbol">;</span>
<span class="normal">            </span><span class="keyword">else</span>
<span class="normal">              cursor_x </span><span class="symbol">-=</span><span class="normal"> KEY_CURSOR_FASTSPEED</span><span class="symbol">;</span>

<span class="normal">            </span><span class="keyword">if</span><span class="symbol">(</span><span class="normal">cursor_x </span><span class="symbol">&lt;</span><span class="normal"> pos_x </span><span class="symbol">+</span><span class="normal"> MOUSE_LEFT_MARGIN</span><span class="symbol">)</span>
<span class="normal">              pos_x </span><span class="symbol">=</span><span class="normal"> cursor_x </span><span class="symbol">-</span><span class="normal"> MOUSE_LEFT_MARGIN</span><span class="symbol">;</span>

<span class="normal">            </span><span class="keyword">break</span><span class="symbol">;</span>
<span class="normal">          </span><span class="keyword">case</span><span class="normal"> SDLK_RIGHT</span><span class="symbol">:</span>
<span class="normal">            </span><span class="keyword">if</span><span class="symbol">(</span><span class="normal">fire </span><span class="symbol">==</span><span class="normal"> DOWN</span><span class="symbol">)</span>
<span class="normal">              cursor_x </span><span class="symbol">+=</span><span class="normal"> KEY_CURSOR_SPEED</span><span class="symbol">;</span>
<span class="normal">            </span><span class="keyword">else</span>
<span class="normal">              cursor_x </span><span class="symbol">+=</span><span class="normal"> KEY_CURSOR_FASTSPEED</span><span class="symbol">;</span>

<span class="normal">            </span><span class="keyword">if</span><span class="symbol">(</span><span class="normal">cursor_x </span><span class="symbol">&gt;</span><span class="normal"> pos_x </span><span class="symbol">+</span><span class="normal"> MOUSE_RIGHT_MARGIN</span><span class="symbol">-</span><span class="number">32</span><span class="symbol">)</span>
<span class="normal">              pos_x </span><span class="symbol">=</span><span class="normal"> cursor_x </span><span class="symbol">-</span><span class="normal"> MOUSE_RIGHT_MARGIN</span><span class="symbol">+</span><span class="number">32</span><span class="symbol">;</span>

<span class="normal">            </span><span class="keyword">break</span><span class="symbol">;</span>
<span class="normal">          </span><span class="keyword">case</span><span class="normal"> SDLK_UP</span><span class="symbol">:</span>
<span class="normal">            </span><span class="keyword">if</span><span class="symbol">(</span><span class="normal">fire </span><span class="symbol">==</span><span class="normal"> DOWN</span><span class="symbol">)</span>
<span class="normal">              cursor_y </span><span class="symbol">-=</span><span class="normal"> KEY_CURSOR_SPEED</span><span class="symbol">;</span>
<span class="normal">            </span><span class="keyword">else</span>
<span class="normal">              cursor_y </span><span class="symbol">-=</span><span class="normal"> KEY_CURSOR_FASTSPEED</span><span class="symbol">;</span>

<span class="normal">            </span><span class="keyword">if</span><span class="symbol">(</span><span class="normal">cursor_y </span><span class="symbol">&lt;</span><span class="normal"> </span><span class="number">0</span><span class="symbol">)</span>
<span class="normal">              cursor_y </span><span class="symbol">=</span><span class="normal"> </span><span class="number">0</span><span class="symbol">;</span>
<span class="normal">            </span><span class="keyword">break</span><span class="symbol">;</span>
<span class="normal">          </span><span class="keyword">case</span><span class="normal"> SDLK_DOWN</span><span class="symbol">:</span>
<span class="normal">            </span><span class="keyword">if</span><span class="symbol">(</span><span class="normal">fire </span><span class="symbol">==</span><span class="normal"> DOWN</span><span class="symbol">)</span>
<span class="normal">              cursor_y </span><span class="symbol">+=</span><span class="normal"> KEY_CURSOR_SPEED</span><span class="symbol">;</span>
<span class="normal">            </span><span class="keyword">else</span>
<span class="normal">              cursor_y </span><span class="symbol">+=</span><span class="normal"> KEY_CURSOR_FASTSPEED</span><span class="symbol">;</span>

<span class="normal">            </span><span class="keyword">if</span><span class="symbol">(</span><span class="normal">cursor_y </span><span class="symbol">&gt;</span><span class="normal"> screen</span><span class="symbol">-&gt;</span><span class="normal">h</span><span class="symbol">-</span><span class="number">32</span><span class="symbol">)</span>
<span class="normal">              cursor_y </span><span class="symbol">=</span><span class="normal"> screen</span><span class="symbol">-&gt;</span><span class="normal">h</span><span class="symbol">-</span><span class="number">32</span><span class="symbol">;</span>
<span class="normal">            </span><span class="keyword">break</span><span class="symbol">;</span>
<span class="normal">          </span><span class="keyword">case</span><span class="normal"> SDLK_LCTRL</span><span class="symbol">:</span>
<span class="normal">            fire </span><span class="symbol">=</span><span class="normal">UP</span><span class="symbol">;</span>
<span class="normal">            </span><span class="keyword">break</span><span class="symbol">;</span>
<span class="normal">          </span><span class="keyword">case</span><span class="normal"> SDLK_F1</span><span class="symbol">:</span>
<span class="normal">            </span><span class="keyword">if</span><span class="symbol">(</span><span class="normal">le_world </span><span class="symbol">!=</span><span class="normal"> NULL</span><span class="symbol">)</span>
<span class="normal">              </span><span class="function">le_showhelp</span><span class="symbol">();</span>
<span class="normal">            </span><span class="keyword">break</span><span class="symbol">;</span>
<span class="normal">          </span><span class="keyword">case</span><span class="normal"> SDLK_HOME</span><span class="symbol">:</span>
<span class="normal">            cursor_x </span><span class="symbol">=</span><span class="normal"> </span><span class="number">0</span><span class="symbol">;</span>
<span class="normal">            pos_x </span><span class="symbol">=</span><span class="normal"> cursor_x</span><span class="symbol">;</span>
<span class="normal">            </span><span class="keyword">break</span><span class="symbol">;</span>
<span class="normal">          </span><span class="keyword">case</span><span class="normal"> SDLK_END</span><span class="symbol">:</span>
<span class="normal">            cursor_x </span><span class="symbol">=</span><span class="normal"> </span><span class="symbol">(</span><span class="normal">le_world</span><span class="symbol">-&gt;</span><span class="function">get_level</span><span class="symbol">()-&gt;</span><span class="normal">width </span><span class="symbol">*</span><span class="normal"> </span><span class="number">32</span><span class="symbol">)</span><span class="normal"> </span><span class="symbol">-</span><span class="normal"> </span><span class="number">32</span><span class="symbol">;</span>
<span class="normal">            pos_x </span><span class="symbol">=</span><span class="normal"> cursor_x</span><span class="symbol">;</span>
<span class="normal">            </span><span class="keyword">break</span><span class="symbol">;</span>
<span class="normal">          </span><span class="keyword">case</span><span class="normal"> SDLK_F9</span><span class="symbol">:</span>
<span class="normal">            le_show_grid </span><span class="symbol">=</span><span class="normal"> </span><span class="symbol">!</span><span class="normal">le_show_grid</span><span class="symbol">;</span>
<span class="normal">            </span><span class="keyword">break</span><span class="symbol">;</span>
<span class="label">          default:</span>
<span class="normal">            </span><span class="keyword">break</span><span class="symbol">;</span>
<span class="normal">          </span><span class="cbracket">}</span>
<span class="normal">          </span><span class="keyword">break</span><span class="symbol">;</span>
<span class="normal">        </span><span class="keyword">case</span><span class="normal"> SDL_KEYUP</span><span class="symbol">:</span><span class="normal">	</span><span class="comment">/* key released */</span>
<span class="normal">          </span><span class="keyword">switch</span><span class="symbol">(</span><span class="normal">event</span><span class="symbol">.</span><span class="normal">key</span><span class="symbol">.</span><span class="normal">keysym</span><span class="symbol">.</span><span class="normal">sym</span><span class="symbol">)</span>
<span class="normal">          </span><span class="cbracket">{</span>
<span class="normal">          </span><span class="keyword">case</span><span class="normal"> SDLK_LCTRL</span><span class="symbol">:</span>
<span class="normal">            fire </span><span class="symbol">=</span><span class="normal"> DOWN</span><span class="symbol">;</span>
<span class="normal">            </span><span class="keyword">break</span><span class="symbol">;</span>
<span class="label">          default:</span>
<span class="normal">            </span><span class="keyword">break</span><span class="symbol">;</span>
<span class="normal">          </span><span class="cbracket">}</span>
<span class="normal">          </span><span class="keyword">break</span><span class="symbol">;</span>
<span class="normal">        </span><span class="keyword">case</span><span class="normal"> SDL_MOUSEBUTTONDOWN</span><span class="symbol">:</span>
<span class="normal">          </span><span class="keyword">if</span><span class="symbol">(</span><span class="normal">event</span><span class="symbol">.</span><span class="normal">button</span><span class="symbol">.</span><span class="normal">button </span><span class="symbol">==</span><span class="normal"> SDL_BUTTON_LEFT</span><span class="symbol">)</span>
<span class="normal">          </span><span class="cbracket">{</span>
<span class="normal">            le_mouse_pressed</span><span class="symbol">[</span><span class="normal">LEFT</span><span class="symbol">]</span><span class="normal"> </span><span class="symbol">=</span><span class="normal"> </span><span class="keyword">true</span><span class="symbol">;</span>

<span class="normal">            selection</span><span class="symbol">.</span><span class="normal">x1 </span><span class="symbol">=</span><span class="normal"> event</span><span class="symbol">.</span><span class="normal">motion</span><span class="symbol">.</span><span class="normal">x </span><span class="symbol">+</span><span class="normal"> pos_x</span><span class="symbol">;</span>
<span class="normal">            selection</span><span class="symbol">.</span><span class="normal">y1 </span><span class="symbol">=</span><span class="normal"> event</span><span class="symbol">.</span><span class="normal">motion</span><span class="symbol">.</span><span class="normal">y</span><span class="symbol">;</span>
<span class="normal">            selection</span><span class="symbol">.</span><span class="normal">x2 </span><span class="symbol">=</span><span class="normal"> event</span><span class="symbol">.</span><span class="normal">motion</span><span class="symbol">.</span><span class="normal">x </span><span class="symbol">+</span><span class="normal"> pos_x</span><span class="symbol">;</span>
<span class="normal">            selection</span><span class="symbol">.</span><span class="normal">y2 </span><span class="symbol">=</span><span class="normal"> event</span><span class="symbol">.</span><span class="normal">motion</span><span class="symbol">.</span><span class="normal">y</span><span class="symbol">;</span>
<span class="normal">          </span><span class="cbracket">}</span>
<span class="normal">          </span><span class="keyword">else</span><span class="normal"> </span><span class="keyword">if</span><span class="symbol">(</span><span class="normal">event</span><span class="symbol">.</span><span class="normal">button</span><span class="symbol">.</span><span class="normal">button </span><span class="symbol">==</span><span class="normal"> SDL_BUTTON_RIGHT</span><span class="symbol">)</span>
<span class="normal">          </span><span class="cbracket">{</span>
<span class="normal">            le_mouse_pressed</span><span class="symbol">[</span><span class="normal">RIGHT</span><span class="symbol">]</span><span class="normal"> </span><span class="symbol">=</span><span class="normal"> </span><span class="keyword">true</span><span class="symbol">;</span>
<span class="normal">          </span><span class="cbracket">}</span>
<span class="normal">          </span><span class="keyword">break</span><span class="symbol">;</span>
<span class="normal">        </span><span class="keyword">case</span><span class="normal"> SDL_MOUSEBUTTONUP</span><span class="symbol">:</span>
<span class="normal">          </span><span class="keyword">if</span><span class="symbol">(</span><span class="normal">event</span><span class="symbol">.</span><span class="normal">button</span><span class="symbol">.</span><span class="normal">button </span><span class="symbol">==</span><span class="normal"> SDL_BUTTON_LEFT</span><span class="symbol">)</span>
<span class="normal">          </span><span class="cbracket">{</span>
<span class="normal">            le_mouse_pressed</span><span class="symbol">[</span><span class="normal">LEFT</span><span class="symbol">]</span><span class="normal"> </span><span class="symbol">=</span><span class="normal"> </span><span class="keyword">false</span><span class="symbol">;</span>
<span class="normal">            le_mouse_clicked</span><span class="symbol">[</span><span class="normal">LEFT</span><span class="symbol">]</span><span class="normal"> </span><span class="symbol">=</span><span class="normal"> </span><span class="keyword">true</span><span class="symbol">;</span>
<span class="normal">          </span><span class="cbracket">}</span>
<span class="normal">          </span><span class="keyword">else</span><span class="normal"> </span><span class="keyword">if</span><span class="symbol">(</span><span class="normal">event</span><span class="symbol">.</span><span class="normal">button</span><span class="symbol">.</span><span class="normal">button </span><span class="symbol">==</span><span class="normal"> SDL_BUTTON_RIGHT</span><span class="symbol">)</span>
<span class="normal">          </span><span class="cbracket">{</span>
<span class="normal">            le_mouse_pressed</span><span class="symbol">[</span><span class="normal">RIGHT</span><span class="symbol">]</span><span class="normal"> </span><span class="symbol">=</span><span class="normal"> </span><span class="keyword">false</span><span class="symbol">;</span>
<span class="normal">            le_mouse_clicked</span><span class="symbol">[</span><span class="normal">RIGHT</span><span class="symbol">]</span><span class="normal"> </span><span class="symbol">=</span><span class="normal"> </span><span class="keyword">true</span><span class="symbol">;</span>
<span class="normal">          </span><span class="cbracket">}</span>
<span class="normal">          </span><span class="keyword">break</span><span class="symbol">;</span>
<span class="normal">        </span><span class="keyword">case</span><span class="normal"> SDL_MOUSEMOTION</span><span class="symbol">:</span>

<span class="normal">          </span><span class="keyword">if</span><span class="symbol">(!</span><span class="normal">Menu</span><span class="symbol">::</span><span class="function">current</span><span class="symbol">())</span>
<span class="normal">          </span><span class="cbracket">{</span>
<span class="normal">            x </span><span class="symbol">=</span><span class="normal"> event</span><span class="symbol">.</span><span class="normal">motion</span><span class="symbol">.</span><span class="normal">x</span><span class="symbol">;</span>
<span class="normal">            y </span><span class="symbol">=</span><span class="normal"> event</span><span class="symbol">.</span><span class="normal">motion</span><span class="symbol">.</span><span class="normal">y</span><span class="symbol">;</span>

<span class="normal">            </span><span class="keyword">if</span><span class="symbol">(</span><span class="normal">le_current</span><span class="symbol">.</span><span class="function">IsTile</span><span class="symbol">())</span>
<span class="normal">            </span><span class="cbracket">{</span>
<span class="normal">              cursor_x </span><span class="symbol">=</span><span class="normal"> </span><span class="symbol">((</span><span class="type">int</span><span class="symbol">)(</span><span class="normal">pos_x </span><span class="symbol">+</span><span class="normal"> x</span><span class="symbol">)</span><span class="normal"> </span><span class="symbol">/</span><span class="normal"> </span><span class="number">32</span><span class="symbol">)</span><span class="normal"> </span><span class="symbol">*</span><span class="normal"> </span><span class="number">32</span><span class="symbol">;</span>
<span class="normal">              cursor_y </span><span class="symbol">=</span><span class="normal"> </span><span class="symbol">((</span><span class="type">int</span><span class="symbol">)</span><span class="normal"> y </span><span class="symbol">/</span><span class="normal"> </span><span class="number">32</span><span class="symbol">)</span><span class="normal"> </span><span class="symbol">*</span><span class="normal"> </span><span class="number">32</span><span class="symbol">;</span>
<span class="normal">            </span><span class="cbracket">}</span>
<span class="normal">            </span><span class="keyword">else</span>
<span class="normal">            </span><span class="cbracket">{</span>
<span class="normal">              cursor_x </span><span class="symbol">=</span><span class="normal"> x</span><span class="symbol">;</span>
<span class="normal">              cursor_y </span><span class="symbol">=</span><span class="normal"> y</span><span class="symbol">;</span>
<span class="normal">            </span><span class="cbracket">}</span>

<span class="normal">            </span><span class="keyword">if</span><span class="symbol">(</span><span class="normal">le_mouse_pressed</span><span class="symbol">[</span><span class="normal">LEFT</span><span class="symbol">])</span>
<span class="normal">            </span><span class="cbracket">{</span>
<span class="normal">              selection</span><span class="symbol">.</span><span class="normal">x2 </span><span class="symbol">=</span><span class="normal"> x </span><span class="symbol">+</span><span class="normal"> pos_x</span><span class="symbol">;</span>
<span class="normal">              selection</span><span class="symbol">.</span><span class="normal">y2 </span><span class="symbol">=</span><span class="normal"> y</span><span class="symbol">;</span>
<span class="normal">            </span><span class="cbracket">}</span>

<span class="normal">            </span><span class="keyword">if</span><span class="symbol">(</span><span class="normal">le_mouse_pressed</span><span class="symbol">[</span><span class="normal">RIGHT</span><span class="symbol">])</span>
<span class="normal">            </span><span class="cbracket">{</span>
<span class="normal">              pos_x </span><span class="symbol">+=</span><span class="normal"> </span><span class="symbol">-</span><span class="number">1</span><span class="normal"> </span><span class="symbol">*</span><span class="normal"> event</span><span class="symbol">.</span><span class="normal">motion</span><span class="symbol">.</span><span class="normal">xrel</span><span class="symbol">;</span>
<span class="normal">            </span><span class="cbracket">}</span>
<span class="normal">          </span><span class="cbracket">}</span>
<span class="normal">          </span><span class="keyword">break</span><span class="symbol">;</span>
<span class="label">        default:</span>
<span class="normal">          </span><span class="keyword">break</span><span class="symbol">;</span>
<span class="normal">        </span><span class="cbracket">}</span>
<span class="normal">      </span><span class="cbracket">}</span>
<span class="normal">      </span><span class="keyword">else</span><span class="normal"> </span><span class="keyword">if</span><span class="symbol">(</span><span class="normal">event</span><span class="symbol">.</span><span class="normal">type </span><span class="symbol">==</span><span class="normal"> SDL_QUIT</span><span class="symbol">)</span><span class="normal"> </span><span class="comment">/* window closing */</span>
<span class="normal">      </span><span class="cbracket">{</span>
<span class="normal">      done </span><span class="symbol">=</span><span class="normal"> </span><span class="number">1</span><span class="symbol">;</span>
<span class="normal">      </span><span class="cbracket">}</span>
<span class="normal">    </span><span class="cbracket">}</span>

<span class="normal">    </span><span class="keyword">if</span><span class="symbol">(</span><span class="normal">le_world </span><span class="symbol">!=</span><span class="normal"> NULL</span><span class="symbol">)</span>
<span class="normal">    </span><span class="cbracket">{</span>
<span class="normal">      </span><span class="keyword">if</span><span class="symbol">(</span><span class="normal">event</span><span class="symbol">.</span><span class="normal">type </span><span class="symbol">==</span><span class="normal"> SDL_KEYDOWN </span><span class="symbol">||</span><span class="normal"> event</span><span class="symbol">.</span><span class="normal">type </span><span class="symbol">==</span><span class="normal"> SDL_KEYUP </span><span class="symbol">||</span><span class="normal"> </span><span class="symbol">((</span><span class="normal">event</span><span class="symbol">.</span><span class="normal">type </span><span class="symbol">==</span><span class="normal"> SDL_MOUSEBUTTONDOWN </span><span class="symbol">||</span><span class="normal"> SDL_MOUSEMOTION</span><span class="symbol">)</span><span class="normal"> </span><span class="symbol">&amp;&amp;</span><span class="normal"> </span><span class="symbol">(</span><span class="normal">event</span><span class="symbol">.</span><span class="normal">motion</span><span class="symbol">.</span><span class="normal">x </span><span class="symbol">&gt;</span><span class="normal"> screen</span><span class="symbol">-&gt;</span><span class="normal">w</span><span class="symbol">-</span><span class="number">64</span><span class="normal"> </span><span class="symbol">&amp;&amp;</span><span class="normal"> event</span><span class="symbol">.</span><span class="normal">motion</span><span class="symbol">.</span><span class="normal">x </span><span class="symbol">&lt;</span><span class="normal"> screen</span><span class="symbol">-&gt;</span><span class="normal">w </span><span class="symbol">&amp;&amp;</span>
<span class="normal">          event</span><span class="symbol">.</span><span class="normal">motion</span><span class="symbol">.</span><span class="normal">y </span><span class="symbol">&gt;</span><span class="normal"> </span><span class="number">0</span><span class="normal"> </span><span class="symbol">&amp;&amp;</span><span class="normal"> event</span><span class="symbol">.</span><span class="normal">motion</span><span class="symbol">.</span><span class="normal">y </span><span class="symbol">&lt;</span><span class="normal"> screen</span><span class="symbol">-&gt;</span><span class="normal">h</span><span class="symbol">)))</span>
<span class="normal">      </span><span class="cbracket">{</span>
<span class="normal">        le_mouse_pressed</span><span class="symbol">[</span><span class="normal">LEFT</span><span class="symbol">]</span><span class="normal"> </span><span class="symbol">=</span><span class="normal"> </span><span class="keyword">false</span><span class="symbol">;</span>
<span class="normal">        le_mouse_pressed</span><span class="symbol">[</span><span class="normal">RIGHT</span><span class="symbol">]</span><span class="normal"> </span><span class="symbol">=</span><span class="normal"> </span><span class="keyword">false</span><span class="symbol">;</span>

<span class="normal">        </span><span class="keyword">if</span><span class="symbol">(!</span><span class="normal">Menu</span><span class="symbol">::</span><span class="function">current</span><span class="symbol">())</span>
<span class="normal">        </span><span class="cbracket">{</span>
<span class="normal">          </span><span class="comment">/* Check for button events */</span>
<span class="normal">          le_test_level_bt</span><span class="symbol">-&gt;</span><span class="function">event</span><span class="symbol">(</span><span class="normal">event</span><span class="symbol">);</span>
<span class="normal">          </span><span class="keyword">if</span><span class="symbol">(</span><span class="normal">le_test_level_bt</span><span class="symbol">-&gt;</span><span class="function">get_state</span><span class="symbol">()</span><span class="normal"> </span><span class="symbol">==</span><span class="normal"> BUTTON_CLICKED</span><span class="symbol">)</span>
<span class="normal">            </span><span class="function">le_testlevel</span><span class="symbol">();</span>
<span class="normal">          le_save_level_bt</span><span class="symbol">-&gt;</span><span class="function">event</span><span class="symbol">(</span><span class="normal">event</span><span class="symbol">);</span>
<span class="normal">          </span><span class="keyword">if</span><span class="symbol">(</span><span class="normal">le_save_level_bt</span><span class="symbol">-&gt;</span><span class="function">get_state</span><span class="symbol">()</span><span class="normal"> </span><span class="symbol">==</span><span class="normal"> BUTTON_CLICKED</span><span class="symbol">)</span>
<span class="normal">            le_world</span><span class="symbol">-&gt;</span><span class="function">get_level</span><span class="symbol">()-&gt;</span><span class="function">save</span><span class="symbol">(</span><span class="normal">le_level_subset</span><span class="symbol">-&gt;</span><span class="normal">name</span><span class="symbol">.</span><span class="function">c_str</span><span class="symbol">(),</span><span class="normal">le_level</span><span class="symbol">);</span>
<span class="normal">          le_exit_bt</span><span class="symbol">-&gt;</span><span class="function">event</span><span class="symbol">(</span><span class="normal">event</span><span class="symbol">);</span>
<span class="normal">          </span><span class="keyword">if</span><span class="symbol">(</span><span class="normal">le_exit_bt</span><span class="symbol">-&gt;</span><span class="function">get_state</span><span class="symbol">()</span><span class="normal"> </span><span class="symbol">==</span><span class="normal"> BUTTON_CLICKED</span><span class="symbol">)</span>
<span class="normal">          </span><span class="cbracket">{</span>
<span class="normal">            Menu</span><span class="symbol">::</span><span class="function">set_current</span><span class="symbol">(</span><span class="normal">leveleditor_menu</span><span class="symbol">);</span>
<span class="normal">          </span><span class="cbracket">}</span>
<span class="normal">          le_next_level_bt</span><span class="symbol">-&gt;</span><span class="function">event</span><span class="symbol">(</span><span class="normal">event</span><span class="symbol">);</span>
<span class="normal">          </span><span class="keyword">if</span><span class="symbol">(</span><span class="normal">le_next_level_bt</span><span class="symbol">-&gt;</span><span class="function">get_state</span><span class="symbol">()</span><span class="normal"> </span><span class="symbol">==</span><span class="normal"> BUTTON_CLICKED</span><span class="symbol">)</span>
<span class="normal">          </span><span class="cbracket">{</span>
<span class="normal">            </span><span class="keyword">if</span><span class="symbol">(</span><span class="normal">le_level </span><span class="symbol">&lt;</span><span class="normal"> le_level_subset</span><span class="symbol">-&gt;</span><span class="normal">levels</span><span class="symbol">)</span>
<span class="normal">            </span><span class="cbracket">{</span>
<span class="normal">              </span><span class="function">le_goto_level</span><span class="symbol">(</span><span class="normal">le_level</span><span class="symbol">+</span><span class="number">1</span><span class="symbol">);</span>
<span class="normal">            </span><span class="cbracket">}</span>
<span class="normal">            </span><span class="keyword">else</span>
<span class="normal">            </span><span class="cbracket">{</span>
<span class="normal">              </span><span class="usertype">Level</span><span class="normal"> new_lev</span><span class="symbol">;</span>
<span class="normal">              </span><span class="type">char</span><span class="normal"> str</span><span class="symbol">[</span><span class="number">1024</span><span class="symbol">];</span>
<span class="normal">              </span><span class="function">sprintf</span><span class="symbol">(</span><span class="normal">str</span><span class="symbol">,</span><span class="string">"Level %d doesn't exist. Create it?"</span><span class="symbol">,</span><span class="normal">le_level</span><span class="symbol">+</span><span class="number">1</span><span class="symbol">);</span>
<span class="normal">              </span><span class="keyword">if</span><span class="symbol">(</span><span class="function">confirm_dialog</span><span class="symbol">(</span><span class="normal">str</span><span class="symbol">))</span>
<span class="normal">              </span><span class="cbracket">{</span>
<span class="normal">                new_lev</span><span class="symbol">.</span><span class="function">init_defaults</span><span class="symbol">();</span>
<span class="normal">                new_lev</span><span class="symbol">.</span><span class="function">save</span><span class="symbol">(</span><span class="normal">le_level_subset</span><span class="symbol">-&gt;</span><span class="normal">name</span><span class="symbol">.</span><span class="function">c_str</span><span class="symbol">(),</span><span class="normal">le_level</span><span class="symbol">+</span><span class="number">1</span><span class="symbol">);</span>
<span class="normal">                le_level_subset</span><span class="symbol">-&gt;</span><span class="normal">levels </span><span class="symbol">=</span><span class="normal"> le_level</span><span class="symbol">;</span>
<span class="normal">                </span><span class="function">le_goto_level</span><span class="symbol">(</span><span class="normal">le_level</span><span class="symbol">);</span>
<span class="normal">              </span><span class="cbracket">}</span>
<span class="normal">            </span><span class="cbracket">}</span>
<span class="normal">          </span><span class="cbracket">}</span>
<span class="normal">          le_previous_level_bt</span><span class="symbol">-&gt;</span><span class="function">event</span><span class="symbol">(</span><span class="normal">event</span><span class="symbol">);</span>
<span class="normal">          </span><span class="keyword">if</span><span class="symbol">(</span><span class="normal">le_previous_level_bt</span><span class="symbol">-&gt;</span><span class="function">get_state</span><span class="symbol">()</span><span class="normal"> </span><span class="symbol">==</span><span class="normal"> BUTTON_CLICKED</span><span class="symbol">)</span>
<span class="normal">          </span><span class="cbracket">{</span>
<span class="normal">            </span><span class="keyword">if</span><span class="symbol">(</span><span class="normal">le_level </span><span class="symbol">&gt;</span><span class="normal"> </span><span class="number">1</span><span class="symbol">)</span>
<span class="normal">              </span><span class="function">le_goto_level</span><span class="symbol">(</span><span class="normal">le_level </span><span class="symbol">-</span><span class="number">1</span><span class="symbol">);</span>
<span class="normal">          </span><span class="cbracket">}</span>
<span class="normal">          le_rubber_bt</span><span class="symbol">-&gt;</span><span class="function">event</span><span class="symbol">(</span><span class="normal">event</span><span class="symbol">);</span>
<span class="normal">          </span><span class="keyword">if</span><span class="symbol">(</span><span class="normal">le_rubber_bt</span><span class="symbol">-&gt;</span><span class="function">get_state</span><span class="symbol">()</span><span class="normal"> </span><span class="symbol">==</span><span class="normal"> BUTTON_CLICKED</span><span class="symbol">)</span>
<span class="normal">            le_current</span><span class="symbol">.</span><span class="function">Tile</span><span class="symbol">(</span><span class="number">0</span><span class="symbol">);</span>

<span class="normal">          </span><span class="keyword">if</span><span class="symbol">(!</span><span class="normal">cur_objects</span><span class="symbol">.</span><span class="function">empty</span><span class="symbol">())</span>
<span class="normal">          </span><span class="cbracket">{</span>
<span class="normal">            le_object_select_bt</span><span class="symbol">-&gt;</span><span class="function">event</span><span class="symbol">(</span><span class="normal">event</span><span class="symbol">);</span>
<span class="normal">            </span><span class="keyword">if</span><span class="symbol">(</span><span class="normal">le_object_select_bt</span><span class="symbol">-&gt;</span><span class="function">get_state</span><span class="symbol">()</span><span class="normal"> </span><span class="symbol">==</span><span class="normal"> BUTTON_CLICKED</span><span class="symbol">)</span>
<span class="normal">            </span><span class="cbracket">{</span>
<span class="normal">              MouseCursor</span><span class="symbol">::</span><span class="function">set_current</span><span class="symbol">(</span><span class="normal">mouse_select_object</span><span class="symbol">);</span>
<span class="normal">            </span><span class="cbracket">}</span>

<span class="normal">            le_object_properties_bt</span><span class="symbol">-&gt;</span><span class="function">event</span><span class="symbol">(</span><span class="normal">event</span><span class="symbol">);</span>
<span class="normal">            </span><span class="keyword">if</span><span class="symbol">(</span><span class="normal">le_object_properties_bt</span><span class="symbol">-&gt;</span><span class="function">get_state</span><span class="symbol">()</span><span class="normal"> </span><span class="symbol">==</span><span class="normal"> BUTTON_CLICKED</span><span class="symbol">)</span>
<span class="normal">            </span><span class="cbracket">{</span>
<span class="normal">              </span><span class="function">le_change_object_properties</span><span class="symbol">(</span><span class="normal">selected_game_object</span><span class="symbol">);</span>
<span class="normal">            </span><span class="cbracket">}</span>
<span class="normal">          </span><span class="cbracket">}</span>


<span class="normal">          </span><span class="keyword">if</span><span class="symbol">(</span><span class="normal">le_selection_mode </span><span class="symbol">==</span><span class="normal"> SM_SQUARE</span><span class="symbol">)</span>
<span class="normal">          </span><span class="cbracket">{</span>
<span class="normal">            le_select_mode_one_bt</span><span class="symbol">-&gt;</span><span class="function">event</span><span class="symbol">(</span><span class="normal">event</span><span class="symbol">);</span>
<span class="normal">            </span><span class="keyword">if</span><span class="symbol">(</span><span class="normal">le_select_mode_one_bt</span><span class="symbol">-&gt;</span><span class="function">get_state</span><span class="symbol">()</span><span class="normal"> </span><span class="symbol">==</span><span class="normal"> BUTTON_CLICKED</span><span class="symbol">)</span>
<span class="normal">              le_selection_mode </span><span class="symbol">=</span><span class="normal"> SM_CURSOR</span><span class="symbol">;</span>
<span class="normal">          </span><span class="cbracket">}</span>
<span class="normal">          </span><span class="keyword">else</span>
<span class="normal">          </span><span class="cbracket">{</span>
<span class="normal">            le_select_mode_two_bt</span><span class="symbol">-&gt;</span><span class="function">event</span><span class="symbol">(</span><span class="normal">event</span><span class="symbol">);</span>
<span class="normal">            </span><span class="keyword">if</span><span class="symbol">(</span><span class="normal">le_select_mode_two_bt</span><span class="symbol">-&gt;</span><span class="function">get_state</span><span class="symbol">()</span><span class="normal"> </span><span class="symbol">==</span><span class="normal"> BUTTON_CLICKED</span><span class="symbol">)</span>
<span class="normal">              le_selection_mode </span><span class="symbol">=</span><span class="normal"> SM_SQUARE</span><span class="symbol">;</span>
<span class="normal">          </span><span class="cbracket">}</span>
<span class="normal">          ButtonPanelMap</span><span class="symbol">::</span><span class="usertype">iterator</span><span class="normal"> it</span><span class="symbol">;</span>
<span class="normal">          le_tilegroup_bt</span><span class="symbol">-&gt;</span><span class="function">event</span><span class="symbol">(</span><span class="normal">event</span><span class="symbol">);</span>
<span class="normal">          </span><span class="keyword">switch</span><span class="normal"> </span><span class="symbol">(</span><span class="normal">le_tilegroup_bt</span><span class="symbol">-&gt;</span><span class="function">get_state</span><span class="symbol">())</span>
<span class="normal">          </span><span class="cbracket">{</span>
<span class="normal">          </span><span class="keyword">case</span><span class="normal"> BUTTON_CLICKED</span><span class="symbol">:</span>
<span class="normal">            Menu</span><span class="symbol">::</span><span class="function">set_current</span><span class="symbol">(</span><span class="normal">select_tilegroup_menu</span><span class="symbol">);</span>
<span class="normal">            select_tilegroup_menu_effect</span><span class="symbol">.</span><span class="function">start</span><span class="symbol">(</span><span class="number">200</span><span class="symbol">);</span>
<span class="normal">            select_tilegroup_menu</span><span class="symbol">-&gt;</span><span class="function">set_pos</span><span class="symbol">(</span><span class="normal">screen</span><span class="symbol">-&gt;</span><span class="normal">w </span><span class="symbol">-</span><span class="normal"> </span><span class="number">64</span><span class="symbol">,</span><span class="number">100</span><span class="symbol">,-</span><span class="number">0.5</span><span class="symbol">,</span><span class="number">0.5</span><span class="symbol">);</span>
<span class="normal">            </span><span class="keyword">break</span><span class="symbol">;</span>
<span class="normal">          </span><span class="keyword">case</span><span class="normal"> BUTTON_WHEELUP</span><span class="symbol">:</span>
<span class="normal">            </span><span class="keyword">if</span><span class="symbol">(</span><span class="normal">cur_tilegroup</span><span class="symbol">.</span><span class="function">empty</span><span class="symbol">())</span>
<span class="normal">            </span><span class="cbracket">{</span>
<span class="normal">              cur_tilegroup </span><span class="symbol">=</span><span class="normal"> tilegroups_map</span><span class="symbol">.</span><span class="function">begin</span><span class="symbol">()-&gt;</span><span class="normal">first</span><span class="symbol">;</span>
<span class="normal">            </span><span class="cbracket">}</span>
<span class="normal">            </span><span class="keyword">else</span>
<span class="normal">            </span><span class="cbracket">{</span>
<span class="normal">              it </span><span class="symbol">=</span><span class="normal"> tilegroups_map</span><span class="symbol">.</span><span class="function">find</span><span class="symbol">(</span><span class="normal">cur_tilegroup</span><span class="symbol">);</span>
<span class="normal">              </span><span class="keyword">if</span><span class="symbol">((++</span><span class="normal">it</span><span class="symbol">)</span><span class="normal"> </span><span class="symbol">==</span><span class="normal"> tilegroups_map</span><span class="symbol">.</span><span class="function">end</span><span class="symbol">())</span>
<span class="normal">              </span><span class="cbracket">{</span>
<span class="normal">                cur_tilegroup </span><span class="symbol">=</span><span class="normal"> tilegroups_map</span><span class="symbol">.</span><span class="function">begin</span><span class="symbol">()-&gt;</span><span class="normal">first</span><span class="symbol">;</span>
<span class="normal">              </span><span class="cbracket">}</span>
<span class="normal">              </span><span class="keyword">else</span>
<span class="normal">              </span><span class="cbracket">{</span>
<span class="normal">                cur_tilegroup </span><span class="symbol">=</span><span class="normal"> </span><span class="symbol">(*</span><span class="normal">it</span><span class="symbol">).</span><span class="normal">first</span><span class="symbol">;</span>
<span class="normal">              </span><span class="cbracket">}</span>
<span class="normal">            </span><span class="cbracket">}</span>

<span class="normal">            cur_objects </span><span class="symbol">=</span><span class="normal"> </span><span class="string">""</span><span class="symbol">;</span>
<span class="normal">            </span><span class="keyword">break</span><span class="symbol">;</span>
<span class="normal">          </span><span class="keyword">case</span><span class="normal"> BUTTON_WHEELDOWN</span><span class="symbol">:</span>
<span class="normal">            it </span><span class="symbol">=</span><span class="normal"> tilegroups_map</span><span class="symbol">.</span><span class="function">find</span><span class="symbol">(</span><span class="normal">cur_tilegroup</span><span class="symbol">);</span>
<span class="normal">            </span><span class="keyword">if</span><span class="symbol">(</span><span class="normal">it </span><span class="symbol">==</span><span class="normal"> tilegroups_map</span><span class="symbol">.</span><span class="function">begin</span><span class="symbol">())</span>
<span class="normal">            </span><span class="cbracket">{</span>
<span class="normal">              cur_tilegroup </span><span class="symbol">=</span><span class="normal"> tilegroups_map</span><span class="symbol">.</span><span class="function">rbegin</span><span class="symbol">()-&gt;</span><span class="normal">first</span><span class="symbol">;</span>
<span class="normal">              cur_objects </span><span class="symbol">=</span><span class="normal"> </span><span class="string">""</span><span class="symbol">;</span>
<span class="normal">              </span><span class="keyword">break</span><span class="symbol">;</span>
<span class="normal">            </span><span class="cbracket">}</span>
<span class="normal">            </span><span class="keyword">if</span><span class="symbol">(--</span><span class="normal">it </span><span class="symbol">!=</span><span class="normal"> </span><span class="symbol">--</span><span class="normal">tilegroups_map</span><span class="symbol">.</span><span class="function">begin</span><span class="symbol">())</span>
<span class="normal">              cur_tilegroup </span><span class="symbol">=</span><span class="normal"> </span><span class="symbol">(*</span><span class="normal">it</span><span class="symbol">).</span><span class="normal">first</span><span class="symbol">;</span>
<span class="normal">            </span><span class="keyword">else</span>
<span class="normal">              cur_tilegroup </span><span class="symbol">=</span><span class="normal"> tilegroups_map</span><span class="symbol">.</span><span class="function">rbegin</span><span class="symbol">()-&gt;</span><span class="normal">first</span><span class="symbol">;</span>

<span class="normal">            cur_objects </span><span class="symbol">=</span><span class="normal"> </span><span class="string">""</span><span class="symbol">;</span>
<span class="normal">            </span><span class="keyword">break</span><span class="symbol">;</span>
<span class="label">          default:</span>
<span class="normal">            </span><span class="keyword">break</span><span class="symbol">;</span>
<span class="normal">          </span><span class="cbracket">}</span>

<span class="normal">          le_objects_bt</span><span class="symbol">-&gt;</span><span class="function">event</span><span class="symbol">(</span><span class="normal">event</span><span class="symbol">);</span>
<span class="normal">          </span><span class="keyword">switch</span><span class="normal"> </span><span class="symbol">(</span><span class="normal">le_objects_bt</span><span class="symbol">-&gt;</span><span class="function">get_state</span><span class="symbol">())</span>
<span class="normal">          </span><span class="cbracket">{</span>
<span class="normal">          </span><span class="keyword">case</span><span class="normal"> BUTTON_CLICKED</span><span class="symbol">:</span>
<span class="normal">            Menu</span><span class="symbol">::</span><span class="function">set_current</span><span class="symbol">(</span><span class="normal">select_objects_menu</span><span class="symbol">);</span>
<span class="normal">            select_objects_menu_effect</span><span class="symbol">.</span><span class="function">start</span><span class="symbol">(</span><span class="number">200</span><span class="symbol">);</span>
<span class="normal">            select_objects_menu</span><span class="symbol">-&gt;</span><span class="function">set_pos</span><span class="symbol">(</span><span class="normal">screen</span><span class="symbol">-&gt;</span><span class="normal">w </span><span class="symbol">-</span><span class="normal"> </span><span class="number">64</span><span class="symbol">,</span><span class="number">100</span><span class="symbol">,-</span><span class="number">0.5</span><span class="symbol">,</span><span class="number">0.5</span><span class="symbol">);</span>
<span class="normal">            </span><span class="keyword">break</span><span class="symbol">;</span>
<span class="normal">          </span><span class="keyword">case</span><span class="normal"> BUTTON_WHEELUP</span><span class="symbol">:</span>
<span class="normal">            it </span><span class="symbol">=</span><span class="normal"> objects_map</span><span class="symbol">.</span><span class="function">find</span><span class="symbol">(</span><span class="normal">cur_objects</span><span class="symbol">);</span>
<span class="normal">            </span><span class="keyword">if</span><span class="symbol">(</span><span class="normal">it </span><span class="symbol">==</span><span class="normal"> objects_map</span><span class="symbol">.</span><span class="function">end</span><span class="symbol">())</span>
<span class="normal">            </span><span class="cbracket">{</span>
<span class="normal">              cur_objects </span><span class="symbol">=</span><span class="normal"> objects_map</span><span class="symbol">.</span><span class="function">begin</span><span class="symbol">()-&gt;</span><span class="normal">first</span><span class="symbol">;</span>
<span class="normal">              cur_tilegroup </span><span class="symbol">=</span><span class="normal"> </span><span class="string">""</span><span class="symbol">;</span>
<span class="normal">              </span><span class="keyword">break</span><span class="symbol">;</span>
<span class="normal">            </span><span class="cbracket">}</span>
<span class="normal">            </span><span class="keyword">if</span><span class="symbol">(++</span><span class="normal">it </span><span class="symbol">!=</span><span class="normal"> objects_map</span><span class="symbol">.</span><span class="function">end</span><span class="symbol">())</span>
<span class="normal">              cur_objects </span><span class="symbol">=</span><span class="normal"> </span><span class="symbol">(*</span><span class="normal">it</span><span class="symbol">).</span><span class="normal">first</span><span class="symbol">;</span>
<span class="normal">            </span><span class="keyword">else</span>
<span class="normal">              cur_objects </span><span class="symbol">=</span><span class="normal"> objects_map</span><span class="symbol">.</span><span class="function">begin</span><span class="symbol">()-&gt;</span><span class="normal">first</span><span class="symbol">;</span>

<span class="normal">            cur_tilegroup </span><span class="symbol">=</span><span class="normal"> </span><span class="string">""</span><span class="symbol">;</span>
<span class="normal">            </span><span class="keyword">break</span><span class="symbol">;</span>
<span class="normal">          </span><span class="keyword">case</span><span class="normal"> BUTTON_WHEELDOWN</span><span class="symbol">:</span>
<span class="normal">            it </span><span class="symbol">=</span><span class="normal"> objects_map</span><span class="symbol">.</span><span class="function">find</span><span class="symbol">(</span><span class="normal">cur_objects</span><span class="symbol">);</span>
<span class="normal">            </span><span class="keyword">if</span><span class="symbol">(</span><span class="normal">it </span><span class="symbol">==</span><span class="normal"> objects_map</span><span class="symbol">.</span><span class="function">begin</span><span class="symbol">())</span>
<span class="normal">            </span><span class="cbracket">{</span>
<span class="normal">              cur_objects </span><span class="symbol">=</span><span class="normal"> objects_map</span><span class="symbol">.</span><span class="function">rbegin</span><span class="symbol">()-&gt;</span><span class="normal">first</span><span class="symbol">;</span>
<span class="normal">              cur_tilegroup </span><span class="symbol">=</span><span class="normal"> </span><span class="string">""</span><span class="symbol">;</span>
<span class="normal">              </span><span class="keyword">break</span><span class="symbol">;</span>
<span class="normal">            </span><span class="cbracket">}</span>
<span class="normal">            </span><span class="keyword">if</span><span class="symbol">(--</span><span class="normal">it </span><span class="symbol">!=</span><span class="normal"> </span><span class="symbol">--</span><span class="normal">objects_map</span><span class="symbol">.</span><span class="function">begin</span><span class="symbol">())</span>
<span class="normal">              cur_objects </span><span class="symbol">=</span><span class="normal"> </span><span class="symbol">(*</span><span class="normal">it</span><span class="symbol">).</span><span class="normal">first</span><span class="symbol">;</span>
<span class="normal">            </span><span class="keyword">else</span>
<span class="normal">              cur_objects </span><span class="symbol">=</span><span class="normal"> objects_map</span><span class="symbol">.</span><span class="function">rbegin</span><span class="symbol">()-&gt;</span><span class="normal">first</span><span class="symbol">;</span>

<span class="normal">            cur_tilegroup </span><span class="symbol">=</span><span class="normal"> </span><span class="string">""</span><span class="symbol">;</span>
<span class="normal">            </span><span class="keyword">break</span><span class="symbol">;</span>
<span class="normal">            </span><span class="keyword">break</span><span class="symbol">;</span>
<span class="label">          default:</span>
<span class="normal">            </span><span class="keyword">break</span><span class="symbol">;</span>
<span class="normal">          </span><span class="cbracket">}</span>

<span class="normal">          le_settings_bt</span><span class="symbol">-&gt;</span><span class="function">event</span><span class="symbol">(</span><span class="normal">event</span><span class="symbol">);</span>
<span class="normal">          </span><span class="keyword">if</span><span class="symbol">(</span><span class="normal">le_settings_bt</span><span class="symbol">-&gt;</span><span class="function">get_state</span><span class="symbol">()</span><span class="normal"> </span><span class="symbol">==</span><span class="normal"> BUTTON_CLICKED</span><span class="symbol">)</span>
<span class="normal">          </span><span class="cbracket">{</span>
<span class="normal">            </span><span class="function">update_level_settings_menu</span><span class="symbol">();</span>
<span class="normal">            Menu</span><span class="symbol">::</span><span class="function">set_current</span><span class="symbol">(</span><span class="normal">level_settings_menu</span><span class="symbol">);</span>
<span class="normal">          </span><span class="cbracket">}</span>
<span class="normal">          </span><span class="keyword">if</span><span class="symbol">(!</span><span class="normal">cur_tilegroup</span><span class="symbol">.</span><span class="function">empty</span><span class="symbol">())</span>
<span class="normal">          </span><span class="cbracket">{</span>
<span class="normal">            </span><span class="keyword">if</span><span class="symbol">((</span><span class="normal">pbutton </span><span class="symbol">=</span><span class="normal"> tilegroups_map</span><span class="symbol">[</span><span class="normal">cur_tilegroup</span><span class="symbol">]-&gt;</span><span class="function">event</span><span class="symbol">(</span><span class="normal">event</span><span class="symbol">))</span><span class="normal"> </span><span class="symbol">!=</span><span class="normal"> NULL</span><span class="symbol">)</span>
<span class="normal">            </span><span class="cbracket">{</span>
<span class="normal">              </span><span class="keyword">if</span><span class="symbol">(</span><span class="normal">pbutton</span><span class="symbol">-&gt;</span><span class="function">get_state</span><span class="symbol">()</span><span class="normal"> </span><span class="symbol">==</span><span class="normal"> BUTTON_CLICKED</span><span class="symbol">)</span>
<span class="normal">              </span><span class="cbracket">{</span>
<span class="normal">                le_current</span><span class="symbol">.</span><span class="function">Tile</span><span class="symbol">(</span><span class="normal">pbutton</span><span class="symbol">-&gt;</span><span class="function">get_tag</span><span class="symbol">());</span>
<span class="normal">              </span><span class="cbracket">}</span>
<span class="normal">            </span><span class="cbracket">}</span>
<span class="normal">          </span><span class="cbracket">}</span>
<span class="normal">          </span><span class="keyword">else</span><span class="normal"> </span><span class="keyword">if</span><span class="symbol">(!</span><span class="normal">cur_objects</span><span class="symbol">.</span><span class="function">empty</span><span class="symbol">())</span>
<span class="normal">          </span><span class="cbracket">{</span>
<span class="normal">            </span><span class="keyword">if</span><span class="symbol">((</span><span class="normal">pbutton </span><span class="symbol">=</span><span class="normal"> objects_map</span><span class="symbol">[</span><span class="normal">cur_objects</span><span class="symbol">]-&gt;</span><span class="function">event</span><span class="symbol">(</span><span class="normal">event</span><span class="symbol">))</span><span class="normal"> </span><span class="symbol">!=</span><span class="normal"> NULL</span><span class="symbol">)</span>
<span class="normal">            </span><span class="cbracket">{</span>
<span class="normal">              </span><span class="keyword">if</span><span class="symbol">(</span><span class="normal">pbutton</span><span class="symbol">-&gt;</span><span class="function">get_state</span><span class="symbol">()</span><span class="normal"> </span><span class="symbol">==</span><span class="normal"> BUTTON_CLICKED</span><span class="symbol">)</span>
<span class="normal">              </span><span class="cbracket">{</span>
<span class="normal">                le_current</span><span class="symbol">.</span><span class="function">Object</span><span class="symbol">(</span><span class="normal">pbutton</span><span class="symbol">-&gt;</span><span class="function">get_game_object</span><span class="symbol">());</span>
<span class="normal">              </span><span class="cbracket">}</span>
<span class="normal">            </span><span class="cbracket">}</span>
<span class="normal">          </span><span class="cbracket">}</span>

<span class="normal">          </span><span class="keyword">if</span><span class="symbol">((</span><span class="normal">pbutton </span><span class="symbol">=</span><span class="normal"> le_tilemap_panel</span><span class="symbol">-&gt;</span><span class="function">event</span><span class="symbol">(</span><span class="normal">event</span><span class="symbol">))</span><span class="normal"> </span><span class="symbol">!=</span><span class="normal"> NULL</span><span class="symbol">)</span>
<span class="normal">          </span><span class="cbracket">{</span>
<span class="normal">            </span><span class="keyword">if</span><span class="symbol">(</span><span class="normal">pbutton</span><span class="symbol">-&gt;</span><span class="function">get_state</span><span class="symbol">()</span><span class="normal"> </span><span class="symbol">==</span><span class="normal"> BUTTON_CLICKED</span><span class="symbol">)</span>
<span class="normal">            </span><span class="cbracket">{</span>
<span class="normal">              active_tm </span><span class="symbol">=</span><span class="normal"> </span><span class="keyword">static_cast</span><span class="symbol">&lt;</span><span class="normal">TileMapType</span><span class="symbol">&gt;(</span><span class="normal">pbutton</span><span class="symbol">-&gt;</span><span class="function">get_tag</span><span class="symbol">());</span>
<span class="normal">            </span><span class="cbracket">}</span>
<span class="normal">          </span><span class="cbracket">}</span>
<span class="normal">        </span><span class="cbracket">}</span>
<span class="normal">        </span><span class="keyword">else</span>
<span class="normal">        </span><span class="cbracket">{</span>
<span class="normal">          le_settings_bt</span><span class="symbol">-&gt;</span><span class="function">event</span><span class="symbol">(</span><span class="normal">event</span><span class="symbol">);</span>
<span class="normal">          </span><span class="keyword">if</span><span class="symbol">(</span><span class="normal">le_settings_bt</span><span class="symbol">-&gt;</span><span class="function">get_state</span><span class="symbol">()</span><span class="normal"> </span><span class="symbol">==</span><span class="normal"> BUTTON_CLICKED</span><span class="symbol">)</span>
<span class="normal">          </span><span class="cbracket">{</span>
<span class="normal">            Menu</span><span class="symbol">::</span><span class="function">set_current</span><span class="symbol">(</span><span class="number">0</span><span class="symbol">);</span>
<span class="normal">          </span><span class="cbracket">}</span>
<span class="normal">          le_tilegroup_bt</span><span class="symbol">-&gt;</span><span class="function">event</span><span class="symbol">(</span><span class="normal">event</span><span class="symbol">);</span>
<span class="normal">          </span><span class="keyword">if</span><span class="symbol">(</span><span class="normal">le_tilegroup_bt</span><span class="symbol">-&gt;</span><span class="function">get_state</span><span class="symbol">()</span><span class="normal"> </span><span class="symbol">==</span><span class="normal"> BUTTON_CLICKED</span><span class="symbol">)</span>
<span class="normal">          </span><span class="cbracket">{</span>
<span class="normal">            Menu</span><span class="symbol">::</span><span class="function">set_current</span><span class="symbol">(</span><span class="number">0</span><span class="symbol">);</span>
<span class="normal">          </span><span class="cbracket">}</span>
<span class="normal">          le_objects_bt</span><span class="symbol">-&gt;</span><span class="function">event</span><span class="symbol">(</span><span class="normal">event</span><span class="symbol">);</span>
<span class="normal">          </span><span class="keyword">if</span><span class="symbol">(</span><span class="normal">le_objects_bt</span><span class="symbol">-&gt;</span><span class="function">get_state</span><span class="symbol">()</span><span class="normal"> </span><span class="symbol">==</span><span class="normal"> BUTTON_CLICKED</span><span class="symbol">)</span>
<span class="normal">          </span><span class="cbracket">{</span>
<span class="normal">            Menu</span><span class="symbol">::</span><span class="function">set_current</span><span class="symbol">(</span><span class="number">0</span><span class="symbol">);</span>
<span class="normal">          </span><span class="cbracket">}</span>
<span class="normal">        </span><span class="cbracket">}</span>
<span class="normal">      </span><span class="cbracket">}</span>

<span class="normal">      </span><span class="keyword">if</span><span class="symbol">(!</span><span class="normal">Menu</span><span class="symbol">::</span><span class="function">current</span><span class="symbol">()</span><span class="normal"> </span><span class="symbol">&amp;&amp;</span><span class="normal"> </span><span class="symbol">!</span><span class="normal">show_minimap</span><span class="symbol">)</span>
<span class="normal">      </span><span class="cbracket">{</span>
<span class="normal">        </span><span class="keyword">if</span><span class="symbol">(</span><span class="normal">le_mouse_pressed</span><span class="symbol">[</span><span class="normal">LEFT</span><span class="symbol">])</span>
<span class="normal">        </span><span class="cbracket">{</span>
<span class="normal">          </span><span class="keyword">if</span><span class="symbol">(</span><span class="normal">MouseCursor</span><span class="symbol">::</span><span class="function">current</span><span class="symbol">()</span><span class="normal"> </span><span class="symbol">!=</span><span class="normal"> mouse_select_object</span><span class="symbol">)</span>
<span class="normal">          </span><span class="cbracket">{</span>
<span class="normal">            </span><span class="keyword">if</span><span class="symbol">(</span><span class="normal">le_current</span><span class="symbol">.</span><span class="function">IsTile</span><span class="symbol">())</span>
<span class="normal">              </span><span class="function">le_change</span><span class="symbol">(</span><span class="normal">cursor_x</span><span class="symbol">,</span><span class="normal"> cursor_y</span><span class="symbol">,</span><span class="normal"> active_tm</span><span class="symbol">,</span><span class="normal"> le_current</span><span class="symbol">.</span><span class="normal">tile</span><span class="symbol">);</span>
<span class="normal">          </span><span class="cbracket">}</span>
<span class="normal">        </span><span class="cbracket">}</span>
<span class="normal">        </span><span class="keyword">else</span><span class="normal"> </span><span class="keyword">if</span><span class="symbol">(</span><span class="normal">le_mouse_clicked</span><span class="symbol">[</span><span class="normal">LEFT</span><span class="symbol">])</span>
<span class="normal">        </span><span class="cbracket">{</span>
<span class="normal">          </span><span class="keyword">if</span><span class="symbol">(</span><span class="normal">MouseCursor</span><span class="symbol">::</span><span class="function">current</span><span class="symbol">()</span><span class="normal"> </span><span class="symbol">==</span><span class="normal"> mouse_select_object</span><span class="symbol">)</span>
<span class="normal">          </span><span class="cbracket">{</span>
<span class="normal">            </span><span class="type">int</span><span class="normal"> i </span><span class="symbol">=</span><span class="normal"> </span><span class="number">0</span><span class="symbol">;</span>
<span class="normal">            </span><span class="type">bool</span><span class="normal"> object_got_hit </span><span class="symbol">=</span><span class="normal"> </span><span class="keyword">false</span><span class="symbol">;</span>
<span class="normal">            </span><span class="usertype">base_type</span><span class="normal"> cursor_base</span><span class="symbol">;</span>
<span class="normal">	    </span><span class="keyword">if</span><span class="symbol">(</span><span class="normal">le_current</span><span class="symbol">.</span><span class="function">IsTile</span><span class="symbol">())</span>
<span class="normal">	    </span><span class="cbracket">{</span>
<span class="normal">            cursor_base</span><span class="symbol">.</span><span class="normal">x </span><span class="symbol">=</span><span class="normal"> cursor_x</span><span class="symbol">;</span>
<span class="normal">            cursor_base</span><span class="symbol">.</span><span class="normal">y </span><span class="symbol">=</span><span class="normal"> cursor_y</span><span class="symbol">;</span>
<span class="normal">	    </span><span class="cbracket">}</span>
<span class="normal">	    </span><span class="keyword">else</span><span class="normal"> </span><span class="keyword">if</span><span class="symbol">(</span><span class="normal">le_current</span><span class="symbol">.</span><span class="function">IsObject</span><span class="symbol">())</span>
<span class="normal">	    </span><span class="cbracket">{</span>
<span class="normal">            cursor_base</span><span class="symbol">.</span><span class="normal">x </span><span class="symbol">=</span><span class="normal"> cursor_x </span><span class="symbol">+</span><span class="normal"> pos_x</span><span class="symbol">;</span>
<span class="normal">            cursor_base</span><span class="symbol">.</span><span class="normal">y </span><span class="symbol">=</span><span class="normal"> cursor_y </span><span class="symbol">+</span><span class="normal"> pos_x</span><span class="symbol">;</span><span class="normal">	    </span>
<span class="normal">	    </span><span class="cbracket">}</span>
<span class="normal">            cursor_base</span><span class="symbol">.</span><span class="normal">width </span><span class="symbol">=</span><span class="normal"> </span><span class="number">32</span><span class="symbol">;</span>
<span class="normal">            cursor_base</span><span class="symbol">.</span><span class="normal">height </span><span class="symbol">=</span><span class="normal"> </span><span class="number">32</span><span class="symbol">;</span>

<span class="normal">            </span><span class="keyword">for</span><span class="symbol">(</span><span class="normal">std</span><span class="symbol">::</span><span class="normal">list</span><span class="symbol">&lt;</span><span class="normal">BadGuy</span><span class="symbol">*&gt;::</span><span class="usertype">iterator</span><span class="normal"> it </span><span class="symbol">=</span><span class="normal"> le_world</span><span class="symbol">-&gt;</span><span class="normal">bad_guys</span><span class="symbol">.</span><span class="function">begin</span><span class="symbol">();</span><span class="normal"> it </span><span class="symbol">!=</span><span class="normal"> le_world</span><span class="symbol">-&gt;</span><span class="normal">bad_guys</span><span class="symbol">.</span><span class="function">end</span><span class="symbol">();</span><span class="normal"> </span><span class="symbol">++</span><span class="normal">it</span><span class="symbol">,</span><span class="normal"> </span><span class="symbol">++</span><span class="normal">i</span><span class="symbol">)</span>
<span class="normal">              </span><span class="keyword">if</span><span class="symbol">(</span><span class="function">rectcollision</span><span class="symbol">(</span><span class="normal">cursor_base</span><span class="symbol">,(*</span><span class="normal">it</span><span class="symbol">)-&gt;</span><span class="normal">base</span><span class="symbol">))</span>
<span class="normal">              </span><span class="cbracket">{</span>
<span class="normal">                selected_game_object </span><span class="symbol">=</span><span class="normal"> </span><span class="symbol">(*</span><span class="normal">it</span><span class="symbol">);</span>
<span class="normal">                object_got_hit </span><span class="symbol">=</span><span class="normal"> </span><span class="keyword">true</span><span class="symbol">;</span>
<span class="normal">                </span><span class="keyword">break</span><span class="symbol">;</span>
<span class="normal">              </span><span class="cbracket">}</span>

<span class="normal">            </span><span class="keyword">if</span><span class="symbol">(!</span><span class="normal">object_got_hit</span><span class="symbol">)</span>
<span class="normal">            </span><span class="cbracket">{</span>
<span class="normal">              selected_game_object </span><span class="symbol">=</span><span class="normal"> NULL</span><span class="symbol">;</span>
<span class="normal">              le_object_properties_bt</span><span class="symbol">-&gt;</span><span class="function">set_active</span><span class="symbol">(</span><span class="keyword">false</span><span class="symbol">);</span>
<span class="normal">            </span><span class="cbracket">}</span>
<span class="normal">            </span><span class="keyword">else</span>
<span class="normal">              le_object_properties_bt</span><span class="symbol">-&gt;</span><span class="function">set_active</span><span class="symbol">(</span><span class="keyword">true</span><span class="symbol">);</span>

<span class="normal">            MouseCursor</span><span class="symbol">::</span><span class="function">set_current</span><span class="symbol">(</span><span class="normal">mouse_cursor</span><span class="symbol">);</span>

<span class="normal">          </span><span class="cbracket">}</span>
<span class="normal">          </span><span class="keyword">else</span>
<span class="normal">          </span><span class="cbracket">{</span>
<span class="normal">            </span><span class="keyword">if</span><span class="symbol">(</span><span class="normal">le_current</span><span class="symbol">.</span><span class="function">IsObject</span><span class="symbol">())</span>
<span class="normal">            </span><span class="cbracket">{</span>
<span class="normal">              le_level_changed  </span><span class="symbol">=</span><span class="normal"> </span><span class="keyword">true</span><span class="symbol">;</span>
<span class="normal">              std</span><span class="symbol">::</span><span class="usertype">string</span><span class="normal"> type </span><span class="symbol">=</span><span class="normal"> le_current</span><span class="symbol">.</span><span class="normal">obj</span><span class="symbol">-&gt;</span><span class="function">type</span><span class="symbol">();</span>
<span class="normal">              </span><span class="keyword">if</span><span class="symbol">(</span><span class="normal">type </span><span class="symbol">==</span><span class="normal"> </span><span class="string">"BadGuy"</span><span class="symbol">)</span>
<span class="normal">              </span><span class="cbracket">{</span>
<span class="normal">                BadGuy</span><span class="symbol">*</span><span class="normal"> pbadguy </span><span class="symbol">=</span><span class="normal"> </span><span class="keyword">dynamic_cast</span><span class="symbol">&lt;</span><span class="normal">BadGuy</span><span class="symbol">*&gt;(</span><span class="normal">le_current</span><span class="symbol">.</span><span class="normal">obj</span><span class="symbol">);</span>

<span class="normal">                le_world</span><span class="symbol">-&gt;</span><span class="normal">bad_guys</span><span class="symbol">.</span><span class="function">push_back</span><span class="symbol">(</span><span class="keyword">new</span><span class="normal"> </span><span class="function">BadGuy</span><span class="symbol">(</span><span class="normal">cursor_x</span><span class="symbol">+</span><span class="normal">scroll_x</span><span class="symbol">,</span><span class="normal"> cursor_y</span><span class="symbol">,</span><span class="normal">pbadguy</span><span class="symbol">-&gt;</span><span class="normal">kind</span><span class="symbol">,</span><span class="keyword">false</span><span class="symbol">));</span>
<span class="normal">                le_world</span><span class="symbol">-&gt;</span><span class="function">get_level</span><span class="symbol">()-&gt;</span><span class="normal">badguy_data</span><span class="symbol">.</span><span class="function">push_back</span><span class="symbol">(</span><span class="normal">le_world</span><span class="symbol">-&gt;</span><span class="normal">bad_guys</span><span class="symbol">.</span><span class="function">back</span><span class="symbol">());</span>
<span class="normal">              </span><span class="cbracket">}</span>
<span class="normal">            </span><span class="cbracket">}</span>
<span class="normal">          </span><span class="cbracket">}</span>
<span class="normal">	  </span>
<span class="normal">          le_mouse_clicked</span><span class="symbol">[</span><span class="normal">LEFT</span><span class="symbol">]</span><span class="normal"> </span><span class="symbol">=</span><span class="normal"> </span><span class="keyword">false</span><span class="symbol">;</span>

<span class="normal">        </span><span class="cbracket">}</span>
<span class="normal">      </span><span class="cbracket">}</span>
<span class="normal">    </span><span class="cbracket">}</span>
<span class="normal">  </span><span class="cbracket">}</span>
<span class="normal">  </span><span class="keyword">if</span><span class="symbol">(!</span><span class="normal">Menu</span><span class="symbol">::</span><span class="function">current</span><span class="symbol">())</span>
<span class="normal">  </span><span class="cbracket">{</span>
<span class="normal">    show_minimap </span><span class="symbol">=</span><span class="normal"> </span><span class="keyword">false</span><span class="symbol">;</span>

<span class="normal">    le_move_left_bt</span><span class="symbol">-&gt;</span><span class="function">event</span><span class="symbol">(</span><span class="normal">event</span><span class="symbol">);</span>
<span class="normal">    le_move_right_bt</span><span class="symbol">-&gt;</span><span class="function">event</span><span class="symbol">(</span><span class="normal">event</span><span class="symbol">);</span>
<span class="normal">    </span><span class="keyword">switch</span><span class="symbol">(</span><span class="normal">le_move_left_bt</span><span class="symbol">-&gt;</span><span class="function">get_state</span><span class="symbol">())</span>
<span class="normal">    </span><span class="cbracket">{</span>
<span class="normal">    </span><span class="keyword">case</span><span class="normal"> BUTTON_PRESSED</span><span class="symbol">:</span>
<span class="normal">      pos_x </span><span class="symbol">-=</span><span class="normal"> </span><span class="number">192</span><span class="symbol">;</span>
<span class="normal">      show_minimap </span><span class="symbol">=</span><span class="normal"> </span><span class="keyword">true</span><span class="symbol">;</span>
<span class="normal">      </span><span class="keyword">break</span><span class="symbol">;</span>
<span class="normal">    </span><span class="keyword">case</span><span class="normal"> BUTTON_HOVER</span><span class="symbol">:</span>
<span class="normal">      pos_x </span><span class="symbol">-=</span><span class="normal"> </span><span class="number">32</span><span class="symbol">;</span>
<span class="normal">      show_minimap </span><span class="symbol">=</span><span class="normal"> </span><span class="keyword">true</span><span class="symbol">;</span>
<span class="normal">      </span><span class="keyword">break</span><span class="symbol">;</span>
<span class="normal">    </span><span class="keyword">case</span><span class="normal"> BUTTON_CLICKED</span><span class="symbol">:</span>
<span class="normal">      show_minimap </span><span class="symbol">=</span><span class="normal"> </span><span class="keyword">true</span><span class="symbol">;</span>
<span class="normal">      </span><span class="keyword">break</span><span class="symbol">;</span>
<span class="label">    default:</span>
<span class="normal">      </span><span class="keyword">break</span><span class="symbol">;</span>
<span class="normal">    </span><span class="cbracket">}</span>

<span class="normal">    </span><span class="keyword">switch</span><span class="symbol">(</span><span class="normal">le_move_right_bt</span><span class="symbol">-&gt;</span><span class="function">get_state</span><span class="symbol">())</span>
<span class="normal">    </span><span class="cbracket">{</span>
<span class="normal">    </span><span class="keyword">case</span><span class="normal"> BUTTON_PRESSED</span><span class="symbol">:</span>
<span class="normal">      pos_x </span><span class="symbol">+=</span><span class="normal"> </span><span class="number">192</span><span class="symbol">;</span>
<span class="normal">      show_minimap </span><span class="symbol">=</span><span class="normal"> </span><span class="keyword">true</span><span class="symbol">;</span>
<span class="normal">      </span><span class="keyword">break</span><span class="symbol">;</span>
<span class="normal">    </span><span class="keyword">case</span><span class="normal"> BUTTON_HOVER</span><span class="symbol">:</span>
<span class="normal">      pos_x </span><span class="symbol">+=</span><span class="normal"> </span><span class="number">32</span><span class="symbol">;</span>
<span class="normal">      show_minimap </span><span class="symbol">=</span><span class="normal"> </span><span class="keyword">true</span><span class="symbol">;</span>
<span class="normal">      </span><span class="keyword">break</span><span class="symbol">;</span>
<span class="normal">    </span><span class="keyword">case</span><span class="normal"> BUTTON_CLICKED</span><span class="symbol">:</span>
<span class="normal">      show_minimap </span><span class="symbol">=</span><span class="normal"> </span><span class="keyword">true</span><span class="symbol">;</span>
<span class="normal">      </span><span class="keyword">break</span><span class="symbol">;</span>
<span class="label">    default:</span>
<span class="normal">      </span><span class="keyword">break</span><span class="symbol">;</span>
<span class="normal">    </span><span class="cbracket">}</span>

<span class="normal">  </span><span class="keyword">if</span><span class="symbol">(</span><span class="normal">le_mouse_pressed</span><span class="symbol">[</span><span class="normal">RIGHT</span><span class="symbol">])</span>
<span class="normal">    show_minimap </span><span class="symbol">=</span><span class="normal"> </span><span class="keyword">true</span><span class="symbol">;</span>
<span class="normal">  </span><span class="cbracket">}</span>

<span class="cbracket">}</span>

<span class="type">void</span><span class="normal"> </span><span class="function">le_highlight_selection</span><span class="symbol">()</span>
<span class="cbracket">{</span>
<span class="normal">  </span><span class="type">int</span><span class="normal"> x1</span><span class="symbol">,</span><span class="normal"> x2</span><span class="symbol">,</span><span class="normal"> y1</span><span class="symbol">,</span><span class="normal"> y2</span><span class="symbol">;</span>

<span class="normal">  </span><span class="keyword">if</span><span class="symbol">(</span><span class="normal">selection</span><span class="symbol">.</span><span class="normal">x1 </span><span class="symbol">&lt;</span><span class="normal"> selection</span><span class="symbol">.</span><span class="normal">x2</span><span class="symbol">)</span>
<span class="normal">  </span><span class="cbracket">{</span>
<span class="normal">    x1 </span><span class="symbol">=</span><span class="normal"> selection</span><span class="symbol">.</span><span class="normal">x1</span><span class="symbol">;</span>
<span class="normal">    x2 </span><span class="symbol">=</span><span class="normal"> selection</span><span class="symbol">.</span><span class="normal">x2</span><span class="symbol">;</span>
<span class="normal">  </span><span class="cbracket">}</span>
<span class="normal">  </span><span class="keyword">else</span>
<span class="normal">  </span><span class="cbracket">{</span>
<span class="normal">    x1 </span><span class="symbol">=</span><span class="normal"> selection</span><span class="symbol">.</span><span class="normal">x2</span><span class="symbol">;</span>
<span class="normal">    x2 </span><span class="symbol">=</span><span class="normal"> selection</span><span class="symbol">.</span><span class="normal">x1</span><span class="symbol">;</span>
<span class="normal">  </span><span class="cbracket">}</span>
<span class="normal">  </span><span class="keyword">if</span><span class="symbol">(</span><span class="normal">selection</span><span class="symbol">.</span><span class="normal">y1 </span><span class="symbol">&lt;</span><span class="normal"> selection</span><span class="symbol">.</span><span class="normal">y2</span><span class="symbol">)</span>
<span class="normal">  </span><span class="cbracket">{</span>
<span class="normal">    y1 </span><span class="symbol">=</span><span class="normal"> selection</span><span class="symbol">.</span><span class="normal">y1</span><span class="symbol">;</span>
<span class="normal">    y2 </span><span class="symbol">=</span><span class="normal"> selection</span><span class="symbol">.</span><span class="normal">y2</span><span class="symbol">;</span>
<span class="normal">  </span><span class="cbracket">}</span>
<span class="normal">  </span><span class="keyword">else</span>
<span class="normal">  </span><span class="cbracket">{</span>
<span class="normal">    y1 </span><span class="symbol">=</span><span class="normal"> selection</span><span class="symbol">.</span><span class="normal">y2</span><span class="symbol">;</span>
<span class="normal">    y2 </span><span class="symbol">=</span><span class="normal"> selection</span><span class="symbol">.</span><span class="normal">y1</span><span class="symbol">;</span>
<span class="normal">  </span><span class="cbracket">}</span>

<span class="normal">  x1 </span><span class="symbol">/=</span><span class="normal"> </span><span class="number">32</span><span class="symbol">;</span>
<span class="normal">  x2 </span><span class="symbol">/=</span><span class="normal"> </span><span class="number">32</span><span class="symbol">;</span>
<span class="normal">  y1 </span><span class="symbol">/=</span><span class="normal"> </span><span class="number">32</span><span class="symbol">;</span>
<span class="normal">  y2 </span><span class="symbol">/=</span><span class="normal"> </span><span class="number">32</span><span class="symbol">;</span>

<span class="normal">  </span><span class="function">fillrect</span><span class="symbol">(</span><span class="normal">x1</span><span class="symbol">*</span><span class="number">32</span><span class="symbol">-</span><span class="normal">pos_x</span><span class="symbol">,</span><span class="normal"> y1</span><span class="symbol">*</span><span class="number">32</span><span class="symbol">,</span><span class="number">32</span><span class="symbol">*</span><span class="normal"> </span><span class="symbol">(</span><span class="normal">x2 </span><span class="symbol">-</span><span class="normal"> x1 </span><span class="symbol">+</span><span class="normal"> </span><span class="number">1</span><span class="symbol">),</span><span class="number">32</span><span class="normal"> </span><span class="symbol">*</span><span class="normal"> </span><span class="symbol">(</span><span class="normal">y2 </span><span class="symbol">-</span><span class="normal"> y1 </span><span class="symbol">+</span><span class="normal"> </span><span class="number">1</span><span class="symbol">),</span><span class="number">173</span><span class="symbol">,</span><span class="number">234</span><span class="symbol">,</span><span class="number">177</span><span class="symbol">,</span><span class="number">103</span><span class="symbol">);</span>
<span class="cbracket">}</span>

<span class="type">void</span><span class="normal"> </span><span class="function">le_change</span><span class="symbol">(</span><span class="type">float</span><span class="normal"> x</span><span class="symbol">,</span><span class="normal"> </span><span class="type">float</span><span class="normal"> y</span><span class="symbol">,</span><span class="normal"> </span><span class="type">int</span><span class="normal"> tm</span><span class="symbol">,</span><span class="normal"> </span><span class="type">unsigned</span><span class="normal"> </span><span class="type">int</span><span class="normal"> c</span><span class="symbol">)</span>
<span class="cbracket">{</span>
<span class="normal">  </span><span class="keyword">if</span><span class="symbol">(</span><span class="normal">le_world </span><span class="symbol">!=</span><span class="normal"> NULL</span><span class="symbol">)</span>
<span class="normal">  </span><span class="cbracket">{</span>
<span class="normal">    </span><span class="type">int</span><span class="normal"> xx</span><span class="symbol">,</span><span class="normal">yy</span><span class="symbol">;</span>
<span class="normal">    </span><span class="type">int</span><span class="normal"> x1</span><span class="symbol">,</span><span class="normal"> x2</span><span class="symbol">,</span><span class="normal"> y1</span><span class="symbol">,</span><span class="normal"> y2</span><span class="symbol">;</span>
<span class="normal">    </span><span class="type">unsigned</span><span class="normal"> </span><span class="type">int</span><span class="normal"> i </span><span class="symbol">=</span><span class="normal"> </span><span class="number">0</span><span class="symbol">;</span>

<span class="normal">    le_level_changed </span><span class="symbol">=</span><span class="normal"> </span><span class="keyword">true</span><span class="symbol">;</span>

<span class="normal">    </span><span class="keyword">switch</span><span class="symbol">(</span><span class="normal">le_selection_mode</span><span class="symbol">)</span>
<span class="normal">    </span><span class="cbracket">{</span>
<span class="normal">    </span><span class="keyword">case</span><span class="normal"> SM_CURSOR</span><span class="symbol">:</span>
<span class="normal">      le_world</span><span class="symbol">-&gt;</span><span class="function">get_level</span><span class="symbol">()-&gt;</span><span class="function">change</span><span class="symbol">(</span><span class="normal">x</span><span class="symbol">,</span><span class="normal">y</span><span class="symbol">,</span><span class="normal">tm</span><span class="symbol">,</span><span class="normal">c</span><span class="symbol">);</span>

<span class="normal">      </span><span class="usertype">base_type</span><span class="normal"> cursor_base</span><span class="symbol">;</span>
<span class="normal">      cursor_base</span><span class="symbol">.</span><span class="normal">x </span><span class="symbol">=</span><span class="normal"> x</span><span class="symbol">;</span>
<span class="normal">      cursor_base</span><span class="symbol">.</span><span class="normal">y </span><span class="symbol">=</span><span class="normal"> y</span><span class="symbol">;</span>
<span class="normal">      cursor_base</span><span class="symbol">.</span><span class="normal">width </span><span class="symbol">=</span><span class="normal"> </span><span class="number">32</span><span class="symbol">;</span>
<span class="normal">      cursor_base</span><span class="symbol">.</span><span class="normal">height </span><span class="symbol">=</span><span class="normal"> </span><span class="number">32</span><span class="symbol">;</span>

<span class="normal">      </span><span class="comment">/* if there is a bad guy over there, remove it */</span>
<span class="normal">      </span><span class="keyword">for</span><span class="symbol">(</span><span class="normal">std</span><span class="symbol">::</span><span class="normal">list</span><span class="symbol">&lt;</span><span class="normal">BadGuy</span><span class="symbol">*&gt;::</span><span class="usertype">iterator</span><span class="normal"> it </span><span class="symbol">=</span><span class="normal"> le_world</span><span class="symbol">-&gt;</span><span class="normal">bad_guys</span><span class="symbol">.</span><span class="function">begin</span><span class="symbol">();</span><span class="normal"> it </span><span class="symbol">!=</span><span class="normal"> le_world</span><span class="symbol">-&gt;</span><span class="normal">bad_guys</span><span class="symbol">.</span><span class="function">end</span><span class="symbol">();</span><span class="normal"> </span><span class="symbol">++</span><span class="normal">it</span><span class="symbol">,</span><span class="normal"> </span><span class="symbol">++</span><span class="normal">i</span><span class="symbol">)</span>
<span class="normal">        </span><span class="keyword">if</span><span class="symbol">(</span><span class="function">rectcollision</span><span class="symbol">(</span><span class="normal">cursor_base</span><span class="symbol">,(*</span><span class="normal">it</span><span class="symbol">)-&gt;</span><span class="normal">base</span><span class="symbol">))</span>
<span class="normal">        </span><span class="cbracket">{</span>
<span class="normal">          </span><span class="keyword">delete</span><span class="normal"> </span><span class="symbol">(*</span><span class="normal">it</span><span class="symbol">);</span>
<span class="normal">          le_world</span><span class="symbol">-&gt;</span><span class="normal">bad_guys</span><span class="symbol">.</span><span class="function">erase</span><span class="symbol">(</span><span class="normal">it</span><span class="symbol">);</span>
<span class="normal">          le_world</span><span class="symbol">-&gt;</span><span class="function">get_level</span><span class="symbol">()-&gt;</span><span class="normal">badguy_data</span><span class="symbol">.</span><span class="function">erase</span><span class="symbol">(</span><span class="normal">le_world</span><span class="symbol">-&gt;</span><span class="function">get_level</span><span class="symbol">()-&gt;</span><span class="normal">badguy_data</span><span class="symbol">.</span><span class="function">begin</span><span class="symbol">()</span><span class="normal"> </span><span class="symbol">+</span><span class="normal"> i</span><span class="symbol">);</span>
<span class="normal">          </span><span class="keyword">break</span><span class="symbol">;</span>
<span class="normal">        </span><span class="cbracket">}</span>

<span class="normal">      </span><span class="keyword">break</span><span class="symbol">;</span>
<span class="normal">    </span><span class="keyword">case</span><span class="normal"> SM_SQUARE</span><span class="symbol">:</span>
<span class="normal">      </span><span class="keyword">if</span><span class="symbol">(</span><span class="normal">selection</span><span class="symbol">.</span><span class="normal">x1 </span><span class="symbol">&lt;</span><span class="normal"> selection</span><span class="symbol">.</span><span class="normal">x2</span><span class="symbol">)</span>
<span class="normal">      </span><span class="cbracket">{</span>
<span class="normal">        x1 </span><span class="symbol">=</span><span class="normal"> selection</span><span class="symbol">.</span><span class="normal">x1</span><span class="symbol">;</span>
<span class="normal">        x2 </span><span class="symbol">=</span><span class="normal"> selection</span><span class="symbol">.</span><span class="normal">x2</span><span class="symbol">;</span>
<span class="normal">      </span><span class="cbracket">}</span>
<span class="normal">      </span><span class="keyword">else</span>
<span class="normal">      </span><span class="cbracket">{</span>
<span class="normal">        x1 </span><span class="symbol">=</span><span class="normal"> selection</span><span class="symbol">.</span><span class="normal">x2</span><span class="symbol">;</span>
<span class="normal">        x2 </span><span class="symbol">=</span><span class="normal"> selection</span><span class="symbol">.</span><span class="normal">x1</span><span class="symbol">;</span>
<span class="normal">      </span><span class="cbracket">}</span>
<span class="normal">      </span><span class="keyword">if</span><span class="symbol">(</span><span class="normal">selection</span><span class="symbol">.</span><span class="normal">y1 </span><span class="symbol">&lt;</span><span class="normal"> selection</span><span class="symbol">.</span><span class="normal">y2</span><span class="symbol">)</span>
<span class="normal">      </span><span class="cbracket">{</span>
<span class="normal">        y1 </span><span class="symbol">=</span><span class="normal"> selection</span><span class="symbol">.</span><span class="normal">y1</span><span class="symbol">;</span>
<span class="normal">        y2 </span><span class="symbol">=</span><span class="normal"> selection</span><span class="symbol">.</span><span class="normal">y2</span><span class="symbol">;</span>
<span class="normal">      </span><span class="cbracket">}</span>
<span class="normal">      </span><span class="keyword">else</span>
<span class="normal">      </span><span class="cbracket">{</span>
<span class="normal">        y1 </span><span class="symbol">=</span><span class="normal"> selection</span><span class="symbol">.</span><span class="normal">y2</span><span class="symbol">;</span>
<span class="normal">        y2 </span><span class="symbol">=</span><span class="normal"> selection</span><span class="symbol">.</span><span class="normal">y1</span><span class="symbol">;</span>
<span class="normal">      </span><span class="cbracket">}</span>

<span class="normal">      x1 </span><span class="symbol">/=</span><span class="normal"> </span><span class="number">32</span><span class="symbol">;</span>
<span class="normal">      x2 </span><span class="symbol">/=</span><span class="normal"> </span><span class="number">32</span><span class="symbol">;</span>
<span class="normal">      y1 </span><span class="symbol">/=</span><span class="normal"> </span><span class="number">32</span><span class="symbol">;</span>
<span class="normal">      y2 </span><span class="symbol">/=</span><span class="normal"> </span><span class="number">32</span><span class="symbol">;</span>

<span class="normal">      </span><span class="comment">/* if there is a bad guy over there, remove it */</span>
<span class="normal">      </span><span class="keyword">for</span><span class="symbol">(</span><span class="normal">std</span><span class="symbol">::</span><span class="normal">list</span><span class="symbol">&lt;</span><span class="normal">BadGuy</span><span class="symbol">*&gt;::</span><span class="usertype">iterator</span><span class="normal"> it </span><span class="symbol">=</span><span class="normal"> le_world</span><span class="symbol">-&gt;</span><span class="normal">bad_guys</span><span class="symbol">.</span><span class="function">begin</span><span class="symbol">();</span>
<span class="normal">          it </span><span class="symbol">!=</span><span class="normal"> le_world</span><span class="symbol">-&gt;</span><span class="normal">bad_guys</span><span class="symbol">.</span><span class="function">end</span><span class="symbol">();</span><span class="normal"> </span><span class="comment">/* will be at end of loop */</span><span class="symbol">)</span>
<span class="normal">      </span><span class="cbracket">{</span>
<span class="normal">        </span><span class="keyword">if</span><span class="symbol">((*</span><span class="normal">it</span><span class="symbol">)-&gt;</span><span class="normal">base</span><span class="symbol">.</span><span class="normal">x</span><span class="symbol">/</span><span class="number">32</span><span class="normal"> </span><span class="symbol">&gt;=</span><span class="normal"> x1 </span><span class="symbol">&amp;&amp;</span><span class="normal"> </span><span class="symbol">(*</span><span class="normal">it</span><span class="symbol">)-&gt;</span><span class="normal">base</span><span class="symbol">.</span><span class="normal">x</span><span class="symbol">/</span><span class="number">32</span><span class="normal"> </span><span class="symbol">&lt;=</span><span class="normal"> x2</span>
<span class="normal">            </span><span class="symbol">&amp;&amp;</span><span class="normal"> </span><span class="symbol">(*</span><span class="normal">it</span><span class="symbol">)-&gt;</span><span class="normal">base</span><span class="symbol">.</span><span class="normal">y</span><span class="symbol">/</span><span class="number">32</span><span class="normal"> </span><span class="symbol">&gt;=</span><span class="normal"> y1 </span><span class="symbol">&amp;&amp;</span><span class="normal"> </span><span class="symbol">(*</span><span class="normal">it</span><span class="symbol">)-&gt;</span><span class="normal">base</span><span class="symbol">.</span><span class="normal">y</span><span class="symbol">/</span><span class="number">32</span><span class="normal"> </span><span class="symbol">&lt;=</span><span class="normal"> y2</span><span class="symbol">)</span>
<span class="normal">        </span><span class="cbracket">{</span>
<span class="normal">          </span><span class="keyword">delete</span><span class="normal"> </span><span class="symbol">(*</span><span class="normal">it</span><span class="symbol">);</span>
<span class="normal">          it </span><span class="symbol">=</span><span class="normal"> le_world</span><span class="symbol">-&gt;</span><span class="normal">bad_guys</span><span class="symbol">.</span><span class="function">erase</span><span class="symbol">(</span><span class="normal">it</span><span class="symbol">);</span>
<span class="normal">          le_world</span><span class="symbol">-&gt;</span><span class="function">get_level</span><span class="symbol">()-&gt;</span><span class="normal">badguy_data</span><span class="symbol">.</span><span class="function">erase</span><span class="symbol">(</span><span class="normal">le_world</span><span class="symbol">-&gt;</span><span class="function">get_level</span><span class="symbol">()-&gt;</span><span class="normal">badguy_data</span><span class="symbol">.</span><span class="function">begin</span><span class="symbol">()</span><span class="normal"> </span><span class="symbol">+</span><span class="normal"> i</span><span class="symbol">);</span>
<span class="normal">          </span><span class="keyword">continue</span><span class="symbol">;</span>
<span class="normal">        </span><span class="cbracket">}</span>
<span class="normal">        </span><span class="keyword">else</span>
<span class="normal">        </span><span class="cbracket">{</span>
<span class="normal">          </span><span class="symbol">++</span><span class="normal">i</span><span class="symbol">;</span>
<span class="normal">          </span><span class="symbol">++</span><span class="normal">it</span><span class="symbol">;</span>
<span class="normal">        </span><span class="cbracket">}</span>
<span class="normal">      </span><span class="cbracket">}</span>

<span class="normal">      </span><span class="keyword">for</span><span class="symbol">(</span><span class="normal">xx </span><span class="symbol">=</span><span class="normal"> x1</span><span class="symbol">;</span><span class="normal"> xx </span><span class="symbol">&lt;=</span><span class="normal"> x2</span><span class="symbol">;</span><span class="normal"> xx</span><span class="symbol">++)</span>
<span class="normal">        </span><span class="keyword">for</span><span class="symbol">(</span><span class="normal">yy </span><span class="symbol">=</span><span class="normal"> y1</span><span class="symbol">;</span><span class="normal"> yy </span><span class="symbol">&lt;=</span><span class="normal"> y2</span><span class="symbol">;</span><span class="normal"> yy</span><span class="symbol">++)</span>
<span class="normal">        </span><span class="cbracket">{</span>
<span class="normal">          le_world</span><span class="symbol">-&gt;</span><span class="function">get_level</span><span class="symbol">()-&gt;</span><span class="function">change</span><span class="symbol">(</span><span class="normal">xx</span><span class="symbol">*</span><span class="number">32</span><span class="symbol">,</span><span class="normal"> yy</span><span class="symbol">*</span><span class="number">32</span><span class="symbol">,</span><span class="normal"> tm</span><span class="symbol">,</span><span class="normal"> c</span><span class="symbol">);</span>

<span class="normal">        </span><span class="cbracket">}</span>
<span class="normal">      </span><span class="keyword">break</span><span class="symbol">;</span>
<span class="label">    default:</span>
<span class="normal">      </span><span class="keyword">break</span><span class="symbol">;</span>
<span class="normal">    </span><span class="cbracket">}</span>
<span class="normal">  </span><span class="cbracket">}</span>
<span class="cbracket">}</span>

<span class="type">void</span><span class="normal"> </span><span class="function">le_testlevel</span><span class="symbol">()</span>
<span class="cbracket">{</span>
<span class="normal">  </span><span class="comment">//Make sure a time value is set when testing the level</span>
<span class="normal">  </span><span class="keyword">if</span><span class="symbol">(</span><span class="normal">le_world</span><span class="symbol">-&gt;</span><span class="function">get_level</span><span class="symbol">()-&gt;</span><span class="normal">time_left </span><span class="symbol">==</span><span class="normal"> </span><span class="number">0</span><span class="symbol">)</span>
<span class="normal">    le_world</span><span class="symbol">-&gt;</span><span class="function">get_level</span><span class="symbol">()-&gt;</span><span class="normal">time_left </span><span class="symbol">=</span><span class="normal"> </span><span class="number">250</span><span class="symbol">;</span>

<span class="normal">  le_world</span><span class="symbol">-&gt;</span><span class="function">get_level</span><span class="symbol">()-&gt;</span><span class="function">save</span><span class="symbol">(</span><span class="string">"test"</span><span class="symbol">,</span><span class="normal"> le_level</span><span class="symbol">);</span>

<span class="normal">  </span><span class="usertype">GameSession</span><span class="normal"> </span><span class="function">session</span><span class="symbol">(</span><span class="string">"test"</span><span class="symbol">,</span><span class="normal">le_level</span><span class="symbol">,</span><span class="normal"> ST_GL_TEST</span><span class="symbol">);</span>
<span class="normal">  session</span><span class="symbol">.</span><span class="function">run</span><span class="symbol">();</span>
<span class="normal">  player_status</span><span class="symbol">.</span><span class="function">reset</span><span class="symbol">();</span>

<span class="normal">  music_manager</span><span class="symbol">-&gt;</span><span class="function">halt_music</span><span class="symbol">();</span>

<span class="normal">  Menu</span><span class="symbol">::</span><span class="function">set_current</span><span class="symbol">(</span><span class="normal">NULL</span><span class="symbol">);</span>
<span class="normal">  World</span><span class="symbol">::</span><span class="function">set_current</span><span class="symbol">(</span><span class="normal">le_world</span><span class="symbol">);</span>
<span class="cbracket">}</span>

<span class="type">void</span><span class="normal"> </span><span class="function">le_showhelp</span><span class="symbol">()</span>
<span class="cbracket">{</span>
<span class="normal">  </span><span class="type">bool</span><span class="normal"> tmp_show_grid </span><span class="symbol">=</span><span class="normal"> le_show_grid</span><span class="symbol">;</span>
<span class="normal">  </span><span class="type">int</span><span class="normal"> temp_le_selection_mode </span><span class="symbol">=</span><span class="normal"> le_selection_mode</span><span class="symbol">;</span>
<span class="normal">  le_selection_mode </span><span class="symbol">=</span><span class="normal"> SM_NONE</span><span class="symbol">;</span>
<span class="normal">  show_selections </span><span class="symbol">=</span><span class="normal"> </span><span class="keyword">true</span><span class="symbol">;</span>
<span class="normal">  le_show_grid </span><span class="symbol">=</span><span class="normal"> </span><span class="keyword">false</span><span class="symbol">;</span>
<span class="normal">  le_help_shown </span><span class="symbol">=</span><span class="normal"> </span><span class="keyword">true</span><span class="symbol">;</span>

<span class="normal">  </span><span class="function">drawgradient</span><span class="symbol">(</span><span class="function">Color</span><span class="symbol">(</span><span class="number">0</span><span class="symbol">,</span><span class="number">0</span><span class="symbol">,</span><span class="number">0</span><span class="symbol">),</span><span class="normal"> </span><span class="function">Color</span><span class="symbol">(</span><span class="number">255</span><span class="symbol">,</span><span class="number">255</span><span class="symbol">,</span><span class="number">255</span><span class="symbol">));</span>
<span class="normal">  </span><span class="function">le_drawinterface</span><span class="symbol">();</span>

<span class="normal">  </span><span class="usertype">SDL_Event</span><span class="normal"> event</span><span class="symbol">;</span>
<span class="normal">  </span><span class="type">unsigned</span><span class="normal"> </span><span class="type">int</span><span class="normal"> i</span><span class="symbol">,</span><span class="normal"> done_</span><span class="symbol">;</span>
<span class="normal">  </span><span class="type">char</span><span class="normal"> </span><span class="symbol">*</span><span class="normal">text</span><span class="symbol">[]</span><span class="normal"> </span><span class="symbol">=</span><span class="normal"> </span><span class="cbracket">{</span>

<span class="normal">                   </span><span class="string">" - Supertux level editor tutorial - "</span><span class="symbol">,</span>
<span class="normal">                   </span><span class="string">""</span><span class="symbol">,</span>
<span class="normal">                   </span><span class="string">"To make your map, click the       "</span><span class="symbol">,</span>
<span class="normal">                   </span><span class="string">"tilegroup button and choose a     "</span><span class="symbol">,</span>
<span class="normal">                   </span><span class="string">"tilegroup."</span><span class="symbol">,</span>
<span class="normal">                   </span><span class="string">"Pick a tile and simply hold down  "</span><span class="symbol">,</span>
<span class="normal">                   </span><span class="string">"the left mouse button over the map"</span><span class="symbol">,</span>
<span class="normal">                   </span><span class="string">"to </span><span class="specialchar">\"</span><span class="string">paint</span><span class="specialchar">\"</span><span class="string"> your selection over"</span><span class="symbol">,</span>
<span class="normal">                   </span><span class="string">"the screen."</span><span class="symbol">,</span>
<span class="normal">                   </span><span class="string">""</span><span class="symbol">,</span>
<span class="normal">                   </span><span class="string">"There are three layers for painting"</span><span class="symbol">,</span>
<span class="normal">                   </span><span class="string">"tiles upon, Background layer,"</span><span class="symbol">,</span>
<span class="normal">                   </span><span class="string">"the Interactive layer, and the"</span><span class="symbol">,</span>
<span class="normal">                   </span><span class="string">"Foreground layer, which can be"</span><span class="symbol">,</span>
<span class="normal">                   </span><span class="string">"toggled by the BkGrd, IntAct and"</span><span class="symbol">,</span>
<span class="normal">                   </span><span class="string">"FrGrd buttons. The Foreground and"</span><span class="symbol">,</span>
<span class="normal">                   </span><span class="string">"Background layers do not effect"</span><span class="symbol">,</span>
<span class="normal">                   </span><span class="string">"Tux in the gameplay, but lie in"</span><span class="symbol">,</span>
<span class="normal">                   </span><span class="string">"front of him or lie behind him in"</span><span class="symbol">,</span>
<span class="normal">                   </span><span class="string">"his adventures."</span><span class="symbol">,</span>
<span class="normal">                 </span><span class="cbracket">}</span><span class="symbol">;</span>

<span class="normal">  </span><span class="type">char</span><span class="normal"> </span><span class="symbol">*</span><span class="normal">text2</span><span class="symbol">[]</span><span class="normal"> </span><span class="symbol">=</span><span class="normal"> </span><span class="cbracket">{</span>

<span class="normal">                    </span><span class="string">" - Supertux level editor tutorial - "</span><span class="symbol">,</span>
<span class="normal">                    </span><span class="string">""</span><span class="symbol">,</span>
<span class="normal">                    </span><span class="string">"The tiles placed on"</span><span class="symbol">,</span>
<span class="normal">                    </span><span class="string">"the Interactive layer are those"</span><span class="symbol">,</span>
<span class="normal">                    </span><span class="string">"which actually effect Tux in the"</span><span class="symbol">,</span>
<span class="normal">                    </span><span class="string">"game."</span><span class="symbol">,</span>
<span class="normal">                    </span><span class="string">""</span><span class="symbol">,</span>
<span class="normal">                    </span><span class="string">"Click the objects menu to put "</span><span class="symbol">,</span>
<span class="normal">                    </span><span class="string">"bad guys and other objects in the"</span><span class="symbol">,</span>
<span class="normal">                    </span><span class="string">"game. Unlike placing tiles, you"</span><span class="symbol">,</span>
<span class="normal">                    </span><span class="string">"cannot </span><span class="specialchar">\"</span><span class="string">paint</span><span class="specialchar">\"</span><span class="string"> enemies. Click"</span><span class="symbol">,</span>
<span class="normal">                    </span><span class="string">"them onto the screen one at a time."</span><span class="symbol">,</span>
<span class="normal">                    </span><span class="string">""</span><span class="symbol">,</span>
<span class="normal">                    </span><span class="string">"To change the settings of your"</span><span class="symbol">,</span>
<span class="normal">                    </span><span class="string">"level, click the button with the"</span><span class="symbol">,</span>
<span class="normal">                    </span><span class="string">"screwdriver and wrench. From here"</span><span class="symbol">,</span>
<span class="normal">                    </span><span class="string">"you can change the background,"</span><span class="symbol">,</span>
<span class="normal">                    </span><span class="string">"music, length of the level,"</span><span class="symbol">,</span>
<span class="normal">                    </span><span class="string">"and more."</span>
<span class="normal">                  </span><span class="cbracket">}</span><span class="symbol">;</span>

<span class="normal">  </span><span class="type">char</span><span class="normal"> </span><span class="symbol">*</span><span class="normal">text3</span><span class="symbol">[]</span><span class="normal"> </span><span class="symbol">=</span><span class="normal"> </span><span class="cbracket">{</span>

<span class="normal">                    </span><span class="string">" - Supertux level editor tutorial - "</span><span class="symbol">,</span>
<span class="normal">                    </span><span class="string">""</span><span class="symbol">,</span>
<span class="normal">                    </span><span class="string">"You may have more than one level."</span><span class="symbol">,</span>
<span class="normal">                    </span><span class="string">"Pressing the up and down buttons"</span><span class="symbol">,</span>
<span class="normal">                    </span><span class="string">"above the button bar lets you"</span><span class="symbol">,</span>
<span class="normal">                    </span><span class="string">"choose which one you are working on."</span><span class="symbol">,</span>
<span class="normal">                    </span><span class="string">""</span><span class="symbol">,</span>
<span class="normal">                    </span><span class="string">"If you would like to speed up your"</span><span class="symbol">,</span>
<span class="normal">                    </span><span class="string">"level editing, a useful trick is"</span><span class="symbol">,</span>
<span class="normal">                    </span><span class="string">"to learn the keyboard shortcuts."</span><span class="symbol">,</span>
<span class="normal">                    </span><span class="string">"They are easy to learn, just right-"</span><span class="symbol">,</span>
<span class="normal">                    </span><span class="string">"click on the buttons."</span><span class="symbol">,</span>
<span class="normal">                    </span><span class="string">""</span><span class="symbol">,</span>
<span class="normal">                    </span><span class="string">"Have fun making levels! If you make"</span><span class="symbol">,</span>
<span class="normal">                    </span><span class="string">"some good ones, send them to us on"</span><span class="symbol">,</span>
<span class="normal">                    </span><span class="string">"the SuperTux mailing list!"</span><span class="symbol">,</span>
<span class="normal">                    </span><span class="string">"- SuperTux team"</span>
<span class="normal">                  </span><span class="cbracket">}</span><span class="symbol">;</span>



<span class="normal">  blue_text</span><span class="symbol">-&gt;</span><span class="function">drawf</span><span class="symbol">(</span><span class="string">"- Help -"</span><span class="symbol">,</span><span class="normal"> </span><span class="number">0</span><span class="symbol">,</span><span class="normal"> </span><span class="number">30</span><span class="symbol">,</span><span class="normal"> A_HMIDDLE</span><span class="symbol">,</span><span class="normal"> A_TOP</span><span class="symbol">,</span><span class="normal"> </span><span class="number">2</span><span class="symbol">);</span>

<span class="normal">  </span><span class="keyword">for</span><span class="symbol">(</span><span class="normal">i </span><span class="symbol">=</span><span class="normal"> </span><span class="number">0</span><span class="symbol">;</span><span class="normal"> i </span><span class="symbol">&lt;</span><span class="normal"> </span><span class="keyword">sizeof</span><span class="symbol">(</span><span class="normal">text</span><span class="symbol">)/</span><span class="keyword">sizeof</span><span class="symbol">(</span><span class="type">char</span><span class="normal"> </span><span class="symbol">*);</span><span class="normal"> i</span><span class="symbol">++)</span>
<span class="normal">    white_text</span><span class="symbol">-&gt;</span><span class="function">draw</span><span class="symbol">(</span><span class="normal">text</span><span class="symbol">[</span><span class="normal">i</span><span class="symbol">],</span><span class="normal"> </span><span class="number">5</span><span class="symbol">,</span><span class="normal"> </span><span class="number">80</span><span class="symbol">+(</span><span class="normal">i</span><span class="symbol">*</span><span class="normal">white_text</span><span class="symbol">-&gt;</span><span class="normal">h</span><span class="symbol">),</span><span class="normal"> </span><span class="number">1</span><span class="symbol">);</span>

<span class="normal">  gold_text</span><span class="symbol">-&gt;</span><span class="function">drawf</span><span class="symbol">(</span><span class="string">"Press Anything to Continue - Page 1/3"</span><span class="symbol">,</span><span class="normal"> </span><span class="number">0</span><span class="symbol">,</span><span class="normal"> </span><span class="number">0</span><span class="symbol">,</span><span class="normal"> A_LEFT</span><span class="symbol">,</span><span class="normal"> A_BOTTOM</span><span class="symbol">,</span><span class="normal"> </span><span class="number">1</span><span class="symbol">);</span>

<span class="normal">  </span><span class="function">flipscreen</span><span class="symbol">();</span>

<span class="normal">  done_ </span><span class="symbol">=</span><span class="normal"> </span><span class="number">0</span><span class="symbol">;</span>

<span class="normal">  </span><span class="keyword">while</span><span class="symbol">(</span><span class="normal">done_ </span><span class="symbol">==</span><span class="normal"> </span><span class="number">0</span><span class="symbol">)</span>
<span class="normal">  </span><span class="cbracket">{</span>
<span class="normal">    done_ </span><span class="symbol">=</span><span class="normal"> </span><span class="function">wait_for_event</span><span class="symbol">(</span><span class="normal">event</span><span class="symbol">);</span>
<span class="normal">    </span><span class="function">SDL_Delay</span><span class="symbol">(</span><span class="number">50</span><span class="symbol">);</span>
<span class="normal">  </span><span class="cbracket">}</span>

<span class="normal">  </span><span class="function">drawgradient</span><span class="symbol">(</span><span class="function">Color</span><span class="symbol">(</span><span class="number">0</span><span class="symbol">,</span><span class="number">0</span><span class="symbol">,</span><span class="number">0</span><span class="symbol">),</span><span class="normal"> </span><span class="function">Color</span><span class="symbol">(</span><span class="number">255</span><span class="symbol">,</span><span class="number">255</span><span class="symbol">,</span><span class="number">255</span><span class="symbol">));</span>
<span class="normal">  </span><span class="function">le_drawinterface</span><span class="symbol">();</span>


<span class="normal">  blue_text</span><span class="symbol">-&gt;</span><span class="function">drawf</span><span class="symbol">(</span><span class="string">"- Help -"</span><span class="symbol">,</span><span class="normal"> </span><span class="number">0</span><span class="symbol">,</span><span class="normal"> </span><span class="number">30</span><span class="symbol">,</span><span class="normal"> A_HMIDDLE</span><span class="symbol">,</span><span class="normal"> A_TOP</span><span class="symbol">,</span><span class="normal"> </span><span class="number">2</span><span class="symbol">);</span>

<span class="normal">  </span><span class="keyword">for</span><span class="symbol">(</span><span class="normal">i </span><span class="symbol">=</span><span class="normal"> </span><span class="number">0</span><span class="symbol">;</span><span class="normal"> i </span><span class="symbol">&lt;</span><span class="normal"> </span><span class="keyword">sizeof</span><span class="symbol">(</span><span class="normal">text2</span><span class="symbol">)/</span><span class="keyword">sizeof</span><span class="symbol">(</span><span class="type">char</span><span class="normal"> </span><span class="symbol">*);</span><span class="normal"> i</span><span class="symbol">++)</span>
<span class="normal">    white_text</span><span class="symbol">-&gt;</span><span class="function">draw</span><span class="symbol">(</span><span class="normal">text2</span><span class="symbol">[</span><span class="normal">i</span><span class="symbol">],</span><span class="normal"> </span><span class="number">5</span><span class="symbol">,</span><span class="normal"> </span><span class="number">80</span><span class="symbol">+(</span><span class="normal">i</span><span class="symbol">*</span><span class="normal">white_text</span><span class="symbol">-&gt;</span><span class="normal">h</span><span class="symbol">),</span><span class="normal"> </span><span class="number">1</span><span class="symbol">);</span>

<span class="normal">  gold_text</span><span class="symbol">-&gt;</span><span class="function">drawf</span><span class="symbol">(</span><span class="string">"Press Anything to Continue - Page 2/3"</span><span class="symbol">,</span><span class="normal"> </span><span class="number">0</span><span class="symbol">,</span><span class="normal"> </span><span class="number">0</span><span class="symbol">,</span><span class="normal"> A_LEFT</span><span class="symbol">,</span><span class="normal"> A_BOTTOM</span><span class="symbol">,</span><span class="normal"> </span><span class="number">1</span><span class="symbol">);</span>

<span class="normal">  </span><span class="function">flipscreen</span><span class="symbol">();</span>

<span class="normal">  done_ </span><span class="symbol">=</span><span class="normal"> </span><span class="number">0</span><span class="symbol">;</span>

<span class="normal">  </span><span class="keyword">while</span><span class="symbol">(</span><span class="normal">done_ </span><span class="symbol">==</span><span class="normal"> </span><span class="number">0</span><span class="symbol">)</span>
<span class="normal">  </span><span class="cbracket">{</span>
<span class="normal">    done_ </span><span class="symbol">=</span><span class="normal"> </span><span class="function">wait_for_event</span><span class="symbol">(</span><span class="normal">event</span><span class="symbol">);</span>
<span class="normal">    </span><span class="function">SDL_Delay</span><span class="symbol">(</span><span class="number">50</span><span class="symbol">);</span>
<span class="normal">  </span><span class="cbracket">}</span>

<span class="normal">  </span><span class="function">drawgradient</span><span class="symbol">(</span><span class="function">Color</span><span class="symbol">(</span><span class="number">0</span><span class="symbol">,</span><span class="number">0</span><span class="symbol">,</span><span class="number">0</span><span class="symbol">),</span><span class="normal"> </span><span class="function">Color</span><span class="symbol">(</span><span class="number">255</span><span class="symbol">,</span><span class="number">255</span><span class="symbol">,</span><span class="number">255</span><span class="symbol">));</span>
<span class="normal">  </span><span class="function">le_drawinterface</span><span class="symbol">();</span>


<span class="normal">  blue_text</span><span class="symbol">-&gt;</span><span class="function">drawf</span><span class="symbol">(</span><span class="string">"- Help -"</span><span class="symbol">,</span><span class="normal"> </span><span class="number">0</span><span class="symbol">,</span><span class="normal"> </span><span class="number">30</span><span class="symbol">,</span><span class="normal"> A_HMIDDLE</span><span class="symbol">,</span><span class="normal"> A_TOP</span><span class="symbol">,</span><span class="normal"> </span><span class="number">2</span><span class="symbol">);</span>

<span class="normal">  </span><span class="keyword">for</span><span class="symbol">(</span><span class="normal">i </span><span class="symbol">=</span><span class="normal"> </span><span class="number">0</span><span class="symbol">;</span><span class="normal"> i </span><span class="symbol">&lt;</span><span class="normal"> </span><span class="keyword">sizeof</span><span class="symbol">(</span><span class="normal">text3</span><span class="symbol">)/</span><span class="keyword">sizeof</span><span class="symbol">(</span><span class="type">char</span><span class="normal"> </span><span class="symbol">*);</span><span class="normal"> i</span><span class="symbol">++)</span>
<span class="normal">    white_text</span><span class="symbol">-&gt;</span><span class="function">draw</span><span class="symbol">(</span><span class="normal">text3</span><span class="symbol">[</span><span class="normal">i</span><span class="symbol">],</span><span class="normal"> </span><span class="number">5</span><span class="symbol">,</span><span class="normal"> </span><span class="number">80</span><span class="symbol">+(</span><span class="normal">i</span><span class="symbol">*</span><span class="normal">white_text</span><span class="symbol">-&gt;</span><span class="normal">h</span><span class="symbol">),</span><span class="normal"> </span><span class="number">1</span><span class="symbol">);</span>

<span class="normal">  gold_text</span><span class="symbol">-&gt;</span><span class="function">drawf</span><span class="symbol">(</span><span class="string">"Press Anything to Continue - Page 3/3"</span><span class="symbol">,</span><span class="normal"> </span><span class="number">0</span><span class="symbol">,</span><span class="normal"> </span><span class="number">0</span><span class="symbol">,</span><span class="normal"> A_LEFT</span><span class="symbol">,</span><span class="normal"> A_BOTTOM</span><span class="symbol">,</span><span class="normal"> </span><span class="number">1</span><span class="symbol">);</span>

<span class="normal">  </span><span class="function">flipscreen</span><span class="symbol">();</span>

<span class="normal">  done_ </span><span class="symbol">=</span><span class="normal"> </span><span class="number">0</span><span class="symbol">;</span>

<span class="normal">  </span><span class="keyword">while</span><span class="symbol">(</span><span class="normal">done_ </span><span class="symbol">==</span><span class="normal"> </span><span class="number">0</span><span class="symbol">)</span>
<span class="normal">  </span><span class="cbracket">{</span>
<span class="normal">    done_ </span><span class="symbol">=</span><span class="normal"> </span><span class="function">wait_for_event</span><span class="symbol">(</span><span class="normal">event</span><span class="symbol">);</span>
<span class="normal">    </span><span class="function">SDL_Delay</span><span class="symbol">(</span><span class="number">50</span><span class="symbol">);</span>
<span class="normal">  </span><span class="cbracket">}</span>

<span class="normal">  show_selections </span><span class="symbol">=</span><span class="normal"> </span><span class="keyword">true</span><span class="symbol">;</span>
<span class="normal">  le_show_grid </span><span class="symbol">=</span><span class="normal"> tmp_show_grid</span><span class="symbol">;</span>
<span class="normal">  le_selection_mode </span><span class="symbol">=</span><span class="normal"> temp_le_selection_mode</span><span class="symbol">;</span>
<span class="normal">  le_help_shown </span><span class="symbol">=</span><span class="normal"> </span><span class="keyword">false</span><span class="symbol">;</span>
<span class="cbracket">}</span>

<span class="preproc">#endif</span>
</tt></pre></div><div style="text-align: right; padding: 8pt; font-size: 13px"><a href="/xmlfeed/weblog-rss20.xml"><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAFAAAAAPAgMAAAAOp6AcAAAADFBMVEVmZmb/ZgD///+JjnlbTUWmAAAACXBIWXMAAABIAAAASABGyWs+AAAACXZwQWcAAABQAAAADwCexKkxAAAAWUlEQVQYlWNgwAa0VmGAFQyqoSCQ/x8J/CBFMCt0ZdTU/F/7/+1HEkydFpoKVPn+93sUlUujQvP/7UcRTAuNDJ2a//s/imDqtKVZofm/1qGYSZk7sfodGwAAiobBJtffoNAAAAAASUVORK5CYII=" alt="RSS 2.0 Weblog Feed" width="80" height="15"/></a> <a href="/xmlfeed/weblog-atom10.xml"><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAFAAAAAPAgMAAAAOp6AcAAAADFBMVEVmZmb/ZgD///+JjnlbTUWmAAAAaklEQVQYlWNgwAa0VmGAFQyqoSCQ/x8J/CBFMDV16rTQ/H/7V//69+//v/3/9oMEI6cuAwr+fv/+/b5d///v//0eJBgWOhMo+Gs9UPAdXDBy6lSYyn9wQZCZS0GCYDPXQcykzJ1Y/Y4NAABKvL80wyoMPgAAAABJRU5ErkJggg==" alt="Atom 1.0 Weblog Feed" width="80" height="15"/></a> <a href="http://validator.w3.org/check?uri=referer"><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAFAAAAAPCAMAAABEF7i9AAAB1FBMVEUHQIgIRY0MN4QNRYoSRYsXUpIYVJQeUpUhWpgjUJMjWpgmU5QnXJkuYZ0uYpwwV5YyZJ4zaKM3ZaA5aaI6aqM6a6E8ZqA8Z6BAbaRBbqdCbaVHd61KSkpKcaZQUFBUf69UgbBVVVVXfq9Yg7NZhbJZh7RagrNeXVxeh7RfjLdgYGBiiLZmZmZnZ2doirhpkbt0m8F3m8B3ncJ5lb55ocR+ocSDgX+Do8eEpMqGhoaHp8iIpMeJjnmJpseKqMeOqsqPsdCQrcyVlZWVsM2Zs9CZtNCfu9ahoaGhuNShudSivNSjtMWjvNSmpqWnpqSrw9qvxNqyxdmyxdyzsK6zs7Ozx9y0xt21yN22tra4y+K80eK/v7/AwMDExMTEy9DH2ejK2+jM2ujN3uvP0dLR0NDR3uvS3uvS3+zU4u3V1dXY2dnY4u7Y4+3b5e/d3d3d5u/d5/De3t7f39/h4uLj4uHj6/Ll7PXm7fTn7/Xo7/Tp7/bq7Ozr6unr8ffw8PDw9vvx9fny+P7z8/Pz9vnz9vv3+fv4+vz5+vz6+vr6+/36/P36///7+/77/Pz7/f37/f78/Pz8/f38/f79/f39/f79/f/9/v79///+/v7+/v////3///+tYR2LAAABKklEQVQ4y2PQoTJg0JlNVYDPQBsyAMTAqaFes8tdsmdPCtA3MDStr3GKKK6myMAprgJ9pcpWs/MlRExYJBvNZLR0sigycHYOV1S7mtjsQJ4gf+HIFPXoWMs6qIGzIRiKZs9GFoEaMRuZhhrYqqJXy8uZYauRxC/VHew7e3YTPAxnI5swG6JxNrKBNjB1EFmIgV0+HA6C8pqqzhXG7BbJJROQIwViMYQ7G2oDQQNn57JyG7kxiCfObrBmS5+BHMuYLkTzMnYDm5WY4lOZZRPKZocxes+aPbuwCFsYohiICLvZsKBAMrDTQ7K/StveU8icTzrOL8JdLpOyWJ49u8Bx9ozw8DY7UYW03hhdxZAOSg2c3jN79rSJs1vSKmfOnpFXNJmynELlvExlAADnaZpLFGEC2wAAAABJRU5ErkJggg==" alt="Valid XHTML 1.1" width="80" height="15"/></a> <a href="http://jigsaw.w3.org/css-validator/check/referer"><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAFAAAAAPCAMAAABEF7i9AAAB1FBMVEUHQIgIRY0MN4QNRYoSRYsXUpIYVJQeUpUhWpgjUJMjWpgmU5QnXJkuYZ0uYpwwV5YyZJ4zaKM3ZaA5aaI6aqM6a6E8ZqA8Z6BAbaRBbqdCbaVHd61KSkpKcaZQUFBUf69UgbBVVVVXfq9Yg7NZhbJZh7RagrNeXVxeh7RfjLdgYGBiiLZmZmZnZ2doirhpkbt0m8F3m8B3ncJ5lb55ocR+ocSDgX+Do8eEpMqGhoaHp8iIpMeJjnmJpseKqMeOqsqPsdCQrcyVlZWVsM2Zs9CZtNCfu9ahoaGhuNShudSivNSjtMWjvNSmpqWnpqSrw9qvxNqyxdmyxdyzsK6zs7Ozx9y0xt21yN22tra4y+K80eK/v7/AwMDExMTEy9DH2ejK2+jM2ujN3uvP0dLR0NDR3uvS3uvS3+zU4u3V1dXY2dnY4u7Y4+3b5e/d3d3d5u/d5/De3t7f39/h4uLj4uHj6/Ll7PXm7fTn7/Xo7/Tp7/bq7Ozr6unr8ffw8PDw9vvx9fny+P7z8/Pz9vnz9vv3+fv4+vz5+vz6+vr6+/36/P36///7+/77/Pz7/f37/f78/Pz8/f38/f79/f39/f79/f/9/v79///+/v7+/v////3///+tYR2LAAABEUlEQVQ4y2PQoTJg0JlNVYDPQBsyAMTAqaFes8tdsmdPCtA3MDStr3GKKK6myMAprgJ9pcpWs/MlRExYJBvNZLR0sigycHYOV1S7mtjsQJ4gf+HIFPXoWMs6mIEQCsIjwhKoga0qerW8nBm2Gkn8Ut3BvrNnN8HCcDYM2cBIogzs8uFwEJTXVHWuMGa3SC6ZgIgUqCEwdxJr4OxcVm4jNwbxxNkN1mzpM2ajGIjsPGK9PLtZiSk+lVk2oWx2GKP3rNmzC4tQwpDoIIQb2Okh2V+lbe8pZM4nHecX4S6XSVksz55d4Dh7Rnh4m52oQlpvjK5iSAelBk7vmT172sTZLWmVM2fPyCuaTFlOoXJepjIAANlljDGY/l5pAAAAAElFTkSuQmCC" alt="Valid CSS (2.1)" width="80" height="15"/></a><br/>Copyright 2005-2020 <a href="/about/">Timo Bingmann</a> - <a href="/about/impressum.html">Impressum</a></div></body></html>