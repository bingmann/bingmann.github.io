<?xml version="1.0" encoding="iso-8859-1"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta content="text/html; charset=iso-8859-1" http-equiv="content-type" /><meta name="viewport" content="initial-scale=1"><title>/2012/1119-eSAIS-Inducing-Suffix-and-LCP-Arrays-in-External-Memory/eSAIS-DC3-LCP-0.5.4/stxxl/examples/applications/skew3.cpp - panthema.net</title><link rel="stylesheet" type="text/css" href="/css/base.css" /><link rel="stylesheet" type="text/css" href="/css/fonts.css" /><link rel="alternate" type="application/rss+xml" title="panthema.net Weblog Feed RSS 2.0" href="http://panthema.net/xmlfeed/weblog-rss20.xml" /><link rel="alternate" type="application/atom+xml" title="panthema.net Weblog Feed Atom 1.0" href="http://panthema.net/xmlfeed/weblog-atom10.xml" /><script type="text/javascript" src="/js/base.js"></script><script type="text/javascript">/* <!-- */makeIEHover = function() {var lis = document.getElementById('ptnav').getElementsByTagName('li');for (var i = 0; i < lis.length; i++) {lis[i].onmouseover = function() {this.className += ' sfhover';};lis[i].onmouseout = function() {this.className = this.className.replace(new RegExp(' sfhover\b'), '');};}};if (window.attachEvent) window.attachEvent('onload', makeIEHover);/* --> */</script></head><body style="background-image: url(/img/bgfractal6.jpg)"><div class="pttopbar"><div style="float: right"><ul id="ptnav"><li class="top"><a class="ni" href="/"><i class="icon-book"></i> Weblog</a><ul style="margin-left: -6px; margin-top: 4px" class="nx"><li><a href="/2018/">2018</a></li><li><a href="/2017/">2017</a></li><li><a href="/2016/">2016</a></li><li><a href="/2015/">2015</a></li><li><a href="/2014/">2014</a></li><li><a href="/2013/">2013</a></li><li><a href="/2012/">2012</a></li><li><a href="/2011/">2011</a></li><li><a href="/2010/">2010</a></li><li><a href="/2009/">2009</a></li><li><a href="/2008/">2008</a></li><li><a href="/2007/">2007</a></li><li><a href="/2006/">2006</a></li><li class="nt"><a href="/2005/">2005</a></li><li class="ns"><a href="/xmlfeed/weblog-rss20.xml">RSS Feed</a></li><li class="nt"><a href="/xmlfeed/weblog-atom10.xml">XML Atom</a></li><li class="ns"><a href="/search.html">Search</a></li></ul></li><li class="top"><a class="ni" href="/tags/"><i class="icon-tags"></i> Tags</a><div style="width: 14em; margin-left: -9em; margin-top: 4px"><a style="font-size: 10pt" href="/tags/algebra.html">algebra</a> <a style="font-size: 16pt" href="/tags/c++.html">c++</a> <a style="font-size: 12pt" href="/tags/code-example.html">code-example</a> <a style="font-size: 14pt" href="/tags/code-snippet.html">code-snippet</a> <a style="font-size: 11pt" href="/tags/coding_tricks.html">coding tricks</a> <a style="font-size: 10pt" href="/tags/compsci.html">compsci</a> <a style="font-size: 10pt" href="/tags/compsci_study_thesis.html">compsci study thesis</a> <a style="font-size: 9pt" href="/tags/crypto-speedtest.html">crypto-speedtest</a> <a style="font-size: 10pt" href="/tags/cryptography.html">cryptography</a> <a style="font-size: 9pt" href="/tags/cryptote.html">cryptote</a> <a style="font-size: 10pt" href="/tags/dissertation.html">dissertation</a> <a style="font-size: 12pt" href="/tags/flex-bison-cpp-example.html">flex-bison-cpp-example</a> <a style="font-size: 16pt" href="/tags/frontpage.html">frontpage</a> <a style="font-size: 14pt" href="/tags/fun.html">fun</a> <a style="font-size: 10pt" href="/tags/graphviz.html">graphviz</a> <a style="font-size: 9pt" href="http://www.hmtg.de">hartmetall</a> <a style="font-size: 9pt" href="/tags/helppc.html">helppc</a> <a style="font-size: 9pt" href="/tags/hifi_selbstbau.html">hifi selbstbau</a> <a style="font-size: 10pt" href="/tags/latex.html">latex</a> <a style="font-size: 10pt" href="/tags/librivox.html">librivox</a> <a style="font-size: 10pt" href="/tags/linux.html">linux</a> <a style="font-size: 9pt" href="/tags/massive-sorting.html">massive-sorting</a> <a style="font-size: 11pt" href="/tags/maths.html">maths</a> <a style="font-size: 9pt" href="/tags/music.html">music</a> <a style="font-size: 10pt" href="/tags/netfundamentals.html">netfundamentals</a> <a style="font-size: 11pt" href="/tags/ns-3.html">ns-3</a> <a style="font-size: 10pt" href="/tags/parallel-string-sorting.html">parallel-string-sorting</a> <a style="font-size: 14pt" href="/tags/parsing.html">parsing</a> <a style="font-size: 9pt" href="/tags/qtsqlview.html">qtsqlview</a> <a style="font-size: 14pt" href="/tags/research.html">research</a> <a style="font-size: 11pt" href="/tags/sdios06.html">sdios06</a> <a style="font-size: 9pt" href="/tags/sdlfractal.html">sdlfractal</a> <a style="font-size: 14pt" href="/tags/sorting.html">sorting</a> <a style="font-size: 11pt" href="/tags/sound_of_sorting.html">sound of sorting</a> <a style="font-size: 10pt" href="/tags/stringology.html">stringology</a> <a style="font-size: 16pt" href="/tags/stx-btree.html">stx-btree</a> <a style="font-size: 15pt" href="/tags/stxxl.html">stxxl</a> <a style="font-size: 16pt" href="/tags/talk.html">talk</a> <a style="font-size: 13pt" href="/tags/thrill.html">thrill</a> <a style="font-size: 10pt" href="/tags/tutorium.html">tutorium</a> <a style="font-size: 16pt" href="/tags/university.html">university</a> <a style="font-size: 13pt" href="/tags/utilities.html">utilities</a> <a style="font-size: 10pt" href="/tags/vncrec.html">vncrec</a> <a style="font-size: 9pt" href="/tags/webdesign.html">webdesign</a> </div></li><li class="top"> <a class="ni" href="#"><i class="icon-cubes"></i> Projects</a> <ul style="margin-left: -8em; margin-top: 4px;" class="nx"> <li><a href="/2009/cryptote/">CryptoTE</a></li> <li><a href="/2009/digup/">digup</a></li> <li><a href="/2013/disk-filltest/">disk-filltest</a></li> <li><a href="/2012/1119-eSAIS-Inducing-Suffix-and-LCP-Arrays-in-External-Memory/">eSAIS-LCP</a></li> <li><a href="/2007/flex-bison-cpp-example/">Flex Bison C++ Example</a></li> <li><a href="/2013/malloc_count/">malloc_count</a></li> <li><a href="/2013/parallel-string-sorting/">parallel-string-sorting</a></li> <li><a href="/2013/pmbw/">Parallel Memory Bandwidth</a></li> <li><a href="/2014/sqlplot-tools/">SqlPlotTools</a></li> <li><a href="/2013/sound-of-sorting/">The Sound of Sorting</a></li> <li><a href="/2007/stx-btree/">STX B+ Tree</a></li> <li><a href="/2010/stx-cbtreedb/">STX Constant BTreeDB</a></li> <li><a href="/2010/stx-execpipe/">STX ExecPipe</a></li> <li><a href="/2007/stx-exparser/">STX Expression Parser</a></li> <li><a href="/tags/stxxl.html">STXXL 1.4</a></li> <li class="nt"><a href="/2014/vncrec-rgb/">VNCrec RGB 0.4</a></li> <li class="ns"><a href="/search.html">Search</a></li> </ul></li><li class="top"> <a class="ni" href="#"><i class="icon-graduation-cap"></i> Research</a> <ul style="margin-left: -16em; margin-top: 4px" class="nx"> <li><a href="/2012/1119-eSAIS-Inducing-Suffix-and-LCP-Arrays-in-External-Memory/">eSAIS-LCP - External Memory Suffix Sorting</a></li> <li><a href="/2016/0114-diploma-thesis/">On Bispanning Graphs</a></li> <li><a href="/2013/parallel-string-sorting/">Parallel String Sorting</a></li> <li><a href="/tags/massive-sorting.html">Practical Massively Parallel Sorting</a></li> <li><a href="/tags/stxxl.html">STXXL - External Memory Algorithms</a></li> <li><a href="/tags/thrill.html">Thrill - Distributed Batch Big Data Processing</a></li> <li class="ns"><a href="/search.html">Search</a></li> </ul></li><li class="top"> <a class="ni" href="/about/"><i class="icon-info-circled"></i> About</a> <ul style="margin-left: -6em; margin-top: 4px" class="nx"> <li><a href="/about/">Timo Bingmann</a></li> <li><a href="/about/impressum.html">Impressum</a></li> </ul></li><li class="top"> <a class="ni" href="/subscribe.html"><i class="icon-rss-squared"></i> Subscribe</a></li></ul></div><div style="padding: 6px"><a href="/">panthema</a>  / <a href="/2012/">2012</a> / <a href="/2012/1119-eSAIS-Inducing-Suffix-and-LCP-Arrays-in-External-Memory/">1119-eSAIS-Inducing-Suffix-and-LCP-Arrays-in-External-Memory</a> / <a href="/2012/1119-eSAIS-Inducing-Suffix-and-LCP-Arrays-in-External-Memory/eSAIS-DC3-LCP-0.5.4/">eSAIS-DC3-LCP-0.5.4</a> / <a href="/2012/1119-eSAIS-Inducing-Suffix-and-LCP-Arrays-in-External-Memory/eSAIS-DC3-LCP-0.5.4/stxxl/">stxxl</a> / <a href="/2012/1119-eSAIS-Inducing-Suffix-and-LCP-Arrays-in-External-Memory/eSAIS-DC3-LCP-0.5.4/stxxl/examples/">examples</a> / <a href="/2012/1119-eSAIS-Inducing-Suffix-and-LCP-Arrays-in-External-Memory/eSAIS-DC3-LCP-0.5.4/stxxl/examples/applications/">applications</a> / <a href="/2012/1119-eSAIS-Inducing-Suffix-and-LCP-Arrays-in-External-Memory/eSAIS-DC3-LCP-0.5.4/stxxl/examples/applications/skew3.cpp.html">skew3.cpp</a> (<a href="/2012/1119-eSAIS-Inducing-Suffix-and-LCP-Arrays-in-External-Memory/eSAIS-DC3-LCP-0.5.4/stxxl/examples/applications/skew3.cpp">Download File</a>)</div></div><div class="ptfullwidth"><pre class="codesnippet" style="font-family: monospace"><tt><span class="comment">/***************************************************************************</span>
<span class="comment"> *  examples/applications/skew3.cpp</span>
<span class="comment"> *</span>
<span class="comment"> *  Implementation of the external memory suffix sorting algorithm DC3 aka</span>
<span class="comment"> *  skew3 as described in Roman Dementiev, Juha Kaerkkaeinen, Jens Mehnert and</span>
<span class="comment"> *  Peter Sanders. "Better External Memory Suffix Array Construction". Journal</span>
<span class="comment"> *  of Experimental Algorithmics (JEA), volume 12, 2008.</span>
<span class="comment"> *</span>
<span class="comment"> *  Part of the STXXL. See </span><span class="url">http://stxxl.sourceforge.net</span>
<span class="comment"> *</span>
<span class="comment"> *  Copyright (C) 2004 Jens Mehnert </span><span class="url">&lt;jmehnert@mpi-sb.mpg.de&gt;</span>
<span class="comment"> *  Copyright (C) 2012-2013 Timo Bingmann </span><span class="url">&lt;tb@panthema.net&gt;</span>
<span class="comment"> *  Copyright (C) 2012-2013 Daniel Feist </span><span class="url">&lt;daniel.feist@student.kit.edu&gt;</span>
<span class="comment"> *</span>
<span class="comment"> *  Distributed under the Boost Software License, Version 1.0.</span>
<span class="comment"> *  (See accompanying file LICENSE_1_0.txt or copy at</span>
<span class="comment"> *  </span><span class="url">http://www.boost.org/LICENSE_1_0.txt</span><span class="comment">)</span>
<span class="comment"> **************************************************************************/</span>

<span class="preproc">#include</span><span class="normal"> </span><span class="string">&lt;algorithm&gt;</span>
<span class="preproc">#include</span><span class="normal"> </span><span class="string">&lt;cassert&gt;</span>
<span class="preproc">#include</span><span class="normal"> </span><span class="string">&lt;cctype&gt;</span>
<span class="preproc">#include</span><span class="normal"> </span><span class="string">&lt;cstddef&gt;</span>
<span class="preproc">#include</span><span class="normal"> </span><span class="string">&lt;cstdlib&gt;</span>
<span class="preproc">#include</span><span class="normal"> </span><span class="string">&lt;iostream&gt;</span>
<span class="preproc">#include</span><span class="normal"> </span><span class="string">&lt;limits&gt;</span>
<span class="preproc">#include</span><span class="normal"> </span><span class="string">&lt;string&gt;</span>
<span class="preproc">#include</span><span class="normal"> </span><span class="string">&lt;vector&gt;</span>

<span class="preproc">#include</span><span class="normal"> </span><span class="string">&lt;stxxl/algorithm&gt;</span>
<span class="preproc">#include</span><span class="normal"> </span><span class="string">&lt;stxxl/cmdline&gt;</span>
<span class="preproc">#include</span><span class="normal"> </span><span class="string">&lt;stxxl/io&gt;</span>
<span class="preproc">#include</span><span class="normal"> </span><span class="string">&lt;stxxl/random&gt;</span>
<span class="preproc">#include</span><span class="normal"> </span><span class="string">&lt;stxxl/sorter&gt;</span>
<span class="preproc">#include</span><span class="normal"> </span><span class="string">&lt;stxxl/stats&gt;</span>
<span class="preproc">#include</span><span class="normal"> </span><span class="string">&lt;stxxl/stream&gt;</span>
<span class="preproc">#include</span><span class="normal"> </span><span class="string">&lt;stxxl/vector&gt;</span>
<span class="preproc">#include</span><span class="normal"> </span><span class="string">&lt;stxxl/bits/common/uint_types.h&gt;</span>

<span class="keyword">using</span><span class="normal"> stxxl</span><span class="symbol">::</span><span class="normal">uint64</span><span class="symbol">;</span>
<span class="keyword">using</span><span class="normal"> stxxl</span><span class="symbol">::</span><span class="normal">external_size_type</span><span class="symbol">;</span>
<span class="keyword">namespace</span><span class="normal"> stream </span><span class="symbol">=</span><span class="normal"> stxxl</span><span class="symbol">::</span><span class="normal">stream</span><span class="symbol">;</span>

<span class="comment">// 1 GiB ram used by external data structures / 1 MiB block size</span>
<span class="usertype">uint64</span><span class="normal"> ram_use </span><span class="symbol">=</span><span class="normal"> </span><span class="number">1024</span><span class="normal"> </span><span class="symbol">*</span><span class="normal"> </span><span class="number">1024</span><span class="normal"> </span><span class="symbol">*</span><span class="normal"> </span><span class="number">1024</span><span class="symbol">;</span>

<span class="comment">// alphabet data type</span>
<span class="keyword">typedef</span><span class="normal"> </span><span class="type">unsigned</span><span class="normal"> </span><span class="type">char</span><span class="normal"> alphabet_type</span><span class="symbol">;</span>

<span class="comment">// calculation data type</span>
<span class="keyword">typedef</span><span class="normal"> </span><span class="usertype">external_size_type</span><span class="normal"> size_type</span><span class="symbol">;</span>

<span class="comment">/// Suffix Array checker for correctness verification</span>

<span class="comment">/**</span>
<span class="comment"> * Algorithm to check whether the suffix array is correct. Loosely based on the</span>
<span class="comment"> * ideas of Kaerkkaeinen und Burghardt, originally implemented in STXXL by Jens</span>
<span class="comment"> * Mehnert (2004), reimplemented using triples by Timo Bingmann (2012).</span>
<span class="comment"> *</span>
<span class="comment"> * </span><span class="type">@param</span><span class="comment"> InputT is the original text, from which the suffix array was build</span>
<span class="comment"> * </span><span class="type">@param</span><span class="comment"> InputSA is the suffix array from InputT</span>
<span class="comment"> *</span>
<span class="comment"> * Note: ISA := The inverse of SA</span>
<span class="comment"> */</span>
<span class="keyword">template</span><span class="normal"> </span><span class="symbol">&lt;</span><span class="keyword">typename</span><span class="normal"> </span><span class="classname">InputT</span><span class="symbol">,</span><span class="normal"> </span><span class="keyword">typename</span><span class="normal"> </span><span class="classname">InputSA</span><span class="symbol">&gt;</span>
<span class="type">bool</span><span class="normal"> </span><span class="function">sacheck</span><span class="symbol">(</span><span class="normal">InputT</span><span class="symbol">&amp;</span><span class="normal"> inputT</span><span class="symbol">,</span><span class="normal"> InputSA</span><span class="symbol">&amp;</span><span class="normal"> inputSA</span><span class="symbol">)</span>
<span class="cbracket">{</span>
<span class="normal">    </span><span class="keyword">typedef</span><span class="normal"> </span><span class="keyword">typename</span><span class="normal"> </span><span class="classname">InputSA</span><span class="symbol">::</span><span class="usertype">value_type</span><span class="normal"> offset_type</span><span class="symbol">;</span>
<span class="normal">    </span><span class="keyword">typedef</span><span class="normal"> stxxl</span><span class="symbol">::</span><span class="usertype">tuple&lt;offset_type, offset_type&gt;</span><span class="normal"> pair_type</span><span class="symbol">;</span>
<span class="normal">    </span><span class="keyword">typedef</span><span class="normal"> stxxl</span><span class="symbol">::</span><span class="usertype">tuple&lt;offset_type, offset_type, offset_type&gt;</span><span class="normal"> triple_type</span><span class="symbol">;</span>

<span class="normal">    </span><span class="comment">// *** Pipeline Declaration ***</span>

<span class="normal">    </span><span class="comment">// Build tuples with index: (SA[i]) -&gt; (i, SA[i])</span>
<span class="normal">    </span><span class="keyword">typedef</span><span class="normal"> stxxl</span><span class="symbol">::</span><span class="normal">stream</span><span class="symbol">::</span><span class="usertype">counter&lt;offset_type&gt;</span><span class="normal"> index_counter_type</span><span class="symbol">;</span>
<span class="normal">    </span><span class="usertype">index_counter_type</span><span class="normal"> index_counter</span><span class="symbol">;</span>

<span class="normal">    </span><span class="keyword">typedef</span><span class="normal"> stream</span><span class="symbol">::</span><span class="usertype">make_tuple&lt;index_counter_type, InputSA&gt;</span><span class="normal"> tuple_index_sa_type</span><span class="symbol">;</span>
<span class="normal">    </span><span class="usertype">tuple_index_sa_type</span><span class="normal"> </span><span class="function">tuple_index_sa</span><span class="symbol">(</span><span class="normal">index_counter</span><span class="symbol">,</span><span class="normal"> inputSA</span><span class="symbol">);</span>

<span class="normal">    </span><span class="comment">// take (i, SA[i]) and sort to (ISA[i], i)</span>
<span class="normal">    </span><span class="keyword">typedef</span><span class="normal"> stxxl</span><span class="symbol">::</span><span class="usertype">tuple_less2nd&lt;pair_type&gt;</span><span class="normal"> pair_less_type</span><span class="symbol">;</span>
<span class="normal">    </span><span class="keyword">typedef</span><span class="normal"> </span><span class="keyword">typename</span><span class="normal"> </span><span class="classname">stream</span><span class="symbol">::</span><span class="usertype">sort&lt;tuple_index_sa_type, pair_less_type&gt;</span><span class="normal"> build_isa_type</span><span class="symbol">;</span>

<span class="normal">    </span><span class="usertype">build_isa_type</span><span class="normal"> </span><span class="function">build_isa</span><span class="symbol">(</span><span class="normal">tuple_index_sa</span><span class="symbol">,</span><span class="normal"> </span><span class="function">pair_less_type</span><span class="symbol">(),</span><span class="normal"> ram_use </span><span class="symbol">/</span><span class="normal"> </span><span class="number">3</span><span class="symbol">);</span>

<span class="normal">    </span><span class="comment">// build (ISA[i], T[i], ISA[i+1]) and sort to (i, T[SA[i]], ISA[SA[i]+1])</span>
<span class="normal">    </span><span class="keyword">typedef</span><span class="normal"> stxxl</span><span class="symbol">::</span><span class="usertype">tuple_less1st&lt;triple_type&gt;</span><span class="normal"> triple_less_type</span><span class="symbol">;</span><span class="normal">      </span><span class="comment">// comparison relation</span>

<span class="normal">    </span><span class="keyword">typedef</span><span class="normal"> </span><span class="keyword">typename</span><span class="normal"> </span><span class="classname">stream</span><span class="symbol">::</span><span class="usertype">use_push&lt;triple_type&gt;</span><span class="normal"> triple_push_type</span><span class="symbol">;</span><span class="normal"> </span><span class="comment">// indicator use push()</span>
<span class="normal">    </span><span class="keyword">typedef</span><span class="normal"> </span><span class="keyword">typename</span><span class="normal"> </span><span class="classname">stream</span><span class="symbol">::</span><span class="usertype">runs_creator&lt;triple_push_type, triple_less_type&gt;</span><span class="normal"> triple_rc_type</span><span class="symbol">;</span>
<span class="normal">    </span><span class="keyword">typedef</span><span class="normal"> </span><span class="keyword">typename</span><span class="normal"> </span><span class="classname">stream</span><span class="symbol">::</span><span class="usertype">runs_merger&lt;typename triple_rc_type::sorted_runs_type, triple_less_type&gt;</span><span class="normal"> triple_rm_type</span><span class="symbol">;</span>

<span class="normal">    </span><span class="usertype">triple_rc_type</span><span class="normal"> </span><span class="function">triple_rc</span><span class="symbol">(</span><span class="function">triple_less_type</span><span class="symbol">(),</span><span class="normal"> ram_use </span><span class="symbol">/</span><span class="normal"> </span><span class="number">3</span><span class="symbol">);</span>

<span class="normal">    </span><span class="comment">// ************************* Process ******************************</span>
<span class="normal">    </span><span class="comment">// loop 1: read ISA and check for a permutation. Simultaneously create runs</span>
<span class="normal">    </span><span class="comment">// of triples by iterating ISA and T.</span>

<span class="normal">    </span><span class="usertype">size_type</span><span class="normal"> totalSize</span><span class="symbol">;</span>
<span class="normal">    </span><span class="cbracket">{</span>
<span class="normal">        </span><span class="usertype">offset_type</span><span class="normal"> prev_isa </span><span class="symbol">=</span><span class="normal"> </span><span class="symbol">(*</span><span class="normal">build_isa</span><span class="symbol">).</span><span class="normal">first</span><span class="symbol">;</span>
<span class="normal">        </span><span class="usertype">offset_type</span><span class="normal"> counter </span><span class="symbol">=</span><span class="normal"> </span><span class="number">0</span><span class="symbol">;</span>
<span class="normal">        </span><span class="keyword">while</span><span class="normal"> </span><span class="symbol">(!</span><span class="normal">build_isa</span><span class="symbol">.</span><span class="function">empty</span><span class="symbol">())</span>
<span class="normal">        </span><span class="cbracket">{</span>
<span class="normal">            </span><span class="keyword">if</span><span class="normal"> </span><span class="symbol">((*</span><span class="normal">build_isa</span><span class="symbol">).</span><span class="normal">second </span><span class="symbol">!=</span><span class="normal"> counter</span><span class="symbol">)</span><span class="normal"> </span><span class="cbracket">{</span>
<span class="normal">                std</span><span class="symbol">::</span><span class="normal">cout </span><span class="symbol">&lt;&lt;</span><span class="normal"> </span><span class="string">"Error: suffix array is not a permutation of 0..n-1."</span><span class="normal"> </span><span class="symbol">&lt;&lt;</span><span class="normal"> std</span><span class="symbol">::</span><span class="normal">endl</span><span class="symbol">;</span>
<span class="normal">                </span><span class="keyword">return</span><span class="normal"> </span><span class="keyword">false</span><span class="symbol">;</span>
<span class="normal">            </span><span class="cbracket">}</span>

<span class="normal">            </span><span class="symbol">++</span><span class="normal">counter</span><span class="symbol">;</span>
<span class="normal">            </span><span class="symbol">++</span><span class="normal">build_isa</span><span class="symbol">;</span><span class="normal"> </span><span class="comment">// ISA is one in front of T</span>

<span class="normal">            </span><span class="keyword">if</span><span class="normal"> </span><span class="symbol">(!</span><span class="normal">build_isa</span><span class="symbol">.</span><span class="function">empty</span><span class="symbol">())</span><span class="normal"> </span><span class="cbracket">{</span>
<span class="normal">                triple_rc</span><span class="symbol">.</span><span class="function">push</span><span class="symbol">(</span><span class="function">triple_type</span><span class="symbol">(</span><span class="normal">prev_isa</span><span class="symbol">,</span><span class="normal"> </span><span class="symbol">*</span><span class="normal">inputT</span><span class="symbol">,</span><span class="normal"> </span><span class="symbol">(*</span><span class="normal">build_isa</span><span class="symbol">).</span><span class="normal">first</span><span class="symbol">));</span>
<span class="normal">                prev_isa </span><span class="symbol">=</span><span class="normal"> </span><span class="symbol">(*</span><span class="normal">build_isa</span><span class="symbol">).</span><span class="normal">first</span><span class="symbol">;</span>
<span class="normal">            </span><span class="cbracket">}</span>
<span class="normal">            </span><span class="symbol">++</span><span class="normal">inputT</span><span class="symbol">;</span>
<span class="normal">        </span><span class="cbracket">}</span>

<span class="normal">        totalSize </span><span class="symbol">=</span><span class="normal"> counter</span><span class="symbol">;</span>
<span class="normal">    </span><span class="cbracket">}</span>

<span class="normal">    </span><span class="keyword">if</span><span class="normal"> </span><span class="symbol">(</span><span class="normal">totalSize </span><span class="symbol">==</span><span class="normal"> </span><span class="number">1</span><span class="symbol">)</span><span class="normal"> </span><span class="keyword">return</span><span class="normal"> </span><span class="keyword">true</span><span class="symbol">;</span>

<span class="normal">    </span><span class="comment">// ************************************************************************</span>
<span class="normal">    </span><span class="comment">// loop 2: read triples (i,T[SA[i]],ISA[SA[i]+1]) and check for correct</span>
<span class="normal">    </span><span class="comment">// ordering.</span>

<span class="normal">    </span><span class="usertype">triple_rm_type</span><span class="normal"> </span><span class="function">triple_rm</span><span class="symbol">(</span><span class="normal">triple_rc</span><span class="symbol">.</span><span class="function">result</span><span class="symbol">(),</span><span class="normal"> </span><span class="function">triple_less_type</span><span class="symbol">(),</span><span class="normal"> ram_use </span><span class="symbol">/</span><span class="normal"> </span><span class="number">3</span><span class="symbol">);</span>

<span class="normal">    </span><span class="cbracket">{</span>
<span class="normal">        </span><span class="usertype">triple_type</span><span class="normal"> prev_triple </span><span class="symbol">=</span><span class="normal"> </span><span class="symbol">*</span><span class="normal">triple_rm</span><span class="symbol">;</span>
<span class="normal">        </span><span class="usertype">size_type</span><span class="normal"> counter </span><span class="symbol">=</span><span class="normal"> </span><span class="number">0</span><span class="symbol">;</span>

<span class="normal">        </span><span class="symbol">++</span><span class="normal">triple_rm</span><span class="symbol">;</span>

<span class="normal">        </span><span class="keyword">while</span><span class="normal"> </span><span class="symbol">(!</span><span class="normal">triple_rm</span><span class="symbol">.</span><span class="function">empty</span><span class="symbol">())</span>
<span class="normal">        </span><span class="cbracket">{</span>
<span class="normal">            </span><span class="keyword">const</span><span class="normal"> triple_type</span><span class="symbol">&amp;</span><span class="normal"> this_triple </span><span class="symbol">=</span><span class="normal"> </span><span class="symbol">*</span><span class="normal">triple_rm</span><span class="symbol">;</span>

<span class="normal">            </span><span class="keyword">if</span><span class="normal"> </span><span class="symbol">(</span><span class="normal">prev_triple</span><span class="symbol">.</span><span class="normal">second </span><span class="symbol">&gt;</span><span class="normal"> this_triple</span><span class="symbol">.</span><span class="normal">second</span><span class="symbol">)</span>
<span class="normal">            </span><span class="cbracket">{</span>
<span class="normal">                </span><span class="comment">// simple check of first character of suffix</span>
<span class="normal">                std</span><span class="symbol">::</span><span class="normal">cout </span><span class="symbol">&lt;&lt;</span><span class="normal"> </span><span class="string">"Error: suffix array position "</span><span class="normal"> </span><span class="symbol">&lt;&lt;</span><span class="normal"> counter </span><span class="symbol">&lt;&lt;</span><span class="normal"> </span><span class="string">" ordered incorrectly."</span><span class="normal"> </span><span class="symbol">&lt;&lt;</span><span class="normal"> std</span><span class="symbol">::</span><span class="normal">endl</span><span class="symbol">;</span>
<span class="normal">                </span><span class="keyword">return</span><span class="normal"> </span><span class="keyword">false</span><span class="symbol">;</span>
<span class="normal">            </span><span class="cbracket">}</span>
<span class="normal">            </span><span class="keyword">else</span><span class="normal"> </span><span class="keyword">if</span><span class="normal"> </span><span class="symbol">(</span><span class="normal">prev_triple</span><span class="symbol">.</span><span class="normal">second </span><span class="symbol">==</span><span class="normal"> this_triple</span><span class="symbol">.</span><span class="normal">second</span><span class="symbol">)</span>
<span class="normal">            </span><span class="cbracket">{</span>
<span class="normal">                </span><span class="keyword">if</span><span class="normal"> </span><span class="symbol">(</span><span class="normal">this_triple</span><span class="symbol">.</span><span class="normal">third </span><span class="symbol">==</span><span class="normal"> </span><span class="symbol">(</span><span class="normal">offset_type</span><span class="symbol">)</span><span class="normal">totalSize</span><span class="symbol">)</span><span class="normal"> </span><span class="cbracket">{</span>
<span class="normal">                    </span><span class="comment">// last suffix of string must be first among those with same</span>
<span class="normal">                    </span><span class="comment">// first character</span>
<span class="normal">                    std</span><span class="symbol">::</span><span class="normal">cout </span><span class="symbol">&lt;&lt;</span><span class="normal"> </span><span class="string">"Error: suffix array position "</span><span class="normal"> </span><span class="symbol">&lt;&lt;</span><span class="normal"> counter </span><span class="symbol">&lt;&lt;</span><span class="normal"> </span><span class="string">" ordered incorrectly."</span><span class="normal"> </span><span class="symbol">&lt;&lt;</span><span class="normal"> std</span><span class="symbol">::</span><span class="normal">endl</span><span class="symbol">;</span>
<span class="normal">                    </span><span class="keyword">return</span><span class="normal"> </span><span class="keyword">false</span><span class="symbol">;</span>
<span class="normal">                </span><span class="cbracket">}</span>
<span class="normal">                </span><span class="keyword">if</span><span class="normal"> </span><span class="symbol">(</span><span class="normal">prev_triple</span><span class="symbol">.</span><span class="normal">third </span><span class="symbol">!=</span><span class="normal"> </span><span class="symbol">(</span><span class="normal">offset_type</span><span class="symbol">)</span><span class="normal">totalSize </span><span class="symbol">&amp;&amp;</span><span class="normal"> prev_triple</span><span class="symbol">.</span><span class="normal">third </span><span class="symbol">&gt;</span><span class="normal"> this_triple</span><span class="symbol">.</span><span class="normal">third</span><span class="symbol">)</span><span class="normal"> </span><span class="cbracket">{</span>
<span class="normal">                    </span><span class="comment">// positions SA[i] and SA[i-1] has same first character but</span>
<span class="normal">                    </span><span class="comment">// their suffixes are ordered incorrectly: the suffix</span>
<span class="normal">                    </span><span class="comment">// position of SA[i] is given by ISA[SA[i]]</span>
<span class="normal">                    std</span><span class="symbol">::</span><span class="normal">cout </span><span class="symbol">&lt;&lt;</span><span class="normal"> </span><span class="string">"Error: suffix array position "</span><span class="normal"> </span><span class="symbol">&lt;&lt;</span><span class="normal"> counter </span><span class="symbol">&lt;&lt;</span><span class="normal"> </span><span class="string">" ordered incorrectly."</span><span class="normal"> </span><span class="symbol">&lt;&lt;</span><span class="normal"> std</span><span class="symbol">::</span><span class="normal">endl</span><span class="symbol">;</span>
<span class="normal">                    </span><span class="keyword">return</span><span class="normal"> </span><span class="keyword">false</span><span class="symbol">;</span>
<span class="normal">                </span><span class="cbracket">}</span>
<span class="normal">            </span><span class="cbracket">}</span>

<span class="normal">            prev_triple </span><span class="symbol">=</span><span class="normal"> this_triple</span><span class="symbol">;</span>

<span class="normal">            </span><span class="symbol">++</span><span class="normal">triple_rm</span><span class="symbol">;</span>
<span class="normal">            </span><span class="symbol">++</span><span class="normal">counter</span><span class="symbol">;</span>
<span class="normal">        </span><span class="cbracket">}</span>
<span class="normal">    </span><span class="cbracket">}</span>
<span class="normal">    </span><span class="keyword">return</span><span class="normal"> </span><span class="keyword">true</span><span class="symbol">;</span>
<span class="cbracket">}</span>

<span class="keyword">template</span><span class="normal"> </span><span class="symbol">&lt;</span><span class="keyword">typename</span><span class="normal"> </span><span class="classname">InputT</span><span class="symbol">,</span><span class="normal"> </span><span class="keyword">typename</span><span class="normal"> </span><span class="classname">InputSA</span><span class="symbol">&gt;</span>
<span class="type">bool</span><span class="normal"> </span><span class="function">sacheck_vectors</span><span class="symbol">(</span><span class="normal">InputT</span><span class="symbol">&amp;</span><span class="normal"> inputT</span><span class="symbol">,</span><span class="normal"> InputSA</span><span class="symbol">&amp;</span><span class="normal"> inputSA</span><span class="symbol">)</span>
<span class="cbracket">{</span>
<span class="normal">    </span><span class="keyword">typename</span><span class="normal"> </span><span class="classname">stream</span><span class="symbol">::</span><span class="normal">streamify_traits</span><span class="symbol">&lt;</span><span class="keyword">typename</span><span class="normal"> </span><span class="classname">InputT</span><span class="symbol">::</span><span class="normal">iterator</span><span class="symbol">&gt;::</span><span class="normal">stream_type streamT</span>
<span class="normal">        </span><span class="symbol">=</span><span class="normal"> stream</span><span class="symbol">::</span><span class="function">streamify</span><span class="symbol">(</span><span class="normal">inputT</span><span class="symbol">.</span><span class="function">begin</span><span class="symbol">(),</span><span class="normal"> inputT</span><span class="symbol">.</span><span class="function">end</span><span class="symbol">());</span>

<span class="normal">    </span><span class="keyword">typename</span><span class="normal"> </span><span class="classname">stream</span><span class="symbol">::</span><span class="normal">streamify_traits</span><span class="symbol">&lt;</span><span class="keyword">typename</span><span class="normal"> </span><span class="classname">InputSA</span><span class="symbol">::</span><span class="normal">iterator</span><span class="symbol">&gt;::</span><span class="normal">stream_type streamSA</span>
<span class="normal">        </span><span class="symbol">=</span><span class="normal"> stream</span><span class="symbol">::</span><span class="function">streamify</span><span class="symbol">(</span><span class="normal">inputSA</span><span class="symbol">.</span><span class="function">begin</span><span class="symbol">(),</span><span class="normal"> inputSA</span><span class="symbol">.</span><span class="function">end</span><span class="symbol">());</span>

<span class="normal">    </span><span class="keyword">return</span><span class="normal"> </span><span class="function">sacheck</span><span class="symbol">(</span><span class="normal">streamT</span><span class="symbol">,</span><span class="normal"> streamSA</span><span class="symbol">);</span>
<span class="cbracket">}</span>

<span class="comment">/// DC3 aka skew algorithm</span>

<span class="comment">/*</span>
<span class="comment"> * DC3 aka skew algorithm a short description. T := input string</span>
<span class="comment"> * The recursion works as follows:</span>
<span class="comment"> * Step 1: a) pick all mod1/mod2 triples (i.e. triples T[i,i+2] at position i mod 3 != 0) (-&gt; extract_mod12 class)</span>
<span class="comment"> *         b) sort mod1/mod2 triples lexicographically (-&gt; build_sa class)</span>
<span class="comment"> *         c) give mod1/mod2 triples lexicographical ascending names n (-&gt; naming class)</span>
<span class="comment"> *         d) check lexicographical names for uniqueness (-&gt; naming class)</span>
<span class="comment"> *            If yes: proceed to next Step, If no: set T := lexicographical names and run Step 1 again</span>
<span class="comment"> * Step 2: a) by sorting the lexicographical names n we receive ranks r</span>
<span class="comment"> *         b) construct mod0-quints, mod1-quads and mod2-quints  (-&gt; build_sa class)</span>
<span class="comment"> *         c) prepare for merging by:</span>
<span class="comment"> *            sort mod0-quints by 2 components, sort mod1-quads / mod2-quints by one component (-&gt; build_sa class)</span>
<span class="comment"> *         c) merge mod0-quints, mod1-quads and mod2-quints (-&gt; merge_sa class)</span>
<span class="comment"> * Step 3: a) return Suffix Array of T</span>
<span class="comment"> *</span>
<span class="comment"> * @param offset_type later suffix array data type</span>
<span class="comment"> */</span>
<span class="keyword">template</span><span class="normal"> </span><span class="symbol">&lt;</span><span class="keyword">typename</span><span class="normal"> </span><span class="classname">offset_type</span><span class="symbol">&gt;</span>
<span class="keyword">class</span><span class="normal"> </span><span class="classname">skew</span>
<span class="cbracket">{</span>
<span class="keyword">public</span><span class="symbol">:</span>
<span class="normal">    </span><span class="comment">// 2-tuple, 3-tuple, 4-tuple (=quads), 5-tuple(=quints) definition</span>
<span class="normal">    </span><span class="keyword">typedef</span><span class="normal"> stxxl</span><span class="symbol">::</span><span class="usertype">tuple&lt;offset_type, offset_type&gt;</span><span class="normal"> skew_pair_type</span><span class="symbol">;</span>
<span class="normal">    </span><span class="keyword">typedef</span><span class="normal"> stxxl</span><span class="symbol">::</span><span class="usertype">tuple&lt;offset_type, offset_type, offset_type&gt;</span><span class="normal"> skew_triple_type</span><span class="symbol">;</span>
<span class="normal">    </span><span class="keyword">typedef</span><span class="normal"> stxxl</span><span class="symbol">::</span><span class="usertype">tuple&lt;offset_type, offset_type, offset_type, offset_type&gt;</span><span class="normal"> skew_quad_type</span><span class="symbol">;</span>
<span class="normal">    </span><span class="keyword">typedef</span><span class="normal"> stxxl</span><span class="symbol">::</span><span class="usertype">tuple&lt;offset_type, offset_type, offset_type, offset_type, offset_type&gt;</span><span class="normal"> skew_quint_type</span><span class="symbol">;</span>

<span class="normal">    </span><span class="keyword">typedef</span><span class="normal"> </span><span class="keyword">typename</span><span class="normal"> </span><span class="classname">stxxl</span><span class="symbol">::</span><span class="normal">VECTOR_GENERATOR</span><span class="symbol">&lt;</span><span class="normal">offset_type</span><span class="symbol">,</span><span class="normal"> </span><span class="number">1</span><span class="symbol">,</span><span class="normal"> </span><span class="number">2</span><span class="symbol">&gt;::</span><span class="usertype">result</span><span class="normal"> offset_array_type</span><span class="symbol">;</span>
<span class="normal">    </span><span class="keyword">typedef</span><span class="normal"> stream</span><span class="symbol">::</span><span class="usertype">vector_iterator2stream&lt;typename offset_array_type::iterator&gt;</span><span class="normal"> offset_array_it_rg</span><span class="symbol">;</span>

<span class="normal">    </span><span class="comment">/** Comparison function for the mod0 tuples. */</span>
<span class="normal">    </span><span class="keyword">struct</span><span class="normal"> </span><span class="classname">less_mod0</span>
<span class="normal">    </span><span class="cbracket">{</span>
<span class="normal">        </span><span class="keyword">typedef</span><span class="normal"> </span><span class="usertype">skew_quint_type</span><span class="normal"> value_type</span><span class="symbol">;</span>

<span class="normal">        </span><span class="type">bool</span><span class="normal"> </span><span class="keyword">operator</span><span class="normal"> </span><span class="symbol">()</span><span class="normal"> </span><span class="symbol">(</span><span class="keyword">const</span><span class="normal"> value_type</span><span class="symbol">&amp;</span><span class="normal"> a</span><span class="symbol">,</span><span class="normal"> </span><span class="keyword">const</span><span class="normal"> value_type</span><span class="symbol">&amp;</span><span class="normal"> b</span><span class="symbol">)</span><span class="normal"> </span><span class="keyword">const</span>
<span class="normal">        </span><span class="cbracket">{</span>
<span class="normal">            </span><span class="keyword">if</span><span class="normal"> </span><span class="symbol">(</span><span class="normal">a</span><span class="symbol">.</span><span class="normal">second </span><span class="symbol">==</span><span class="normal"> b</span><span class="symbol">.</span><span class="normal">second</span><span class="symbol">)</span>
<span class="normal">                </span><span class="keyword">return</span><span class="normal"> a</span><span class="symbol">.</span><span class="normal">fourth </span><span class="symbol">&lt;</span><span class="normal"> b</span><span class="symbol">.</span><span class="normal">fourth</span><span class="symbol">;</span>
<span class="normal">            </span><span class="keyword">else</span>
<span class="normal">                </span><span class="keyword">return</span><span class="normal"> a</span><span class="symbol">.</span><span class="normal">second </span><span class="symbol">&lt;</span><span class="normal"> b</span><span class="symbol">.</span><span class="normal">second</span><span class="symbol">;</span>
<span class="normal">        </span><span class="cbracket">}</span>

<span class="normal">        </span><span class="keyword">static</span><span class="normal"> </span><span class="usertype">value_type</span><span class="normal"> </span><span class="function">min_value</span><span class="symbol">()</span><span class="normal"> </span><span class="cbracket">{</span><span class="normal"> </span><span class="keyword">return</span><span class="normal"> value_type</span><span class="symbol">::</span><span class="function">min_value</span><span class="symbol">();</span><span class="normal"> </span><span class="cbracket">}</span>
<span class="normal">        </span><span class="keyword">static</span><span class="normal"> </span><span class="usertype">value_type</span><span class="normal"> </span><span class="function">max_value</span><span class="symbol">()</span><span class="normal"> </span><span class="cbracket">{</span><span class="normal"> </span><span class="keyword">return</span><span class="normal"> value_type</span><span class="symbol">::</span><span class="function">max_value</span><span class="symbol">();</span><span class="normal"> </span><span class="cbracket">}</span>
<span class="normal">    </span><span class="cbracket">}</span><span class="symbol">;</span>

<span class="normal">    </span><span class="keyword">typedef</span><span class="normal"> stxxl</span><span class="symbol">::</span><span class="usertype">tuple_less2nd&lt;skew_quad_type&gt;</span><span class="normal"> less_mod1</span><span class="symbol">;</span>
<span class="normal">    </span><span class="keyword">typedef</span><span class="normal"> stxxl</span><span class="symbol">::</span><span class="usertype">tuple_less2nd&lt;skew_quint_type&gt;</span><span class="normal"> less_mod2</span><span class="symbol">;</span>

<span class="normal">    </span><span class="comment">/** Put the (0 mod 2) [which are the 1,2 mod 3 tuples] tuples at the begin. */</span>
<span class="normal">    </span><span class="keyword">struct</span><span class="normal"> </span><span class="classname">less_skew</span>
<span class="normal">    </span><span class="cbracket">{</span>
<span class="normal">        </span><span class="keyword">typedef</span><span class="normal"> </span><span class="usertype">skew_pair_type</span><span class="normal"> value_type</span><span class="symbol">;</span>

<span class="normal">        </span><span class="type">bool</span><span class="normal"> </span><span class="keyword">operator</span><span class="normal"> </span><span class="symbol">()</span><span class="normal"> </span><span class="symbol">(</span><span class="keyword">const</span><span class="normal"> value_type</span><span class="symbol">&amp;</span><span class="normal"> a</span><span class="symbol">,</span><span class="normal"> </span><span class="keyword">const</span><span class="normal"> value_type</span><span class="symbol">&amp;</span><span class="normal"> b</span><span class="symbol">)</span><span class="normal"> </span><span class="keyword">const</span>
<span class="normal">        </span><span class="cbracket">{</span>
<span class="normal">            </span><span class="keyword">if</span><span class="normal"> </span><span class="symbol">((</span><span class="normal">a</span><span class="symbol">.</span><span class="normal">first </span><span class="symbol">&amp;</span><span class="normal"> </span><span class="number">1</span><span class="symbol">)</span><span class="normal"> </span><span class="symbol">==</span><span class="normal"> </span><span class="symbol">(</span><span class="normal">b</span><span class="symbol">.</span><span class="normal">first </span><span class="symbol">&amp;</span><span class="normal"> </span><span class="number">1</span><span class="symbol">))</span>
<span class="normal">                </span><span class="keyword">return</span><span class="normal"> a</span><span class="symbol">.</span><span class="normal">first </span><span class="symbol">&lt;</span><span class="normal"> b</span><span class="symbol">.</span><span class="normal">first</span><span class="symbol">;</span>
<span class="normal">            </span><span class="keyword">else</span>
<span class="normal">                </span><span class="keyword">return</span><span class="normal"> </span><span class="symbol">(</span><span class="normal">a</span><span class="symbol">.</span><span class="normal">first </span><span class="symbol">&amp;</span><span class="normal"> </span><span class="number">1</span><span class="symbol">)</span><span class="normal"> </span><span class="symbol">&lt;</span><span class="normal"> </span><span class="symbol">(</span><span class="normal">b</span><span class="symbol">.</span><span class="normal">first </span><span class="symbol">&amp;</span><span class="normal"> </span><span class="number">1</span><span class="symbol">);</span>
<span class="normal">        </span><span class="cbracket">}</span>

<span class="normal">        </span><span class="keyword">static</span><span class="normal"> </span><span class="usertype">value_type</span><span class="normal"> </span><span class="function">min_value</span><span class="symbol">()</span><span class="normal"> </span><span class="cbracket">{</span><span class="normal"> </span><span class="keyword">return</span><span class="normal"> value_type</span><span class="symbol">::</span><span class="function">min_value</span><span class="symbol">();</span><span class="normal"> </span><span class="cbracket">}</span>
<span class="normal">        </span><span class="keyword">static</span><span class="normal"> </span><span class="usertype">value_type</span><span class="normal"> </span><span class="function">max_value</span><span class="symbol">()</span><span class="normal"> </span><span class="cbracket">{</span><span class="normal"> </span><span class="keyword">return</span><span class="normal"> value_type</span><span class="symbol">::</span><span class="function">max_value</span><span class="symbol">();</span><span class="normal"> </span><span class="cbracket">}</span>
<span class="normal">    </span><span class="cbracket">}</span><span class="symbol">;</span>

<span class="normal">    </span><span class="comment">/** Sort skew_quad datatype. */</span>
<span class="normal">    </span><span class="keyword">template</span><span class="normal"> </span><span class="symbol">&lt;</span><span class="keyword">typename</span><span class="normal"> </span><span class="classname">alphabet_type</span><span class="symbol">&gt;</span>
<span class="normal">    </span><span class="keyword">struct</span><span class="normal"> </span><span class="classname">less_quad</span>
<span class="normal">    </span><span class="cbracket">{</span>
<span class="normal">        </span><span class="keyword">typedef</span><span class="normal"> stxxl</span><span class="symbol">::</span><span class="usertype">tuple&lt;offset_type, alphabet_type, alphabet_type, alphabet_type&gt;</span><span class="normal"> value_type</span><span class="symbol">;</span>

<span class="normal">        </span><span class="type">bool</span><span class="normal"> </span><span class="keyword">operator</span><span class="normal"> </span><span class="symbol">()</span><span class="normal"> </span><span class="symbol">(</span><span class="keyword">const</span><span class="normal"> value_type</span><span class="symbol">&amp;</span><span class="normal"> a</span><span class="symbol">,</span><span class="normal"> </span><span class="keyword">const</span><span class="normal"> value_type</span><span class="symbol">&amp;</span><span class="normal"> b</span><span class="symbol">)</span><span class="normal"> </span><span class="keyword">const</span>
<span class="normal">        </span><span class="cbracket">{</span>
<span class="normal">            </span><span class="keyword">if</span><span class="normal"> </span><span class="symbol">(</span><span class="normal">a</span><span class="symbol">.</span><span class="normal">second </span><span class="symbol">==</span><span class="normal"> b</span><span class="symbol">.</span><span class="normal">second</span><span class="symbol">)</span><span class="normal"> </span><span class="cbracket">{</span>
<span class="normal">                </span><span class="keyword">if</span><span class="normal"> </span><span class="symbol">(</span><span class="normal">a</span><span class="symbol">.</span><span class="normal">third </span><span class="symbol">==</span><span class="normal"> b</span><span class="symbol">.</span><span class="normal">third</span><span class="symbol">)</span>
<span class="normal">                    </span><span class="keyword">return</span><span class="normal"> a</span><span class="symbol">.</span><span class="normal">fourth </span><span class="symbol">&lt;</span><span class="normal"> b</span><span class="symbol">.</span><span class="normal">fourth</span><span class="symbol">;</span>
<span class="normal">                </span><span class="keyword">else</span>
<span class="normal">                    </span><span class="keyword">return</span><span class="normal"> a</span><span class="symbol">.</span><span class="normal">third </span><span class="symbol">&lt;</span><span class="normal"> b</span><span class="symbol">.</span><span class="normal">third</span><span class="symbol">;</span>
<span class="normal">            </span><span class="cbracket">}</span>
<span class="normal">            </span><span class="keyword">else</span>
<span class="normal">                </span><span class="keyword">return</span><span class="normal"> a</span><span class="symbol">.</span><span class="normal">second </span><span class="symbol">&lt;</span><span class="normal"> b</span><span class="symbol">.</span><span class="normal">second</span><span class="symbol">;</span>
<span class="normal">        </span><span class="cbracket">}</span>

<span class="normal">        </span><span class="keyword">static</span><span class="normal"> </span><span class="usertype">value_type</span><span class="normal"> </span><span class="function">min_value</span><span class="symbol">()</span><span class="normal"> </span><span class="cbracket">{</span><span class="normal"> </span><span class="keyword">return</span><span class="normal"> value_type</span><span class="symbol">::</span><span class="function">min_value</span><span class="symbol">();</span><span class="normal"> </span><span class="cbracket">}</span>
<span class="normal">        </span><span class="keyword">static</span><span class="normal"> </span><span class="usertype">value_type</span><span class="normal"> </span><span class="function">max_value</span><span class="symbol">()</span><span class="normal"> </span><span class="cbracket">{</span><span class="normal"> </span><span class="keyword">return</span><span class="normal"> value_type</span><span class="symbol">::</span><span class="function">max_value</span><span class="symbol">();</span><span class="normal"> </span><span class="cbracket">}</span>
<span class="normal">    </span><span class="cbracket">}</span><span class="symbol">;</span>


<span class="normal">    </span><span class="comment">/** Check, if last two components of tree quads are equal. */</span>
<span class="normal">    </span><span class="keyword">template</span><span class="normal"> </span><span class="symbol">&lt;</span><span class="keyword">class</span><span class="normal"> </span><span class="classname">quad_type</span><span class="symbol">&gt;</span>
<span class="normal">    </span><span class="keyword">static</span><span class="normal"> </span><span class="keyword">inline</span><span class="normal"> </span><span class="type">bool</span><span class="normal"> </span><span class="function">quad_eq</span><span class="symbol">(</span><span class="keyword">const</span><span class="normal"> quad_type</span><span class="symbol">&amp;</span><span class="normal"> a</span><span class="symbol">,</span><span class="normal"> </span><span class="keyword">const</span><span class="normal"> quad_type</span><span class="symbol">&amp;</span><span class="normal"> b</span><span class="symbol">)</span>
<span class="normal">    </span><span class="cbracket">{</span>
<span class="normal">        </span><span class="keyword">return</span><span class="normal"> </span><span class="symbol">(</span><span class="normal">a</span><span class="symbol">.</span><span class="normal">second </span><span class="symbol">==</span><span class="normal"> b</span><span class="symbol">.</span><span class="normal">second</span><span class="symbol">)</span><span class="normal"> </span><span class="symbol">&amp;&amp;</span><span class="normal"> </span><span class="symbol">(</span><span class="normal">a</span><span class="symbol">.</span><span class="normal">third </span><span class="symbol">==</span><span class="normal"> b</span><span class="symbol">.</span><span class="normal">third</span><span class="symbol">)</span><span class="normal"> </span><span class="symbol">&amp;&amp;</span><span class="normal"> </span><span class="symbol">(</span><span class="normal">a</span><span class="symbol">.</span><span class="normal">fourth </span><span class="symbol">==</span><span class="normal"> b</span><span class="symbol">.</span><span class="normal">fourth</span><span class="symbol">);</span>
<span class="normal">    </span><span class="cbracket">}</span>

<span class="normal">    </span><span class="comment">/** Naming pipe for the conventional skew algorithm without discarding. */</span>
<span class="normal">    </span><span class="keyword">template</span><span class="normal"> </span><span class="symbol">&lt;</span><span class="keyword">class</span><span class="normal"> </span><span class="classname">Input</span><span class="symbol">&gt;</span>
<span class="normal">    </span><span class="keyword">class</span><span class="normal"> </span><span class="classname">naming</span>
<span class="normal">    </span><span class="cbracket">{</span>
<span class="normal">    </span><span class="keyword">public</span><span class="symbol">:</span>
<span class="normal">        </span><span class="keyword">typedef</span><span class="normal"> </span><span class="keyword">typename</span><span class="normal"> </span><span class="classname">Input</span><span class="symbol">::</span><span class="usertype">value_type</span><span class="normal"> quad_type</span><span class="symbol">;</span>

<span class="normal">        </span><span class="keyword">typedef</span><span class="normal"> </span><span class="usertype">skew_pair_type</span><span class="normal"> value_type</span><span class="symbol">;</span>

<span class="normal">    </span><span class="keyword">private</span><span class="symbol">:</span>
<span class="normal">        Input</span><span class="symbol">&amp;</span><span class="normal"> A</span><span class="symbol">;</span>

<span class="normal">        </span><span class="type">bool</span><span class="symbol">&amp;</span><span class="normal"> unique</span><span class="symbol">;</span>
<span class="normal">        </span><span class="usertype">offset_type</span><span class="normal"> lexname</span><span class="symbol">;</span>
<span class="normal">        </span><span class="usertype">quad_type</span><span class="normal"> prev</span><span class="symbol">;</span>
<span class="normal">        </span><span class="usertype">skew_pair_type</span><span class="normal"> result</span><span class="symbol">;</span>

<span class="normal">    </span><span class="keyword">public</span><span class="symbol">:</span>
<span class="normal">        </span><span class="function">naming</span><span class="symbol">(</span><span class="normal">Input</span><span class="symbol">&amp;</span><span class="normal"> A_</span><span class="symbol">,</span><span class="normal"> </span><span class="type">bool</span><span class="symbol">&amp;</span><span class="normal"> unique_</span><span class="symbol">)</span><span class="normal"> </span><span class="symbol">:</span>
<span class="normal">            </span><span class="function">A</span><span class="symbol">(</span><span class="normal">A_</span><span class="symbol">),</span><span class="normal"> </span><span class="function">unique</span><span class="symbol">(</span><span class="normal">unique_</span><span class="symbol">),</span><span class="normal"> </span><span class="function">lexname</span><span class="symbol">(</span><span class="number">0</span><span class="symbol">)</span>
<span class="normal">        </span><span class="cbracket">{</span>
<span class="normal">            </span><span class="function">assert</span><span class="symbol">(!</span><span class="normal">A</span><span class="symbol">.</span><span class="function">empty</span><span class="symbol">());</span>
<span class="normal">            unique </span><span class="symbol">=</span><span class="normal"> </span><span class="keyword">true</span><span class="symbol">;</span>

<span class="normal">            prev </span><span class="symbol">=</span><span class="normal"> </span><span class="symbol">*</span><span class="normal">A</span><span class="symbol">;</span>
<span class="normal">            result</span><span class="symbol">.</span><span class="normal">first </span><span class="symbol">=</span><span class="normal"> prev</span><span class="symbol">.</span><span class="normal">first</span><span class="symbol">;</span>
<span class="normal">            result</span><span class="symbol">.</span><span class="normal">second </span><span class="symbol">=</span><span class="normal"> lexname</span><span class="symbol">;</span>
<span class="normal">        </span><span class="cbracket">}</span>

<span class="normal">        </span><span class="keyword">const</span><span class="normal"> value_type</span><span class="symbol">&amp;</span><span class="normal"> </span><span class="keyword">operator</span><span class="normal"> </span><span class="symbol">*</span><span class="normal"> </span><span class="symbol">()</span><span class="normal"> </span><span class="keyword">const</span>
<span class="normal">        </span><span class="cbracket">{</span>
<span class="normal">            </span><span class="keyword">return</span><span class="normal"> result</span><span class="symbol">;</span>
<span class="normal">        </span><span class="cbracket">}</span>

<span class="normal">        naming</span><span class="symbol">&amp;</span><span class="normal"> </span><span class="keyword">operator</span><span class="normal"> </span><span class="symbol">++</span><span class="normal"> </span><span class="symbol">()</span>
<span class="normal">        </span><span class="cbracket">{</span>
<span class="normal">            </span><span class="function">assert</span><span class="symbol">(!</span><span class="normal">A</span><span class="symbol">.</span><span class="function">empty</span><span class="symbol">());</span>

<span class="normal">            </span><span class="symbol">++</span><span class="normal">A</span><span class="symbol">;</span>
<span class="normal">            </span><span class="keyword">if</span><span class="normal"> </span><span class="symbol">(</span><span class="normal">A</span><span class="symbol">.</span><span class="function">empty</span><span class="symbol">())</span>
<span class="normal">                </span><span class="keyword">return</span><span class="normal"> </span><span class="symbol">*</span><span class="keyword">this</span><span class="symbol">;</span>

<span class="normal">            </span><span class="usertype">quad_type</span><span class="normal"> curr </span><span class="symbol">=</span><span class="normal"> </span><span class="symbol">*</span><span class="normal">A</span><span class="symbol">;</span>
<span class="normal">            </span><span class="keyword">if</span><span class="normal"> </span><span class="symbol">(!</span><span class="function">quad_eq</span><span class="symbol">(</span><span class="normal">prev</span><span class="symbol">,</span><span class="normal"> curr</span><span class="symbol">))</span><span class="normal"> </span><span class="cbracket">{</span>
<span class="normal">                </span><span class="symbol">++</span><span class="normal">lexname</span><span class="symbol">;</span>
<span class="normal">            </span><span class="cbracket">}</span><span class="normal"> </span><span class="keyword">else</span><span class="normal"> </span><span class="cbracket">{</span>
<span class="normal">                </span><span class="keyword">if</span><span class="normal"> </span><span class="symbol">(!</span><span class="normal">A</span><span class="symbol">.</span><span class="function">empty</span><span class="symbol">()</span><span class="normal"> </span><span class="symbol">&amp;&amp;</span><span class="normal"> curr</span><span class="symbol">.</span><span class="normal">second </span><span class="symbol">!=</span><span class="normal"> </span><span class="function">offset_type</span><span class="symbol">(</span><span class="number">0</span><span class="symbol">))</span><span class="normal"> </span><span class="cbracket">{</span>
<span class="normal">                    unique </span><span class="symbol">=</span><span class="normal"> </span><span class="keyword">false</span><span class="symbol">;</span>
<span class="normal">                </span><span class="cbracket">}</span>
<span class="normal">            </span><span class="cbracket">}</span>

<span class="normal">            result</span><span class="symbol">.</span><span class="normal">first </span><span class="symbol">=</span><span class="normal"> curr</span><span class="symbol">.</span><span class="normal">first</span><span class="symbol">;</span>
<span class="normal">            result</span><span class="symbol">.</span><span class="normal">second </span><span class="symbol">=</span><span class="normal"> lexname</span><span class="symbol">;</span>

<span class="normal">            prev </span><span class="symbol">=</span><span class="normal"> curr</span><span class="symbol">;</span>
<span class="normal">            </span><span class="keyword">return</span><span class="normal"> </span><span class="symbol">*</span><span class="keyword">this</span><span class="symbol">;</span>
<span class="normal">        </span><span class="cbracket">}</span>

<span class="normal">        </span><span class="type">bool</span><span class="normal"> </span><span class="function">empty</span><span class="symbol">()</span><span class="normal"> </span><span class="keyword">const</span>
<span class="normal">        </span><span class="cbracket">{</span>
<span class="normal">            </span><span class="keyword">return</span><span class="normal"> A</span><span class="symbol">.</span><span class="function">empty</span><span class="symbol">();</span>
<span class="normal">        </span><span class="cbracket">}</span>
<span class="normal">    </span><span class="cbracket">}</span><span class="symbol">;</span>

<span class="normal">    </span><span class="comment">/** Create tuples of 2 components until one of the input streams are empty. */</span>
<span class="normal">    </span><span class="keyword">template</span><span class="normal"> </span><span class="symbol">&lt;</span><span class="keyword">class</span><span class="normal"> </span><span class="classname">InputA</span><span class="symbol">,</span><span class="normal"> </span><span class="keyword">class</span><span class="normal"> </span><span class="classname">InputB</span><span class="symbol">,</span><span class="normal"> </span><span class="keyword">const</span><span class="normal"> </span><span class="type">int</span><span class="normal"> add_alphabet </span><span class="symbol">=</span><span class="normal"> </span><span class="number">0</span><span class="symbol">&gt;</span>
<span class="normal">    </span><span class="keyword">class</span><span class="normal"> </span><span class="classname">make_pairs</span>
<span class="normal">    </span><span class="cbracket">{</span>
<span class="normal">    </span><span class="keyword">public</span><span class="symbol">:</span>
<span class="normal">        </span><span class="keyword">typedef</span><span class="normal"> stxxl</span><span class="symbol">::</span><span class="usertype">tuple&lt;typename InputA::value_type, offset_type&gt;</span><span class="normal"> value_type</span><span class="symbol">;</span>

<span class="normal">    </span><span class="keyword">private</span><span class="symbol">:</span>
<span class="normal">        InputA</span><span class="symbol">&amp;</span><span class="normal"> A</span><span class="symbol">;</span>
<span class="normal">        InputB</span><span class="symbol">&amp;</span><span class="normal"> B</span><span class="symbol">;</span>
<span class="normal">        </span><span class="usertype">value_type</span><span class="normal"> result</span><span class="symbol">;</span>

<span class="normal">    </span><span class="keyword">public</span><span class="symbol">:</span>
<span class="normal">        </span><span class="function">make_pairs</span><span class="symbol">(</span><span class="normal">InputA</span><span class="symbol">&amp;</span><span class="normal"> a</span><span class="symbol">,</span><span class="normal"> InputB</span><span class="symbol">&amp;</span><span class="normal"> b</span><span class="symbol">)</span>
<span class="normal">            </span><span class="symbol">:</span><span class="normal"> </span><span class="function">A</span><span class="symbol">(</span><span class="normal">a</span><span class="symbol">),</span><span class="normal"> </span><span class="function">B</span><span class="symbol">(</span><span class="normal">b</span><span class="symbol">)</span>
<span class="normal">        </span><span class="cbracket">{</span>
<span class="normal">            </span><span class="function">assert</span><span class="symbol">(!</span><span class="normal">A</span><span class="symbol">.</span><span class="function">empty</span><span class="symbol">());</span>
<span class="normal">            </span><span class="function">assert</span><span class="symbol">(!</span><span class="normal">B</span><span class="symbol">.</span><span class="function">empty</span><span class="symbol">());</span>
<span class="normal">            </span><span class="keyword">if</span><span class="normal"> </span><span class="symbol">(!</span><span class="function">empty</span><span class="symbol">())</span><span class="normal"> </span><span class="cbracket">{</span>
<span class="normal">                result </span><span class="symbol">=</span><span class="normal"> </span><span class="function">value_type</span><span class="symbol">(*</span><span class="normal">A</span><span class="symbol">,</span><span class="normal"> </span><span class="symbol">*</span><span class="normal">B </span><span class="symbol">+</span><span class="normal"> add_alphabet</span><span class="symbol">);</span>
<span class="normal">            </span><span class="cbracket">}</span>
<span class="normal">        </span><span class="cbracket">}</span>

<span class="normal">        </span><span class="keyword">const</span><span class="normal"> value_type</span><span class="symbol">&amp;</span><span class="normal"> </span><span class="keyword">operator</span><span class="normal"> </span><span class="symbol">*</span><span class="normal"> </span><span class="symbol">()</span><span class="normal"> </span><span class="keyword">const</span>
<span class="normal">        </span><span class="cbracket">{</span><span class="normal"> </span><span class="keyword">return</span><span class="normal"> result</span><span class="symbol">;</span><span class="normal"> </span><span class="cbracket">}</span>

<span class="normal">        make_pairs</span><span class="symbol">&amp;</span><span class="normal"> </span><span class="keyword">operator</span><span class="normal"> </span><span class="symbol">++</span><span class="normal"> </span><span class="symbol">()</span>
<span class="normal">        </span><span class="cbracket">{</span>
<span class="normal">            </span><span class="function">assert</span><span class="symbol">(!</span><span class="normal">A</span><span class="symbol">.</span><span class="function">empty</span><span class="symbol">());</span>
<span class="normal">            </span><span class="function">assert</span><span class="symbol">(!</span><span class="normal">B</span><span class="symbol">.</span><span class="function">empty</span><span class="symbol">());</span>

<span class="normal">            </span><span class="symbol">++</span><span class="normal">A</span><span class="symbol">;</span>
<span class="normal">            </span><span class="symbol">++</span><span class="normal">B</span><span class="symbol">;</span>

<span class="normal">            </span><span class="keyword">if</span><span class="normal"> </span><span class="symbol">(!</span><span class="normal">A</span><span class="symbol">.</span><span class="function">empty</span><span class="symbol">()</span><span class="normal"> </span><span class="symbol">&amp;&amp;</span><span class="normal"> </span><span class="symbol">!</span><span class="normal">B</span><span class="symbol">.</span><span class="function">empty</span><span class="symbol">())</span><span class="normal"> </span><span class="cbracket">{</span>
<span class="normal">                result </span><span class="symbol">=</span><span class="normal"> </span><span class="function">value_type</span><span class="symbol">(*</span><span class="normal">A</span><span class="symbol">,</span><span class="normal"> </span><span class="symbol">*</span><span class="normal">B </span><span class="symbol">+</span><span class="normal"> add_alphabet</span><span class="symbol">);</span>
<span class="normal">            </span><span class="cbracket">}</span>

<span class="normal">            </span><span class="keyword">return</span><span class="normal"> </span><span class="symbol">*</span><span class="keyword">this</span><span class="symbol">;</span>
<span class="normal">        </span><span class="cbracket">}</span>

<span class="normal">        </span><span class="type">bool</span><span class="normal"> </span><span class="function">empty</span><span class="symbol">()</span><span class="normal"> </span><span class="keyword">const</span>
<span class="normal">        </span><span class="cbracket">{</span><span class="normal"> </span><span class="keyword">return</span><span class="normal"> </span><span class="symbol">(</span><span class="normal">A</span><span class="symbol">.</span><span class="function">empty</span><span class="symbol">()</span><span class="normal"> </span><span class="symbol">||</span><span class="normal"> B</span><span class="symbol">.</span><span class="function">empty</span><span class="symbol">());</span><span class="normal"> </span><span class="cbracket">}</span>
<span class="normal">    </span><span class="cbracket">}</span><span class="symbol">;</span>


<span class="normal">    </span><span class="comment">/**</span>
<span class="comment">     * Collect three characters t_i, t_{i+1}, t_{i+2} beginning at the index</span>
<span class="comment">     * i. Since we need at least one unique endcaracter, we free the first</span>
<span class="comment">     * characters i.e. we map (t_i) -&gt; (i,t_i,t_{i+1},t_{i+2})</span>
<span class="comment">     *</span>
<span class="comment">     * </span><span class="type">@param</span><span class="comment"> Input holds all characters t_i from input string t</span>
<span class="comment">     * </span><span class="type">@param</span><span class="comment"> alphabet_type</span>
<span class="comment">     * </span><span class="type">@param</span><span class="comment"> add_alphabet</span>
<span class="comment">     */</span>
<span class="normal">    </span><span class="keyword">template</span><span class="normal"> </span><span class="symbol">&lt;</span><span class="keyword">class</span><span class="normal"> </span><span class="classname">Input</span><span class="symbol">,</span><span class="normal"> </span><span class="keyword">typename</span><span class="normal"> </span><span class="classname">alphabet_type</span><span class="symbol">,</span><span class="normal"> </span><span class="keyword">const</span><span class="normal"> </span><span class="type">int</span><span class="normal"> add_alphabet </span><span class="symbol">=</span><span class="normal"> </span><span class="number">0</span><span class="symbol">&gt;</span>
<span class="normal">    </span><span class="keyword">class</span><span class="normal"> </span><span class="classname">make_quads</span>
<span class="normal">    </span><span class="cbracket">{</span>
<span class="normal">    </span><span class="keyword">public</span><span class="symbol">:</span>
<span class="normal">        </span><span class="keyword">typedef</span><span class="normal"> stxxl</span><span class="symbol">::</span><span class="usertype">tuple&lt;offset_type, alphabet_type, alphabet_type, alphabet_type&gt;</span><span class="normal"> value_type</span><span class="symbol">;</span>

<span class="normal">    </span><span class="keyword">private</span><span class="symbol">:</span>
<span class="normal">        Input</span><span class="symbol">&amp;</span><span class="normal"> A</span><span class="symbol">;</span>
<span class="normal">        </span><span class="usertype">value_type</span><span class="normal"> current</span><span class="symbol">;</span>
<span class="normal">        </span><span class="usertype">offset_type</span><span class="normal"> counter</span><span class="symbol">;</span>
<span class="normal">        </span><span class="type">unsigned</span><span class="normal"> </span><span class="type">int</span><span class="normal"> z3z</span><span class="symbol">;</span><span class="normal">  </span><span class="comment">// = counter mod 3, ("+",Z/3Z) is cheaper than %</span>
<span class="normal">        </span><span class="type">bool</span><span class="normal"> finished</span><span class="symbol">;</span>

<span class="normal">        offset_array_type</span><span class="symbol">&amp;</span><span class="normal"> text</span><span class="symbol">;</span>

<span class="normal">    </span><span class="keyword">public</span><span class="symbol">:</span>
<span class="normal">        </span><span class="function">make_quads</span><span class="symbol">(</span><span class="normal">Input</span><span class="symbol">&amp;</span><span class="normal"> data_in_</span><span class="symbol">,</span><span class="normal"> offset_array_type</span><span class="symbol">&amp;</span><span class="normal"> text_</span><span class="symbol">)</span>
<span class="normal">            </span><span class="symbol">:</span><span class="normal"> </span><span class="function">A</span><span class="symbol">(</span><span class="normal">data_in_</span><span class="symbol">),</span>
<span class="normal">              </span><span class="function">current</span><span class="symbol">(</span><span class="number">0</span><span class="symbol">,</span><span class="normal"> </span><span class="number">0</span><span class="symbol">,</span><span class="normal"> </span><span class="number">0</span><span class="symbol">,</span><span class="normal"> </span><span class="number">0</span><span class="symbol">),</span>
<span class="normal">              </span><span class="function">counter</span><span class="symbol">(</span><span class="number">0</span><span class="symbol">),</span>
<span class="normal">              </span><span class="function">z3z</span><span class="symbol">(</span><span class="number">0</span><span class="symbol">),</span>
<span class="normal">              </span><span class="function">finished</span><span class="symbol">(</span><span class="keyword">false</span><span class="symbol">),</span>
<span class="normal">              </span><span class="function">text</span><span class="symbol">(</span><span class="normal">text_</span><span class="symbol">)</span>
<span class="normal">        </span><span class="cbracket">{</span>
<span class="normal">            </span><span class="function">assert</span><span class="symbol">(!</span><span class="normal">A</span><span class="symbol">.</span><span class="function">empty</span><span class="symbol">());</span>

<span class="normal">            current</span><span class="symbol">.</span><span class="normal">first </span><span class="symbol">=</span><span class="normal"> counter</span><span class="symbol">;</span>
<span class="normal">            current</span><span class="symbol">.</span><span class="normal">second </span><span class="symbol">=</span><span class="normal"> </span><span class="symbol">(*</span><span class="normal">A</span><span class="symbol">).</span><span class="normal">second </span><span class="symbol">+</span><span class="normal"> add_alphabet</span><span class="symbol">;</span>
<span class="normal">            </span><span class="symbol">++</span><span class="normal">A</span><span class="symbol">;</span>

<span class="normal">            </span><span class="keyword">if</span><span class="normal"> </span><span class="symbol">(!</span><span class="normal">A</span><span class="symbol">.</span><span class="function">empty</span><span class="symbol">())</span><span class="normal"> </span><span class="cbracket">{</span>
<span class="normal">                current</span><span class="symbol">.</span><span class="normal">third </span><span class="symbol">=</span><span class="normal"> </span><span class="symbol">(*</span><span class="normal">A</span><span class="symbol">).</span><span class="normal">second </span><span class="symbol">+</span><span class="normal"> add_alphabet</span><span class="symbol">;</span>
<span class="normal">                </span><span class="symbol">++</span><span class="normal">A</span><span class="symbol">;</span>
<span class="normal">            </span><span class="cbracket">}</span>
<span class="normal">            </span><span class="keyword">else</span><span class="normal"> </span><span class="cbracket">{</span>
<span class="normal">                current</span><span class="symbol">.</span><span class="normal">third </span><span class="symbol">=</span><span class="normal"> </span><span class="number">0</span><span class="symbol">;</span>
<span class="normal">                current</span><span class="symbol">.</span><span class="normal">fourth </span><span class="symbol">=</span><span class="normal"> </span><span class="number">0</span><span class="symbol">;</span>
<span class="normal">            </span><span class="cbracket">}</span>

<span class="normal">            </span><span class="keyword">if</span><span class="normal"> </span><span class="symbol">(!</span><span class="normal">A</span><span class="symbol">.</span><span class="function">empty</span><span class="symbol">())</span><span class="normal"> </span><span class="cbracket">{</span>
<span class="normal">                current</span><span class="symbol">.</span><span class="normal">fourth </span><span class="symbol">=</span><span class="normal"> </span><span class="symbol">(*</span><span class="normal">A</span><span class="symbol">).</span><span class="normal">second </span><span class="symbol">+</span><span class="normal"> add_alphabet</span><span class="symbol">;</span>
<span class="normal">            </span><span class="cbracket">}</span>
<span class="normal">            </span><span class="keyword">else</span><span class="normal"> </span><span class="cbracket">{</span>
<span class="normal">                current</span><span class="symbol">.</span><span class="normal">fourth </span><span class="symbol">=</span><span class="normal"> </span><span class="number">0</span><span class="symbol">;</span>
<span class="normal">            </span><span class="cbracket">}</span>
<span class="normal">        </span><span class="cbracket">}</span>

<span class="normal">        </span><span class="keyword">const</span><span class="normal"> value_type</span><span class="symbol">&amp;</span><span class="normal"> </span><span class="keyword">operator</span><span class="normal"> </span><span class="symbol">*</span><span class="normal"> </span><span class="symbol">()</span><span class="normal"> </span><span class="keyword">const</span>
<span class="normal">        </span><span class="cbracket">{</span><span class="normal"> </span><span class="keyword">return</span><span class="normal"> current</span><span class="symbol">;</span><span class="normal"> </span><span class="cbracket">}</span>

<span class="normal">        make_quads</span><span class="symbol">&amp;</span><span class="normal"> </span><span class="keyword">operator</span><span class="normal"> </span><span class="symbol">++</span><span class="normal"> </span><span class="symbol">()</span>
<span class="normal">        </span><span class="cbracket">{</span>
<span class="normal">            </span><span class="function">assert</span><span class="symbol">(!</span><span class="normal">A</span><span class="symbol">.</span><span class="function">empty</span><span class="symbol">()</span><span class="normal"> </span><span class="symbol">||</span><span class="normal"> </span><span class="symbol">!</span><span class="normal">finished</span><span class="symbol">);</span>

<span class="normal">            </span><span class="keyword">if</span><span class="normal"> </span><span class="symbol">(</span><span class="normal">current</span><span class="symbol">.</span><span class="normal">second </span><span class="symbol">!=</span><span class="normal"> </span><span class="function">offset_type</span><span class="symbol">(</span><span class="number">0</span><span class="symbol">))</span><span class="normal"> </span><span class="cbracket">{</span>
<span class="normal">                text</span><span class="symbol">.</span><span class="function">push_back</span><span class="symbol">(</span><span class="normal">current</span><span class="symbol">.</span><span class="normal">second</span><span class="symbol">);</span>
<span class="normal">            </span><span class="cbracket">}</span>

<span class="normal">            </span><span class="comment">// Calculate module</span>
<span class="normal">            </span><span class="keyword">if</span><span class="normal"> </span><span class="symbol">(++</span><span class="normal">z3z </span><span class="symbol">==</span><span class="normal"> </span><span class="number">3</span><span class="symbol">)</span><span class="normal"> z3z </span><span class="symbol">=</span><span class="normal"> </span><span class="number">0</span><span class="symbol">;</span>

<span class="normal">            current</span><span class="symbol">.</span><span class="normal">first </span><span class="symbol">=</span><span class="normal"> </span><span class="symbol">++</span><span class="normal">counter</span><span class="symbol">;</span>
<span class="normal">            current</span><span class="symbol">.</span><span class="normal">second </span><span class="symbol">=</span><span class="normal"> current</span><span class="symbol">.</span><span class="normal">third</span><span class="symbol">;</span>
<span class="normal">            current</span><span class="symbol">.</span><span class="normal">third </span><span class="symbol">=</span><span class="normal"> current</span><span class="symbol">.</span><span class="normal">fourth</span><span class="symbol">;</span>

<span class="normal">            </span><span class="keyword">if</span><span class="normal"> </span><span class="symbol">(!</span><span class="normal">A</span><span class="symbol">.</span><span class="function">empty</span><span class="symbol">())</span>
<span class="normal">                </span><span class="symbol">++</span><span class="normal">A</span><span class="symbol">;</span>

<span class="normal">            </span><span class="keyword">if</span><span class="normal"> </span><span class="symbol">(!</span><span class="normal">A</span><span class="symbol">.</span><span class="function">empty</span><span class="symbol">())</span><span class="normal"> </span><span class="cbracket">{</span>
<span class="normal">                current</span><span class="symbol">.</span><span class="normal">fourth </span><span class="symbol">=</span><span class="normal"> </span><span class="symbol">(*</span><span class="normal">A</span><span class="symbol">).</span><span class="normal">second </span><span class="symbol">+</span><span class="normal"> add_alphabet</span><span class="symbol">;</span>
<span class="normal">            </span><span class="cbracket">}</span>
<span class="normal">            </span><span class="keyword">else</span><span class="normal"> </span><span class="cbracket">{</span>
<span class="normal">                current</span><span class="symbol">.</span><span class="normal">fourth </span><span class="symbol">=</span><span class="normal"> </span><span class="number">0</span><span class="symbol">;</span>
<span class="normal">            </span><span class="cbracket">}</span>

<span class="normal">            </span><span class="comment">// Inserts a dummy tuple for input sizes of n%3==1</span>
<span class="normal">            </span><span class="keyword">if</span><span class="normal"> </span><span class="symbol">((</span><span class="normal">current</span><span class="symbol">.</span><span class="normal">second </span><span class="symbol">==</span><span class="normal"> </span><span class="function">offset_type</span><span class="symbol">(</span><span class="number">0</span><span class="symbol">))</span><span class="normal"> </span><span class="symbol">&amp;&amp;</span><span class="normal"> </span><span class="symbol">(</span><span class="normal">z3z </span><span class="symbol">!=</span><span class="normal"> </span><span class="number">1</span><span class="symbol">))</span><span class="normal"> </span><span class="cbracket">{</span>
<span class="normal">                finished </span><span class="symbol">=</span><span class="normal"> </span><span class="keyword">true</span><span class="symbol">;</span>
<span class="normal">            </span><span class="cbracket">}</span>

<span class="normal">            </span><span class="keyword">return</span><span class="normal"> </span><span class="symbol">*</span><span class="keyword">this</span><span class="symbol">;</span>
<span class="normal">        </span><span class="cbracket">}</span>

<span class="normal">        </span><span class="type">bool</span><span class="normal"> </span><span class="function">empty</span><span class="symbol">()</span><span class="normal"> </span><span class="keyword">const</span>
<span class="normal">        </span><span class="cbracket">{</span><span class="normal"> </span><span class="keyword">return</span><span class="normal"> </span><span class="symbol">(</span><span class="normal">A</span><span class="symbol">.</span><span class="function">empty</span><span class="symbol">()</span><span class="normal"> </span><span class="symbol">&amp;&amp;</span><span class="normal"> finished</span><span class="symbol">);</span><span class="normal"> </span><span class="cbracket">}</span>
<span class="normal">    </span><span class="cbracket">}</span><span class="symbol">;</span>

<span class="normal">    </span><span class="comment">/** Drop 1/3 of the input. More exactly the offsets at positions (0 mod</span>
<span class="comment">     * 3). Index begins with 0. */</span>
<span class="normal">    </span><span class="keyword">template</span><span class="normal"> </span><span class="symbol">&lt;</span><span class="keyword">class</span><span class="normal"> </span><span class="classname">Input</span><span class="symbol">&gt;</span>
<span class="normal">    </span><span class="keyword">class</span><span class="normal"> </span><span class="classname">extract_mod12</span>
<span class="normal">    </span><span class="cbracket">{</span>
<span class="normal">    </span><span class="keyword">public</span><span class="symbol">:</span>
<span class="normal">        </span><span class="keyword">typedef</span><span class="normal"> </span><span class="keyword">typename</span><span class="normal"> </span><span class="classname">Input</span><span class="symbol">::</span><span class="usertype">value_type</span><span class="normal"> value_type</span><span class="symbol">;</span>

<span class="normal">    </span><span class="keyword">private</span><span class="symbol">:</span>
<span class="normal">        Input</span><span class="symbol">&amp;</span><span class="normal"> A</span><span class="symbol">;</span>
<span class="normal">        </span><span class="usertype">offset_type</span><span class="normal"> counter</span><span class="symbol">;</span>
<span class="normal">        </span><span class="usertype">offset_type</span><span class="normal"> output_counter</span><span class="symbol">;</span>
<span class="normal">        </span><span class="usertype">value_type</span><span class="normal"> result</span><span class="symbol">;</span>

<span class="normal">    </span><span class="keyword">public</span><span class="symbol">:</span>
<span class="normal">        </span><span class="function">extract_mod12</span><span class="symbol">(</span><span class="normal">Input</span><span class="symbol">&amp;</span><span class="normal"> A_</span><span class="symbol">)</span>
<span class="normal">            </span><span class="symbol">:</span><span class="normal"> </span><span class="function">A</span><span class="symbol">(</span><span class="normal">A_</span><span class="symbol">),</span>
<span class="normal">              </span><span class="function">counter</span><span class="symbol">(</span><span class="number">0</span><span class="symbol">),</span>
<span class="normal">              </span><span class="function">output_counter</span><span class="symbol">(</span><span class="number">0</span><span class="symbol">)</span>
<span class="normal">        </span><span class="cbracket">{</span>
<span class="normal">            </span><span class="function">assert</span><span class="symbol">(!</span><span class="normal">A</span><span class="symbol">.</span><span class="function">empty</span><span class="symbol">());</span>
<span class="normal">            </span><span class="symbol">++</span><span class="normal">A</span><span class="symbol">,</span><span class="normal"> </span><span class="symbol">++</span><span class="normal">counter</span><span class="symbol">;</span><span class="normal">  </span><span class="comment">// skip 0 = mod0 offset</span>
<span class="normal">            </span><span class="keyword">if</span><span class="normal"> </span><span class="symbol">(!</span><span class="normal">A</span><span class="symbol">.</span><span class="function">empty</span><span class="symbol">())</span><span class="normal"> </span><span class="cbracket">{</span>
<span class="normal">                result </span><span class="symbol">=</span><span class="normal"> </span><span class="symbol">*</span><span class="normal">A</span><span class="symbol">;</span>
<span class="normal">                result</span><span class="symbol">.</span><span class="normal">first </span><span class="symbol">=</span><span class="normal"> output_counter</span><span class="symbol">;</span>
<span class="normal">            </span><span class="cbracket">}</span>
<span class="normal">        </span><span class="cbracket">}</span>

<span class="normal">        </span><span class="keyword">const</span><span class="normal"> value_type</span><span class="symbol">&amp;</span><span class="normal"> </span><span class="keyword">operator</span><span class="normal"> </span><span class="symbol">*</span><span class="normal"> </span><span class="symbol">()</span><span class="normal"> </span><span class="keyword">const</span>
<span class="normal">        </span><span class="cbracket">{</span><span class="normal"> </span><span class="keyword">return</span><span class="normal"> result</span><span class="symbol">;</span><span class="normal"> </span><span class="cbracket">}</span>

<span class="normal">        extract_mod12</span><span class="symbol">&amp;</span><span class="normal"> </span><span class="keyword">operator</span><span class="normal"> </span><span class="symbol">++</span><span class="normal"> </span><span class="symbol">()</span>
<span class="normal">        </span><span class="cbracket">{</span>
<span class="normal">            </span><span class="function">assert</span><span class="symbol">(!</span><span class="normal">A</span><span class="symbol">.</span><span class="function">empty</span><span class="symbol">());</span>

<span class="normal">            </span><span class="symbol">++</span><span class="normal">A</span><span class="symbol">,</span><span class="normal"> </span><span class="symbol">++</span><span class="normal">counter</span><span class="symbol">,</span><span class="normal"> </span><span class="symbol">++</span><span class="normal">output_counter</span><span class="symbol">;</span>

<span class="normal">            </span><span class="keyword">if</span><span class="normal"> </span><span class="symbol">(!</span><span class="normal">A</span><span class="symbol">.</span><span class="function">empty</span><span class="symbol">()</span><span class="normal"> </span><span class="symbol">&amp;&amp;</span><span class="normal"> </span><span class="symbol">(</span><span class="normal">counter </span><span class="symbol">%</span><span class="normal"> </span><span class="number">3</span><span class="symbol">)</span><span class="normal"> </span><span class="symbol">==</span><span class="normal"> </span><span class="number">0</span><span class="symbol">)</span><span class="normal"> </span><span class="cbracket">{</span>
<span class="normal">                </span><span class="comment">// skip mod0 offsets</span>
<span class="normal">                </span><span class="symbol">++</span><span class="normal">A</span><span class="symbol">,</span><span class="normal"> </span><span class="symbol">++</span><span class="normal">counter</span><span class="symbol">;</span>
<span class="normal">            </span><span class="cbracket">}</span>
<span class="normal">            </span><span class="keyword">if</span><span class="normal"> </span><span class="symbol">(!</span><span class="normal">A</span><span class="symbol">.</span><span class="function">empty</span><span class="symbol">())</span><span class="normal"> </span><span class="cbracket">{</span>
<span class="normal">                result </span><span class="symbol">=</span><span class="normal"> </span><span class="symbol">*</span><span class="normal">A</span><span class="symbol">;</span>
<span class="normal">                result</span><span class="symbol">.</span><span class="normal">first </span><span class="symbol">=</span><span class="normal"> output_counter</span><span class="symbol">;</span>
<span class="normal">            </span><span class="cbracket">}</span>

<span class="normal">            </span><span class="keyword">return</span><span class="normal"> </span><span class="symbol">*</span><span class="keyword">this</span><span class="symbol">;</span>
<span class="normal">        </span><span class="cbracket">}</span>

<span class="normal">        </span><span class="type">bool</span><span class="normal"> </span><span class="function">empty</span><span class="symbol">()</span><span class="normal"> </span><span class="keyword">const</span>
<span class="normal">        </span><span class="cbracket">{</span><span class="normal"> </span><span class="keyword">return</span><span class="normal"> A</span><span class="symbol">.</span><span class="function">empty</span><span class="symbol">();</span><span class="normal"> </span><span class="cbracket">}</span>
<span class="normal">    </span><span class="cbracket">}</span><span class="symbol">;</span>


<span class="normal">    </span><span class="comment">/** Create the suffix array from the current sub problem by simple</span>
<span class="comment">     *  comparison-based merging.  More precisely: compare characters(out of</span>
<span class="comment">     *  text t) and ranks(out of ISA12) of the following constellation:</span>
<span class="comment">     *  Input constellation:</span>
<span class="comment">     *  </span><span class="type">@param</span><span class="comment"> Mod0 5-tuple (quint): </span><span class="keyword">&lt;i</span><span class="normal">, </span><span class="type">t</span><span class="normal">_</span><span class="type">i</span><span class="normal">, </span><span class="type">t</span><span class="normal">_{</span><span class="type">i</span><span class="normal">+</span><span class="type">1</span><span class="normal">}, </span><span class="type">ISA12</span><span class="normal">[</span><span class="type">i</span><span class="normal">+</span><span class="type">1</span><span class="normal">], </span><span class="type">ISA12</span><span class="normal">[</span><span class="type">i</span><span class="normal">+</span><span class="type">2</span><span class="normal">]</span><span class="keyword">&gt;</span>
<span class="comment">     *  </span><span class="type">@param</span><span class="comment"> Mod1 4-tuple (quad): </span><span class="keyword">&lt;i</span><span class="normal">, </span><span class="type">ISA12</span><span class="normal">[</span><span class="type">i</span><span class="normal">], </span><span class="type">t</span><span class="normal">_</span><span class="type">i</span><span class="normal">, </span><span class="type">ISA12</span><span class="normal">[</span><span class="type">i</span><span class="normal">+</span><span class="type">1</span><span class="normal">]</span><span class="keyword">&gt;</span>
<span class="comment">     *  </span><span class="type">@param</span><span class="comment"> Mod2 5-tuple (quint): </span><span class="keyword">&lt;i</span><span class="normal">, </span><span class="type">ISA</span><span class="normal">[</span><span class="type">i</span><span class="normal">], </span><span class="type">t</span><span class="normal">_</span><span class="type">i</span><span class="normal">, </span><span class="type">t</span><span class="normal">_{</span><span class="type">i</span><span class="normal">+</span><span class="type">1</span><span class="normal">}, </span><span class="type">ISA12</span><span class="normal">[</span><span class="type">i</span><span class="normal">+</span><span class="type">1</span><span class="normal">]</span><span class="keyword">&gt;</span>
<span class="comment">     */</span>
<span class="normal">    </span><span class="keyword">template</span><span class="normal"> </span><span class="symbol">&lt;</span><span class="keyword">class</span><span class="normal"> </span><span class="classname">Mod0</span><span class="symbol">,</span><span class="normal"> </span><span class="keyword">class</span><span class="normal"> </span><span class="classname">Mod1</span><span class="symbol">,</span><span class="normal"> </span><span class="keyword">class</span><span class="normal"> </span><span class="classname">Mod2</span><span class="symbol">&gt;</span>
<span class="normal">    </span><span class="keyword">class</span><span class="normal"> </span><span class="classname">merge_sa</span>
<span class="normal">    </span><span class="cbracket">{</span>
<span class="normal">    </span><span class="keyword">public</span><span class="symbol">:</span>
<span class="normal">        </span><span class="keyword">typedef</span><span class="normal"> </span><span class="usertype">offset_type</span><span class="normal"> value_type</span><span class="symbol">;</span>

<span class="normal">    </span><span class="keyword">private</span><span class="symbol">:</span>
<span class="normal">        Mod0</span><span class="symbol">&amp;</span><span class="normal"> A</span><span class="symbol">;</span>
<span class="normal">        Mod1</span><span class="symbol">&amp;</span><span class="normal"> B</span><span class="symbol">;</span>
<span class="normal">        Mod2</span><span class="symbol">&amp;</span><span class="normal"> C</span><span class="symbol">;</span>

<span class="normal">        </span><span class="usertype">skew_quint_type</span><span class="normal"> s0</span><span class="symbol">;</span>
<span class="normal">        </span><span class="usertype">skew_quad_type</span><span class="normal"> s1</span><span class="symbol">;</span>
<span class="normal">        </span><span class="usertype">skew_quint_type</span><span class="normal"> s2</span><span class="symbol">;</span>

<span class="normal">        </span><span class="type">int</span><span class="normal"> selected</span><span class="symbol">;</span>
<span class="normal">        </span><span class="type">bool</span><span class="normal"> done</span><span class="symbol">[</span><span class="number">3</span><span class="symbol">];</span>

<span class="normal">        </span><span class="usertype">offset_type</span><span class="normal"> index</span><span class="symbol">;</span>
<span class="normal">        </span><span class="usertype">offset_type</span><span class="normal"> merge_result</span><span class="symbol">;</span>

<span class="normal">        </span><span class="type">bool</span><span class="normal"> </span><span class="function">cmp_mod1_less_mod2</span><span class="symbol">()</span>
<span class="normal">        </span><span class="cbracket">{</span>
<span class="normal">            </span><span class="function">assert</span><span class="symbol">(!</span><span class="normal">done</span><span class="symbol">[</span><span class="number">1</span><span class="symbol">]</span><span class="normal"> </span><span class="symbol">&amp;&amp;</span><span class="normal"> </span><span class="symbol">!</span><span class="normal">done</span><span class="symbol">[</span><span class="number">2</span><span class="symbol">]);</span>

<span class="normal">            </span><span class="keyword">return</span><span class="normal"> s1</span><span class="symbol">.</span><span class="normal">second </span><span class="symbol">&lt;</span><span class="normal"> s2</span><span class="symbol">.</span><span class="normal">second</span><span class="symbol">;</span>
<span class="normal">        </span><span class="cbracket">}</span>

<span class="normal">        </span><span class="type">bool</span><span class="normal"> </span><span class="function">cmp_mod0_less_mod2</span><span class="symbol">()</span>
<span class="normal">        </span><span class="cbracket">{</span>
<span class="normal">            </span><span class="function">assert</span><span class="symbol">(!</span><span class="normal">done</span><span class="symbol">[</span><span class="number">0</span><span class="symbol">]</span><span class="normal"> </span><span class="symbol">&amp;&amp;</span><span class="normal"> </span><span class="symbol">!</span><span class="normal">done</span><span class="symbol">[</span><span class="number">2</span><span class="symbol">]);</span>

<span class="normal">            </span><span class="keyword">if</span><span class="normal"> </span><span class="symbol">(</span><span class="normal">s0</span><span class="symbol">.</span><span class="normal">second </span><span class="symbol">==</span><span class="normal"> s2</span><span class="symbol">.</span><span class="normal">third</span><span class="symbol">)</span><span class="normal"> </span><span class="cbracket">{</span>
<span class="normal">                </span><span class="keyword">if</span><span class="normal"> </span><span class="symbol">(</span><span class="normal">s0</span><span class="symbol">.</span><span class="normal">third </span><span class="symbol">==</span><span class="normal"> s2</span><span class="symbol">.</span><span class="normal">fourth</span><span class="symbol">)</span>
<span class="normal">                    </span><span class="keyword">return</span><span class="normal"> s0</span><span class="symbol">.</span><span class="normal">fifth </span><span class="symbol">&lt;</span><span class="normal"> s2</span><span class="symbol">.</span><span class="normal">fifth</span><span class="symbol">;</span>
<span class="normal">                </span><span class="keyword">else</span>
<span class="normal">                    </span><span class="keyword">return</span><span class="normal"> s0</span><span class="symbol">.</span><span class="normal">third </span><span class="symbol">&lt;</span><span class="normal"> s2</span><span class="symbol">.</span><span class="normal">fourth</span><span class="symbol">;</span>
<span class="normal">            </span><span class="cbracket">}</span>
<span class="normal">            </span><span class="keyword">else</span>
<span class="normal">                </span><span class="keyword">return</span><span class="normal"> s0</span><span class="symbol">.</span><span class="normal">second </span><span class="symbol">&lt;</span><span class="normal"> s2</span><span class="symbol">.</span><span class="normal">third</span><span class="symbol">;</span>
<span class="normal">        </span><span class="cbracket">}</span>

<span class="normal">        </span><span class="type">bool</span><span class="normal"> </span><span class="function">cmp_mod0_less_mod1</span><span class="symbol">()</span>
<span class="normal">        </span><span class="cbracket">{</span>
<span class="normal">            </span><span class="function">assert</span><span class="symbol">(!</span><span class="normal">done</span><span class="symbol">[</span><span class="number">0</span><span class="symbol">]</span><span class="normal"> </span><span class="symbol">&amp;&amp;</span><span class="normal"> </span><span class="symbol">!</span><span class="normal">done</span><span class="symbol">[</span><span class="number">1</span><span class="symbol">]);</span>

<span class="normal">            </span><span class="keyword">if</span><span class="normal"> </span><span class="symbol">(</span><span class="normal">s0</span><span class="symbol">.</span><span class="normal">second </span><span class="symbol">==</span><span class="normal"> s1</span><span class="symbol">.</span><span class="normal">third</span><span class="symbol">)</span>
<span class="normal">                </span><span class="keyword">return</span><span class="normal"> s0</span><span class="symbol">.</span><span class="normal">fourth </span><span class="symbol">&lt;</span><span class="normal"> s1</span><span class="symbol">.</span><span class="normal">fourth</span><span class="symbol">;</span>
<span class="normal">            </span><span class="keyword">else</span>
<span class="normal">                </span><span class="keyword">return</span><span class="normal"> s0</span><span class="symbol">.</span><span class="normal">second </span><span class="symbol">&lt;</span><span class="normal"> s1</span><span class="symbol">.</span><span class="normal">third</span><span class="symbol">;</span>
<span class="normal">        </span><span class="cbracket">}</span>

<span class="normal">        </span><span class="type">void</span><span class="normal"> </span><span class="function">merge</span><span class="symbol">()</span>
<span class="normal">        </span><span class="cbracket">{</span>
<span class="normal">            </span><span class="function">assert</span><span class="symbol">(!</span><span class="normal">done</span><span class="symbol">[</span><span class="number">0</span><span class="symbol">]</span><span class="normal"> </span><span class="symbol">||</span><span class="normal"> </span><span class="symbol">!</span><span class="normal">done</span><span class="symbol">[</span><span class="number">1</span><span class="symbol">]</span><span class="normal"> </span><span class="symbol">||</span><span class="normal"> </span><span class="symbol">!</span><span class="normal">done</span><span class="symbol">[</span><span class="number">2</span><span class="symbol">]);</span>

<span class="normal">            </span><span class="keyword">if</span><span class="normal"> </span><span class="symbol">(</span><span class="normal">done</span><span class="symbol">[</span><span class="number">0</span><span class="symbol">])</span>
<span class="normal">            </span><span class="cbracket">{</span>
<span class="normal">                </span><span class="keyword">if</span><span class="normal"> </span><span class="symbol">(</span><span class="normal">done</span><span class="symbol">[</span><span class="number">2</span><span class="symbol">]</span><span class="normal"> </span><span class="symbol">||</span><span class="normal"> </span><span class="symbol">(!</span><span class="normal">done</span><span class="symbol">[</span><span class="number">1</span><span class="symbol">]</span><span class="normal"> </span><span class="symbol">&amp;&amp;</span><span class="normal"> </span><span class="function">cmp_mod1_less_mod2</span><span class="symbol">()))</span>
<span class="normal">                </span><span class="cbracket">{</span>
<span class="normal">                    selected </span><span class="symbol">=</span><span class="normal"> </span><span class="number">1</span><span class="symbol">;</span>
<span class="normal">                    merge_result </span><span class="symbol">=</span><span class="normal"> s1</span><span class="symbol">.</span><span class="normal">first</span><span class="symbol">;</span>
<span class="normal">                </span><span class="cbracket">}</span>
<span class="normal">                </span><span class="keyword">else</span>
<span class="normal">                </span><span class="cbracket">{</span>
<span class="normal">                    selected </span><span class="symbol">=</span><span class="normal"> </span><span class="number">2</span><span class="symbol">;</span>
<span class="normal">                    merge_result </span><span class="symbol">=</span><span class="normal"> s2</span><span class="symbol">.</span><span class="normal">first</span><span class="symbol">;</span>
<span class="normal">                </span><span class="cbracket">}</span>
<span class="normal">            </span><span class="cbracket">}</span>
<span class="normal">            </span><span class="keyword">else</span><span class="normal"> </span><span class="keyword">if</span><span class="normal"> </span><span class="symbol">(</span><span class="normal">done</span><span class="symbol">[</span><span class="number">1</span><span class="symbol">]</span><span class="normal"> </span><span class="symbol">||</span><span class="normal"> </span><span class="function">cmp_mod0_less_mod1</span><span class="symbol">())</span>
<span class="normal">            </span><span class="cbracket">{</span>
<span class="normal">                </span><span class="keyword">if</span><span class="normal"> </span><span class="symbol">(</span><span class="normal">done</span><span class="symbol">[</span><span class="number">2</span><span class="symbol">]</span><span class="normal"> </span><span class="symbol">||</span><span class="normal"> </span><span class="function">cmp_mod0_less_mod2</span><span class="symbol">())</span>
<span class="normal">                </span><span class="cbracket">{</span>
<span class="normal">                    selected </span><span class="symbol">=</span><span class="normal"> </span><span class="number">0</span><span class="symbol">;</span>
<span class="normal">                    merge_result </span><span class="symbol">=</span><span class="normal"> s0</span><span class="symbol">.</span><span class="normal">first</span><span class="symbol">;</span>
<span class="normal">                </span><span class="cbracket">}</span>
<span class="normal">                </span><span class="keyword">else</span>
<span class="normal">                </span><span class="cbracket">{</span>
<span class="normal">                    selected </span><span class="symbol">=</span><span class="normal"> </span><span class="number">2</span><span class="symbol">;</span>
<span class="normal">                    merge_result </span><span class="symbol">=</span><span class="normal"> s2</span><span class="symbol">.</span><span class="normal">first</span><span class="symbol">;</span>
<span class="normal">                </span><span class="cbracket">}</span>
<span class="normal">            </span><span class="cbracket">}</span>
<span class="normal">            </span><span class="keyword">else</span>
<span class="normal">            </span><span class="cbracket">{</span>
<span class="normal">                </span><span class="keyword">if</span><span class="normal"> </span><span class="symbol">(</span><span class="normal">done</span><span class="symbol">[</span><span class="number">2</span><span class="symbol">]</span><span class="normal"> </span><span class="symbol">||</span><span class="normal"> </span><span class="function">cmp_mod1_less_mod2</span><span class="symbol">())</span>
<span class="normal">                </span><span class="cbracket">{</span>
<span class="normal">                    selected </span><span class="symbol">=</span><span class="normal"> </span><span class="number">1</span><span class="symbol">;</span>
<span class="normal">                    merge_result </span><span class="symbol">=</span><span class="normal"> s1</span><span class="symbol">.</span><span class="normal">first</span><span class="symbol">;</span>
<span class="normal">                </span><span class="cbracket">}</span>
<span class="normal">                </span><span class="keyword">else</span>
<span class="normal">                </span><span class="cbracket">{</span>
<span class="normal">                    selected </span><span class="symbol">=</span><span class="normal"> </span><span class="number">2</span><span class="symbol">;</span>
<span class="normal">                    merge_result </span><span class="symbol">=</span><span class="normal"> s2</span><span class="symbol">.</span><span class="normal">first</span><span class="symbol">;</span>
<span class="normal">                </span><span class="cbracket">}</span>
<span class="normal">            </span><span class="cbracket">}</span>

<span class="normal">            </span><span class="function">assert</span><span class="symbol">(!</span><span class="normal">done</span><span class="symbol">[</span><span class="normal">selected</span><span class="symbol">]);</span>
<span class="normal">        </span><span class="cbracket">}</span>

<span class="normal">    </span><span class="keyword">public</span><span class="symbol">:</span>
<span class="normal">        </span><span class="type">bool</span><span class="normal"> </span><span class="function">empty</span><span class="symbol">()</span><span class="normal"> </span><span class="keyword">const</span>
<span class="normal">        </span><span class="cbracket">{</span>
<span class="normal">            </span><span class="keyword">return</span><span class="normal"> </span><span class="symbol">(</span><span class="normal">A</span><span class="symbol">.</span><span class="function">empty</span><span class="symbol">()</span><span class="normal"> </span><span class="symbol">&amp;&amp;</span><span class="normal"> B</span><span class="symbol">.</span><span class="function">empty</span><span class="symbol">()</span><span class="normal"> </span><span class="symbol">&amp;&amp;</span><span class="normal"> C</span><span class="symbol">.</span><span class="function">empty</span><span class="symbol">());</span>
<span class="normal">        </span><span class="cbracket">}</span>

<span class="normal">        </span><span class="function">merge_sa</span><span class="symbol">(</span><span class="normal">Mod0</span><span class="symbol">&amp;</span><span class="normal"> x1</span><span class="symbol">,</span><span class="normal"> Mod1</span><span class="symbol">&amp;</span><span class="normal"> x2</span><span class="symbol">,</span><span class="normal"> Mod2</span><span class="symbol">&amp;</span><span class="normal"> x3</span><span class="symbol">)</span>
<span class="normal">            </span><span class="symbol">:</span><span class="normal"> </span><span class="function">A</span><span class="symbol">(</span><span class="normal">x1</span><span class="symbol">),</span><span class="normal"> </span><span class="function">B</span><span class="symbol">(</span><span class="normal">x2</span><span class="symbol">),</span><span class="normal"> </span><span class="function">C</span><span class="symbol">(</span><span class="normal">x3</span><span class="symbol">),</span><span class="normal"> </span><span class="function">selected</span><span class="symbol">(-</span><span class="number">1</span><span class="symbol">),</span><span class="normal"> </span><span class="function">index</span><span class="symbol">(</span><span class="number">0</span><span class="symbol">)</span>
<span class="normal">        </span><span class="cbracket">{</span>
<span class="normal">            </span><span class="function">assert</span><span class="symbol">(!</span><span class="normal">A</span><span class="symbol">.</span><span class="function">empty</span><span class="symbol">());</span>
<span class="normal">            </span><span class="function">assert</span><span class="symbol">(!</span><span class="normal">B</span><span class="symbol">.</span><span class="function">empty</span><span class="symbol">());</span>
<span class="normal">            </span><span class="function">assert</span><span class="symbol">(!</span><span class="normal">C</span><span class="symbol">.</span><span class="function">empty</span><span class="symbol">());</span>
<span class="normal">            done</span><span class="symbol">[</span><span class="number">0</span><span class="symbol">]</span><span class="normal"> </span><span class="symbol">=</span><span class="normal"> </span><span class="keyword">false</span><span class="symbol">;</span>
<span class="normal">            done</span><span class="symbol">[</span><span class="number">1</span><span class="symbol">]</span><span class="normal"> </span><span class="symbol">=</span><span class="normal"> </span><span class="keyword">false</span><span class="symbol">;</span>
<span class="normal">            done</span><span class="symbol">[</span><span class="number">2</span><span class="symbol">]</span><span class="normal"> </span><span class="symbol">=</span><span class="normal"> </span><span class="keyword">false</span><span class="symbol">;</span>
<span class="normal">            s0 </span><span class="symbol">=</span><span class="normal"> </span><span class="symbol">*</span><span class="normal">A</span><span class="symbol">;</span>
<span class="normal">            s1 </span><span class="symbol">=</span><span class="normal"> </span><span class="symbol">*</span><span class="normal">B</span><span class="symbol">;</span>
<span class="normal">            s2 </span><span class="symbol">=</span><span class="normal"> </span><span class="symbol">*</span><span class="normal">C</span><span class="symbol">;</span>

<span class="normal">            </span><span class="function">merge</span><span class="symbol">();</span>
<span class="normal">        </span><span class="cbracket">}</span>

<span class="normal">        </span><span class="keyword">const</span><span class="normal"> value_type</span><span class="symbol">&amp;</span><span class="normal"> </span><span class="keyword">operator</span><span class="normal"> </span><span class="symbol">*</span><span class="normal"> </span><span class="symbol">()</span><span class="normal"> </span><span class="keyword">const</span>
<span class="normal">        </span><span class="cbracket">{</span>
<span class="normal">            </span><span class="keyword">return</span><span class="normal"> merge_result</span><span class="symbol">;</span>
<span class="normal">        </span><span class="cbracket">}</span>

<span class="normal">        merge_sa</span><span class="symbol">&amp;</span><span class="normal"> </span><span class="keyword">operator</span><span class="normal"> </span><span class="symbol">++</span><span class="normal"> </span><span class="symbol">()</span>
<span class="normal">        </span><span class="cbracket">{</span>
<span class="normal">            </span><span class="keyword">if</span><span class="normal"> </span><span class="symbol">(</span><span class="normal">selected </span><span class="symbol">==</span><span class="normal"> </span><span class="number">0</span><span class="symbol">)</span><span class="normal"> </span><span class="cbracket">{</span>
<span class="normal">                </span><span class="function">assert</span><span class="symbol">(!</span><span class="normal">A</span><span class="symbol">.</span><span class="function">empty</span><span class="symbol">());</span>
<span class="normal">                </span><span class="symbol">++</span><span class="normal">A</span><span class="symbol">;</span>
<span class="normal">                </span><span class="keyword">if</span><span class="normal"> </span><span class="symbol">(!</span><span class="normal">A</span><span class="symbol">.</span><span class="function">empty</span><span class="symbol">())</span>
<span class="normal">                    s0 </span><span class="symbol">=</span><span class="normal"> </span><span class="symbol">*</span><span class="normal">A</span><span class="symbol">;</span>
<span class="normal">                </span><span class="keyword">else</span>
<span class="normal">                    done</span><span class="symbol">[</span><span class="number">0</span><span class="symbol">]</span><span class="normal"> </span><span class="symbol">=</span><span class="normal"> </span><span class="keyword">true</span><span class="symbol">;</span>
<span class="normal">            </span><span class="cbracket">}</span>
<span class="normal">            </span><span class="keyword">else</span><span class="normal"> </span><span class="keyword">if</span><span class="normal"> </span><span class="symbol">(</span><span class="normal">selected </span><span class="symbol">==</span><span class="normal"> </span><span class="number">1</span><span class="symbol">)</span><span class="normal"> </span><span class="cbracket">{</span>
<span class="normal">                </span><span class="function">assert</span><span class="symbol">(!</span><span class="normal">B</span><span class="symbol">.</span><span class="function">empty</span><span class="symbol">());</span>
<span class="normal">                </span><span class="symbol">++</span><span class="normal">B</span><span class="symbol">;</span>
<span class="normal">                </span><span class="keyword">if</span><span class="normal"> </span><span class="symbol">(!</span><span class="normal">B</span><span class="symbol">.</span><span class="function">empty</span><span class="symbol">())</span>
<span class="normal">                    s1 </span><span class="symbol">=</span><span class="normal"> </span><span class="symbol">*</span><span class="normal">B</span><span class="symbol">;</span>
<span class="normal">                </span><span class="keyword">else</span>
<span class="normal">                    done</span><span class="symbol">[</span><span class="number">1</span><span class="symbol">]</span><span class="normal"> </span><span class="symbol">=</span><span class="normal"> </span><span class="keyword">true</span><span class="symbol">;</span>
<span class="normal">            </span><span class="cbracket">}</span>
<span class="normal">            </span><span class="keyword">else</span><span class="normal"> </span><span class="cbracket">{</span>
<span class="normal">                </span><span class="function">assert</span><span class="symbol">(!</span><span class="normal">C</span><span class="symbol">.</span><span class="function">empty</span><span class="symbol">());</span>
<span class="normal">                </span><span class="function">assert</span><span class="symbol">(</span><span class="normal">selected </span><span class="symbol">==</span><span class="normal"> </span><span class="number">2</span><span class="symbol">);</span>
<span class="normal">                </span><span class="symbol">++</span><span class="normal">C</span><span class="symbol">;</span>
<span class="normal">                </span><span class="keyword">if</span><span class="normal"> </span><span class="symbol">(!</span><span class="normal">C</span><span class="symbol">.</span><span class="function">empty</span><span class="symbol">())</span>
<span class="normal">                    s2 </span><span class="symbol">=</span><span class="normal"> </span><span class="symbol">*</span><span class="normal">C</span><span class="symbol">;</span>
<span class="normal">                </span><span class="keyword">else</span>
<span class="normal">                    done</span><span class="symbol">[</span><span class="number">2</span><span class="symbol">]</span><span class="normal"> </span><span class="symbol">=</span><span class="normal"> </span><span class="keyword">true</span><span class="symbol">;</span>
<span class="normal">            </span><span class="cbracket">}</span>

<span class="normal">            </span><span class="symbol">++</span><span class="normal">index</span><span class="symbol">;</span>
<span class="normal">            </span><span class="keyword">if</span><span class="normal"> </span><span class="symbol">(!</span><span class="function">empty</span><span class="symbol">())</span>
<span class="normal">                </span><span class="function">merge</span><span class="symbol">();</span>

<span class="normal">            </span><span class="keyword">return</span><span class="normal"> </span><span class="symbol">*</span><span class="keyword">this</span><span class="symbol">;</span>
<span class="normal">        </span><span class="cbracket">}</span>
<span class="normal">    </span><span class="cbracket">}</span><span class="symbol">;</span>


<span class="normal">    </span><span class="comment">/** Helper function for computing the size of the 2/3 subproblem. */</span>
<span class="normal">    </span><span class="keyword">static</span><span class="normal"> </span><span class="keyword">inline</span><span class="normal"> </span><span class="usertype">size_t</span><span class="normal"> </span><span class="function">subp_size</span><span class="symbol">(</span><span class="usertype">size_t</span><span class="normal"> n</span><span class="symbol">)</span>
<span class="normal">    </span><span class="cbracket">{</span>
<span class="normal">        </span><span class="keyword">return</span><span class="normal"> </span><span class="symbol">(</span><span class="normal">n </span><span class="symbol">/</span><span class="normal"> </span><span class="number">3</span><span class="symbol">)</span><span class="normal"> </span><span class="symbol">*</span><span class="normal"> </span><span class="number">2</span><span class="normal"> </span><span class="symbol">+</span><span class="normal"> </span><span class="symbol">((</span><span class="normal">n </span><span class="symbol">%</span><span class="normal"> </span><span class="number">3</span><span class="symbol">)</span><span class="normal"> </span><span class="symbol">==</span><span class="normal"> </span><span class="number">2</span><span class="symbol">);</span>
<span class="normal">    </span><span class="cbracket">}</span>

<span class="normal">    </span><span class="comment">/**</span>
<span class="comment">     * Sort mod0-quints / mod1-quads / mod2-quints and run merge_sa class to</span>
<span class="comment">     * merge them together.</span>
<span class="comment">     * </span><span class="type">@param</span><span class="comment"> S input string pipe type.</span>
<span class="comment">     * </span><span class="type">@param</span><span class="comment"> Mod1 mod1 tuples input pipe type.</span>
<span class="comment">     * </span><span class="type">@param</span><span class="comment"> Mod2 mod2 tuples input pipe type.</span>
<span class="comment">     */</span>
<span class="normal">    </span><span class="keyword">template</span><span class="normal"> </span><span class="symbol">&lt;</span><span class="keyword">class</span><span class="normal"> </span><span class="classname">S</span><span class="symbol">,</span><span class="normal"> </span><span class="keyword">class</span><span class="normal"> </span><span class="classname">Mod1</span><span class="symbol">,</span><span class="normal"> </span><span class="keyword">class</span><span class="normal"> </span><span class="classname">Mod2</span><span class="symbol">&gt;</span>
<span class="normal">    </span><span class="keyword">class</span><span class="normal"> </span><span class="classname">build_sa</span>
<span class="normal">    </span><span class="cbracket">{</span>
<span class="normal">    </span><span class="keyword">public</span><span class="symbol">:</span>
<span class="normal">        </span><span class="keyword">typedef</span><span class="normal"> </span><span class="usertype">offset_type</span><span class="normal"> value_type</span><span class="symbol">;</span>

<span class="normal">        </span><span class="keyword">static</span><span class="normal"> </span><span class="keyword">const</span><span class="normal"> </span><span class="type">unsigned</span><span class="normal"> </span><span class="type">int</span><span class="normal"> add_rank </span><span class="symbol">=</span><span class="normal"> </span><span class="number">1</span><span class="symbol">;</span><span class="normal">  </span><span class="comment">// free first rank to mark ranks beyond end of input</span>

<span class="normal">    </span><span class="keyword">private</span><span class="symbol">:</span>
<span class="normal">        </span><span class="comment">// mod1 types</span>
<span class="normal">        </span><span class="keyword">typedef</span><span class="normal"> </span><span class="keyword">typename</span><span class="normal"> </span><span class="classname">stream</span><span class="symbol">::</span><span class="usertype">use_push&lt;skew_quad_type&gt;</span><span class="normal"> mod1_push_type</span><span class="symbol">;</span>
<span class="normal">        </span><span class="keyword">typedef</span><span class="normal"> </span><span class="keyword">typename</span><span class="normal"> </span><span class="classname">stream</span><span class="symbol">::</span><span class="usertype">runs_creator&lt;mod1_push_type, less_mod1&gt;</span><span class="normal"> mod1_runs_type</span><span class="symbol">;</span>
<span class="normal">        </span><span class="keyword">typedef</span><span class="normal"> </span><span class="keyword">typename</span><span class="normal"> </span><span class="classname">mod1_runs_type</span><span class="symbol">::</span><span class="usertype">sorted_runs_type</span><span class="normal"> sorted_mod1_runs_type</span><span class="symbol">;</span>
<span class="normal">        </span><span class="keyword">typedef</span><span class="normal"> </span><span class="keyword">typename</span><span class="normal"> </span><span class="classname">stream</span><span class="symbol">::</span><span class="usertype">runs_merger&lt;sorted_mod1_runs_type, less_mod1&gt;</span><span class="normal"> mod1_rm_type</span><span class="symbol">;</span>

<span class="normal">        </span><span class="comment">// mod2 types</span>
<span class="normal">        </span><span class="keyword">typedef</span><span class="normal"> </span><span class="keyword">typename</span><span class="normal"> </span><span class="classname">stream</span><span class="symbol">::</span><span class="usertype">use_push&lt;skew_quint_type&gt;</span><span class="normal"> mod2_push_type</span><span class="symbol">;</span>
<span class="normal">        </span><span class="keyword">typedef</span><span class="normal"> </span><span class="keyword">typename</span><span class="normal"> </span><span class="classname">stream</span><span class="symbol">::</span><span class="usertype">runs_creator&lt;mod2_push_type, less_mod2&gt;</span><span class="normal"> mod2_runs_type</span><span class="symbol">;</span>
<span class="normal">        </span><span class="keyword">typedef</span><span class="normal"> </span><span class="keyword">typename</span><span class="normal"> </span><span class="classname">mod2_runs_type</span><span class="symbol">::</span><span class="usertype">sorted_runs_type</span><span class="normal"> sorted_mod2_runs_type</span><span class="symbol">;</span>
<span class="normal">        </span><span class="keyword">typedef</span><span class="normal"> </span><span class="keyword">typename</span><span class="normal"> </span><span class="classname">stream</span><span class="symbol">::</span><span class="usertype">runs_merger&lt;sorted_mod2_runs_type, less_mod2&gt;</span><span class="normal"> mod2_rm_type</span><span class="symbol">;</span>

<span class="normal">        </span><span class="comment">// mod0 types</span>
<span class="normal">        </span><span class="keyword">typedef</span><span class="normal"> </span><span class="keyword">typename</span><span class="normal"> </span><span class="classname">stream</span><span class="symbol">::</span><span class="usertype">use_push&lt;skew_quint_type&gt;</span><span class="normal"> mod0_push_type</span><span class="symbol">;</span>
<span class="normal">        </span><span class="keyword">typedef</span><span class="normal"> </span><span class="keyword">typename</span><span class="normal"> </span><span class="classname">stream</span><span class="symbol">::</span><span class="usertype">runs_creator&lt;mod0_push_type, less_mod0&gt;</span><span class="normal"> mod0_runs_type</span><span class="symbol">;</span>
<span class="normal">        </span><span class="keyword">typedef</span><span class="normal"> </span><span class="keyword">typename</span><span class="normal"> </span><span class="classname">mod0_runs_type</span><span class="symbol">::</span><span class="usertype">sorted_runs_type</span><span class="normal"> sorted_mod0_runs_type</span><span class="symbol">;</span>
<span class="normal">        </span><span class="keyword">typedef</span><span class="normal"> </span><span class="keyword">typename</span><span class="normal"> </span><span class="classname">stream</span><span class="symbol">::</span><span class="usertype">runs_merger&lt;sorted_mod0_runs_type, less_mod0&gt;</span><span class="normal"> mod0_rm_type</span><span class="symbol">;</span>

<span class="normal">        </span><span class="comment">// Merge type</span>
<span class="normal">        </span><span class="keyword">typedef</span><span class="normal"> </span><span class="usertype">merge_sa&lt;mod0_rm_type, mod1_rm_type, mod2_rm_type&gt;</span><span class="normal"> merge_sa_type</span><span class="symbol">;</span>

<span class="normal">        </span><span class="comment">// Functions</span>
<span class="normal">        </span><span class="usertype">less_mod0</span><span class="normal"> c0</span><span class="symbol">;</span>
<span class="normal">        </span><span class="usertype">less_mod1</span><span class="normal"> c1</span><span class="symbol">;</span>
<span class="normal">        </span><span class="usertype">less_mod2</span><span class="normal"> c2</span><span class="symbol">;</span>

<span class="normal">        </span><span class="comment">// Runs merger</span>
<span class="normal">        mod1_rm_type</span><span class="symbol">*</span><span class="normal"> mod1_result</span><span class="symbol">;</span>
<span class="normal">        mod2_rm_type</span><span class="symbol">*</span><span class="normal"> mod2_result</span><span class="symbol">;</span>
<span class="normal">        mod0_rm_type</span><span class="symbol">*</span><span class="normal"> mod0_result</span><span class="symbol">;</span>

<span class="normal">        </span><span class="comment">// Merger</span>
<span class="normal">        merge_sa_type</span><span class="symbol">*</span><span class="normal"> vmerge_sa</span><span class="symbol">;</span>

<span class="normal">        </span><span class="comment">// Input</span>
<span class="normal">        S</span><span class="symbol">&amp;</span><span class="normal"> source</span><span class="symbol">;</span>
<span class="normal">        Mod1</span><span class="symbol">&amp;</span><span class="normal"> mod_1</span><span class="symbol">;</span>
<span class="normal">        Mod2</span><span class="symbol">&amp;</span><span class="normal"> mod_2</span><span class="symbol">;</span>

<span class="normal">        </span><span class="comment">// Tmp variables</span>
<span class="normal">        </span><span class="usertype">offset_type</span><span class="normal"> t</span><span class="symbol">[</span><span class="number">3</span><span class="symbol">];</span>
<span class="normal">        </span><span class="usertype">offset_type</span><span class="normal"> old_t2</span><span class="symbol">;</span>
<span class="normal">        </span><span class="usertype">offset_type</span><span class="normal"> old_mod2</span><span class="symbol">;</span>
<span class="normal">        </span><span class="type">bool</span><span class="normal"> exists</span><span class="symbol">[</span><span class="number">3</span><span class="symbol">];</span>
<span class="normal">        </span><span class="usertype">offset_type</span><span class="normal"> mod_one</span><span class="symbol">;</span>
<span class="normal">        </span><span class="usertype">offset_type</span><span class="normal"> mod_two</span><span class="symbol">;</span>

<span class="normal">        </span><span class="usertype">offset_type</span><span class="normal"> index</span><span class="symbol">;</span>

<span class="normal">        </span><span class="comment">// Empty_flag</span>
<span class="normal">        </span><span class="type">bool</span><span class="normal"> ready</span><span class="symbol">;</span>

<span class="normal">        </span><span class="comment">// Result</span>
<span class="normal">        </span><span class="usertype">value_type</span><span class="normal"> result</span><span class="symbol">;</span>

<span class="normal">    </span><span class="keyword">public</span><span class="symbol">:</span>
<span class="normal">        </span><span class="function">build_sa</span><span class="symbol">(</span><span class="normal">S</span><span class="symbol">&amp;</span><span class="normal"> source_</span><span class="symbol">,</span><span class="normal"> Mod1</span><span class="symbol">&amp;</span><span class="normal"> mod_1_</span><span class="symbol">,</span><span class="normal"> Mod2</span><span class="symbol">&amp;</span><span class="normal"> mod_2_</span><span class="symbol">,</span><span class="normal"> </span><span class="usertype">size_t</span><span class="normal"> a_size</span><span class="symbol">,</span><span class="normal"> </span><span class="usertype">size_t</span><span class="normal"> memsize</span><span class="symbol">)</span>
<span class="normal">            </span><span class="symbol">:</span><span class="normal"> </span><span class="function">source</span><span class="symbol">(</span><span class="normal">source_</span><span class="symbol">),</span><span class="normal"> </span><span class="function">mod_1</span><span class="symbol">(</span><span class="normal">mod_1_</span><span class="symbol">),</span><span class="normal"> </span><span class="function">mod_2</span><span class="symbol">(</span><span class="normal">mod_2_</span><span class="symbol">),</span><span class="normal"> </span><span class="function">index</span><span class="symbol">(</span><span class="number">0</span><span class="symbol">),</span><span class="normal"> </span><span class="function">ready</span><span class="symbol">(</span><span class="keyword">false</span><span class="symbol">)</span>
<span class="normal">        </span><span class="cbracket">{</span>
<span class="normal">            </span><span class="function">assert</span><span class="symbol">(!</span><span class="normal">source_</span><span class="symbol">.</span><span class="function">empty</span><span class="symbol">());</span>

<span class="normal">            </span><span class="comment">// Runs storage</span>

<span class="normal">            </span><span class="comment">// input: ISA_1,2 from previous level</span>
<span class="normal">            </span><span class="usertype">mod0_runs_type</span><span class="normal"> </span><span class="function">mod0_runs</span><span class="symbol">(</span><span class="normal">c0</span><span class="symbol">,</span><span class="normal"> memsize </span><span class="symbol">/</span><span class="normal"> </span><span class="number">4</span><span class="symbol">);</span>
<span class="normal">            </span><span class="usertype">mod1_runs_type</span><span class="normal"> </span><span class="function">mod1_runs</span><span class="symbol">(</span><span class="normal">c1</span><span class="symbol">,</span><span class="normal"> memsize </span><span class="symbol">/</span><span class="normal"> </span><span class="number">4</span><span class="symbol">);</span>
<span class="normal">            </span><span class="usertype">mod2_runs_type</span><span class="normal"> </span><span class="function">mod2_runs</span><span class="symbol">(</span><span class="normal">c2</span><span class="symbol">,</span><span class="normal"> memsize </span><span class="symbol">/</span><span class="normal"> </span><span class="number">4</span><span class="symbol">);</span>

<span class="normal">            </span><span class="keyword">while</span><span class="normal"> </span><span class="symbol">(!</span><span class="normal">source</span><span class="symbol">.</span><span class="function">empty</span><span class="symbol">())</span>
<span class="normal">            </span><span class="cbracket">{</span>
<span class="normal">                exists</span><span class="symbol">[</span><span class="number">0</span><span class="symbol">]</span><span class="normal"> </span><span class="symbol">=</span><span class="normal"> </span><span class="keyword">false</span><span class="symbol">;</span>
<span class="normal">                exists</span><span class="symbol">[</span><span class="number">1</span><span class="symbol">]</span><span class="normal"> </span><span class="symbol">=</span><span class="normal"> </span><span class="keyword">false</span><span class="symbol">;</span>
<span class="normal">                exists</span><span class="symbol">[</span><span class="number">2</span><span class="symbol">]</span><span class="normal"> </span><span class="symbol">=</span><span class="normal"> </span><span class="keyword">false</span><span class="symbol">;</span>

<span class="normal">                </span><span class="keyword">if</span><span class="normal"> </span><span class="symbol">(!</span><span class="normal">source</span><span class="symbol">.</span><span class="function">empty</span><span class="symbol">())</span><span class="normal"> </span><span class="cbracket">{</span>
<span class="normal">                    t</span><span class="symbol">[</span><span class="number">0</span><span class="symbol">]</span><span class="normal"> </span><span class="symbol">=</span><span class="normal"> </span><span class="symbol">*</span><span class="normal">source</span><span class="symbol">;</span>
<span class="normal">                    </span><span class="symbol">++</span><span class="normal">source</span><span class="symbol">;</span>
<span class="normal">                    exists</span><span class="symbol">[</span><span class="number">0</span><span class="symbol">]</span><span class="normal"> </span><span class="symbol">=</span><span class="normal"> </span><span class="keyword">true</span><span class="symbol">;</span>
<span class="normal">                </span><span class="cbracket">}</span>

<span class="normal">                </span><span class="keyword">if</span><span class="normal"> </span><span class="symbol">(!</span><span class="normal">source</span><span class="symbol">.</span><span class="function">empty</span><span class="symbol">())</span><span class="normal"> </span><span class="cbracket">{</span>
<span class="normal">                    </span><span class="function">assert</span><span class="symbol">(!</span><span class="normal">mod_1</span><span class="symbol">.</span><span class="function">empty</span><span class="symbol">());</span>
<span class="normal">                    t</span><span class="symbol">[</span><span class="number">1</span><span class="symbol">]</span><span class="normal"> </span><span class="symbol">=</span><span class="normal"> </span><span class="symbol">*</span><span class="normal">source</span><span class="symbol">;</span>
<span class="normal">                    </span><span class="symbol">++</span><span class="normal">source</span><span class="symbol">;</span>
<span class="normal">                    mod_one </span><span class="symbol">=</span><span class="normal"> </span><span class="symbol">*</span><span class="normal">mod_1 </span><span class="symbol">+</span><span class="normal"> add_rank</span><span class="symbol">;</span>
<span class="normal">                    </span><span class="symbol">++</span><span class="normal">mod_1</span><span class="symbol">;</span>
<span class="normal">                    exists</span><span class="symbol">[</span><span class="number">1</span><span class="symbol">]</span><span class="normal"> </span><span class="symbol">=</span><span class="normal"> </span><span class="keyword">true</span><span class="symbol">;</span>
<span class="normal">                </span><span class="cbracket">}</span>

<span class="normal">                </span><span class="keyword">if</span><span class="normal"> </span><span class="symbol">(!</span><span class="normal">source</span><span class="symbol">.</span><span class="function">empty</span><span class="symbol">())</span><span class="normal"> </span><span class="cbracket">{</span>
<span class="normal">                    </span><span class="function">assert</span><span class="symbol">(!</span><span class="normal">mod_2</span><span class="symbol">.</span><span class="function">empty</span><span class="symbol">());</span>
<span class="normal">                    t</span><span class="symbol">[</span><span class="number">2</span><span class="symbol">]</span><span class="normal"> </span><span class="symbol">=</span><span class="normal"> </span><span class="symbol">*</span><span class="normal">source</span><span class="symbol">;</span>
<span class="normal">                    </span><span class="symbol">++</span><span class="normal">source</span><span class="symbol">;</span>
<span class="normal">                    mod_two </span><span class="symbol">=</span><span class="normal"> </span><span class="symbol">*</span><span class="normal">mod_2 </span><span class="symbol">+</span><span class="normal"> add_rank</span><span class="symbol">;</span>
<span class="normal">                    </span><span class="symbol">++</span><span class="normal">mod_2</span><span class="symbol">;</span>
<span class="normal">                    exists</span><span class="symbol">[</span><span class="number">2</span><span class="symbol">]</span><span class="normal"> </span><span class="symbol">=</span><span class="normal"> </span><span class="keyword">true</span><span class="symbol">;</span>
<span class="normal">                </span><span class="cbracket">}</span>

<span class="normal">                </span><span class="comment">// Check special cases in the middle of "source"</span>
<span class="normal">                </span><span class="comment">// Cases are cx|xc cxx|cxx and cxxc|xxc</span>

<span class="normal">                </span><span class="function">assert</span><span class="symbol">(</span><span class="normal">t</span><span class="symbol">[</span><span class="number">0</span><span class="symbol">]</span><span class="normal"> </span><span class="symbol">!=</span><span class="normal"> </span><span class="function">offset_type</span><span class="symbol">(</span><span class="number">0</span><span class="symbol">));</span>
<span class="normal">                </span><span class="function">assert</span><span class="symbol">(</span><span class="normal">t</span><span class="symbol">[</span><span class="number">1</span><span class="symbol">]</span><span class="normal"> </span><span class="symbol">!=</span><span class="normal"> </span><span class="function">offset_type</span><span class="symbol">(</span><span class="number">0</span><span class="symbol">));</span>
<span class="normal">                </span><span class="function">assert</span><span class="symbol">(</span><span class="normal">t</span><span class="symbol">[</span><span class="number">2</span><span class="symbol">]</span><span class="normal"> </span><span class="symbol">!=</span><span class="normal"> </span><span class="function">offset_type</span><span class="symbol">(</span><span class="number">0</span><span class="symbol">));</span>

<span class="normal">                </span><span class="comment">// Mod 0 : (index0,char0,char1,mod1,mod2)</span>
<span class="normal">                </span><span class="comment">// Mod 1 : (index1,mod1,char1,mod2)</span>
<span class="normal">                </span><span class="comment">// Mod 2 : (index2,mod2)</span>

<span class="normal">                </span><span class="keyword">if</span><span class="normal"> </span><span class="symbol">(</span><span class="normal">exists</span><span class="symbol">[</span><span class="number">2</span><span class="symbol">])</span><span class="normal"> </span><span class="cbracket">{</span><span class="normal"> </span><span class="comment">// Nothing is missed</span>
<span class="normal">                    mod0_runs</span><span class="symbol">.</span><span class="function">push</span><span class="symbol">(</span><span class="function">skew_quint_type</span><span class="symbol">(</span><span class="normal">index</span><span class="symbol">,</span><span class="normal"> t</span><span class="symbol">[</span><span class="number">0</span><span class="symbol">],</span><span class="normal"> t</span><span class="symbol">[</span><span class="number">1</span><span class="symbol">],</span><span class="normal"> mod_one</span><span class="symbol">,</span><span class="normal"> mod_two</span><span class="symbol">));</span>
<span class="normal">                    mod1_runs</span><span class="symbol">.</span><span class="function">push</span><span class="symbol">(</span><span class="function">skew_quad_type</span><span class="symbol">(</span><span class="normal">index </span><span class="symbol">+</span><span class="normal"> </span><span class="number">1</span><span class="symbol">,</span><span class="normal"> mod_one</span><span class="symbol">,</span><span class="normal"> t</span><span class="symbol">[</span><span class="number">1</span><span class="symbol">],</span><span class="normal"> mod_two</span><span class="symbol">));</span>

<span class="normal">                    </span><span class="keyword">if</span><span class="normal"> </span><span class="symbol">(</span><span class="normal">index </span><span class="symbol">!=</span><span class="normal"> </span><span class="function">offset_type</span><span class="symbol">(</span><span class="number">0</span><span class="symbol">))</span><span class="normal"> </span><span class="cbracket">{</span>
<span class="normal">                        mod2_runs</span><span class="symbol">.</span><span class="function">push</span><span class="symbol">(</span><span class="function">skew_quint_type</span><span class="symbol">((</span><span class="normal">index </span><span class="symbol">-</span><span class="normal"> </span><span class="number">1</span><span class="symbol">),</span><span class="normal"> old_mod2</span><span class="symbol">,</span><span class="normal"> old_t2</span><span class="symbol">,</span><span class="normal"> t</span><span class="symbol">[</span><span class="number">0</span><span class="symbol">],</span><span class="normal"> mod_one</span><span class="symbol">));</span>
<span class="normal">                    </span><span class="cbracket">}</span>
<span class="normal">                </span><span class="cbracket">}</span>
<span class="normal">                </span><span class="keyword">else</span><span class="normal"> </span><span class="keyword">if</span><span class="normal"> </span><span class="symbol">(</span><span class="normal">exists</span><span class="symbol">[</span><span class="number">1</span><span class="symbol">])</span><span class="normal"> </span><span class="cbracket">{</span><span class="normal"> </span><span class="comment">// Last element missed</span>
<span class="normal">                    mod0_runs</span><span class="symbol">.</span><span class="function">push</span><span class="symbol">(</span><span class="function">skew_quint_type</span><span class="symbol">(</span><span class="normal">index</span><span class="symbol">,</span><span class="normal"> t</span><span class="symbol">[</span><span class="number">0</span><span class="symbol">],</span><span class="normal"> t</span><span class="symbol">[</span><span class="number">1</span><span class="symbol">],</span><span class="normal"> mod_one</span><span class="symbol">,</span><span class="normal"> </span><span class="number">0</span><span class="symbol">));</span>
<span class="normal">                    mod1_runs</span><span class="symbol">.</span><span class="function">push</span><span class="symbol">(</span><span class="function">skew_quad_type</span><span class="symbol">(</span><span class="normal">index </span><span class="symbol">+</span><span class="normal"> </span><span class="number">1</span><span class="symbol">,</span><span class="normal"> mod_one</span><span class="symbol">,</span><span class="normal"> t</span><span class="symbol">[</span><span class="number">1</span><span class="symbol">],</span><span class="normal"> </span><span class="number">0</span><span class="symbol">));</span>

<span class="normal">                    </span><span class="keyword">if</span><span class="normal"> </span><span class="symbol">(</span><span class="normal">index </span><span class="symbol">!=</span><span class="normal"> </span><span class="function">offset_type</span><span class="symbol">(</span><span class="number">0</span><span class="symbol">))</span><span class="normal"> </span><span class="cbracket">{</span>
<span class="normal">                        mod2_runs</span><span class="symbol">.</span><span class="function">push</span><span class="symbol">(</span><span class="function">skew_quint_type</span><span class="symbol">((</span><span class="normal">index </span><span class="symbol">-</span><span class="normal"> </span><span class="number">1</span><span class="symbol">),</span><span class="normal"> old_mod2</span><span class="symbol">,</span><span class="normal"> old_t2</span><span class="symbol">,</span><span class="normal"> t</span><span class="symbol">[</span><span class="number">0</span><span class="symbol">],</span><span class="normal"> mod_one</span><span class="symbol">));</span>
<span class="normal">                    </span><span class="cbracket">}</span>
<span class="normal">                </span><span class="cbracket">}</span>
<span class="normal">                </span><span class="keyword">else</span><span class="normal"> </span><span class="cbracket">{</span><span class="normal"> </span><span class="comment">// Only one element left</span>
<span class="normal">                    </span><span class="function">assert</span><span class="symbol">(</span><span class="normal">exists</span><span class="symbol">[</span><span class="number">0</span><span class="symbol">]);</span>
<span class="normal">                    mod0_runs</span><span class="symbol">.</span><span class="function">push</span><span class="symbol">(</span><span class="function">skew_quint_type</span><span class="symbol">(</span><span class="normal">index</span><span class="symbol">,</span><span class="normal"> t</span><span class="symbol">[</span><span class="number">0</span><span class="symbol">],</span><span class="normal"> </span><span class="number">0</span><span class="symbol">,</span><span class="normal"> </span><span class="number">0</span><span class="symbol">,</span><span class="normal"> </span><span class="number">0</span><span class="symbol">));</span>

<span class="normal">                    </span><span class="keyword">if</span><span class="normal"> </span><span class="symbol">(</span><span class="normal">index </span><span class="symbol">!=</span><span class="normal"> </span><span class="function">offset_type</span><span class="symbol">(</span><span class="number">0</span><span class="symbol">))</span><span class="normal"> </span><span class="cbracket">{</span>
<span class="normal">                        mod2_runs</span><span class="symbol">.</span><span class="function">push</span><span class="symbol">(</span><span class="function">skew_quint_type</span><span class="symbol">((</span><span class="normal">index </span><span class="symbol">-</span><span class="normal"> </span><span class="number">1</span><span class="symbol">),</span><span class="normal"> old_mod2</span><span class="symbol">,</span><span class="normal"> old_t2</span><span class="symbol">,</span><span class="normal"> t</span><span class="symbol">[</span><span class="number">0</span><span class="symbol">],</span><span class="normal"> </span><span class="number">0</span><span class="symbol">));</span>
<span class="normal">                    </span><span class="cbracket">}</span>
<span class="normal">                </span><span class="cbracket">}</span>

<span class="normal">                old_mod2 </span><span class="symbol">=</span><span class="normal"> mod_two</span><span class="symbol">;</span>
<span class="normal">                old_t2 </span><span class="symbol">=</span><span class="normal"> t</span><span class="symbol">[</span><span class="number">2</span><span class="symbol">];</span>
<span class="normal">                index </span><span class="symbol">+=</span><span class="normal"> </span><span class="number">3</span><span class="symbol">;</span>
<span class="normal">            </span><span class="cbracket">}</span>

<span class="normal">            </span><span class="keyword">if</span><span class="normal"> </span><span class="symbol">((</span><span class="normal">a_size </span><span class="symbol">%</span><span class="normal"> </span><span class="number">3</span><span class="symbol">)</span><span class="normal"> </span><span class="symbol">==</span><span class="normal"> </span><span class="number">0</span><span class="symbol">)</span><span class="normal"> </span><span class="cbracket">{</span><span class="normal"> </span><span class="comment">// changed</span>
<span class="normal">                </span><span class="keyword">if</span><span class="normal"> </span><span class="symbol">(</span><span class="normal">index </span><span class="symbol">!=</span><span class="normal"> </span><span class="function">offset_type</span><span class="symbol">(</span><span class="number">0</span><span class="symbol">))</span><span class="normal"> </span><span class="cbracket">{</span>
<span class="normal">                    mod2_runs</span><span class="symbol">.</span><span class="function">push</span><span class="symbol">(</span><span class="function">skew_quint_type</span><span class="symbol">((</span><span class="normal">index </span><span class="symbol">-</span><span class="normal"> </span><span class="number">1</span><span class="symbol">),</span><span class="normal"> old_mod2</span><span class="symbol">,</span><span class="normal"> old_t2</span><span class="symbol">,</span><span class="normal"> </span><span class="number">0</span><span class="symbol">,</span><span class="normal"> </span><span class="number">0</span><span class="symbol">));</span>
<span class="normal">                </span><span class="cbracket">}</span>
<span class="normal">            </span><span class="cbracket">}</span>

<span class="normal">            mod0_runs</span><span class="symbol">.</span><span class="function">deallocate</span><span class="symbol">();</span>
<span class="normal">            mod1_runs</span><span class="symbol">.</span><span class="function">deallocate</span><span class="symbol">();</span>
<span class="normal">            mod2_runs</span><span class="symbol">.</span><span class="function">deallocate</span><span class="symbol">();</span>

<span class="normal">            std</span><span class="symbol">::</span><span class="normal">cout </span><span class="symbol">&lt;&lt;</span><span class="normal"> </span><span class="string">"merging S0 = "</span><span class="normal"> </span><span class="symbol">&lt;&lt;</span><span class="normal"> mod0_runs</span><span class="symbol">.</span><span class="function">size</span><span class="symbol">()</span><span class="normal"> </span><span class="symbol">&lt;&lt;</span><span class="normal"> </span><span class="string">", S1 = "</span><span class="normal"> </span><span class="symbol">&lt;&lt;</span><span class="normal"> mod1_runs</span><span class="symbol">.</span><span class="function">size</span><span class="symbol">()</span>
<span class="normal">                      </span><span class="symbol">&lt;&lt;</span><span class="normal"> </span><span class="string">", S2 = "</span><span class="normal"> </span><span class="symbol">&lt;&lt;</span><span class="normal"> mod2_runs</span><span class="symbol">.</span><span class="function">size</span><span class="symbol">()</span><span class="normal"> </span><span class="symbol">&lt;&lt;</span><span class="normal"> </span><span class="string">" tuples"</span><span class="normal"> </span><span class="symbol">&lt;&lt;</span><span class="normal"> std</span><span class="symbol">::</span><span class="normal">endl</span><span class="symbol">;</span>

<span class="normal">            </span><span class="comment">// Prepare for merging</span>

<span class="normal">            mod0_result </span><span class="symbol">=</span><span class="normal"> </span><span class="keyword">new</span><span class="normal"> </span><span class="function">mod0_rm_type</span><span class="symbol">(</span><span class="normal">mod0_runs</span><span class="symbol">.</span><span class="function">result</span><span class="symbol">(),</span><span class="normal"> </span><span class="function">less_mod0</span><span class="symbol">(),</span><span class="normal"> memsize </span><span class="symbol">/</span><span class="normal"> </span><span class="number">5</span><span class="symbol">);</span>
<span class="normal">            mod1_result </span><span class="symbol">=</span><span class="normal"> </span><span class="keyword">new</span><span class="normal"> </span><span class="function">mod1_rm_type</span><span class="symbol">(</span><span class="normal">mod1_runs</span><span class="symbol">.</span><span class="function">result</span><span class="symbol">(),</span><span class="normal"> </span><span class="function">less_mod1</span><span class="symbol">(),</span><span class="normal"> memsize </span><span class="symbol">/</span><span class="normal"> </span><span class="number">5</span><span class="symbol">);</span>
<span class="normal">            mod2_result </span><span class="symbol">=</span><span class="normal"> </span><span class="keyword">new</span><span class="normal"> </span><span class="function">mod2_rm_type</span><span class="symbol">(</span><span class="normal">mod2_runs</span><span class="symbol">.</span><span class="function">result</span><span class="symbol">(),</span><span class="normal"> </span><span class="function">less_mod2</span><span class="symbol">(),</span><span class="normal"> memsize </span><span class="symbol">/</span><span class="normal"> </span><span class="number">5</span><span class="symbol">);</span>

<span class="normal">            </span><span class="comment">// output: ISA_1,2 for next level</span>
<span class="normal">            vmerge_sa </span><span class="symbol">=</span><span class="normal"> </span><span class="keyword">new</span><span class="normal"> </span><span class="function">merge_sa_type</span><span class="symbol">(*</span><span class="normal">mod0_result</span><span class="symbol">,</span><span class="normal"> </span><span class="symbol">*</span><span class="normal">mod1_result</span><span class="symbol">,</span><span class="normal"> </span><span class="symbol">*</span><span class="normal">mod2_result</span><span class="symbol">);</span>

<span class="normal">            </span><span class="comment">// read first suffix</span>
<span class="normal">            result </span><span class="symbol">=</span><span class="normal"> </span><span class="symbol">*(*</span><span class="normal">vmerge_sa</span><span class="symbol">);</span>
<span class="normal">        </span><span class="cbracket">}</span>

<span class="normal">        </span><span class="keyword">const</span><span class="normal"> value_type</span><span class="symbol">&amp;</span><span class="normal"> </span><span class="keyword">operator</span><span class="normal"> </span><span class="symbol">*</span><span class="normal"> </span><span class="symbol">()</span><span class="normal"> </span><span class="keyword">const</span>
<span class="normal">        </span><span class="cbracket">{</span>
<span class="normal">            </span><span class="keyword">return</span><span class="normal"> result</span><span class="symbol">;</span>
<span class="normal">        </span><span class="cbracket">}</span>

<span class="normal">        build_sa</span><span class="symbol">&amp;</span><span class="normal"> </span><span class="keyword">operator</span><span class="normal"> </span><span class="symbol">++</span><span class="normal"> </span><span class="symbol">()</span>
<span class="normal">        </span><span class="cbracket">{</span>
<span class="normal">            </span><span class="function">assert</span><span class="symbol">(</span><span class="normal">vmerge_sa </span><span class="symbol">!=</span><span class="normal"> </span><span class="number">0</span><span class="normal"> </span><span class="symbol">&amp;&amp;</span><span class="normal"> </span><span class="symbol">!</span><span class="normal">vmerge_sa</span><span class="symbol">-&gt;</span><span class="function">empty</span><span class="symbol">());</span>

<span class="normal">            </span><span class="symbol">++(*</span><span class="normal">vmerge_sa</span><span class="symbol">);</span>
<span class="normal">            </span><span class="keyword">if</span><span class="normal"> </span><span class="symbol">(!</span><span class="normal">vmerge_sa</span><span class="symbol">-&gt;</span><span class="function">empty</span><span class="symbol">())</span><span class="normal"> </span><span class="cbracket">{</span>
<span class="normal">                result </span><span class="symbol">=</span><span class="normal"> </span><span class="symbol">*(*</span><span class="normal">vmerge_sa</span><span class="symbol">);</span>
<span class="normal">            </span><span class="cbracket">}</span>
<span class="normal">            </span><span class="keyword">else</span><span class="normal"> </span><span class="cbracket">{</span><span class="normal">  </span><span class="comment">// cleaning up</span>
<span class="normal">                </span><span class="function">assert</span><span class="symbol">(</span><span class="normal">vmerge_sa</span><span class="symbol">-&gt;</span><span class="function">empty</span><span class="symbol">());</span>
<span class="normal">                ready </span><span class="symbol">=</span><span class="normal"> </span><span class="keyword">true</span><span class="symbol">;</span>

<span class="normal">                </span><span class="function">assert</span><span class="symbol">(</span><span class="normal">vmerge_sa </span><span class="symbol">!=</span><span class="normal"> NULL</span><span class="symbol">);</span>
<span class="normal">                </span><span class="keyword">delete</span><span class="normal"> vmerge_sa</span><span class="symbol">,</span><span class="normal"> vmerge_sa </span><span class="symbol">=</span><span class="normal"> NULL</span><span class="symbol">;</span>

<span class="normal">                </span><span class="function">assert</span><span class="symbol">(</span><span class="normal">mod0_result </span><span class="symbol">!=</span><span class="normal"> NULL </span><span class="symbol">&amp;&amp;</span><span class="normal"> mod1_result </span><span class="symbol">!=</span><span class="normal"> NULL </span><span class="symbol">&amp;&amp;</span><span class="normal"> mod2_result </span><span class="symbol">!=</span><span class="normal"> NULL</span><span class="symbol">);</span>
<span class="normal">                </span><span class="keyword">delete</span><span class="normal"> mod0_result</span><span class="symbol">,</span><span class="normal"> mod0_result </span><span class="symbol">=</span><span class="normal"> NULL</span><span class="symbol">;</span>
<span class="normal">                </span><span class="keyword">delete</span><span class="normal"> mod1_result</span><span class="symbol">,</span><span class="normal"> mod1_result </span><span class="symbol">=</span><span class="normal"> NULL</span><span class="symbol">;</span>
<span class="normal">                </span><span class="keyword">delete</span><span class="normal"> mod2_result</span><span class="symbol">,</span><span class="normal"> mod2_result </span><span class="symbol">=</span><span class="normal"> NULL</span><span class="symbol">;</span>
<span class="normal">            </span><span class="cbracket">}</span>

<span class="normal">            </span><span class="keyword">return</span><span class="normal"> </span><span class="symbol">*</span><span class="keyword">this</span><span class="symbol">;</span>
<span class="normal">        </span><span class="cbracket">}</span>

<span class="normal">        </span><span class="symbol">~</span><span class="function">build_sa</span><span class="symbol">()</span>
<span class="normal">        </span><span class="cbracket">{</span>
<span class="normal">            </span><span class="keyword">if</span><span class="normal"> </span><span class="symbol">(</span><span class="normal">vmerge_sa</span><span class="symbol">)</span><span class="normal"> </span><span class="keyword">delete</span><span class="normal"> vmerge_sa</span><span class="symbol">;</span>

<span class="normal">            </span><span class="keyword">if</span><span class="normal"> </span><span class="symbol">(</span><span class="normal">mod0_result</span><span class="symbol">)</span><span class="normal"> </span><span class="keyword">delete</span><span class="normal"> mod0_result</span><span class="symbol">;</span>
<span class="normal">            </span><span class="keyword">if</span><span class="normal"> </span><span class="symbol">(</span><span class="normal">mod1_result</span><span class="symbol">)</span><span class="normal"> </span><span class="keyword">delete</span><span class="normal"> mod1_result</span><span class="symbol">;</span>
<span class="normal">            </span><span class="keyword">if</span><span class="normal"> </span><span class="symbol">(</span><span class="normal">mod2_result</span><span class="symbol">)</span><span class="normal"> </span><span class="keyword">delete</span><span class="normal"> mod2_result</span><span class="symbol">;</span>
<span class="normal">        </span><span class="cbracket">}</span>

<span class="normal">        </span><span class="type">bool</span><span class="normal"> </span><span class="function">empty</span><span class="symbol">()</span><span class="normal"> </span><span class="keyword">const</span>
<span class="normal">        </span><span class="cbracket">{</span>
<span class="normal">            </span><span class="keyword">return</span><span class="normal"> ready</span><span class="symbol">;</span>
<span class="normal">        </span><span class="cbracket">}</span>
<span class="normal">    </span><span class="cbracket">}</span><span class="symbol">;</span>

<span class="normal">    </span><span class="comment">/** The skew algorithm.</span>
<span class="comment">     *  </span><span class="type">@param</span><span class="comment"> Input type of the input pipe. */</span>
<span class="normal">    </span><span class="keyword">template</span><span class="normal"> </span><span class="symbol">&lt;</span><span class="keyword">class</span><span class="normal"> </span><span class="classname">Input</span><span class="symbol">&gt;</span>
<span class="normal">    </span><span class="keyword">class</span><span class="normal"> </span><span class="classname">algorithm</span>
<span class="normal">    </span><span class="cbracket">{</span>
<span class="normal">    </span><span class="keyword">public</span><span class="symbol">:</span>
<span class="normal">        </span><span class="keyword">typedef</span><span class="normal"> </span><span class="usertype">offset_type</span><span class="normal"> value_type</span><span class="symbol">;</span>
<span class="normal">        </span><span class="keyword">typedef</span><span class="normal"> </span><span class="keyword">typename</span><span class="normal"> </span><span class="classname">Input</span><span class="symbol">::</span><span class="usertype">value_type</span><span class="normal"> alphabet_type</span><span class="symbol">;</span>

<span class="normal">    </span><span class="keyword">protected</span><span class="symbol">:</span>
<span class="normal">        </span><span class="comment">// finished reading final suffix array</span>
<span class="normal">        </span><span class="type">bool</span><span class="normal"> finished</span><span class="symbol">;</span>

<span class="normal">        </span><span class="comment">// current recursion depth</span>
<span class="normal">        </span><span class="type">unsigned</span><span class="normal"> </span><span class="type">int</span><span class="normal"> rec_depth</span><span class="symbol">;</span>

<span class="normal">    </span><span class="keyword">protected</span><span class="symbol">:</span>
<span class="normal">        </span><span class="comment">// generate (i) sequence</span>
<span class="normal">        </span><span class="keyword">typedef</span><span class="normal"> stxxl</span><span class="symbol">::</span><span class="normal">stream</span><span class="symbol">::</span><span class="usertype">counter&lt;offset_type&gt;</span><span class="normal"> counter_stream_type</span><span class="symbol">;</span>

<span class="normal">        </span><span class="comment">// Sorter</span>
<span class="normal">        </span><span class="keyword">typedef</span><span class="normal"> stxxl</span><span class="symbol">::</span><span class="usertype">tuple_less1st&lt;skew_pair_type&gt;</span><span class="normal"> mod12cmp</span><span class="symbol">;</span>
<span class="normal">        </span><span class="keyword">typedef</span><span class="normal"> stxxl</span><span class="symbol">::</span><span class="usertype">sorter&lt;skew_pair_type, mod12cmp&gt;</span><span class="normal"> mod12_sorter_type</span><span class="symbol">;</span>

<span class="normal">        </span><span class="comment">// Additional streaming items</span>
<span class="normal">        </span><span class="keyword">typedef</span><span class="normal"> stream</span><span class="symbol">::</span><span class="usertype">choose&lt;mod12_sorter_type, 2&gt;</span><span class="normal"> isa_second_type</span><span class="symbol">;</span>
<span class="normal">        </span><span class="keyword">typedef</span><span class="normal"> </span><span class="usertype">build_sa&lt;offset_array_it_rg, isa_second_type, isa_second_type&gt;</span><span class="normal"> buildSA_type</span><span class="symbol">;</span>
<span class="normal">        </span><span class="keyword">typedef</span><span class="normal"> </span><span class="usertype">make_pairs&lt;buildSA_type, counter_stream_type&gt;</span><span class="normal"> precompute_isa_type</span><span class="symbol">;</span>

<span class="normal">        </span><span class="comment">// Real recursive skew3 implementation</span>
<span class="normal">        </span><span class="comment">// This part is the core of the skew algorithm and runs all class objects in their respective order</span>
<span class="normal">        </span><span class="keyword">template</span><span class="normal"> </span><span class="symbol">&lt;</span><span class="keyword">typename</span><span class="normal"> </span><span class="classname">RecInputType</span><span class="symbol">&gt;</span>
<span class="normal">        buildSA_type </span><span class="symbol">*</span><span class="normal"> </span><span class="function">skew3</span><span class="symbol">(</span><span class="normal">RecInputType</span><span class="symbol">&amp;</span><span class="normal"> p_Input</span><span class="symbol">)</span>
<span class="normal">        </span><span class="cbracket">{</span>
<span class="normal">            </span><span class="comment">// (t_i) -&gt; (i,t_i,t_{i+1},t_{i+2})</span>
<span class="normal">            </span><span class="keyword">typedef</span><span class="normal"> </span><span class="usertype">make_quads&lt;RecInputType, offset_type, 1&gt;</span><span class="normal"> make_quads_input_type</span><span class="symbol">;</span>

<span class="normal">            </span><span class="comment">// (t_i) -&gt; (i,t_i,t_{i+1},t_{i+2}) with i = 1,2 mod 3</span>
<span class="normal">            </span><span class="keyword">typedef</span><span class="normal"> </span><span class="usertype">extract_mod12&lt;make_quads_input_type&gt;</span><span class="normal"> mod12_quads_input_type</span><span class="symbol">;</span>

<span class="normal">            </span><span class="comment">// sort (i,t_i,t_{i+1},t_{i+2}) by (t_i,t_{i+1},t_{i+2})</span>
<span class="normal">            </span><span class="keyword">typedef</span><span class="normal"> </span><span class="keyword">typename</span><span class="normal"> </span><span class="classname">stream</span><span class="symbol">::</span><span class="usertype">sort&lt;mod12_quads_input_type, less_quad&lt;offset_type&gt; &gt;</span><span class="normal"> sort_mod12_input_type</span><span class="symbol">;</span>

<span class="normal">            </span><span class="comment">// name (i,t_i,t_{i+1},t_{i+2}) -&gt; (i,n_i)</span>
<span class="normal">            </span><span class="keyword">typedef</span><span class="normal"> </span><span class="usertype">naming&lt;sort_mod12_input_type&gt;</span><span class="normal"> naming_input_type</span><span class="symbol">;</span>

<span class="normal">            </span><span class="usertype">mod12_sorter_type</span><span class="normal"> </span><span class="function">m1_sorter</span><span class="symbol">(</span><span class="function">mod12cmp</span><span class="symbol">(),</span><span class="normal"> ram_use </span><span class="symbol">/</span><span class="normal"> </span><span class="number">5</span><span class="symbol">);</span>
<span class="normal">            </span><span class="usertype">mod12_sorter_type</span><span class="normal"> </span><span class="function">m2_sorter</span><span class="symbol">(</span><span class="function">mod12cmp</span><span class="symbol">(),</span><span class="normal"> ram_use </span><span class="symbol">/</span><span class="normal"> </span><span class="number">5</span><span class="symbol">);</span>

<span class="normal">            </span><span class="comment">// sorted mod1 runs -concatenate- sorted mod2 runs</span>
<span class="normal">            </span><span class="keyword">typedef</span><span class="normal"> stxxl</span><span class="symbol">::</span><span class="normal">stream</span><span class="symbol">::</span><span class="usertype">concatenate&lt;mod12_sorter_type, mod12_sorter_type&gt;</span><span class="normal"> concatenation_type</span><span class="symbol">;</span>

<span class="normal">            </span><span class="comment">// (t_i) -&gt; (i,t_i,t_{i+1},t_{i+2})</span>
<span class="normal">            </span><span class="usertype">offset_array_type</span><span class="normal"> text</span><span class="symbol">;</span>
<span class="normal">            </span><span class="usertype">make_quads_input_type</span><span class="normal"> </span><span class="function">quads_input</span><span class="symbol">(</span><span class="normal">p_Input</span><span class="symbol">,</span><span class="normal"> text</span><span class="symbol">);</span>

<span class="normal">            </span><span class="comment">// (t_i) -&gt; (i,t_i,t_{i+1},t_{i+2}) with i = 1,2 mod 3</span>
<span class="normal">            </span><span class="usertype">mod12_quads_input_type</span><span class="normal"> </span><span class="function">mod12_quads_input</span><span class="symbol">(</span><span class="normal">quads_input</span><span class="symbol">);</span>

<span class="normal">            </span><span class="comment">// sort (i,t_i,t_{i+1},t_{i+2}) by (t_i,t_i+1},t_{i+2})</span>
<span class="normal">            </span><span class="usertype">sort_mod12_input_type</span><span class="normal"> </span><span class="function">sort_mod12_input</span><span class="symbol">(</span><span class="normal">mod12_quads_input</span><span class="symbol">,</span><span class="normal"> less_quad</span><span class="symbol">&lt;</span><span class="normal">offset_type</span><span class="symbol">&gt;(),</span><span class="normal"> ram_use </span><span class="symbol">/</span><span class="normal"> </span><span class="number">5</span><span class="symbol">);</span>

<span class="normal">            </span><span class="comment">// name (i,t_i,t_{i+1},t_{i+2}) -&gt; (i,"n_i")</span>
<span class="normal">            </span><span class="type">bool</span><span class="normal"> unique </span><span class="symbol">=</span><span class="normal"> </span><span class="keyword">false</span><span class="symbol">;</span><span class="normal">         </span><span class="comment">// is the current quad array unique?</span>
<span class="normal">            </span><span class="usertype">naming_input_type</span><span class="normal"> </span><span class="function">names_input</span><span class="symbol">(</span><span class="normal">sort_mod12_input</span><span class="symbol">,</span><span class="normal"> unique</span><span class="symbol">);</span>

<span class="normal">            </span><span class="comment">// create (i, s^12[i])</span>
<span class="normal">            </span><span class="usertype">size_type</span><span class="normal"> concat_length </span><span class="symbol">=</span><span class="normal"> </span><span class="number">0</span><span class="symbol">;</span><span class="normal"> </span><span class="comment">// holds length of current S_12</span>
<span class="normal">            </span><span class="keyword">while</span><span class="normal"> </span><span class="symbol">(!</span><span class="normal">names_input</span><span class="symbol">.</span><span class="function">empty</span><span class="symbol">())</span><span class="normal"> </span><span class="cbracket">{</span>
<span class="normal">                </span><span class="keyword">const</span><span class="normal"> skew_pair_type</span><span class="symbol">&amp;</span><span class="normal"> tmp </span><span class="symbol">=</span><span class="normal"> </span><span class="symbol">*</span><span class="normal">names_input</span><span class="symbol">;</span>
<span class="normal">                </span><span class="keyword">if</span><span class="normal"> </span><span class="symbol">(</span><span class="normal">tmp</span><span class="symbol">.</span><span class="normal">first </span><span class="symbol">&amp;</span><span class="normal"> </span><span class="number">1</span><span class="symbol">)</span><span class="normal"> </span><span class="cbracket">{</span>
<span class="normal">                    m2_sorter</span><span class="symbol">.</span><span class="function">push</span><span class="symbol">(</span><span class="normal">tmp</span><span class="symbol">);</span><span class="normal"> </span><span class="comment">// sorter #2</span>
<span class="normal">                </span><span class="cbracket">}</span>
<span class="normal">                </span><span class="keyword">else</span><span class="normal"> </span><span class="cbracket">{</span>
<span class="normal">                    m1_sorter</span><span class="symbol">.</span><span class="function">push</span><span class="symbol">(</span><span class="normal">tmp</span><span class="symbol">);</span><span class="normal"> </span><span class="comment">// sorter #1</span>
<span class="normal">                </span><span class="cbracket">}</span>
<span class="normal">                </span><span class="symbol">++</span><span class="normal">names_input</span><span class="symbol">;</span>
<span class="normal">                concat_length</span><span class="symbol">++;</span>
<span class="normal">            </span><span class="cbracket">}</span>

<span class="normal">            std</span><span class="symbol">::</span><span class="normal">cout </span><span class="symbol">&lt;&lt;</span><span class="normal"> </span><span class="string">"recursion string length = "</span><span class="normal"> </span><span class="symbol">&lt;&lt;</span><span class="normal"> concat_length </span><span class="symbol">&lt;&lt;</span><span class="normal"> std</span><span class="symbol">::</span><span class="normal">endl</span><span class="symbol">;</span>

<span class="normal">            m1_sorter</span><span class="symbol">.</span><span class="function">sort</span><span class="symbol">();</span>
<span class="normal">            m2_sorter</span><span class="symbol">.</span><span class="function">sort</span><span class="symbol">();</span>

<span class="normal">            </span><span class="keyword">if</span><span class="normal"> </span><span class="symbol">(!</span><span class="normal">unique</span><span class="symbol">)</span>
<span class="normal">            </span><span class="cbracket">{</span>
<span class="normal">                std</span><span class="symbol">::</span><span class="normal">cout </span><span class="symbol">&lt;&lt;</span><span class="normal"> </span><span class="string">"not unique -&gt; next recursion level = "</span><span class="normal"> </span><span class="symbol">&lt;&lt;</span><span class="normal"> </span><span class="symbol">++</span><span class="normal">rec_depth </span><span class="symbol">&lt;&lt;</span><span class="normal"> std</span><span class="symbol">::</span><span class="normal">endl</span><span class="symbol">;</span>

<span class="normal">                </span><span class="comment">// compute s^12 := lexname[S[1 mod 3]] . lexname[S[2 mod 3]], (also known as reduced recursion string 'R')</span>
<span class="normal">                </span><span class="usertype">concatenation_type</span><span class="normal"> </span><span class="function">concat_mod1mod2</span><span class="symbol">(</span><span class="normal">m1_sorter</span><span class="symbol">,</span><span class="normal"> m2_sorter</span><span class="symbol">);</span>

<span class="normal">                buildSA_type</span><span class="symbol">*</span><span class="normal"> recType </span><span class="symbol">=</span><span class="normal"> </span><span class="function">skew3</span><span class="symbol">(</span><span class="normal">concat_mod1mod2</span><span class="symbol">);</span><span class="normal">  </span><span class="comment">// recursion with recursion string T' = concat_mod1mod2 lexnames</span>

<span class="normal">                std</span><span class="symbol">::</span><span class="normal">cout </span><span class="symbol">&lt;&lt;</span><span class="normal"> </span><span class="string">"exit recursion level = "</span><span class="normal"> </span><span class="symbol">&lt;&lt;</span><span class="normal"> </span><span class="symbol">--</span><span class="normal">rec_depth </span><span class="symbol">&lt;&lt;</span><span class="normal"> std</span><span class="symbol">::</span><span class="normal">endl</span><span class="symbol">;</span>

<span class="normal">                </span><span class="usertype">counter_stream_type</span><span class="normal"> isa_loop_index</span><span class="symbol">;</span>
<span class="normal">                </span><span class="usertype">precompute_isa_type</span><span class="normal"> </span><span class="function">isa_pairs</span><span class="symbol">(*</span><span class="normal">recType</span><span class="symbol">,</span><span class="normal"> isa_loop_index</span><span class="symbol">);</span><span class="normal"> </span><span class="comment">// add index as component =&gt; (SA12, i)</span>

<span class="normal">                </span><span class="comment">// store beginning of mod2-tuples of s^12 in mod2_pos</span>
<span class="normal">                </span><span class="usertype">offset_type</span><span class="normal"> special </span><span class="symbol">=</span><span class="normal"> </span><span class="symbol">(</span><span class="normal">concat_length </span><span class="symbol">!=</span><span class="normal"> </span><span class="function">subp_size</span><span class="symbol">(</span><span class="normal">text</span><span class="symbol">.</span><span class="function">size</span><span class="symbol">()));</span>
<span class="normal">                </span><span class="usertype">offset_type</span><span class="normal"> mod2_pos </span><span class="symbol">=</span><span class="normal"> </span><span class="function">offset_type</span><span class="symbol">((</span><span class="function">subp_size</span><span class="symbol">(</span><span class="normal">text</span><span class="symbol">.</span><span class="function">size</span><span class="symbol">())</span><span class="normal"> </span><span class="symbol">&gt;&gt;</span><span class="normal"> </span><span class="number">1</span><span class="symbol">)</span><span class="normal"> </span><span class="symbol">+</span><span class="normal"> </span><span class="symbol">(</span><span class="function">subp_size</span><span class="symbol">(</span><span class="normal">text</span><span class="symbol">.</span><span class="function">size</span><span class="symbol">())</span><span class="normal"> </span><span class="symbol">&amp;</span><span class="normal"> </span><span class="number">1</span><span class="symbol">)</span><span class="normal"> </span><span class="symbol">+</span><span class="normal"> special</span><span class="symbol">);</span>

<span class="normal">                </span><span class="usertype">mod12_sorter_type</span><span class="normal"> </span><span class="function">isa1_pair</span><span class="symbol">(</span><span class="function">mod12cmp</span><span class="symbol">(),</span><span class="normal"> ram_use </span><span class="symbol">/</span><span class="normal"> </span><span class="number">5</span><span class="symbol">);</span>
<span class="normal">                </span><span class="usertype">mod12_sorter_type</span><span class="normal"> </span><span class="function">isa2_pair</span><span class="symbol">(</span><span class="function">mod12cmp</span><span class="symbol">(),</span><span class="normal"> ram_use </span><span class="symbol">/</span><span class="normal"> </span><span class="number">5</span><span class="symbol">);</span>

<span class="normal">                </span><span class="keyword">while</span><span class="normal"> </span><span class="symbol">(!</span><span class="normal">isa_pairs</span><span class="symbol">.</span><span class="function">empty</span><span class="symbol">())</span><span class="normal"> </span><span class="cbracket">{</span>
<span class="normal">                    </span><span class="keyword">const</span><span class="normal"> skew_pair_type</span><span class="symbol">&amp;</span><span class="normal"> tmp </span><span class="symbol">=</span><span class="normal"> </span><span class="symbol">*</span><span class="normal">isa_pairs</span><span class="symbol">;</span>
<span class="normal">                    </span><span class="keyword">if</span><span class="normal"> </span><span class="symbol">(</span><span class="normal">tmp</span><span class="symbol">.</span><span class="normal">first </span><span class="symbol">&lt;</span><span class="normal"> mod2_pos</span><span class="symbol">)</span><span class="normal"> </span><span class="cbracket">{</span>
<span class="normal">                        </span><span class="keyword">if</span><span class="normal"> </span><span class="symbol">(</span><span class="normal">tmp</span><span class="symbol">.</span><span class="normal">first </span><span class="symbol">+</span><span class="normal"> special </span><span class="symbol">&lt;</span><span class="normal"> mod2_pos</span><span class="symbol">)</span><span class="normal"> </span><span class="comment">// else: special sentinel tuple is dropped</span>
<span class="normal">                            isa1_pair</span><span class="symbol">.</span><span class="function">push</span><span class="symbol">(</span><span class="normal">tmp</span><span class="symbol">);</span><span class="normal">            </span><span class="comment">// sorter #1</span>
<span class="normal">                    </span><span class="cbracket">}</span><span class="normal"> </span><span class="keyword">else</span><span class="normal"> </span><span class="cbracket">{</span>
<span class="normal">                        isa2_pair</span><span class="symbol">.</span><span class="function">push</span><span class="symbol">(</span><span class="normal">tmp</span><span class="symbol">);</span><span class="normal">                </span><span class="comment">// sorter #2</span>
<span class="normal">                    </span><span class="cbracket">}</span>
<span class="normal">                    </span><span class="symbol">++</span><span class="normal">isa_pairs</span><span class="symbol">;</span>
<span class="normal">                </span><span class="cbracket">}</span>

<span class="normal">                </span><span class="keyword">delete</span><span class="normal"> recType</span><span class="symbol">;</span>

<span class="normal">                isa1_pair</span><span class="symbol">.</span><span class="function">finish</span><span class="symbol">();</span>
<span class="normal">                isa2_pair</span><span class="symbol">.</span><span class="function">finish</span><span class="symbol">();</span>

<span class="normal">                </span><span class="usertype">offset_array_it_rg</span><span class="normal"> </span><span class="function">input</span><span class="symbol">(</span><span class="normal">text</span><span class="symbol">.</span><span class="function">begin</span><span class="symbol">(),</span><span class="normal"> text</span><span class="symbol">.</span><span class="function">end</span><span class="symbol">());</span>

<span class="normal">                </span><span class="comment">// =&gt; (i, ISA)</span>
<span class="normal">                isa1_pair</span><span class="symbol">.</span><span class="function">sort</span><span class="symbol">(</span><span class="normal">ram_use </span><span class="symbol">/</span><span class="normal"> </span><span class="number">8</span><span class="symbol">);</span>
<span class="normal">                isa2_pair</span><span class="symbol">.</span><span class="function">sort</span><span class="symbol">(</span><span class="normal">ram_use </span><span class="symbol">/</span><span class="normal"> </span><span class="number">8</span><span class="symbol">);</span>

<span class="normal">                </span><span class="comment">// pick ISA of (i, ISA)</span>
<span class="normal">                </span><span class="usertype">isa_second_type</span><span class="normal"> </span><span class="function">isa1</span><span class="symbol">(</span><span class="normal">isa1_pair</span><span class="symbol">);</span>
<span class="normal">                </span><span class="usertype">isa_second_type</span><span class="normal"> </span><span class="function">isa2</span><span class="symbol">(</span><span class="normal">isa2_pair</span><span class="symbol">);</span>

<span class="normal">                </span><span class="comment">// prepare and run merger</span>
<span class="normal">                </span><span class="keyword">return</span><span class="normal"> </span><span class="keyword">new</span><span class="normal"> </span><span class="function">buildSA_type</span><span class="symbol">(</span><span class="normal">input</span><span class="symbol">,</span><span class="normal"> isa1</span><span class="symbol">,</span><span class="normal"> isa2</span><span class="symbol">,</span><span class="normal"> text</span><span class="symbol">.</span><span class="function">size</span><span class="symbol">(),</span><span class="normal"> ram_use</span><span class="symbol">);</span>
<span class="normal">            </span><span class="cbracket">}</span>
<span class="normal">            </span><span class="keyword">else</span><span class="normal"> </span><span class="comment">// unique</span>
<span class="normal">            </span><span class="cbracket">{</span>
<span class="normal">                std</span><span class="symbol">::</span><span class="normal">cout </span><span class="symbol">&lt;&lt;</span><span class="normal"> </span><span class="string">"unique names!"</span><span class="normal"> </span><span class="symbol">&lt;&lt;</span><span class="normal"> std</span><span class="symbol">::</span><span class="normal">endl</span><span class="symbol">;</span>

<span class="normal">                </span><span class="usertype">isa_second_type</span><span class="normal"> </span><span class="function">isa1</span><span class="symbol">(</span><span class="normal">m1_sorter</span><span class="symbol">);</span>
<span class="normal">                </span><span class="usertype">isa_second_type</span><span class="normal"> </span><span class="function">isa2</span><span class="symbol">(</span><span class="normal">m2_sorter</span><span class="symbol">);</span>

<span class="normal">                </span><span class="usertype">offset_array_it_rg</span><span class="normal"> </span><span class="function">source</span><span class="symbol">(</span><span class="normal">text</span><span class="symbol">.</span><span class="function">begin</span><span class="symbol">(),</span><span class="normal"> text</span><span class="symbol">.</span><span class="function">end</span><span class="symbol">());</span>

<span class="normal">                </span><span class="comment">// prepare and run merger</span>
<span class="normal">                </span><span class="keyword">return</span><span class="normal"> </span><span class="keyword">new</span><span class="normal"> </span><span class="function">buildSA_type</span><span class="symbol">(</span><span class="normal">source</span><span class="symbol">,</span><span class="normal"> isa1</span><span class="symbol">,</span><span class="normal"> isa2</span><span class="symbol">,</span><span class="normal"> text</span><span class="symbol">.</span><span class="function">size</span><span class="symbol">(),</span><span class="normal"> ram_use</span><span class="symbol">);</span>
<span class="normal">            </span><span class="cbracket">}</span>
<span class="normal">        </span><span class="cbracket">}</span><span class="normal"> </span><span class="comment">// end of skew3()</span>

<span class="normal">    </span><span class="keyword">protected</span><span class="symbol">:</span>
<span class="normal">        </span><span class="comment">// Adapt (t_i) -&gt; (i,t_i) for input to fit to recursive call</span>
<span class="normal">        </span><span class="keyword">typedef</span><span class="normal"> </span><span class="usertype">make_pairs&lt;counter_stream_type, Input&gt;</span><span class="normal"> make_pairs_input_type</span><span class="symbol">;</span>

<span class="normal">        </span><span class="comment">// points to final constructed suffix array generator</span>
<span class="normal">        buildSA_type</span><span class="symbol">*</span><span class="normal"> out_sa</span><span class="symbol">;</span>

<span class="normal">    </span><span class="keyword">public</span><span class="symbol">:</span>
<span class="normal">        </span><span class="function">algorithm</span><span class="symbol">(</span><span class="normal">Input</span><span class="symbol">&amp;</span><span class="normal"> data_in</span><span class="symbol">)</span>
<span class="normal">            </span><span class="symbol">:</span><span class="normal"> </span><span class="function">finished</span><span class="symbol">(</span><span class="keyword">false</span><span class="symbol">),</span><span class="normal"> </span><span class="function">rec_depth</span><span class="symbol">(</span><span class="number">0</span><span class="symbol">)</span>
<span class="normal">        </span><span class="cbracket">{</span>
<span class="normal">            </span><span class="comment">// (t_i) -&gt; (i,t_i)</span>
<span class="normal">            </span><span class="usertype">counter_stream_type</span><span class="normal"> dummy</span><span class="symbol">;</span>
<span class="normal">            </span><span class="usertype">make_pairs_input_type</span><span class="normal"> </span><span class="function">pairs_input</span><span class="symbol">(</span><span class="normal">dummy</span><span class="symbol">,</span><span class="normal"> data_in</span><span class="symbol">);</span>

<span class="normal">            out_sa </span><span class="symbol">=</span><span class="normal"> </span><span class="function">skew3</span><span class="symbol">(</span><span class="normal">pairs_input</span><span class="symbol">);</span>
<span class="normal">        </span><span class="cbracket">}</span>

<span class="normal">        </span><span class="keyword">const</span><span class="normal"> value_type</span><span class="symbol">&amp;</span><span class="normal"> </span><span class="keyword">operator</span><span class="normal"> </span><span class="symbol">*</span><span class="normal"> </span><span class="symbol">()</span><span class="normal"> </span><span class="keyword">const</span>
<span class="normal">        </span><span class="cbracket">{</span>
<span class="normal">            </span><span class="keyword">return</span><span class="normal"> </span><span class="symbol">*(*</span><span class="normal">out_sa</span><span class="symbol">);</span>
<span class="normal">        </span><span class="cbracket">}</span>

<span class="normal">        algorithm</span><span class="symbol">&amp;</span><span class="normal"> </span><span class="keyword">operator</span><span class="normal"> </span><span class="symbol">++</span><span class="normal"> </span><span class="symbol">()</span>
<span class="normal">        </span><span class="cbracket">{</span>
<span class="normal">            </span><span class="function">assert</span><span class="symbol">(</span><span class="normal">out_sa</span><span class="symbol">);</span>
<span class="normal">            </span><span class="function">assert</span><span class="symbol">(!</span><span class="normal">out_sa</span><span class="symbol">-&gt;</span><span class="function">empty</span><span class="symbol">());</span>

<span class="normal">            </span><span class="symbol">++(*</span><span class="normal">out_sa</span><span class="symbol">);</span>

<span class="normal">            </span><span class="keyword">if</span><span class="normal"> </span><span class="symbol">(</span><span class="normal">out_sa</span><span class="symbol">-&gt;</span><span class="function">empty</span><span class="symbol">())</span><span class="normal"> </span><span class="cbracket">{</span>
<span class="normal">                finished </span><span class="symbol">=</span><span class="normal"> </span><span class="keyword">true</span><span class="symbol">;</span>
<span class="normal">                </span><span class="keyword">delete</span><span class="normal"> out_sa</span><span class="symbol">;</span>
<span class="normal">                out_sa </span><span class="symbol">=</span><span class="normal"> NULL</span><span class="symbol">;</span>
<span class="normal">            </span><span class="cbracket">}</span>
<span class="normal">            </span><span class="keyword">return</span><span class="normal"> </span><span class="symbol">*</span><span class="keyword">this</span><span class="symbol">;</span>
<span class="normal">        </span><span class="cbracket">}</span>

<span class="normal">        </span><span class="symbol">~</span><span class="function">algorithm</span><span class="symbol">()</span>
<span class="normal">        </span><span class="cbracket">{</span>
<span class="normal">            </span><span class="keyword">if</span><span class="normal"> </span><span class="symbol">(</span><span class="normal">out_sa</span><span class="symbol">)</span><span class="normal"> </span><span class="keyword">delete</span><span class="normal"> out_sa</span><span class="symbol">;</span>
<span class="normal">        </span><span class="cbracket">}</span>

<span class="normal">        </span><span class="type">bool</span><span class="normal"> </span><span class="function">empty</span><span class="symbol">()</span><span class="normal"> </span><span class="keyword">const</span>
<span class="normal">        </span><span class="cbracket">{</span>
<span class="normal">            </span><span class="keyword">return</span><span class="normal"> finished</span><span class="symbol">;</span>
<span class="normal">        </span><span class="cbracket">}</span>
<span class="normal">    </span><span class="cbracket">}</span><span class="symbol">;</span><span class="normal"> </span><span class="comment">// algorithm class</span>
<span class="cbracket">}</span><span class="symbol">;</span><span class="normal">     </span><span class="comment">// skew class</span>

<span class="comment">//! helper to print out readable characters.</span>
<span class="keyword">template</span><span class="normal"> </span><span class="symbol">&lt;</span><span class="keyword">typename</span><span class="normal"> </span><span class="classname">alphabet_type</span><span class="symbol">&gt;</span>
<span class="keyword">static</span><span class="normal"> </span><span class="keyword">inline</span><span class="normal"> std</span><span class="symbol">::</span><span class="usertype">string</span><span class="normal"> </span><span class="function">dumpC</span><span class="symbol">(</span><span class="usertype">alphabet_type</span><span class="normal"> c</span><span class="symbol">)</span>
<span class="cbracket">{</span>
<span class="normal">    std</span><span class="symbol">::</span><span class="usertype">ostringstream</span><span class="normal"> oss</span><span class="symbol">;</span>
<span class="normal">    </span><span class="keyword">if</span><span class="normal"> </span><span class="symbol">(</span><span class="function">isalnum</span><span class="symbol">(</span><span class="normal">c</span><span class="symbol">))</span><span class="normal"> oss </span><span class="symbol">&lt;&lt;</span><span class="normal"> </span><span class="string">'</span><span class="specialchar">\'</span><span class="string">'</span><span class="normal"> </span><span class="symbol">&lt;&lt;</span><span class="normal"> </span><span class="symbol">(</span><span class="type">char</span><span class="symbol">)</span><span class="normal">c </span><span class="symbol">&lt;&lt;</span><span class="normal"> </span><span class="string">'</span><span class="specialchar">\'</span><span class="string">'</span><span class="symbol">;</span>
<span class="normal">    </span><span class="keyword">else</span><span class="normal"> oss </span><span class="symbol">&lt;&lt;</span><span class="normal"> </span><span class="symbol">(</span><span class="type">int</span><span class="symbol">)</span><span class="normal">c</span><span class="symbol">;</span>
<span class="normal">    </span><span class="keyword">return</span><span class="normal"> oss</span><span class="symbol">.</span><span class="function">str</span><span class="symbol">();</span>
<span class="cbracket">}</span>

<span class="comment">//! helper stream to cut input off a specified length.</span>
<span class="keyword">template</span><span class="normal"> </span><span class="symbol">&lt;</span><span class="keyword">typename</span><span class="normal"> </span><span class="classname">InputType</span><span class="symbol">&gt;</span>
<span class="keyword">class</span><span class="normal"> </span><span class="classname">cut_stream</span>
<span class="cbracket">{</span>
<span class="keyword">public</span><span class="symbol">:</span>
<span class="normal">    </span><span class="comment">//! same value type as input stream</span>
<span class="normal">    </span><span class="keyword">typedef</span><span class="normal"> </span><span class="keyword">typename</span><span class="normal"> </span><span class="classname">InputType</span><span class="symbol">::</span><span class="usertype">value_type</span><span class="normal"> value_type</span><span class="symbol">;</span>

<span class="keyword">protected</span><span class="symbol">:</span>
<span class="normal">    </span><span class="comment">//! instance of input stream</span>
<span class="normal">    InputType</span><span class="symbol">&amp;</span><span class="normal"> m_input</span><span class="symbol">;</span>

<span class="normal">    </span><span class="comment">//! counter after which the stream ends</span>
<span class="normal">    </span><span class="usertype">size_type</span><span class="normal"> m_count</span><span class="symbol">;</span>

<span class="keyword">public</span><span class="symbol">:</span>
<span class="normal">    </span><span class="function">cut_stream</span><span class="symbol">(</span><span class="normal">InputType</span><span class="symbol">&amp;</span><span class="normal"> input</span><span class="symbol">,</span><span class="normal"> </span><span class="usertype">size_type</span><span class="normal"> count</span><span class="symbol">)</span>
<span class="normal">        </span><span class="symbol">:</span><span class="normal"> </span><span class="function">m_input</span><span class="symbol">(</span><span class="normal">input</span><span class="symbol">),</span><span class="normal"> </span><span class="function">m_count</span><span class="symbol">(</span><span class="normal">count</span><span class="symbol">)</span>
<span class="normal">    </span><span class="cbracket">{</span><span class="normal"> </span><span class="cbracket">}</span>

<span class="normal">    </span><span class="keyword">const</span><span class="normal"> value_type</span><span class="symbol">&amp;</span><span class="normal"> </span><span class="keyword">operator</span><span class="normal"> </span><span class="symbol">*</span><span class="normal"> </span><span class="symbol">()</span><span class="normal"> </span><span class="keyword">const</span>
<span class="normal">    </span><span class="cbracket">{</span>
<span class="normal">        </span><span class="function">assert</span><span class="symbol">(</span><span class="normal">m_count </span><span class="symbol">&gt;</span><span class="normal"> </span><span class="number">0</span><span class="symbol">);</span>
<span class="normal">        </span><span class="keyword">return</span><span class="normal"> </span><span class="symbol">*</span><span class="normal">m_input</span><span class="symbol">;</span>
<span class="normal">    </span><span class="cbracket">}</span>

<span class="normal">    cut_stream</span><span class="symbol">&amp;</span><span class="normal"> </span><span class="keyword">operator</span><span class="normal"> </span><span class="symbol">++</span><span class="normal"> </span><span class="symbol">()</span>
<span class="normal">    </span><span class="cbracket">{</span>
<span class="normal">        </span><span class="function">assert</span><span class="symbol">(!</span><span class="function">empty</span><span class="symbol">());</span>
<span class="normal">        </span><span class="symbol">--</span><span class="normal">m_count</span><span class="symbol">;</span>
<span class="normal">        </span><span class="symbol">++</span><span class="normal">m_input</span><span class="symbol">;</span>
<span class="normal">        </span><span class="keyword">return</span><span class="normal"> </span><span class="symbol">*</span><span class="keyword">this</span><span class="symbol">;</span>
<span class="normal">    </span><span class="cbracket">}</span>

<span class="normal">    </span><span class="type">bool</span><span class="normal"> </span><span class="function">empty</span><span class="symbol">()</span><span class="normal"> </span><span class="keyword">const</span>
<span class="normal">    </span><span class="cbracket">{</span>
<span class="normal">        </span><span class="keyword">return</span><span class="normal"> </span><span class="symbol">(</span><span class="normal">m_count </span><span class="symbol">==</span><span class="normal"> </span><span class="number">0</span><span class="symbol">)</span><span class="normal"> </span><span class="symbol">||</span><span class="normal"> m_input</span><span class="symbol">.</span><span class="function">empty</span><span class="symbol">();</span>
<span class="normal">    </span><span class="cbracket">}</span>
<span class="cbracket">}</span><span class="symbol">;</span>

<span class="usertype">alphabet_type</span><span class="normal"> </span><span class="function">unary_generator</span><span class="symbol">()</span>
<span class="cbracket">{</span>
<span class="normal">    </span><span class="keyword">return</span><span class="normal"> </span><span class="string">'a'</span><span class="symbol">;</span>
<span class="cbracket">}</span>

<span class="keyword">template</span><span class="normal"> </span><span class="symbol">&lt;</span><span class="keyword">typename</span><span class="normal"> </span><span class="classname">offset_type</span><span class="symbol">&gt;</span>
<span class="type">int</span><span class="normal"> </span><span class="function">process</span><span class="symbol">(</span><span class="keyword">const</span><span class="normal"> std</span><span class="symbol">::</span><span class="normal">string</span><span class="symbol">&amp;</span><span class="normal"> input_filename</span><span class="symbol">,</span><span class="normal"> </span><span class="keyword">const</span><span class="normal"> std</span><span class="symbol">::</span><span class="normal">string</span><span class="symbol">&amp;</span><span class="normal"> output_filename</span><span class="symbol">,</span>
<span class="normal">            </span><span class="usertype">size_type</span><span class="normal"> sizelimit</span><span class="symbol">,</span>
<span class="normal">            </span><span class="type">bool</span><span class="normal"> text_output_flag</span><span class="symbol">,</span><span class="normal"> </span><span class="type">bool</span><span class="normal"> check_flag</span><span class="symbol">,</span><span class="normal"> </span><span class="type">bool</span><span class="normal"> input_verbatim</span><span class="symbol">)</span>
<span class="cbracket">{</span>
<span class="normal">    </span><span class="keyword">static</span><span class="normal"> </span><span class="keyword">const</span><span class="normal"> </span><span class="usertype">size_t</span><span class="normal"> block_size </span><span class="symbol">=</span><span class="normal"> </span><span class="keyword">sizeof</span><span class="symbol">(</span><span class="normal">offset_type</span><span class="symbol">)</span><span class="normal"> </span><span class="symbol">*</span><span class="normal"> </span><span class="number">1024</span><span class="normal"> </span><span class="symbol">*</span><span class="normal"> </span><span class="number">1024</span><span class="normal"> </span><span class="symbol">/</span><span class="normal"> </span><span class="number">2</span><span class="symbol">;</span>

<span class="normal">    </span><span class="keyword">typedef</span><span class="normal"> </span><span class="keyword">typename</span><span class="normal"> </span><span class="classname">stxxl</span><span class="symbol">::</span><span class="normal">VECTOR_GENERATOR</span><span class="symbol">&lt;</span><span class="normal">alphabet_type</span><span class="symbol">,</span><span class="normal"> </span><span class="number">1</span><span class="symbol">,</span><span class="normal"> </span><span class="number">2</span><span class="symbol">&gt;::</span><span class="usertype">result</span><span class="normal"> alphabet_vector_type</span><span class="symbol">;</span>
<span class="normal">    </span><span class="keyword">typedef</span><span class="normal"> </span><span class="keyword">typename</span><span class="normal"> </span><span class="classname">stxxl</span><span class="symbol">::</span><span class="normal">VECTOR_GENERATOR</span><span class="symbol">&lt;</span><span class="normal">offset_type</span><span class="symbol">,</span><span class="normal"> </span><span class="number">1</span><span class="symbol">,</span><span class="normal"> </span><span class="number">2</span><span class="symbol">,</span><span class="normal"> block_size</span><span class="symbol">&gt;::</span><span class="usertype">result</span><span class="normal"> offset_vector_type</span><span class="symbol">;</span>

<span class="normal">    </span><span class="comment">// input and output files (if supplied via command line)</span>
<span class="normal">    stxxl</span><span class="symbol">::</span><span class="normal">syscall_file</span><span class="symbol">*</span><span class="normal"> input_file </span><span class="symbol">=</span><span class="normal"> NULL</span><span class="symbol">,</span><span class="normal"> </span><span class="symbol">*</span><span class="normal"> output_file </span><span class="symbol">=</span><span class="normal"> NULL</span><span class="symbol">;</span>

<span class="normal">    </span><span class="comment">// input and output vectors for suffix array construction</span>
<span class="normal">    </span><span class="usertype">alphabet_vector_type</span><span class="normal"> input_vector</span><span class="symbol">;</span>
<span class="normal">    </span><span class="usertype">offset_vector_type</span><span class="normal"> output_vector</span><span class="symbol">;</span>

<span class="normal">    </span><span class="keyword">using</span><span class="normal"> stxxl</span><span class="symbol">::</span><span class="normal">file</span><span class="symbol">;</span>

<span class="normal">    </span><span class="keyword">if</span><span class="normal"> </span><span class="symbol">(</span><span class="normal">input_verbatim</span><span class="symbol">)</span>
<span class="normal">    </span><span class="cbracket">{</span>
<span class="normal">        </span><span class="comment">// copy input verbatim into vector</span>
<span class="normal">        input_vector</span><span class="symbol">.</span><span class="function">resize</span><span class="symbol">(</span><span class="normal">input_filename</span><span class="symbol">.</span><span class="function">size</span><span class="symbol">());</span>
<span class="normal">        std</span><span class="symbol">::</span><span class="function">copy</span><span class="symbol">(</span><span class="normal">input_filename</span><span class="symbol">.</span><span class="function">begin</span><span class="symbol">(),</span><span class="normal"> input_filename</span><span class="symbol">.</span><span class="function">end</span><span class="symbol">(),</span><span class="normal"> input_vector</span><span class="symbol">.</span><span class="function">begin</span><span class="symbol">());</span>
<span class="normal">    </span><span class="cbracket">}</span>
<span class="normal">    </span><span class="keyword">else</span><span class="normal"> </span><span class="keyword">if</span><span class="normal"> </span><span class="symbol">(</span><span class="normal">input_filename </span><span class="symbol">==</span><span class="normal"> </span><span class="string">"random"</span><span class="symbol">)</span>
<span class="normal">    </span><span class="cbracket">{</span>
<span class="normal">        </span><span class="keyword">if</span><span class="normal"> </span><span class="symbol">(</span><span class="normal">sizelimit </span><span class="symbol">==</span><span class="normal"> std</span><span class="symbol">::</span><span class="normal">numeric_limits</span><span class="symbol">&lt;</span><span class="normal">size_type</span><span class="symbol">&gt;::</span><span class="function">max</span><span class="symbol">())</span><span class="normal"> </span><span class="cbracket">{</span>
<span class="normal">            std</span><span class="symbol">::</span><span class="normal">cout </span><span class="symbol">&lt;&lt;</span><span class="normal"> </span><span class="string">"You must provide -s &lt;size&gt; for generated inputs."</span><span class="normal"> </span><span class="symbol">&lt;&lt;</span><span class="normal"> std</span><span class="symbol">::</span><span class="normal">endl</span><span class="symbol">;</span>
<span class="normal">            </span><span class="keyword">return</span><span class="normal"> </span><span class="number">1</span><span class="symbol">;</span>
<span class="normal">        </span><span class="cbracket">}</span>

<span class="normal">        </span><span class="comment">// fill input vector with random bytes</span>
<span class="normal">        input_vector</span><span class="symbol">.</span><span class="function">resize</span><span class="symbol">(</span><span class="normal">sizelimit</span><span class="symbol">);</span>
<span class="normal">        stxxl</span><span class="symbol">::</span><span class="usertype">random_number8_r</span><span class="normal"> rand8</span><span class="symbol">;</span>
<span class="normal">        stxxl</span><span class="symbol">::</span><span class="function">generate</span><span class="symbol">(</span><span class="normal">input_vector</span><span class="symbol">.</span><span class="function">begin</span><span class="symbol">(),</span><span class="normal"> input_vector</span><span class="symbol">.</span><span class="function">end</span><span class="symbol">(),</span><span class="normal"> rand8</span><span class="symbol">);</span>
<span class="normal">    </span><span class="cbracket">}</span>
<span class="normal">    </span><span class="keyword">else</span><span class="normal"> </span><span class="keyword">if</span><span class="normal"> </span><span class="symbol">(</span><span class="normal">input_filename </span><span class="symbol">==</span><span class="normal"> </span><span class="string">"unary"</span><span class="symbol">)</span>
<span class="normal">    </span><span class="cbracket">{</span>
<span class="normal">        </span><span class="keyword">if</span><span class="normal"> </span><span class="symbol">(</span><span class="normal">sizelimit </span><span class="symbol">==</span><span class="normal"> std</span><span class="symbol">::</span><span class="normal">numeric_limits</span><span class="symbol">&lt;</span><span class="normal">size_type</span><span class="symbol">&gt;::</span><span class="function">max</span><span class="symbol">())</span><span class="normal"> </span><span class="cbracket">{</span>
<span class="normal">            std</span><span class="symbol">::</span><span class="normal">cout </span><span class="symbol">&lt;&lt;</span><span class="normal"> </span><span class="string">"You must provide -s &lt;size&gt; for generated inputs."</span><span class="normal"> </span><span class="symbol">&lt;&lt;</span><span class="normal"> std</span><span class="symbol">::</span><span class="normal">endl</span><span class="symbol">;</span>
<span class="normal">            </span><span class="keyword">return</span><span class="normal"> </span><span class="number">1</span><span class="symbol">;</span>
<span class="normal">        </span><span class="cbracket">}</span>

<span class="normal">        </span><span class="comment">// fill input vector with random bytes</span>
<span class="normal">        input_vector</span><span class="symbol">.</span><span class="function">resize</span><span class="symbol">(</span><span class="normal">sizelimit</span><span class="symbol">);</span>
<span class="normal">        stxxl</span><span class="symbol">::</span><span class="function">generate</span><span class="symbol">(</span><span class="normal">input_vector</span><span class="symbol">.</span><span class="function">begin</span><span class="symbol">(),</span><span class="normal"> input_vector</span><span class="symbol">.</span><span class="function">end</span><span class="symbol">(),</span><span class="normal"> unary_generator</span><span class="symbol">);</span>
<span class="normal">    </span><span class="cbracket">}</span>
<span class="normal">    </span><span class="keyword">else</span>
<span class="normal">    </span><span class="cbracket">{</span>
<span class="normal">        </span><span class="comment">// define input file object and map input_vector to input_file (no copying)</span>
<span class="normal">        input_file </span><span class="symbol">=</span><span class="normal"> </span><span class="keyword">new</span><span class="normal"> stxxl</span><span class="symbol">::</span><span class="function">syscall_file</span><span class="symbol">(</span><span class="normal">input_filename</span><span class="symbol">,</span><span class="normal"> file</span><span class="symbol">::</span><span class="normal">RDONLY </span><span class="symbol">|</span><span class="normal"> file</span><span class="symbol">::</span><span class="normal">DIRECT</span><span class="symbol">);</span>
<span class="normal">        </span><span class="usertype">alphabet_vector_type</span><span class="normal"> </span><span class="function">file_input_vector</span><span class="symbol">(</span><span class="normal">input_file</span><span class="symbol">);</span>
<span class="normal">        input_vector</span><span class="symbol">.</span><span class="function">swap</span><span class="symbol">(</span><span class="normal">file_input_vector</span><span class="symbol">);</span>
<span class="normal">    </span><span class="cbracket">}</span>

<span class="normal">    </span><span class="keyword">if</span><span class="normal"> </span><span class="symbol">(</span><span class="normal">output_filename</span><span class="symbol">.</span><span class="function">size</span><span class="symbol">())</span>
<span class="normal">    </span><span class="cbracket">{</span>
<span class="normal">        </span><span class="comment">// define output file object and map output_vector to output_file</span>
<span class="normal">        output_file </span><span class="symbol">=</span><span class="normal"> </span><span class="keyword">new</span><span class="normal"> stxxl</span><span class="symbol">::</span><span class="function">syscall_file</span><span class="symbol">(</span><span class="normal">output_filename</span><span class="symbol">,</span><span class="normal"> file</span><span class="symbol">::</span><span class="normal">RDWR </span><span class="symbol">|</span><span class="normal"> file</span><span class="symbol">::</span><span class="normal">CREAT </span><span class="symbol">|</span><span class="normal"> file</span><span class="symbol">::</span><span class="normal">DIRECT</span><span class="symbol">);</span>
<span class="normal">        </span><span class="usertype">offset_vector_type</span><span class="normal"> </span><span class="function">file_output_vector</span><span class="symbol">(</span><span class="normal">output_file</span><span class="symbol">);</span>
<span class="normal">        output_vector</span><span class="symbol">.</span><span class="function">swap</span><span class="symbol">(</span><span class="normal">file_output_vector</span><span class="symbol">);</span>
<span class="normal">    </span><span class="cbracket">}</span>

<span class="normal">    </span><span class="comment">// I/O measurement</span>
<span class="normal">    stxxl</span><span class="symbol">::</span><span class="normal">stats</span><span class="symbol">*</span><span class="normal"> Stats </span><span class="symbol">=</span><span class="normal"> stxxl</span><span class="symbol">::</span><span class="normal">stats</span><span class="symbol">::</span><span class="function">get_instance</span><span class="symbol">();</span>
<span class="normal">    stxxl</span><span class="symbol">::</span><span class="usertype">stats_data</span><span class="normal"> </span><span class="function">stats_begin</span><span class="symbol">(*</span><span class="normal">Stats</span><span class="symbol">);</span>

<span class="normal">    </span><span class="comment">// construct skew class with bufreader input type</span>
<span class="normal">    </span><span class="keyword">typedef</span><span class="normal"> alphabet_vector_type</span><span class="symbol">::</span><span class="usertype">bufreader_type</span><span class="normal"> input_type</span><span class="symbol">;</span>
<span class="normal">    </span><span class="keyword">typedef</span><span class="normal"> </span><span class="usertype">cut_stream&lt;input_type&gt;</span><span class="normal"> cut_input_type</span><span class="symbol">;</span>
<span class="normal">    </span><span class="keyword">typedef</span><span class="normal"> </span><span class="keyword">typename</span><span class="normal"> </span><span class="classname">skew</span><span class="symbol">&lt;</span><span class="normal">offset_type</span><span class="symbol">&gt;::</span><span class="keyword">template</span><span class="normal"> </span><span class="usertype">algorithm&lt;cut_input_type&gt;</span><span class="normal"> skew_type</span><span class="symbol">;</span>

<span class="normal">    </span><span class="usertype">size_type</span><span class="normal"> size </span><span class="symbol">=</span><span class="normal"> input_vector</span><span class="symbol">.</span><span class="function">size</span><span class="symbol">();</span>
<span class="normal">    </span><span class="keyword">if</span><span class="normal"> </span><span class="symbol">(</span><span class="normal">size </span><span class="symbol">&gt;</span><span class="normal"> sizelimit</span><span class="symbol">)</span><span class="normal"> size </span><span class="symbol">=</span><span class="normal"> sizelimit</span><span class="symbol">;</span>

<span class="normal">    std</span><span class="symbol">::</span><span class="normal">cout </span><span class="symbol">&lt;&lt;</span><span class="normal"> </span><span class="string">"input size = "</span><span class="normal"> </span><span class="symbol">&lt;&lt;</span><span class="normal"> size </span><span class="symbol">&lt;&lt;</span><span class="normal"> std</span><span class="symbol">::</span><span class="normal">endl</span><span class="symbol">;</span>

<span class="normal">    </span><span class="keyword">if</span><span class="normal"> </span><span class="symbol">(</span><span class="normal">size </span><span class="symbol">+</span><span class="normal"> </span><span class="number">3</span><span class="normal"> </span><span class="symbol">&gt;=</span><span class="normal"> std</span><span class="symbol">::</span><span class="normal">numeric_limits</span><span class="symbol">&lt;</span><span class="normal">offset_type</span><span class="symbol">&gt;::</span><span class="function">max</span><span class="symbol">())</span><span class="normal"> </span><span class="cbracket">{</span>
<span class="normal">        std</span><span class="symbol">::</span><span class="normal">cout </span><span class="symbol">&lt;&lt;</span><span class="normal"> </span><span class="string">"error: input is too long for selected word size!"</span><span class="normal"> </span><span class="symbol">&lt;&lt;</span><span class="normal"> std</span><span class="symbol">::</span><span class="normal">endl</span><span class="symbol">;</span>
<span class="normal">        </span><span class="keyword">return</span><span class="normal"> </span><span class="symbol">-</span><span class="number">1</span><span class="symbol">;</span>
<span class="normal">    </span><span class="cbracket">}</span>

<span class="normal">    </span><span class="usertype">input_type</span><span class="normal"> </span><span class="function">input</span><span class="symbol">(</span><span class="normal">input_vector</span><span class="symbol">);</span>
<span class="normal">    </span><span class="usertype">cut_input_type</span><span class="normal"> </span><span class="function">cut_input</span><span class="symbol">(</span><span class="normal">input</span><span class="symbol">,</span><span class="normal"> size</span><span class="symbol">);</span>
<span class="normal">    </span><span class="usertype">skew_type</span><span class="normal"> </span><span class="function">skew</span><span class="symbol">(</span><span class="normal">cut_input</span><span class="symbol">);</span>

<span class="normal">    </span><span class="comment">// make sure output vector has the right size</span>
<span class="normal">    output_vector</span><span class="symbol">.</span><span class="function">resize</span><span class="symbol">(</span><span class="normal">size</span><span class="symbol">);</span>

<span class="normal">    </span><span class="comment">// write suffix array stream into output vector</span>
<span class="normal">    stream</span><span class="symbol">::</span><span class="function">materialize</span><span class="symbol">(</span><span class="normal">skew</span><span class="symbol">,</span><span class="normal"> output_vector</span><span class="symbol">.</span><span class="function">begin</span><span class="symbol">(),</span><span class="normal"> output_vector</span><span class="symbol">.</span><span class="function">end</span><span class="symbol">());</span>

<span class="normal">    std</span><span class="symbol">::</span><span class="normal">cout </span><span class="symbol">&lt;&lt;</span><span class="normal"> </span><span class="string">"output size = "</span><span class="normal"> </span><span class="symbol">&lt;&lt;</span><span class="normal"> output_vector</span><span class="symbol">.</span><span class="function">size</span><span class="symbol">()</span><span class="normal"> </span><span class="symbol">&lt;&lt;</span><span class="normal"> std</span><span class="symbol">::</span><span class="normal">endl</span><span class="symbol">;</span>
<span class="normal">    std</span><span class="symbol">::</span><span class="normal">cout </span><span class="symbol">&lt;&lt;</span><span class="normal"> </span><span class="symbol">(</span><span class="normal">stxxl</span><span class="symbol">::</span><span class="function">stats_data</span><span class="symbol">(*</span><span class="normal">Stats</span><span class="symbol">)</span><span class="normal"> </span><span class="symbol">-</span><span class="normal"> stats_begin</span><span class="symbol">);</span><span class="normal"> </span><span class="comment">// print i/o statistics</span>

<span class="normal">    </span><span class="keyword">if</span><span class="normal"> </span><span class="symbol">(</span><span class="normal">text_output_flag</span><span class="symbol">)</span>
<span class="normal">    </span><span class="cbracket">{</span>
<span class="normal">        std</span><span class="symbol">::</span><span class="normal">cout </span><span class="symbol">&lt;&lt;</span><span class="normal"> std</span><span class="symbol">::</span><span class="normal">endl </span><span class="symbol">&lt;&lt;</span><span class="normal"> </span><span class="string">"resulting suffix array:"</span><span class="normal"> </span><span class="symbol">&lt;&lt;</span><span class="normal"> std</span><span class="symbol">::</span><span class="normal">endl</span><span class="symbol">;</span>

<span class="normal">        </span><span class="keyword">for</span><span class="normal"> </span><span class="symbol">(</span><span class="type">unsigned</span><span class="normal"> </span><span class="type">int</span><span class="normal"> i </span><span class="symbol">=</span><span class="normal"> </span><span class="number">0</span><span class="symbol">;</span><span class="normal"> i </span><span class="symbol">&lt;</span><span class="normal"> output_vector</span><span class="symbol">.</span><span class="function">size</span><span class="symbol">();</span><span class="normal"> i</span><span class="symbol">++)</span><span class="normal"> </span><span class="cbracket">{</span>
<span class="normal">            std</span><span class="symbol">::</span><span class="normal">cout </span><span class="symbol">&lt;&lt;</span><span class="normal"> i </span><span class="symbol">&lt;&lt;</span><span class="normal"> </span><span class="string">" : "</span><span class="normal"> </span><span class="symbol">&lt;&lt;</span><span class="normal"> output_vector</span><span class="symbol">[</span><span class="normal">i</span><span class="symbol">]</span><span class="normal"> </span><span class="symbol">&lt;&lt;</span><span class="normal"> </span><span class="string">" : "</span><span class="symbol">;</span>

<span class="normal">            </span><span class="comment">// We need a const reference because operator[] would write data</span>
<span class="normal">            </span><span class="keyword">const</span><span class="normal"> alphabet_vector_type</span><span class="symbol">&amp;</span><span class="normal"> cinput </span><span class="symbol">=</span><span class="normal"> input_vector</span><span class="symbol">;</span>

<span class="normal">            </span><span class="keyword">for</span><span class="normal"> </span><span class="symbol">(</span><span class="type">unsigned</span><span class="normal"> </span><span class="type">int</span><span class="normal"> j </span><span class="symbol">=</span><span class="normal"> </span><span class="number">0</span><span class="symbol">;</span><span class="normal"> output_vector</span><span class="symbol">[</span><span class="normal">i</span><span class="symbol">]</span><span class="normal"> </span><span class="symbol">+</span><span class="normal"> j </span><span class="symbol">&lt;</span><span class="normal"> cinput</span><span class="symbol">.</span><span class="function">size</span><span class="symbol">();</span><span class="normal"> j</span><span class="symbol">++)</span><span class="normal"> </span><span class="cbracket">{</span>
<span class="normal">                std</span><span class="symbol">::</span><span class="normal">cout </span><span class="symbol">&lt;&lt;</span><span class="normal"> </span><span class="function">dumpC</span><span class="symbol">(</span><span class="normal">cinput</span><span class="symbol">[</span><span class="normal">output_vector</span><span class="symbol">[</span><span class="normal">i</span><span class="symbol">]</span><span class="normal"> </span><span class="symbol">+</span><span class="normal"> j</span><span class="symbol">])</span><span class="normal"> </span><span class="symbol">&lt;&lt;</span><span class="normal"> </span><span class="string">" "</span><span class="symbol">;</span>
<span class="normal">            </span><span class="cbracket">}</span>

<span class="normal">            std</span><span class="symbol">::</span><span class="normal">cout </span><span class="symbol">&lt;&lt;</span><span class="normal"> std</span><span class="symbol">::</span><span class="normal">endl</span><span class="symbol">;</span>
<span class="normal">        </span><span class="cbracket">}</span>
<span class="normal">    </span><span class="cbracket">}</span>

<span class="normal">    </span><span class="type">int</span><span class="normal"> ret </span><span class="symbol">=</span><span class="normal"> </span><span class="number">0</span><span class="symbol">;</span>

<span class="normal">    </span><span class="keyword">if</span><span class="normal"> </span><span class="symbol">(</span><span class="normal">check_flag</span><span class="symbol">)</span>
<span class="normal">    </span><span class="cbracket">{</span>
<span class="normal">        </span><span class="symbol">(</span><span class="normal">std</span><span class="symbol">::</span><span class="normal">cout </span><span class="symbol">&lt;&lt;</span><span class="normal"> </span><span class="string">"checking suffix array... "</span><span class="symbol">).</span><span class="function">flush</span><span class="symbol">();</span>

<span class="normal">        </span><span class="keyword">if</span><span class="normal"> </span><span class="symbol">(!</span><span class="function">sacheck_vectors</span><span class="symbol">(</span><span class="normal">input_vector</span><span class="symbol">,</span><span class="normal"> output_vector</span><span class="symbol">))</span><span class="normal"> </span><span class="cbracket">{</span>
<span class="normal">            std</span><span class="symbol">::</span><span class="normal">cout </span><span class="symbol">&lt;&lt;</span><span class="normal"> </span><span class="string">"failed!"</span><span class="normal"> </span><span class="symbol">&lt;&lt;</span><span class="normal"> std</span><span class="symbol">::</span><span class="normal">endl</span><span class="symbol">;</span>
<span class="normal">            ret </span><span class="symbol">=</span><span class="normal"> </span><span class="symbol">-</span><span class="number">1</span><span class="symbol">;</span>
<span class="normal">        </span><span class="cbracket">}</span>
<span class="normal">        </span><span class="keyword">else</span>
<span class="normal">            std</span><span class="symbol">::</span><span class="normal">cout </span><span class="symbol">&lt;&lt;</span><span class="normal"> </span><span class="string">"ok."</span><span class="normal"> </span><span class="symbol">&lt;&lt;</span><span class="normal"> std</span><span class="symbol">::</span><span class="normal">endl</span><span class="symbol">;</span>
<span class="normal">    </span><span class="cbracket">}</span>

<span class="normal">    </span><span class="comment">// close file, but have to deallocate vector first!</span>

<span class="normal">    </span><span class="keyword">if</span><span class="normal"> </span><span class="symbol">(</span><span class="normal">input_file</span><span class="symbol">)</span><span class="normal"> </span><span class="cbracket">{</span>
<span class="normal">        input_vector </span><span class="symbol">=</span><span class="normal"> </span><span class="function">alphabet_vector_type</span><span class="symbol">();</span>
<span class="normal">        </span><span class="keyword">delete</span><span class="normal"> input_file</span><span class="symbol">;</span>
<span class="normal">    </span><span class="cbracket">}</span>
<span class="normal">    </span><span class="keyword">if</span><span class="normal"> </span><span class="symbol">(</span><span class="normal">output_file</span><span class="symbol">)</span><span class="normal"> </span><span class="cbracket">{</span>
<span class="normal">        output_vector </span><span class="symbol">=</span><span class="normal"> </span><span class="function">offset_vector_type</span><span class="symbol">();</span>
<span class="normal">        </span><span class="keyword">delete</span><span class="normal"> output_file</span><span class="symbol">;</span>
<span class="normal">    </span><span class="cbracket">}</span>

<span class="normal">    </span><span class="keyword">return</span><span class="normal"> ret</span><span class="symbol">;</span>
<span class="cbracket">}</span>

<span class="type">int</span><span class="normal"> </span><span class="function">main</span><span class="symbol">(</span><span class="type">int</span><span class="normal"> argc</span><span class="symbol">,</span><span class="normal"> </span><span class="type">char</span><span class="symbol">*</span><span class="normal"> argv</span><span class="symbol">[])</span>
<span class="cbracket">{</span>
<span class="normal">    stxxl</span><span class="symbol">::</span><span class="usertype">cmdline_parser</span><span class="normal"> cp</span><span class="symbol">;</span>

<span class="normal">    cp</span><span class="symbol">.</span><span class="function">set_description</span><span class="symbol">(</span><span class="string">"DC3 aka skew3 algorithm for external memory suffix array construction."</span><span class="symbol">);</span>
<span class="normal">    cp</span><span class="symbol">.</span><span class="function">set_author</span><span class="symbol">(</span><span class="string">"Jens Mehnert &lt;jmehnert@mpi-sb.mpg.de&gt;, Timo Bingmann &lt;tb@panthema.net&gt;, Daniel Feist &lt;daniel.feist@student.kit.edu&gt;"</span><span class="symbol">);</span>

<span class="normal">    std</span><span class="symbol">::</span><span class="usertype">string</span><span class="normal"> input_filename</span><span class="symbol">,</span><span class="normal"> output_filename</span><span class="symbol">;</span>
<span class="normal">    </span><span class="usertype">size_type</span><span class="normal"> sizelimit </span><span class="symbol">=</span><span class="normal"> std</span><span class="symbol">::</span><span class="normal">numeric_limits</span><span class="symbol">&lt;</span><span class="normal">size_type</span><span class="symbol">&gt;::</span><span class="function">max</span><span class="symbol">();</span>
<span class="normal">    </span><span class="type">bool</span><span class="normal"> text_output_flag </span><span class="symbol">=</span><span class="normal"> </span><span class="keyword">false</span><span class="symbol">;</span>
<span class="normal">    </span><span class="type">bool</span><span class="normal"> check_flag </span><span class="symbol">=</span><span class="normal"> </span><span class="keyword">false</span><span class="symbol">;</span>
<span class="normal">    </span><span class="type">bool</span><span class="normal"> input_verbatim </span><span class="symbol">=</span><span class="normal"> </span><span class="keyword">false</span><span class="symbol">;</span>
<span class="normal">    </span><span class="type">unsigned</span><span class="normal"> wordsize </span><span class="symbol">=</span><span class="normal"> </span><span class="number">32</span><span class="symbol">;</span>

<span class="normal">    cp</span><span class="symbol">.</span><span class="function">add_param_string</span><span class="symbol">(</span><span class="string">"input"</span><span class="symbol">,</span><span class="normal"> </span><span class="string">"Path to input file (or verbatim text).</span><span class="specialchar">\n</span><span class="string">  The special inputs 'random' and 'unary' generate such text on-the-fly."</span><span class="symbol">,</span><span class="normal"> input_filename</span><span class="symbol">);</span>
<span class="normal">    cp</span><span class="symbol">.</span><span class="function">add_flag</span><span class="symbol">(</span><span class="string">'c'</span><span class="symbol">,</span><span class="normal"> </span><span class="string">"check"</span><span class="symbol">,</span><span class="normal"> </span><span class="string">"Check suffix array for correctness."</span><span class="symbol">,</span><span class="normal"> check_flag</span><span class="symbol">);</span>
<span class="normal">    cp</span><span class="symbol">.</span><span class="function">add_flag</span><span class="symbol">(</span><span class="string">'t'</span><span class="symbol">,</span><span class="normal"> </span><span class="string">"text"</span><span class="symbol">,</span><span class="normal"> </span><span class="string">"Print out suffix array in readable text."</span><span class="symbol">,</span><span class="normal"> text_output_flag</span><span class="symbol">);</span>
<span class="normal">    cp</span><span class="symbol">.</span><span class="function">add_string</span><span class="symbol">(</span><span class="string">'o'</span><span class="symbol">,</span><span class="normal"> </span><span class="string">"output"</span><span class="symbol">,</span><span class="normal"> </span><span class="string">"Output suffix array to given path."</span><span class="symbol">,</span><span class="normal"> output_filename</span><span class="symbol">);</span>
<span class="normal">    cp</span><span class="symbol">.</span><span class="function">add_flag</span><span class="symbol">(</span><span class="string">'v'</span><span class="symbol">,</span><span class="normal"> </span><span class="string">"verbatim"</span><span class="symbol">,</span><span class="normal"> </span><span class="string">"Consider </span><span class="specialchar">\"</span><span class="string">input</span><span class="specialchar">\"</span><span class="string"> as verbatim text to construct suffix array on."</span><span class="symbol">,</span><span class="normal"> input_verbatim</span><span class="symbol">);</span>
<span class="normal">    cp</span><span class="symbol">.</span><span class="function">add_bytes</span><span class="symbol">(</span><span class="string">'s'</span><span class="symbol">,</span><span class="normal"> </span><span class="string">"size"</span><span class="symbol">,</span><span class="normal"> </span><span class="string">"Cut input text to given size, e.g. 2 GiB."</span><span class="symbol">,</span><span class="normal"> sizelimit</span><span class="symbol">);</span>
<span class="normal">    cp</span><span class="symbol">.</span><span class="function">add_bytes</span><span class="symbol">(</span><span class="string">'M'</span><span class="symbol">,</span><span class="normal"> </span><span class="string">"memuse"</span><span class="symbol">,</span><span class="normal"> </span><span class="string">"Amount of RAM to use, default: 1 GiB."</span><span class="symbol">,</span><span class="normal"> ram_use</span><span class="symbol">);</span>
<span class="normal">    cp</span><span class="symbol">.</span><span class="function">add_uint</span><span class="symbol">(</span><span class="string">'w'</span><span class="symbol">,</span><span class="normal"> </span><span class="string">"wordsize"</span><span class="symbol">,</span><span class="normal"> </span><span class="string">"Set word size of suffix array to 32, 40 or 64 bit, default: 32-bit."</span><span class="symbol">,</span><span class="normal"> wordsize</span><span class="symbol">);</span>

<span class="normal">    </span><span class="comment">// process command line</span>
<span class="normal">    </span><span class="keyword">if</span><span class="normal"> </span><span class="symbol">(!</span><span class="normal">cp</span><span class="symbol">.</span><span class="function">process</span><span class="symbol">(</span><span class="normal">argc</span><span class="symbol">,</span><span class="normal"> argv</span><span class="symbol">))</span>
<span class="normal">        </span><span class="keyword">return</span><span class="normal"> </span><span class="symbol">-</span><span class="number">1</span><span class="symbol">;</span>

<span class="normal">    </span><span class="keyword">if</span><span class="normal"> </span><span class="symbol">(</span><span class="normal">wordsize </span><span class="symbol">==</span><span class="normal"> </span><span class="number">32</span><span class="symbol">)</span>
<span class="normal">        </span><span class="keyword">return</span><span class="normal"> process</span><span class="symbol">&lt;</span><span class="normal">stxxl</span><span class="symbol">::</span><span class="normal">uint32</span><span class="symbol">&gt;(</span><span class="normal">input_filename</span><span class="symbol">,</span><span class="normal"> output_filename</span><span class="symbol">,</span><span class="normal"> sizelimit</span><span class="symbol">,</span>
<span class="normal">                                      text_output_flag</span><span class="symbol">,</span><span class="normal"> check_flag</span><span class="symbol">,</span><span class="normal"> input_verbatim</span><span class="symbol">);</span>
<span class="normal">    </span><span class="keyword">else</span><span class="normal"> </span><span class="keyword">if</span><span class="normal"> </span><span class="symbol">(</span><span class="normal">wordsize </span><span class="symbol">==</span><span class="normal"> </span><span class="number">40</span><span class="symbol">)</span>
<span class="normal">        </span><span class="keyword">return</span><span class="normal"> process</span><span class="symbol">&lt;</span><span class="normal">stxxl</span><span class="symbol">::</span><span class="normal">uint40</span><span class="symbol">&gt;(</span><span class="normal">input_filename</span><span class="symbol">,</span><span class="normal"> output_filename</span><span class="symbol">,</span><span class="normal"> sizelimit</span><span class="symbol">,</span>
<span class="normal">                                      text_output_flag</span><span class="symbol">,</span><span class="normal"> check_flag</span><span class="symbol">,</span><span class="normal"> input_verbatim</span><span class="symbol">);</span>
<span class="normal">    </span><span class="keyword">else</span><span class="normal"> </span><span class="keyword">if</span><span class="normal"> </span><span class="symbol">(</span><span class="normal">wordsize </span><span class="symbol">==</span><span class="normal"> </span><span class="number">64</span><span class="symbol">)</span>
<span class="normal">        </span><span class="keyword">return</span><span class="normal"> process</span><span class="symbol">&lt;</span><span class="normal">stxxl</span><span class="symbol">::</span><span class="normal">uint64</span><span class="symbol">&gt;(</span><span class="normal">input_filename</span><span class="symbol">,</span><span class="normal"> output_filename</span><span class="symbol">,</span><span class="normal"> sizelimit</span><span class="symbol">,</span>
<span class="normal">                                      text_output_flag</span><span class="symbol">,</span><span class="normal"> check_flag</span><span class="symbol">,</span><span class="normal"> input_verbatim</span><span class="symbol">);</span>
<span class="normal">    </span><span class="keyword">else</span>
<span class="normal">        std</span><span class="symbol">::</span><span class="normal">cerr </span><span class="symbol">&lt;&lt;</span><span class="normal"> </span><span class="string">"Invalid wordsize for suffix array: 32, 40 or 64 are allowed."</span><span class="normal"> </span><span class="symbol">&lt;&lt;</span><span class="normal"> std</span><span class="symbol">::</span><span class="normal">endl</span><span class="symbol">;</span>

<span class="normal">    </span><span class="keyword">return</span><span class="normal"> </span><span class="symbol">-</span><span class="number">1</span><span class="symbol">;</span>
<span class="cbracket">}</span>
</tt></pre></div><div style="text-align: right; padding: 8pt; font-size: 12px"><a href="/xmlfeed/weblog-rss20.xml"><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAFAAAAAPAgMAAAAOp6AcAAAADFBMVEVmZmb/ZgD///+JjnlbTUWmAAAACXBIWXMAAABIAAAASABGyWs+AAAACXZwQWcAAABQAAAADwCexKkxAAAAWUlEQVQYlWNgwAa0VmGAFQyqoSCQ/x8J/CBFMCt0ZdTU/F/7/+1HEkydFpoKVPn+93sUlUujQvP/7UcRTAuNDJ2a//s/imDqtKVZofm/1qGYSZk7sfodGwAAiobBJtffoNAAAAAASUVORK5CYII=" alt="RSS 2.0 Weblog Feed" width="80" height="15"/></a> <a href="/xmlfeed/weblog-atom10.xml"><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAFAAAAAPAgMAAAAOp6AcAAAADFBMVEVmZmb/ZgD///+JjnlbTUWmAAAAaklEQVQYlWNgwAa0VmGAFQyqoSCQ/x8J/CBFMDV16rTQ/H/7V//69+//v/3/9oMEI6cuAwr+fv/+/b5d///v//0eJBgWOhMo+Gs9UPAdXDBy6lSYyn9wQZCZS0GCYDPXQcykzJ1Y/Y4NAABKvL80wyoMPgAAAABJRU5ErkJggg==" alt="Atom 1.0 Weblog Feed" width="80" height="15"/></a> <a href="http://validator.w3.org/check?uri=referer"><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAFAAAAAPCAMAAABEF7i9AAAB1FBMVEUHQIgIRY0MN4QNRYoSRYsXUpIYVJQeUpUhWpgjUJMjWpgmU5QnXJkuYZ0uYpwwV5YyZJ4zaKM3ZaA5aaI6aqM6a6E8ZqA8Z6BAbaRBbqdCbaVHd61KSkpKcaZQUFBUf69UgbBVVVVXfq9Yg7NZhbJZh7RagrNeXVxeh7RfjLdgYGBiiLZmZmZnZ2doirhpkbt0m8F3m8B3ncJ5lb55ocR+ocSDgX+Do8eEpMqGhoaHp8iIpMeJjnmJpseKqMeOqsqPsdCQrcyVlZWVsM2Zs9CZtNCfu9ahoaGhuNShudSivNSjtMWjvNSmpqWnpqSrw9qvxNqyxdmyxdyzsK6zs7Ozx9y0xt21yN22tra4y+K80eK/v7/AwMDExMTEy9DH2ejK2+jM2ujN3uvP0dLR0NDR3uvS3uvS3+zU4u3V1dXY2dnY4u7Y4+3b5e/d3d3d5u/d5/De3t7f39/h4uLj4uHj6/Ll7PXm7fTn7/Xo7/Tp7/bq7Ozr6unr8ffw8PDw9vvx9fny+P7z8/Pz9vnz9vv3+fv4+vz5+vz6+vr6+/36/P36///7+/77/Pz7/f37/f78/Pz8/f38/f79/f39/f79/f/9/v79///+/v7+/v////3///+tYR2LAAABKklEQVQ4y2PQoTJg0JlNVYDPQBsyAMTAqaFes8tdsmdPCtA3MDStr3GKKK6myMAprgJ9pcpWs/MlRExYJBvNZLR0sigycHYOV1S7mtjsQJ4gf+HIFPXoWMs6qIGzIRiKZs9GFoEaMRuZhhrYqqJXy8uZYauRxC/VHew7e3YTPAxnI5swG6JxNrKBNjB1EFmIgV0+HA6C8pqqzhXG7BbJJROQIwViMYQ7G2oDQQNn57JyG7kxiCfObrBmS5+BHMuYLkTzMnYDm5WY4lOZZRPKZocxes+aPbuwCFsYohiICLvZsKBAMrDTQ7K/StveU8icTzrOL8JdLpOyWJ49u8Bx9ozw8DY7UYW03hhdxZAOSg2c3jN79rSJs1vSKmfOnpFXNJmynELlvExlAADnaZpLFGEC2wAAAABJRU5ErkJggg==" alt="Valid XHTML 1.1" width="80" height="15"/></a> <a href="http://jigsaw.w3.org/css-validator/check/referer"><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAFAAAAAPCAMAAABEF7i9AAAB1FBMVEUHQIgIRY0MN4QNRYoSRYsXUpIYVJQeUpUhWpgjUJMjWpgmU5QnXJkuYZ0uYpwwV5YyZJ4zaKM3ZaA5aaI6aqM6a6E8ZqA8Z6BAbaRBbqdCbaVHd61KSkpKcaZQUFBUf69UgbBVVVVXfq9Yg7NZhbJZh7RagrNeXVxeh7RfjLdgYGBiiLZmZmZnZ2doirhpkbt0m8F3m8B3ncJ5lb55ocR+ocSDgX+Do8eEpMqGhoaHp8iIpMeJjnmJpseKqMeOqsqPsdCQrcyVlZWVsM2Zs9CZtNCfu9ahoaGhuNShudSivNSjtMWjvNSmpqWnpqSrw9qvxNqyxdmyxdyzsK6zs7Ozx9y0xt21yN22tra4y+K80eK/v7/AwMDExMTEy9DH2ejK2+jM2ujN3uvP0dLR0NDR3uvS3uvS3+zU4u3V1dXY2dnY4u7Y4+3b5e/d3d3d5u/d5/De3t7f39/h4uLj4uHj6/Ll7PXm7fTn7/Xo7/Tp7/bq7Ozr6unr8ffw8PDw9vvx9fny+P7z8/Pz9vnz9vv3+fv4+vz5+vz6+vr6+/36/P36///7+/77/Pz7/f37/f78/Pz8/f38/f79/f39/f79/f/9/v79///+/v7+/v////3///+tYR2LAAABEUlEQVQ4y2PQoTJg0JlNVYDPQBsyAMTAqaFes8tdsmdPCtA3MDStr3GKKK6myMAprgJ9pcpWs/MlRExYJBvNZLR0sigycHYOV1S7mtjsQJ4gf+HIFPXoWMs6mIEQCsIjwhKoga0qerW8nBm2Gkn8Ut3BvrNnN8HCcDYM2cBIogzs8uFwEJTXVHWuMGa3SC6ZgIgUqCEwdxJr4OxcVm4jNwbxxNkN1mzpM2ajGIjsPGK9PLtZiSk+lVk2oWx2GKP3rNmzC4tQwpDoIIQb2Okh2V+lbe8pZM4nHecX4S6XSVksz55d4Dh7Rnh4m52oQlpvjK5iSAelBk7vmT172sTZLWmVM2fPyCuaTFlOoXJepjIAANlljDGY/l5pAAAAAElFTkSuQmCC" alt="Valid CSS (2.1)" width="80" height="15"/></a><br/>Copyright 2005-2018 <a href="/about/">Timo Bingmann</a> - <a href="/about/impressum.html">Impressum</a></div><script type="text/javascript">var _paq = _paq || []; _paq.push(["trackPageView"]); _paq.push(["enableLinkTracking"]);(function() {var u=(("https:" == document.location.protocol) ? "https" : "http") + "://panthema.net/wik-331/"; _paq.push(["setTrackerUrl", u+"js/"]); _paq.push(["setSiteId", "2"]);var d=document, g=d.createElement("script"), s=d.getElementsByTagName("script")[0]; g.type="text/javascript";g.defer=true; g.async=true; g.src=u+"js/"; s.parentNode.insertBefore(g,s);})();</script><noscript><p><img src="http://panthema.net/wik-331/js/?idsite=2&amp;rec=1" style="border:0" alt="" /></p></noscript></body></html>