<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<title>Stxxl: include/stxxl/bits/containers/stack.h Source File</title>

<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="doxygen.css" rel="stylesheet" type="text/css" />

<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>

</head>
<body>
<div id="top"><!-- do not remove this div! -->


<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  
  
  <td style="padding-left: 0.5em;">
   <div id="projectname">Stxxl
   &#160;<span id="projectnumber">1.4.0</span>
   </div>
   
  </td>
  
  
  
 </tr>
 </tbody>
</table>
</div>

<!-- Generated by Doxygen 1.7.6.1 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
      <li><a href="examples.html"><span>Examples</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="files.html"><span>File&#160;List</span></a></li>
      <li><a href="globals.html"><span>File&#160;Members</span></a></li>
    </ul>
  </div>
</div>
<div class="header">
  <div class="headertitle">
<div class="title">include/stxxl/bits/containers/stack.h</div>  </div>
</div><!--header-->
<div class="contents">
<a href="stack_8h.html">Go to the documentation of this file.</a><div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 <span class="comment">/***************************************************************************</span>
<a name="l00002"></a>00002 <span class="comment"> *  include/stxxl/bits/containers/stack.h</span>
<a name="l00003"></a>00003 <span class="comment"> *</span>
<a name="l00004"></a>00004 <span class="comment"> *  Part of the STXXL. See http://stxxl.sourceforge.net</span>
<a name="l00005"></a>00005 <span class="comment"> *</span>
<a name="l00006"></a>00006 <span class="comment"> *  Copyright (C) 2003-2004 Roman Dementiev &lt;dementiev@mpi-sb.mpg.de&gt;</span>
<a name="l00007"></a>00007 <span class="comment"> *  Copyright (C) 2009, 2010 Andreas Beckmann &lt;beckmann@cs.uni-frankfurt.de&gt;</span>
<a name="l00008"></a>00008 <span class="comment"> *</span>
<a name="l00009"></a>00009 <span class="comment"> *  Distributed under the Boost Software License, Version 1.0.</span>
<a name="l00010"></a>00010 <span class="comment"> *  (See accompanying file LICENSE_1_0.txt or copy at</span>
<a name="l00011"></a>00011 <span class="comment"> *  http://www.boost.org/LICENSE_1_0.txt)</span>
<a name="l00012"></a>00012 <span class="comment"> **************************************************************************/</span>
<a name="l00013"></a>00013 
<a name="l00014"></a>00014 <span class="preprocessor">#ifndef STXXL_STACK_HEADER</span>
<a name="l00015"></a>00015 <span class="preprocessor"></span><span class="preprocessor">#define STXXL_STACK_HEADER</span>
<a name="l00016"></a>00016 <span class="preprocessor"></span>
<a name="l00017"></a>00017 <span class="preprocessor">#include &lt;stack&gt;</span>
<a name="l00018"></a>00018 <span class="preprocessor">#include &lt;vector&gt;</span>
<a name="l00019"></a>00019 
<a name="l00020"></a>00020 <span class="preprocessor">#include &lt;stxxl/bits/deprecated.h&gt;</span>
<a name="l00021"></a>00021 <span class="preprocessor">#include &lt;<a class="code" href="request__operations_8h.html">stxxl/bits/io/request_operations.h</a>&gt;</span>
<a name="l00022"></a>00022 <span class="preprocessor">#include &lt;<a class="code" href="mng_8h.html">stxxl/bits/mng/mng.h</a>&gt;</span>
<a name="l00023"></a>00023 <span class="preprocessor">#include &lt;<a class="code" href="typed__block_8h.html">stxxl/bits/mng/typed_block.h</a>&gt;</span>
<a name="l00024"></a>00024 <span class="preprocessor">#include &lt;<a class="code" href="simple__vector_8h.html">stxxl/bits/common/simple_vector.h</a>&gt;</span>
<a name="l00025"></a>00025 <span class="preprocessor">#include &lt;<a class="code" href="tmeta_8h.html">stxxl/bits/common/tmeta.h</a>&gt;</span>
<a name="l00026"></a>00026 <span class="preprocessor">#include &lt;<a class="code" href="read__write__pool_8h.html">stxxl/bits/mng/read_write_pool.h</a>&gt;</span>
<a name="l00027"></a>00027 <span class="preprocessor">#include &lt;<a class="code" href="write__pool_8h.html">stxxl/bits/mng/write_pool.h</a>&gt;</span>
<a name="l00028"></a>00028 <span class="preprocessor">#include &lt;<a class="code" href="prefetch__pool_8h.html">stxxl/bits/mng/prefetch_pool.h</a>&gt;</span>
<a name="l00029"></a>00029 
<a name="l00030"></a>00030 
<a name="l00031"></a>00031 __STXXL_BEGIN_NAMESPACE
<a name="l00032"></a>00032 <span class="comment"></span>
<a name="l00033"></a>00033 <span class="comment">//! \addtogroup stlcontinternals</span>
<a name="l00034"></a>00034 <span class="comment">//! \{</span>
<a name="l00035"></a>00035 <span class="comment"></span>
<a name="l00036"></a>00036 <span class="keyword">template</span> &lt;<span class="keyword">class </span>ValTp,
<a name="l00037"></a>00037           <span class="keywordtype">unsigned</span> BlocksPerPage = 4,
<a name="l00038"></a>00038           <span class="keywordtype">unsigned</span> BlkSz = <a class="code" href="group__mnglayer.html#ga3c3f065b2005cecc00e52f1e397be532">STXXL_DEFAULT_BLOCK_SIZE</a>(ValTp),
<a name="l00039"></a>00039           <span class="keyword">class </span>AllocStr = <a class="code" href="group__alloc.html#ga7156e0a94c76f1be7aa15af04cee9580">STXXL_DEFAULT_ALLOC_STRATEGY</a>,
<a name="l00040"></a>00040           <span class="keyword">class </span>SzTp = <a class="code" href="namespacestxxl.html#ad7f9125156ce2d31af5283aa66568f0d">stxxl::int64</a>&gt;
<a name="l00041"></a><a class="code" href="structstxxl_1_1stack__config__generator.html">00041</a> <span class="keyword">struct </span><a class="code" href="structstxxl_1_1stack__config__generator.html">stack_config_generator</a>
<a name="l00042"></a>00042 {
<a name="l00043"></a><a class="code" href="structstxxl_1_1stack__config__generator.html#a660056675d7b04ea091920e66067a8c3">00043</a>     <span class="keyword">typedef</span> ValTp <a class="code" href="structstxxl_1_1stack__config__generator.html#a660056675d7b04ea091920e66067a8c3">value_type</a>;
<a name="l00044"></a><a class="code" href="structstxxl_1_1stack__config__generator.html#ac8b84825cf53bd8e9b87cc1fbe529feeaa62fa5b70f38cf43af3c572c06f917d7">00044</a>     <span class="keyword">enum</span> { blocks_per_page = BlocksPerPage };
<a name="l00045"></a><a class="code" href="structstxxl_1_1stack__config__generator.html#ac88f83db3a42f05d432aeec4c3cd43db">00045</a>     <span class="keyword">typedef</span> AllocStr <a class="code" href="structstxxl_1_1stack__config__generator.html#ac88f83db3a42f05d432aeec4c3cd43db">alloc_strategy</a>;
<a name="l00046"></a><a class="code" href="structstxxl_1_1stack__config__generator.html#aadc7365d233b7a67e06d388c41961760a4f6e067e54e9f333ca20edcb062f1451">00046</a>     <span class="keyword">enum</span> { <a class="code" href="test__stream_8cpp.html#a9766f5ceca5e25981858ec7384456072">block_size</a> = BlkSz };
<a name="l00047"></a><a class="code" href="structstxxl_1_1stack__config__generator.html#aa1a9359f871519546ea222230e222aec">00047</a>     <span class="keyword">typedef</span> SzTp <a class="code" href="structstxxl_1_1stack__config__generator.html#aa1a9359f871519546ea222230e222aec">size_type</a>;
<a name="l00048"></a>00048 };
<a name="l00049"></a>00049 
<a name="l00050"></a>00050 <span class="comment"></span>
<a name="l00051"></a>00051 <span class="comment">//! \brief External stack container</span>
<a name="l00052"></a>00052 <span class="comment"></span><span class="comment"></span>
<a name="l00053"></a>00053 <span class="comment">//! Conservative implementation. Fits best if your access pattern consists of irregularly mixed</span>
<a name="l00054"></a>00054 <span class="comment">//! push&#39;es and pop&#39;s.</span>
<a name="l00055"></a>00055 <span class="comment">//! For semantics of the methods see documentation of the STL \c std::stack. &lt;BR&gt;</span>
<a name="l00056"></a>00056 <span class="comment">//! To gain full bandwidth of disks \c Config_::BlocksPerPage must &gt;= number of disks &lt;BR&gt;</span>
<a name="l00057"></a>00057 <span class="comment">//! \internal</span>
<a name="l00058"></a>00058 <span class="comment"></span><span class="keyword">template</span> &lt;<span class="keyword">class</span> Config_&gt;
<a name="l00059"></a><a class="code" href="classstxxl_1_1normal__stack.html">00059</a> <span class="keyword">class </span><a class="code" href="classstxxl_1_1normal__stack.html" title="External stack container.">normal_stack</a> : <span class="keyword">private</span> <a class="code" href="classnoncopyable.html">noncopyable</a>
<a name="l00060"></a>00060 {
<a name="l00061"></a>00061 <span class="keyword">public</span>:
<a name="l00062"></a><a class="code" href="classstxxl_1_1normal__stack.html#ae606e4ca63882a4604ddb0de7b37fb2e">00062</a>     <span class="keyword">typedef</span> Config_ <a class="code" href="classstxxl_1_1normal__stack.html#ae606e4ca63882a4604ddb0de7b37fb2e">cfg</a>;
<a name="l00063"></a><a class="code" href="classstxxl_1_1normal__stack.html#ad8ebc3ef28c9bb6add8242b40988768e">00063</a>     <span class="keyword">typedef</span> <span class="keyword">typename</span> <a class="code" href="test__push__sort_8cpp.html#ab13c28f7d568dcb8636b7a10c0a609a1">cfg::value_type</a> <a class="code" href="classstxxl_1_1normal__stack.html#ad8ebc3ef28c9bb6add8242b40988768e">value_type</a>;
<a name="l00064"></a><a class="code" href="classstxxl_1_1normal__stack.html#a408e7adf1ccd2e7854c55ec4d0053ee8">00064</a>     <span class="keyword">typedef</span> <span class="keyword">typename</span> cfg::alloc_strategy <a class="code" href="classstxxl_1_1normal__stack.html#a408e7adf1ccd2e7854c55ec4d0053ee8">alloc_strategy_type</a>;
<a name="l00065"></a><a class="code" href="classstxxl_1_1normal__stack.html#a1f3ca4b47b16025ebd87ca303fa431e0">00065</a>     <span class="keyword">typedef</span> <span class="keyword">typename</span> cfg::size_type <a class="code" href="classstxxl_1_1normal__stack.html#a1f3ca4b47b16025ebd87ca303fa431e0">size_type</a>;
<a name="l00066"></a>00066     <span class="keyword">enum</span> {
<a name="l00067"></a><a class="code" href="classstxxl_1_1normal__stack.html#a5c7664e4cf5728949a9d819e23fc7325aaa0024fa28e1fbbf4d525b92073bf1e6">00067</a>         blocks_per_page = cfg::blocks_per_page,
<a name="l00068"></a><a class="code" href="classstxxl_1_1normal__stack.html#a5c7664e4cf5728949a9d819e23fc7325ab2d5230c9cd74f6c54e06b6750d39366">00068</a>         <a class="code" href="test__stream_8cpp.html#a9766f5ceca5e25981858ec7384456072">block_size</a> = <a class="code" href="test__stream_8cpp.html#a9766f5ceca5e25981858ec7384456072">cfg::block_size</a>
<a name="l00069"></a>00069     };
<a name="l00070"></a>00070 
<a name="l00071"></a><a class="code" href="classstxxl_1_1normal__stack.html#a982e116ce55e9d167614379399a22943">00071</a>     <span class="keyword">typedef</span> <a class="code" href="classstxxl_1_1typed__block.html" title="Block containing elements of fixed length.">typed_block&lt;block_size, value_type&gt;</a> <a class="code" href="classstxxl_1_1normal__stack.html#a982e116ce55e9d167614379399a22943">block_type</a>;
<a name="l00072"></a><a class="code" href="classstxxl_1_1normal__stack.html#ac67b8ca0226fa0840865423ceecf58c2">00072</a>     <span class="keyword">typedef</span> <a class="code" href="structstxxl_1_1BID.html" title="Block identifier class.">BID&lt;block_size&gt;</a> <a class="code" href="classstxxl_1_1normal__stack.html#ac67b8ca0226fa0840865423ceecf58c2">bid_type</a>;
<a name="l00073"></a>00073 
<a name="l00074"></a>00074 <span class="keyword">private</span>:
<a name="l00075"></a><a class="code" href="classstxxl_1_1normal__stack.html#a063e2b96b0dd93660e0426ec18f7bfef">00075</a>     <a class="code" href="classstxxl_1_1normal__stack.html#a1f3ca4b47b16025ebd87ca303fa431e0">size_type</a> <a class="code" href="classstxxl_1_1normal__stack.html#a063e2b96b0dd93660e0426ec18f7bfef">size_</a>;
<a name="l00076"></a><a class="code" href="classstxxl_1_1normal__stack.html#a306739acc71ed7b53bf1cad98b68d18d">00076</a>     <a class="code" href="namespacestxxl.html#a7501995ff616f0144a8bda727c266d1b">unsigned_type</a> <a class="code" href="classstxxl_1_1normal__stack.html#a306739acc71ed7b53bf1cad98b68d18d">cache_offset</a>;
<a name="l00077"></a><a class="code" href="classstxxl_1_1normal__stack.html#ac4fc9cc6d7db17823e673dd76650ad22">00077</a>     <a class="code" href="classstxxl_1_1normal__stack.html#ad8ebc3ef28c9bb6add8242b40988768e">value_type</a> * <a class="code" href="classstxxl_1_1normal__stack.html#ac4fc9cc6d7db17823e673dd76650ad22">current_element</a>;
<a name="l00078"></a><a class="code" href="classstxxl_1_1normal__stack.html#a76f56a5c8833a454d0aa88f5c51d554d">00078</a>     <a class="code" href="classstxxl_1_1simple__vector.html">simple_vector&lt;block_type&gt;</a> <a class="code" href="classstxxl_1_1normal__stack.html#a76f56a5c8833a454d0aa88f5c51d554d">cache</a>;
<a name="l00079"></a><a class="code" href="classstxxl_1_1normal__stack.html#ad1c2960b073fba85c39e130c437a653a">00079</a>     <span class="keyword">typename</span> <a class="code" href="classstxxl_1_1simple__vector.html">simple_vector&lt;block_type&gt;::iterator</a> <a class="code" href="classstxxl_1_1normal__stack.html#ad1c2960b073fba85c39e130c437a653a">front_page</a>;
<a name="l00080"></a><a class="code" href="classstxxl_1_1normal__stack.html#a31382cc1c4b44545aec481777912e3c0">00080</a>     <span class="keyword">typename</span> <a class="code" href="classstxxl_1_1simple__vector.html">simple_vector&lt;block_type&gt;::iterator</a> <a class="code" href="classstxxl_1_1normal__stack.html#a31382cc1c4b44545aec481777912e3c0">back_page</a>;
<a name="l00081"></a><a class="code" href="classstxxl_1_1normal__stack.html#a1eb114b6ac1f9af6a226a37dfc6f0132">00081</a>     std::vector&lt;bid_type&gt; <a class="code" href="classstxxl_1_1normal__stack.html#a1eb114b6ac1f9af6a226a37dfc6f0132">bids</a>;
<a name="l00082"></a><a class="code" href="classstxxl_1_1normal__stack.html#a022d7684780b985960b874648a0f78e1">00082</a>     <a class="code" href="classstxxl_1_1normal__stack.html#a408e7adf1ccd2e7854c55ec4d0053ee8">alloc_strategy_type</a> <a class="code" href="classstxxl_1_1normal__stack.html#a022d7684780b985960b874648a0f78e1">alloc_strategy</a>;
<a name="l00083"></a>00083 
<a name="l00084"></a>00084 <span class="keyword">public</span>:
<a name="l00085"></a><a class="code" href="classstxxl_1_1normal__stack.html#aceedb0b4482e9d8c8ca2d14b70262460">00085</a>     <a class="code" href="classstxxl_1_1normal__stack.html" title="External stack container.">normal_stack</a>() :
<a name="l00086"></a>00086         size_(0),
<a name="l00087"></a>00087         cache_offset(0),
<a name="l00088"></a>00088         current_element(NULL),
<a name="l00089"></a>00089         cache(blocks_per_page * 2),
<a name="l00090"></a>00090         front_page(cache.begin() + blocks_per_page),
<a name="l00091"></a>00091         back_page(cache.begin()),
<a name="l00092"></a>00092         bids(0)
<a name="l00093"></a>00093     {
<a name="l00094"></a>00094         bids.reserve(blocks_per_page);
<a name="l00095"></a>00095     }
<a name="l00096"></a>00096 
<a name="l00097"></a><a class="code" href="classstxxl_1_1normal__stack.html#aa4a654520a95598ee768a77a6e6e6bfc">00097</a>     <span class="keywordtype">void</span> <a class="code" href="namespacestd.html#abc5bd04888275546472a3a5b813fe030">swap</a>(<a class="code" href="classstxxl_1_1normal__stack.html" title="External stack container.">normal_stack</a> &amp; obj)
<a name="l00098"></a>00098     {
<a name="l00099"></a>00099         <a class="code" href="namespacestd.html#abc5bd04888275546472a3a5b813fe030">std::swap</a>(size_, obj.<a class="code" href="classstxxl_1_1normal__stack.html#a063e2b96b0dd93660e0426ec18f7bfef">size_</a>);
<a name="l00100"></a>00100         <a class="code" href="namespacestd.html#abc5bd04888275546472a3a5b813fe030">std::swap</a>(cache_offset, obj.<a class="code" href="classstxxl_1_1normal__stack.html#a306739acc71ed7b53bf1cad98b68d18d">cache_offset</a>);
<a name="l00101"></a>00101         <a class="code" href="namespacestd.html#abc5bd04888275546472a3a5b813fe030">std::swap</a>(current_element, obj.<a class="code" href="classstxxl_1_1normal__stack.html#ac4fc9cc6d7db17823e673dd76650ad22">current_element</a>);
<a name="l00102"></a>00102         <a class="code" href="namespacestd.html#abc5bd04888275546472a3a5b813fe030">std::swap</a>(cache, obj.<a class="code" href="classstxxl_1_1normal__stack.html#a76f56a5c8833a454d0aa88f5c51d554d">cache</a>);
<a name="l00103"></a>00103         <a class="code" href="namespacestd.html#abc5bd04888275546472a3a5b813fe030">std::swap</a>(front_page, obj.<a class="code" href="classstxxl_1_1normal__stack.html#ad1c2960b073fba85c39e130c437a653a">front_page</a>);
<a name="l00104"></a>00104         <a class="code" href="namespacestd.html#abc5bd04888275546472a3a5b813fe030">std::swap</a>(back_page, obj.<a class="code" href="classstxxl_1_1normal__stack.html#a31382cc1c4b44545aec481777912e3c0">back_page</a>);
<a name="l00105"></a>00105         <a class="code" href="namespacestd.html#abc5bd04888275546472a3a5b813fe030">std::swap</a>(bids, obj.<a class="code" href="classstxxl_1_1normal__stack.html#a1eb114b6ac1f9af6a226a37dfc6f0132">bids</a>);
<a name="l00106"></a>00106         <a class="code" href="namespacestd.html#abc5bd04888275546472a3a5b813fe030">std::swap</a>(alloc_strategy, obj.<a class="code" href="classstxxl_1_1normal__stack.html#a022d7684780b985960b874648a0f78e1">alloc_strategy</a>);
<a name="l00107"></a>00107     }
<a name="l00108"></a>00108 <span class="comment"></span>
<a name="l00109"></a>00109 <span class="comment">    //! \brief Construction from a stack</span>
<a name="l00110"></a>00110 <span class="comment">    //! \param stack_ stack object (could be external or internal, important is that it must</span>
<a name="l00111"></a>00111 <span class="comment">    //! have a copy constructor, \c top() and \c pop() methods )</span>
<a name="l00112"></a>00112 <span class="comment"></span>    <span class="keyword">template</span> &lt;<span class="keyword">class</span> stack_type&gt;
<a name="l00113"></a><a class="code" href="classstxxl_1_1normal__stack.html#a67e1bada5d12fbc3362b99f19255945d">00113</a>     <a class="code" href="classstxxl_1_1normal__stack.html" title="External stack container.">normal_stack</a>(<span class="keyword">const</span> stack_type &amp; stack_) :
<a name="l00114"></a>00114         size_(0),
<a name="l00115"></a>00115         cache_offset(0),
<a name="l00116"></a>00116         current_element(NULL),
<a name="l00117"></a>00117         cache(blocks_per_page * 2),
<a name="l00118"></a>00118         front_page(cache.begin() + blocks_per_page),
<a name="l00119"></a>00119         back_page(cache.begin()),
<a name="l00120"></a>00120         bids(0)
<a name="l00121"></a>00121     {
<a name="l00122"></a>00122         bids.reserve(blocks_per_page);
<a name="l00123"></a>00123 
<a name="l00124"></a>00124         stack_type stack_copy = stack_;
<a name="l00125"></a>00125         <span class="keyword">const</span> <a class="code" href="classstxxl_1_1normal__stack.html#a1f3ca4b47b16025ebd87ca303fa431e0">size_type</a> sz = stack_copy.size();
<a name="l00126"></a>00126         <a class="code" href="classstxxl_1_1normal__stack.html#a1f3ca4b47b16025ebd87ca303fa431e0">size_type</a> i;
<a name="l00127"></a>00127 
<a name="l00128"></a>00128         std::vector&lt;value_type&gt; tmp(sz);
<a name="l00129"></a>00129 
<a name="l00130"></a>00130         <span class="keywordflow">for</span> (i = 0; i &lt; sz; ++i)
<a name="l00131"></a>00131         {
<a name="l00132"></a>00132             tmp[sz - i - 1] = stack_copy.top();
<a name="l00133"></a>00133             stack_copy.pop();
<a name="l00134"></a>00134         }
<a name="l00135"></a>00135         <span class="keywordflow">for</span> (i = 0; i &lt; sz; ++i)
<a name="l00136"></a>00136             this-&gt;push(tmp[i]);
<a name="l00137"></a>00137     }
<a name="l00138"></a><a class="code" href="classstxxl_1_1normal__stack.html#a3a37d57351da95cf095a95f110ed091d">00138</a>     <span class="keyword">virtual</span> ~<a class="code" href="classstxxl_1_1normal__stack.html" title="External stack container.">normal_stack</a>()
<a name="l00139"></a>00139     {
<a name="l00140"></a>00140         STXXL_VERBOSE(<a class="code" href="error__handling_8h.html#a644b6fe4d8310052a019e7f68c916bd5">STXXL_PRETTY_FUNCTION_NAME</a>);
<a name="l00141"></a>00141         block_manager::get_instance()-&gt;delete_blocks(bids.begin(), bids.end());
<a name="l00142"></a>00142     }
<a name="l00143"></a><a class="code" href="classstxxl_1_1normal__stack.html#a22b0ca7999287cb1e626af596c9f6006">00143</a>     <a class="code" href="classstxxl_1_1normal__stack.html#a1f3ca4b47b16025ebd87ca303fa431e0">size_type</a> size()<span class="keyword"> const</span>
<a name="l00144"></a>00144 <span class="keyword">    </span>{
<a name="l00145"></a>00145         <span class="keywordflow">return</span> size_;
<a name="l00146"></a>00146     }
<a name="l00147"></a><a class="code" href="classstxxl_1_1normal__stack.html#a5aa0642083a17d9215a7b396da886969">00147</a>     <span class="keywordtype">bool</span> empty()<span class="keyword"> const</span>
<a name="l00148"></a>00148 <span class="keyword">    </span>{
<a name="l00149"></a>00149         <span class="keywordflow">return</span> (!size_);
<a name="l00150"></a>00150     }
<a name="l00151"></a><a class="code" href="classstxxl_1_1normal__stack.html#a82dd89d3ba211d72f15c9ceee4283931">00151</a>     <a class="code" href="classstxxl_1_1normal__stack.html#ad8ebc3ef28c9bb6add8242b40988768e">value_type</a> &amp; top()
<a name="l00152"></a>00152     {
<a name="l00153"></a>00153         assert(size_ &gt; 0);
<a name="l00154"></a>00154         <span class="keywordflow">return</span> (*current_element);
<a name="l00155"></a>00155     }
<a name="l00156"></a><a class="code" href="classstxxl_1_1normal__stack.html#a305c7073e09823424d2d2a12a975dcd9">00156</a>     <span class="keyword">const</span> <a class="code" href="classstxxl_1_1normal__stack.html#ad8ebc3ef28c9bb6add8242b40988768e">value_type</a> &amp; top()<span class="keyword"> const</span>
<a name="l00157"></a>00157 <span class="keyword">    </span>{
<a name="l00158"></a>00158         assert(size_ &gt; 0);
<a name="l00159"></a>00159         <span class="keywordflow">return</span> (*current_element);
<a name="l00160"></a>00160     }
<a name="l00161"></a><a class="code" href="classstxxl_1_1normal__stack.html#a15fd18a40c0f875958cf025a5b921a9c">00161</a>     <span class="keywordtype">void</span> push(<span class="keyword">const</span> <a class="code" href="classstxxl_1_1normal__stack.html#ad8ebc3ef28c9bb6add8242b40988768e">value_type</a> &amp; val)
<a name="l00162"></a>00162     {
<a name="l00163"></a>00163         assert(cache_offset &lt;= 2 * blocks_per_page * block_type::size);
<a name="l00164"></a>00164         <span class="comment">//assert(cache_offset &gt;= 0);</span>
<a name="l00165"></a>00165 
<a name="l00166"></a>00166         <span class="keywordflow">if</span> (<a class="code" href="utils_8h.html#a21c2be1ee56688a6f485ab194b697da7">UNLIKELY</a>(cache_offset == 2 * blocks_per_page * block_type::size))  <span class="comment">// cache overflow</span>
<a name="l00167"></a>00167         {
<a name="l00168"></a>00168             STXXL_VERBOSE2(<span class="stringliteral">&quot;growing, size: &quot;</span> &lt;&lt; size_);
<a name="l00169"></a>00169 
<a name="l00170"></a>00170             bids.resize(bids.size() + blocks_per_page);
<a name="l00171"></a>00171             <span class="keyword">typename</span> std::vector&lt;bid_type&gt;::iterator cur_bid = bids.end() - blocks_per_page;
<a name="l00172"></a>00172             block_manager::get_instance()-&gt;new_blocks(alloc_strategy, cur_bid, bids.end(), cur_bid - bids.begin());
<a name="l00173"></a>00173 
<a name="l00174"></a>00174             <a class="code" href="classstxxl_1_1simple__vector.html">simple_vector&lt;request_ptr&gt;</a> requests(blocks_per_page);
<a name="l00175"></a>00175 
<a name="l00176"></a>00176             <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; blocks_per_page; ++i, ++cur_bid)
<a name="l00177"></a>00177             {
<a name="l00178"></a>00178                 requests[i] = (back_page + i)-&gt;write(*cur_bid);
<a name="l00179"></a>00179             }
<a name="l00180"></a>00180 
<a name="l00181"></a>00181 
<a name="l00182"></a>00182             <a class="code" href="namespacestd.html#abc5bd04888275546472a3a5b813fe030">std::swap</a>(back_page, front_page);
<a name="l00183"></a>00183 
<a name="l00184"></a>00184             bids.reserve(bids.size() + blocks_per_page);
<a name="l00185"></a>00185 
<a name="l00186"></a>00186             cache_offset = blocks_per_page * block_type::size + 1;
<a name="l00187"></a>00187             current_element = &amp;((*front_page)[0]);
<a name="l00188"></a>00188             ++size_;
<a name="l00189"></a>00189 
<a name="l00190"></a>00190             <a class="code" href="group__iolayer.html#gadc535a096b5d4c8f84deb03c786ec807" title="Collection of functions to track statuses of a number of requests.">wait_all</a>(requests.<a class="code" href="classstxxl_1_1simple__vector.html#a6fb4d4417e8ecb2119162839f854e9ed">begin</a>(), blocks_per_page);
<a name="l00191"></a>00191 
<a name="l00192"></a>00192             *current_element = val;
<a name="l00193"></a>00193 
<a name="l00194"></a>00194             <span class="keywordflow">return</span>;
<a name="l00195"></a>00195         }
<a name="l00196"></a>00196 
<a name="l00197"></a>00197         current_element = element(cache_offset);
<a name="l00198"></a>00198         *current_element = val;
<a name="l00199"></a>00199         ++size_;
<a name="l00200"></a>00200         ++cache_offset;
<a name="l00201"></a>00201     }
<a name="l00202"></a><a class="code" href="classstxxl_1_1normal__stack.html#a31dcdb36be24153cff1c0901ff90c727">00202</a>     <span class="keywordtype">void</span> <a class="code" href="namespacestxxl.html#a9af38b0acb1d1b4b50c5a4f3a3db8c46">pop</a>()
<a name="l00203"></a>00203     {
<a name="l00204"></a>00204         assert(cache_offset &lt;= 2 * blocks_per_page * block_type::size);
<a name="l00205"></a>00205         assert(cache_offset &gt; 0);
<a name="l00206"></a>00206         assert(size_ &gt; 0);
<a name="l00207"></a>00207 
<a name="l00208"></a>00208         <span class="keywordflow">if</span> (<a class="code" href="utils_8h.html#a21c2be1ee56688a6f485ab194b697da7">UNLIKELY</a>(cache_offset == 1 &amp;&amp; bids.size() &gt;= blocks_per_page))
<a name="l00209"></a>00209         {
<a name="l00210"></a>00210             STXXL_VERBOSE2(<span class="stringliteral">&quot;shrinking, size: &quot;</span> &lt;&lt; size_);
<a name="l00211"></a>00211 
<a name="l00212"></a>00212             <a class="code" href="classstxxl_1_1simple__vector.html">simple_vector&lt;request_ptr&gt;</a> requests(blocks_per_page);
<a name="l00213"></a>00213 
<a name="l00214"></a>00214             {
<a name="l00215"></a>00215                 <span class="keyword">typename</span> std::vector&lt;bid_type&gt;::const_iterator cur_bid = bids.end();
<a name="l00216"></a>00216                 <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = blocks_per_page - 1; i &gt;= 0; --i)
<a name="l00217"></a>00217                 {
<a name="l00218"></a>00218                     requests[i] = (front_page + i)-&gt;read(*(--cur_bid));
<a name="l00219"></a>00219                 }
<a name="l00220"></a>00220             }
<a name="l00221"></a>00221 
<a name="l00222"></a>00222             <a class="code" href="namespacestd.html#abc5bd04888275546472a3a5b813fe030">std::swap</a>(front_page, back_page);
<a name="l00223"></a>00223 
<a name="l00224"></a>00224             cache_offset = blocks_per_page * block_type::size;
<a name="l00225"></a>00225             --size_;
<a name="l00226"></a>00226             current_element = &amp;((*(back_page + (blocks_per_page - 1)))[block_type::size - 1]);
<a name="l00227"></a>00227 
<a name="l00228"></a>00228             <a class="code" href="group__iolayer.html#gadc535a096b5d4c8f84deb03c786ec807" title="Collection of functions to track statuses of a number of requests.">wait_all</a>(requests.<a class="code" href="classstxxl_1_1simple__vector.html#a6fb4d4417e8ecb2119162839f854e9ed">begin</a>(), blocks_per_page);
<a name="l00229"></a>00229 
<a name="l00230"></a>00230             block_manager::get_instance()-&gt;delete_blocks(bids.end() - blocks_per_page, bids.end());
<a name="l00231"></a>00231             bids.resize(bids.size() - blocks_per_page);
<a name="l00232"></a>00232 
<a name="l00233"></a>00233             <span class="keywordflow">return</span>;
<a name="l00234"></a>00234         }
<a name="l00235"></a>00235 
<a name="l00236"></a>00236         --size_;
<a name="l00237"></a>00237 
<a name="l00238"></a>00238         current_element = element((--cache_offset) - 1);
<a name="l00239"></a>00239     }
<a name="l00240"></a>00240 
<a name="l00241"></a>00241 <span class="keyword">private</span>:
<a name="l00242"></a><a class="code" href="classstxxl_1_1normal__stack.html#ad74053ef827058de057551a9b0721508">00242</a>     <a class="code" href="classstxxl_1_1normal__stack.html#ad8ebc3ef28c9bb6add8242b40988768e">value_type</a> * element(<a class="code" href="namespacestxxl.html#a7501995ff616f0144a8bda727c266d1b">unsigned_type</a> offset)
<a name="l00243"></a>00243     {
<a name="l00244"></a>00244         <span class="keywordflow">if</span> (offset &lt; blocks_per_page * block_type::size)
<a name="l00245"></a>00245             <span class="keywordflow">return</span> &amp;((*(back_page + offset / block_type::size))[offset % block_type::size]);
<a name="l00246"></a>00246 
<a name="l00247"></a>00247 
<a name="l00248"></a>00248         <a class="code" href="namespacestxxl.html#a7501995ff616f0144a8bda727c266d1b">unsigned_type</a> unbiased_offset = offset - blocks_per_page * block_type::size;
<a name="l00249"></a>00249         <span class="keywordflow">return</span> &amp;((*(front_page + unbiased_offset / block_type::size))[unbiased_offset % block_type::size]);
<a name="l00250"></a>00250     }
<a name="l00251"></a>00251 };
<a name="l00252"></a>00252 
<a name="l00253"></a>00253 <span class="comment"></span>
<a name="l00254"></a>00254 <span class="comment">//! \brief Efficient implementation that uses prefetching and overlapping using internal buffers</span>
<a name="l00255"></a>00255 <span class="comment"></span><span class="comment"></span>
<a name="l00256"></a>00256 <span class="comment">//! Use it if your access pattern consists of many repeated push&#39;es and pop&#39;s</span>
<a name="l00257"></a>00257 <span class="comment">//! For semantics of the methods see documentation of the STL \c std::stack.</span>
<a name="l00258"></a>00258 <span class="comment">//! \warning The amortized complexity of operation is not O(1/DB), rather O(DB)</span>
<a name="l00259"></a>00259 <span class="comment"></span><span class="keyword">template</span> &lt;<span class="keyword">class</span> Config_&gt;
<a name="l00260"></a><a class="code" href="classstxxl_1_1grow__shrink__stack.html">00260</a> <span class="keyword">class </span><a class="code" href="classstxxl_1_1grow__shrink__stack.html" title="Efficient implementation that uses prefetching and overlapping using internal buffers.">grow_shrink_stack</a> : <span class="keyword">private</span> <a class="code" href="classnoncopyable.html">noncopyable</a>
<a name="l00261"></a>00261 {
<a name="l00262"></a>00262 <span class="keyword">public</span>:
<a name="l00263"></a><a class="code" href="classstxxl_1_1grow__shrink__stack.html#a90cbba855185d3c13ce7431cbb55ae9d">00263</a>     <span class="keyword">typedef</span> Config_ <a class="code" href="classstxxl_1_1grow__shrink__stack.html#a90cbba855185d3c13ce7431cbb55ae9d">cfg</a>;
<a name="l00264"></a><a class="code" href="classstxxl_1_1grow__shrink__stack.html#a27a9a90b15c75fefeff168a80f3cb966">00264</a>     <span class="keyword">typedef</span> <span class="keyword">typename</span> <a class="code" href="test__push__sort_8cpp.html#ab13c28f7d568dcb8636b7a10c0a609a1">cfg::value_type</a> <a class="code" href="classstxxl_1_1grow__shrink__stack.html#a27a9a90b15c75fefeff168a80f3cb966">value_type</a>;
<a name="l00265"></a><a class="code" href="classstxxl_1_1grow__shrink__stack.html#a6a48b3bccab520d49284d04623c21e06">00265</a>     <span class="keyword">typedef</span> <span class="keyword">typename</span> cfg::alloc_strategy <a class="code" href="classstxxl_1_1grow__shrink__stack.html#a6a48b3bccab520d49284d04623c21e06">alloc_strategy_type</a>;
<a name="l00266"></a><a class="code" href="classstxxl_1_1grow__shrink__stack.html#a8805e990141e1a95451509313eebe533">00266</a>     <span class="keyword">typedef</span> <span class="keyword">typename</span> cfg::size_type <a class="code" href="classstxxl_1_1grow__shrink__stack.html#a8805e990141e1a95451509313eebe533">size_type</a>;
<a name="l00267"></a>00267     <span class="keyword">enum</span> {
<a name="l00268"></a><a class="code" href="classstxxl_1_1grow__shrink__stack.html#a49ea6c1d15e1410b8bd8dd685ea676aeae31e70fd5cd523442da1ea2f7f517a30">00268</a>         blocks_per_page = cfg::blocks_per_page,
<a name="l00269"></a><a class="code" href="classstxxl_1_1grow__shrink__stack.html#a49ea6c1d15e1410b8bd8dd685ea676aea731ec784780bc7e6e50afb4695a60a1f">00269</a>         <a class="code" href="test__stream_8cpp.html#a9766f5ceca5e25981858ec7384456072">block_size</a> = <a class="code" href="test__stream_8cpp.html#a9766f5ceca5e25981858ec7384456072">cfg::block_size</a>,
<a name="l00270"></a>00270     };
<a name="l00271"></a>00271 
<a name="l00272"></a><a class="code" href="classstxxl_1_1grow__shrink__stack.html#af77cba64fe3f8944761688719dfbee6f">00272</a>     <span class="keyword">typedef</span> <a class="code" href="classstxxl_1_1typed__block.html" title="Block containing elements of fixed length.">typed_block&lt;block_size, value_type&gt;</a> <a class="code" href="classstxxl_1_1grow__shrink__stack.html#af77cba64fe3f8944761688719dfbee6f">block_type</a>;
<a name="l00273"></a><a class="code" href="classstxxl_1_1grow__shrink__stack.html#a19a9436e7c099596176f4d9df640492f">00273</a>     <span class="keyword">typedef</span> <a class="code" href="structstxxl_1_1BID.html" title="Block identifier class.">BID&lt;block_size&gt;</a> <a class="code" href="classstxxl_1_1grow__shrink__stack.html#a19a9436e7c099596176f4d9df640492f">bid_type</a>;
<a name="l00274"></a>00274 
<a name="l00275"></a>00275 <span class="keyword">private</span>:
<a name="l00276"></a><a class="code" href="classstxxl_1_1grow__shrink__stack.html#a1817e315e8a9f293e2d508019587116c">00276</a>     <a class="code" href="classstxxl_1_1grow__shrink__stack.html#a8805e990141e1a95451509313eebe533">size_type</a> <a class="code" href="classstxxl_1_1grow__shrink__stack.html#a1817e315e8a9f293e2d508019587116c">size_</a>;
<a name="l00277"></a><a class="code" href="classstxxl_1_1grow__shrink__stack.html#a42d8da12073f9fd73740a0831139fe48">00277</a>     <a class="code" href="namespacestxxl.html#a7501995ff616f0144a8bda727c266d1b">unsigned_type</a> <a class="code" href="classstxxl_1_1grow__shrink__stack.html#a42d8da12073f9fd73740a0831139fe48">cache_offset</a>;
<a name="l00278"></a><a class="code" href="classstxxl_1_1grow__shrink__stack.html#af00a10db06e358e68638c49fd0b4f68f">00278</a>     <a class="code" href="classstxxl_1_1grow__shrink__stack.html#a27a9a90b15c75fefeff168a80f3cb966">value_type</a> * <a class="code" href="classstxxl_1_1grow__shrink__stack.html#af00a10db06e358e68638c49fd0b4f68f">current_element</a>;
<a name="l00279"></a><a class="code" href="classstxxl_1_1grow__shrink__stack.html#a249e03a4388f502ec9df93d13ae6678e">00279</a>     <a class="code" href="classstxxl_1_1simple__vector.html">simple_vector&lt;block_type&gt;</a> <a class="code" href="classstxxl_1_1grow__shrink__stack.html#a249e03a4388f502ec9df93d13ae6678e">cache</a>;
<a name="l00280"></a><a class="code" href="classstxxl_1_1grow__shrink__stack.html#af53b3767123b7d63df78274d32fe57e5">00280</a>     <span class="keyword">typename</span> <a class="code" href="classstxxl_1_1simple__vector.html">simple_vector&lt;block_type&gt;::iterator</a> <a class="code" href="classstxxl_1_1grow__shrink__stack.html#af53b3767123b7d63df78274d32fe57e5">cache_buffers</a>;
<a name="l00281"></a><a class="code" href="classstxxl_1_1grow__shrink__stack.html#ac316d2fdaec18c04ee8558ff0f2cebfb">00281</a>     <span class="keyword">typename</span> <a class="code" href="classstxxl_1_1simple__vector.html">simple_vector&lt;block_type&gt;::iterator</a> <a class="code" href="classstxxl_1_1grow__shrink__stack.html#ac316d2fdaec18c04ee8558ff0f2cebfb">overlap_buffers</a>;
<a name="l00282"></a><a class="code" href="classstxxl_1_1grow__shrink__stack.html#a1e9cf50be067674d2114682ec58d1f5c">00282</a>     <a class="code" href="classstxxl_1_1simple__vector.html">simple_vector&lt;request_ptr&gt;</a> <a class="code" href="classstxxl_1_1grow__shrink__stack.html#a1e9cf50be067674d2114682ec58d1f5c">requests</a>;
<a name="l00283"></a><a class="code" href="classstxxl_1_1grow__shrink__stack.html#a333d40f6c92eaba84a9c83a1c60e2589">00283</a>     std::vector&lt;bid_type&gt; <a class="code" href="classstxxl_1_1grow__shrink__stack.html#a333d40f6c92eaba84a9c83a1c60e2589">bids</a>;
<a name="l00284"></a><a class="code" href="classstxxl_1_1grow__shrink__stack.html#a27363aa1ed5932a0d3e321609a751a95">00284</a>     <a class="code" href="classstxxl_1_1grow__shrink__stack.html#a6a48b3bccab520d49284d04623c21e06">alloc_strategy_type</a> <a class="code" href="classstxxl_1_1grow__shrink__stack.html#a27363aa1ed5932a0d3e321609a751a95">alloc_strategy</a>;
<a name="l00285"></a>00285 
<a name="l00286"></a>00286 <span class="keyword">public</span>:
<a name="l00287"></a><a class="code" href="classstxxl_1_1grow__shrink__stack.html#a8465956ca272aacbe8599992e956ffe9">00287</a>     <a class="code" href="classstxxl_1_1grow__shrink__stack.html" title="Efficient implementation that uses prefetching and overlapping using internal buffers.">grow_shrink_stack</a>() :
<a name="l00288"></a>00288         size_(0),
<a name="l00289"></a>00289         cache_offset(0),
<a name="l00290"></a>00290         current_element(NULL),
<a name="l00291"></a>00291         cache(blocks_per_page * 2),
<a name="l00292"></a>00292         cache_buffers(cache.begin()),
<a name="l00293"></a>00293         overlap_buffers(cache.begin() + blocks_per_page),
<a name="l00294"></a>00294         requests(blocks_per_page),
<a name="l00295"></a>00295         bids(0)
<a name="l00296"></a>00296     {
<a name="l00297"></a>00297         bids.reserve(blocks_per_page);
<a name="l00298"></a>00298     }
<a name="l00299"></a>00299 
<a name="l00300"></a><a class="code" href="classstxxl_1_1grow__shrink__stack.html#a668b7b7637b67ab159d2e74f7f5dfa40">00300</a>     <span class="keywordtype">void</span> <a class="code" href="namespacestd.html#abc5bd04888275546472a3a5b813fe030">swap</a>(<a class="code" href="classstxxl_1_1grow__shrink__stack.html" title="Efficient implementation that uses prefetching and overlapping using internal buffers.">grow_shrink_stack</a> &amp; obj)
<a name="l00301"></a>00301     {
<a name="l00302"></a>00302         <a class="code" href="namespacestd.html#abc5bd04888275546472a3a5b813fe030">std::swap</a>(size_, obj.<a class="code" href="classstxxl_1_1grow__shrink__stack.html#a1817e315e8a9f293e2d508019587116c">size_</a>);
<a name="l00303"></a>00303         <a class="code" href="namespacestd.html#abc5bd04888275546472a3a5b813fe030">std::swap</a>(cache_offset, obj.<a class="code" href="classstxxl_1_1grow__shrink__stack.html#a42d8da12073f9fd73740a0831139fe48">cache_offset</a>);
<a name="l00304"></a>00304         <a class="code" href="namespacestd.html#abc5bd04888275546472a3a5b813fe030">std::swap</a>(current_element, obj.<a class="code" href="classstxxl_1_1grow__shrink__stack.html#af00a10db06e358e68638c49fd0b4f68f">current_element</a>);
<a name="l00305"></a>00305         <a class="code" href="namespacestd.html#abc5bd04888275546472a3a5b813fe030">std::swap</a>(cache, obj.<a class="code" href="classstxxl_1_1grow__shrink__stack.html#a249e03a4388f502ec9df93d13ae6678e">cache</a>);
<a name="l00306"></a>00306         <a class="code" href="namespacestd.html#abc5bd04888275546472a3a5b813fe030">std::swap</a>(cache_buffers, obj.<a class="code" href="classstxxl_1_1grow__shrink__stack.html#af53b3767123b7d63df78274d32fe57e5">cache_buffers</a>);
<a name="l00307"></a>00307         <a class="code" href="namespacestd.html#abc5bd04888275546472a3a5b813fe030">std::swap</a>(overlap_buffers, obj.<a class="code" href="classstxxl_1_1grow__shrink__stack.html#ac316d2fdaec18c04ee8558ff0f2cebfb">overlap_buffers</a>);
<a name="l00308"></a>00308         <a class="code" href="namespacestd.html#abc5bd04888275546472a3a5b813fe030">std::swap</a>(requests, obj.<a class="code" href="classstxxl_1_1grow__shrink__stack.html#a1e9cf50be067674d2114682ec58d1f5c">requests</a>);
<a name="l00309"></a>00309         <a class="code" href="namespacestd.html#abc5bd04888275546472a3a5b813fe030">std::swap</a>(bids, obj.<a class="code" href="classstxxl_1_1grow__shrink__stack.html#a333d40f6c92eaba84a9c83a1c60e2589">bids</a>);
<a name="l00310"></a>00310         <a class="code" href="namespacestd.html#abc5bd04888275546472a3a5b813fe030">std::swap</a>(alloc_strategy, obj.<a class="code" href="classstxxl_1_1grow__shrink__stack.html#a27363aa1ed5932a0d3e321609a751a95">alloc_strategy</a>);
<a name="l00311"></a>00311     }
<a name="l00312"></a>00312 <span class="comment"></span>
<a name="l00313"></a>00313 <span class="comment">    //! \brief Construction from a stack</span>
<a name="l00314"></a>00314 <span class="comment">    //! \param stack_ stack object (could be external or internal, important is that it must</span>
<a name="l00315"></a>00315 <span class="comment">    //! have a copy constructor, \c top() and \c pop() methods )</span>
<a name="l00316"></a>00316 <span class="comment"></span>    <span class="keyword">template</span> &lt;<span class="keyword">class</span> stack_type&gt;
<a name="l00317"></a><a class="code" href="classstxxl_1_1grow__shrink__stack.html#a5eaa5cdf9e43c0b31bf92b91e60888ae">00317</a>     <a class="code" href="classstxxl_1_1grow__shrink__stack.html" title="Efficient implementation that uses prefetching and overlapping using internal buffers.">grow_shrink_stack</a>(<span class="keyword">const</span> stack_type &amp; stack_) :
<a name="l00318"></a>00318         size_(0),
<a name="l00319"></a>00319         cache_offset(0),
<a name="l00320"></a>00320         current_element(NULL),
<a name="l00321"></a>00321         cache(blocks_per_page * 2),
<a name="l00322"></a>00322         cache_buffers(cache.begin()),
<a name="l00323"></a>00323         overlap_buffers(cache.begin() + blocks_per_page),
<a name="l00324"></a>00324         requests(blocks_per_page),
<a name="l00325"></a>00325         bids(0)
<a name="l00326"></a>00326     {
<a name="l00327"></a>00327         bids.reserve(blocks_per_page);
<a name="l00328"></a>00328 
<a name="l00329"></a>00329         stack_type stack_copy = stack_;
<a name="l00330"></a>00330         <span class="keyword">const</span> <a class="code" href="classstxxl_1_1grow__shrink__stack.html#a8805e990141e1a95451509313eebe533">size_type</a> sz = stack_copy.size();
<a name="l00331"></a>00331         <a class="code" href="classstxxl_1_1grow__shrink__stack.html#a8805e990141e1a95451509313eebe533">size_type</a> i;
<a name="l00332"></a>00332 
<a name="l00333"></a>00333         std::vector&lt;value_type&gt; tmp(sz);
<a name="l00334"></a>00334 
<a name="l00335"></a>00335         <span class="keywordflow">for</span> (i = 0; i &lt; sz; ++i)
<a name="l00336"></a>00336         {
<a name="l00337"></a>00337             tmp[sz - i - 1] = stack_copy.top();
<a name="l00338"></a>00338             stack_copy.pop();
<a name="l00339"></a>00339         }
<a name="l00340"></a>00340         <span class="keywordflow">for</span> (i = 0; i &lt; sz; ++i)
<a name="l00341"></a>00341             this-&gt;push(tmp[i]);
<a name="l00342"></a>00342     }
<a name="l00343"></a><a class="code" href="classstxxl_1_1grow__shrink__stack.html#a793bfd2da6f49d4fc7be2a8744490262">00343</a>     <span class="keyword">virtual</span> ~<a class="code" href="classstxxl_1_1grow__shrink__stack.html" title="Efficient implementation that uses prefetching and overlapping using internal buffers.">grow_shrink_stack</a>()
<a name="l00344"></a>00344     {
<a name="l00345"></a>00345         STXXL_VERBOSE(<a class="code" href="error__handling_8h.html#a644b6fe4d8310052a019e7f68c916bd5">STXXL_PRETTY_FUNCTION_NAME</a>);
<a name="l00346"></a>00346         <span class="keywordflow">try</span>
<a name="l00347"></a>00347         {
<a name="l00348"></a>00348             <span class="keywordflow">if</span> (requests[0].<span class="keyword">get</span>())
<a name="l00349"></a>00349                 <a class="code" href="group__iolayer.html#gadc535a096b5d4c8f84deb03c786ec807" title="Collection of functions to track statuses of a number of requests.">wait_all</a>(requests.begin(), blocks_per_page);
<a name="l00350"></a>00350         }
<a name="l00351"></a>00351         <span class="keywordflow">catch</span> (<span class="keyword">const</span> <a class="code" href="classstxxl_1_1io__error.html">io_error</a> &amp; ex)
<a name="l00352"></a>00352         { }
<a name="l00353"></a>00353         block_manager::get_instance()-&gt;delete_blocks(bids.begin(), bids.end());
<a name="l00354"></a>00354     }
<a name="l00355"></a><a class="code" href="classstxxl_1_1grow__shrink__stack.html#a67fe454453e77e8329f58949636b1636">00355</a>     <a class="code" href="classstxxl_1_1grow__shrink__stack.html#a8805e990141e1a95451509313eebe533">size_type</a> size()<span class="keyword"> const</span>
<a name="l00356"></a>00356 <span class="keyword">    </span>{
<a name="l00357"></a>00357         <span class="keywordflow">return</span> size_;
<a name="l00358"></a>00358     }
<a name="l00359"></a><a class="code" href="classstxxl_1_1grow__shrink__stack.html#a9d05c8a653cd1ccf1b2c07538ac4a374">00359</a>     <span class="keywordtype">bool</span> empty()<span class="keyword"> const</span>
<a name="l00360"></a>00360 <span class="keyword">    </span>{
<a name="l00361"></a>00361         <span class="keywordflow">return</span> (!size_);
<a name="l00362"></a>00362     }
<a name="l00363"></a><a class="code" href="classstxxl_1_1grow__shrink__stack.html#aa91297fbb47c354c94d1c4aaf8979b60">00363</a>     <a class="code" href="classstxxl_1_1grow__shrink__stack.html#a27a9a90b15c75fefeff168a80f3cb966">value_type</a> &amp; top()
<a name="l00364"></a>00364     {
<a name="l00365"></a>00365         assert(size_ &gt; 0);
<a name="l00366"></a>00366         <span class="keywordflow">return</span> (*current_element);
<a name="l00367"></a>00367     }
<a name="l00368"></a><a class="code" href="classstxxl_1_1grow__shrink__stack.html#a1d703a1201f6d9d207e3385f62c0c53d">00368</a>     <span class="keyword">const</span> <a class="code" href="classstxxl_1_1grow__shrink__stack.html#a27a9a90b15c75fefeff168a80f3cb966">value_type</a> &amp; top()<span class="keyword"> const</span>
<a name="l00369"></a>00369 <span class="keyword">    </span>{
<a name="l00370"></a>00370         assert(size_ &gt; 0);
<a name="l00371"></a>00371         <span class="keywordflow">return</span> (*current_element);
<a name="l00372"></a>00372     }
<a name="l00373"></a><a class="code" href="classstxxl_1_1grow__shrink__stack.html#ad42b0a41d026338dc6132a66c812d5f5">00373</a>     <span class="keywordtype">void</span> push(<span class="keyword">const</span> <a class="code" href="classstxxl_1_1grow__shrink__stack.html#a27a9a90b15c75fefeff168a80f3cb966">value_type</a> &amp; val)
<a name="l00374"></a>00374     {
<a name="l00375"></a>00375         assert(cache_offset &lt;= blocks_per_page * block_type::size);
<a name="l00376"></a>00376         <span class="comment">//assert(cache_offset &gt;= 0);</span>
<a name="l00377"></a>00377 
<a name="l00378"></a>00378         <span class="keywordflow">if</span> (<a class="code" href="utils_8h.html#a21c2be1ee56688a6f485ab194b697da7">UNLIKELY</a>(cache_offset == blocks_per_page * block_type::size))  <span class="comment">// cache overflow</span>
<a name="l00379"></a>00379         {
<a name="l00380"></a>00380             STXXL_VERBOSE2(<span class="stringliteral">&quot;growing, size: &quot;</span> &lt;&lt; size_);
<a name="l00381"></a>00381 
<a name="l00382"></a>00382             bids.resize(bids.size() + blocks_per_page);
<a name="l00383"></a>00383             <span class="keyword">typename</span> std::vector&lt;bid_type&gt;::iterator cur_bid = bids.end() - blocks_per_page;
<a name="l00384"></a>00384             block_manager::get_instance()-&gt;new_blocks(alloc_strategy, cur_bid, bids.end(), cur_bid - bids.begin());
<a name="l00385"></a>00385 
<a name="l00386"></a>00386             <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; blocks_per_page; ++i, ++cur_bid)
<a name="l00387"></a>00387             {
<a name="l00388"></a>00388                 <span class="keywordflow">if</span> (requests[i].<span class="keyword">get</span>())
<a name="l00389"></a>00389                     requests[i]-&gt;wait();
<a name="l00390"></a>00390 
<a name="l00391"></a>00391                 requests[i] = (cache_buffers + i)-&gt;write(*cur_bid);
<a name="l00392"></a>00392             }
<a name="l00393"></a>00393 
<a name="l00394"></a>00394             <a class="code" href="namespacestd.html#abc5bd04888275546472a3a5b813fe030">std::swap</a>(cache_buffers, overlap_buffers);
<a name="l00395"></a>00395 
<a name="l00396"></a>00396             bids.reserve(bids.size() + blocks_per_page);
<a name="l00397"></a>00397 
<a name="l00398"></a>00398             cache_offset = 1;
<a name="l00399"></a>00399             current_element = &amp;((*cache_buffers)[0]);
<a name="l00400"></a>00400             ++size_;
<a name="l00401"></a>00401 
<a name="l00402"></a>00402             *current_element = val;
<a name="l00403"></a>00403 
<a name="l00404"></a>00404             <span class="keywordflow">return</span>;
<a name="l00405"></a>00405         }
<a name="l00406"></a>00406 
<a name="l00407"></a>00407         current_element = &amp;((*(cache_buffers + cache_offset / block_type::size))[cache_offset % block_type::size]);
<a name="l00408"></a>00408         *current_element = val;
<a name="l00409"></a>00409         ++size_;
<a name="l00410"></a>00410         ++cache_offset;
<a name="l00411"></a>00411     }
<a name="l00412"></a><a class="code" href="classstxxl_1_1grow__shrink__stack.html#a96ec8735a73c035dbd0e682cba9731e1">00412</a>     <span class="keywordtype">void</span> <a class="code" href="namespacestxxl.html#a9af38b0acb1d1b4b50c5a4f3a3db8c46">pop</a>()
<a name="l00413"></a>00413     {
<a name="l00414"></a>00414         assert(cache_offset &lt;= blocks_per_page * block_type::size);
<a name="l00415"></a>00415         assert(cache_offset &gt; 0);
<a name="l00416"></a>00416         assert(size_ &gt; 0);
<a name="l00417"></a>00417 
<a name="l00418"></a>00418         <span class="keywordflow">if</span> (<a class="code" href="utils_8h.html#a21c2be1ee56688a6f485ab194b697da7">UNLIKELY</a>(cache_offset == 1 &amp;&amp; bids.size() &gt;= blocks_per_page))
<a name="l00419"></a>00419         {
<a name="l00420"></a>00420             STXXL_VERBOSE2(<span class="stringliteral">&quot;shrinking, size: &quot;</span> &lt;&lt; size_);
<a name="l00421"></a>00421 
<a name="l00422"></a>00422             <span class="keywordflow">if</span> (requests[0].<span class="keyword">get</span>())
<a name="l00423"></a>00423                 <a class="code" href="group__iolayer.html#gadc535a096b5d4c8f84deb03c786ec807" title="Collection of functions to track statuses of a number of requests.">wait_all</a>(requests.begin(), blocks_per_page);
<a name="l00424"></a>00424 
<a name="l00425"></a>00425 
<a name="l00426"></a>00426             <a class="code" href="namespacestd.html#abc5bd04888275546472a3a5b813fe030">std::swap</a>(cache_buffers, overlap_buffers);
<a name="l00427"></a>00427 
<a name="l00428"></a>00428             <span class="keywordflow">if</span> (bids.size() &gt; blocks_per_page)
<a name="l00429"></a>00429             {
<a name="l00430"></a>00430                 STXXL_VERBOSE2(<span class="stringliteral">&quot;prefetching, size: &quot;</span> &lt;&lt; size_);
<a name="l00431"></a>00431                 <span class="keyword">typename</span> std::vector&lt;bid_type&gt;::const_iterator cur_bid = bids.end() - blocks_per_page;
<a name="l00432"></a>00432                 <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = blocks_per_page - 1; i &gt;= 0; --i)
<a name="l00433"></a>00433                     requests[i] = (overlap_buffers + i)-&gt;read(*(--cur_bid));
<a name="l00434"></a>00434             }
<a name="l00435"></a>00435 
<a name="l00436"></a>00436             block_manager::get_instance()-&gt;delete_blocks(bids.end() - blocks_per_page, bids.end());
<a name="l00437"></a>00437             bids.resize(bids.size() - blocks_per_page);
<a name="l00438"></a>00438 
<a name="l00439"></a>00439             cache_offset = blocks_per_page * block_type::size;
<a name="l00440"></a>00440             --size_;
<a name="l00441"></a>00441             current_element = &amp;((*(cache_buffers + (blocks_per_page - 1)))[block_type::size - 1]);
<a name="l00442"></a>00442 
<a name="l00443"></a>00443             <span class="keywordflow">return</span>;
<a name="l00444"></a>00444         }
<a name="l00445"></a>00445 
<a name="l00446"></a>00446         --size_;
<a name="l00447"></a>00447         <a class="code" href="namespacestxxl.html#a7501995ff616f0144a8bda727c266d1b">unsigned_type</a> cur_offset = (--cache_offset) - 1;
<a name="l00448"></a>00448         current_element = &amp;((*(cache_buffers + cur_offset / block_type::size))[cur_offset % block_type::size]);
<a name="l00449"></a>00449     }
<a name="l00450"></a>00450 };
<a name="l00451"></a>00451 <span class="comment"></span>
<a name="l00452"></a>00452 <span class="comment">//! \brief Efficient implementation that uses prefetching and overlapping using (shared) buffers pools</span>
<a name="l00453"></a>00453 <span class="comment">//! \warning This is a single buffer stack! Each direction change (push() followed by pop() or vice versa) may cause one I/O.</span>
<a name="l00454"></a>00454 <span class="comment"></span><span class="keyword">template</span> &lt;<span class="keyword">class</span> Config_&gt;
<a name="l00455"></a><a class="code" href="classstxxl_1_1grow__shrink__stack2.html">00455</a> <span class="keyword">class </span><a class="code" href="classstxxl_1_1grow__shrink__stack2.html" title="Efficient implementation that uses prefetching and overlapping using (shared) buffers pools...">grow_shrink_stack2</a> : <span class="keyword">private</span> <a class="code" href="classnoncopyable.html">noncopyable</a>
<a name="l00456"></a>00456 {
<a name="l00457"></a>00457 <span class="keyword">public</span>:
<a name="l00458"></a><a class="code" href="classstxxl_1_1grow__shrink__stack2.html#a213da8851a6031ba2cb1abaf4ff9514e">00458</a>     <span class="keyword">typedef</span> Config_ <a class="code" href="classstxxl_1_1grow__shrink__stack2.html#a213da8851a6031ba2cb1abaf4ff9514e">cfg</a>;
<a name="l00459"></a><a class="code" href="classstxxl_1_1grow__shrink__stack2.html#a79053f541f064255920a9b312e13fb9a">00459</a>     <span class="keyword">typedef</span> <span class="keyword">typename</span> <a class="code" href="test__push__sort_8cpp.html#ab13c28f7d568dcb8636b7a10c0a609a1">cfg::value_type</a> <a class="code" href="classstxxl_1_1grow__shrink__stack2.html#a79053f541f064255920a9b312e13fb9a">value_type</a>;
<a name="l00460"></a><a class="code" href="classstxxl_1_1grow__shrink__stack2.html#a18bbd176b14a51d061d4d2d652d8b99b">00460</a>     <span class="keyword">typedef</span> <span class="keyword">typename</span> cfg::alloc_strategy <a class="code" href="classstxxl_1_1grow__shrink__stack2.html#a18bbd176b14a51d061d4d2d652d8b99b">alloc_strategy_type</a>;
<a name="l00461"></a><a class="code" href="classstxxl_1_1grow__shrink__stack2.html#a888526b5d4b58fb222828fc3f1163c2a">00461</a>     <span class="keyword">typedef</span> <span class="keyword">typename</span> cfg::size_type <a class="code" href="classstxxl_1_1grow__shrink__stack2.html#a888526b5d4b58fb222828fc3f1163c2a">size_type</a>;
<a name="l00462"></a>00462     <span class="keyword">enum</span> {
<a name="l00463"></a><a class="code" href="classstxxl_1_1grow__shrink__stack2.html#a4181b2c62e8700e86b2c04d2b18d5ed8a2e584bc25ad37f056ce9c0bdd800c185">00463</a>         blocks_per_page = cfg::blocks_per_page,     <span class="comment">// stack of this type has only one page</span>
<a name="l00464"></a><a class="code" href="classstxxl_1_1grow__shrink__stack2.html#a4181b2c62e8700e86b2c04d2b18d5ed8a0fccf29f6524a82649b9848322b63d7e">00464</a>         <a class="code" href="test__stream_8cpp.html#a9766f5ceca5e25981858ec7384456072">block_size</a> = <a class="code" href="test__stream_8cpp.html#a9766f5ceca5e25981858ec7384456072">cfg::block_size</a>,
<a name="l00465"></a>00465     };
<a name="l00466"></a>00466 
<a name="l00467"></a><a class="code" href="classstxxl_1_1grow__shrink__stack2.html#ada38061b8d6ec0f108d67d38a7a5feeb">00467</a>     <span class="keyword">typedef</span> <a class="code" href="classstxxl_1_1typed__block.html" title="Block containing elements of fixed length.">typed_block&lt;block_size, value_type&gt;</a> <a class="code" href="classstxxl_1_1grow__shrink__stack2.html#ada38061b8d6ec0f108d67d38a7a5feeb">block_type</a>;
<a name="l00468"></a><a class="code" href="classstxxl_1_1grow__shrink__stack2.html#a626eb805caae92d10848d3a611dacd96">00468</a>     <span class="keyword">typedef</span> <a class="code" href="structstxxl_1_1BID.html" title="Block identifier class.">BID&lt;block_size&gt;</a> <a class="code" href="classstxxl_1_1grow__shrink__stack2.html#a626eb805caae92d10848d3a611dacd96">bid_type</a>;
<a name="l00469"></a>00469 
<a name="l00470"></a>00470 <span class="keyword">private</span>:
<a name="l00471"></a><a class="code" href="classstxxl_1_1grow__shrink__stack2.html#abb8532439b6b13373e75935c02f0fce3">00471</a>     <span class="keyword">typedef</span> <a class="code" href="classstxxl_1_1read__write__pool.html" title="Implements dynamically resizable buffered writing and prefetched reading pool.">read_write_pool&lt;block_type&gt;</a> <a class="code" href="classstxxl_1_1grow__shrink__stack2.html#abb8532439b6b13373e75935c02f0fce3">pool_type</a>;
<a name="l00472"></a>00472 
<a name="l00473"></a><a class="code" href="classstxxl_1_1grow__shrink__stack2.html#ae24adba8eb94503177940e721777664d">00473</a>     <a class="code" href="classstxxl_1_1grow__shrink__stack2.html#a888526b5d4b58fb222828fc3f1163c2a">size_type</a> <a class="code" href="classstxxl_1_1grow__shrink__stack2.html#ae24adba8eb94503177940e721777664d">size_</a>;
<a name="l00474"></a><a class="code" href="classstxxl_1_1grow__shrink__stack2.html#ab4b225e5aa6a1e0a9804f91abcf0a66f">00474</a>     <a class="code" href="namespacestxxl.html#a7501995ff616f0144a8bda727c266d1b">unsigned_type</a> <a class="code" href="classstxxl_1_1grow__shrink__stack2.html#ab4b225e5aa6a1e0a9804f91abcf0a66f">cache_offset</a>;
<a name="l00475"></a><a class="code" href="classstxxl_1_1grow__shrink__stack2.html#af7f4147a3d0e81345e35c6f1761248fe">00475</a>     <a class="code" href="classstxxl_1_1typed__block.html" title="Block containing elements of fixed length.">block_type</a> * <a class="code" href="classstxxl_1_1grow__shrink__stack2.html#af7f4147a3d0e81345e35c6f1761248fe">cache</a>;
<a name="l00476"></a><a class="code" href="classstxxl_1_1grow__shrink__stack2.html#a62814e4016efb0bedd657daa78d9aa5e">00476</a>     std::vector&lt;bid_type&gt; <a class="code" href="classstxxl_1_1grow__shrink__stack2.html#a62814e4016efb0bedd657daa78d9aa5e">bids</a>;
<a name="l00477"></a><a class="code" href="classstxxl_1_1grow__shrink__stack2.html#a7dc31c5a17afae7063267724e83ca151">00477</a>     <a class="code" href="classstxxl_1_1grow__shrink__stack2.html#a18bbd176b14a51d061d4d2d652d8b99b">alloc_strategy_type</a> <a class="code" href="classstxxl_1_1grow__shrink__stack2.html#a7dc31c5a17afae7063267724e83ca151">alloc_strategy</a>;
<a name="l00478"></a><a class="code" href="classstxxl_1_1grow__shrink__stack2.html#a5e7f0a7a6748190e4bb4ce89104ff395">00478</a>     <a class="code" href="namespacestxxl.html#a7501995ff616f0144a8bda727c266d1b">unsigned_type</a> <a class="code" href="classstxxl_1_1grow__shrink__stack2.html#a5e7f0a7a6748190e4bb4ce89104ff395">pref_aggr</a>;
<a name="l00479"></a><a class="code" href="classstxxl_1_1grow__shrink__stack2.html#a684d103988ea5a5edd156d8342b387f3">00479</a>     <a class="code" href="classstxxl_1_1read__write__pool.html" title="Implements dynamically resizable buffered writing and prefetched reading pool.">pool_type</a> * <a class="code" href="classstxxl_1_1grow__shrink__stack2.html#a684d103988ea5a5edd156d8342b387f3">owned_pool</a>;
<a name="l00480"></a><a class="code" href="classstxxl_1_1grow__shrink__stack2.html#a728ec64400b64709b9c32ea2fda76d6b">00480</a>     <a class="code" href="classstxxl_1_1read__write__pool.html" title="Implements dynamically resizable buffered writing and prefetched reading pool.">pool_type</a> * <a class="code" href="classstxxl_1_1grow__shrink__stack2.html#a728ec64400b64709b9c32ea2fda76d6b">pool</a>;
<a name="l00481"></a>00481 
<a name="l00482"></a>00482 <span class="keyword">public</span>:<span class="comment"></span>
<a name="l00483"></a>00483 <span class="comment">    //! \brief Constructs stack</span>
<a name="l00484"></a>00484 <span class="comment">    //! \param pool_ block write/prefetch pool</span>
<a name="l00485"></a>00485 <span class="comment">    //! \param prefetch_aggressiveness number of blocks that will be used from prefetch pool</span>
<a name="l00486"></a><a class="code" href="classstxxl_1_1grow__shrink__stack2.html#af1cd14b68fe17802edf48fb2c236ab51">00486</a> <span class="comment"></span>    <a class="code" href="classstxxl_1_1grow__shrink__stack2.html" title="Efficient implementation that uses prefetching and overlapping using (shared) buffers pools...">grow_shrink_stack2</a>(
<a name="l00487"></a>00487         <a class="code" href="classstxxl_1_1read__write__pool.html" title="Implements dynamically resizable buffered writing and prefetched reading pool.">pool_type</a> &amp; pool_,
<a name="l00488"></a>00488         <a class="code" href="namespacestxxl.html#a7501995ff616f0144a8bda727c266d1b">unsigned_type</a> prefetch_aggressiveness = 0) :
<a name="l00489"></a>00489         size_(0),
<a name="l00490"></a>00490         cache_offset(0),
<a name="l00491"></a>00491         cache(new <a class="code" href="classstxxl_1_1typed__block.html" title="Block containing elements of fixed length.">block_type</a>),
<a name="l00492"></a>00492         pref_aggr(prefetch_aggressiveness),
<a name="l00493"></a>00493         owned_pool(NULL),
<a name="l00494"></a>00494         pool(&amp;pool_)
<a name="l00495"></a>00495     {
<a name="l00496"></a>00496         STXXL_VERBOSE2(<span class="stringliteral">&quot;grow_shrink_stack2::grow_shrink_stack2(...)&quot;</span>);
<a name="l00497"></a>00497     }
<a name="l00498"></a>00498 <span class="comment"></span>
<a name="l00499"></a>00499 <span class="comment">    //! \brief Constructs stack</span>
<a name="l00500"></a>00500 <span class="comment">    //! \param p_pool_ prefetch pool, that will be used for block prefetching</span>
<a name="l00501"></a>00501 <span class="comment">    //! \param w_pool_ write pool, that will be used for block writing</span>
<a name="l00502"></a>00502 <span class="comment">    //! \param prefetch_aggressiveness number of blocks that will be used from prefetch pool</span>
<a name="l00503"></a><a class="code" href="classstxxl_1_1grow__shrink__stack2.html#a087ada20010885fbec9d58694a81f8b5">00503</a> <span class="comment"></span>    _STXXL_DEPRECATED(<a class="code" href="classstxxl_1_1grow__shrink__stack2.html" title="Efficient implementation that uses prefetching and overlapping using (shared) buffers pools...">grow_shrink_stack2</a>(
<a name="l00504"></a>00504         <a class="code" href="classstxxl_1_1prefetch__pool.html" title="Implements dynamically resizable prefetching pool.">prefetch_pool&lt;block_type&gt;</a> &amp; p_pool_,
<a name="l00505"></a>00505         <a class="code" href="classstxxl_1_1write__pool.html" title="Implements dynamically resizable buffered writing pool.">write_pool&lt;block_type&gt;</a> &amp; w_pool_,
<a name="l00506"></a>00506         <a class="code" href="namespacestxxl.html#a7501995ff616f0144a8bda727c266d1b">unsigned_type</a> prefetch_aggressiveness = 0)) :
<a name="l00507"></a>00507         size_(0),
<a name="l00508"></a>00508         cache_offset(0),
<a name="l00509"></a>00509         cache(new <a class="code" href="classstxxl_1_1typed__block.html" title="Block containing elements of fixed length.">block_type</a>),
<a name="l00510"></a>00510         pref_aggr(prefetch_aggressiveness),
<a name="l00511"></a>00511         owned_pool(new <a class="code" href="classstxxl_1_1read__write__pool.html" title="Implements dynamically resizable buffered writing and prefetched reading pool.">pool_type</a>(p_pool_, w_pool_)),
<a name="l00512"></a>00512         pool(owned_pool)
<a name="l00513"></a>00513     {
<a name="l00514"></a>00514         STXXL_VERBOSE2(<span class="stringliteral">&quot;grow_shrink_stack2::grow_shrink_stack2(...)&quot;</span>);
<a name="l00515"></a>00515     }
<a name="l00516"></a>00516 
<a name="l00517"></a><a class="code" href="classstxxl_1_1grow__shrink__stack2.html#a132aac1921e77961d8ba70b995714d93">00517</a>     <span class="keywordtype">void</span> <a class="code" href="namespacestd.html#abc5bd04888275546472a3a5b813fe030">swap</a>(<a class="code" href="classstxxl_1_1grow__shrink__stack2.html" title="Efficient implementation that uses prefetching and overlapping using (shared) buffers pools...">grow_shrink_stack2</a> &amp; obj)
<a name="l00518"></a>00518     {
<a name="l00519"></a>00519         <a class="code" href="namespacestd.html#abc5bd04888275546472a3a5b813fe030">std::swap</a>(size_, obj.<a class="code" href="classstxxl_1_1grow__shrink__stack2.html#ae24adba8eb94503177940e721777664d">size_</a>);
<a name="l00520"></a>00520         <a class="code" href="namespacestd.html#abc5bd04888275546472a3a5b813fe030">std::swap</a>(cache_offset, obj.<a class="code" href="classstxxl_1_1grow__shrink__stack2.html#ab4b225e5aa6a1e0a9804f91abcf0a66f">cache_offset</a>);
<a name="l00521"></a>00521         <a class="code" href="namespacestd.html#abc5bd04888275546472a3a5b813fe030">std::swap</a>(cache, obj.<a class="code" href="classstxxl_1_1grow__shrink__stack2.html#af7f4147a3d0e81345e35c6f1761248fe">cache</a>);
<a name="l00522"></a>00522         <a class="code" href="namespacestd.html#abc5bd04888275546472a3a5b813fe030">std::swap</a>(bids, obj.<a class="code" href="classstxxl_1_1grow__shrink__stack2.html#a62814e4016efb0bedd657daa78d9aa5e">bids</a>);
<a name="l00523"></a>00523         <a class="code" href="namespacestd.html#abc5bd04888275546472a3a5b813fe030">std::swap</a>(alloc_strategy, obj.<a class="code" href="classstxxl_1_1grow__shrink__stack2.html#a7dc31c5a17afae7063267724e83ca151">alloc_strategy</a>);
<a name="l00524"></a>00524         <a class="code" href="namespacestd.html#abc5bd04888275546472a3a5b813fe030">std::swap</a>(pref_aggr, obj.<a class="code" href="classstxxl_1_1grow__shrink__stack2.html#a5e7f0a7a6748190e4bb4ce89104ff395">pref_aggr</a>);
<a name="l00525"></a>00525         <a class="code" href="namespacestd.html#abc5bd04888275546472a3a5b813fe030">std::swap</a>(owned_pool, obj.<a class="code" href="classstxxl_1_1grow__shrink__stack2.html#a684d103988ea5a5edd156d8342b387f3">owned_pool</a>);
<a name="l00526"></a>00526         <a class="code" href="namespacestd.html#abc5bd04888275546472a3a5b813fe030">std::swap</a>(pool, obj.<a class="code" href="classstxxl_1_1grow__shrink__stack2.html#a728ec64400b64709b9c32ea2fda76d6b">pool</a>);
<a name="l00527"></a>00527     }
<a name="l00528"></a>00528 
<a name="l00529"></a><a class="code" href="classstxxl_1_1grow__shrink__stack2.html#aaaf38aafd8dec6cea74af60235adbca0">00529</a>     <span class="keyword">virtual</span> ~<a class="code" href="classstxxl_1_1grow__shrink__stack2.html" title="Efficient implementation that uses prefetching and overlapping using (shared) buffers pools...">grow_shrink_stack2</a>()
<a name="l00530"></a>00530     {
<a name="l00531"></a>00531         <span class="keywordflow">try</span>
<a name="l00532"></a>00532         {
<a name="l00533"></a>00533             STXXL_VERBOSE2(<span class="stringliteral">&quot;grow_shrink_stack2::~grow_shrink_stack2()&quot;</span>);
<a name="l00534"></a>00534             <span class="keyword">const</span> <a class="code" href="namespacestxxl.html#add6239ebaf3d1e03a054aee6f1fd52d2">int_type</a> bids_size = bids.size();
<a name="l00535"></a>00535             <span class="keyword">const</span> <a class="code" href="namespacestxxl.html#add6239ebaf3d1e03a054aee6f1fd52d2">int_type</a> last_pref = <a class="code" href="namespacestxxl.html#a12bcc0109d49084bf722af3cf5797923">STXXL_MAX</a>(<a class="code" href="namespacestxxl.html#add6239ebaf3d1e03a054aee6f1fd52d2">int_type</a>(bids_size) - <a class="code" href="namespacestxxl.html#add6239ebaf3d1e03a054aee6f1fd52d2">int_type</a>(pref_aggr), (<a class="code" href="namespacestxxl.html#add6239ebaf3d1e03a054aee6f1fd52d2">int_type</a>)0);
<a name="l00536"></a>00536             <a class="code" href="namespacestxxl.html#add6239ebaf3d1e03a054aee6f1fd52d2">int_type</a> i;
<a name="l00537"></a>00537             <span class="keywordflow">for</span> (i = bids_size - 1; i &gt;= last_pref; --i)
<a name="l00538"></a>00538             {
<a name="l00539"></a>00539                 <span class="comment">// clean the prefetch buffer</span>
<a name="l00540"></a>00540                 pool-&gt;invalidate(bids[i]);
<a name="l00541"></a>00541             }
<a name="l00542"></a>00542             <span class="keyword">typename</span> std::vector&lt;bid_type&gt;::iterator cur = bids.begin();
<a name="l00543"></a>00543             <span class="keyword">typename</span> std::vector&lt;bid_type&gt;::const_iterator end = bids.end();
<a name="l00544"></a>00544             <span class="keywordflow">for</span> ( ; cur != end; ++cur)
<a name="l00545"></a>00545             {
<a name="l00546"></a>00546                 <span class="comment">// FIXME: read_write_pool needs something like cancel_write(bid)</span>
<a name="l00547"></a>00547                 <a class="code" href="classstxxl_1_1typed__block.html" title="Block containing elements of fixed length.">block_type</a> * b = NULL;  <span class="comment">// w_pool.steal(*cur);</span>
<a name="l00548"></a>00548                 <span class="keywordflow">if</span> (b)
<a name="l00549"></a>00549                 {
<a name="l00550"></a>00550                     pool-&gt;add(cache);   <span class="comment">// return buffer</span>
<a name="l00551"></a>00551                     cache = b;
<a name="l00552"></a>00552                 }
<a name="l00553"></a>00553             }
<a name="l00554"></a>00554             <span class="keyword">delete</span> cache;
<a name="l00555"></a>00555         }
<a name="l00556"></a>00556         <span class="keywordflow">catch</span> (<span class="keyword">const</span> <a class="code" href="classstxxl_1_1io__error.html">io_error</a> &amp; ex)
<a name="l00557"></a>00557         { }
<a name="l00558"></a>00558         block_manager::get_instance()-&gt;delete_blocks(bids.begin(), bids.end());
<a name="l00559"></a>00559         <span class="keyword">delete</span> owned_pool;
<a name="l00560"></a>00560     }
<a name="l00561"></a>00561 
<a name="l00562"></a><a class="code" href="classstxxl_1_1grow__shrink__stack2.html#a0b187e6e3abc7bd410dfc92f5bfd2cb5">00562</a>     <a class="code" href="classstxxl_1_1grow__shrink__stack2.html#a888526b5d4b58fb222828fc3f1163c2a">size_type</a> size()<span class="keyword"> const</span>
<a name="l00563"></a>00563 <span class="keyword">    </span>{
<a name="l00564"></a>00564         <span class="keywordflow">return</span> size_;
<a name="l00565"></a>00565     }
<a name="l00566"></a>00566 
<a name="l00567"></a><a class="code" href="classstxxl_1_1grow__shrink__stack2.html#a5b721aad95aab29ecc091f0587cea49b">00567</a>     <span class="keywordtype">bool</span> empty()<span class="keyword"> const</span>
<a name="l00568"></a>00568 <span class="keyword">    </span>{
<a name="l00569"></a>00569         <span class="keywordflow">return</span> (!size_);
<a name="l00570"></a>00570     }
<a name="l00571"></a>00571 
<a name="l00572"></a><a class="code" href="classstxxl_1_1grow__shrink__stack2.html#af2d0cc0dcd0505b55040b153bc3c7c8f">00572</a>     <span class="keywordtype">void</span> push(<span class="keyword">const</span> <a class="code" href="classstxxl_1_1grow__shrink__stack2.html#a79053f541f064255920a9b312e13fb9a">value_type</a> &amp; val)
<a name="l00573"></a>00573     {
<a name="l00574"></a>00574         STXXL_VERBOSE3(<span class="stringliteral">&quot;grow_shrink_stack2::push(&quot;</span> &lt;&lt; val &lt;&lt; <span class="stringliteral">&quot;)&quot;</span>);
<a name="l00575"></a>00575         assert(cache_offset &lt;= block_type::size);
<a name="l00576"></a>00576 
<a name="l00577"></a>00577         <span class="keywordflow">if</span> (<a class="code" href="utils_8h.html#a21c2be1ee56688a6f485ab194b697da7">UNLIKELY</a>(cache_offset == block_type::size))
<a name="l00578"></a>00578         {
<a name="l00579"></a>00579             STXXL_VERBOSE2(<span class="stringliteral">&quot;grow_shrink_stack2::push(&quot;</span> &lt;&lt; val &lt;&lt; <span class="stringliteral">&quot;) growing, size: &quot;</span> &lt;&lt; size_);
<a name="l00580"></a>00580 
<a name="l00581"></a>00581             bids.resize(bids.size() + 1);
<a name="l00582"></a>00582             <span class="keyword">typename</span> std::vector&lt;bid_type&gt;::iterator cur_bid = bids.end() - 1;
<a name="l00583"></a>00583             block_manager::get_instance()-&gt;new_blocks(alloc_strategy, cur_bid, bids.end(), cur_bid - bids.begin());
<a name="l00584"></a>00584             pool-&gt;write(cache, bids.back());
<a name="l00585"></a>00585             cache = pool-&gt;steal();
<a name="l00586"></a>00586             <span class="keyword">const</span> <a class="code" href="namespacestxxl.html#add6239ebaf3d1e03a054aee6f1fd52d2">int_type</a> bids_size = bids.size();
<a name="l00587"></a>00587             <span class="keyword">const</span> <a class="code" href="namespacestxxl.html#add6239ebaf3d1e03a054aee6f1fd52d2">int_type</a> last_pref = <a class="code" href="namespacestxxl.html#a12bcc0109d49084bf722af3cf5797923">STXXL_MAX</a>(<a class="code" href="namespacestxxl.html#add6239ebaf3d1e03a054aee6f1fd52d2">int_type</a>(bids_size) - <a class="code" href="namespacestxxl.html#add6239ebaf3d1e03a054aee6f1fd52d2">int_type</a>(pref_aggr) - 1, (<a class="code" href="namespacestxxl.html#add6239ebaf3d1e03a054aee6f1fd52d2">int_type</a>)0);
<a name="l00588"></a>00588             <span class="keywordflow">for</span> (<a class="code" href="namespacestxxl.html#add6239ebaf3d1e03a054aee6f1fd52d2">int_type</a> i = bids_size - 2; i &gt;= last_pref; --i)
<a name="l00589"></a>00589             {
<a name="l00590"></a>00590                 <span class="comment">// clean prefetch buffers</span>
<a name="l00591"></a>00591                 pool-&gt;invalidate(bids[i]);
<a name="l00592"></a>00592             }
<a name="l00593"></a>00593             cache_offset = 0;
<a name="l00594"></a>00594         }
<a name="l00595"></a>00595         (*cache)[cache_offset] = val;
<a name="l00596"></a>00596         ++size_;
<a name="l00597"></a>00597         ++cache_offset;
<a name="l00598"></a>00598 
<a name="l00599"></a>00599         assert(cache_offset &gt; 0);
<a name="l00600"></a>00600         assert(cache_offset &lt;= block_type::size);
<a name="l00601"></a>00601     }
<a name="l00602"></a>00602 
<a name="l00603"></a><a class="code" href="classstxxl_1_1grow__shrink__stack2.html#ab0b29ed28fe165cda560092a989b760e">00603</a>     <a class="code" href="classstxxl_1_1grow__shrink__stack2.html#a79053f541f064255920a9b312e13fb9a">value_type</a> &amp; top()
<a name="l00604"></a>00604     {
<a name="l00605"></a>00605         assert(size_ &gt; 0);
<a name="l00606"></a>00606         assert(cache_offset &gt; 0);
<a name="l00607"></a>00607         assert(cache_offset &lt;= block_type::size);
<a name="l00608"></a>00608         <span class="keywordflow">return</span> (*cache)[cache_offset - 1];
<a name="l00609"></a>00609     }
<a name="l00610"></a>00610 
<a name="l00611"></a><a class="code" href="classstxxl_1_1grow__shrink__stack2.html#a96254b318a3d8ac490dceed86f1d0d2b">00611</a>     <span class="keyword">const</span> <a class="code" href="classstxxl_1_1grow__shrink__stack2.html#a79053f541f064255920a9b312e13fb9a">value_type</a> &amp; top()<span class="keyword"> const</span>
<a name="l00612"></a>00612 <span class="keyword">    </span>{
<a name="l00613"></a>00613         assert(size_ &gt; 0);
<a name="l00614"></a>00614         assert(cache_offset &gt; 0);
<a name="l00615"></a>00615         assert(cache_offset &lt;= block_type::size);
<a name="l00616"></a>00616         <span class="keywordflow">return</span> (*cache)[cache_offset - 1];
<a name="l00617"></a>00617     }
<a name="l00618"></a>00618 
<a name="l00619"></a><a class="code" href="classstxxl_1_1grow__shrink__stack2.html#aa1ef9bb6ffd9c0e263a7ded44a84216f">00619</a>     <span class="keywordtype">void</span> <a class="code" href="namespacestxxl.html#a9af38b0acb1d1b4b50c5a4f3a3db8c46">pop</a>()
<a name="l00620"></a>00620     {
<a name="l00621"></a>00621         STXXL_VERBOSE3(<span class="stringliteral">&quot;grow_shrink_stack2::pop()&quot;</span>);
<a name="l00622"></a>00622         assert(size_ &gt; 0);
<a name="l00623"></a>00623         assert(cache_offset &gt; 0);
<a name="l00624"></a>00624         assert(cache_offset &lt;= block_type::size);
<a name="l00625"></a>00625         <span class="keywordflow">if</span> (<a class="code" href="utils_8h.html#a21c2be1ee56688a6f485ab194b697da7">UNLIKELY</a>(cache_offset == 1 &amp;&amp; (!bids.empty())))
<a name="l00626"></a>00626         {
<a name="l00627"></a>00627             STXXL_VERBOSE2(<span class="stringliteral">&quot;grow_shrink_stack2::pop() shrinking, size = &quot;</span> &lt;&lt; size_);
<a name="l00628"></a>00628 
<a name="l00629"></a>00629             <a class="code" href="structstxxl_1_1BID.html" title="Block identifier class.">bid_type</a> last_block = bids.back();
<a name="l00630"></a>00630             bids.pop_back();
<a name="l00631"></a>00631             pool-&gt;read(cache, last_block)-&gt;wait();
<a name="l00632"></a>00632             block_manager::get_instance()-&gt;delete_block(last_block);
<a name="l00633"></a>00633             rehint();
<a name="l00634"></a>00634             cache_offset = block_type::size + 1;
<a name="l00635"></a>00635         }
<a name="l00636"></a>00636 
<a name="l00637"></a>00637         --cache_offset;
<a name="l00638"></a>00638         --size_;
<a name="l00639"></a>00639     }
<a name="l00640"></a>00640 <span class="comment"></span>
<a name="l00641"></a>00641 <span class="comment">    //! \brief Sets level of prefetch aggressiveness (number</span>
<a name="l00642"></a>00642 <span class="comment">    //! of blocks from the prefetch pool used for prefetching)</span>
<a name="l00643"></a>00643 <span class="comment">    //! \param new_p new value for the prefetch aggressiveness</span>
<a name="l00644"></a><a class="code" href="classstxxl_1_1grow__shrink__stack2.html#a1820be83890bd106ece18de59a9d20f1">00644</a> <span class="comment"></span>    <span class="keywordtype">void</span> set_prefetch_aggr(<a class="code" href="namespacestxxl.html#a7501995ff616f0144a8bda727c266d1b">unsigned_type</a> new_p)
<a name="l00645"></a>00645     {
<a name="l00646"></a>00646         <span class="keywordflow">if</span> (pref_aggr &gt; new_p)
<a name="l00647"></a>00647         {
<a name="l00648"></a>00648             <span class="keyword">const</span> <a class="code" href="namespacestxxl.html#add6239ebaf3d1e03a054aee6f1fd52d2">int_type</a> bids_size = bids.size();
<a name="l00649"></a>00649             <span class="keyword">const</span> <a class="code" href="namespacestxxl.html#add6239ebaf3d1e03a054aee6f1fd52d2">int_type</a> last_pref = <a class="code" href="namespacestxxl.html#a12bcc0109d49084bf722af3cf5797923">STXXL_MAX</a>(<a class="code" href="namespacestxxl.html#add6239ebaf3d1e03a054aee6f1fd52d2">int_type</a>(bids_size) - <a class="code" href="namespacestxxl.html#add6239ebaf3d1e03a054aee6f1fd52d2">int_type</a>(pref_aggr), (<a class="code" href="namespacestxxl.html#add6239ebaf3d1e03a054aee6f1fd52d2">int_type</a>)0);
<a name="l00650"></a>00650             <span class="keywordflow">for</span> (<a class="code" href="namespacestxxl.html#add6239ebaf3d1e03a054aee6f1fd52d2">int_type</a> i = bids_size - new_p - 1; i &gt;= last_pref; --i)
<a name="l00651"></a>00651             {
<a name="l00652"></a>00652                 <span class="comment">// clean prefetch buffers</span>
<a name="l00653"></a>00653                 pool-&gt;invalidate(bids[i]);
<a name="l00654"></a>00654             }
<a name="l00655"></a>00655         }
<a name="l00656"></a>00656         pref_aggr = new_p;
<a name="l00657"></a>00657         rehint();
<a name="l00658"></a>00658     }
<a name="l00659"></a>00659 <span class="comment"></span>
<a name="l00660"></a>00660 <span class="comment">    //! \brief Returns number of blocks used for prefetching</span>
<a name="l00661"></a><a class="code" href="classstxxl_1_1grow__shrink__stack2.html#abf8276c5458e71a65f4bfa3c8c37c62f">00661</a> <span class="comment"></span>    <a class="code" href="namespacestxxl.html#a7501995ff616f0144a8bda727c266d1b">unsigned_type</a> get_prefetch_aggr()<span class="keyword"> const</span>
<a name="l00662"></a>00662 <span class="keyword">    </span>{
<a name="l00663"></a>00663         <span class="keywordflow">return</span> pref_aggr;
<a name="l00664"></a>00664     }
<a name="l00665"></a>00665 
<a name="l00666"></a>00666 <span class="keyword">private</span>:<span class="comment"></span>
<a name="l00667"></a>00667 <span class="comment">    //! \brief hint the last pref_aggr external blocks</span>
<a name="l00668"></a><a class="code" href="classstxxl_1_1grow__shrink__stack2.html#a06c656e751f97841d6e2266f2d37f921">00668</a> <span class="comment"></span>    <span class="keywordtype">void</span> rehint()
<a name="l00669"></a>00669     {
<a name="l00670"></a>00670         <span class="keyword">const</span> <a class="code" href="namespacestxxl.html#add6239ebaf3d1e03a054aee6f1fd52d2">int_type</a> bids_size = bids.size();
<a name="l00671"></a>00671         <span class="keyword">const</span> <a class="code" href="namespacestxxl.html#add6239ebaf3d1e03a054aee6f1fd52d2">int_type</a> last_pref = <a class="code" href="namespacestxxl.html#a12bcc0109d49084bf722af3cf5797923">STXXL_MAX</a>(<a class="code" href="namespacestxxl.html#add6239ebaf3d1e03a054aee6f1fd52d2">int_type</a>(bids_size) - <a class="code" href="namespacestxxl.html#add6239ebaf3d1e03a054aee6f1fd52d2">int_type</a>(pref_aggr), (<a class="code" href="namespacestxxl.html#add6239ebaf3d1e03a054aee6f1fd52d2">int_type</a>)0);
<a name="l00672"></a>00672         <span class="keywordflow">for</span> (<a class="code" href="namespacestxxl.html#add6239ebaf3d1e03a054aee6f1fd52d2">int_type</a> i = bids_size - 1; i &gt;= last_pref; --i)
<a name="l00673"></a>00673         {
<a name="l00674"></a>00674             pool-&gt;hint(bids[i]);  <span class="comment">// prefetch</span>
<a name="l00675"></a>00675         }
<a name="l00676"></a>00676     }
<a name="l00677"></a>00677 };
<a name="l00678"></a>00678 
<a name="l00679"></a>00679 <span class="comment"></span>
<a name="l00680"></a>00680 <span class="comment">//! \brief A stack that migrates from internal memory to external when its size exceeds a certain threshold</span>
<a name="l00681"></a>00681 <span class="comment"></span><span class="comment"></span>
<a name="l00682"></a>00682 <span class="comment">//! For semantics of the methods see documentation of the STL \c std::stack.</span>
<a name="l00683"></a>00683 <span class="comment"></span><span class="keyword">template</span> &lt;<span class="keywordtype">unsigned</span>_type CritSize, <span class="keyword">class</span> ExternalStack, <span class="keyword">class</span> InternalStack&gt;
<a name="l00684"></a><a class="code" href="classstxxl_1_1migrating__stack.html">00684</a> <span class="keyword">class </span><a class="code" href="classstxxl_1_1migrating__stack.html" title="A stack that migrates from internal memory to external when its size exceeds a certain threshold...">migrating_stack</a> : <span class="keyword">private</span> <a class="code" href="classnoncopyable.html">noncopyable</a>
<a name="l00685"></a>00685 {
<a name="l00686"></a>00686 <span class="keyword">public</span>:
<a name="l00687"></a><a class="code" href="classstxxl_1_1migrating__stack.html#a2295f9a60bb28b69442a3a86dea54252">00687</a>     <span class="keyword">typedef</span> <span class="keyword">typename</span> ExternalStack::cfg <a class="code" href="classstxxl_1_1migrating__stack.html#a2295f9a60bb28b69442a3a86dea54252">cfg</a>;
<a name="l00688"></a><a class="code" href="classstxxl_1_1migrating__stack.html#a2b38f6b3b36c85aa24bd7330cd05816a">00688</a>     <span class="keyword">typedef</span> <span class="keyword">typename</span> <a class="code" href="test__push__sort_8cpp.html#ab13c28f7d568dcb8636b7a10c0a609a1">cfg::value_type</a> <a class="code" href="classstxxl_1_1migrating__stack.html#a2b38f6b3b36c85aa24bd7330cd05816a">value_type</a>;
<a name="l00689"></a><a class="code" href="classstxxl_1_1migrating__stack.html#a0361ebf4096b340381c99b1ecef2e3a8">00689</a>     <span class="keyword">typedef</span> <span class="keyword">typename</span> cfg::size_type <a class="code" href="classstxxl_1_1migrating__stack.html#a0361ebf4096b340381c99b1ecef2e3a8">size_type</a>;
<a name="l00690"></a>00690     <span class="keyword">enum</span> {
<a name="l00691"></a><a class="code" href="classstxxl_1_1migrating__stack.html#a9afb7081dd784885733886b1e31ee1c2aedc0516b5737917b8b74c8124e97829f">00691</a>         blocks_per_page = cfg::blocks_per_page,
<a name="l00692"></a><a class="code" href="classstxxl_1_1migrating__stack.html#a9afb7081dd784885733886b1e31ee1c2a2baca5734be4b38579fd77f309c76041">00692</a>         <a class="code" href="test__stream_8cpp.html#a9766f5ceca5e25981858ec7384456072">block_size</a> = <a class="code" href="test__stream_8cpp.html#a9766f5ceca5e25981858ec7384456072">cfg::block_size</a>
<a name="l00693"></a>00693     };
<a name="l00694"></a>00694 
<a name="l00695"></a>00695 
<a name="l00696"></a><a class="code" href="classstxxl_1_1migrating__stack.html#a2a45acf89f0a9b0c3d052ecb457a3a40">00696</a>     <span class="keyword">typedef</span> InternalStack <a class="code" href="classstxxl_1_1migrating__stack.html#a2a45acf89f0a9b0c3d052ecb457a3a40">int_stack_type</a>;
<a name="l00697"></a><a class="code" href="classstxxl_1_1migrating__stack.html#ab8f6dea7c31b6648588456758c407438">00697</a>     <span class="keyword">typedef</span> ExternalStack <a class="code" href="classstxxl_1_1migrating__stack.html#ab8f6dea7c31b6648588456758c407438">ext_stack_type</a>;
<a name="l00698"></a>00698 
<a name="l00699"></a>00699 <span class="keyword">private</span>:
<a name="l00700"></a><a class="code" href="classstxxl_1_1migrating__stack.html#af0716c2afd3cef4ffc2e27414fae5c5da600908379ba43e24dd3abdc44bdd78bb">00700</a>     <span class="keyword">enum</span> { critical_size = CritSize };
<a name="l00701"></a>00701 
<a name="l00702"></a><a class="code" href="classstxxl_1_1migrating__stack.html#a7613044c202ad9a8b2d14782fd598b9d">00702</a>     <a class="code" href="classstxxl_1_1migrating__stack.html#a2a45acf89f0a9b0c3d052ecb457a3a40">int_stack_type</a> * <a class="code" href="classstxxl_1_1migrating__stack.html#a7613044c202ad9a8b2d14782fd598b9d">int_impl</a>;
<a name="l00703"></a><a class="code" href="classstxxl_1_1migrating__stack.html#ac6897a430d4ccb1cdafe7d39eda63fc4">00703</a>     <a class="code" href="classstxxl_1_1migrating__stack.html#ab8f6dea7c31b6648588456758c407438">ext_stack_type</a> * <a class="code" href="classstxxl_1_1migrating__stack.html#ac6897a430d4ccb1cdafe7d39eda63fc4">ext_impl</a>;
<a name="l00704"></a>00704 
<a name="l00705"></a>00705     <span class="comment">// not implemented yet</span>
<a name="l00706"></a>00706     <span class="keyword">template</span> &lt;<span class="keyword">class</span> stack_type&gt;
<a name="l00707"></a>00707     <a class="code" href="classstxxl_1_1migrating__stack.html" title="A stack that migrates from internal memory to external when its size exceeds a certain threshold...">migrating_stack</a>(<span class="keyword">const</span> stack_type &amp; stack_);
<a name="l00708"></a>00708 
<a name="l00709"></a>00709 <span class="keyword">public</span>:
<a name="l00710"></a><a class="code" href="classstxxl_1_1migrating__stack.html#a2233b6989e8cbe2e3a644ae3deeee79f">00710</a>     <a class="code" href="classstxxl_1_1migrating__stack.html#a2233b6989e8cbe2e3a644ae3deeee79f">migrating_stack</a>() : int_impl(new <a class="code" href="classstxxl_1_1migrating__stack.html#a2a45acf89f0a9b0c3d052ecb457a3a40">int_stack_type</a>()), ext_impl(NULL) { }
<a name="l00711"></a>00711 
<a name="l00712"></a><a class="code" href="classstxxl_1_1migrating__stack.html#ac7e600381bfb8db3b91f411f566abd98">00712</a>     <span class="keywordtype">void</span> <a class="code" href="namespacestd.html#abc5bd04888275546472a3a5b813fe030">swap</a>(<a class="code" href="classstxxl_1_1migrating__stack.html" title="A stack that migrates from internal memory to external when its size exceeds a certain threshold...">migrating_stack</a> &amp; obj)
<a name="l00713"></a>00713     {
<a name="l00714"></a>00714         <a class="code" href="namespacestd.html#abc5bd04888275546472a3a5b813fe030">std::swap</a>(int_impl, obj.<a class="code" href="classstxxl_1_1migrating__stack.html#a7613044c202ad9a8b2d14782fd598b9d">int_impl</a>);
<a name="l00715"></a>00715         <a class="code" href="namespacestd.html#abc5bd04888275546472a3a5b813fe030">std::swap</a>(ext_impl, obj.<a class="code" href="classstxxl_1_1migrating__stack.html#ac6897a430d4ccb1cdafe7d39eda63fc4">ext_impl</a>);
<a name="l00716"></a>00716     }
<a name="l00717"></a>00717 <span class="comment"></span>
<a name="l00718"></a>00718 <span class="comment">    //! \brief Returns true if current implementation is internal, otherwise false</span>
<a name="l00719"></a><a class="code" href="classstxxl_1_1migrating__stack.html#a737d913feda287ab7aaba812e9fc376c">00719</a> <span class="comment"></span>    <span class="keywordtype">bool</span> <span class="keyword">internal</span>() <span class="keyword">const</span>
<a name="l00720"></a>00720     {
<a name="l00721"></a>00721         assert((int_impl &amp;&amp; !ext_impl) || (!int_impl &amp;&amp; ext_impl));
<a name="l00722"></a>00722         <span class="keywordflow">return</span> int_impl;
<a name="l00723"></a>00723     }<span class="comment"></span>
<a name="l00724"></a>00724 <span class="comment">    //! \brief Returns true if current implementation is external, otherwise false</span>
<a name="l00725"></a><a class="code" href="classstxxl_1_1migrating__stack.html#aa9140215d325829b7f407e04bb197072">00725</a> <span class="comment"></span>    <span class="keywordtype">bool</span> <a class="code" href="group__stlcont.html#gga8915cf6dd5ad4199511d708b2e1bd707a185a3b5c6f11c94dcd3605ebc422c6c3">external</a>()<span class="keyword"> const</span>
<a name="l00726"></a>00726 <span class="keyword">    </span>{
<a name="l00727"></a>00727         assert((int_impl &amp;&amp; !ext_impl) || (!int_impl &amp;&amp; ext_impl));
<a name="l00728"></a>00728         <span class="keywordflow">return</span> ext_impl;
<a name="l00729"></a>00729     }
<a name="l00730"></a>00730 
<a name="l00731"></a><a class="code" href="classstxxl_1_1migrating__stack.html#a981c30d2e90f2dd0279b4383341e0dc6">00731</a>     <span class="keywordtype">bool</span> empty()<span class="keyword"> const</span>
<a name="l00732"></a>00732 <span class="keyword">    </span>{
<a name="l00733"></a>00733         assert((int_impl &amp;&amp; !ext_impl) || (!int_impl &amp;&amp; ext_impl));
<a name="l00734"></a>00734         <span class="keywordflow">return</span> (int_impl) ? int_impl-&gt;empty() : ext_impl-&gt;empty();
<a name="l00735"></a>00735     }
<a name="l00736"></a><a class="code" href="classstxxl_1_1migrating__stack.html#a10f414e1aff8d7ea8845f97bb752c265">00736</a>     <a class="code" href="classstxxl_1_1migrating__stack.html#a0361ebf4096b340381c99b1ecef2e3a8">size_type</a> size()<span class="keyword"> const</span>
<a name="l00737"></a>00737 <span class="keyword">    </span>{
<a name="l00738"></a>00738         assert((int_impl &amp;&amp; !ext_impl) || (!int_impl &amp;&amp; ext_impl));
<a name="l00739"></a>00739         <span class="keywordflow">return</span> (int_impl) ? <a class="code" href="classstxxl_1_1migrating__stack.html#a0361ebf4096b340381c99b1ecef2e3a8">size_type</a>(int_impl-&gt;size()) : ext_impl-&gt;size();
<a name="l00740"></a>00740     }
<a name="l00741"></a><a class="code" href="classstxxl_1_1migrating__stack.html#afb0eea31df1b0ae201455d905b6b981d">00741</a>     <a class="code" href="classstxxl_1_1migrating__stack.html#a2b38f6b3b36c85aa24bd7330cd05816a">value_type</a> &amp; top()
<a name="l00742"></a>00742     {
<a name="l00743"></a>00743         assert((int_impl &amp;&amp; !ext_impl) || (!int_impl &amp;&amp; ext_impl));
<a name="l00744"></a>00744         <span class="keywordflow">return</span> (int_impl) ? int_impl-&gt;top() : ext_impl-&gt;top();
<a name="l00745"></a>00745     }
<a name="l00746"></a><a class="code" href="classstxxl_1_1migrating__stack.html#a8ff8392129d07f404635d4d3b2127601">00746</a>     <span class="keyword">const</span> <a class="code" href="classstxxl_1_1migrating__stack.html#a2b38f6b3b36c85aa24bd7330cd05816a">value_type</a> &amp; top()<span class="keyword"> const</span>
<a name="l00747"></a>00747 <span class="keyword">    </span>{
<a name="l00748"></a>00748         assert((int_impl &amp;&amp; !ext_impl) || (!int_impl &amp;&amp; ext_impl));
<a name="l00749"></a>00749         <span class="keywordflow">return</span> (int_impl) ? int_impl-&gt;top() : ext_impl-&gt;top();
<a name="l00750"></a>00750     }
<a name="l00751"></a><a class="code" href="classstxxl_1_1migrating__stack.html#ad5203b1ad3c9f5a76e8de6cbba0433d4">00751</a>     <span class="keywordtype">void</span> push(<span class="keyword">const</span> <a class="code" href="classstxxl_1_1migrating__stack.html#a2b38f6b3b36c85aa24bd7330cd05816a">value_type</a> &amp; val)
<a name="l00752"></a>00752     {
<a name="l00753"></a>00753         assert((int_impl &amp;&amp; !ext_impl) || (!int_impl &amp;&amp; ext_impl));
<a name="l00754"></a>00754 
<a name="l00755"></a>00755         <span class="keywordflow">if</span> (int_impl)
<a name="l00756"></a>00756         {
<a name="l00757"></a>00757             int_impl-&gt;push(val);
<a name="l00758"></a>00758             <span class="keywordflow">if</span> (<a class="code" href="utils_8h.html#a21c2be1ee56688a6f485ab194b697da7">UNLIKELY</a>(int_impl-&gt;size() == critical_size))
<a name="l00759"></a>00759             {
<a name="l00760"></a>00760                 <span class="comment">// migrate to external stack</span>
<a name="l00761"></a>00761                 ext_impl = <span class="keyword">new</span> <a class="code" href="classstxxl_1_1migrating__stack.html#ab8f6dea7c31b6648588456758c407438">ext_stack_type</a>(*int_impl);
<a name="l00762"></a>00762                 <span class="keyword">delete</span> int_impl;
<a name="l00763"></a>00763                 int_impl = NULL;
<a name="l00764"></a>00764             }
<a name="l00765"></a>00765         }
<a name="l00766"></a>00766         <span class="keywordflow">else</span>
<a name="l00767"></a>00767             ext_impl-&gt;push(val);
<a name="l00768"></a>00768     }
<a name="l00769"></a><a class="code" href="classstxxl_1_1migrating__stack.html#afd24955877f00a8a8f06a9751f9d76aa">00769</a>     <span class="keywordtype">void</span> <a class="code" href="namespacestxxl.html#a9af38b0acb1d1b4b50c5a4f3a3db8c46">pop</a>()
<a name="l00770"></a>00770     {
<a name="l00771"></a>00771         assert((int_impl &amp;&amp; !ext_impl) || (!int_impl &amp;&amp; ext_impl));
<a name="l00772"></a>00772 
<a name="l00773"></a>00773         <span class="keywordflow">if</span> (int_impl)
<a name="l00774"></a>00774             int_impl-&gt;pop();
<a name="l00775"></a>00775         <span class="keywordflow">else</span>
<a name="l00776"></a>00776             ext_impl-&gt;pop();
<a name="l00777"></a>00777     }
<a name="l00778"></a><a class="code" href="classstxxl_1_1migrating__stack.html#aa52755c7aa2843791166f38d5cc52b7e">00778</a>     <span class="keyword">virtual</span> ~<a class="code" href="classstxxl_1_1migrating__stack.html" title="A stack that migrates from internal memory to external when its size exceeds a certain threshold...">migrating_stack</a>()
<a name="l00779"></a>00779     {
<a name="l00780"></a>00780         <span class="keyword">delete</span> int_impl;
<a name="l00781"></a>00781         <span class="keyword">delete</span> ext_impl;
<a name="l00782"></a>00782     }
<a name="l00783"></a>00783 };
<a name="l00784"></a>00784 <span class="comment"></span>
<a name="l00785"></a>00785 <span class="comment">//! \}</span>
<a name="l00786"></a>00786 <span class="comment"></span>
<a name="l00787"></a>00787 <span class="comment"></span>
<a name="l00788"></a>00788 <span class="comment">//! \addtogroup stlcont</span>
<a name="l00789"></a>00789 <span class="comment">//! \{</span>
<a name="l00790"></a>00790 <span class="comment"></span>
<a name="l00791"></a><a class="code" href="group__stlcont.html#ga8915cf6dd5ad4199511d708b2e1bd707">00791</a> <span class="keyword">enum</span> <a class="code" href="group__stlcont.html#ga8915cf6dd5ad4199511d708b2e1bd707">stack_externality</a> { <a class="code" href="group__stlcont.html#gga8915cf6dd5ad4199511d708b2e1bd707a185a3b5c6f11c94dcd3605ebc422c6c3">external</a>, <a class="code" href="group__stlcont.html#gga8915cf6dd5ad4199511d708b2e1bd707a97b8f5f651c37e5e0674c64b33e167b3">migrating</a>, <span class="keyword">internal</span> };
<a name="l00792"></a><a class="code" href="group__stlcont.html#gaaea04c2b2dc30f34716e332164d76fb6">00792</a> <span class="keyword">enum</span> <a class="code" href="group__stlcont.html#gaaea04c2b2dc30f34716e332164d76fb6">stack_behaviour</a> { <a class="code" href="group__stlcont.html#ggaaea04c2b2dc30f34716e332164d76fb6a4d2c4d95c1082ed28f3949a2b8cfc53d">normal</a>, <a class="code" href="group__stlcont.html#ggaaea04c2b2dc30f34716e332164d76fb6a599d864b8f91a9a39335c1c545d20f50">grow_shrink</a>, <a class="code" href="group__stlcont.html#ggaaea04c2b2dc30f34716e332164d76fb6a1ca0807cfaf63c1b5768604380f654cf">grow_shrink2</a> };
<a name="l00793"></a>00793 <span class="comment"></span>
<a name="l00794"></a>00794 <span class="comment">//! \brief Stack type generator</span>
<a name="l00795"></a>00795 <span class="comment"></span><span class="comment"></span>
<a name="l00796"></a>00796 <span class="comment">//!  \tparam ValTp type of contained objects (POD with no references to internal memory)</span>
<a name="l00797"></a>00797 <span class="comment">//!  \tparam Externality one of</span>
<a name="l00798"></a>00798 <span class="comment">//!    - \c external , \b external container, implementation is chosen according</span>
<a name="l00799"></a>00799 <span class="comment">//!      to \c Behaviour parameter, is default</span>
<a name="l00800"></a>00800 <span class="comment">//!    - \c migrating , migrates from internal implementation given by \c IntStackTp parameter</span>
<a name="l00801"></a>00801 <span class="comment">//!      to external implementation given by \c Behaviour parameter when size exceeds \c MigrCritSize</span>
<a name="l00802"></a>00802 <span class="comment">//!    - \c internal , choses \c IntStackTp implementation</span>
<a name="l00803"></a>00803 <span class="comment">//!  \tparam Behaviour chooses \b external implementation, one of:</span>
<a name="l00804"></a>00804 <span class="comment">//!    - \c normal , conservative version, implemented in \c stxxl::normal_stack , is default</span>
<a name="l00805"></a>00805 <span class="comment">//!    - \c grow_shrink , efficient version, implemented in \c stxxl::grow_shrink_stack</span>
<a name="l00806"></a>00806 <span class="comment">//!    - \c grow_shrink2 , efficient version, implemented in \c stxxl::grow_shrink_stack2</span>
<a name="l00807"></a>00807 <span class="comment">//!  \tparam BlocksPerPage defines how many blocks has one page of internal cache of an</span>
<a name="l00808"></a>00808 <span class="comment">//!       \b external implementation, default is four. All \b external implementations have</span>
<a name="l00809"></a>00809 <span class="comment">//!       \b two pages.</span>
<a name="l00810"></a>00810 <span class="comment">//!  \tparam BlkSz external block size in bytes, default is 2 MiB</span>
<a name="l00811"></a>00811 <span class="comment">//!  \tparam IntStackTp type of internal stack used for some implementations</span>
<a name="l00812"></a>00812 <span class="comment">//!  \tparam MigrCritSize threshold value for number of elements when</span>
<a name="l00813"></a>00813 <span class="comment">//!    \c stxxl::migrating_stack migrates to the external memory</span>
<a name="l00814"></a>00814 <span class="comment">//!  \tparam  AllocStr one of allocation strategies: \c striping , \c RC , \c SR , or \c FR</span>
<a name="l00815"></a>00815 <span class="comment">//!    default is RC</span>
<a name="l00816"></a>00816 <span class="comment">//!  \tparam SzTp size type, default is \c stxxl::int64</span>
<a name="l00817"></a>00817 <span class="comment">//!</span>
<a name="l00818"></a>00818 <span class="comment">//! Configured stack type is available as \c STACK_GENERATOR&lt;&gt;::result. &lt;BR&gt; &lt;BR&gt;</span>
<a name="l00819"></a>00819 <span class="comment">//! Examples:</span>
<a name="l00820"></a>00820 <span class="comment">//!    - \c STACK_GENERATOR&lt;double&gt;::result external stack of \c double&#39;s ,</span>
<a name="l00821"></a>00821 <span class="comment">//!    - \c STACK_GENERATOR&lt;double,internal&gt;::result internal stack of \c double&#39;s ,</span>
<a name="l00822"></a>00822 <span class="comment">//!    - \c STACK_GENERATOR&lt;double,external,grow_shrink&gt;::result external</span>
<a name="l00823"></a>00823 <span class="comment">//!      grow-shrink stack of \c double&#39;s ,</span>
<a name="l00824"></a>00824 <span class="comment">//!    - \c STACK_GENERATOR&lt;double,migrating,grow_shrink&gt;::result migrating</span>
<a name="l00825"></a>00825 <span class="comment">//!      grow-shrink stack of \c double&#39;s, internal implementation is \c std::stack&lt;double&gt; ,</span>
<a name="l00826"></a>00826 <span class="comment">//!    - \c STACK_GENERATOR&lt;double,migrating,grow_shrink,1,512*1024&gt;::result migrating</span>
<a name="l00827"></a>00827 <span class="comment">//!      grow-shrink stack of \c double&#39;s with 1 block per page and block size 512 KiB</span>
<a name="l00828"></a>00828 <span class="comment">//!      (total memory occupied = 1 MiB).</span>
<a name="l00829"></a>00829 <span class="comment">//! For configured stack method semantics see documentation of the STL \c std::stack.</span>
<a name="l00830"></a>00830 <span class="comment"></span><span class="keyword">template</span> &lt;
<a name="l00831"></a>00831     <span class="keyword">class </span>ValTp,
<a name="l00832"></a>00832     <a class="code" href="group__stlcont.html#ga8915cf6dd5ad4199511d708b2e1bd707">stack_externality</a> Externality = <a class="code" href="group__stlcont.html#gga8915cf6dd5ad4199511d708b2e1bd707a185a3b5c6f11c94dcd3605ebc422c6c3">external</a>,
<a name="l00833"></a>00833     <a class="code" href="group__stlcont.html#gaaea04c2b2dc30f34716e332164d76fb6">stack_behaviour</a> Behaviour = <a class="code" href="group__stlcont.html#ggaaea04c2b2dc30f34716e332164d76fb6a4d2c4d95c1082ed28f3949a2b8cfc53d">normal</a>,
<a name="l00834"></a>00834     <span class="keywordtype">unsigned</span> BlocksPerPage = 4,
<a name="l00835"></a>00835     <span class="keywordtype">unsigned</span> BlkSz = <a class="code" href="group__mnglayer.html#ga3c3f065b2005cecc00e52f1e397be532">STXXL_DEFAULT_BLOCK_SIZE</a>(ValTp),
<a name="l00836"></a>00836 
<a name="l00837"></a>00837     <span class="keyword">class </span>IntStackTp = std::stack&lt;ValTp&gt;,
<a name="l00838"></a>00838     <a class="code" href="namespacestxxl.html#a7501995ff616f0144a8bda727c266d1b">unsigned_type</a> MigrCritSize = (2 * BlocksPerPage * BlkSz),
<a name="l00839"></a>00839 
<a name="l00840"></a>00840     <span class="keyword">class</span> AllocStr = <a class="code" href="group__alloc.html#ga7156e0a94c76f1be7aa15af04cee9580">STXXL_DEFAULT_ALLOC_STRATEGY</a>,
<a name="l00841"></a>00841     <span class="keyword">class</span> SzTp = <a class="code" href="namespacestxxl.html#ad7f9125156ce2d31af5283aa66568f0d">stxxl::int64</a>
<a name="l00842"></a>00842     &gt;
<a name="l00843"></a><a class="code" href="classstxxl_1_1STACK__GENERATOR.html">00843</a> <span class="keyword">class</span> <a class="code" href="classstxxl_1_1STACK__GENERATOR.html" title="Stack type generator.">STACK_GENERATOR</a>
<a name="l00844"></a>00844 {
<a name="l00845"></a><a class="code" href="classstxxl_1_1STACK__GENERATOR.html#aaf588697559c08e6eef8d440ff68f7fc">00845</a>     <span class="keyword">typedef</span> <a class="code" href="structstxxl_1_1stack__config__generator.html">stack_config_generator&lt;ValTp, BlocksPerPage, BlkSz, AllocStr, SzTp&gt;</a> <a class="code" href="classstxxl_1_1STACK__GENERATOR.html#aaf588697559c08e6eef8d440ff68f7fc">cfg</a>;
<a name="l00846"></a>00846 
<a name="l00847"></a>00847     <span class="keyword">typedef</span> <span class="keyword">typename</span> <a class="code" href="structstxxl_1_1IF.html" title="IF template metaprogramming statement.">IF</a>&lt;Behaviour == <a class="code" href="group__stlcont.html#ggaaea04c2b2dc30f34716e332164d76fb6a599d864b8f91a9a39335c1c545d20f50">grow_shrink</a>,
<a name="l00848"></a>00848                         <a class="code" href="classstxxl_1_1grow__shrink__stack.html" title="Efficient implementation that uses prefetching and overlapping using internal buffers.">grow_shrink_stack&lt;cfg&gt;</a>,
<a name="l00849"></a><a class="code" href="classstxxl_1_1STACK__GENERATOR.html#a2e9a8e923bf66d6b0a581a37a6765d4f">00849</a>                         <a class="code" href="classstxxl_1_1grow__shrink__stack2.html" title="Efficient implementation that uses prefetching and overlapping using (shared) buffers pools...">grow_shrink_stack2&lt;cfg&gt;</a> &gt;<a class="code" href="classstxxl_1_1STACK__GENERATOR.html#ad022c1e666b4832e6bcaf071370f01d8">::result</a> <a class="code" href="classstxxl_1_1STACK__GENERATOR.html#a2e9a8e923bf66d6b0a581a37a6765d4f">GrShrTp</a>;
<a name="l00850"></a><a class="code" href="classstxxl_1_1STACK__GENERATOR.html#ac4a5aa79c4b91ba840e3fb6b8a57035b">00850</a>     <span class="keyword">typedef</span> <span class="keyword">typename</span> <a class="code" href="structstxxl_1_1IF.html" title="IF template metaprogramming statement.">IF&lt;Behaviour == normal, normal_stack&lt;cfg&gt;</a>, GrShrTp&gt;<a class="code" href="classstxxl_1_1STACK__GENERATOR.html#ad022c1e666b4832e6bcaf071370f01d8">::result</a> <a class="code" href="classstxxl_1_1STACK__GENERATOR.html#ac4a5aa79c4b91ba840e3fb6b8a57035b">ExtStackTp</a>;
<a name="l00851"></a>00851     <span class="keyword">typedef</span> <span class="keyword">typename</span> <a class="code" href="structstxxl_1_1IF.html" title="IF template metaprogramming statement.">IF</a>&lt;Externality == <a class="code" href="group__stlcont.html#gga8915cf6dd5ad4199511d708b2e1bd707a97b8f5f651c37e5e0674c64b33e167b3">migrating</a>,
<a name="l00852"></a><a class="code" href="classstxxl_1_1STACK__GENERATOR.html#a6bf482b234da53803f82b211ed88d341">00852</a>                         <a class="code" href="classstxxl_1_1migrating__stack.html" title="A stack that migrates from internal memory to external when its size exceeds a certain threshold...">migrating_stack&lt;MigrCritSize, ExtStackTp, IntStackTp&gt;</a>, ExtStackTp&gt;<a class="code" href="classstxxl_1_1STACK__GENERATOR.html#ad022c1e666b4832e6bcaf071370f01d8">::result</a> <a class="code" href="classstxxl_1_1STACK__GENERATOR.html#a6bf482b234da53803f82b211ed88d341">MigrOrNotStackTp</a>;
<a name="l00853"></a>00853 
<a name="l00854"></a>00854 <span class="keyword">public</span>:
<a name="l00855"></a><a class="code" href="classstxxl_1_1STACK__GENERATOR.html#ad022c1e666b4832e6bcaf071370f01d8">00855</a>     <span class="keyword">typedef</span> <span class="keyword">typename</span> <a class="code" href="structstxxl_1_1IF.html#a78bc501e32264004daca84094d228bf7">IF&lt;Externality == internal, IntStackTp, MigrOrNotStackTp&gt;::result</a> <a class="code" href="classstxxl_1_1STACK__GENERATOR.html#ad022c1e666b4832e6bcaf071370f01d8">result</a>;
<a name="l00856"></a>00856 };
<a name="l00857"></a>00857 <span class="comment"></span>
<a name="l00858"></a>00858 <span class="comment">//! \}</span>
<a name="l00859"></a>00859 <span class="comment"></span>
<a name="l00860"></a>00860 __STXXL_END_NAMESPACE
<a name="l00861"></a>00861 
<a name="l00862"></a>00862 
<a name="l00863"></a>00863 <span class="keyword">namespace </span>std
<a name="l00864"></a>00864 {
<a name="l00865"></a>00865     <span class="keyword">template</span> &lt;<span class="keyword">class</span> Config_&gt;
<a name="l00866"></a><a class="code" href="namespacestd.html#abb6fb44ca0f1bbfbaeda3c95bb7c8f8a">00866</a>     <span class="keywordtype">void</span> <a class="code" href="namespacestd.html#abc5bd04888275546472a3a5b813fe030">swap</a>(<a class="code" href="classstxxl_1_1normal__stack.html" title="External stack container.">stxxl::normal_stack&lt;Config_&gt;</a> &amp; a,
<a name="l00867"></a>00867               <a class="code" href="classstxxl_1_1normal__stack.html" title="External stack container.">stxxl::normal_stack&lt;Config_&gt;</a> &amp; b)
<a name="l00868"></a>00868     {
<a name="l00869"></a>00869         a.<a class="code" href="classstxxl_1_1normal__stack.html#aa4a654520a95598ee768a77a6e6e6bfc">swap</a>(b);
<a name="l00870"></a>00870     }
<a name="l00871"></a>00871 
<a name="l00872"></a>00872     <span class="keyword">template</span> &lt;<span class="keyword">class</span> Config_&gt;
<a name="l00873"></a><a class="code" href="namespacestd.html#a260778edd774bc8f13822f2c559b1292">00873</a>     <span class="keywordtype">void</span> <a class="code" href="namespacestd.html#abc5bd04888275546472a3a5b813fe030">swap</a>(<a class="code" href="classstxxl_1_1grow__shrink__stack.html" title="Efficient implementation that uses prefetching and overlapping using internal buffers.">stxxl::grow_shrink_stack&lt;Config_&gt;</a> &amp; a,
<a name="l00874"></a>00874               <a class="code" href="classstxxl_1_1grow__shrink__stack.html" title="Efficient implementation that uses prefetching and overlapping using internal buffers.">stxxl::grow_shrink_stack&lt;Config_&gt;</a> &amp; b)
<a name="l00875"></a>00875     {
<a name="l00876"></a>00876         a.<a class="code" href="classstxxl_1_1grow__shrink__stack.html#a668b7b7637b67ab159d2e74f7f5dfa40">swap</a>(b);
<a name="l00877"></a>00877     }
<a name="l00878"></a>00878 
<a name="l00879"></a>00879     <span class="keyword">template</span> &lt;<span class="keyword">class</span> Config_&gt;
<a name="l00880"></a><a class="code" href="namespacestd.html#a1cbe155f6f0512df5b8b2e7b8ac2b04d">00880</a>     <span class="keywordtype">void</span> <a class="code" href="namespacestd.html#abc5bd04888275546472a3a5b813fe030">swap</a>(<a class="code" href="classstxxl_1_1grow__shrink__stack2.html" title="Efficient implementation that uses prefetching and overlapping using (shared) buffers pools...">stxxl::grow_shrink_stack2&lt;Config_&gt;</a> &amp; a,
<a name="l00881"></a>00881               <a class="code" href="classstxxl_1_1grow__shrink__stack2.html" title="Efficient implementation that uses prefetching and overlapping using (shared) buffers pools...">stxxl::grow_shrink_stack2&lt;Config_&gt;</a> &amp; b)
<a name="l00882"></a>00882     {
<a name="l00883"></a>00883         a.<a class="code" href="classstxxl_1_1grow__shrink__stack2.html#a132aac1921e77961d8ba70b995714d93">swap</a>(b);
<a name="l00884"></a>00884     }
<a name="l00885"></a>00885 
<a name="l00886"></a>00886     <span class="keyword">template</span> &lt;stxxl::<span class="keywordtype">unsigned</span>_type CritSize, <span class="keyword">class</span> ExternalStack, <span class="keyword">class</span> InternalStack&gt;
<a name="l00887"></a><a class="code" href="namespacestd.html#ab219562bc3332df30862bfc3c05f992f">00887</a>     <span class="keywordtype">void</span> <a class="code" href="namespacestd.html#abc5bd04888275546472a3a5b813fe030">swap</a>(<a class="code" href="classstxxl_1_1migrating__stack.html" title="A stack that migrates from internal memory to external when its size exceeds a certain threshold...">stxxl::migrating_stack&lt;CritSize, ExternalStack, InternalStack&gt;</a> &amp; a,
<a name="l00888"></a>00888               <a class="code" href="classstxxl_1_1migrating__stack.html" title="A stack that migrates from internal memory to external when its size exceeds a certain threshold...">stxxl::migrating_stack&lt;CritSize, ExternalStack, InternalStack&gt;</a> &amp; b)
<a name="l00889"></a>00889     {
<a name="l00890"></a>00890         a.<a class="code" href="classstxxl_1_1migrating__stack.html#ac7e600381bfb8db3b91f411f566abd98">swap</a>(b);
<a name="l00891"></a>00891     }
<a name="l00892"></a>00892 }
<a name="l00893"></a>00893 
<a name="l00894"></a>00894 <span class="preprocessor">#endif // !STXXL_STACK_HEADER</span>
<a name="l00895"></a>00895 <span class="preprocessor"></span><span class="comment">// vim: et:ts=4:sw=4</span>
</pre></div></div><!-- contents -->
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Classes</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Namespaces</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Typedefs</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&#160;</span>Enumerations</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(8)"><span class="SelectionMark">&#160;</span>Enumerator</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(9)"><span class="SelectionMark">&#160;</span>Friends</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(10)"><span class="SelectionMark">&#160;</span>Defines</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>



<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.7.6.1
</small></address>

</body>
</html>
