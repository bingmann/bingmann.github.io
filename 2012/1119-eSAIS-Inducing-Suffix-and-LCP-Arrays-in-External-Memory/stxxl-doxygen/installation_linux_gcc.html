<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<title>Stxxl: Installation, usage, configuration (Linux/Unix &ndash; g++/icpc/clang++)</title>

<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="doxygen.css" rel="stylesheet" type="text/css" />

<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>

</head>
<body>
<div id="top"><!-- do not remove this div! -->


<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  
  
  <td style="padding-left: 0.5em;">
   <div id="projectname">Stxxl
   &#160;<span id="projectnumber">1.4.0</span>
   </div>
   
  </td>
  
  
  
 </tr>
 </tbody>
</table>
</div>

<!-- Generated by Doxygen 1.7.6.1 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li class="current"><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
      <li><a href="examples.html"><span>Examples</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
</div>
<div class="header">
  <div class="headertitle">
<div class="title">Installation, usage, configuration (Linux/Unix &ndash; g++/icpc/clang++) </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><h2><a class="anchor" id="download_linux_gcc"></a>
Download and Extraction</h2>
<ul>
<li>Download the latest gzipped tarball from <a href="http://sourceforge.net/projects/stxxl/files/stxxl/">SourceForge</a></li>
<li>Unpack in some directory executing: <code>tar</code> <code>zfxv</code> <code>stxxl-x.y.z.tgz</code> </li>
<li>Change to <code>stxxl</code> directory: <code>cd</code> <code>stxxl-x.y.z</code> </li>
</ul>
<h2><a class="anchor" id="library_compilation_linux_gcc"></a>
Library Compilation</h2>
<ul>
<li>Run: <div class="fragment"><pre class="fragment">make config_gnu </pre></div> to create a template <code>make.settings.local</code> file. Note: this will produce some warnings and abort with an error, which is intended.</li>
<li>(optionally) change the <code>make.settings.local</code> file according to your system configuration:<ul>
<li>(optionally) set the <code>STXXL_ROOT</code> variable to <code>S<small>TXXL</small></code> root directory ( <code>directory_where_you_unpacked_the_tar_ball/stxxl-x.y.z</code> )</li>
<li>if you want <code>S<small>TXXL</small></code> to use <a href="http://www.boost.org">Boost</a> libraries (you should have the Boost libraries already installed)<ul>
<li>change the <code>USE_BOOST</code> variable to <code>yes</code> </li>
<li>change the <code>BOOST_ROOT</code> variable to the Boost root path, unless Boost is installed in system default search paths.</li>
</ul>
</li>
<li>if you want <code>S<small>TXXL</small></code> to use the <a href="http://gcc.gnu.org/onlinedocs/libstdc++/manual/parallel_mode.html">libstdc++ parallel mode</a><ul>
<li>use GCC version 4.3 or later</li>
<li>use the targets <code>library_g++_pmode</code> and <code>tests_g++_pmode</code> instead of the ones listed below</li>
</ul>
</li>
<li>if you want <code>S<small>TXXL</small></code> to use the <a href="http://algo2.iti.kit.edu/singler/mcstl/">MCSTL</a> library (you should have the MCSTL library already installed)<ul>
<li>change the <code>MCSTL_ROOT</code> variable to the MCSTL root path</li>
<li>use the targets <code>library_g++_mcstl</code> and <code>tests_g++_mcstl</code> instead of the ones listed below</li>
</ul>
</li>
<li>(optionally) set the <code>OPT</code> variable to <code>-O3</code> or other g++ optimization level you like (default: <code>-O3</code> )</li>
<li>(optionally) set the <code>DEBUG</code> variable to <code>-g</code> or other g++ debugging option if you want to produce a debug version of the Stxxl library or Stxxl examples (default: not set)</li>
<li>for more variables to tune take a look at <code>make.settings.gnu</code> , they are usually overridden by settings in <code>make.settings.local</code>, using <code>CPPFLAGS</code> and <code>LDFLAGS</code>, for example, you can add arbitrary compiler and linker options</li>
</ul>
</li>
<li>Run: <div class="fragment"><pre class="fragment">make library_g++ </pre></div></li>
<li>Run: <div class="fragment"><pre class="fragment">make tests_g++ </pre></div> (optional, if you want to compile and run some test programs)</li>
</ul>
<h2><a class="anchor" id="build_apps"></a>
Building an Application</h2>
<p>After compiling the library, some Makefile variables are written to <code>stxxl.mk</code> (<code>pmstxxl.mk</code> if you have built with parallel mode, <code>mcstxxl.mk</code> if you have built with MCSTL) in your <code>STXXL_ROOT</code> directory. This file should be included from your application's Makefile.</p>
<p>The following variables can be used:</p>
<ul>
<li><code>STXXL_CXX</code> - the compiler used to build the <code>S<small>TXXL</small></code> library, it's recommended to use the same to build your applications</li>
<li><code>STXXL_CPPFLAGS</code> - add these flags to the compile commands</li>
<li><code>STXXL_LDLIBS</code> - add these libraries to the link commands</li>
</ul>
<p>An example Makefile for an application using <code>S<small>TXXL</small></code>: </p>
<div class="fragment"><pre class="fragment">
STXXL_ROOT      ?= .../stxxl
STXXL_CONFIG    ?= stxxl.mk
include $(STXXL_ROOT)/$(STXXL_CONFIG)

# use the variables from stxxl.mk
CXX              = $(STXXL_CXX)
CPPFLAGS        += $(STXXL_CPPFLAGS)
LDLIBS          += $(STXXL_LDLIBS)

# add your own optimization, warning, debug, ... flags
# (these are *not* set in stxxl.mk)
CPPFLAGS        += -O3 -Wall -g -DFOO=BAR

# build your application
# (my_example.o is generated from my_example.cpp automatically)
my_example.bin: my_example.o
	$(CXX) $(CXXFLAGS) $(CPPFLAGS) $(LDFLAGS) my_example.o -o $@ $(LDLIBS)
</pre></div><h2><a class="anchor" id="parallel"></a>
Enabling parallel execution</h2>
<p>To enable (shared-memory-)parallel execution of internal computation (in fact, sorting and merging, and random shuffling), you have several options depending on the <a class="el" href="index.html#compilers">compiler version</a> used:</p>
<ul>
<li>Enable the g++ parallel mode specifically for STXXL, by defining <code>STXXL_PARALLEL_MODE_EXPLICIT</code> and enabling OpenMP (<code>-DSTXXL_PARALLEL_MODE_EXPLICIT</code> <code>-fopenmp</code>) during compilation and linkage of your program. Compiling the library binary with this flag enabled is not really necessary, since the most time-consuming operations are called by the generic routines and thus contained in the header files.</li>
<li>Enable the g++ parallel mode for your program globally, by defining <code>_GLIBCXX_PARALLEL</code> and enabling OpenMP (<code>-D_GLIBCXX_PARALLEL</code> <code>-fopenmp</code>). This has the implication that STL algorithms in your program will also be executed in parallel, which may have undesired side effects. These options are automatically used when you built STXXL using the <code>*_pmode</code> target, and your Makefile includes <code>pmstxxl.mk</code>.</li>
<li>Enable MCSTL in your program by setting the include path appropriately. This implies that STL algorithms in your program will also be executed in parallel, which may have undesired side effects. These options are automatically used when you built STXXL using the <code>*_mcstl</code> target, and your Makefile includes <code>mcstxxl.mk</code>.</li>
</ul>
<p>We recommend to try the first option at first.</p>
<p>The number of threads to be used can be set by the environment variable OMP_NUM_THREADS or by calling omp_set_num_threads. Detailed tuning can be achieved as described <a href="http://gcc.gnu.org/onlinedocs/libstdc++/manual/bk01pt03ch18s04.html#parallel_mode.design.tuning">here</a>.</p>
<h2><a class="anchor" id="space"></a>
Disk space</h2>
<p>Before you try to run one of the <code>S<small>TXXL</small></code> examples (or your own <code>S<small>TXXL</small></code> program) you must configure the disk space that will be used as external memory for the library.</p>
<p>To get best performance with <code>S<small>TXXL</small></code> you should assign separate disks to it. These disks should be used by the library only. Since <code>S<small>TXXL</small></code> is developed to exploit disk parallelism, the performance of your external memory application will increase if you use more than one disk. But from how many disks your application can benefit depends on how "I/O bound" it is. With modern disk bandwidths of about 50-75 MiB/s most of applications are I/O bound for one disk. This means that if you add another disk the running time will be halved. Adding more disks might also increase performance significantly.</p>
<h2><a class="anchor" id="filesystem"></a>
Recommended file system</h2>
<p>The library benefits from direct transfers from user memory to disk, which saves superfluous copies. We recommend to use the <code></code> <a href="http://xfs.org">XFS</a> file system, which gives good read and write performance for large files. Note that file creation speed of <code>XFS</code> is a bit slower, so that disk files should be precreated for optimal performance.</p>
<p>If the filesystems only use is to store one large <code>S<small>TXXL</small></code> disk file, we also recommend to add the following options to the <code>mkfs.xfs</code> command to gain maximum performance: </p>
<div class="fragment"><pre class="fragment">-d agcount=1 -l size=512b </pre></div><p>The following filesystems have been reported not to support direct I/O: <code>tmpfs</code> , <code>glusterfs</code> . Since direct I/O is enabled by default, you may recompile <code>S<small>TXXL</small></code> with <code>STXXL_DIRECT_IO_OFF</code> defined to access files on these file systems.</p>
<h2><a class="anchor" id="configuration"></a>
Disk configuration file</h2>
<p>You must define the disk configuration for an <code>S<small>TXXL</small></code> program in a file named <code>'</code>.stxxl' that must reside in the same directory where you execute the program. You can change the default file name for the configuration file by setting the environment variable <code>STXXLCFG</code> .</p>
<p>Each line of the configuration file describes a disk. A disk description uses the following format:<br/>
 <code>disk=full_disk_filename</code>,capacity,access_method</p>
<p>Description of the parameters:</p>
<ul>
<li><code>full_disk_filename</code> : full disk filename. In order to access disks S<small>TXXL</small> uses file access methods. Each disk is represented as a file. If you have a disk that is mounted in Unix to the path /mnt/disk0/, then the correct value for the <code>full_disk_filename</code> would be <code>/mnt/disk0/some_file_name</code> ,</li>
<li><code>capacity</code> : maximum capacity of the disk in megabytes (0 means autogrow, file will be deleted afterwards)</li>
<li><code>access_method</code> : <code>S<small>TXXL</small></code> has a number of different file access implementations for POSIX systems, choose one of them:<ul>
<li><code>syscall</code> : use <code>read</code> and <code>write</code> system calls which perform disk transfers directly on user memory pages without superfluous copying (currently the fastest method)</li>
<li><code>mmap</code> : <code>use</code> <code>mmap</code> and <code>munmap</code> system calls</li>
<li><code>boostfd</code> : access the file using a Boost file descriptor</li>
<li><code>fileperblock_syscall</code>, <code>fileperblock_mmap</code>, <code>fileperblock_boostfd</code> : same as above, but take a single file per block, using full_disk_filename as file name prefix. Usually provide worse performance than the standard variants, but release freed blocks to the file system immediately.</li>
<li><code>simdisk</code> : simulates timings of the IBM IC35L080AVVA07 disk, full_disk_filename must point to a file on a RAM disk partition with sufficient space</li>
<li><code>memory</code> : keeps all data in RAM, for quicker testing</li>
<li><code>wbtl</code> : library-based write-combining (good for writing small blocks onto SSDs), based on <code>syscall</code> </li>
</ul>
</li>
</ul>
<p>See also the example configuration file <code>'config_example'</code> included in the tarball.</p>
<h2><a class="anchor" id="logfiles"></a>
Log files</h2>
<p><code>S<small>TXXL</small></code> produces two kinds of log files, a message and an error log. By setting the environment variables <code>STXXLLOGFILE</code> and <code>STXXLERRLOGFILE</code>, you can configure the location of these files. The default values are <code>stxxl.log</code> and <code>stxxl.errlog</code>, respectively.</p>
<h2><a class="anchor" id="excreation"></a>
Precreating external memory files</h2>
<p>In order to get the maximum performance one should precreate disk files described in the configuration file, before running <code>S<small>TXXL</small></code> applications.</p>
<p>The precreation utility is included in the set of <code>S<small>TXXL</small></code> utilities ( <code>utils/createdisks.bin</code> ). Run this utility for each disk you have defined in the disk configuration file: </p>
<div class="fragment"><pre class="fragment">utils/createdisks.bin capacity full_disk_filename... </pre></div> </div></div><!-- contents -->
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Classes</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Namespaces</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Typedefs</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&#160;</span>Enumerations</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(8)"><span class="SelectionMark">&#160;</span>Enumerator</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(9)"><span class="SelectionMark">&#160;</span>Friends</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(10)"><span class="SelectionMark">&#160;</span>Defines</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>



<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.7.6.1
</small></address>

</body>
</html>
