<?xml version="1.0" encoding="iso-8859-1"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta content="text/html; charset=iso-8859-1" http-equiv="content-type" /><meta name="viewport" content="initial-scale=1"><title>/2012/1119-eSAIS-Inducing-Suffix-and-LCP-Arrays-in-External-Memory/eSAIS-DC3-LCP-0.5.2/src/external/skew3.h - panthema.net</title><link rel="stylesheet" type="text/css" href="/css/base.css" /><link rel="stylesheet" type="text/css" href="/css/fonts.css" /><link rel="alternate" type="application/rss+xml" title="panthema.net Weblog Feed RSS 2.0" href="http://panthema.net/xmlfeed/weblog-rss20.xml" /><link rel="alternate" type="application/atom+xml" title="panthema.net Weblog Feed Atom 1.0" href="http://panthema.net/xmlfeed/weblog-atom10.xml" /><script type="text/javascript" src="/js/base.js"></script><script type="text/javascript">/* <!-- */makeIEHover = function() {var lis = document.getElementById('ptnav').getElementsByTagName('li');for (var i = 0; i < lis.length; i++) {lis[i].onmouseover = function() {this.className += ' sfhover';};lis[i].onmouseout = function() {this.className = this.className.replace(new RegExp(' sfhover\b'), '');};}};if (window.attachEvent) window.attachEvent('onload', makeIEHover);/* --> */</script></head><body style="background-image: url(/img/bgfractal4.jpg)" lang="en"><div class="pttopbar"><div style="float: right"><ul id="ptnav"><li class="top"><a class="ni" href="/"><i class="icon-book"></i> Weblog</a><ul style="margin-left: -6px; margin-top: 4px" class="nx"><li><a href="/2019/">2019</a></li><li><a href="/2018/">2018</a></li><li><a href="/2017/">2017</a></li><li><a href="/2016/">2016</a></li><li><a href="/2015/">2015</a></li><li><a href="/2014/">2014</a></li><li><a href="/2013/">2013</a></li><li><a href="/2012/">2012</a></li><li><a href="/2011/">2011</a></li><li><a href="/2010/">2010</a></li><li><a href="/2009/">2009</a></li><li><a href="/2008/">2008</a></li><li><a href="/2007/">2007</a></li><li><a href="/2006/">2006</a></li><li class="nt"><a href="/2005/">2005</a></li><li class="ns"><a href="/xmlfeed/weblog-rss20.xml">RSS Feed</a></li><li class="nt"><a href="/xmlfeed/weblog-atom10.xml">XML Atom</a></li><li class="ns"><a href="/search.html">Search</a></li></ul></li><li class="top"><a class="ni" href="/tags/"><i class="icon-tags"></i> Tags</a><div style="width: 14em; margin-left: -9em; margin-top: 4px"><a style="font-size: 10pt" href="/tags/algebra.html">algebra</a> <a style="font-size: 16pt" href="/tags/c++.html">c++</a> <a style="font-size: 12pt" href="/tags/code-example.html">code-example</a> <a style="font-size: 14pt" href="/tags/code-snippet.html">code-snippet</a> <a style="font-size: 11pt" href="/tags/coding_tricks.html">coding tricks</a> <a style="font-size: 10pt" href="/tags/compsci.html">compsci</a> <a style="font-size: 10pt" href="/tags/compsci_study_thesis.html">compsci study thesis</a> <a style="font-size: 9pt" href="/tags/crypto-speedtest.html">crypto-speedtest</a> <a style="font-size: 10pt" href="/tags/cryptography.html">cryptography</a> <a style="font-size: 9pt" href="/tags/cryptote.html">cryptote</a> <a style="font-size: 11pt" href="/tags/dissertation.html">dissertation</a> <a style="font-size: 10pt" href="/tags/electronics.html">electronics</a> <a style="font-size: 12pt" href="/tags/flex-bison-cpp-example.html">flex-bison-cpp-example</a> <a style="font-size: 16pt" href="/tags/frontpage.html">frontpage</a> <a style="font-size: 15pt" href="/tags/fun.html">fun</a> <a style="font-size: 10pt" href="/tags/graphviz.html">graphviz</a> <a style="font-size: 9pt" href="http://www.hmtg.de">hartmetall</a> <a style="font-size: 9pt" href="/tags/helppc.html">helppc</a> <a style="font-size: 9pt" href="/tags/hifi_selbstbau.html">hifi selbstbau</a> <a style="font-size: 10pt" href="/tags/latex.html">latex</a> <a style="font-size: 10pt" href="/tags/LEDs.html">LEDs</a> <a style="font-size: 10pt" href="/tags/librivox.html">librivox</a> <a style="font-size: 10pt" href="/tags/linux.html">linux</a> <a style="font-size: 9pt" href="/tags/market.html">market</a> <a style="font-size: 9pt" href="/tags/massive-sorting.html">massive-sorting</a> <a style="font-size: 11pt" href="/tags/maths.html">maths</a> <a style="font-size: 9pt" href="/tags/music.html">music</a> <a style="font-size: 10pt" href="/tags/netfundamentals.html">netfundamentals</a> <a style="font-size: 11pt" href="/tags/ns-3.html">ns-3</a> <a style="font-size: 10pt" href="/tags/parallel-string-sorting.html">parallel-string-sorting</a> <a style="font-size: 14pt" href="/tags/parsing.html">parsing</a> <a style="font-size: 9pt" href="/tags/qtsqlview.html">qtsqlview</a> <a style="font-size: 14pt" href="/tags/research.html">research</a> <a style="font-size: 11pt" href="/tags/sdios06.html">sdios06</a> <a style="font-size: 9pt" href="/tags/sdlfractal.html">sdlfractal</a> <a style="font-size: 16pt" href="/tags/sorting.html">sorting</a> <a style="font-size: 13pt" href="/tags/sound_of_sorting.html">sound of sorting</a> <a style="font-size: 10pt" href="/tags/stringology.html">stringology</a> <a style="font-size: 16pt" href="/tags/stx-btree.html">stx-btree</a> <a style="font-size: 16pt" href="/tags/stxxl.html">stxxl</a> <a style="font-size: 16pt" href="/tags/talk.html">talk</a> <a style="font-size: 15pt" href="/tags/thrill.html">thrill</a> <a style="font-size: 10pt" href="/tags/tutorium.html">tutorium</a> <a style="font-size: 16pt" href="/tags/university.html">university</a> <a style="font-size: 13pt" href="/tags/utilities.html">utilities</a> <a style="font-size: 10pt" href="/tags/vncrec.html">vncrec</a> <a style="font-size: 9pt" href="/tags/webdesign.html">webdesign</a> </div></li><li class="top"> <a class="ni" href="#"><i class="icon-cubes"></i> Projects</a> <ul style="margin-left: -8em; margin-top: 4px;" class="nx"> <li><a href="/2009/cryptote/">CryptoTE</a></li> <li><a href="/2009/digup/">digup</a></li> <li><a href="/2013/disk-filltest/">disk-filltest</a></li> <li><a href="/2012/1119-eSAIS-Inducing-Suffix-and-LCP-Arrays-in-External-Memory/">eSAIS-LCP</a></li> <li><a href="/2007/flex-bison-cpp-example/">Flex Bison C++ Example</a></li> <li><a href="/2013/malloc_count/">malloc_count</a></li> <li><a href="/2016/0114-diploma-thesis/">On Bispanning Graphs</a></li> <li><a href="/2013/pmbw/">Parallel Memory Bandwidth</a></li> <li><a href="/2013/parallel-string-sorting/">Parallel String Sorting</a></li> <li><a href="/2014/sqlplot-tools/">SqlPlotTools</a></li> <li><a href="/2013/sound-of-sorting/">The Sound of Sorting</a></li> <li><a href="/2007/stx-btree/">STX B+ Tree</a></li> <li><a href="/2010/stx-cbtreedb/">STX Constant BTreeDB</a></li> <li><a href="/2010/stx-execpipe/">STX ExecPipe</a></li> <li><a href="/2007/stx-exparser/">STX Expression Parser</a></li> <li><a href="/tags/stxxl.html">STXXL 1.4</a></li> <li><a href="/tags/thrill.html">Thrill - Big Data Framework</a></li> <li class="nt"><a href="/2014/vncrec-rgb/">VNCrec RGB 0.4</a></li> <li class="ns"><a href="/search.html">Search</a></li> </ul></li><li class="top"> <a class="ni" href="/publications.html"><i class="icon-graduation-cap"></i> Publications</a></li><li class="top"> <a class="ni" href="/about/"><i class="icon-info-circled"></i> About</a> <ul style="margin-left: -6em; margin-top: 4px" class="nx"> <li><a href="/about/">Timo Bingmann</a></li> <li><a href="/about/impressum.html">Impressum</a></li> </ul></li><li class="top"> <a class="ni" href="/subscribe.html"><i class="icon-rss-squared"></i> Subscribe</a></li></ul></div><div style="padding: 6px"><a href="/">panthema</a>  / <a href="/2012/">2012</a> / <a href="/2012/1119-eSAIS-Inducing-Suffix-and-LCP-Arrays-in-External-Memory/">1119-eSAIS-Inducing-Suffix-and-LCP-Arrays-in-External-Memory</a> / <a href="/2012/1119-eSAIS-Inducing-Suffix-and-LCP-Arrays-in-External-Memory/eSAIS-DC3-LCP-0.5.2/">eSAIS-DC3-LCP-0.5.2</a> / <a href="/2012/1119-eSAIS-Inducing-Suffix-and-LCP-Arrays-in-External-Memory/eSAIS-DC3-LCP-0.5.2/src/">src</a> / <a href="/2012/1119-eSAIS-Inducing-Suffix-and-LCP-Arrays-in-External-Memory/eSAIS-DC3-LCP-0.5.2/src/external/">external</a> / <a href="/2012/1119-eSAIS-Inducing-Suffix-and-LCP-Arrays-in-External-Memory/eSAIS-DC3-LCP-0.5.2/src/external/skew3.h.html">skew3.h</a> (<a href="/2012/1119-eSAIS-Inducing-Suffix-and-LCP-Arrays-in-External-Memory/eSAIS-DC3-LCP-0.5.2/src/external/skew3.h">Download File</a>)</div></div><div class="ptfullwidth"><pre class="codesnippet" style="font-family: monospace"><tt><span class="comment">// -*- mode: c++; mode: rebox; fill-column: 100; rebox-min-fill-column: 100 -*-</span>

<span class="comment">/******************************************************************************</span>
<span class="comment"> * src/external/skew3.h</span>
<span class="comment"> *</span>
<span class="comment"> * Algorithm implementing skew3 aka DC3 in external memory.</span>
<span class="comment"> *</span>
<span class="comment"> * Originally implemented in STXXL by Jens Mehnert (2004)</span>
<span class="comment"> * LCP construction with RMQs and cleanup by Timo Bingmann (2012)</span>
<span class="comment"> *</span>
<span class="comment"> * Dementiev, R., Kaerkkaeinen, J., Mehnert, J., &amp; Sanders, P. (2008).</span>
<span class="comment"> * Better external memory suffix array construction. JEA, Volume 12.</span>
<span class="comment"> *</span>
<span class="comment"> ******************************************************************************</span>
<span class="comment"> * Copyright (C) 2004 Jens Mehnert</span>
<span class="comment"> * Copyright (C) 2012 Timo Bingmann </span><span class="url">&lt;tb@panthema.net&gt;</span>
<span class="comment"> *</span>
<span class="comment"> * This program is free software: you can redistribute it and/or modify it</span>
<span class="comment"> * under the terms of the GNU General Public License as published by the Free</span>
<span class="comment"> * Software Foundation, either version 3 of the License, or (at your option)</span>
<span class="comment"> * any later version.</span>
<span class="comment"> *</span>
<span class="comment"> * This program is distributed in the hope that it will be useful, but WITHOUT</span>
<span class="comment"> * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or</span>
<span class="comment"> * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License for</span>
<span class="comment"> * more details.</span>
<span class="comment"> *</span>
<span class="comment"> * You should have received a copy of the GNU General Public License along with</span>
<span class="comment"> * this program.  If not, see </span><span class="url">&lt;http://www.gnu.org/licenses/&gt;</span><span class="comment">.</span>
<span class="comment"> *****************************************************************************/</span>

<span class="keyword">namespace</span><span class="normal"> skew </span><span class="cbracket">{</span>

<span class="keyword">using</span><span class="normal"> </span><span class="keyword">namespace</span><span class="normal"> tuples</span><span class="symbol">;</span>
<span class="keyword">using</span><span class="normal"> </span><span class="keyword">namespace</span><span class="normal"> stxxl</span><span class="symbol">;</span>

<span class="keyword">template</span><span class="normal"> </span><span class="symbol">&lt;</span><span class="keyword">typename</span><span class="normal"> </span><span class="classname">offset_type</span><span class="symbol">&gt;</span>
<span class="keyword">class</span><span class="normal"> </span><span class="classname">skew</span>
<span class="cbracket">{</span>
<span class="keyword">public</span><span class="symbol">:</span>
<span class="normal">    </span><span class="comment">/***********************************************************************************************</span>
<span class="comment">     * Skew debug configurations                                                                   *</span>
<span class="comment">     ***********************************************************************************************/</span>

<span class="normal">    </span><span class="keyword">static</span><span class="normal"> </span><span class="keyword">const</span><span class="normal"> </span><span class="type">bool</span><span class="normal"> debug </span><span class="symbol">=</span><span class="normal"> </span><span class="keyword">true</span><span class="symbol">;</span>

<span class="normal">    </span><span class="keyword">static</span><span class="normal"> </span><span class="keyword">const</span><span class="normal"> </span><span class="type">bool</span><span class="normal"> debug_input </span><span class="symbol">=</span><span class="normal"> </span><span class="keyword">false</span><span class="symbol">;</span>
<span class="normal">    </span><span class="keyword">static</span><span class="normal"> </span><span class="keyword">const</span><span class="normal"> </span><span class="type">bool</span><span class="normal"> debug_lexname </span><span class="symbol">=</span><span class="normal"> </span><span class="keyword">false</span><span class="symbol">;</span>
<span class="normal">    </span><span class="keyword">static</span><span class="normal"> </span><span class="keyword">const</span><span class="normal"> </span><span class="type">bool</span><span class="normal"> debug_isa </span><span class="symbol">=</span><span class="normal"> </span><span class="keyword">false</span><span class="symbol">;</span>
<span class="normal">    </span><span class="keyword">static</span><span class="normal"> </span><span class="keyword">const</span><span class="normal"> </span><span class="type">bool</span><span class="normal"> debug_merge </span><span class="symbol">=</span><span class="normal"> </span><span class="keyword">false</span><span class="symbol">;</span>
<span class="normal">    </span><span class="keyword">static</span><span class="normal"> </span><span class="keyword">const</span><span class="normal"> </span><span class="type">bool</span><span class="normal"> debug_mcreate </span><span class="symbol">=</span><span class="normal"> </span><span class="keyword">false</span><span class="symbol">;</span>
<span class="normal">    </span><span class="keyword">static</span><span class="normal"> </span><span class="keyword">const</span><span class="normal"> </span><span class="type">bool</span><span class="normal"> debug_S012 </span><span class="symbol">=</span><span class="normal"> </span><span class="keyword">false</span><span class="symbol">;</span>
<span class="normal">    </span><span class="keyword">static</span><span class="normal"> </span><span class="keyword">const</span><span class="normal"> </span><span class="type">bool</span><span class="normal"> debug_merge_result </span><span class="symbol">=</span><span class="normal"> </span><span class="keyword">false</span><span class="symbol">;</span>
<span class="normal">    </span><span class="keyword">static</span><span class="normal"> </span><span class="keyword">const</span><span class="normal"> </span><span class="type">bool</span><span class="normal"> debug_merge_lcp </span><span class="symbol">=</span><span class="normal"> </span><span class="keyword">false</span><span class="symbol">;</span>
<span class="normal">    </span><span class="keyword">static</span><span class="normal"> </span><span class="keyword">const</span><span class="normal"> </span><span class="type">bool</span><span class="normal"> debug_lcp_expand </span><span class="symbol">=</span><span class="normal"> </span><span class="keyword">false</span><span class="symbol">;</span>
<span class="normal">    </span><span class="keyword">static</span><span class="normal"> </span><span class="keyword">const</span><span class="normal"> </span><span class="type">bool</span><span class="normal"> debug_lcp_build </span><span class="symbol">=</span><span class="normal"> </span><span class="keyword">false</span><span class="symbol">;</span>
<span class="normal">    </span><span class="keyword">static</span><span class="normal"> </span><span class="keyword">const</span><span class="normal"> </span><span class="type">bool</span><span class="normal"> debug_rmq </span><span class="symbol">=</span><span class="normal"> </span><span class="keyword">false</span><span class="symbol">;</span>

<span class="normal">    </span><span class="comment">/***********************************************************************************************</span>
<span class="comment">     * Skew numbering overview                                                                     *</span>
<span class="comment">     ***********************************************************************************************/</span>

<span class="normal">    </span><span class="comment">/*</span>
<span class="comment">     * Numbering and alphabet translation must be defined correctly calculate LCPs. The current</span>
<span class="comment">     * schema translates in the following steps:</span>
<span class="comment">     * a) input -&gt; quads - add +1 to characters when placed into quads to free 0 for termination</span>
<span class="comment">     * b) lexnaming of quads returns lexnames starting with 0.</span>
<span class="comment">     * c) lexnaming create LCP_N, also based at 0, thus LCP_N[1] = lcp_T(name_0,name_1)</span>
<span class="comment">     * d) SA is generated zero-based, as well as ISA.</span>
<span class="comment">     * e) during build_sa +1 is added to the ranks from ISA, to free 0 for termination ranks.</span>
<span class="comment">     *</span>
<span class="comment">     */</span>

<span class="normal">    </span><span class="comment">/***********************************************************************************************</span>
<span class="comment">     * Skew algorithm configurations                                                               *</span>
<span class="comment">     ***********************************************************************************************/</span>

<span class="normal">    </span><span class="comment">/** Types */</span>

<span class="normal">    </span><span class="keyword">typedef</span><span class="normal"> tuples</span><span class="symbol">::</span><span class="usertype">pair&lt;offset_type, offset_type&gt;</span><span class="normal"> skew_pair_type</span><span class="symbol">;</span>
<span class="normal">    </span><span class="keyword">typedef</span><span class="normal"> tuples</span><span class="symbol">::</span><span class="usertype">triple&lt;offset_type, offset_type, offset_type&gt;</span><span class="normal"> skew_triple_type</span><span class="symbol">;</span>
<span class="normal">    </span><span class="keyword">typedef</span><span class="normal"> tuples</span><span class="symbol">::</span><span class="usertype">quad&lt;offset_type, offset_type, offset_type, offset_type&gt;</span><span class="normal"> skew_quad_type</span><span class="symbol">;</span>
<span class="normal">    </span><span class="keyword">typedef</span><span class="normal"> tuples</span><span class="symbol">::</span><span class="usertype">quint&lt;offset_type, offset_type, offset_type, offset_type, offset_type&gt;</span><span class="normal"> skew_quint_type</span><span class="symbol">;</span>

<span class="normal">    </span><span class="comment">/* Perhaps use a templateparameter for the following */</span>

<span class="normal">    </span><span class="keyword">static</span><span class="normal"> </span><span class="keyword">const</span><span class="normal"> </span><span class="usertype">size_t</span><span class="normal"> vector_block_size </span><span class="symbol">=</span><span class="normal"> </span><span class="symbol">::</span><span class="normal">block_size</span><span class="symbol">;</span>

<span class="normal">    </span><span class="keyword">typedef</span><span class="normal"> </span><span class="keyword">typename</span><span class="normal"> </span><span class="classname">stxxl</span><span class="symbol">::</span><span class="normal">VECTOR_GENERATOR</span><span class="symbol">&lt;</span><span class="normal">offset_type</span><span class="symbol">,</span><span class="normal"> </span><span class="number">8</span><span class="symbol">,</span><span class="normal"> </span><span class="number">2</span><span class="symbol">,</span><span class="normal"> vector_block_size</span><span class="symbol">&gt;::</span><span class="usertype">result</span><span class="normal"> offset_array_type</span><span class="symbol">;</span>
<span class="normal">    </span><span class="keyword">typedef</span><span class="normal"> stream</span><span class="symbol">::</span><span class="normal">vector_iterator2stream </span><span class="symbol">&lt;</span><span class="keyword">typename</span><span class="normal"> </span><span class="classname">offset_array_type</span><span class="symbol">::</span><span class="normal">iterator</span><span class="symbol">&gt;</span><span class="normal"> offset_array_it_rg</span><span class="symbol">;</span>

<span class="preproc">#if</span><span class="normal"> LCP_CALC</span>
<span class="normal">    </span><span class="keyword">typedef</span><span class="normal"> </span><span class="keyword">typename</span><span class="normal"> </span><span class="classname">stxxl</span><span class="symbol">::</span><span class="normal">VECTOR_GENERATOR</span><span class="symbol">&lt;</span><span class="normal">skew_pair_type</span><span class="symbol">,</span><span class="normal"> </span><span class="number">8</span><span class="symbol">,</span><span class="normal"> </span><span class="number">2</span><span class="symbol">,</span><span class="normal"> vector_block_size</span><span class="symbol">&gt;::</span><span class="usertype">result</span><span class="normal"> skew_pair_array_type</span><span class="symbol">;</span>
<span class="normal">    </span><span class="keyword">typedef</span><span class="normal"> stream</span><span class="symbol">::</span><span class="normal">vector_iterator2stream </span><span class="symbol">&lt;</span><span class="keyword">typename</span><span class="normal"> </span><span class="classname">skew_pair_array_type</span><span class="symbol">::</span><span class="normal">iterator</span><span class="symbol">&gt;</span><span class="normal"> skew_pair_array_it_rg</span><span class="symbol">;</span>

<span class="normal">    </span><span class="keyword">typedef</span><span class="normal"> </span><span class="keyword">typename</span><span class="normal"> </span><span class="classname">stxxl</span><span class="symbol">::</span><span class="normal">VECTOR_GENERATOR</span><span class="symbol">&lt;</span><span class="normal">uint8_t</span><span class="symbol">,</span><span class="normal"> </span><span class="number">8</span><span class="symbol">,</span><span class="normal"> </span><span class="number">2</span><span class="symbol">,</span><span class="normal"> vector_block_size</span><span class="symbol">&gt;::</span><span class="usertype">result</span><span class="normal"> uint8_array_type</span><span class="symbol">;</span>
<span class="normal">    </span><span class="keyword">typedef</span><span class="normal"> stream</span><span class="symbol">::</span><span class="normal">vector_iterator2stream </span><span class="symbol">&lt;</span><span class="keyword">typename</span><span class="normal"> </span><span class="classname">uint8_array_type</span><span class="symbol">::</span><span class="normal">iterator</span><span class="symbol">&gt;</span><span class="normal"> uint8_array_it_rg</span><span class="symbol">;</span>
<span class="preproc">#endif</span><span class="normal"> </span><span class="comment">// LCP_CALC</span>

<span class="normal">    </span><span class="comment">/***********************************************************************************************</span>
<span class="comment">     * Helper Functions needed by the skew algorithm.                                              *</span>
<span class="comment">     ***********************************************************************************************/</span>

<span class="normal">    </span><span class="comment">/** comparism function for the mod0 tuples. */</span>

<span class="normal">    </span><span class="keyword">struct</span><span class="normal"> </span><span class="classname">less_mod0</span>
<span class="normal">    </span><span class="cbracket">{</span>
<span class="normal">        </span><span class="keyword">typedef</span><span class="normal"> </span><span class="usertype">skew_quint_type</span><span class="normal"> value_type</span><span class="symbol">;</span>

<span class="normal">        </span><span class="type">bool</span><span class="normal"> </span><span class="keyword">operator</span><span class="symbol">()</span><span class="normal"> </span><span class="symbol">(</span><span class="keyword">const</span><span class="normal"> value_type</span><span class="symbol">&amp;</span><span class="normal"> a</span><span class="symbol">,</span><span class="normal"> </span><span class="keyword">const</span><span class="normal"> value_type</span><span class="symbol">&amp;</span><span class="normal"> b</span><span class="symbol">)</span><span class="normal"> </span><span class="keyword">const</span>
<span class="normal">        </span><span class="cbracket">{</span>
<span class="normal">            </span><span class="keyword">if</span><span class="normal"> </span><span class="symbol">(</span><span class="normal">a</span><span class="symbol">.</span><span class="normal">second </span><span class="symbol">==</span><span class="normal"> b</span><span class="symbol">.</span><span class="normal">second</span><span class="symbol">)</span><span class="normal"> </span><span class="cbracket">{</span>
<span class="normal">                </span><span class="keyword">return</span><span class="normal"> a</span><span class="symbol">.</span><span class="normal">fourth </span><span class="symbol">&lt;</span><span class="normal"> b</span><span class="symbol">.</span><span class="normal">fourth</span><span class="symbol">;</span>
<span class="normal">            </span><span class="cbracket">}</span>
<span class="normal">            </span><span class="keyword">else</span><span class="normal"> </span><span class="cbracket">{</span>
<span class="normal">                </span><span class="keyword">return</span><span class="normal"> a</span><span class="symbol">.</span><span class="normal">second </span><span class="symbol">&lt;</span><span class="normal"> b</span><span class="symbol">.</span><span class="normal">second</span><span class="symbol">;</span>
<span class="normal">            </span><span class="cbracket">}</span>
<span class="normal">        </span><span class="cbracket">}</span>

<span class="normal">        </span><span class="keyword">static</span><span class="normal"> </span><span class="usertype">value_type</span><span class="normal"> </span><span class="function">min_value</span><span class="symbol">()</span><span class="normal"> </span><span class="cbracket">{</span><span class="normal"> </span><span class="keyword">return</span><span class="normal"> value_type</span><span class="symbol">::</span><span class="function">min_value</span><span class="symbol">();</span><span class="normal"> </span><span class="cbracket">}</span>
<span class="normal">        </span><span class="keyword">static</span><span class="normal"> </span><span class="usertype">value_type</span><span class="normal"> </span><span class="function">max_value</span><span class="symbol">()</span><span class="normal"> </span><span class="cbracket">{</span><span class="normal"> </span><span class="keyword">return</span><span class="normal"> value_type</span><span class="symbol">::</span><span class="function">max_value</span><span class="symbol">();</span><span class="normal"> </span><span class="cbracket">}</span>
<span class="normal">    </span><span class="cbracket">}</span><span class="symbol">;</span>

<span class="normal">    </span><span class="comment">/** compares with respect to the first and second component. */</span>

<span class="normal">    </span><span class="keyword">typedef</span><span class="normal"> tuples</span><span class="symbol">::</span><span class="usertype">pair_less1st&lt;skew_pair_type&gt;</span><span class="normal"> less_pair_1st</span><span class="symbol">;</span>
<span class="normal">    </span><span class="keyword">typedef</span><span class="normal"> tuples</span><span class="symbol">::</span><span class="usertype">pair_less2nd&lt;skew_pair_type&gt;</span><span class="normal"> less_pair_2nd</span><span class="symbol">;</span>

<span class="normal">    </span><span class="keyword">typedef</span><span class="normal"> tuples</span><span class="symbol">::</span><span class="usertype">triple_less1st&lt;skew_triple_type&gt;</span><span class="normal"> less_triple_1st</span><span class="symbol">;</span>

<span class="normal">    </span><span class="comment">/** compares quadruples with respect to the first component. */</span>

<span class="normal">    </span><span class="keyword">struct</span><span class="normal"> </span><span class="classname">less_quad_2nd</span>
<span class="normal">    </span><span class="cbracket">{</span>
<span class="normal">        </span><span class="keyword">typedef</span><span class="normal"> </span><span class="usertype">skew_quad_type</span><span class="normal"> value_type</span><span class="symbol">;</span>

<span class="normal">        </span><span class="type">bool</span><span class="normal"> </span><span class="keyword">operator</span><span class="symbol">()</span><span class="normal"> </span><span class="symbol">(</span><span class="keyword">const</span><span class="normal"> skew_quad_type</span><span class="symbol">&amp;</span><span class="normal"> a</span><span class="symbol">,</span><span class="normal"> </span><span class="keyword">const</span><span class="normal"> skew_quad_type</span><span class="symbol">&amp;</span><span class="normal"> b</span><span class="symbol">)</span><span class="normal"> </span><span class="keyword">const</span>
<span class="normal">        </span><span class="cbracket">{</span>
<span class="normal">            </span><span class="keyword">return</span><span class="normal"> a</span><span class="symbol">.</span><span class="normal">second </span><span class="symbol">&lt;</span><span class="normal"> b</span><span class="symbol">.</span><span class="normal">second</span><span class="symbol">;</span>
<span class="normal">        </span><span class="cbracket">}</span>

<span class="normal">        </span><span class="keyword">static</span><span class="normal"> </span><span class="usertype">value_type</span><span class="normal"> </span><span class="function">min_value</span><span class="symbol">()</span><span class="normal"> </span><span class="cbracket">{</span><span class="normal"> </span><span class="keyword">return</span><span class="normal"> value_type</span><span class="symbol">::</span><span class="function">min_value</span><span class="symbol">();</span><span class="normal"> </span><span class="cbracket">}</span>
<span class="normal">        </span><span class="keyword">static</span><span class="normal"> </span><span class="usertype">value_type</span><span class="normal"> </span><span class="function">max_value</span><span class="symbol">()</span><span class="normal"> </span><span class="cbracket">{</span><span class="normal"> </span><span class="keyword">return</span><span class="normal"> value_type</span><span class="symbol">::</span><span class="function">max_value</span><span class="symbol">();</span><span class="normal"> </span><span class="cbracket">}</span>
<span class="normal">    </span><span class="cbracket">}</span><span class="symbol">;</span>

<span class="normal">    </span><span class="comment">/** compares five-tuples with respect to the second component. */</span>

<span class="normal">    </span><span class="keyword">struct</span><span class="normal"> </span><span class="classname">less_quint_2nd</span>
<span class="normal">    </span><span class="cbracket">{</span>
<span class="normal">        </span><span class="keyword">typedef</span><span class="normal"> </span><span class="usertype">skew_quint_type</span><span class="normal"> value_type</span><span class="symbol">;</span>

<span class="normal">        </span><span class="type">bool</span><span class="normal"> </span><span class="keyword">operator</span><span class="symbol">()</span><span class="normal"> </span><span class="symbol">(</span><span class="keyword">const</span><span class="normal"> value_type</span><span class="symbol">&amp;</span><span class="normal"> a</span><span class="symbol">,</span><span class="normal"> </span><span class="keyword">const</span><span class="normal"> value_type</span><span class="symbol">&amp;</span><span class="normal"> b</span><span class="symbol">)</span><span class="normal"> </span><span class="keyword">const</span>
<span class="normal">        </span><span class="cbracket">{</span>
<span class="normal">            </span><span class="keyword">return</span><span class="normal"> a</span><span class="symbol">.</span><span class="normal">second </span><span class="symbol">&lt;</span><span class="normal"> b</span><span class="symbol">.</span><span class="normal">second</span><span class="symbol">;</span>
<span class="normal">        </span><span class="cbracket">}</span>

<span class="normal">        </span><span class="keyword">static</span><span class="normal"> </span><span class="usertype">value_type</span><span class="normal"> </span><span class="function">min_value</span><span class="symbol">()</span><span class="normal"> </span><span class="cbracket">{</span><span class="normal"> </span><span class="keyword">return</span><span class="normal"> value_type</span><span class="symbol">::</span><span class="function">min_value</span><span class="symbol">();</span><span class="normal"> </span><span class="cbracket">}</span>
<span class="normal">        </span><span class="keyword">static</span><span class="normal"> </span><span class="usertype">value_type</span><span class="normal"> </span><span class="function">max_value</span><span class="symbol">()</span><span class="normal"> </span><span class="cbracket">{</span><span class="normal"> </span><span class="keyword">return</span><span class="normal"> value_type</span><span class="symbol">::</span><span class="function">max_value</span><span class="symbol">();</span><span class="normal"> </span><span class="cbracket">}</span>
<span class="normal">    </span><span class="cbracket">}</span><span class="symbol">;</span>

<span class="normal">    </span><span class="comment">/**</span>
<span class="comment">     * Put the (0 mod 2) [which are the 1,2 mod 3 tuples] tuples at the begin.</span>
<span class="comment">     */</span>
<span class="normal">    </span><span class="keyword">struct</span><span class="normal"> </span><span class="classname">less_skew</span>
<span class="normal">    </span><span class="cbracket">{</span>
<span class="normal">        </span><span class="keyword">typedef</span><span class="normal"> </span><span class="usertype">skew_pair_type</span><span class="normal"> value_type</span><span class="symbol">;</span>

<span class="normal">        </span><span class="type">bool</span><span class="normal"> </span><span class="keyword">operator</span><span class="symbol">()</span><span class="normal"> </span><span class="symbol">(</span><span class="keyword">const</span><span class="normal"> value_type</span><span class="symbol">&amp;</span><span class="normal"> a</span><span class="symbol">,</span><span class="normal"> </span><span class="keyword">const</span><span class="normal"> value_type</span><span class="symbol">&amp;</span><span class="normal"> b</span><span class="symbol">)</span><span class="normal"> </span><span class="keyword">const</span>
<span class="normal">        </span><span class="cbracket">{</span>
<span class="normal">            </span><span class="keyword">if</span><span class="normal"> </span><span class="symbol">((</span><span class="normal">a</span><span class="symbol">.</span><span class="normal">first </span><span class="symbol">&amp;</span><span class="normal"> </span><span class="number">1</span><span class="symbol">)</span><span class="normal"> </span><span class="symbol">==</span><span class="normal"> </span><span class="symbol">(</span><span class="normal">b</span><span class="symbol">.</span><span class="normal">first </span><span class="symbol">&amp;</span><span class="normal"> </span><span class="number">1</span><span class="symbol">))</span><span class="normal"> </span><span class="cbracket">{</span>
<span class="normal">                </span><span class="keyword">return</span><span class="normal"> a</span><span class="symbol">.</span><span class="normal">first </span><span class="symbol">&lt;</span><span class="normal"> b</span><span class="symbol">.</span><span class="normal">first</span><span class="symbol">;</span>
<span class="normal">            </span><span class="cbracket">}</span>
<span class="normal">            </span><span class="keyword">else</span>
<span class="normal">            </span><span class="cbracket">{</span>
<span class="normal">                </span><span class="keyword">return</span><span class="normal"> </span><span class="symbol">(</span><span class="normal">a</span><span class="symbol">.</span><span class="normal">first </span><span class="symbol">&amp;</span><span class="normal"> </span><span class="number">1</span><span class="symbol">)</span><span class="normal"> </span><span class="symbol">&lt;</span><span class="normal"> </span><span class="symbol">(</span><span class="normal">b</span><span class="symbol">.</span><span class="normal">first </span><span class="symbol">&amp;</span><span class="normal"> </span><span class="number">1</span><span class="symbol">);</span>
<span class="normal">            </span><span class="cbracket">}</span>
<span class="normal">        </span><span class="cbracket">}</span>

<span class="normal">        </span><span class="keyword">static</span><span class="normal"> </span><span class="usertype">value_type</span><span class="normal"> </span><span class="function">min_value</span><span class="symbol">()</span><span class="normal"> </span><span class="cbracket">{</span><span class="normal"> </span><span class="keyword">return</span><span class="normal"> value_type</span><span class="symbol">::</span><span class="function">min_value</span><span class="symbol">();</span><span class="normal"> </span><span class="cbracket">}</span>
<span class="normal">        </span><span class="keyword">static</span><span class="normal"> </span><span class="usertype">value_type</span><span class="normal"> </span><span class="function">max_value</span><span class="symbol">()</span><span class="normal"> </span><span class="cbracket">{</span><span class="normal"> </span><span class="keyword">return</span><span class="normal"> value_type</span><span class="symbol">::</span><span class="function">max_value</span><span class="symbol">();</span><span class="normal"> </span><span class="cbracket">}</span>
<span class="normal">    </span><span class="cbracket">}</span><span class="symbol">;</span>

<span class="normal">    </span><span class="comment">/** Sort skew_quad datatype. */</span>
<span class="normal">    </span><span class="keyword">template</span><span class="normal"> </span><span class="symbol">&lt;</span><span class="keyword">typename</span><span class="normal"> </span><span class="classname">alphabet_type</span><span class="symbol">&gt;</span>
<span class="normal">    </span><span class="keyword">struct</span><span class="normal"> </span><span class="classname">less_quad</span>
<span class="normal">    </span><span class="cbracket">{</span>
<span class="normal">        </span><span class="keyword">typedef</span><span class="normal"> </span><span class="keyword">typename</span><span class="normal"> </span><span class="classname">tuples</span><span class="symbol">::</span><span class="usertype">quad&lt;offset_type, alphabet_type, alphabet_type, alphabet_type&gt;</span><span class="normal"> value_type</span><span class="symbol">;</span>

<span class="normal">        </span><span class="type">bool</span><span class="normal"> </span><span class="keyword">operator</span><span class="symbol">()</span><span class="normal"> </span><span class="symbol">(</span><span class="keyword">const</span><span class="normal"> value_type</span><span class="symbol">&amp;</span><span class="normal"> a</span><span class="symbol">,</span><span class="normal"> </span><span class="keyword">const</span><span class="normal"> value_type</span><span class="symbol">&amp;</span><span class="normal"> b</span><span class="symbol">)</span><span class="normal"> </span><span class="keyword">const</span>
<span class="normal">        </span><span class="cbracket">{</span>
<span class="normal">            </span><span class="keyword">if</span><span class="normal"> </span><span class="symbol">(</span><span class="normal">a</span><span class="symbol">.</span><span class="normal">second </span><span class="symbol">==</span><span class="normal"> b</span><span class="symbol">.</span><span class="normal">second</span><span class="symbol">)</span><span class="normal"> </span><span class="cbracket">{</span>
<span class="normal">                </span><span class="keyword">if</span><span class="normal"> </span><span class="symbol">(</span><span class="normal">a</span><span class="symbol">.</span><span class="normal">third </span><span class="symbol">==</span><span class="normal"> b</span><span class="symbol">.</span><span class="normal">third</span><span class="symbol">)</span><span class="normal"> </span><span class="cbracket">{</span>
<span class="normal">                    </span><span class="keyword">return</span><span class="normal"> a</span><span class="symbol">.</span><span class="normal">fourth </span><span class="symbol">&lt;</span><span class="normal"> b</span><span class="symbol">.</span><span class="normal">fourth</span><span class="symbol">;</span>
<span class="normal">                </span><span class="cbracket">}</span>
<span class="normal">                </span><span class="keyword">else</span><span class="normal"> </span><span class="cbracket">{</span>
<span class="normal">                    </span><span class="keyword">return</span><span class="normal"> a</span><span class="symbol">.</span><span class="normal">third </span><span class="symbol">&lt;</span><span class="normal"> b</span><span class="symbol">.</span><span class="normal">third</span><span class="symbol">;</span>
<span class="normal">                </span><span class="cbracket">}</span>
<span class="normal">            </span><span class="cbracket">}</span>
<span class="normal">            </span><span class="keyword">else</span><span class="normal"> </span><span class="cbracket">{</span>
<span class="normal">                </span><span class="keyword">return</span><span class="normal"> a</span><span class="symbol">.</span><span class="normal">second </span><span class="symbol">&lt;</span><span class="normal"> b</span><span class="symbol">.</span><span class="normal">second</span><span class="symbol">;</span>
<span class="normal">            </span><span class="cbracket">}</span>
<span class="normal">        </span><span class="cbracket">}</span>

<span class="normal">        </span><span class="keyword">static</span><span class="normal"> </span><span class="usertype">value_type</span><span class="normal"> </span><span class="function">min_value</span><span class="symbol">()</span><span class="normal"> </span><span class="cbracket">{</span><span class="normal"> </span><span class="keyword">return</span><span class="normal"> value_type</span><span class="symbol">::</span><span class="function">min_value</span><span class="symbol">();</span><span class="normal"> </span><span class="cbracket">}</span>
<span class="normal">        </span><span class="keyword">static</span><span class="normal"> </span><span class="usertype">value_type</span><span class="normal"> </span><span class="function">max_value</span><span class="symbol">()</span><span class="normal"> </span><span class="cbracket">{</span><span class="normal"> </span><span class="keyword">return</span><span class="normal"> value_type</span><span class="symbol">::</span><span class="function">max_value</span><span class="symbol">();</span><span class="normal"> </span><span class="cbracket">}</span>
<span class="normal">    </span><span class="cbracket">}</span><span class="symbol">;</span>

<span class="normal">    </span><span class="comment">/***********************************************************************************************</span>
<span class="comment">     * Skew naming.                                                                                *</span>
<span class="comment">     ***********************************************************************************************/</span>

<span class="normal">    </span><span class="comment">/**</span>
<span class="comment">     * Check, if last two components of two quads are equal.</span>
<span class="comment">     */</span>

<span class="normal">    </span><span class="keyword">template</span><span class="normal"> </span><span class="symbol">&lt;</span><span class="keyword">class</span><span class="normal"> </span><span class="classname">quad_type</span><span class="symbol">&gt;</span>
<span class="normal">    </span><span class="keyword">static</span><span class="normal"> </span><span class="keyword">inline</span><span class="normal"> </span><span class="type">bool</span><span class="normal"> </span><span class="function">quad_eq</span><span class="symbol">(</span><span class="keyword">const</span><span class="normal"> quad_type</span><span class="symbol">&amp;</span><span class="normal"> a</span><span class="symbol">,</span><span class="normal"> </span><span class="keyword">const</span><span class="normal"> quad_type</span><span class="symbol">&amp;</span><span class="normal"> b</span><span class="symbol">)</span>
<span class="normal">    </span><span class="cbracket">{</span>
<span class="normal">        </span><span class="keyword">return</span><span class="normal"> </span><span class="symbol">(</span><span class="normal">a</span><span class="symbol">.</span><span class="normal">second </span><span class="symbol">==</span><span class="normal"> b</span><span class="symbol">.</span><span class="normal">second</span><span class="symbol">)</span><span class="normal"> </span><span class="symbol">&amp;&amp;</span><span class="normal"> </span><span class="symbol">(</span><span class="normal">a</span><span class="symbol">.</span><span class="normal">third </span><span class="symbol">==</span><span class="normal"> b</span><span class="symbol">.</span><span class="normal">third</span><span class="symbol">)</span><span class="normal"> </span><span class="symbol">&amp;&amp;</span><span class="normal"> </span><span class="symbol">(</span><span class="normal">a</span><span class="symbol">.</span><span class="normal">fourth </span><span class="symbol">==</span><span class="normal"> b</span><span class="symbol">.</span><span class="normal">fourth</span><span class="symbol">);</span>
<span class="normal">    </span><span class="cbracket">}</span>

<span class="normal">    </span><span class="keyword">template</span><span class="normal"> </span><span class="symbol">&lt;</span><span class="keyword">class</span><span class="normal"> </span><span class="classname">quad_type</span><span class="symbol">&gt;</span>
<span class="normal">    </span><span class="keyword">static</span><span class="normal"> </span><span class="keyword">inline</span><span class="normal"> </span><span class="usertype">uint8_t</span><span class="normal"> </span><span class="function">quad_lcp</span><span class="symbol">(</span><span class="keyword">const</span><span class="normal"> quad_type</span><span class="symbol">&amp;</span><span class="normal"> a</span><span class="symbol">,</span><span class="normal"> </span><span class="keyword">const</span><span class="normal"> quad_type</span><span class="symbol">&amp;</span><span class="normal"> b</span><span class="symbol">)</span>
<span class="normal">    </span><span class="cbracket">{</span>
<span class="normal">        </span><span class="keyword">if</span><span class="normal"> </span><span class="symbol">(</span><span class="normal">a</span><span class="symbol">.</span><span class="normal">second </span><span class="symbol">!=</span><span class="normal"> b</span><span class="symbol">.</span><span class="normal">second</span><span class="symbol">)</span><span class="normal"> </span><span class="keyword">return</span><span class="normal"> </span><span class="number">0</span><span class="symbol">;</span>
<span class="normal">        </span><span class="keyword">if</span><span class="normal"> </span><span class="symbol">(</span><span class="normal">a</span><span class="symbol">.</span><span class="normal">third </span><span class="symbol">!=</span><span class="normal"> b</span><span class="symbol">.</span><span class="normal">third</span><span class="symbol">)</span><span class="normal"> </span><span class="keyword">return</span><span class="normal"> </span><span class="number">1</span><span class="symbol">;</span>
<span class="normal">        </span><span class="keyword">if</span><span class="normal"> </span><span class="symbol">(</span><span class="normal">a</span><span class="symbol">.</span><span class="normal">fourth </span><span class="symbol">!=</span><span class="normal"> b</span><span class="symbol">.</span><span class="normal">fourth</span><span class="symbol">)</span><span class="normal"> </span><span class="keyword">return</span><span class="normal"> </span><span class="number">2</span><span class="symbol">;</span>
<span class="normal">        </span><span class="keyword">return</span><span class="normal"> </span><span class="number">3</span><span class="symbol">;</span>
<span class="normal">    </span><span class="cbracket">}</span>

<span class="normal">    </span><span class="comment">/**</span>
<span class="comment">     * Naming pipe for the conventional skew algorithm without discarding.</span>
<span class="comment">     */</span>
<span class="normal">    </span><span class="keyword">template</span><span class="normal"> </span><span class="symbol">&lt;</span><span class="keyword">class</span><span class="normal"> </span><span class="classname">Input</span><span class="symbol">&gt;</span>
<span class="normal">    </span><span class="keyword">class</span><span class="normal"> </span><span class="classname">naming</span>
<span class="normal">    </span><span class="cbracket">{</span>
<span class="normal">    </span><span class="keyword">public</span><span class="symbol">:</span>
<span class="normal">        </span><span class="keyword">typedef</span><span class="normal"> </span><span class="keyword">typename</span><span class="normal"> </span><span class="classname">Input</span><span class="symbol">::</span><span class="usertype">value_type</span><span class="normal"> quad_type</span><span class="symbol">;</span>

<span class="normal">        </span><span class="keyword">typedef</span><span class="normal"> </span><span class="usertype">skew_pair_type</span><span class="normal">  value_type</span><span class="symbol">;</span>

<span class="normal">    </span><span class="keyword">private</span><span class="symbol">:</span>
<span class="normal">        Input</span><span class="symbol">&amp;</span><span class="normal"> A</span><span class="symbol">;</span>

<span class="preproc">#if</span><span class="normal"> LCP_CALC</span>
<span class="normal">        uint8_array_type</span><span class="symbol">&amp;</span><span class="normal"> lcp_names</span><span class="symbol">;</span>
<span class="preproc">#endif</span><span class="normal"> </span><span class="comment">// LCP_CALC</span>

<span class="normal">        </span><span class="type">bool</span><span class="normal"> </span><span class="symbol">&amp;</span><span class="normal"> unique</span><span class="symbol">;</span>
<span class="normal">        </span><span class="usertype">offset_type</span><span class="normal"> lexname</span><span class="symbol">;</span>
<span class="normal">        </span><span class="usertype">quad_type</span><span class="normal"> prev</span><span class="symbol">;</span>
<span class="normal">        </span><span class="usertype">skew_pair_type</span><span class="normal"> result</span><span class="symbol">;</span>

<span class="normal">    </span><span class="keyword">public</span><span class="symbol">:</span>

<span class="normal">        </span><span class="function">naming</span><span class="symbol">(</span><span class="normal">Input</span><span class="symbol">&amp;</span><span class="normal"> A_</span><span class="symbol">,</span>
<span class="preproc">#if</span><span class="normal"> LCP_CALC</span>
<span class="normal">               uint8_array_type</span><span class="symbol">&amp;</span><span class="normal"> lcp_names_</span><span class="symbol">,</span>
<span class="preproc">#endif</span><span class="normal"> </span><span class="comment">// LCP_CALC</span>
<span class="normal">               </span><span class="type">bool</span><span class="normal"> </span><span class="symbol">&amp;</span><span class="normal"> unique_</span><span class="symbol">)</span>
<span class="normal">            </span><span class="symbol">:</span><span class="normal"> </span><span class="function">A</span><span class="symbol">(</span><span class="normal">A_</span><span class="symbol">),</span>
<span class="preproc">#if</span><span class="normal"> LCP_CALC</span>
<span class="normal">              </span><span class="function">lcp_names</span><span class="symbol">(</span><span class="normal">lcp_names_</span><span class="symbol">),</span>
<span class="preproc">#endif</span><span class="normal"> </span><span class="comment">// LCP_CALC</span>
<span class="normal">              </span><span class="function">unique</span><span class="symbol">(</span><span class="normal">unique_</span><span class="symbol">),</span>
<span class="normal">              </span><span class="function">lexname</span><span class="symbol">(</span><span class="number">0</span><span class="symbol">)</span>
<span class="normal">        </span><span class="cbracket">{</span>
<span class="normal">            </span><span class="function">assert</span><span class="symbol">(!</span><span class="normal">A</span><span class="symbol">.</span><span class="function">empty</span><span class="symbol">());</span>
<span class="normal">            unique </span><span class="symbol">=</span><span class="normal"> </span><span class="keyword">true</span><span class="symbol">;</span>

<span class="normal">            prev </span><span class="symbol">=</span><span class="normal"> </span><span class="symbol">*</span><span class="normal">A</span><span class="symbol">;</span>
<span class="normal">            result</span><span class="symbol">.</span><span class="normal">first </span><span class="symbol">=</span><span class="normal"> prev</span><span class="symbol">.</span><span class="normal">first</span><span class="symbol">;</span>
<span class="normal">            result</span><span class="symbol">.</span><span class="normal">second </span><span class="symbol">=</span><span class="normal"> lexname</span><span class="symbol">;</span>

<span class="normal">            </span><span class="function">DBG</span><span class="symbol">(</span><span class="normal">debug_lexname</span><span class="symbol">,</span><span class="normal"> </span><span class="string">"lexname["</span><span class="normal"> </span><span class="symbol">&lt;&lt;</span><span class="normal"> lexname </span><span class="symbol">&lt;&lt;</span><span class="normal"> </span><span class="string">"]: "</span><span class="normal"> </span><span class="symbol">&lt;&lt;</span><span class="normal"> prev </span><span class="symbol">&lt;&lt;</span><span class="normal"> </span><span class="string">" and sentinel lcp 0"</span><span class="symbol">);</span>

<span class="preproc">#if</span><span class="normal"> LCP_CALC</span>
<span class="normal">            lcp_names</span><span class="symbol">.</span><span class="function">push_back</span><span class="symbol">(</span><span class="number">0</span><span class="symbol">);</span><span class="normal">    </span><span class="comment">// lcp to $ is zero</span>
<span class="preproc">#endif</span><span class="normal"> </span><span class="comment">// LCP_CALC</span>
<span class="normal">        </span><span class="cbracket">}</span>

<span class="normal">        </span><span class="keyword">const</span><span class="normal"> value_type</span><span class="symbol">&amp;</span><span class="normal"> </span><span class="keyword">operator</span><span class="symbol">*()</span><span class="normal"> </span><span class="keyword">const</span>
<span class="normal">        </span><span class="cbracket">{</span>
<span class="normal">            </span><span class="keyword">return</span><span class="normal"> result</span><span class="symbol">;</span>
<span class="normal">        </span><span class="cbracket">}</span>

<span class="normal">        naming</span><span class="symbol">&amp;</span><span class="normal"> </span><span class="keyword">operator</span><span class="symbol">++()</span>
<span class="normal">        </span><span class="cbracket">{</span>
<span class="normal">            </span><span class="function">assert</span><span class="symbol">(!</span><span class="normal">A</span><span class="symbol">.</span><span class="function">empty</span><span class="symbol">());</span>

<span class="normal">            </span><span class="symbol">++</span><span class="normal">A</span><span class="symbol">;</span>
<span class="normal">            </span><span class="keyword">if</span><span class="normal"> </span><span class="symbol">(</span><span class="normal">A</span><span class="symbol">.</span><span class="function">empty</span><span class="symbol">())</span><span class="normal"> </span><span class="keyword">return</span><span class="normal"> </span><span class="symbol">*</span><span class="keyword">this</span><span class="symbol">;</span>

<span class="normal">            </span><span class="usertype">quad_type</span><span class="normal"> curr </span><span class="symbol">=</span><span class="normal"> </span><span class="symbol">*</span><span class="normal">A</span><span class="symbol">;</span>
<span class="preproc">#if</span><span class="normal"> </span><span class="symbol">!</span><span class="normal">LCP_CALC</span>
<span class="normal">            </span><span class="keyword">if</span><span class="normal"> </span><span class="symbol">(!</span><span class="function">quad_eq</span><span class="symbol">(</span><span class="normal">prev</span><span class="symbol">,</span><span class="normal"> curr</span><span class="symbol">))</span><span class="normal"> </span><span class="cbracket">{</span>
<span class="normal">                </span><span class="symbol">++</span><span class="normal">lexname</span><span class="symbol">;</span>
<span class="normal">            </span><span class="cbracket">}</span>
<span class="preproc">#else</span><span class="normal"> </span><span class="comment">// LCP_CALC</span>
<span class="normal">            </span><span class="usertype">uint8_t</span><span class="normal"> lcp</span><span class="symbol">;</span>
<span class="normal">            </span><span class="keyword">if</span><span class="normal"> </span><span class="symbol">(</span><span class="normal"> </span><span class="symbol">(</span><span class="normal">lcp </span><span class="symbol">=</span><span class="normal"> </span><span class="function">quad_lcp</span><span class="symbol">(</span><span class="normal">prev</span><span class="symbol">,</span><span class="normal"> curr</span><span class="symbol">))</span><span class="normal"> </span><span class="symbol">!=</span><span class="normal"> </span><span class="number">3</span><span class="normal"> </span><span class="symbol">)</span><span class="normal"> </span><span class="cbracket">{</span>
<span class="normal">                </span><span class="symbol">++</span><span class="normal">lexname</span><span class="symbol">;</span>
<span class="normal">            </span><span class="cbracket">}</span>
<span class="preproc">#endif</span><span class="normal"> </span><span class="comment">// LCP_CALC</span>
<span class="normal">            </span><span class="keyword">else</span><span class="normal"> </span><span class="cbracket">{</span>
<span class="normal">                </span><span class="keyword">if</span><span class="normal"> </span><span class="symbol">(!</span><span class="normal">A</span><span class="symbol">.</span><span class="function">empty</span><span class="symbol">()</span><span class="normal"> </span><span class="symbol">&amp;&amp;</span><span class="normal"> curr</span><span class="symbol">.</span><span class="normal">second </span><span class="symbol">!=</span><span class="normal"> </span><span class="function">offset_type</span><span class="symbol">(</span><span class="number">0</span><span class="symbol">))</span><span class="normal"> </span><span class="cbracket">{</span>
<span class="normal">                    unique </span><span class="symbol">=</span><span class="normal"> </span><span class="keyword">false</span><span class="symbol">;</span>
<span class="normal">                </span><span class="cbracket">}</span>
<span class="normal">            </span><span class="cbracket">}</span>

<span class="preproc">#if</span><span class="normal"> </span><span class="symbol">!</span><span class="normal">LCP_CALC</span>
<span class="normal">            </span><span class="function">DBG</span><span class="symbol">(</span><span class="normal">debug_lexname</span><span class="symbol">,</span><span class="normal"> </span><span class="string">"lexname["</span><span class="normal"> </span><span class="symbol">&lt;&lt;</span><span class="normal"> lexname </span><span class="symbol">&lt;&lt;</span><span class="normal"> </span><span class="string">"]: "</span><span class="normal"> </span><span class="symbol">&lt;&lt;</span><span class="normal"> curr </span><span class="symbol">&lt;&lt;</span><span class="normal"> </span><span class="string">" and prev "</span><span class="normal"> </span><span class="symbol">&lt;&lt;</span><span class="normal"> prev</span><span class="symbol">);</span>
<span class="preproc">#else</span><span class="normal"> </span><span class="comment">// LCP_CALC</span>
<span class="normal">            </span><span class="function">DBG</span><span class="symbol">(</span><span class="normal">debug_lexname</span><span class="symbol">,</span><span class="normal"> </span><span class="string">"lexname["</span><span class="normal"> </span><span class="symbol">&lt;&lt;</span><span class="normal"> lexname </span><span class="symbol">&lt;&lt;</span><span class="normal"> </span><span class="string">"]: "</span><span class="normal"> </span><span class="symbol">&lt;&lt;</span><span class="normal"> curr </span><span class="symbol">&lt;&lt;</span><span class="normal"> </span><span class="string">" and prev "</span><span class="normal"> </span><span class="symbol">&lt;&lt;</span><span class="normal"> prev </span><span class="symbol">&lt;&lt;</span><span class="normal"> </span><span class="string">" have lcp "</span><span class="normal"> </span><span class="symbol">&lt;&lt;</span><span class="normal"> </span><span class="type">int</span><span class="symbol">(</span><span class="normal">lcp</span><span class="symbol">));</span>
<span class="normal">            lcp_names</span><span class="symbol">.</span><span class="function">push_back</span><span class="symbol">(</span><span class="normal">lcp</span><span class="symbol">);</span>
<span class="preproc">#endif</span><span class="normal"> </span><span class="comment">// LCP_CALC</span>

<span class="normal">            result</span><span class="symbol">.</span><span class="normal">first </span><span class="symbol">=</span><span class="normal"> curr</span><span class="symbol">.</span><span class="normal">first</span><span class="symbol">;</span>
<span class="normal">            result</span><span class="symbol">.</span><span class="normal">second </span><span class="symbol">=</span><span class="normal"> lexname</span><span class="symbol">;</span>

<span class="normal">            prev </span><span class="symbol">=</span><span class="normal"> curr</span><span class="symbol">;</span>
<span class="normal">            </span><span class="keyword">return</span><span class="normal"> </span><span class="symbol">*</span><span class="keyword">this</span><span class="symbol">;</span>
<span class="normal">        </span><span class="cbracket">}</span>

<span class="normal">        </span><span class="type">bool</span><span class="normal"> </span><span class="function">empty</span><span class="symbol">()</span><span class="normal"> </span><span class="keyword">const</span>
<span class="normal">        </span><span class="cbracket">{</span>
<span class="normal">            </span><span class="keyword">return</span><span class="normal"> A</span><span class="symbol">.</span><span class="function">empty</span><span class="symbol">();</span>
<span class="normal">        </span><span class="cbracket">}</span>
<span class="normal">    </span><span class="cbracket">}</span><span class="symbol">;</span>

<span class="normal">    </span><span class="comment">/***********************************************************************************************</span>
<span class="comment">     * A skew algorithm specific namespace.                                                        *</span>
<span class="comment">     ***********************************************************************************************/</span>

<span class="normal">    </span><span class="comment">/**</span>
<span class="comment">     * Create tuples until one of the input streams are empty.</span>
<span class="comment">     */</span>
<span class="normal">    </span><span class="keyword">template</span><span class="symbol">&lt;</span><span class="keyword">class</span><span class="normal"> </span><span class="classname">InputA</span><span class="symbol">,</span><span class="normal"> </span><span class="keyword">class</span><span class="normal"> </span><span class="classname">InputB</span><span class="symbol">,</span><span class="normal"> </span><span class="keyword">const</span><span class="normal"> </span><span class="usertype">size_t</span><span class="normal"> add_alphabet </span><span class="symbol">=</span><span class="normal"> </span><span class="number">0</span><span class="symbol">&gt;</span>
<span class="normal">    </span><span class="keyword">class</span><span class="normal"> </span><span class="classname">make_pairs</span>
<span class="normal">    </span><span class="cbracket">{</span>
<span class="normal">    </span><span class="keyword">public</span><span class="symbol">:</span>
<span class="normal">        </span><span class="comment">// typedef tuples::pair&lt;typename InputA::value_type, offset_type&gt; value_type;</span>
<span class="normal">        </span><span class="keyword">typedef</span><span class="normal"> </span><span class="usertype">skew_pair_type</span><span class="normal"> value_type</span><span class="symbol">;</span>

<span class="normal">    </span><span class="keyword">private</span><span class="symbol">:</span>
<span class="normal">        InputA</span><span class="symbol">&amp;</span><span class="normal"> A</span><span class="symbol">;</span>
<span class="normal">        InputB</span><span class="symbol">&amp;</span><span class="normal"> B</span><span class="symbol">;</span>

<span class="normal">        </span><span class="usertype">value_type</span><span class="normal"> result</span><span class="symbol">;</span>

<span class="normal">    </span><span class="keyword">public</span><span class="symbol">:</span>

<span class="normal">        </span><span class="function">make_pairs</span><span class="symbol">(</span><span class="normal">InputA</span><span class="symbol">&amp;</span><span class="normal"> a</span><span class="symbol">,</span><span class="normal"> InputB</span><span class="symbol">&amp;</span><span class="normal"> b</span><span class="symbol">)</span>
<span class="normal">            </span><span class="symbol">:</span><span class="normal"> </span><span class="function">A</span><span class="symbol">(</span><span class="normal">a</span><span class="symbol">),</span><span class="normal"> </span><span class="function">B</span><span class="symbol">(</span><span class="normal">b</span><span class="symbol">)</span>
<span class="normal">        </span><span class="cbracket">{</span>
<span class="normal">            </span><span class="function">assert</span><span class="symbol">(!</span><span class="normal">A</span><span class="symbol">.</span><span class="function">empty</span><span class="symbol">());</span><span class="normal"> </span><span class="function">assert</span><span class="symbol">(!</span><span class="normal">B</span><span class="symbol">.</span><span class="function">empty</span><span class="symbol">());</span>
<span class="normal">            </span><span class="keyword">if</span><span class="normal"> </span><span class="symbol">(!</span><span class="function">empty</span><span class="symbol">())</span><span class="normal"> </span><span class="cbracket">{</span>
<span class="normal">                result </span><span class="symbol">=</span><span class="normal"> </span><span class="function">value_type</span><span class="symbol">(*</span><span class="normal">A</span><span class="symbol">,</span><span class="normal"> </span><span class="symbol">*</span><span class="normal">B </span><span class="symbol">+</span><span class="normal"> add_alphabet</span><span class="symbol">);</span>
<span class="normal">            </span><span class="cbracket">}</span>
<span class="normal">        </span><span class="cbracket">}</span>

<span class="normal">        </span><span class="keyword">const</span><span class="normal"> value_type </span><span class="symbol">&amp;</span><span class="normal"> </span><span class="keyword">operator</span><span class="symbol">*()</span><span class="normal"> </span><span class="keyword">const</span>
<span class="normal">        </span><span class="cbracket">{</span>
<span class="normal">            </span><span class="keyword">return</span><span class="normal"> result</span><span class="symbol">;</span>
<span class="normal">        </span><span class="cbracket">}</span>

<span class="normal">        make_pairs </span><span class="symbol">&amp;</span><span class="normal"> </span><span class="keyword">operator</span><span class="symbol">++()</span>
<span class="normal">        </span><span class="cbracket">{</span>
<span class="normal">            </span><span class="function">assert</span><span class="symbol">(!</span><span class="normal">A</span><span class="symbol">.</span><span class="function">empty</span><span class="symbol">());</span><span class="normal"> </span><span class="function">assert</span><span class="symbol">(!</span><span class="normal">B</span><span class="symbol">.</span><span class="function">empty</span><span class="symbol">());</span>

<span class="normal">            </span><span class="symbol">++</span><span class="normal">A</span><span class="symbol">;</span><span class="normal"> </span><span class="symbol">++</span><span class="normal">B</span><span class="symbol">;</span>

<span class="normal">            </span><span class="keyword">if</span><span class="normal"> </span><span class="symbol">(!</span><span class="normal">A</span><span class="symbol">.</span><span class="function">empty</span><span class="symbol">()</span><span class="normal"> </span><span class="symbol">&amp;&amp;</span><span class="normal"> </span><span class="symbol">!</span><span class="normal">B</span><span class="symbol">.</span><span class="function">empty</span><span class="symbol">())</span><span class="normal"> </span><span class="cbracket">{</span>
<span class="normal">                result </span><span class="symbol">=</span><span class="normal"> </span><span class="function">value_type</span><span class="symbol">(*</span><span class="normal">A</span><span class="symbol">,</span><span class="normal"> </span><span class="symbol">*</span><span class="normal">B </span><span class="symbol">+</span><span class="normal"> add_alphabet</span><span class="symbol">);</span>
<span class="normal">            </span><span class="cbracket">}</span>

<span class="normal">            </span><span class="keyword">return</span><span class="normal"> </span><span class="symbol">*</span><span class="keyword">this</span><span class="symbol">;</span>
<span class="normal">        </span><span class="cbracket">}</span>

<span class="normal">        </span><span class="type">bool</span><span class="normal"> </span><span class="function">empty</span><span class="symbol">()</span><span class="normal"> </span><span class="keyword">const</span>
<span class="normal">        </span><span class="cbracket">{</span>
<span class="normal">            </span><span class="keyword">return</span><span class="normal"> </span><span class="symbol">(</span><span class="normal">A</span><span class="symbol">.</span><span class="function">empty</span><span class="symbol">()</span><span class="normal"> </span><span class="symbol">||</span><span class="normal"> B</span><span class="symbol">.</span><span class="function">empty</span><span class="symbol">());</span>
<span class="normal">        </span><span class="cbracket">}</span>
<span class="normal">    </span><span class="cbracket">}</span><span class="symbol">;</span>

<span class="normal">    </span><span class="comment">/**</span>
<span class="comment">     * Collect three characters beginning at the index. Since we need at least one unique</span>
<span class="comment">     * endcaracter, we free the first characters.</span>
<span class="comment">     * Maps (t_i) -&gt; (i,t_i,t_{i+1},t_{i+2})</span>
<span class="comment">     */</span>
<span class="normal">    </span><span class="keyword">template</span><span class="normal"> </span><span class="symbol">&lt;</span><span class="keyword">class</span><span class="normal"> </span><span class="classname">Input</span><span class="symbol">,</span><span class="normal"> </span><span class="keyword">typename</span><span class="normal"> </span><span class="classname">alphabet_type</span><span class="symbol">,</span><span class="normal"> </span><span class="keyword">const</span><span class="normal"> </span><span class="usertype">size_t</span><span class="normal"> add_alphabet </span><span class="symbol">=</span><span class="normal"> </span><span class="number">0</span><span class="symbol">&gt;</span>
<span class="normal">    </span><span class="keyword">class</span><span class="normal"> </span><span class="classname">make_quads</span>
<span class="normal">    </span><span class="cbracket">{</span>
<span class="normal">    </span><span class="keyword">public</span><span class="symbol">:</span>
<span class="normal">        </span><span class="keyword">typedef</span><span class="normal"> tuples</span><span class="symbol">::</span><span class="usertype">quad&lt;offset_type, alphabet_type, alphabet_type, alphabet_type&gt;</span><span class="normal"> value_type</span><span class="symbol">;</span>

<span class="normal">    </span><span class="keyword">private</span><span class="symbol">:</span>
<span class="normal">        Input </span><span class="symbol">&amp;</span><span class="normal"> A</span><span class="symbol">;</span>
<span class="normal">        </span><span class="usertype">value_type</span><span class="normal"> current</span><span class="symbol">;</span>
<span class="normal">        </span><span class="usertype">offset_type</span><span class="normal"> counter</span><span class="symbol">;</span>
<span class="normal">        </span><span class="type">unsigned</span><span class="normal"> </span><span class="type">int</span><span class="normal"> z3z</span><span class="symbol">;</span><span class="normal">	</span><span class="comment">// = counter mod 3, ("+",Z/3Z) is cheaper than %</span>
<span class="normal">        </span><span class="type">bool</span><span class="normal"> finished</span><span class="symbol">;</span>

<span class="normal">        offset_array_type </span><span class="symbol">&amp;</span><span class="normal"> backup</span><span class="symbol">;</span>

<span class="normal">    </span><span class="keyword">public</span><span class="symbol">:</span>
<span class="normal">        </span><span class="function">make_quads</span><span class="symbol">(</span><span class="normal">Input </span><span class="symbol">&amp;</span><span class="normal"> data_in_</span><span class="symbol">,</span><span class="normal"> offset_array_type </span><span class="symbol">&amp;</span><span class="normal"> backup_</span><span class="symbol">)</span>
<span class="normal">            </span><span class="symbol">:</span><span class="normal"> </span><span class="function">A</span><span class="symbol">(</span><span class="normal">data_in_</span><span class="symbol">),</span>
<span class="normal">              </span><span class="function">current</span><span class="symbol">(</span><span class="number">0</span><span class="symbol">,</span><span class="number">0</span><span class="symbol">,</span><span class="number">0</span><span class="symbol">,</span><span class="number">0</span><span class="symbol">),</span>
<span class="normal">              </span><span class="function">counter</span><span class="symbol">(</span><span class="number">0</span><span class="symbol">),</span>
<span class="normal">              </span><span class="function">z3z</span><span class="symbol">(</span><span class="number">0</span><span class="symbol">),</span>
<span class="normal">              </span><span class="function">finished</span><span class="symbol">(</span><span class="keyword">false</span><span class="symbol">),</span>
<span class="normal">              </span><span class="function">backup</span><span class="symbol">(</span><span class="normal">backup_</span><span class="symbol">)</span>
<span class="normal">        </span><span class="cbracket">{</span>
<span class="normal">            </span><span class="function">assert</span><span class="symbol">(!</span><span class="normal">A</span><span class="symbol">.</span><span class="function">empty</span><span class="symbol">());</span>

<span class="normal">            current</span><span class="symbol">.</span><span class="normal">first </span><span class="symbol">=</span><span class="normal"> counter</span><span class="symbol">;</span>
<span class="normal">            current</span><span class="symbol">.</span><span class="normal">second </span><span class="symbol">=</span><span class="normal"> </span><span class="symbol">(*</span><span class="normal">A</span><span class="symbol">).</span><span class="normal">second </span><span class="symbol">+</span><span class="normal"> add_alphabet</span><span class="symbol">;</span>
<span class="normal">            </span><span class="symbol">++</span><span class="normal">A</span><span class="symbol">;</span>

<span class="normal">            </span><span class="keyword">if</span><span class="normal"> </span><span class="symbol">(!</span><span class="normal">A</span><span class="symbol">.</span><span class="function">empty</span><span class="symbol">())</span><span class="normal"> </span><span class="cbracket">{</span>
<span class="normal">                current</span><span class="symbol">.</span><span class="normal">third </span><span class="symbol">=</span><span class="normal"> </span><span class="symbol">(*</span><span class="normal">A</span><span class="symbol">).</span><span class="normal">second </span><span class="symbol">+</span><span class="normal"> add_alphabet</span><span class="symbol">;</span>
<span class="normal">                </span><span class="symbol">++</span><span class="normal">A</span><span class="symbol">;</span>
<span class="normal">            </span><span class="cbracket">}</span>
<span class="normal">            </span><span class="keyword">else</span><span class="normal"> </span><span class="cbracket">{</span>
<span class="normal">                current</span><span class="symbol">.</span><span class="normal">third </span><span class="symbol">=</span><span class="normal"> </span><span class="number">0</span><span class="symbol">;</span>
<span class="normal">                current</span><span class="symbol">.</span><span class="normal">fourth </span><span class="symbol">=</span><span class="normal"> </span><span class="number">0</span><span class="symbol">;</span>
<span class="normal">            </span><span class="cbracket">}</span>

<span class="normal">            </span><span class="keyword">if</span><span class="normal"> </span><span class="symbol">(!</span><span class="normal">A</span><span class="symbol">.</span><span class="function">empty</span><span class="symbol">())</span><span class="normal"> </span><span class="cbracket">{</span>
<span class="normal">                current</span><span class="symbol">.</span><span class="normal">fourth </span><span class="symbol">=</span><span class="normal"> </span><span class="symbol">(*</span><span class="normal">A</span><span class="symbol">).</span><span class="normal">second </span><span class="symbol">+</span><span class="normal"> add_alphabet</span><span class="symbol">;</span>
<span class="normal">                </span><span class="comment">//++A;</span>
<span class="normal">            </span><span class="cbracket">}</span>
<span class="normal">            </span><span class="keyword">else</span><span class="normal"> </span><span class="cbracket">{</span>
<span class="normal">                current</span><span class="symbol">.</span><span class="normal">fourth </span><span class="symbol">=</span><span class="normal"> </span><span class="number">0</span><span class="symbol">;</span>
<span class="normal">            </span><span class="cbracket">}</span>
<span class="normal">        </span><span class="cbracket">}</span>

<span class="normal">        </span><span class="keyword">const</span><span class="normal"> value_type </span><span class="symbol">&amp;</span><span class="normal"> </span><span class="keyword">operator</span><span class="symbol">*()</span><span class="normal"> </span><span class="keyword">const</span>
<span class="normal">        </span><span class="cbracket">{</span>
<span class="normal">            </span><span class="keyword">return</span><span class="normal"> current</span><span class="symbol">;</span>
<span class="normal">        </span><span class="cbracket">}</span>

<span class="normal">        make_quads </span><span class="symbol">&amp;</span><span class="normal"> </span><span class="keyword">operator</span><span class="symbol">++()</span>
<span class="normal">        </span><span class="cbracket">{</span>
<span class="normal">            </span><span class="function">assert</span><span class="symbol">(!</span><span class="normal">A</span><span class="symbol">.</span><span class="function">empty</span><span class="symbol">()</span><span class="normal"> </span><span class="symbol">||</span><span class="normal"> </span><span class="symbol">!</span><span class="normal">finished</span><span class="symbol">);</span>

<span class="normal">            </span><span class="keyword">if</span><span class="normal"> </span><span class="symbol">(</span><span class="normal">current</span><span class="symbol">.</span><span class="normal">second </span><span class="symbol">!=</span><span class="normal"> </span><span class="function">offset_type</span><span class="symbol">(</span><span class="number">0</span><span class="symbol">))</span><span class="normal"> </span><span class="cbracket">{</span>
<span class="normal">                </span><span class="function">DBG</span><span class="symbol">(</span><span class="normal">debug_input</span><span class="symbol">,</span><span class="normal"> </span><span class="string">"Input["</span><span class="normal"> </span><span class="symbol">&lt;&lt;</span><span class="normal"> counter </span><span class="symbol">&lt;&lt;</span><span class="normal"> </span><span class="string">"] = "</span><span class="normal"> </span><span class="symbol">&lt;&lt;</span><span class="normal"> current</span><span class="symbol">.</span><span class="normal">second </span><span class="symbol">-</span><span class="normal"> add_alphabet</span><span class="symbol">);</span>
<span class="normal">                backup</span><span class="symbol">.</span><span class="function">push_back</span><span class="symbol">(</span><span class="normal">current</span><span class="symbol">.</span><span class="normal">second</span><span class="symbol">);</span>
<span class="normal">            </span><span class="cbracket">}</span>

<span class="normal">            </span><span class="comment">// Calculate module</span>
<span class="normal">            </span><span class="keyword">if</span><span class="normal"> </span><span class="symbol">(++</span><span class="normal">z3z </span><span class="symbol">==</span><span class="normal"> </span><span class="number">3</span><span class="symbol">)</span><span class="normal"> z3z </span><span class="symbol">=</span><span class="normal"> </span><span class="number">0</span><span class="symbol">;</span>

<span class="normal">            current</span><span class="symbol">.</span><span class="normal">first </span><span class="symbol">=</span><span class="normal"> </span><span class="symbol">++</span><span class="normal">counter</span><span class="symbol">;</span>
<span class="normal">            current</span><span class="symbol">.</span><span class="normal">second </span><span class="symbol">=</span><span class="normal"> current</span><span class="symbol">.</span><span class="normal">third</span><span class="symbol">;</span>
<span class="normal">            current</span><span class="symbol">.</span><span class="normal">third </span><span class="symbol">=</span><span class="normal"> current</span><span class="symbol">.</span><span class="normal">fourth</span><span class="symbol">;</span>

<span class="normal">            </span><span class="keyword">if</span><span class="normal"> </span><span class="symbol">(!</span><span class="normal">A</span><span class="symbol">.</span><span class="function">empty</span><span class="symbol">())</span>
<span class="normal">                </span><span class="symbol">++</span><span class="normal">A</span><span class="symbol">;</span>

<span class="normal">            </span><span class="keyword">if</span><span class="normal"> </span><span class="symbol">(!</span><span class="normal">A</span><span class="symbol">.</span><span class="function">empty</span><span class="symbol">())</span><span class="normal"> </span><span class="cbracket">{</span>
<span class="normal">                current</span><span class="symbol">.</span><span class="normal">fourth </span><span class="symbol">=</span><span class="normal"> </span><span class="symbol">(*</span><span class="normal">A</span><span class="symbol">).</span><span class="normal">second </span><span class="symbol">+</span><span class="normal"> add_alphabet</span><span class="symbol">;</span>
<span class="normal">            </span><span class="cbracket">}</span>
<span class="normal">            </span><span class="keyword">else</span><span class="normal"> </span><span class="cbracket">{</span>
<span class="normal">                current</span><span class="symbol">.</span><span class="normal">fourth </span><span class="symbol">=</span><span class="normal"> </span><span class="number">0</span><span class="symbol">;</span>
<span class="normal">            </span><span class="cbracket">}</span>

<span class="normal">            </span><span class="comment">// Inserts a dummy tuple for input sizes of n%3==1</span>

<span class="normal">            </span><span class="keyword">if</span><span class="normal"> </span><span class="symbol">((</span><span class="normal">current</span><span class="symbol">.</span><span class="normal">second </span><span class="symbol">==</span><span class="normal"> </span><span class="function">offset_type</span><span class="symbol">(</span><span class="number">0</span><span class="symbol">))</span><span class="normal"> </span><span class="symbol">&amp;&amp;</span><span class="normal"> </span><span class="symbol">(</span><span class="normal">z3z </span><span class="symbol">!=</span><span class="normal"> </span><span class="number">1</span><span class="symbol">))</span><span class="normal"> </span><span class="cbracket">{</span>
<span class="normal">                finished </span><span class="symbol">=</span><span class="normal"> </span><span class="keyword">true</span><span class="symbol">;</span>
<span class="normal">            </span><span class="cbracket">}</span>

<span class="normal">            </span><span class="keyword">return</span><span class="normal"> </span><span class="symbol">*</span><span class="keyword">this</span><span class="symbol">;</span>
<span class="normal">        </span><span class="cbracket">}</span>

<span class="normal">        </span><span class="type">bool</span><span class="normal"> </span><span class="function">empty</span><span class="symbol">()</span><span class="normal"> </span><span class="keyword">const</span>
<span class="normal">        </span><span class="cbracket">{</span>
<span class="normal">            </span><span class="keyword">return</span><span class="normal"> </span><span class="symbol">(</span><span class="normal">A</span><span class="symbol">.</span><span class="function">empty</span><span class="symbol">()</span><span class="normal"> </span><span class="symbol">&amp;&amp;</span><span class="normal"> finished</span><span class="symbol">);</span>
<span class="normal">        </span><span class="cbracket">}</span>
<span class="normal">    </span><span class="cbracket">}</span><span class="symbol">;</span>

<span class="normal">    </span><span class="comment">/**</span>
<span class="comment">     * Drop 1/3 of the input. More exactly the offsets at positions (0 mod 3). Index begins with 0.</span>
<span class="comment">     */</span>
<span class="normal">    </span><span class="keyword">template</span><span class="normal"> </span><span class="symbol">&lt;</span><span class="keyword">class</span><span class="normal"> </span><span class="classname">Input</span><span class="symbol">&gt;</span>
<span class="normal">    </span><span class="keyword">class</span><span class="normal"> </span><span class="classname">extract_mod12</span>
<span class="normal">    </span><span class="cbracket">{</span>
<span class="normal">    </span><span class="keyword">public</span><span class="symbol">:</span>
<span class="normal">        </span><span class="keyword">typedef</span><span class="normal"> </span><span class="keyword">typename</span><span class="normal"> </span><span class="classname">Input</span><span class="symbol">::</span><span class="usertype">value_type</span><span class="normal"> value_type</span><span class="symbol">;</span>

<span class="normal">    </span><span class="keyword">private</span><span class="symbol">:</span>
<span class="normal">        Input </span><span class="symbol">&amp;</span><span class="normal"> A</span><span class="symbol">;</span>
<span class="normal">        </span><span class="usertype">offset_type</span><span class="normal"> counter</span><span class="symbol">;</span>
<span class="normal">        </span><span class="usertype">offset_type</span><span class="normal"> output_counter</span><span class="symbol">;</span>
<span class="normal">        </span><span class="usertype">value_type</span><span class="normal"> result</span><span class="symbol">;</span>

<span class="normal">    </span><span class="keyword">public</span><span class="symbol">:</span>

<span class="normal">        </span><span class="function">extract_mod12</span><span class="symbol">(</span><span class="normal">Input </span><span class="symbol">&amp;</span><span class="normal"> A_</span><span class="symbol">)</span>
<span class="normal">            </span><span class="symbol">:</span><span class="normal"> </span><span class="function">A</span><span class="symbol">(</span><span class="normal">A_</span><span class="symbol">),</span>
<span class="normal">              </span><span class="function">counter</span><span class="symbol">(</span><span class="number">0</span><span class="symbol">),</span>
<span class="normal">              </span><span class="function">output_counter</span><span class="symbol">(</span><span class="number">0</span><span class="symbol">)</span>
<span class="normal">        </span><span class="cbracket">{</span>
<span class="normal">            </span><span class="function">assert</span><span class="symbol">(!</span><span class="normal">A</span><span class="symbol">.</span><span class="function">empty</span><span class="symbol">());</span>
<span class="normal">            </span><span class="symbol">++</span><span class="normal">A</span><span class="symbol">,</span><span class="normal"> </span><span class="symbol">++</span><span class="normal">counter</span><span class="symbol">;</span><span class="normal"> </span><span class="comment">// skip 0 = mod0 offset</span>
<span class="normal">            </span><span class="keyword">if</span><span class="normal"> </span><span class="symbol">(!</span><span class="normal">A</span><span class="symbol">.</span><span class="function">empty</span><span class="symbol">())</span><span class="normal"> </span><span class="cbracket">{</span>
<span class="normal">                result </span><span class="symbol">=</span><span class="normal"> </span><span class="symbol">*</span><span class="normal">A</span><span class="symbol">;</span>
<span class="normal">                result</span><span class="symbol">.</span><span class="function">set_1</span><span class="symbol">(</span><span class="normal">output_counter</span><span class="symbol">);</span>
<span class="normal">            </span><span class="cbracket">}</span>
<span class="normal">        </span><span class="cbracket">}</span>

<span class="normal">        </span><span class="keyword">const</span><span class="normal"> value_type </span><span class="symbol">&amp;</span><span class="normal"> </span><span class="keyword">operator</span><span class="symbol">*()</span><span class="normal"> </span><span class="keyword">const</span>
<span class="normal">        </span><span class="cbracket">{</span>
<span class="normal">            </span><span class="keyword">return</span><span class="normal"> result</span><span class="symbol">;</span>
<span class="normal">        </span><span class="cbracket">}</span>

<span class="normal">        extract_mod12 </span><span class="symbol">&amp;</span><span class="normal"> </span><span class="keyword">operator</span><span class="symbol">++()</span>
<span class="normal">        </span><span class="cbracket">{</span>
<span class="normal">            </span><span class="function">assert</span><span class="symbol">(!</span><span class="normal">A</span><span class="symbol">.</span><span class="function">empty</span><span class="symbol">());</span>

<span class="normal">            </span><span class="symbol">++</span><span class="normal">A</span><span class="symbol">,</span><span class="normal"> </span><span class="symbol">++</span><span class="normal">counter</span><span class="symbol">,</span><span class="normal"> </span><span class="symbol">++</span><span class="normal">output_counter</span><span class="symbol">;</span>

<span class="normal">            </span><span class="keyword">if</span><span class="normal"> </span><span class="symbol">(!</span><span class="normal">A</span><span class="symbol">.</span><span class="function">empty</span><span class="symbol">()</span><span class="normal"> </span><span class="symbol">&amp;&amp;</span><span class="normal"> </span><span class="symbol">(</span><span class="normal">counter </span><span class="symbol">%</span><span class="normal"> </span><span class="number">3</span><span class="symbol">)</span><span class="normal"> </span><span class="symbol">==</span><span class="normal"> </span><span class="number">0</span><span class="symbol">)</span><span class="normal"> </span><span class="cbracket">{</span>
<span class="normal">                </span><span class="comment">// skip mod0 offsets</span>
<span class="normal">                </span><span class="symbol">++</span><span class="normal">A</span><span class="symbol">,</span><span class="normal"> </span><span class="symbol">++</span><span class="normal">counter</span><span class="symbol">;</span>
<span class="normal">            </span><span class="cbracket">}</span>
<span class="normal">            </span><span class="keyword">if</span><span class="normal"> </span><span class="symbol">(!</span><span class="normal">A</span><span class="symbol">.</span><span class="function">empty</span><span class="symbol">())</span><span class="normal"> </span><span class="cbracket">{</span>
<span class="normal">                result </span><span class="symbol">=</span><span class="normal"> </span><span class="symbol">*</span><span class="normal">A</span><span class="symbol">;</span>
<span class="normal">                result</span><span class="symbol">.</span><span class="function">set_1</span><span class="symbol">(</span><span class="normal">output_counter</span><span class="symbol">);</span>
<span class="normal">            </span><span class="cbracket">}</span>

<span class="normal">            </span><span class="keyword">return</span><span class="normal"> </span><span class="symbol">*</span><span class="keyword">this</span><span class="symbol">;</span>
<span class="normal">        </span><span class="cbracket">}</span>

<span class="normal">        </span><span class="type">bool</span><span class="normal"> </span><span class="function">empty</span><span class="symbol">()</span><span class="normal"> </span><span class="keyword">const</span>
<span class="normal">        </span><span class="cbracket">{</span>
<span class="normal">            </span><span class="keyword">return</span><span class="normal"> A</span><span class="symbol">.</span><span class="function">empty</span><span class="symbol">();</span>
<span class="normal">        </span><span class="cbracket">}</span>
<span class="normal">    </span><span class="cbracket">}</span><span class="symbol">;</span>

<span class="preproc">#if</span><span class="normal"> LCP_CALC</span>
<span class="normal">    </span><span class="comment">/**</span>
<span class="comment">     * RMQ answering structure</span>
<span class="comment">     */</span>

<span class="normal">    </span><span class="keyword">class</span><span class="normal"> </span><span class="classname">RMQ</span>
<span class="normal">    </span><span class="cbracket">{</span>
<span class="normal">    </span><span class="keyword">private</span><span class="symbol">:</span>
<span class="normal">        </span><span class="comment">// memsize_compute is constant due to slabsize calculation</span>
<span class="normal">        </span><span class="keyword">static</span><span class="normal"> </span><span class="keyword">const</span><span class="normal"> </span><span class="usertype">size_t</span><span class="normal"> memsize_compute </span><span class="symbol">=</span><span class="normal"> ram_use </span><span class="symbol">/</span><span class="normal"> </span><span class="number">5</span><span class="symbol">;</span>

<span class="normal">        </span><span class="comment">// slab size of RMQs</span>
<span class="normal">        </span><span class="keyword">static</span><span class="normal"> </span><span class="keyword">const</span><span class="normal"> </span><span class="usertype">size_t</span><span class="normal"> slabsize </span><span class="symbol">=</span><span class="normal"> memsize_compute </span><span class="symbol">/</span><span class="normal"> </span><span class="number">4</span><span class="normal"> </span><span class="symbol">/</span><span class="normal"> </span><span class="keyword">sizeof</span><span class="symbol">(</span><span class="normal">offset_type</span><span class="symbol">);</span>

<span class="normal">        </span><span class="comment">// left query: (left boundary,target) sorted by (left boundary / slabsize)</span>
<span class="normal">        </span><span class="keyword">typedef</span><span class="normal"> tuples</span><span class="symbol">::</span><span class="usertype">pair&lt;offset_type,offset_type&gt;</span><span class="normal"> RMQLeft</span><span class="symbol">;</span>

<span class="normal">        </span><span class="comment">// right query: (right boundary,left boundary,target) sorted by (right boundary / slabsize)</span>
<span class="normal">        </span><span class="keyword">typedef</span><span class="normal"> tuples</span><span class="symbol">::</span><span class="usertype">triple&lt;offset_type,offset_type,offset_type&gt;</span><span class="normal"> RMQRight</span><span class="symbol">;</span>

<span class="normal">        </span><span class="comment">// answer tuple: (target,rm answer) sorted by target</span>
<span class="normal">        </span><span class="keyword">typedef</span><span class="normal"> tuples</span><span class="symbol">::</span><span class="usertype">pair&lt;offset_type,offset_type&gt;</span><span class="normal"> RMQAnswer</span><span class="symbol">;</span>

<span class="normal">        </span><span class="comment">// comparator for RMQ tuples</span>
<span class="normal">        </span><span class="keyword">template</span><span class="normal"> </span><span class="symbol">&lt;</span><span class="keyword">typename</span><span class="normal"> </span><span class="classname">RMQTuple</span><span class="symbol">&gt;</span>
<span class="normal">        </span><span class="keyword">struct</span><span class="normal"> </span><span class="classname">RMQTupleOrder</span>
<span class="normal">        </span><span class="cbracket">{</span>
<span class="normal">            </span><span class="keyword">typedef</span><span class="normal"> </span><span class="usertype">RMQTuple</span><span class="normal"> value_type</span><span class="symbol">;</span>

<span class="normal">            </span><span class="keyword">inline</span><span class="normal"> </span><span class="type">bool</span><span class="normal"> </span><span class="keyword">operator</span><span class="symbol">()(</span><span class="keyword">const</span><span class="normal"> value_type</span><span class="symbol">&amp;</span><span class="normal"> a</span><span class="symbol">,</span><span class="normal"> </span><span class="keyword">const</span><span class="normal"> value_type</span><span class="symbol">&amp;</span><span class="normal"> b</span><span class="symbol">)</span><span class="normal"> </span><span class="keyword">const</span>
<span class="normal">            </span><span class="cbracket">{</span>
<span class="normal">                </span><span class="keyword">return</span><span class="normal"> </span><span class="symbol">(</span><span class="normal">a</span><span class="symbol">.</span><span class="normal">first </span><span class="symbol">/</span><span class="normal"> slabsize</span><span class="symbol">)</span><span class="normal"> </span><span class="symbol">&lt;</span><span class="normal"> </span><span class="symbol">(</span><span class="normal">b</span><span class="symbol">.</span><span class="normal">first </span><span class="symbol">/</span><span class="normal"> slabsize</span><span class="symbol">);</span>
<span class="normal">            </span><span class="cbracket">}</span>

<span class="normal">            </span><span class="keyword">static</span><span class="normal"> </span><span class="usertype">value_type</span><span class="normal"> </span><span class="function">min_value</span><span class="symbol">()</span><span class="normal"> </span><span class="cbracket">{</span><span class="normal"> </span><span class="keyword">return</span><span class="normal"> value_type</span><span class="symbol">::</span><span class="function">min_value</span><span class="symbol">();</span><span class="normal"> </span><span class="cbracket">}</span>
<span class="normal">            </span><span class="keyword">static</span><span class="normal"> </span><span class="usertype">value_type</span><span class="normal"> </span><span class="function">max_value</span><span class="symbol">()</span><span class="normal"> </span><span class="cbracket">{</span><span class="normal"> </span><span class="keyword">return</span><span class="normal"> value_type</span><span class="symbol">::</span><span class="function">max_value</span><span class="symbol">();</span><span class="normal"> </span><span class="cbracket">}</span>
<span class="normal">        </span><span class="cbracket">}</span><span class="symbol">;</span>

<span class="normal">        </span><span class="keyword">typedef</span><span class="normal"> stxxl</span><span class="symbol">::</span><span class="usertype">sorter&lt;RMQLeft, RMQTupleOrder&lt;RMQLeft&gt;, block_size&gt;</span><span class="normal"> st_RMQLeft_type</span><span class="symbol">;</span>
<span class="normal">        </span><span class="keyword">typedef</span><span class="normal"> stxxl</span><span class="symbol">::</span><span class="usertype">sorter&lt;RMQRight, RMQTupleOrder&lt;RMQRight&gt;, block_size&gt;</span><span class="normal"> st_RMQRight_type</span><span class="symbol">;</span>

<span class="normal">        </span><span class="keyword">typedef</span><span class="normal"> stxxl</span><span class="symbol">::</span><span class="usertype">sorter&lt;RMQAnswer, tuples::pair_less1st&lt;RMQAnswer&gt;, block_size&gt;</span><span class="normal"> st_RMQAnswer_type</span><span class="symbol">;</span>

<span class="normal">    </span><span class="keyword">private</span><span class="symbol">:</span>
<span class="normal">        </span><span class="usertype">st_RMQLeft_type</span><span class="normal">    st_RMQLeft</span><span class="symbol">;</span>
<span class="normal">        </span><span class="usertype">st_RMQRight_type</span><span class="normal">   st_RMQRight</span><span class="symbol">;</span>

<span class="normal">        std</span><span class="symbol">::</span><span class="usertype">auto_ptr&lt;st_RMQAnswer_type&gt;</span><span class="normal">  st_RMQAnswer</span><span class="symbol">;</span>

<span class="normal">        </span><span class="usertype">RMQAnswer</span><span class="normal">          current</span><span class="symbol">;</span>
<span class="normal">        </span><span class="type">bool</span><span class="normal">               computed</span><span class="symbol">,</span><span class="normal"> done</span><span class="symbol">;</span>

<span class="normal">    </span><span class="keyword">public</span><span class="symbol">:</span>

<span class="normal">        </span><span class="function">RMQ</span><span class="symbol">(</span><span class="usertype">size_t</span><span class="normal"> memsize_input</span><span class="symbol">)</span>
<span class="normal">            </span><span class="symbol">:</span><span class="normal"> </span><span class="function">st_RMQLeft</span><span class="symbol">(</span><span class="normal">RMQTupleOrder</span><span class="symbol">&lt;</span><span class="normal">RMQLeft</span><span class="symbol">&gt;(),</span><span class="normal"> memsize_input </span><span class="symbol">/</span><span class="normal"> </span><span class="number">2</span><span class="symbol">),</span>
<span class="normal">              </span><span class="function">st_RMQRight</span><span class="symbol">(</span><span class="normal">RMQTupleOrder</span><span class="symbol">&lt;</span><span class="normal">RMQRight</span><span class="symbol">&gt;(),</span><span class="normal"> memsize_input </span><span class="symbol">/</span><span class="normal"> </span><span class="number">2</span><span class="symbol">),</span>
<span class="normal">              </span><span class="function">computed</span><span class="symbol">(</span><span class="keyword">false</span><span class="symbol">)</span>
<span class="normal">        </span><span class="cbracket">{</span>
<span class="normal">        </span><span class="cbracket">}</span>

<span class="normal">        </span><span class="type">void</span><span class="normal"> </span><span class="function">query</span><span class="symbol">(</span><span class="keyword">const</span><span class="normal"> offset_type</span><span class="symbol">&amp;</span><span class="normal"> left</span><span class="symbol">,</span><span class="normal"> </span><span class="keyword">const</span><span class="normal"> offset_type</span><span class="symbol">&amp;</span><span class="normal"> right</span><span class="symbol">,</span><span class="normal"> </span><span class="keyword">const</span><span class="normal"> offset_type</span><span class="symbol">&amp;</span><span class="normal"> target</span><span class="symbol">)</span>
<span class="normal">        </span><span class="cbracket">{</span>
<span class="normal">            </span><span class="keyword">if</span><span class="normal"> </span><span class="symbol">(</span><span class="normal"> </span><span class="symbol">(</span><span class="normal">left </span><span class="symbol">/</span><span class="normal"> slabsize</span><span class="symbol">)</span><span class="normal"> </span><span class="symbol">==</span><span class="normal"> </span><span class="symbol">(</span><span class="normal">right </span><span class="symbol">/</span><span class="normal"> slabsize</span><span class="symbol">)</span><span class="normal"> </span><span class="symbol">)</span>
<span class="normal">            </span><span class="cbracket">{</span>
<span class="normal">                </span><span class="comment">// one RMQ tuple</span>
<span class="normal">                st_RMQRight</span><span class="symbol">.</span><span class="function">push</span><span class="symbol">(</span><span class="normal"> </span><span class="function">RMQRight</span><span class="symbol">(</span><span class="normal">right</span><span class="symbol">,</span><span class="normal">left</span><span class="symbol">,</span><span class="normal">target</span><span class="symbol">)</span><span class="normal"> </span><span class="symbol">);</span>
<span class="normal">            </span><span class="cbracket">}</span>
<span class="normal">            </span><span class="keyword">else</span>
<span class="normal">            </span><span class="cbracket">{</span>
<span class="normal">                </span><span class="comment">// two RMQ tuples: one for left end and one for spanning and right end</span>
<span class="normal">                st_RMQLeft</span><span class="symbol">.</span><span class="function">push</span><span class="symbol">(</span><span class="normal"> </span><span class="function">RMQLeft</span><span class="symbol">(</span><span class="normal">left</span><span class="symbol">,</span><span class="normal">target</span><span class="symbol">)</span><span class="normal"> </span><span class="symbol">);</span>
<span class="normal">                st_RMQRight</span><span class="symbol">.</span><span class="function">push</span><span class="symbol">(</span><span class="normal"> </span><span class="function">RMQRight</span><span class="symbol">(</span><span class="normal">right</span><span class="symbol">,</span><span class="normal">left</span><span class="symbol">,</span><span class="normal">target</span><span class="symbol">)</span><span class="normal"> </span><span class="symbol">);</span>
<span class="normal">            </span><span class="cbracket">}</span>
<span class="normal">        </span><span class="cbracket">}</span>

<span class="normal">        </span><span class="keyword">template</span><span class="normal"> </span><span class="symbol">&lt;</span><span class="keyword">typename</span><span class="normal"> </span><span class="classname">DataStream</span><span class="symbol">&gt;</span>
<span class="normal">        </span><span class="type">void</span><span class="normal"> </span><span class="function">compute</span><span class="symbol">(</span><span class="normal">DataStream</span><span class="symbol">&amp;</span><span class="normal"> stream</span><span class="symbol">)</span>
<span class="normal">        </span><span class="cbracket">{</span>
<span class="normal">            </span><span class="function">assert</span><span class="symbol">(!</span><span class="normal">computed</span><span class="symbol">);</span><span class="normal"> computed </span><span class="symbol">=</span><span class="normal"> </span><span class="keyword">true</span><span class="symbol">;</span>

<span class="normal">            st_RMQLeft</span><span class="symbol">.</span><span class="function">sort</span><span class="symbol">(</span><span class="normal"> memsize_compute </span><span class="symbol">/</span><span class="normal"> </span><span class="number">4</span><span class="normal"> </span><span class="symbol">);</span>
<span class="normal">            st_RMQRight</span><span class="symbol">.</span><span class="function">sort</span><span class="symbol">(</span><span class="normal"> memsize_compute </span><span class="symbol">/</span><span class="normal"> </span><span class="number">4</span><span class="normal"> </span><span class="symbol">);</span>
<span class="normal">            st_RMQAnswer </span><span class="symbol">=</span><span class="normal"> std</span><span class="symbol">::</span><span class="normal">auto_ptr</span><span class="symbol">&lt;</span><span class="normal">st_RMQAnswer_type</span><span class="symbol">&gt;</span>
<span class="normal">                </span><span class="symbol">(</span><span class="normal"> </span><span class="keyword">new</span><span class="normal"> </span><span class="function">st_RMQAnswer_type</span><span class="symbol">(</span><span class="normal">tuples</span><span class="symbol">::</span><span class="normal">pair_less1st</span><span class="symbol">&lt;</span><span class="normal">RMQAnswer</span><span class="symbol">&gt;(),</span><span class="normal"> memsize_compute </span><span class="symbol">/</span><span class="normal"> </span><span class="number">4</span><span class="symbol">)</span><span class="normal"> </span><span class="symbol">);</span>

<span class="normal">            </span><span class="comment">// buffer takes fourth part of memory</span>

<span class="normal">            </span><span class="usertype">size_t</span><span class="normal"> start </span><span class="symbol">=</span><span class="normal"> </span><span class="number">0</span><span class="symbol">;</span>
<span class="normal">            offset_type</span><span class="symbol">*</span><span class="normal"> buffer </span><span class="symbol">=</span><span class="normal"> </span><span class="keyword">new</span><span class="normal"> offset_type</span><span class="symbol">[</span><span class="normal">slabsize</span><span class="symbol">];</span>

<span class="normal">            </span><span class="usertype">RMQ_Stack&lt;offset_type,offset_type&gt;</span><span class="normal"> spanrmq</span><span class="symbol">;</span>

<span class="normal">            </span><span class="keyword">for</span><span class="normal"> </span><span class="symbol">(</span><span class="usertype">size_t</span><span class="normal"> thisslab </span><span class="symbol">=</span><span class="normal"> </span><span class="number">0</span><span class="symbol">;</span><span class="normal"> </span><span class="symbol">!</span><span class="normal">stream</span><span class="symbol">.</span><span class="function">empty</span><span class="symbol">();</span><span class="normal"> </span><span class="symbol">++</span><span class="normal">thisslab</span><span class="symbol">)</span>
<span class="normal">            </span><span class="cbracket">{</span>
<span class="normal">                </span><span class="usertype">size_t</span><span class="normal"> thissize </span><span class="symbol">=</span><span class="normal"> </span><span class="number">0</span><span class="symbol">;</span>
<span class="normal">                </span><span class="function">assert</span><span class="symbol">(</span><span class="normal"> start </span><span class="symbol">/</span><span class="normal"> slabsize </span><span class="symbol">==</span><span class="normal"> thisslab </span><span class="symbol">);</span>

<span class="normal">                </span><span class="comment">// read next slab into buffer</span>
<span class="normal">                </span><span class="keyword">while</span><span class="normal"> </span><span class="symbol">(</span><span class="normal"> thissize </span><span class="symbol">&lt;</span><span class="normal"> slabsize </span><span class="symbol">&amp;&amp;</span><span class="normal"> </span><span class="symbol">!</span><span class="normal">stream</span><span class="symbol">.</span><span class="function">empty</span><span class="symbol">()</span><span class="normal"> </span><span class="symbol">)</span>
<span class="normal">                </span><span class="cbracket">{</span>
<span class="normal">                    buffer</span><span class="symbol">[</span><span class="normal">thissize</span><span class="symbol">++]</span><span class="normal"> </span><span class="symbol">=</span><span class="normal"> </span><span class="symbol">*</span><span class="normal">stream</span><span class="symbol">;</span>
<span class="normal">                    </span><span class="symbol">++</span><span class="normal">stream</span><span class="symbol">;</span>
<span class="normal">                </span><span class="cbracket">}</span>

<span class="normal">                </span><span class="comment">// build rmq structure for slab</span>
<span class="normal">                </span><span class="usertype">RMQ_succinct&lt;offset_type, uint32_t&gt;</span><span class="normal"> </span><span class="function">slabrmq</span><span class="symbol">(</span><span class="normal">buffer</span><span class="symbol">,</span><span class="normal"> thissize</span><span class="symbol">);</span>

<span class="normal">                </span><span class="comment">// answer all left queries for this slab</span>
<span class="normal">                </span><span class="keyword">while</span><span class="normal"> </span><span class="symbol">(</span><span class="normal"> </span><span class="symbol">!</span><span class="normal">st_RMQLeft</span><span class="symbol">.</span><span class="function">empty</span><span class="symbol">()</span><span class="normal"> </span><span class="symbol">&amp;&amp;</span><span class="normal"> </span><span class="symbol">(</span><span class="normal">st_RMQLeft</span><span class="symbol">-&gt;</span><span class="normal">first </span><span class="symbol">/</span><span class="normal"> slabsize</span><span class="symbol">)</span><span class="normal"> </span><span class="symbol">==</span><span class="normal"> thisslab </span><span class="symbol">)</span>
<span class="normal">                </span><span class="cbracket">{</span>
<span class="normal">                    </span><span class="comment">// case 1: left RMQ boundary in this slab, right is beyond the border</span>
<span class="normal">                    </span><span class="function">DBG</span><span class="symbol">(</span><span class="normal">debug_rmq</span><span class="symbol">,</span><span class="string">"RMQ left in slab: ("</span><span class="normal"> </span><span class="symbol">&lt;&lt;</span><span class="normal"> st_RMQLeft</span><span class="symbol">-&gt;</span><span class="normal">first </span><span class="symbol">&lt;&lt;</span><span class="normal"> </span><span class="string">",inf) target "</span><span class="normal"> </span><span class="symbol">&lt;&lt;</span><span class="normal"> st_RMQLeft</span><span class="symbol">-&gt;</span><span class="normal">second</span><span class="symbol">);</span>

<span class="normal">                    </span><span class="usertype">offset_type</span><span class="normal"> result </span><span class="symbol">=</span><span class="normal"> slabrmq</span><span class="symbol">.</span><span class="function">query</span><span class="symbol">(</span><span class="normal"> st_RMQLeft</span><span class="symbol">-&gt;</span><span class="normal">first </span><span class="symbol">-</span><span class="normal"> start</span><span class="symbol">,</span><span class="normal"> thissize</span><span class="symbol">-</span><span class="number">1</span><span class="normal"> </span><span class="symbol">);</span>
<span class="normal">                    </span><span class="function">assert</span><span class="symbol">(</span><span class="normal"> result </span><span class="symbol">&lt;</span><span class="normal"> </span><span class="function">offset_type</span><span class="symbol">(</span><span class="normal">thissize</span><span class="symbol">)</span><span class="normal"> </span><span class="symbol">);</span>
<span class="normal">                    result </span><span class="symbol">=</span><span class="normal"> buffer</span><span class="symbol">[</span><span class="normal">result</span><span class="symbol">];</span>

<span class="normal">                    </span><span class="function">DBG</span><span class="symbol">(</span><span class="normal">debug_rmq</span><span class="symbol">,</span><span class="string">"RMQ result "</span><span class="normal"> </span><span class="symbol">&lt;&lt;</span><span class="normal"> result</span><span class="symbol">);</span>
<span class="normal">                    st_RMQAnswer</span><span class="symbol">-&gt;</span><span class="function">push</span><span class="symbol">(</span><span class="normal"> </span><span class="function">RMQAnswer</span><span class="symbol">(</span><span class="normal">st_RMQLeft</span><span class="symbol">-&gt;</span><span class="normal">second</span><span class="symbol">,</span><span class="normal"> result</span><span class="symbol">)</span><span class="normal"> </span><span class="symbol">);</span>

<span class="normal">                    </span><span class="symbol">++</span><span class="normal">st_RMQLeft</span><span class="symbol">;</span>
<span class="normal">                </span><span class="cbracket">}</span>

<span class="normal">                </span><span class="comment">// answer all right queries for this slab</span>
<span class="normal">                </span><span class="keyword">while</span><span class="normal"> </span><span class="symbol">(</span><span class="normal"> </span><span class="symbol">!</span><span class="normal">st_RMQRight</span><span class="symbol">.</span><span class="function">empty</span><span class="symbol">()</span><span class="normal"> </span><span class="symbol">&amp;&amp;</span><span class="normal"> </span><span class="symbol">(</span><span class="normal">st_RMQRight</span><span class="symbol">-&gt;</span><span class="normal">first </span><span class="symbol">/</span><span class="normal"> slabsize</span><span class="symbol">)</span><span class="normal"> </span><span class="symbol">==</span><span class="normal"> thisslab </span><span class="symbol">)</span>
<span class="normal">                </span><span class="cbracket">{</span>
<span class="normal">                    </span><span class="keyword">if</span><span class="normal"> </span><span class="symbol">(</span><span class="normal"> </span><span class="symbol">(</span><span class="normal">st_RMQRight</span><span class="symbol">-&gt;</span><span class="normal">second </span><span class="symbol">/</span><span class="normal"> slabsize</span><span class="symbol">)</span><span class="normal"> </span><span class="symbol">==</span><span class="normal"> thisslab </span><span class="symbol">)</span>
<span class="normal">                    </span><span class="cbracket">{</span>
<span class="normal">                        </span><span class="comment">// case 2: both RMQ boundaries are for this slab and the same target</span>
<span class="normal">                        </span><span class="function">DBG</span><span class="symbol">(</span><span class="normal">debug_rmq</span><span class="symbol">,</span><span class="string">"RMQ pair in slab: ("</span><span class="normal"> </span><span class="symbol">&lt;&lt;</span><span class="normal"> st_RMQRight</span><span class="symbol">-&gt;</span><span class="normal">second </span><span class="symbol">&lt;&lt;</span><span class="normal"> </span><span class="string">","</span><span class="normal"> </span><span class="symbol">&lt;&lt;</span><span class="normal"> st_RMQRight</span><span class="symbol">-&gt;</span><span class="normal">first </span><span class="symbol">&lt;&lt;</span><span class="normal"> </span><span class="string">") target "</span><span class="normal"> </span><span class="symbol">&lt;&lt;</span><span class="normal"> st_RMQRight</span><span class="symbol">-&gt;</span><span class="normal">third</span><span class="symbol">);</span>

<span class="normal">                        </span><span class="usertype">offset_type</span><span class="normal"> result</span><span class="symbol">;</span>
<span class="normal">                        </span><span class="keyword">if</span><span class="normal"> </span><span class="symbol">(</span><span class="normal"> st_RMQRight</span><span class="symbol">-&gt;</span><span class="normal">first </span><span class="symbol">&lt;</span><span class="normal"> </span><span class="function">offset_type</span><span class="symbol">(</span><span class="normal">start </span><span class="symbol">+</span><span class="normal"> thissize</span><span class="symbol">)</span><span class="normal"> </span><span class="symbol">)</span><span class="normal"> </span><span class="cbracket">{</span>
<span class="normal">                            result </span><span class="symbol">=</span><span class="normal"> slabrmq</span><span class="symbol">.</span><span class="function">query</span><span class="symbol">(</span><span class="normal"> st_RMQRight</span><span class="symbol">-&gt;</span><span class="normal">second </span><span class="symbol">-</span><span class="normal"> start</span><span class="symbol">,</span><span class="normal"> st_RMQRight</span><span class="symbol">-&gt;</span><span class="normal">first </span><span class="symbol">-</span><span class="normal"> start </span><span class="symbol">);</span>
<span class="normal">                            </span><span class="function">assert</span><span class="symbol">(</span><span class="normal"> result </span><span class="symbol">&lt;</span><span class="normal"> </span><span class="function">offset_type</span><span class="symbol">(</span><span class="normal">thissize</span><span class="symbol">)</span><span class="normal"> </span><span class="symbol">);</span>
<span class="normal">                            result </span><span class="symbol">=</span><span class="normal"> buffer</span><span class="symbol">[</span><span class="normal">result</span><span class="symbol">];</span>
<span class="normal">                        </span><span class="cbracket">}</span>
<span class="normal">                        </span><span class="keyword">else</span><span class="normal"> </span><span class="cbracket">{</span>
<span class="normal">                            result </span><span class="symbol">=</span><span class="normal"> </span><span class="number">0</span><span class="symbol">;</span>
<span class="normal">                        </span><span class="cbracket">}</span>

<span class="normal">                        </span><span class="function">DBG</span><span class="symbol">(</span><span class="normal">debug_rmq</span><span class="symbol">,</span><span class="string">"RMQ result: "</span><span class="normal"> </span><span class="symbol">&lt;&lt;</span><span class="normal"> result</span><span class="symbol">);</span>
<span class="normal">                        st_RMQAnswer</span><span class="symbol">-&gt;</span><span class="function">push</span><span class="symbol">(</span><span class="normal"> </span><span class="function">RMQAnswer</span><span class="symbol">(</span><span class="normal">st_RMQRight</span><span class="symbol">-&gt;</span><span class="normal">third</span><span class="symbol">,</span><span class="normal"> result</span><span class="symbol">)</span><span class="normal"> </span><span class="symbol">);</span>

<span class="normal">                        </span><span class="symbol">++</span><span class="normal">st_RMQRight</span><span class="symbol">;</span>
<span class="normal">                    </span><span class="cbracket">}</span>
<span class="normal">                    </span><span class="keyword">else</span>
<span class="normal">                    </span><span class="cbracket">{</span>
<span class="normal">                        </span><span class="comment">// case 3: right RMQ boundary in this slab, left is beyond the border</span>
<span class="normal">                        </span><span class="function">DBG</span><span class="symbol">(</span><span class="normal">debug_rmq</span><span class="symbol">,</span><span class="string">"RMQ right in slab: (-inf,"</span><span class="normal"> </span><span class="symbol">&lt;&lt;</span><span class="normal"> st_RMQRight</span><span class="symbol">-&gt;</span><span class="normal">first </span><span class="symbol">&lt;&lt;</span><span class="normal"> </span><span class="string">") target "</span><span class="normal"> </span><span class="symbol">&lt;&lt;</span><span class="normal"> st_RMQRight</span><span class="symbol">-&gt;</span><span class="normal">third</span><span class="symbol">);</span>

<span class="normal">                        </span><span class="usertype">offset_type</span><span class="normal"> result</span><span class="symbol">;</span>
<span class="normal">                        </span><span class="keyword">if</span><span class="normal"> </span><span class="symbol">(</span><span class="normal"> st_RMQRight</span><span class="symbol">-&gt;</span><span class="normal">first </span><span class="symbol">&lt;</span><span class="normal"> </span><span class="function">offset_type</span><span class="symbol">(</span><span class="normal">start </span><span class="symbol">+</span><span class="normal"> thissize</span><span class="symbol">)</span><span class="normal"> </span><span class="symbol">)</span><span class="normal"> </span><span class="cbracket">{</span>
<span class="normal">                            result </span><span class="symbol">=</span><span class="normal"> slabrmq</span><span class="symbol">.</span><span class="function">query</span><span class="symbol">(</span><span class="normal"> </span><span class="number">0</span><span class="symbol">,</span><span class="normal"> st_RMQRight</span><span class="symbol">-&gt;</span><span class="normal">first </span><span class="symbol">-</span><span class="normal"> start </span><span class="symbol">);</span>
<span class="normal">                            </span><span class="function">assert</span><span class="symbol">(</span><span class="normal"> result </span><span class="symbol">&lt;</span><span class="normal"> </span><span class="function">offset_type</span><span class="symbol">(</span><span class="normal">thissize</span><span class="symbol">)</span><span class="normal"> </span><span class="symbol">);</span>
<span class="normal">                            result </span><span class="symbol">=</span><span class="normal"> buffer</span><span class="symbol">[</span><span class="normal">result</span><span class="symbol">];</span>
<span class="normal">                        </span><span class="cbracket">}</span>
<span class="normal">                        </span><span class="keyword">else</span><span class="normal"> </span><span class="cbracket">{</span>
<span class="normal">                            result </span><span class="symbol">=</span><span class="normal"> </span><span class="number">0</span><span class="symbol">;</span>
<span class="normal">                        </span><span class="cbracket">}</span>

<span class="normal">                        </span><span class="function">assert</span><span class="symbol">(</span><span class="normal"> </span><span class="symbol">(</span><span class="normal">st_RMQRight</span><span class="symbol">-&gt;</span><span class="normal">second </span><span class="symbol">/</span><span class="normal"> slabsize</span><span class="symbol">)</span><span class="normal"> </span><span class="symbol">&lt;</span><span class="normal"> thisslab </span><span class="symbol">);</span>
<span class="normal">                        </span><span class="keyword">if</span><span class="normal"> </span><span class="symbol">(</span><span class="normal"> </span><span class="symbol">(</span><span class="normal">st_RMQRight</span><span class="symbol">-&gt;</span><span class="normal">second </span><span class="symbol">/</span><span class="normal"> slabsize</span><span class="symbol">)</span><span class="normal"> </span><span class="symbol">&lt;</span><span class="normal"> thisslab</span><span class="symbol">-</span><span class="number">1</span><span class="normal"> </span><span class="symbol">)</span><span class="normal"> </span><span class="cbracket">{</span>
<span class="normal">                            </span><span class="keyword">const</span><span class="normal"> offset_type</span><span class="symbol">&amp;</span><span class="normal"> min2 </span><span class="symbol">=</span><span class="normal"> spanrmq</span><span class="symbol">.</span><span class="function">query</span><span class="symbol">(</span><span class="normal"> </span><span class="symbol">(</span><span class="normal">st_RMQRight</span><span class="symbol">-&gt;</span><span class="normal">second </span><span class="symbol">/</span><span class="normal"> slabsize</span><span class="symbol">)+</span><span class="number">1</span><span class="symbol">,</span><span class="normal">  thisslab</span><span class="symbol">-</span><span class="number">1</span><span class="normal"> </span><span class="symbol">);</span>
<span class="normal">                            result </span><span class="symbol">=</span><span class="normal"> std</span><span class="symbol">::</span><span class="function">min</span><span class="symbol">(</span><span class="normal">result</span><span class="symbol">,</span><span class="normal"> min2</span><span class="symbol">);</span>
<span class="normal">                        </span><span class="cbracket">}</span>

<span class="normal">                        </span><span class="function">DBG</span><span class="symbol">(</span><span class="normal">debug_rmq</span><span class="symbol">,</span><span class="string">"RMQ result: "</span><span class="normal"> </span><span class="symbol">&lt;&lt;</span><span class="normal"> result</span><span class="symbol">);</span>
<span class="normal">                        st_RMQAnswer</span><span class="symbol">-&gt;</span><span class="function">push</span><span class="symbol">(</span><span class="normal"> </span><span class="function">RMQAnswer</span><span class="symbol">(</span><span class="normal">st_RMQRight</span><span class="symbol">-&gt;</span><span class="normal">third</span><span class="symbol">,</span><span class="normal"> result</span><span class="symbol">)</span><span class="normal"> </span><span class="symbol">);</span>

<span class="normal">                        </span><span class="symbol">++</span><span class="normal">st_RMQRight</span><span class="symbol">;</span>
<span class="normal">                    </span><span class="cbracket">}</span>
<span class="normal">                </span><span class="cbracket">}</span>

<span class="normal">                </span><span class="comment">// calculate spanning slab rm and save to RMQ stack</span>
<span class="normal">                </span><span class="cbracket">{</span>
<span class="normal">                    </span><span class="usertype">offset_type</span><span class="normal"> gmin </span><span class="symbol">=</span><span class="normal"> slabrmq</span><span class="symbol">.</span><span class="function">query</span><span class="symbol">(</span><span class="number">0</span><span class="symbol">,</span><span class="normal">thissize</span><span class="symbol">-</span><span class="number">1</span><span class="symbol">);</span>
<span class="normal">                    gmin </span><span class="symbol">=</span><span class="normal"> buffer</span><span class="symbol">[</span><span class="normal">gmin</span><span class="symbol">];</span>
<span class="normal">                    </span><span class="function">DBG</span><span class="symbol">(</span><span class="normal">debug_rmq</span><span class="symbol">,</span><span class="string">"Saving slab global minimum "</span><span class="normal"> </span><span class="symbol">&lt;&lt;</span><span class="normal"> gmin</span><span class="symbol">);</span>
<span class="normal">                    spanrmq</span><span class="symbol">.</span><span class="function">set</span><span class="symbol">(</span><span class="normal"> thisslab</span><span class="symbol">,</span><span class="normal"> gmin </span><span class="symbol">);</span>
<span class="normal">                </span><span class="cbracket">}</span>

<span class="normal">                start </span><span class="symbol">+=</span><span class="normal"> thissize</span><span class="symbol">;</span>
<span class="normal">            </span><span class="cbracket">}</span>

<span class="normal">            </span><span class="keyword">delete</span><span class="normal"> </span><span class="symbol">[]</span><span class="normal"> buffer</span><span class="symbol">;</span>

<span class="normal">            st_RMQLeft</span><span class="symbol">.</span><span class="function">finish_clear</span><span class="symbol">();</span>
<span class="normal">            st_RMQRight</span><span class="symbol">.</span><span class="function">finish_clear</span><span class="symbol">();</span>
<span class="normal">            st_RMQAnswer</span><span class="symbol">-&gt;</span><span class="function">finish</span><span class="symbol">();</span>
<span class="normal">        </span><span class="cbracket">}</span>

<span class="normal">        </span><span class="type">void</span><span class="normal"> </span><span class="function">start_output</span><span class="symbol">(</span><span class="usertype">size_t</span><span class="normal"> memsize_output</span><span class="symbol">)</span>
<span class="normal">        </span><span class="cbracket">{</span>
<span class="normal">            st_RMQAnswer</span><span class="symbol">-&gt;</span><span class="function">sort</span><span class="symbol">(</span><span class="normal">memsize_output</span><span class="symbol">);</span>

<span class="normal">            done </span><span class="symbol">=</span><span class="normal"> </span><span class="keyword">false</span><span class="symbol">;</span>
<span class="normal">            </span><span class="keyword">operator</span><span class="symbol">++();</span>
<span class="normal">        </span><span class="cbracket">}</span>

<span class="normal">        </span><span class="comment">// *** Stream interface to RMQ answers</span>

<span class="normal">        </span><span class="keyword">typedef</span><span class="normal"> </span><span class="usertype">RMQAnswer</span><span class="normal">       value_type</span><span class="symbol">;</span>

<span class="normal">        </span><span class="keyword">const</span><span class="normal"> value_type </span><span class="symbol">&amp;</span><span class="normal"> </span><span class="keyword">operator</span><span class="symbol">*()</span><span class="normal"> </span><span class="keyword">const</span>
<span class="normal">        </span><span class="cbracket">{</span>
<span class="normal">            </span><span class="keyword">return</span><span class="normal"> current</span><span class="symbol">;</span>
<span class="normal">        </span><span class="cbracket">}</span>

<span class="normal">        </span><span class="keyword">const</span><span class="normal"> value_type</span><span class="symbol">*</span><span class="normal"> </span><span class="keyword">operator</span><span class="symbol">-&gt;()</span><span class="normal"> </span><span class="keyword">const</span>
<span class="normal">        </span><span class="cbracket">{</span>
<span class="normal">            </span><span class="keyword">return</span><span class="normal"> </span><span class="symbol">&amp;</span><span class="normal">current</span><span class="symbol">;</span>
<span class="normal">        </span><span class="cbracket">}</span>

<span class="normal">        RMQ</span><span class="symbol">&amp;</span><span class="normal"> </span><span class="keyword">operator</span><span class="symbol">++()</span>
<span class="normal">        </span><span class="cbracket">{</span>
<span class="normal">            </span><span class="keyword">if</span><span class="normal"> </span><span class="symbol">(</span><span class="normal">st_RMQAnswer</span><span class="symbol">-&gt;</span><span class="function">empty</span><span class="symbol">())</span><span class="normal"> </span><span class="cbracket">{</span>
<span class="normal">                done </span><span class="symbol">=</span><span class="normal"> </span><span class="keyword">true</span><span class="symbol">;</span>
<span class="normal">                </span><span class="keyword">return</span><span class="normal"> </span><span class="symbol">*</span><span class="keyword">this</span><span class="symbol">;</span>
<span class="normal">            </span><span class="cbracket">}</span>

<span class="normal">            </span><span class="comment">// first answer tuple</span>
<span class="normal">            current </span><span class="symbol">=</span><span class="normal"> </span><span class="symbol">*(*</span><span class="normal">st_RMQAnswer</span><span class="symbol">);</span>
<span class="normal">            </span><span class="symbol">++(*</span><span class="normal">st_RMQAnswer</span><span class="symbol">);</span>

<span class="normal">            </span><span class="comment">// optional second answer tuple</span>
<span class="normal">            </span><span class="keyword">if</span><span class="normal"> </span><span class="symbol">(!</span><span class="normal">st_RMQAnswer</span><span class="symbol">-&gt;</span><span class="function">empty</span><span class="symbol">()</span><span class="normal"> </span><span class="symbol">&amp;&amp;</span><span class="normal"> </span><span class="symbol">(*</span><span class="normal">st_RMQAnswer</span><span class="symbol">)-&gt;</span><span class="normal">first </span><span class="symbol">==</span><span class="normal"> current</span><span class="symbol">.</span><span class="normal">first</span><span class="symbol">)</span><span class="normal"> </span><span class="cbracket">{</span>
<span class="normal">                current</span><span class="symbol">.</span><span class="normal">second </span><span class="symbol">=</span><span class="normal"> std</span><span class="symbol">::</span><span class="function">min</span><span class="symbol">(</span><span class="normal">current</span><span class="symbol">.</span><span class="normal">second</span><span class="symbol">,</span><span class="normal"> </span><span class="symbol">(*</span><span class="normal">st_RMQAnswer</span><span class="symbol">)-&gt;</span><span class="normal">second</span><span class="symbol">);</span>
<span class="normal">                </span><span class="symbol">++(*</span><span class="normal">st_RMQAnswer</span><span class="symbol">);</span>
<span class="normal">            </span><span class="cbracket">}</span>

<span class="normal">            </span><span class="keyword">return</span><span class="normal"> </span><span class="symbol">*</span><span class="keyword">this</span><span class="symbol">;</span>
<span class="normal">        </span><span class="cbracket">}</span>

<span class="normal">        </span><span class="type">bool</span><span class="normal"> </span><span class="function">empty</span><span class="symbol">()</span><span class="normal"> </span><span class="keyword">const</span>
<span class="normal">        </span><span class="cbracket">{</span>
<span class="normal">            </span><span class="keyword">return</span><span class="normal"> done</span><span class="symbol">;</span>
<span class="normal">        </span><span class="cbracket">}</span>
<span class="normal">    </span><span class="cbracket">}</span><span class="symbol">;</span>
<span class="preproc">#endif</span><span class="normal"> </span><span class="comment">// LCP_CALC</span>

<span class="normal">    </span><span class="comment">/**</span>
<span class="comment">     * Create the suffix array from the current sub problem</span>
<span class="comment">     */</span>
<span class="normal">    </span><span class="keyword">template</span><span class="normal"> </span><span class="symbol">&lt;</span><span class="keyword">class</span><span class="normal"> </span><span class="classname">Mod0</span><span class="symbol">,</span><span class="normal"> </span><span class="keyword">class</span><span class="normal"> </span><span class="classname">Mod1</span><span class="symbol">,</span><span class="normal"> </span><span class="keyword">class</span><span class="normal"> </span><span class="classname">Mod2</span><span class="symbol">&gt;</span>
<span class="normal">    </span><span class="keyword">class</span><span class="normal"> </span><span class="classname">merge_sa</span>
<span class="normal">    </span><span class="cbracket">{</span>
<span class="normal">    </span><span class="keyword">public</span><span class="symbol">:</span>
<span class="normal">        </span><span class="keyword">typedef</span><span class="normal"> </span><span class="usertype">offset_type</span><span class="normal"> value_type</span><span class="symbol">;</span>

<span class="normal">    </span><span class="keyword">private</span><span class="symbol">:</span>
<span class="normal">        Mod0 </span><span class="symbol">&amp;</span><span class="normal"> A</span><span class="symbol">;</span>
<span class="normal">        Mod1 </span><span class="symbol">&amp;</span><span class="normal"> B</span><span class="symbol">;</span>
<span class="normal">        Mod2 </span><span class="symbol">&amp;</span><span class="normal"> C</span><span class="symbol">;</span>

<span class="normal">        </span><span class="usertype">skew_quint_type</span><span class="normal"> s0</span><span class="symbol">;</span>
<span class="normal">        </span><span class="usertype">skew_quad_type</span><span class="normal"> s1</span><span class="symbol">;</span>
<span class="normal">        </span><span class="usertype">skew_quint_type</span><span class="normal"> s2</span><span class="symbol">;</span>

<span class="normal">        </span><span class="type">int</span><span class="normal"> selected</span><span class="symbol">;</span>

<span class="normal">        </span><span class="type">bool</span><span class="normal"> exists</span><span class="symbol">[</span><span class="number">3</span><span class="symbol">];</span>

<span class="normal">        </span><span class="usertype">offset_type</span><span class="normal"> index</span><span class="symbol">;</span>
<span class="normal">        </span><span class="usertype">offset_type</span><span class="normal"> merge_result</span><span class="symbol">;</span>

<span class="preproc">#if</span><span class="normal"> LCP_CALC</span>
<span class="normal">        </span><span class="comment">// previous winning tuple</span>
<span class="normal">        </span><span class="type">int</span><span class="normal"> prev_selected</span><span class="symbol">;</span>

<span class="normal">        </span><span class="usertype">skew_quint_type</span><span class="normal"> p0</span><span class="symbol">;</span>
<span class="normal">        </span><span class="usertype">skew_quad_type</span><span class="normal">  p1</span><span class="symbol">;</span>
<span class="normal">        </span><span class="usertype">skew_quint_type</span><span class="normal"> p2</span><span class="symbol">;</span>

<span class="normal">        uint8_array_type</span><span class="symbol">&amp;</span><span class="normal"> lcp_base</span><span class="symbol">;</span>
<span class="normal">        RMQ</span><span class="symbol">&amp;</span><span class="normal"> lcp_rmq</span><span class="symbol">;</span>
<span class="normal">        skew_pair_array_type</span><span class="symbol">&amp;</span><span class="normal"> lcp_rmq_ranks</span><span class="symbol">;</span>
<span class="preproc">#endif</span><span class="normal"> </span><span class="comment">// LCP_CALC</span>

<span class="normal">        </span><span class="comment">/**</span>
<span class="comment">         * Constellation of chars and ranks in streams:</span>
<span class="comment">         * Mod0 quint: </span><span class="keyword">&lt;index</span><span class="normal">, </span><span class="type">character</span><span class="normal">, </span><span class="type">character</span><span class="normal">+</span><span class="type">1</span><span class="normal">, ~</span><span class="type">SA12</span><span class="normal">+</span><span class="type">1</span><span class="normal">, ~</span><span class="type">SA12</span><span class="normal">+</span><span class="type">2</span><span class="keyword">&gt;</span>
<span class="comment">         * Mod1 quad : </span><span class="keyword">&lt;index</span><span class="normal">, ~</span><span class="type">SA12</span><span class="normal"> </span><span class="type">name</span><span class="normal">, </span><span class="type">character</span><span class="normal">, ~</span><span class="type">SA12</span><span class="normal">+</span><span class="type">1</span><span class="normal"> </span><span class="type">name</span><span class="keyword">&gt;</span>
<span class="comment">         * Mod2 quint: </span><span class="keyword">&lt;index</span><span class="normal"> ,~</span><span class="type">SA12</span><span class="normal"> </span><span class="type">name</span><span class="normal">, </span><span class="type">character</span><span class="normal">, </span><span class="type">character</span><span class="normal">+</span><span class="type">1</span><span class="normal">, ~</span><span class="type">SA12</span><span class="normal">+</span><span class="type">2</span><span class="normal"> </span><span class="type">name</span><span class="keyword">&gt;</span>
<span class="comment">         */</span>

<span class="normal">        </span><span class="type">bool</span><span class="normal"> </span><span class="function">cmp_mod12</span><span class="symbol">()</span>
<span class="normal">        </span><span class="cbracket">{</span>
<span class="normal">            </span><span class="keyword">return</span><span class="normal"> s1</span><span class="symbol">.</span><span class="function">get_2</span><span class="symbol">()</span><span class="normal"> </span><span class="symbol">&lt;</span><span class="normal"> s2</span><span class="symbol">.</span><span class="function">get_2</span><span class="symbol">();</span>
<span class="normal">        </span><span class="cbracket">}</span>

<span class="normal">        </span><span class="type">bool</span><span class="normal"> </span><span class="function">cmp_mod02</span><span class="symbol">()</span>
<span class="normal">        </span><span class="cbracket">{</span>
<span class="normal">            </span><span class="keyword">if</span><span class="normal"> </span><span class="symbol">(</span><span class="normal">s0</span><span class="symbol">.</span><span class="function">get_2</span><span class="symbol">()</span><span class="normal"> </span><span class="symbol">==</span><span class="normal"> s2</span><span class="symbol">.</span><span class="function">get_3</span><span class="symbol">())</span><span class="normal"> </span><span class="cbracket">{</span>
<span class="normal">                </span><span class="keyword">if</span><span class="normal"> </span><span class="symbol">(</span><span class="normal">s0</span><span class="symbol">.</span><span class="function">get_3</span><span class="symbol">()</span><span class="normal"> </span><span class="symbol">==</span><span class="normal"> s2</span><span class="symbol">.</span><span class="function">get_4</span><span class="symbol">())</span><span class="normal"> </span><span class="cbracket">{</span>
<span class="normal">                    </span><span class="keyword">return</span><span class="normal"> s0</span><span class="symbol">.</span><span class="function">get_5</span><span class="symbol">()</span><span class="normal"> </span><span class="symbol">&lt;</span><span class="normal"> s2</span><span class="symbol">.</span><span class="function">get_5</span><span class="symbol">();</span>
<span class="normal">                </span><span class="cbracket">}</span>
<span class="normal">                </span><span class="keyword">else</span><span class="normal"> </span><span class="cbracket">{</span>
<span class="normal">                    </span><span class="keyword">return</span><span class="normal"> s0</span><span class="symbol">.</span><span class="function">get_3</span><span class="symbol">()</span><span class="normal"> </span><span class="symbol">&lt;</span><span class="normal"> s2</span><span class="symbol">.</span><span class="function">get_4</span><span class="symbol">();</span>
<span class="normal">                </span><span class="cbracket">}</span>
<span class="normal">            </span><span class="cbracket">}</span>
<span class="normal">            </span><span class="keyword">else</span><span class="normal"> </span><span class="cbracket">{</span>
<span class="normal">                </span><span class="keyword">return</span><span class="normal"> s0</span><span class="symbol">.</span><span class="function">get_2</span><span class="symbol">()</span><span class="normal"> </span><span class="symbol">&lt;</span><span class="normal"> s2</span><span class="symbol">.</span><span class="function">get_3</span><span class="symbol">();</span>
<span class="normal">            </span><span class="cbracket">}</span>
<span class="normal">        </span><span class="cbracket">}</span>

<span class="normal">        </span><span class="type">bool</span><span class="normal"> </span><span class="function">cmp_mod01</span><span class="symbol">()</span>
<span class="normal">        </span><span class="cbracket">{</span>
<span class="normal">            </span><span class="keyword">if</span><span class="normal"> </span><span class="symbol">(</span><span class="normal">s0</span><span class="symbol">.</span><span class="function">get_2</span><span class="symbol">()</span><span class="normal"> </span><span class="symbol">==</span><span class="normal"> s1</span><span class="symbol">.</span><span class="function">get_3</span><span class="symbol">())</span><span class="normal"> </span><span class="cbracket">{</span>
<span class="normal">                </span><span class="keyword">return</span><span class="normal"> s0</span><span class="symbol">.</span><span class="function">get_4</span><span class="symbol">()</span><span class="normal"> </span><span class="symbol">&lt;</span><span class="normal"> s1</span><span class="symbol">.</span><span class="function">get_4</span><span class="symbol">();</span>
<span class="normal">            </span><span class="cbracket">}</span>
<span class="normal">            </span><span class="keyword">else</span><span class="normal"> </span><span class="cbracket">{</span>
<span class="normal">                </span><span class="keyword">return</span><span class="normal"> s0</span><span class="symbol">.</span><span class="function">get_2</span><span class="symbol">()</span><span class="normal"> </span><span class="symbol">&lt;</span><span class="normal"> s1</span><span class="symbol">.</span><span class="function">get_3</span><span class="symbol">();</span>
<span class="normal">            </span><span class="cbracket">}</span>
<span class="normal">        </span><span class="cbracket">}</span>

<span class="normal">        </span><span class="type">void</span><span class="normal"> </span><span class="function">get012</span><span class="symbol">()</span>
<span class="normal">        </span><span class="cbracket">{</span>
<span class="normal">            </span><span class="function">DBG1</span><span class="symbol">(</span><span class="normal">debug_merge</span><span class="symbol">,</span><span class="normal"> </span><span class="string">"0"</span><span class="normal"> </span><span class="symbol">&lt;&lt;</span><span class="normal"> s0 </span><span class="symbol">&lt;&lt;</span><span class="normal"> </span><span class="string">" 1"</span><span class="normal"> </span><span class="symbol">&lt;&lt;</span><span class="normal"> s1 </span><span class="symbol">&lt;&lt;</span><span class="normal"> </span><span class="string">" 2"</span><span class="normal"> </span><span class="symbol">&lt;&lt;</span><span class="normal"> s2 </span><span class="symbol">&lt;&lt;</span><span class="normal"> </span><span class="string">" -&gt; "</span><span class="symbol">);</span>

<span class="normal">            </span><span class="keyword">if</span><span class="normal"> </span><span class="symbol">(</span><span class="function">cmp_mod01</span><span class="symbol">())</span><span class="normal"> </span><span class="cbracket">{</span>
<span class="normal">                </span><span class="keyword">if</span><span class="normal"> </span><span class="symbol">(</span><span class="function">cmp_mod02</span><span class="symbol">())</span><span class="normal"> </span><span class="cbracket">{</span>
<span class="normal">                    selected </span><span class="symbol">=</span><span class="normal"> </span><span class="number">0</span><span class="symbol">;</span>
<span class="normal">                    merge_result </span><span class="symbol">=</span><span class="normal"> s0</span><span class="symbol">.</span><span class="function">get_1</span><span class="symbol">();</span>
<span class="normal">                </span><span class="cbracket">}</span>
<span class="normal">                </span><span class="keyword">else</span><span class="normal"> </span><span class="cbracket">{</span>
<span class="normal">                    selected </span><span class="symbol">=</span><span class="normal"> </span><span class="number">2</span><span class="symbol">;</span>
<span class="normal">                    merge_result </span><span class="symbol">=</span><span class="normal"> s2</span><span class="symbol">.</span><span class="function">get_1</span><span class="symbol">();</span>
<span class="normal">                </span><span class="cbracket">}</span>
<span class="normal">            </span><span class="cbracket">}</span>
<span class="normal">            </span><span class="keyword">else</span><span class="normal"> </span><span class="cbracket">{</span>
<span class="normal">                </span><span class="keyword">if</span><span class="normal"> </span><span class="symbol">(</span><span class="function">cmp_mod12</span><span class="symbol">())</span><span class="normal"> </span><span class="cbracket">{</span>
<span class="normal">                    selected </span><span class="symbol">=</span><span class="normal"> </span><span class="number">1</span><span class="symbol">;</span>
<span class="normal">                    merge_result </span><span class="symbol">=</span><span class="normal"> s1</span><span class="symbol">.</span><span class="function">get_1</span><span class="symbol">();</span>
<span class="normal">                </span><span class="cbracket">}</span>
<span class="normal">                </span><span class="keyword">else</span><span class="normal"> </span><span class="cbracket">{</span>
<span class="normal">                    selected </span><span class="symbol">=</span><span class="normal"> </span><span class="number">2</span><span class="symbol">;</span>
<span class="normal">                    merge_result </span><span class="symbol">=</span><span class="normal"> s2</span><span class="symbol">.</span><span class="function">get_1</span><span class="symbol">();</span>
<span class="normal">                </span><span class="cbracket">}</span>
<span class="normal">            </span><span class="cbracket">}</span>

<span class="normal">            </span><span class="function">DBG3</span><span class="symbol">(</span><span class="normal">debug_merge</span><span class="symbol">,</span><span class="normal"> </span><span class="string">"selected "</span><span class="normal"> </span><span class="symbol">&lt;&lt;</span><span class="normal"> selected </span><span class="symbol">&lt;&lt;</span><span class="normal"> </span><span class="string">" - index "</span><span class="normal"> </span><span class="symbol">&lt;&lt;</span><span class="normal"> merge_result</span><span class="symbol">);</span>
<span class="normal">        </span><span class="cbracket">}</span>

<span class="normal">        </span><span class="type">void</span><span class="normal"> </span><span class="function">get01</span><span class="symbol">()</span>
<span class="normal">        </span><span class="cbracket">{</span>
<span class="normal">            </span><span class="function">DBG1</span><span class="symbol">(</span><span class="normal">debug_merge</span><span class="symbol">,</span><span class="normal"> </span><span class="string">"0"</span><span class="normal"> </span><span class="symbol">&lt;&lt;</span><span class="normal"> s0 </span><span class="symbol">&lt;&lt;</span><span class="normal"> </span><span class="string">" 1"</span><span class="normal"> </span><span class="symbol">&lt;&lt;</span><span class="normal"> s1 </span><span class="symbol">&lt;&lt;</span><span class="normal"> </span><span class="string">" -&gt; "</span><span class="symbol">);</span>

<span class="normal">            </span><span class="keyword">if</span><span class="normal"> </span><span class="symbol">(</span><span class="function">cmp_mod01</span><span class="symbol">())</span><span class="normal"> </span><span class="cbracket">{</span>
<span class="normal">                selected </span><span class="symbol">=</span><span class="normal"> </span><span class="number">0</span><span class="symbol">;</span>
<span class="normal">                merge_result </span><span class="symbol">=</span><span class="normal"> s0</span><span class="symbol">.</span><span class="function">get_1</span><span class="symbol">();</span>
<span class="normal">            </span><span class="cbracket">}</span>
<span class="normal">            </span><span class="keyword">else</span><span class="normal"> </span><span class="cbracket">{</span>
<span class="normal">                selected </span><span class="symbol">=</span><span class="normal"> </span><span class="number">1</span><span class="symbol">;</span>
<span class="normal">                merge_result </span><span class="symbol">=</span><span class="normal"> s1</span><span class="symbol">.</span><span class="function">get_1</span><span class="symbol">();</span>
<span class="normal">            </span><span class="cbracket">}</span>

<span class="normal">            </span><span class="function">DBG3</span><span class="symbol">(</span><span class="normal">debug_merge</span><span class="symbol">,</span><span class="normal"> </span><span class="string">"selected "</span><span class="normal"> </span><span class="symbol">&lt;&lt;</span><span class="normal"> selected </span><span class="symbol">&lt;&lt;</span><span class="normal"> </span><span class="string">" - index "</span><span class="normal"> </span><span class="symbol">&lt;&lt;</span><span class="normal"> merge_result</span><span class="symbol">);</span>
<span class="normal">        </span><span class="cbracket">}</span>

<span class="normal">        </span><span class="type">void</span><span class="normal"> </span><span class="function">get12</span><span class="symbol">()</span>
<span class="normal">        </span><span class="cbracket">{</span>
<span class="normal">            </span><span class="function">DBG1</span><span class="symbol">(</span><span class="normal">debug_merge</span><span class="symbol">,</span><span class="normal"> </span><span class="string">"1"</span><span class="normal"> </span><span class="symbol">&lt;&lt;</span><span class="normal"> s1 </span><span class="symbol">&lt;&lt;</span><span class="normal"> </span><span class="string">" 2"</span><span class="normal"> </span><span class="symbol">&lt;&lt;</span><span class="normal"> s2 </span><span class="symbol">&lt;&lt;</span><span class="normal"> </span><span class="string">" -&gt; "</span><span class="symbol">);</span>

<span class="normal">            </span><span class="keyword">if</span><span class="normal"> </span><span class="symbol">(</span><span class="function">cmp_mod12</span><span class="symbol">())</span><span class="normal"> </span><span class="cbracket">{</span>
<span class="normal">                selected </span><span class="symbol">=</span><span class="normal"> </span><span class="number">1</span><span class="symbol">;</span>
<span class="normal">                merge_result </span><span class="symbol">=</span><span class="normal"> s1</span><span class="symbol">.</span><span class="function">get_1</span><span class="symbol">();</span>
<span class="normal">            </span><span class="cbracket">}</span>
<span class="normal">            </span><span class="keyword">else</span><span class="normal"> </span><span class="cbracket">{</span>
<span class="normal">                selected </span><span class="symbol">=</span><span class="normal"> </span><span class="number">2</span><span class="symbol">;</span>
<span class="normal">                merge_result </span><span class="symbol">=</span><span class="normal"> s2</span><span class="symbol">.</span><span class="function">get_1</span><span class="symbol">();</span>
<span class="normal">            </span><span class="cbracket">}</span>

<span class="normal">            </span><span class="function">DBG3</span><span class="symbol">(</span><span class="normal">debug_merge</span><span class="symbol">,</span><span class="normal"> </span><span class="string">"selected "</span><span class="normal"> </span><span class="symbol">&lt;&lt;</span><span class="normal"> selected </span><span class="symbol">&lt;&lt;</span><span class="normal"> </span><span class="string">" - index "</span><span class="normal"> </span><span class="symbol">&lt;&lt;</span><span class="normal"> merge_result</span><span class="symbol">);</span>
<span class="normal">        </span><span class="cbracket">}</span>

<span class="normal">        </span><span class="type">void</span><span class="normal"> </span><span class="function">get02</span><span class="symbol">()</span>
<span class="normal">        </span><span class="cbracket">{</span>
<span class="normal">            </span><span class="function">DBG1</span><span class="symbol">(</span><span class="normal">debug_merge</span><span class="symbol">,</span><span class="normal"> </span><span class="string">"0"</span><span class="normal"> </span><span class="symbol">&lt;&lt;</span><span class="normal"> s0 </span><span class="symbol">&lt;&lt;</span><span class="normal"> </span><span class="string">" 2"</span><span class="normal"> </span><span class="symbol">&lt;&lt;</span><span class="normal"> s2 </span><span class="symbol">&lt;&lt;</span><span class="normal"> </span><span class="string">" -&gt; "</span><span class="symbol">);</span>

<span class="normal">            </span><span class="keyword">if</span><span class="normal"> </span><span class="symbol">(</span><span class="function">cmp_mod02</span><span class="symbol">())</span><span class="normal"> </span><span class="cbracket">{</span>
<span class="normal">                selected </span><span class="symbol">=</span><span class="normal"> </span><span class="number">0</span><span class="symbol">;</span>
<span class="normal">                merge_result </span><span class="symbol">=</span><span class="normal"> s0</span><span class="symbol">.</span><span class="function">get_1</span><span class="symbol">();</span>
<span class="normal">            </span><span class="cbracket">}</span>
<span class="normal">            </span><span class="keyword">else</span><span class="normal"> </span><span class="cbracket">{</span>
<span class="normal">                selected </span><span class="symbol">=</span><span class="normal"> </span><span class="number">2</span><span class="symbol">;</span>
<span class="normal">                merge_result </span><span class="symbol">=</span><span class="normal"> s2</span><span class="symbol">.</span><span class="function">get_1</span><span class="symbol">();</span>
<span class="normal">            </span><span class="cbracket">}</span>

<span class="normal">            </span><span class="function">DBG3</span><span class="symbol">(</span><span class="normal">debug_merge</span><span class="symbol">,</span><span class="normal"> </span><span class="string">"selected "</span><span class="normal"> </span><span class="symbol">&lt;&lt;</span><span class="normal"> selected </span><span class="symbol">&lt;&lt;</span><span class="normal"> </span><span class="string">" - index "</span><span class="normal"> </span><span class="symbol">&lt;&lt;</span><span class="normal"> merge_result</span><span class="symbol">);</span>
<span class="normal">        </span><span class="cbracket">}</span>

<span class="normal">        </span><span class="type">void</span><span class="normal"> </span><span class="function">solve</span><span class="symbol">()</span>
<span class="normal">        </span><span class="cbracket">{</span>
<span class="preproc">#if</span><span class="normal"> LCP_CALC</span>
<span class="normal">            prev_selected </span><span class="symbol">=</span><span class="normal"> selected</span><span class="symbol">;</span>
<span class="preproc">#endif</span><span class="normal"> </span><span class="comment">// LCP_CALC</span>

<span class="normal">            </span><span class="keyword">if</span><span class="normal"> </span><span class="symbol">(</span><span class="normal">exists</span><span class="symbol">[</span><span class="number">0</span><span class="symbol">])</span><span class="normal"> </span><span class="cbracket">{</span>
<span class="normal">                </span><span class="keyword">if</span><span class="normal"> </span><span class="symbol">(</span><span class="normal">exists</span><span class="symbol">[</span><span class="number">1</span><span class="symbol">])</span><span class="normal"> </span><span class="cbracket">{</span>
<span class="normal">                    </span><span class="keyword">if</span><span class="normal"> </span><span class="symbol">(</span><span class="normal">exists</span><span class="symbol">[</span><span class="number">2</span><span class="symbol">])</span><span class="normal"> </span><span class="cbracket">{</span>
<span class="normal">                        </span><span class="function">get012</span><span class="symbol">();</span>
<span class="normal">                    </span><span class="cbracket">}</span>
<span class="normal">                    </span><span class="keyword">else</span><span class="normal"> </span><span class="cbracket">{</span>
<span class="normal">                        </span><span class="function">get01</span><span class="symbol">();</span>
<span class="normal">                    </span><span class="cbracket">}</span>
<span class="normal">                </span><span class="cbracket">}</span>
<span class="normal">                </span><span class="keyword">else</span><span class="normal"> </span><span class="cbracket">{</span>
<span class="normal">                    </span><span class="keyword">if</span><span class="normal"> </span><span class="symbol">(</span><span class="normal">exists</span><span class="symbol">[</span><span class="number">2</span><span class="symbol">])</span><span class="normal"> </span><span class="cbracket">{</span>
<span class="normal">                        </span><span class="function">get02</span><span class="symbol">();</span>
<span class="normal">                    </span><span class="cbracket">}</span>
<span class="normal">                    </span><span class="keyword">else</span><span class="normal"> </span><span class="cbracket">{</span>
<span class="normal">                        selected </span><span class="symbol">=</span><span class="normal"> </span><span class="number">0</span><span class="symbol">;</span>
<span class="normal">                        merge_result </span><span class="symbol">=</span><span class="normal"> s0</span><span class="symbol">.</span><span class="function">get_1</span><span class="symbol">();</span>
<span class="normal">                        </span><span class="function">DBG</span><span class="symbol">(</span><span class="normal">debug_merge</span><span class="symbol">,</span><span class="normal"> </span><span class="string">"get0(): 0"</span><span class="normal"> </span><span class="symbol">&lt;&lt;</span><span class="normal"> s0 </span><span class="symbol">&lt;&lt;</span><span class="normal"> </span><span class="string">" -&gt; selected "</span><span class="normal"> </span><span class="symbol">&lt;&lt;</span><span class="normal"> selected </span><span class="symbol">&lt;&lt;</span><span class="normal"> </span><span class="string">" - index "</span><span class="normal"> </span><span class="symbol">&lt;&lt;</span><span class="normal"> merge_result</span><span class="symbol">);</span>
<span class="normal">                    </span><span class="cbracket">}</span>
<span class="normal">                </span><span class="cbracket">}</span>
<span class="normal">            </span><span class="cbracket">}</span>
<span class="normal">            </span><span class="keyword">else</span><span class="normal"> </span><span class="cbracket">{</span>
<span class="normal">                </span><span class="keyword">if</span><span class="normal"> </span><span class="symbol">(</span><span class="normal">exists</span><span class="symbol">[</span><span class="number">1</span><span class="symbol">])</span><span class="normal"> </span><span class="cbracket">{</span>
<span class="normal">                    </span><span class="keyword">if</span><span class="normal"> </span><span class="symbol">(</span><span class="normal">exists</span><span class="symbol">[</span><span class="number">2</span><span class="symbol">])</span><span class="normal"> </span><span class="cbracket">{</span>
<span class="normal">                        </span><span class="function">get12</span><span class="symbol">();</span>
<span class="normal">                    </span><span class="cbracket">}</span>
<span class="normal">                    </span><span class="keyword">else</span><span class="normal"> </span><span class="cbracket">{</span>
<span class="normal">                        selected </span><span class="symbol">=</span><span class="normal"> </span><span class="number">1</span><span class="symbol">;</span>
<span class="normal">                        merge_result </span><span class="symbol">=</span><span class="normal"> s1</span><span class="symbol">.</span><span class="function">get_1</span><span class="symbol">();</span>
<span class="normal">                        </span><span class="function">DBG</span><span class="symbol">(</span><span class="normal">debug_merge</span><span class="symbol">,</span><span class="normal"> </span><span class="string">"get1(): 1"</span><span class="normal"> </span><span class="symbol">&lt;&lt;</span><span class="normal"> s1 </span><span class="symbol">&lt;&lt;</span><span class="normal"> </span><span class="string">" -&gt; selected "</span><span class="normal"> </span><span class="symbol">&lt;&lt;</span><span class="normal"> selected </span><span class="symbol">&lt;&lt;</span><span class="normal"> </span><span class="string">" - index "</span><span class="normal"> </span><span class="symbol">&lt;&lt;</span><span class="normal"> merge_result</span><span class="symbol">);</span>
<span class="normal">                    </span><span class="cbracket">}</span>
<span class="normal">                </span><span class="cbracket">}</span>
<span class="normal">                </span><span class="keyword">else</span><span class="normal"> </span><span class="cbracket">{</span>
<span class="normal">                    </span><span class="keyword">if</span><span class="normal"> </span><span class="symbol">(</span><span class="normal">exists</span><span class="symbol">[</span><span class="number">2</span><span class="symbol">])</span><span class="normal"> </span><span class="cbracket">{</span>
<span class="normal">                        selected </span><span class="symbol">=</span><span class="normal"> </span><span class="number">2</span><span class="symbol">;</span>
<span class="normal">                        merge_result </span><span class="symbol">=</span><span class="normal"> s2</span><span class="symbol">.</span><span class="function">get_1</span><span class="symbol">();</span>
<span class="normal">                        </span><span class="function">DBG</span><span class="symbol">(</span><span class="normal">debug_merge</span><span class="symbol">,</span><span class="normal"> </span><span class="string">"get2(): 2"</span><span class="normal"> </span><span class="symbol">&lt;&lt;</span><span class="normal"> s2 </span><span class="symbol">&lt;&lt;</span><span class="normal"> </span><span class="string">" -&gt; selected "</span><span class="normal"> </span><span class="symbol">&lt;&lt;</span><span class="normal"> selected </span><span class="symbol">&lt;&lt;</span><span class="normal"> </span><span class="string">" - index "</span><span class="normal"> </span><span class="symbol">&lt;&lt;</span><span class="normal"> merge_result</span><span class="symbol">);</span>
<span class="normal">                    </span><span class="cbracket">}</span>
<span class="normal">                    </span><span class="keyword">else</span><span class="normal"> </span><span class="cbracket">{</span>
<span class="normal">                        </span><span class="function">assert</span><span class="symbol">(</span><span class="keyword">false</span><span class="symbol">);</span>
<span class="normal">                    </span><span class="cbracket">}</span>

<span class="normal">                </span><span class="cbracket">}</span>
<span class="normal">            </span><span class="cbracket">}</span>

<span class="normal">            </span><span class="function">DBG</span><span class="symbol">(</span><span class="normal">debug_merge_result</span><span class="symbol">,</span><span class="normal"> merge_result</span><span class="symbol">);</span>

<span class="preproc">#if</span><span class="normal"> LCP_CALC</span>
<span class="normal">            </span><span class="comment">// calculate lcp of previous tuple to next winner</span>

<span class="normal">            </span><span class="keyword">if</span><span class="normal"> </span><span class="symbol">(</span><span class="normal">prev_selected </span><span class="symbol">&lt;</span><span class="normal"> </span><span class="number">0</span><span class="symbol">)</span>
<span class="normal">            </span><span class="cbracket">{</span>
<span class="normal">                lcp_base</span><span class="symbol">.</span><span class="function">push_back</span><span class="symbol">(</span><span class="number">0</span><span class="symbol">);</span><span class="normal"> </span><span class="comment">// first lcp is zero</span>
<span class="normal">            </span><span class="cbracket">}</span>
<span class="normal">            </span><span class="keyword">else</span><span class="normal"> </span><span class="keyword">if</span><span class="normal"> </span><span class="symbol">(</span><span class="normal">prev_selected </span><span class="symbol">==</span><span class="normal"> </span><span class="number">0</span><span class="normal"> </span><span class="symbol">&amp;&amp;</span><span class="normal"> selected </span><span class="symbol">==</span><span class="normal"> </span><span class="number">0</span><span class="symbol">)</span>
<span class="normal">            </span><span class="cbracket">{</span>
<span class="normal">                </span><span class="function">calc_lcp_char2</span><span class="symbol">(</span><span class="normal">p0</span><span class="symbol">.</span><span class="function">get_2</span><span class="symbol">(),</span><span class="normal"> s0</span><span class="symbol">.</span><span class="function">get_2</span><span class="symbol">(),</span>
<span class="normal">                               p0</span><span class="symbol">.</span><span class="function">get_3</span><span class="symbol">(),</span><span class="normal"> s0</span><span class="symbol">.</span><span class="function">get_3</span><span class="symbol">(),</span>
<span class="normal">                               p0</span><span class="symbol">.</span><span class="function">get_5</span><span class="symbol">(),</span><span class="normal"> s0</span><span class="symbol">.</span><span class="function">get_5</span><span class="symbol">());</span>
<span class="normal">            </span><span class="cbracket">}</span>
<span class="normal">            </span><span class="keyword">else</span><span class="normal"> </span><span class="keyword">if</span><span class="normal"> </span><span class="symbol">(</span><span class="normal">prev_selected </span><span class="symbol">==</span><span class="normal"> </span><span class="number">0</span><span class="normal"> </span><span class="symbol">&amp;&amp;</span><span class="normal"> selected </span><span class="symbol">==</span><span class="normal"> </span><span class="number">1</span><span class="symbol">)</span>
<span class="normal">            </span><span class="cbracket">{</span>
<span class="normal">                </span><span class="function">calc_lcp_char1</span><span class="symbol">(</span><span class="normal">p0</span><span class="symbol">.</span><span class="function">get_2</span><span class="symbol">(),</span><span class="normal"> s1</span><span class="symbol">.</span><span class="function">get_3</span><span class="symbol">(),</span>
<span class="normal">                               p0</span><span class="symbol">.</span><span class="function">get_4</span><span class="symbol">(),</span><span class="normal"> s1</span><span class="symbol">.</span><span class="function">get_4</span><span class="symbol">());</span>
<span class="normal">            </span><span class="cbracket">}</span>
<span class="normal">            </span><span class="keyword">else</span><span class="normal"> </span><span class="keyword">if</span><span class="normal"> </span><span class="symbol">(</span><span class="normal">prev_selected </span><span class="symbol">==</span><span class="normal"> </span><span class="number">0</span><span class="normal"> </span><span class="symbol">&amp;&amp;</span><span class="normal"> selected </span><span class="symbol">==</span><span class="normal"> </span><span class="number">2</span><span class="symbol">)</span>
<span class="normal">            </span><span class="cbracket">{</span>
<span class="normal">                </span><span class="function">calc_lcp_char2</span><span class="symbol">(</span><span class="normal">p0</span><span class="symbol">.</span><span class="function">get_2</span><span class="symbol">(),</span><span class="normal"> s2</span><span class="symbol">.</span><span class="function">get_3</span><span class="symbol">(),</span>
<span class="normal">                               p0</span><span class="symbol">.</span><span class="function">get_3</span><span class="symbol">(),</span><span class="normal"> s2</span><span class="symbol">.</span><span class="function">get_4</span><span class="symbol">(),</span>
<span class="normal">                               p0</span><span class="symbol">.</span><span class="function">get_5</span><span class="symbol">(),</span><span class="normal"> s2</span><span class="symbol">.</span><span class="function">get_5</span><span class="symbol">());</span>
<span class="normal">            </span><span class="cbracket">}</span>
<span class="normal">            </span><span class="keyword">else</span><span class="normal"> </span><span class="keyword">if</span><span class="normal"> </span><span class="symbol">(</span><span class="normal">prev_selected </span><span class="symbol">==</span><span class="normal"> </span><span class="number">1</span><span class="normal"> </span><span class="symbol">&amp;&amp;</span><span class="normal"> selected </span><span class="symbol">==</span><span class="normal"> </span><span class="number">0</span><span class="symbol">)</span>
<span class="normal">            </span><span class="cbracket">{</span>
<span class="normal">                </span><span class="function">calc_lcp_char1</span><span class="symbol">(</span><span class="normal">p1</span><span class="symbol">.</span><span class="function">get_3</span><span class="symbol">(),</span><span class="normal"> s0</span><span class="symbol">.</span><span class="function">get_2</span><span class="symbol">(),</span>
<span class="normal">                               p1</span><span class="symbol">.</span><span class="function">get_4</span><span class="symbol">(),</span><span class="normal"> s0</span><span class="symbol">.</span><span class="function">get_4</span><span class="symbol">());</span>
<span class="normal">            </span><span class="cbracket">}</span>
<span class="normal">            </span><span class="keyword">else</span><span class="normal"> </span><span class="keyword">if</span><span class="normal"> </span><span class="symbol">(</span><span class="normal">prev_selected </span><span class="symbol">==</span><span class="normal"> </span><span class="number">1</span><span class="normal"> </span><span class="symbol">&amp;&amp;</span><span class="normal"> selected </span><span class="symbol">==</span><span class="normal"> </span><span class="number">1</span><span class="symbol">)</span>
<span class="normal">            </span><span class="cbracket">{</span>
<span class="normal">                </span><span class="function">calc_lcp_char0</span><span class="symbol">(</span><span class="normal">p1</span><span class="symbol">.</span><span class="function">get_2</span><span class="symbol">(),</span><span class="normal"> s1</span><span class="symbol">.</span><span class="function">get_2</span><span class="symbol">());</span>
<span class="normal">            </span><span class="cbracket">}</span>
<span class="normal">            </span><span class="keyword">else</span><span class="normal"> </span><span class="keyword">if</span><span class="normal"> </span><span class="symbol">(</span><span class="normal">prev_selected </span><span class="symbol">==</span><span class="normal"> </span><span class="number">1</span><span class="normal"> </span><span class="symbol">&amp;&amp;</span><span class="normal"> selected </span><span class="symbol">==</span><span class="normal"> </span><span class="number">2</span><span class="symbol">)</span>
<span class="normal">            </span><span class="cbracket">{</span>
<span class="normal">                </span><span class="function">calc_lcp_char0</span><span class="symbol">(</span><span class="normal">p1</span><span class="symbol">.</span><span class="function">get_2</span><span class="symbol">(),</span><span class="normal"> s2</span><span class="symbol">.</span><span class="function">get_2</span><span class="symbol">());</span>
<span class="normal">            </span><span class="cbracket">}</span>
<span class="normal">            </span><span class="keyword">else</span><span class="normal"> </span><span class="keyword">if</span><span class="normal"> </span><span class="symbol">(</span><span class="normal">prev_selected </span><span class="symbol">==</span><span class="normal"> </span><span class="number">2</span><span class="normal"> </span><span class="symbol">&amp;&amp;</span><span class="normal"> selected </span><span class="symbol">==</span><span class="normal"> </span><span class="number">0</span><span class="symbol">)</span>
<span class="normal">            </span><span class="cbracket">{</span>
<span class="normal">                </span><span class="function">calc_lcp_char2</span><span class="symbol">(</span><span class="normal">p2</span><span class="symbol">.</span><span class="function">get_3</span><span class="symbol">(),</span><span class="normal"> s0</span><span class="symbol">.</span><span class="function">get_2</span><span class="symbol">(),</span>
<span class="normal">                               p2</span><span class="symbol">.</span><span class="function">get_4</span><span class="symbol">(),</span><span class="normal"> s0</span><span class="symbol">.</span><span class="function">get_3</span><span class="symbol">(),</span>
<span class="normal">                               p2</span><span class="symbol">.</span><span class="function">get_5</span><span class="symbol">(),</span><span class="normal"> s0</span><span class="symbol">.</span><span class="function">get_5</span><span class="symbol">());</span>
<span class="normal">            </span><span class="cbracket">}</span>
<span class="normal">            </span><span class="keyword">else</span><span class="normal"> </span><span class="keyword">if</span><span class="normal"> </span><span class="symbol">(</span><span class="normal">prev_selected </span><span class="symbol">==</span><span class="normal"> </span><span class="number">2</span><span class="normal"> </span><span class="symbol">&amp;&amp;</span><span class="normal"> selected </span><span class="symbol">==</span><span class="normal"> </span><span class="number">1</span><span class="symbol">)</span>
<span class="normal">            </span><span class="cbracket">{</span>
<span class="normal">                </span><span class="function">calc_lcp_char0</span><span class="symbol">(</span><span class="normal">p2</span><span class="symbol">.</span><span class="function">get_2</span><span class="symbol">(),</span><span class="normal"> s1</span><span class="symbol">.</span><span class="function">get_2</span><span class="symbol">());</span>
<span class="normal">            </span><span class="cbracket">}</span>
<span class="normal">            </span><span class="keyword">else</span><span class="normal"> </span><span class="keyword">if</span><span class="normal"> </span><span class="symbol">(</span><span class="normal">prev_selected </span><span class="symbol">==</span><span class="normal"> </span><span class="number">2</span><span class="normal"> </span><span class="symbol">&amp;&amp;</span><span class="normal"> selected </span><span class="symbol">==</span><span class="normal"> </span><span class="number">2</span><span class="symbol">)</span>
<span class="normal">            </span><span class="cbracket">{</span>
<span class="normal">                </span><span class="function">calc_lcp_char0</span><span class="symbol">(</span><span class="normal">p2</span><span class="symbol">.</span><span class="function">get_2</span><span class="symbol">(),</span><span class="normal"> s2</span><span class="symbol">.</span><span class="function">get_2</span><span class="symbol">());</span>
<span class="normal">            </span><span class="cbracket">}</span>
<span class="normal">            </span><span class="keyword">else</span><span class="normal"> </span><span class="cbracket">{</span>
<span class="normal">                </span><span class="function">assert</span><span class="symbol">(!</span><span class="string">"Impossible case"</span><span class="symbol">);</span>
<span class="normal">            </span><span class="cbracket">}</span>

<span class="normal">            </span><span class="keyword">if</span><span class="normal"> </span><span class="symbol">(</span><span class="normal">selected </span><span class="symbol">==</span><span class="normal"> </span><span class="number">0</span><span class="symbol">)</span>
<span class="normal">                p0 </span><span class="symbol">=</span><span class="normal"> s0</span><span class="symbol">;</span>
<span class="normal">            </span><span class="keyword">else</span><span class="normal"> </span><span class="keyword">if</span><span class="normal"> </span><span class="symbol">(</span><span class="normal">selected </span><span class="symbol">==</span><span class="normal"> </span><span class="number">1</span><span class="symbol">)</span>
<span class="normal">                p1 </span><span class="symbol">=</span><span class="normal"> s1</span><span class="symbol">;</span>
<span class="normal">            </span><span class="keyword">else</span><span class="normal"> </span><span class="keyword">if</span><span class="normal"> </span><span class="symbol">(</span><span class="normal">selected </span><span class="symbol">==</span><span class="normal"> </span><span class="number">2</span><span class="symbol">)</span>
<span class="normal">                p2 </span><span class="symbol">=</span><span class="normal"> s2</span><span class="symbol">;</span>
<span class="normal">            </span><span class="keyword">else</span>
<span class="normal">                </span><span class="function">assert</span><span class="symbol">(!</span><span class="string">"Impossible case"</span><span class="symbol">);</span>
<span class="preproc">#endif</span><span class="normal"> </span><span class="comment">// LCP_CALC</span>
<span class="normal">        </span><span class="cbracket">}</span>

<span class="preproc">#if</span><span class="normal"> LCP_CALC</span>
<span class="normal">        </span><span class="type">void</span><span class="normal"> </span><span class="function">save_rmq</span><span class="symbol">(</span><span class="keyword">const</span><span class="normal"> offset_type</span><span class="symbol">&amp;</span><span class="normal"> rankA</span><span class="symbol">,</span><span class="normal"> </span><span class="keyword">const</span><span class="normal"> offset_type</span><span class="symbol">&amp;</span><span class="normal"> rankB</span><span class="symbol">)</span>
<span class="normal">        </span><span class="cbracket">{</span>
<span class="normal">            </span><span class="keyword">if</span><span class="normal"> </span><span class="symbol">(</span><span class="normal">rankA </span><span class="symbol">==</span><span class="normal"> </span><span class="function">offset_type</span><span class="symbol">(</span><span class="number">0</span><span class="symbol">))</span><span class="normal"> </span><span class="keyword">return</span><span class="symbol">;</span>
<span class="normal">            </span><span class="function">assert</span><span class="symbol">(</span><span class="normal">rankA </span><span class="symbol">&gt;</span><span class="normal"> </span><span class="function">offset_type</span><span class="symbol">(</span><span class="number">0</span><span class="symbol">));</span><span class="normal"> </span><span class="function">assert</span><span class="symbol">(</span><span class="normal">rankB </span><span class="symbol">&gt;</span><span class="normal"> </span><span class="function">offset_type</span><span class="symbol">(</span><span class="number">0</span><span class="symbol">));</span>

<span class="normal">            lcp_rmq</span><span class="symbol">.</span><span class="function">query</span><span class="symbol">(</span><span class="normal">rankA</span><span class="symbol">-</span><span class="number">1</span><span class="symbol">+</span><span class="number">1</span><span class="symbol">,</span><span class="normal"> rankB</span><span class="symbol">-</span><span class="number">1</span><span class="symbol">,</span><span class="normal"> index</span><span class="symbol">);</span>
<span class="normal">            lcp_rmq_ranks</span><span class="symbol">.</span><span class="function">push_back</span><span class="symbol">(</span><span class="normal"> </span><span class="function">skew_pair_type</span><span class="symbol">(</span><span class="normal">rankA</span><span class="symbol">-</span><span class="number">1</span><span class="symbol">,</span><span class="normal"> rankB</span><span class="symbol">-</span><span class="number">1</span><span class="symbol">)</span><span class="normal"> </span><span class="symbol">);</span>
<span class="normal">        </span><span class="cbracket">}</span>

<span class="normal">        </span><span class="type">void</span><span class="normal"> </span><span class="function">calc_lcp_char0</span><span class="symbol">(</span><span class="keyword">const</span><span class="normal"> offset_type</span><span class="symbol">&amp;</span><span class="normal"> rankA</span><span class="symbol">,</span><span class="normal"> </span><span class="keyword">const</span><span class="normal"> offset_type</span><span class="symbol">&amp;</span><span class="normal"> rankB</span><span class="symbol">)</span>
<span class="normal">        </span><span class="cbracket">{</span>
<span class="normal">            </span><span class="function">DBG</span><span class="symbol">(</span><span class="normal">debug_merge_lcp</span><span class="symbol">,</span><span class="normal"> </span><span class="string">"lcp["</span><span class="normal"> </span><span class="symbol">&lt;&lt;</span><span class="normal"> index </span><span class="symbol">&lt;&lt;</span><span class="normal"> </span><span class="string">"] = 0 + rmq_lcp("</span><span class="normal"> </span><span class="symbol">&lt;&lt;</span><span class="normal"> rankA</span><span class="symbol">-</span><span class="number">1</span><span class="normal"> </span><span class="symbol">&lt;&lt;</span><span class="normal"> </span><span class="string">"+1,"</span><span class="normal"> </span><span class="symbol">&lt;&lt;</span><span class="normal"> rankB</span><span class="symbol">-</span><span class="number">1</span><span class="normal"> </span><span class="symbol">&lt;&lt;</span><span class="normal"> </span><span class="string">")"</span><span class="symbol">);</span>
<span class="normal">            </span><span class="function">assert</span><span class="symbol">(</span><span class="normal">rankB </span><span class="symbol">&gt;</span><span class="normal"> </span><span class="function">offset_type</span><span class="symbol">(</span><span class="number">0</span><span class="symbol">));</span>
<span class="normal">            lcp_base</span><span class="symbol">.</span><span class="function">push_back</span><span class="symbol">(</span><span class="number">0</span><span class="symbol">);</span>
<span class="normal">            </span><span class="function">save_rmq</span><span class="symbol">(</span><span class="normal">rankA</span><span class="symbol">,</span><span class="normal"> rankB</span><span class="symbol">);</span>
<span class="normal">        </span><span class="cbracket">}</span>

<span class="normal">        </span><span class="type">void</span><span class="normal"> </span><span class="function">calc_lcp_char1</span><span class="symbol">(</span><span class="keyword">const</span><span class="normal"> offset_type</span><span class="symbol">&amp;</span><span class="normal"> chA0</span><span class="symbol">,</span><span class="normal"> </span><span class="keyword">const</span><span class="normal"> offset_type</span><span class="symbol">&amp;</span><span class="normal"> chB0</span><span class="symbol">,</span>
<span class="normal">                            </span><span class="keyword">const</span><span class="normal"> offset_type</span><span class="symbol">&amp;</span><span class="normal"> rankA</span><span class="symbol">,</span><span class="normal"> </span><span class="keyword">const</span><span class="normal"> offset_type</span><span class="symbol">&amp;</span><span class="normal"> rankB</span><span class="symbol">)</span>
<span class="normal">        </span><span class="cbracket">{</span>
<span class="normal">            </span><span class="keyword">if</span><span class="normal"> </span><span class="symbol">(</span><span class="normal">chA0 </span><span class="symbol">!=</span><span class="normal"> chB0</span><span class="symbol">)</span><span class="normal"> </span><span class="cbracket">{</span>
<span class="normal">                </span><span class="function">DBG</span><span class="symbol">(</span><span class="normal">debug_merge_lcp</span><span class="symbol">,</span><span class="normal"> </span><span class="string">"lcp["</span><span class="normal"> </span><span class="symbol">&lt;&lt;</span><span class="normal"> index </span><span class="symbol">&lt;&lt;</span><span class="normal"> </span><span class="string">"] = 0"</span><span class="symbol">);</span>
<span class="normal">                lcp_base</span><span class="symbol">.</span><span class="function">push_back</span><span class="symbol">(</span><span class="number">0</span><span class="symbol">);</span>
<span class="normal">            </span><span class="cbracket">}</span>
<span class="normal">            </span><span class="keyword">else</span><span class="normal"> </span><span class="cbracket">{</span>
<span class="normal">                </span><span class="function">DBG</span><span class="symbol">(</span><span class="normal">debug_merge_lcp</span><span class="symbol">,</span><span class="normal"> </span><span class="string">"lcp["</span><span class="normal"> </span><span class="symbol">&lt;&lt;</span><span class="normal"> index </span><span class="symbol">&lt;&lt;</span><span class="normal"> </span><span class="string">"] = 1 + rmq_lcp("</span><span class="normal"> </span><span class="symbol">&lt;&lt;</span><span class="normal"> rankA</span><span class="symbol">-</span><span class="number">1</span><span class="normal"> </span><span class="symbol">&lt;&lt;</span><span class="normal"> </span><span class="string">"+1,"</span><span class="normal"> </span><span class="symbol">&lt;&lt;</span><span class="normal"> rankB</span><span class="symbol">-</span><span class="number">1</span><span class="normal"> </span><span class="symbol">&lt;&lt;</span><span class="normal"> </span><span class="string">")"</span><span class="symbol">);</span>
<span class="normal">                </span><span class="function">assert</span><span class="symbol">(</span><span class="normal">rankB </span><span class="symbol">&gt;</span><span class="normal"> </span><span class="function">offset_type</span><span class="symbol">(</span><span class="number">0</span><span class="symbol">));</span>
<span class="normal">                lcp_base</span><span class="symbol">.</span><span class="function">push_back</span><span class="symbol">(</span><span class="number">1</span><span class="symbol">);</span>
<span class="normal">                </span><span class="function">save_rmq</span><span class="symbol">(</span><span class="normal">rankA</span><span class="symbol">,</span><span class="normal"> rankB</span><span class="symbol">);</span>
<span class="normal">            </span><span class="cbracket">}</span>
<span class="normal">        </span><span class="cbracket">}</span>

<span class="normal">        </span><span class="type">void</span><span class="normal"> </span><span class="function">calc_lcp_char2</span><span class="symbol">(</span><span class="keyword">const</span><span class="normal"> offset_type</span><span class="symbol">&amp;</span><span class="normal"> chA0</span><span class="symbol">,</span><span class="normal"> </span><span class="keyword">const</span><span class="normal"> offset_type</span><span class="symbol">&amp;</span><span class="normal"> chB0</span><span class="symbol">,</span>
<span class="normal">                            </span><span class="keyword">const</span><span class="normal"> offset_type</span><span class="symbol">&amp;</span><span class="normal"> chA1</span><span class="symbol">,</span><span class="normal"> </span><span class="keyword">const</span><span class="normal"> offset_type</span><span class="symbol">&amp;</span><span class="normal"> chB1</span><span class="symbol">,</span>
<span class="normal">                            </span><span class="keyword">const</span><span class="normal"> offset_type</span><span class="symbol">&amp;</span><span class="normal"> rankA</span><span class="symbol">,</span><span class="normal"> </span><span class="keyword">const</span><span class="normal"> offset_type</span><span class="symbol">&amp;</span><span class="normal"> rankB</span><span class="symbol">)</span>
<span class="normal">        </span><span class="cbracket">{</span>
<span class="normal">            </span><span class="keyword">if</span><span class="normal"> </span><span class="symbol">(</span><span class="normal">chA0 </span><span class="symbol">!=</span><span class="normal"> chB0</span><span class="symbol">)</span><span class="normal"> </span><span class="cbracket">{</span>
<span class="normal">                </span><span class="function">DBG</span><span class="symbol">(</span><span class="normal">debug_merge_lcp</span><span class="symbol">,</span><span class="normal"> </span><span class="string">"lcp["</span><span class="normal"> </span><span class="symbol">&lt;&lt;</span><span class="normal"> index </span><span class="symbol">&lt;&lt;</span><span class="normal"> </span><span class="string">"] = 0"</span><span class="symbol">);</span>
<span class="normal">                lcp_base</span><span class="symbol">.</span><span class="function">push_back</span><span class="symbol">(</span><span class="number">0</span><span class="symbol">);</span>
<span class="normal">            </span><span class="cbracket">}</span>
<span class="normal">            </span><span class="keyword">else</span><span class="normal"> </span><span class="keyword">if</span><span class="normal"> </span><span class="symbol">(</span><span class="normal">chA1 </span><span class="symbol">!=</span><span class="normal"> chB1</span><span class="symbol">)</span><span class="normal"> </span><span class="cbracket">{</span>
<span class="normal">                </span><span class="function">DBG</span><span class="symbol">(</span><span class="normal">debug_merge_lcp</span><span class="symbol">,</span><span class="normal"> </span><span class="string">"lcp["</span><span class="normal"> </span><span class="symbol">&lt;&lt;</span><span class="normal"> index </span><span class="symbol">&lt;&lt;</span><span class="normal"> </span><span class="string">"] = 1"</span><span class="symbol">);</span>
<span class="normal">                lcp_base</span><span class="symbol">.</span><span class="function">push_back</span><span class="symbol">(</span><span class="number">1</span><span class="symbol">);</span>
<span class="normal">            </span><span class="cbracket">}</span>
<span class="normal">            </span><span class="keyword">else</span><span class="normal"> </span><span class="cbracket">{</span>
<span class="normal">                </span><span class="function">DBG</span><span class="symbol">(</span><span class="normal">debug_merge_lcp</span><span class="symbol">,</span><span class="normal"> </span><span class="string">"lcp["</span><span class="normal"> </span><span class="symbol">&lt;&lt;</span><span class="normal"> index </span><span class="symbol">&lt;&lt;</span><span class="normal"> </span><span class="string">"] = 2 + rmq_lcp("</span><span class="normal"> </span><span class="symbol">&lt;&lt;</span><span class="normal"> rankA</span><span class="symbol">-</span><span class="number">1</span><span class="normal"> </span><span class="symbol">&lt;&lt;</span><span class="normal"> </span><span class="string">"+1,"</span><span class="normal"> </span><span class="symbol">&lt;&lt;</span><span class="normal"> rankB</span><span class="symbol">-</span><span class="number">1</span><span class="normal"> </span><span class="symbol">&lt;&lt;</span><span class="normal"> </span><span class="string">")"</span><span class="symbol">);</span>
<span class="normal">                </span><span class="function">assert</span><span class="symbol">(</span><span class="normal">rankB </span><span class="symbol">&gt;</span><span class="normal"> </span><span class="function">offset_type</span><span class="symbol">(</span><span class="number">0</span><span class="symbol">));</span>
<span class="normal">                lcp_base</span><span class="symbol">.</span><span class="function">push_back</span><span class="symbol">(</span><span class="number">2</span><span class="symbol">);</span>
<span class="normal">                </span><span class="function">save_rmq</span><span class="symbol">(</span><span class="normal">rankA</span><span class="symbol">,</span><span class="normal"> rankB</span><span class="symbol">);</span>
<span class="normal">            </span><span class="cbracket">}</span>
<span class="normal">        </span><span class="cbracket">}</span>
<span class="preproc">#endif</span><span class="normal"> </span><span class="comment">// LCP_CALC</span>

<span class="normal">    </span><span class="keyword">public</span><span class="symbol">:</span>

<span class="normal">        </span><span class="type">bool</span><span class="normal"> </span><span class="function">empty</span><span class="symbol">()</span><span class="normal"> </span><span class="keyword">const</span>
<span class="normal">        </span><span class="cbracket">{</span>
<span class="normal">            </span><span class="keyword">return</span><span class="normal"> </span><span class="symbol">(</span><span class="normal">A</span><span class="symbol">.</span><span class="function">empty</span><span class="symbol">()</span><span class="normal"> </span><span class="symbol">&amp;&amp;</span><span class="normal"> B</span><span class="symbol">.</span><span class="function">empty</span><span class="symbol">()</span><span class="normal"> </span><span class="symbol">&amp;&amp;</span><span class="normal"> C</span><span class="symbol">.</span><span class="function">empty</span><span class="symbol">());</span>
<span class="normal">        </span><span class="cbracket">}</span>

<span class="normal">        </span><span class="function">merge_sa</span><span class="symbol">(</span><span class="normal">Mod0 </span><span class="symbol">&amp;</span><span class="normal"> x1</span><span class="symbol">,</span><span class="normal"> Mod1 </span><span class="symbol">&amp;</span><span class="normal"> x2</span><span class="symbol">,</span><span class="normal"> Mod2 </span><span class="symbol">&amp;</span><span class="normal"> x3</span>
<span class="preproc">#if</span><span class="normal"> LCP_CALC</span>
<span class="normal">                 </span><span class="symbol">,</span><span class="normal"> uint8_array_type</span><span class="symbol">&amp;</span><span class="normal"> lcp_base_</span><span class="symbol">,</span><span class="normal"> RMQ</span><span class="symbol">&amp;</span><span class="normal"> lcp_rmq_</span><span class="symbol">,</span><span class="normal"> skew_pair_array_type</span><span class="symbol">&amp;</span><span class="normal"> lcp_rmq_ranks_</span>
<span class="preproc">#endif</span><span class="normal"> </span><span class="comment">// LCP_CALC</span>
<span class="normal">            </span><span class="symbol">)</span>
<span class="normal">            </span><span class="symbol">:</span><span class="normal"> </span><span class="function">A</span><span class="symbol">(</span><span class="normal">x1</span><span class="symbol">),</span><span class="normal"> </span><span class="function">B</span><span class="symbol">(</span><span class="normal">x2</span><span class="symbol">),</span><span class="normal"> </span><span class="function">C</span><span class="symbol">(</span><span class="normal">x3</span><span class="symbol">),</span><span class="normal"> </span><span class="function">selected</span><span class="symbol">(-</span><span class="number">1</span><span class="symbol">),</span><span class="normal"> </span><span class="function">index</span><span class="symbol">(</span><span class="number">0</span><span class="symbol">)</span>
<span class="preproc">#if</span><span class="normal"> LCP_CALC</span>
<span class="normal">              </span><span class="symbol">,</span><span class="normal"> </span><span class="function">lcp_base</span><span class="symbol">(</span><span class="normal">lcp_base_</span><span class="symbol">),</span><span class="normal"> </span><span class="function">lcp_rmq</span><span class="symbol">(</span><span class="normal">lcp_rmq_</span><span class="symbol">),</span><span class="normal"> </span><span class="function">lcp_rmq_ranks</span><span class="symbol">(</span><span class="normal">lcp_rmq_ranks_</span><span class="symbol">)</span>
<span class="preproc">#endif</span><span class="normal"> </span><span class="comment">// LCP_CALC</span>
<span class="normal">        </span><span class="cbracket">{</span>
<span class="normal">            </span><span class="function">assert</span><span class="symbol">(!</span><span class="normal">A</span><span class="symbol">.</span><span class="function">empty</span><span class="symbol">());</span>
<span class="normal">            </span><span class="function">assert</span><span class="symbol">(!</span><span class="normal">B</span><span class="symbol">.</span><span class="function">empty</span><span class="symbol">());</span>
<span class="normal">            </span><span class="function">assert</span><span class="symbol">(!</span><span class="normal">C</span><span class="symbol">.</span><span class="function">empty</span><span class="symbol">());</span>
<span class="normal">            exists</span><span class="symbol">[</span><span class="number">0</span><span class="symbol">]</span><span class="normal"> </span><span class="symbol">=</span><span class="normal"> </span><span class="keyword">true</span><span class="symbol">;</span>
<span class="normal">            exists</span><span class="symbol">[</span><span class="number">1</span><span class="symbol">]</span><span class="normal"> </span><span class="symbol">=</span><span class="normal"> </span><span class="keyword">true</span><span class="symbol">;</span>
<span class="normal">            exists</span><span class="symbol">[</span><span class="number">2</span><span class="symbol">]</span><span class="normal"> </span><span class="symbol">=</span><span class="normal"> </span><span class="keyword">true</span><span class="symbol">;</span>
<span class="normal">            s0 </span><span class="symbol">=</span><span class="normal"> </span><span class="symbol">*</span><span class="normal">A</span><span class="symbol">;</span>
<span class="normal">            s1 </span><span class="symbol">=</span><span class="normal"> </span><span class="symbol">*</span><span class="normal">B</span><span class="symbol">;</span>
<span class="normal">            s2 </span><span class="symbol">=</span><span class="normal"> </span><span class="symbol">*</span><span class="normal">C</span><span class="symbol">;</span>

<span class="normal">            </span><span class="function">solve</span><span class="symbol">();</span>
<span class="normal">        </span><span class="cbracket">}</span>

<span class="normal">        </span><span class="keyword">const</span><span class="normal"> value_type </span><span class="symbol">&amp;</span><span class="normal"> </span><span class="keyword">operator</span><span class="symbol">*</span><span class="normal"> </span><span class="symbol">()</span><span class="normal"> </span><span class="keyword">const</span>
<span class="normal">        </span><span class="cbracket">{</span>
<span class="normal">            </span><span class="keyword">return</span><span class="normal"> merge_result</span><span class="symbol">;</span>
<span class="normal">        </span><span class="cbracket">}</span>

<span class="normal">        merge_sa </span><span class="symbol">&amp;</span><span class="normal"> </span><span class="keyword">operator</span><span class="symbol">++</span><span class="normal"> </span><span class="symbol">()</span>
<span class="normal">        </span><span class="cbracket">{</span>
<span class="normal">            </span><span class="keyword">if</span><span class="normal"> </span><span class="symbol">(</span><span class="normal">selected </span><span class="symbol">==</span><span class="normal"> </span><span class="number">0</span><span class="symbol">)</span><span class="normal"> </span><span class="cbracket">{</span>
<span class="normal">                </span><span class="function">assert</span><span class="symbol">(!</span><span class="normal">A</span><span class="symbol">.</span><span class="function">empty</span><span class="symbol">());</span>
<span class="normal">                </span><span class="symbol">++</span><span class="normal">A</span><span class="symbol">;</span>
<span class="normal">                </span><span class="keyword">if</span><span class="normal"> </span><span class="symbol">(!</span><span class="normal">A</span><span class="symbol">.</span><span class="function">empty</span><span class="symbol">())</span>
<span class="normal">                    s0 </span><span class="symbol">=</span><span class="normal"> </span><span class="symbol">*</span><span class="normal">A</span><span class="symbol">;</span>
<span class="normal">                </span><span class="keyword">else</span>
<span class="normal">                    exists</span><span class="symbol">[</span><span class="number">0</span><span class="symbol">]</span><span class="normal"> </span><span class="symbol">=</span><span class="normal"> </span><span class="keyword">false</span><span class="symbol">;</span>
<span class="normal">            </span><span class="cbracket">}</span>
<span class="normal">            </span><span class="keyword">else</span><span class="normal"> </span><span class="keyword">if</span><span class="normal"> </span><span class="symbol">(</span><span class="normal">selected </span><span class="symbol">==</span><span class="normal"> </span><span class="number">1</span><span class="symbol">)</span><span class="normal"> </span><span class="cbracket">{</span>
<span class="normal">                </span><span class="function">assert</span><span class="symbol">(!</span><span class="normal">B</span><span class="symbol">.</span><span class="function">empty</span><span class="symbol">());</span>
<span class="normal">                </span><span class="symbol">++</span><span class="normal">B</span><span class="symbol">;</span>
<span class="normal">                </span><span class="keyword">if</span><span class="normal"> </span><span class="symbol">(!</span><span class="normal">B</span><span class="symbol">.</span><span class="function">empty</span><span class="symbol">())</span>
<span class="normal">                    s1 </span><span class="symbol">=</span><span class="normal"> </span><span class="symbol">*</span><span class="normal">B</span><span class="symbol">;</span>
<span class="normal">                </span><span class="keyword">else</span>
<span class="normal">                    exists</span><span class="symbol">[</span><span class="number">1</span><span class="symbol">]</span><span class="normal"> </span><span class="symbol">=</span><span class="normal"> </span><span class="keyword">false</span><span class="symbol">;</span>
<span class="normal">            </span><span class="cbracket">}</span>
<span class="normal">            </span><span class="keyword">else</span><span class="normal"> </span><span class="cbracket">{</span>
<span class="normal">                </span><span class="function">assert</span><span class="symbol">(!</span><span class="normal">C</span><span class="symbol">.</span><span class="function">empty</span><span class="symbol">());</span>
<span class="normal">                </span><span class="function">assert</span><span class="symbol">(</span><span class="normal">selected </span><span class="symbol">==</span><span class="normal"> </span><span class="number">2</span><span class="symbol">);</span>
<span class="normal">                </span><span class="symbol">++</span><span class="normal">C</span><span class="symbol">;</span>
<span class="normal">                </span><span class="keyword">if</span><span class="normal"> </span><span class="symbol">(!</span><span class="normal">C</span><span class="symbol">.</span><span class="function">empty</span><span class="symbol">())</span>
<span class="normal">                    s2 </span><span class="symbol">=</span><span class="normal"> </span><span class="symbol">*</span><span class="normal">C</span><span class="symbol">;</span>
<span class="normal">                </span><span class="keyword">else</span>
<span class="normal">                    exists</span><span class="symbol">[</span><span class="number">2</span><span class="symbol">]</span><span class="normal"> </span><span class="symbol">=</span><span class="normal"> </span><span class="keyword">false</span><span class="symbol">;</span>
<span class="normal">            </span><span class="cbracket">}</span>

<span class="normal">            </span><span class="symbol">++</span><span class="normal">index</span><span class="symbol">;</span>
<span class="normal">            </span><span class="keyword">if</span><span class="normal"> </span><span class="symbol">(!</span><span class="function">empty</span><span class="symbol">())</span><span class="normal"> </span><span class="function">solve</span><span class="symbol">();</span>

<span class="normal">            </span><span class="keyword">return</span><span class="normal"> </span><span class="symbol">*</span><span class="keyword">this</span><span class="symbol">;</span>
<span class="normal">        </span><span class="cbracket">}</span>
<span class="normal">    </span><span class="cbracket">}</span><span class="symbol">;</span>

<span class="normal">    </span><span class="comment">/**</span>
<span class="comment">     * Helper function for computing the size of the 2/3 subproblem</span>
<span class="comment">     */</span>
<span class="normal">    </span><span class="keyword">static</span><span class="normal"> </span><span class="keyword">inline</span><span class="normal"> </span><span class="usertype">size_t</span><span class="normal"> </span><span class="function">subp_size</span><span class="symbol">(</span><span class="usertype">size_t</span><span class="normal"> n</span><span class="symbol">)</span>
<span class="normal">    </span><span class="cbracket">{</span>
<span class="normal">        </span><span class="keyword">return</span><span class="normal"> </span><span class="symbol">(</span><span class="normal">n </span><span class="symbol">/</span><span class="normal"> </span><span class="number">3</span><span class="symbol">)</span><span class="normal"> </span><span class="symbol">*</span><span class="normal"> </span><span class="number">2</span><span class="normal"> </span><span class="symbol">+</span><span class="normal"> </span><span class="symbol">((</span><span class="normal">n </span><span class="symbol">%</span><span class="normal"> </span><span class="number">3</span><span class="symbol">)</span><span class="normal"> </span><span class="symbol">==</span><span class="normal"> </span><span class="number">2</span><span class="symbol">);</span>
<span class="normal">    </span><span class="cbracket">}</span>

<span class="normal">    </span><span class="comment">/***********************************************************************************************</span>
<span class="comment">     * A skew algorithm specific namespace.                                                        *</span>
<span class="comment">     ***********************************************************************************************/</span>

<span class="normal">    </span><span class="comment">/**</span>
<span class="comment">     * The merging step of the skew algorithm.</span>
<span class="comment">     * </span><span class="type">@param</span><span class="comment"> S input string pipe type.</span>
<span class="comment">     * </span><span class="type">@param</span><span class="comment"> Mod1 mod1 tuples input pipe type.</span>
<span class="comment">     * </span><span class="type">@param</span><span class="comment"> Mod2 mod2 tuples input pipe type.</span>
<span class="comment">     * </span><span class="type">@param</span><span class="comment"> block_size block size of the used sorter.</span>
<span class="comment">     * </span><span class="type">@param</span><span class="comment"> memsize memory requirement of one sorter.</span>
<span class="comment">     */</span>
<span class="normal">    </span><span class="keyword">template</span><span class="normal"> </span><span class="symbol">&lt;</span><span class="keyword">class</span><span class="normal"> </span><span class="classname">S</span><span class="symbol">,</span><span class="normal"> </span><span class="keyword">class</span><span class="normal"> </span><span class="classname">Mod1</span><span class="symbol">,</span><span class="normal"> </span><span class="keyword">class</span><span class="normal"> </span><span class="classname">Mod2</span><span class="symbol">,</span>
<span class="normal">              </span><span class="keyword">const</span><span class="normal"> </span><span class="type">int</span><span class="normal"> block_size</span><span class="symbol">,</span><span class="normal"> </span><span class="keyword">const</span><span class="normal"> </span><span class="usertype">size_t</span><span class="normal"> memsize</span><span class="symbol">&gt;</span>
<span class="normal">    </span><span class="keyword">class</span><span class="normal"> </span><span class="classname">build_sa</span>
<span class="normal">    </span><span class="cbracket">{</span>
<span class="normal">    </span><span class="keyword">public</span><span class="symbol">:</span>
<span class="normal">        </span><span class="keyword">typedef</span><span class="normal"> </span><span class="usertype">offset_type</span><span class="normal"> value_type</span><span class="symbol">;</span>

<span class="normal">        </span><span class="keyword">static</span><span class="normal"> </span><span class="keyword">const</span><span class="normal"> </span><span class="usertype">size_t</span><span class="normal"> add_rank </span><span class="symbol">=</span><span class="normal"> </span><span class="number">1</span><span class="symbol">;</span><span class="normal">  </span><span class="comment">// free first rank to mark ranks beyond end of input</span>

<span class="normal">    </span><span class="keyword">private</span><span class="symbol">:</span>

<span class="normal">        </span><span class="comment">// Mod1 types</span>

<span class="normal">        </span><span class="keyword">typedef</span><span class="normal"> </span><span class="keyword">typename</span><span class="normal"> </span><span class="classname">stream</span><span class="symbol">::</span><span class="normal">use_push </span><span class="symbol">&lt;</span><span class="normal"> skew_quad_type </span><span class="symbol">&gt;</span><span class="normal"> mod1_push_type</span><span class="symbol">;</span>
<span class="normal">        </span><span class="keyword">typedef</span><span class="normal"> </span><span class="keyword">typename</span><span class="normal"> </span><span class="classname">stream</span><span class="symbol">::</span><span class="normal">runs_creator </span><span class="symbol">&lt;</span><span class="normal"> mod1_push_type</span><span class="symbol">,</span><span class="normal"> less_quad_2nd</span><span class="symbol">,</span><span class="normal"> block_size</span><span class="symbol">,</span><span class="normal"> RC </span><span class="symbol">&gt;</span><span class="normal"> mod1_runs_type</span><span class="symbol">;</span>
<span class="normal">        </span><span class="keyword">typedef</span><span class="normal"> </span><span class="keyword">typename</span><span class="normal"> </span><span class="classname">mod1_runs_type</span><span class="symbol">::</span><span class="usertype">sorted_runs_type</span><span class="normal"> sorted_mod1_runs_type</span><span class="symbol">;</span>
<span class="normal">        </span><span class="keyword">typedef</span><span class="normal"> </span><span class="keyword">typename</span><span class="normal"> </span><span class="classname">stream</span><span class="symbol">::</span><span class="normal">runs_merger </span><span class="symbol">&lt;</span><span class="normal"> sorted_mod1_runs_type</span><span class="symbol">,</span><span class="normal"> less_quad_2nd </span><span class="symbol">&gt;</span><span class="normal"> mod1_rm_type</span><span class="symbol">;</span>

<span class="normal">        </span><span class="comment">// Mod2 types</span>

<span class="normal">        </span><span class="keyword">typedef</span><span class="normal"> </span><span class="keyword">typename</span><span class="normal"> </span><span class="classname">stream</span><span class="symbol">::</span><span class="normal">use_push </span><span class="symbol">&lt;</span><span class="normal"> skew_quint_type </span><span class="symbol">&gt;</span><span class="normal"> mod2_push_type</span><span class="symbol">;</span>
<span class="normal">        </span><span class="keyword">typedef</span><span class="normal"> </span><span class="keyword">typename</span><span class="normal"> </span><span class="classname">stream</span><span class="symbol">::</span><span class="normal">runs_creator </span><span class="symbol">&lt;</span><span class="normal"> mod2_push_type</span><span class="symbol">,</span><span class="normal"> less_quint_2nd</span><span class="symbol">,</span><span class="normal"> block_size</span><span class="symbol">,</span><span class="normal"> RC </span><span class="symbol">&gt;</span><span class="normal"> mod2_runs_type</span><span class="symbol">;</span>
<span class="normal">        </span><span class="keyword">typedef</span><span class="normal"> </span><span class="keyword">typename</span><span class="normal"> </span><span class="classname">mod2_runs_type</span><span class="symbol">::</span><span class="usertype">sorted_runs_type</span><span class="normal"> sorted_mod2_runs_type</span><span class="symbol">;</span>
<span class="normal">        </span><span class="keyword">typedef</span><span class="normal"> </span><span class="keyword">typename</span><span class="normal"> </span><span class="classname">stream</span><span class="symbol">::</span><span class="normal">runs_merger </span><span class="symbol">&lt;</span><span class="normal"> sorted_mod2_runs_type</span><span class="symbol">,</span><span class="normal"> less_quint_2nd </span><span class="symbol">&gt;</span><span class="normal"> mod2_rm_type</span><span class="symbol">;</span>

<span class="normal">        </span><span class="comment">// Mod0 types</span>

<span class="normal">        </span><span class="keyword">typedef</span><span class="normal"> </span><span class="keyword">typename</span><span class="normal"> </span><span class="classname">stream</span><span class="symbol">::</span><span class="normal">use_push </span><span class="symbol">&lt;</span><span class="normal"> skew_quint_type </span><span class="symbol">&gt;</span><span class="normal"> mod0_push_type</span><span class="symbol">;</span>
<span class="normal">        </span><span class="keyword">typedef</span><span class="normal"> </span><span class="keyword">typename</span><span class="normal"> </span><span class="classname">stream</span><span class="symbol">::</span><span class="normal">runs_creator </span><span class="symbol">&lt;</span><span class="normal"> mod0_push_type</span><span class="symbol">,</span><span class="normal"> less_mod0</span><span class="symbol">,</span><span class="normal"> block_size</span><span class="symbol">,</span><span class="normal"> RC </span><span class="symbol">&gt;</span><span class="normal"> mod0_runs_type</span><span class="symbol">;</span>
<span class="normal">        </span><span class="keyword">typedef</span><span class="normal"> </span><span class="keyword">typename</span><span class="normal"> </span><span class="classname">mod0_runs_type</span><span class="symbol">::</span><span class="usertype">sorted_runs_type</span><span class="normal"> sorted_mod0_runs_type</span><span class="symbol">;</span>
<span class="normal">        </span><span class="keyword">typedef</span><span class="normal"> </span><span class="keyword">typename</span><span class="normal"> </span><span class="classname">stream</span><span class="symbol">::</span><span class="normal">runs_merger </span><span class="symbol">&lt;</span><span class="normal"> sorted_mod0_runs_type</span><span class="symbol">,</span><span class="normal"> less_mod0 </span><span class="symbol">&gt;</span><span class="normal"> mod0_rm_type</span><span class="symbol">;</span>

<span class="normal">        </span><span class="comment">// Merge type</span>

<span class="normal">        </span><span class="keyword">typedef</span><span class="normal"> merge_sa </span><span class="symbol">&lt;</span><span class="normal"> mod0_rm_type</span><span class="symbol">,</span><span class="normal"> mod1_rm_type</span><span class="symbol">,</span><span class="normal"> mod2_rm_type </span><span class="symbol">&gt;</span><span class="normal"> merge_sa_type</span><span class="symbol">;</span>

<span class="normal">        </span><span class="comment">// Functions</span>

<span class="normal">        </span><span class="usertype">less_mod0</span><span class="normal"> c0</span><span class="symbol">;</span>
<span class="normal">        </span><span class="usertype">less_quad_2nd</span><span class="normal"> c1</span><span class="symbol">;</span>
<span class="normal">        </span><span class="usertype">less_quint_2nd</span><span class="normal"> c2</span><span class="symbol">;</span>

<span class="normal">        </span><span class="comment">// Runs merger</span>

<span class="normal">        </span><span class="usertype">mod1_rm_type</span><span class="normal"> </span><span class="symbol">*</span><span class="normal">mod1_result</span><span class="symbol">;</span>
<span class="normal">        </span><span class="usertype">mod2_rm_type</span><span class="normal"> </span><span class="symbol">*</span><span class="normal">mod2_result</span><span class="symbol">;</span>
<span class="normal">        </span><span class="usertype">mod0_rm_type</span><span class="normal"> </span><span class="symbol">*</span><span class="normal">mod0_result</span><span class="symbol">;</span>

<span class="normal">        </span><span class="comment">// Merger</span>

<span class="normal">        </span><span class="usertype">merge_sa_type</span><span class="normal"> </span><span class="symbol">*</span><span class="normal">vmerge_sa</span><span class="symbol">;</span>

<span class="normal">        </span><span class="comment">// Input</span>

<span class="normal">        S </span><span class="symbol">&amp;</span><span class="normal"> source</span><span class="symbol">;</span>
<span class="normal">        Mod1 </span><span class="symbol">&amp;</span><span class="normal"> mod_1</span><span class="symbol">;</span>
<span class="normal">        Mod2 </span><span class="symbol">&amp;</span><span class="normal"> mod_2</span><span class="symbol">;</span>

<span class="normal">        </span><span class="comment">// Tmp variables</span>

<span class="normal">        </span><span class="usertype">offset_type</span><span class="normal"> t</span><span class="symbol">[</span><span class="number">3</span><span class="symbol">];</span>
<span class="normal">        </span><span class="usertype">offset_type</span><span class="normal"> old_t2</span><span class="symbol">;</span>
<span class="normal">        </span><span class="usertype">offset_type</span><span class="normal"> old_mod2</span><span class="symbol">;</span>
<span class="normal">        </span><span class="type">bool</span><span class="normal"> exists</span><span class="symbol">[</span><span class="number">3</span><span class="symbol">];</span>
<span class="normal">        </span><span class="usertype">offset_type</span><span class="normal"> mod_one</span><span class="symbol">;</span>
<span class="normal">        </span><span class="usertype">offset_type</span><span class="normal"> mod_two</span><span class="symbol">;</span>

<span class="normal">        </span><span class="usertype">size_t</span><span class="normal">  index</span><span class="symbol">;</span>

<span class="normal">        </span><span class="comment">// Empty_flag</span>

<span class="normal">        </span><span class="type">bool</span><span class="normal"> ready</span><span class="symbol">;</span>

<span class="normal">        </span><span class="comment">// Result</span>

<span class="normal">        </span><span class="usertype">value_type</span><span class="normal"> result</span><span class="symbol">;</span>

<span class="normal">    </span><span class="keyword">public</span><span class="symbol">:</span>

<span class="normal">        </span><span class="function">build_sa</span><span class="symbol">(</span><span class="normal">S </span><span class="symbol">&amp;</span><span class="normal"> source_</span><span class="symbol">,</span><span class="normal"> Mod1 </span><span class="symbol">&amp;</span><span class="normal"> mod_1_</span><span class="symbol">,</span><span class="normal"> Mod2 </span><span class="symbol">&amp;</span><span class="normal"> mod_2_</span><span class="symbol">,</span><span class="normal"> </span><span class="usertype">size_t</span><span class="normal"> a_size</span>
<span class="preproc">#if</span><span class="normal"> LCP_CALC</span>
<span class="normal">                 </span><span class="symbol">,</span><span class="normal"> uint8_array_type</span><span class="symbol">&amp;</span><span class="normal"> lcp_base</span><span class="symbol">,</span><span class="normal"> RMQ</span><span class="symbol">&amp;</span><span class="normal"> lcp_rmq1</span><span class="symbol">,</span><span class="normal"> skew_pair_array_type</span><span class="symbol">&amp;</span><span class="normal"> lcp_rmq1_ranks</span>
<span class="preproc">#endif</span><span class="normal"> </span><span class="comment">// LCP_CALC</span>
<span class="normal">            </span><span class="symbol">)</span>
<span class="normal">            </span><span class="symbol">:</span><span class="normal"> </span><span class="function">source</span><span class="symbol">(</span><span class="normal">source_</span><span class="symbol">),</span><span class="normal"> </span><span class="function">mod_1</span><span class="symbol">(</span><span class="normal">mod_1_</span><span class="symbol">),</span><span class="normal"> </span><span class="function">mod_2</span><span class="symbol">(</span><span class="normal">mod_2_</span><span class="symbol">),</span><span class="normal"> </span><span class="function">index</span><span class="symbol">(</span><span class="number">0</span><span class="symbol">),</span><span class="normal"> </span><span class="function">ready</span><span class="symbol">(</span><span class="keyword">false</span><span class="symbol">)</span>
<span class="normal">        </span><span class="cbracket">{</span>
<span class="normal">            </span><span class="function">assert</span><span class="symbol">(!</span><span class="normal">source_</span><span class="symbol">.</span><span class="function">empty</span><span class="symbol">());</span>

<span class="normal">            </span><span class="comment">// Runs storage</span>

<span class="normal">            </span><span class="function">DBGMEM</span><span class="symbol">(</span><span class="string">"creating mod0,1,2"</span><span class="symbol">);</span>

<span class="normal">            </span><span class="comment">// input: ISA_1,2 from previous level</span>
<span class="normal">            </span><span class="usertype">mod0_runs_type</span><span class="normal"> </span><span class="function">mod0_runs</span><span class="symbol">(</span><span class="normal">c0</span><span class="symbol">,</span><span class="normal"> memsize </span><span class="symbol">/</span><span class="normal"> </span><span class="number">3</span><span class="symbol">);</span>
<span class="normal">            </span><span class="usertype">mod1_runs_type</span><span class="normal"> </span><span class="function">mod1_runs</span><span class="symbol">(</span><span class="normal">c1</span><span class="symbol">,</span><span class="normal"> memsize </span><span class="symbol">/</span><span class="normal"> </span><span class="number">3</span><span class="symbol">);</span>
<span class="normal">            </span><span class="usertype">mod2_runs_type</span><span class="normal"> </span><span class="function">mod2_runs</span><span class="symbol">(</span><span class="normal">c2</span><span class="symbol">,</span><span class="normal"> memsize </span><span class="symbol">/</span><span class="normal"> </span><span class="number">3</span><span class="symbol">);</span>

<span class="normal">            </span><span class="keyword">while</span><span class="normal"> </span><span class="symbol">(!</span><span class="normal">source</span><span class="symbol">.</span><span class="function">empty</span><span class="symbol">())</span>
<span class="normal">            </span><span class="cbracket">{</span>
<span class="normal">                exists</span><span class="symbol">[</span><span class="number">0</span><span class="symbol">]</span><span class="normal"> </span><span class="symbol">=</span><span class="normal"> </span><span class="keyword">false</span><span class="symbol">;</span>
<span class="normal">                exists</span><span class="symbol">[</span><span class="number">1</span><span class="symbol">]</span><span class="normal"> </span><span class="symbol">=</span><span class="normal"> </span><span class="keyword">false</span><span class="symbol">;</span>
<span class="normal">                exists</span><span class="symbol">[</span><span class="number">2</span><span class="symbol">]</span><span class="normal"> </span><span class="symbol">=</span><span class="normal"> </span><span class="keyword">false</span><span class="symbol">;</span>

<span class="normal">                </span><span class="keyword">if</span><span class="normal"> </span><span class="symbol">(!</span><span class="normal">source</span><span class="symbol">.</span><span class="function">empty</span><span class="symbol">())</span><span class="normal"> </span><span class="cbracket">{</span>
<span class="normal">                    t</span><span class="symbol">[</span><span class="number">0</span><span class="symbol">]</span><span class="normal"> </span><span class="symbol">=</span><span class="normal"> </span><span class="symbol">*</span><span class="normal">source</span><span class="symbol">;</span>
<span class="normal">                    </span><span class="symbol">++</span><span class="normal">source</span><span class="symbol">;</span>
<span class="normal">                    exists</span><span class="symbol">[</span><span class="number">0</span><span class="symbol">]</span><span class="normal"> </span><span class="symbol">=</span><span class="normal"> </span><span class="keyword">true</span><span class="symbol">;</span>
<span class="normal">                </span><span class="cbracket">}</span>

<span class="normal">                </span><span class="keyword">if</span><span class="normal"> </span><span class="symbol">(!</span><span class="normal">source</span><span class="symbol">.</span><span class="function">empty</span><span class="symbol">())</span><span class="normal"> </span><span class="cbracket">{</span>
<span class="normal">                    </span><span class="function">assert</span><span class="symbol">(!</span><span class="normal">mod_1</span><span class="symbol">.</span><span class="function">empty</span><span class="symbol">());</span>
<span class="normal">                    t</span><span class="symbol">[</span><span class="number">1</span><span class="symbol">]</span><span class="normal"> </span><span class="symbol">=</span><span class="normal"> </span><span class="symbol">*</span><span class="normal">source</span><span class="symbol">;</span>
<span class="normal">                    </span><span class="symbol">++</span><span class="normal">source</span><span class="symbol">;</span>
<span class="normal">                    mod_one </span><span class="symbol">=</span><span class="normal"> </span><span class="symbol">*</span><span class="normal">mod_1 </span><span class="symbol">+</span><span class="normal"> add_rank</span><span class="symbol">;</span>
<span class="normal">                    </span><span class="symbol">++</span><span class="normal">mod_1</span><span class="symbol">;</span>
<span class="normal">                    exists</span><span class="symbol">[</span><span class="number">1</span><span class="symbol">]</span><span class="normal"> </span><span class="symbol">=</span><span class="normal"> </span><span class="keyword">true</span><span class="symbol">;</span>
<span class="normal">                </span><span class="cbracket">}</span>

<span class="normal">                </span><span class="keyword">if</span><span class="normal"> </span><span class="symbol">(!</span><span class="normal">source</span><span class="symbol">.</span><span class="function">empty</span><span class="symbol">())</span><span class="normal"> </span><span class="cbracket">{</span>
<span class="normal">                    </span><span class="function">assert</span><span class="symbol">(!</span><span class="normal">mod_2</span><span class="symbol">.</span><span class="function">empty</span><span class="symbol">());</span>
<span class="normal">                    t</span><span class="symbol">[</span><span class="number">2</span><span class="symbol">]</span><span class="normal"> </span><span class="symbol">=</span><span class="normal"> </span><span class="symbol">*</span><span class="normal">source</span><span class="symbol">;</span>
<span class="normal">                    </span><span class="symbol">++</span><span class="normal">source</span><span class="symbol">;</span>
<span class="normal">                    mod_two </span><span class="symbol">=</span><span class="normal"> </span><span class="symbol">*</span><span class="normal">mod_2 </span><span class="symbol">+</span><span class="normal"> add_rank</span><span class="symbol">;</span>
<span class="normal">                    </span><span class="symbol">++</span><span class="normal">mod_2</span><span class="symbol">;</span>
<span class="normal">                    exists</span><span class="symbol">[</span><span class="number">2</span><span class="symbol">]</span><span class="normal"> </span><span class="symbol">=</span><span class="normal"> </span><span class="keyword">true</span><span class="symbol">;</span>
<span class="normal">                </span><span class="cbracket">}</span>

<span class="normal">                </span><span class="comment">// Check special cases in the middle of "source"</span>
<span class="normal">                </span><span class="comment">// Cases are cx|xc cxx|cxx and cxxc|xxc</span>

<span class="normal">                </span><span class="function">assert</span><span class="symbol">(</span><span class="normal">t</span><span class="symbol">[</span><span class="number">0</span><span class="symbol">]</span><span class="normal"> </span><span class="symbol">!=</span><span class="normal"> </span><span class="function">offset_type</span><span class="symbol">(</span><span class="number">0</span><span class="symbol">));</span>
<span class="normal">                </span><span class="function">assert</span><span class="symbol">(</span><span class="normal">t</span><span class="symbol">[</span><span class="number">1</span><span class="symbol">]</span><span class="normal"> </span><span class="symbol">!=</span><span class="normal"> </span><span class="function">offset_type</span><span class="symbol">(</span><span class="number">0</span><span class="symbol">));</span>
<span class="normal">                </span><span class="function">assert</span><span class="symbol">(</span><span class="normal">t</span><span class="symbol">[</span><span class="number">2</span><span class="symbol">]</span><span class="normal"> </span><span class="symbol">!=</span><span class="normal"> </span><span class="function">offset_type</span><span class="symbol">(</span><span class="number">0</span><span class="symbol">));</span>

<span class="normal">                </span><span class="comment">// Mod 0 : (index0,char0,char1,mod1,mod2)</span>
<span class="normal">                </span><span class="comment">// Mod 1 : (index1,mod1,char1,mod2)</span>
<span class="normal">                </span><span class="comment">// Mod 2 : (index2,mod2)</span>

<span class="normal">                </span><span class="keyword">if</span><span class="normal"> </span><span class="symbol">(</span><span class="normal">exists</span><span class="symbol">[</span><span class="number">2</span><span class="symbol">])</span><span class="normal"> </span><span class="cbracket">{</span><span class="normal">	</span><span class="comment">// Nothing is missed</span>
<span class="normal">                    </span><span class="function">DBG</span><span class="symbol">(</span><span class="normal">debug_mcreate</span><span class="symbol">,</span><span class="normal"> </span><span class="string">"nomiss"</span><span class="symbol">);</span>
<span class="normal">                    </span><span class="function">DBG</span><span class="symbol">(</span><span class="normal">debug_mcreate</span><span class="symbol">,</span><span class="normal"> </span><span class="string">"Mod0 : ("</span><span class="normal"> </span><span class="symbol">&lt;&lt;</span><span class="normal"> index </span><span class="symbol">&lt;&lt;</span><span class="normal"> </span><span class="string">"|"</span><span class="normal"> </span><span class="symbol">&lt;&lt;</span><span class="normal"> t</span><span class="symbol">[</span><span class="number">0</span><span class="symbol">]</span><span class="normal"> </span><span class="symbol">&lt;&lt;</span><span class="normal"> </span><span class="string">","</span><span class="normal"> </span><span class="symbol">&lt;&lt;</span><span class="normal"> t</span><span class="symbol">[</span><span class="number">1</span><span class="symbol">]</span><span class="normal"> </span><span class="symbol">&lt;&lt;</span><span class="normal"> </span><span class="string">" - "</span><span class="normal"> </span><span class="symbol">&lt;&lt;</span><span class="normal"> mod_one </span><span class="symbol">&lt;&lt;</span><span class="normal"> </span><span class="string">","</span><span class="normal"> </span><span class="symbol">&lt;&lt;</span><span class="normal"> mod_two </span><span class="symbol">&lt;&lt;</span><span class="normal"> </span><span class="string">")"</span><span class="symbol">);</span>
<span class="normal">                    </span><span class="function">DBG</span><span class="symbol">(</span><span class="normal">debug_mcreate</span><span class="symbol">,</span><span class="normal"> </span><span class="string">"Mod1 : ("</span><span class="normal"> </span><span class="symbol">&lt;&lt;</span><span class="normal"> </span><span class="symbol">(</span><span class="normal">index </span><span class="symbol">+</span><span class="normal"> </span><span class="number">1</span><span class="symbol">)</span><span class="normal"> </span><span class="symbol">&lt;&lt;</span><span class="normal"> </span><span class="string">"|"</span><span class="normal"> </span><span class="symbol">&lt;&lt;</span><span class="normal"> t</span><span class="symbol">[</span><span class="number">1</span><span class="symbol">]</span><span class="normal"> </span><span class="symbol">&lt;&lt;</span><span class="normal"> </span><span class="string">" - "</span><span class="normal"> </span><span class="symbol">&lt;&lt;</span><span class="normal"> mod_one </span><span class="symbol">&lt;&lt;</span><span class="normal"> </span><span class="string">","</span><span class="normal"> </span><span class="symbol">&lt;&lt;</span><span class="normal"> mod_two </span><span class="symbol">&lt;&lt;</span><span class="normal"> </span><span class="string">")"</span><span class="symbol">);</span>

<span class="normal">                    mod0_runs</span><span class="symbol">.</span><span class="function">push</span><span class="symbol">(</span><span class="function">skew_quint_type</span><span class="symbol">(</span><span class="normal">index</span><span class="symbol">,</span><span class="normal"> t</span><span class="symbol">[</span><span class="number">0</span><span class="symbol">],</span><span class="normal"> t</span><span class="symbol">[</span><span class="number">1</span><span class="symbol">],</span><span class="normal"> mod_one</span><span class="symbol">,</span><span class="normal"> mod_two</span><span class="symbol">));</span>
<span class="normal">                    mod1_runs</span><span class="symbol">.</span><span class="function">push</span><span class="symbol">(</span><span class="function">skew_quad_type</span><span class="symbol">(</span><span class="normal">index </span><span class="symbol">+</span><span class="normal"> </span><span class="number">1</span><span class="symbol">,</span><span class="normal"> mod_one</span><span class="symbol">,</span><span class="normal"> t</span><span class="symbol">[</span><span class="number">1</span><span class="symbol">],</span><span class="normal"> mod_two</span><span class="symbol">));</span>

<span class="normal">                    </span><span class="keyword">if</span><span class="normal"> </span><span class="symbol">(</span><span class="normal">index </span><span class="symbol">!=</span><span class="normal"> </span><span class="function">offset_type</span><span class="symbol">(</span><span class="number">0</span><span class="symbol">))</span><span class="normal"> </span><span class="cbracket">{</span>
<span class="normal">                        </span><span class="function">DBG</span><span class="symbol">(</span><span class="normal">debug_mcreate</span><span class="symbol">,</span><span class="normal"> </span><span class="string">"Mod2 : ("</span><span class="normal"> </span><span class="symbol">&lt;&lt;</span><span class="normal"> </span><span class="symbol">(</span><span class="normal">index </span><span class="symbol">-</span><span class="normal"> </span><span class="number">1</span><span class="symbol">)</span><span class="normal"> </span><span class="symbol">&lt;&lt;</span><span class="normal"> </span><span class="string">"|"</span><span class="normal"> </span><span class="symbol">&lt;&lt;</span><span class="normal"> old_t2 </span><span class="symbol">&lt;&lt;</span><span class="normal"> </span><span class="string">","</span><span class="normal"> </span><span class="symbol">&lt;&lt;</span><span class="normal"> t</span><span class="symbol">[</span><span class="number">0</span><span class="symbol">]</span><span class="normal"> </span><span class="symbol">&lt;&lt;</span><span class="normal"> </span><span class="string">" - "</span><span class="normal"> </span><span class="symbol">&lt;&lt;</span><span class="normal"> old_mod2 </span><span class="symbol">&lt;&lt;</span><span class="normal"> </span><span class="string">","</span><span class="normal"> </span><span class="symbol">&lt;&lt;</span><span class="normal"> mod_one </span><span class="symbol">&lt;&lt;</span><span class="normal"> </span><span class="string">")"</span><span class="symbol">);</span>
<span class="normal">                        mod2_runs</span><span class="symbol">.</span><span class="function">push</span><span class="symbol">(</span><span class="function">skew_quint_type</span><span class="symbol">((</span><span class="normal">index </span><span class="symbol">-</span><span class="normal"> </span><span class="number">1</span><span class="symbol">),</span><span class="normal"> old_mod2</span><span class="symbol">,</span><span class="normal"> old_t2</span><span class="symbol">,</span><span class="normal"> t</span><span class="symbol">[</span><span class="number">0</span><span class="symbol">],</span><span class="normal"> mod_one</span><span class="symbol">));</span>
<span class="normal">                    </span><span class="cbracket">}</span>
<span class="normal">                </span><span class="cbracket">}</span>
<span class="normal">                </span><span class="keyword">else</span><span class="normal"> </span><span class="keyword">if</span><span class="normal"> </span><span class="symbol">(</span><span class="normal">exists</span><span class="symbol">[</span><span class="number">1</span><span class="symbol">])</span><span class="normal"> </span><span class="cbracket">{</span><span class="normal">	</span><span class="comment">// Last element missed</span>
<span class="normal">                    </span><span class="function">DBG</span><span class="symbol">(</span><span class="normal">debug_mcreate</span><span class="symbol">,</span><span class="normal"> </span><span class="string">"nolast"</span><span class="symbol">);</span>
<span class="normal">                    </span><span class="function">DBG</span><span class="symbol">(</span><span class="normal">debug_mcreate</span><span class="symbol">,</span><span class="normal"> </span><span class="string">"Mod0 : ("</span><span class="normal"> </span><span class="symbol">&lt;&lt;</span><span class="normal"> index </span><span class="symbol">&lt;&lt;</span><span class="normal"> </span><span class="string">"|"</span><span class="normal"> </span><span class="symbol">&lt;&lt;</span><span class="normal"> t</span><span class="symbol">[</span><span class="number">0</span><span class="symbol">]</span><span class="normal"> </span><span class="symbol">&lt;&lt;</span><span class="normal"> </span><span class="string">","</span><span class="normal"> </span><span class="symbol">&lt;&lt;</span><span class="normal"> t</span><span class="symbol">[</span><span class="number">1</span><span class="symbol">]</span><span class="normal"> </span><span class="symbol">&lt;&lt;</span><span class="normal"> </span><span class="string">" - "</span><span class="normal"> </span><span class="symbol">&lt;&lt;</span><span class="normal"> mod_one </span><span class="symbol">&lt;&lt;</span><span class="normal"> </span><span class="string">","</span><span class="normal"> </span><span class="symbol">&lt;&lt;</span><span class="normal"> </span><span class="number">0</span><span class="normal"> </span><span class="symbol">&lt;&lt;</span><span class="normal"> </span><span class="string">")"</span><span class="symbol">);</span>
<span class="normal">                    </span><span class="function">DBG</span><span class="symbol">(</span><span class="normal">debug_mcreate</span><span class="symbol">,</span><span class="normal"> </span><span class="string">"Mod1 : ("</span><span class="normal"> </span><span class="symbol">&lt;&lt;</span><span class="normal"> </span><span class="symbol">(</span><span class="normal">index </span><span class="symbol">+</span><span class="normal"> </span><span class="number">1</span><span class="symbol">)</span><span class="normal"> </span><span class="symbol">&lt;&lt;</span><span class="normal"> </span><span class="string">"|"</span><span class="normal"> </span><span class="symbol">&lt;&lt;</span><span class="normal"> t</span><span class="symbol">[</span><span class="number">1</span><span class="symbol">]</span><span class="normal"> </span><span class="symbol">&lt;&lt;</span><span class="normal"> </span><span class="string">" - "</span><span class="normal"> </span><span class="symbol">&lt;&lt;</span><span class="normal"> mod_one </span><span class="symbol">&lt;&lt;</span><span class="normal"> </span><span class="string">","</span><span class="normal"> </span><span class="symbol">&lt;&lt;</span><span class="normal"> </span><span class="number">0</span><span class="normal"> </span><span class="symbol">&lt;&lt;</span><span class="normal"> </span><span class="string">")"</span><span class="symbol">);</span>

<span class="normal">                    mod0_runs</span><span class="symbol">.</span><span class="function">push</span><span class="symbol">(</span><span class="function">skew_quint_type</span><span class="symbol">(</span><span class="normal">index</span><span class="symbol">,</span><span class="normal"> t</span><span class="symbol">[</span><span class="number">0</span><span class="symbol">],</span><span class="normal"> t</span><span class="symbol">[</span><span class="number">1</span><span class="symbol">],</span><span class="normal"> mod_one</span><span class="symbol">,</span><span class="normal"> </span><span class="number">0</span><span class="symbol">));</span>
<span class="normal">                    mod1_runs</span><span class="symbol">.</span><span class="function">push</span><span class="symbol">(</span><span class="function">skew_quad_type</span><span class="symbol">(</span><span class="normal">index </span><span class="symbol">+</span><span class="normal"> </span><span class="number">1</span><span class="symbol">,</span><span class="normal"> mod_one</span><span class="symbol">,</span><span class="normal"> t</span><span class="symbol">[</span><span class="number">1</span><span class="symbol">],</span><span class="normal"> </span><span class="number">0</span><span class="symbol">));</span>

<span class="normal">                    </span><span class="keyword">if</span><span class="normal"> </span><span class="symbol">(</span><span class="normal">index </span><span class="symbol">!=</span><span class="normal"> </span><span class="function">offset_type</span><span class="symbol">(</span><span class="number">0</span><span class="symbol">))</span><span class="normal"> </span><span class="cbracket">{</span>
<span class="normal">                        </span><span class="function">DBG</span><span class="symbol">(</span><span class="normal">debug_mcreate</span><span class="symbol">,</span><span class="normal"> </span><span class="string">"Mod2 : ("</span><span class="normal"> </span><span class="symbol">&lt;&lt;</span><span class="normal"> </span><span class="symbol">(</span><span class="normal">index </span><span class="symbol">-</span><span class="normal"> </span><span class="number">1</span><span class="symbol">)</span><span class="normal"> </span><span class="symbol">&lt;&lt;</span><span class="normal"> </span><span class="string">"|"</span><span class="normal"> </span><span class="symbol">&lt;&lt;</span><span class="normal"> old_t2 </span><span class="symbol">&lt;&lt;</span><span class="normal"> </span><span class="string">","</span><span class="normal"> </span><span class="symbol">&lt;&lt;</span><span class="normal"> t</span><span class="symbol">[</span><span class="number">0</span><span class="symbol">]</span><span class="normal"> </span><span class="symbol">&lt;&lt;</span><span class="normal"> </span><span class="string">" - "</span><span class="normal"> </span><span class="symbol">&lt;&lt;</span><span class="normal"> old_mod2 </span><span class="symbol">&lt;&lt;</span><span class="normal"> </span><span class="string">","</span><span class="normal"> </span><span class="symbol">&lt;&lt;</span><span class="normal"> mod_one </span><span class="symbol">&lt;&lt;</span><span class="normal"> </span><span class="string">")"</span><span class="symbol">);</span>
<span class="normal">                        mod2_runs</span><span class="symbol">.</span><span class="function">push</span><span class="symbol">(</span><span class="function">skew_quint_type</span><span class="symbol">((</span><span class="normal">index </span><span class="symbol">-</span><span class="normal"> </span><span class="number">1</span><span class="symbol">),</span><span class="normal"> old_mod2</span><span class="symbol">,</span><span class="normal"> old_t2</span><span class="symbol">,</span><span class="normal"> t</span><span class="symbol">[</span><span class="number">0</span><span class="symbol">],</span><span class="normal"> mod_one</span><span class="symbol">));</span>
<span class="normal">                    </span><span class="cbracket">}</span>
<span class="normal">                </span><span class="cbracket">}</span>
<span class="normal">                </span><span class="keyword">else</span><span class="normal"> </span><span class="cbracket">{</span><span class="normal">	</span><span class="comment">// Only one element left</span>
<span class="normal">                    </span><span class="function">assert</span><span class="symbol">(</span><span class="normal">exists</span><span class="symbol">[</span><span class="number">0</span><span class="symbol">]);</span>
<span class="normal">                    </span><span class="function">DBG</span><span class="symbol">(</span><span class="normal">debug_mcreate</span><span class="symbol">,</span><span class="normal"> </span><span class="string">"twomiss"</span><span class="symbol">);</span>
<span class="normal">                    </span><span class="function">DBG</span><span class="symbol">(</span><span class="normal">debug_mcreate</span><span class="symbol">,</span><span class="normal"> </span><span class="string">"Mod0 : ("</span><span class="normal"> </span><span class="symbol">&lt;&lt;</span><span class="normal"> index </span><span class="symbol">&lt;&lt;</span><span class="normal"> </span><span class="string">"|"</span><span class="normal"> </span><span class="symbol">&lt;&lt;</span><span class="normal"> t</span><span class="symbol">[</span><span class="number">0</span><span class="symbol">]</span><span class="normal"> </span><span class="symbol">&lt;&lt;</span><span class="normal"> </span><span class="string">","</span><span class="normal"> </span><span class="symbol">&lt;&lt;</span><span class="normal"> </span><span class="number">0</span><span class="normal"> </span><span class="symbol">&lt;&lt;</span><span class="normal"> </span><span class="string">" - "</span><span class="normal"> </span><span class="symbol">&lt;&lt;</span><span class="normal"> </span><span class="number">0</span><span class="normal"> </span><span class="symbol">&lt;&lt;</span><span class="normal"> </span><span class="string">","</span><span class="normal"> </span><span class="symbol">&lt;&lt;</span><span class="normal"> </span><span class="number">0</span><span class="normal"> </span><span class="symbol">&lt;&lt;</span><span class="normal"> </span><span class="string">")"</span><span class="symbol">);</span>

<span class="normal">                    mod0_runs</span><span class="symbol">.</span><span class="function">push</span><span class="symbol">(</span><span class="function">skew_quint_type</span><span class="symbol">(</span><span class="normal">index</span><span class="symbol">,</span><span class="normal"> t</span><span class="symbol">[</span><span class="number">0</span><span class="symbol">],</span><span class="normal"> </span><span class="number">0</span><span class="symbol">,</span><span class="normal"> </span><span class="number">0</span><span class="symbol">,</span><span class="normal"> </span><span class="number">0</span><span class="symbol">));</span>

<span class="normal">                    </span><span class="keyword">if</span><span class="normal"> </span><span class="symbol">(</span><span class="normal">index </span><span class="symbol">!=</span><span class="normal"> </span><span class="function">offset_type</span><span class="symbol">(</span><span class="number">0</span><span class="symbol">))</span><span class="normal"> </span><span class="cbracket">{</span>
<span class="normal">                        </span><span class="function">DBG</span><span class="symbol">(</span><span class="normal">debug_mcreate</span><span class="symbol">,</span><span class="normal"> </span><span class="string">"Mod2 : ("</span><span class="normal"> </span><span class="symbol">&lt;&lt;</span><span class="normal"> </span><span class="symbol">(</span><span class="normal">index </span><span class="symbol">-</span><span class="normal"> </span><span class="number">1</span><span class="symbol">)</span><span class="normal"> </span><span class="symbol">&lt;&lt;</span><span class="normal"> </span><span class="string">"|"</span><span class="normal"> </span><span class="symbol">&lt;&lt;</span><span class="normal"> old_t2 </span><span class="symbol">&lt;&lt;</span><span class="normal"> </span><span class="string">","</span><span class="normal"> </span><span class="symbol">&lt;&lt;</span><span class="normal"> t</span><span class="symbol">[</span><span class="number">0</span><span class="symbol">]</span><span class="normal"> </span><span class="symbol">&lt;&lt;</span><span class="normal"> </span><span class="string">" - "</span><span class="normal"> </span><span class="symbol">&lt;&lt;</span><span class="normal"> old_mod2 </span><span class="symbol">&lt;&lt;</span><span class="normal"> </span><span class="string">","</span><span class="normal"> </span><span class="symbol">&lt;&lt;</span><span class="normal"> </span><span class="number">0</span><span class="normal"> </span><span class="symbol">&lt;&lt;</span><span class="normal"> </span><span class="string">")"</span><span class="symbol">);</span>
<span class="normal">                        mod2_runs</span><span class="symbol">.</span><span class="function">push</span><span class="symbol">(</span><span class="function">skew_quint_type</span><span class="symbol">((</span><span class="normal">index </span><span class="symbol">-</span><span class="normal"> </span><span class="number">1</span><span class="symbol">),</span><span class="normal"> old_mod2</span><span class="symbol">,</span><span class="normal"> old_t2</span><span class="symbol">,</span><span class="normal"> t</span><span class="symbol">[</span><span class="number">0</span><span class="symbol">],</span><span class="normal"> </span><span class="number">0</span><span class="symbol">));</span>
<span class="normal">                    </span><span class="cbracket">}</span>
<span class="normal">                </span><span class="cbracket">}</span>

<span class="normal">                old_mod2 </span><span class="symbol">=</span><span class="normal"> mod_two</span><span class="symbol">;</span>
<span class="normal">                old_t2 </span><span class="symbol">=</span><span class="normal"> t</span><span class="symbol">[</span><span class="number">2</span><span class="symbol">];</span>
<span class="normal">                index </span><span class="symbol">+=</span><span class="normal"> </span><span class="number">3</span><span class="symbol">;</span>
<span class="normal">            </span><span class="cbracket">}</span>

<span class="normal">            </span><span class="keyword">if</span><span class="normal"> </span><span class="symbol">((</span><span class="normal">a_size </span><span class="symbol">%</span><span class="normal"> </span><span class="number">3</span><span class="symbol">)</span><span class="normal"> </span><span class="symbol">==</span><span class="normal"> </span><span class="number">0</span><span class="symbol">)</span><span class="normal"> </span><span class="cbracket">{</span><span class="normal">	</span><span class="comment">// changed</span>
<span class="normal">                </span><span class="keyword">if</span><span class="normal"> </span><span class="symbol">(</span><span class="normal">index </span><span class="symbol">!=</span><span class="normal"> </span><span class="function">offset_type</span><span class="symbol">(</span><span class="number">0</span><span class="symbol">))</span><span class="normal"> </span><span class="cbracket">{</span>
<span class="normal">                    </span><span class="function">DBG</span><span class="symbol">(</span><span class="normal">debug_mcreate</span><span class="symbol">,</span><span class="normal"> </span><span class="string">"Mod2 : ("</span><span class="normal"> </span><span class="symbol">&lt;&lt;</span><span class="normal"> </span><span class="symbol">(</span><span class="normal">index </span><span class="symbol">-</span><span class="normal"> </span><span class="number">1</span><span class="symbol">)</span><span class="normal"> </span><span class="symbol">&lt;&lt;</span><span class="normal"> </span><span class="string">"|"</span><span class="normal"> </span><span class="symbol">&lt;&lt;</span><span class="normal"> old_t2 </span><span class="symbol">&lt;&lt;</span><span class="normal"> </span><span class="string">","</span><span class="normal"> </span><span class="symbol">&lt;&lt;</span><span class="normal"> </span><span class="number">0</span><span class="normal"> </span><span class="symbol">&lt;&lt;</span><span class="normal"> </span><span class="string">" - "</span><span class="normal"> </span><span class="symbol">&lt;&lt;</span><span class="normal"> old_mod2 </span><span class="symbol">&lt;&lt;</span><span class="normal"> </span><span class="string">","</span><span class="normal"> </span><span class="symbol">&lt;&lt;</span><span class="normal"> </span><span class="number">0</span><span class="normal"> </span><span class="symbol">&lt;&lt;</span><span class="normal"> </span><span class="string">")"</span><span class="symbol">);</span>
<span class="normal">                    mod2_runs</span><span class="symbol">.</span><span class="function">push</span><span class="symbol">(</span><span class="function">skew_quint_type</span><span class="symbol">((</span><span class="normal">index </span><span class="symbol">-</span><span class="normal"> </span><span class="number">1</span><span class="symbol">),</span><span class="normal"> old_mod2</span><span class="symbol">,</span><span class="normal"> old_t2</span><span class="symbol">,</span><span class="normal"> </span><span class="number">0</span><span class="symbol">,</span><span class="normal"> </span><span class="number">0</span><span class="symbol">));</span>
<span class="normal">                </span><span class="cbracket">}</span>
<span class="normal">            </span><span class="cbracket">}</span>

<span class="normal">            </span><span class="keyword">if</span><span class="normal"> </span><span class="symbol">(</span><span class="normal">debug_S012</span><span class="symbol">)</span>
<span class="normal">            </span><span class="cbracket">{</span>
<span class="normal">                </span><span class="usertype">offset_type</span><span class="normal"> i </span><span class="symbol">=</span><span class="normal"> </span><span class="number">0</span><span class="symbol">;</span>
<span class="normal">                </span><span class="keyword">for</span><span class="symbol">(</span><span class="usertype">mod0_rm_type</span><span class="normal"> </span><span class="function">mod0_result</span><span class="symbol">(</span><span class="normal">mod0_runs</span><span class="symbol">.</span><span class="function">result</span><span class="symbol">(),</span><span class="normal"> </span><span class="function">less_mod0</span><span class="symbol">(),</span><span class="normal"> memsize </span><span class="symbol">/</span><span class="normal"> </span><span class="number">3</span><span class="symbol">);</span>
<span class="normal">                    </span><span class="symbol">!</span><span class="normal">mod0_result</span><span class="symbol">.</span><span class="function">empty</span><span class="symbol">();</span><span class="normal"> </span><span class="symbol">++</span><span class="normal">mod0_result</span><span class="symbol">,</span><span class="normal"> </span><span class="symbol">++</span><span class="normal">i</span><span class="symbol">)</span>
<span class="normal">                    </span><span class="function">DBG</span><span class="symbol">(</span><span class="normal">debug_S012</span><span class="symbol">,</span><span class="normal"> </span><span class="string">"S0["</span><span class="normal"> </span><span class="symbol">&lt;&lt;</span><span class="normal"> i </span><span class="symbol">&lt;&lt;</span><span class="normal"> </span><span class="string">"]: "</span><span class="normal"> </span><span class="symbol">&lt;&lt;</span><span class="normal"> </span><span class="symbol">*</span><span class="normal">mod0_result</span><span class="symbol">);</span>

<span class="normal">                i </span><span class="symbol">=</span><span class="normal"> </span><span class="number">0</span><span class="symbol">;</span>
<span class="normal">                </span><span class="keyword">for</span><span class="symbol">(</span><span class="usertype">mod1_rm_type</span><span class="normal"> </span><span class="function">mod1_result</span><span class="symbol">(</span><span class="normal">mod1_runs</span><span class="symbol">.</span><span class="function">result</span><span class="symbol">(),</span><span class="normal"> </span><span class="function">less_quad_2nd</span><span class="symbol">(),</span><span class="normal"> memsize </span><span class="symbol">/</span><span class="normal"> </span><span class="number">3</span><span class="symbol">);</span>
<span class="normal">                    </span><span class="symbol">!</span><span class="normal">mod1_result</span><span class="symbol">.</span><span class="function">empty</span><span class="symbol">();</span><span class="normal"> </span><span class="symbol">++</span><span class="normal">mod1_result</span><span class="symbol">,</span><span class="normal"> </span><span class="symbol">++</span><span class="normal">i</span><span class="symbol">)</span>
<span class="normal">                    </span><span class="function">DBG</span><span class="symbol">(</span><span class="normal">debug_S012</span><span class="symbol">,</span><span class="normal"> </span><span class="string">"S1["</span><span class="normal"> </span><span class="symbol">&lt;&lt;</span><span class="normal"> i </span><span class="symbol">&lt;&lt;</span><span class="normal"> </span><span class="string">"]: "</span><span class="normal"> </span><span class="symbol">&lt;&lt;</span><span class="normal"> </span><span class="symbol">*</span><span class="normal">mod1_result</span><span class="symbol">);</span>

<span class="normal">                i </span><span class="symbol">=</span><span class="normal"> </span><span class="number">0</span><span class="symbol">;</span>
<span class="normal">                </span><span class="keyword">for</span><span class="symbol">(</span><span class="usertype">mod2_rm_type</span><span class="normal"> </span><span class="function">mod2_result</span><span class="symbol">(</span><span class="normal">mod2_runs</span><span class="symbol">.</span><span class="function">result</span><span class="symbol">(),</span><span class="normal"> </span><span class="function">less_quint_2nd</span><span class="symbol">(),</span><span class="normal"> memsize </span><span class="symbol">/</span><span class="normal"> </span><span class="number">3</span><span class="symbol">);</span>
<span class="normal">                    </span><span class="symbol">!</span><span class="normal">mod2_result</span><span class="symbol">.</span><span class="function">empty</span><span class="symbol">();</span><span class="normal"> </span><span class="symbol">++</span><span class="normal">mod2_result</span><span class="symbol">,</span><span class="normal"> </span><span class="symbol">++</span><span class="normal">i</span><span class="symbol">)</span>
<span class="normal">                    </span><span class="function">DBG</span><span class="symbol">(</span><span class="normal">debug_S012</span><span class="symbol">,</span><span class="normal"> </span><span class="string">"S2["</span><span class="normal"> </span><span class="symbol">&lt;&lt;</span><span class="normal"> i </span><span class="symbol">&lt;&lt;</span><span class="normal"> </span><span class="string">"]: "</span><span class="normal"> </span><span class="symbol">&lt;&lt;</span><span class="normal"> </span><span class="symbol">*</span><span class="normal">mod2_result</span><span class="symbol">);</span>
<span class="normal">            </span><span class="cbracket">}</span>

<span class="normal">            mod0_runs</span><span class="symbol">.</span><span class="function">deallocate</span><span class="symbol">();</span>
<span class="normal">            mod1_runs</span><span class="symbol">.</span><span class="function">deallocate</span><span class="symbol">();</span>
<span class="normal">            mod2_runs</span><span class="symbol">.</span><span class="function">deallocate</span><span class="symbol">();</span>

<span class="normal">            </span><span class="comment">// Prepare for merging</span>

<span class="normal">            mod0_result </span><span class="symbol">=</span><span class="normal"> </span><span class="keyword">new</span><span class="normal"> </span><span class="function">mod0_rm_type</span><span class="symbol">(</span><span class="normal">mod0_runs</span><span class="symbol">.</span><span class="function">result</span><span class="symbol">(),</span><span class="normal"> </span><span class="function">less_mod0</span><span class="symbol">(),</span><span class="normal"> memsize </span><span class="symbol">/</span><span class="normal"> </span><span class="number">3</span><span class="symbol">);</span>
<span class="normal">            mod1_result </span><span class="symbol">=</span><span class="normal"> </span><span class="keyword">new</span><span class="normal"> </span><span class="function">mod1_rm_type</span><span class="symbol">(</span><span class="normal">mod1_runs</span><span class="symbol">.</span><span class="function">result</span><span class="symbol">(),</span><span class="normal"> </span><span class="function">less_quad_2nd</span><span class="symbol">(),</span><span class="normal"> memsize </span><span class="symbol">/</span><span class="normal"> </span><span class="number">3</span><span class="symbol">);</span>
<span class="normal">            mod2_result </span><span class="symbol">=</span><span class="normal"> </span><span class="keyword">new</span><span class="normal"> </span><span class="function">mod2_rm_type</span><span class="symbol">(</span><span class="normal">mod2_runs</span><span class="symbol">.</span><span class="function">result</span><span class="symbol">(),</span><span class="normal"> </span><span class="function">less_quint_2nd</span><span class="symbol">(),</span><span class="normal"> memsize </span><span class="symbol">/</span><span class="normal"> </span><span class="number">3</span><span class="symbol">);</span>
<span class="normal">            </span><span class="comment">// output: ISA_1,2 for next level</span>

<span class="preproc">#if</span><span class="normal"> </span><span class="symbol">!</span><span class="normal">LCP_CALC</span>
<span class="normal">            vmerge_sa </span><span class="symbol">=</span><span class="normal"> </span><span class="keyword">new</span><span class="normal"> </span><span class="function">merge_sa_type</span><span class="symbol">(*</span><span class="normal">mod0_result</span><span class="symbol">,</span><span class="normal"> </span><span class="symbol">*</span><span class="normal">mod1_result</span><span class="symbol">,</span><span class="normal"> </span><span class="symbol">*</span><span class="normal">mod2_result</span><span class="symbol">);</span>
<span class="preproc">#else</span><span class="normal"> </span><span class="comment">// LCP_CALC</span>
<span class="normal">            vmerge_sa </span><span class="symbol">=</span><span class="normal"> </span><span class="keyword">new</span><span class="normal"> </span><span class="function">merge_sa_type</span><span class="symbol">(*</span><span class="normal">mod0_result</span><span class="symbol">,</span><span class="normal"> </span><span class="symbol">*</span><span class="normal">mod1_result</span><span class="symbol">,</span><span class="normal"> </span><span class="symbol">*</span><span class="normal">mod2_result</span><span class="symbol">,</span><span class="normal"> lcp_base</span><span class="symbol">,</span><span class="normal"> lcp_rmq1</span><span class="symbol">,</span><span class="normal"> lcp_rmq1_ranks</span><span class="symbol">);</span>
<span class="preproc">#endif</span><span class="normal"> </span><span class="comment">// LCP_CALC</span>

<span class="normal">            result </span><span class="symbol">=</span><span class="normal"> </span><span class="symbol">*(*</span><span class="normal">vmerge_sa</span><span class="symbol">);</span>
<span class="normal">        </span><span class="cbracket">}</span>

<span class="normal">        </span><span class="keyword">const</span><span class="normal"> value_type </span><span class="symbol">&amp;</span><span class="normal"> </span><span class="keyword">operator</span><span class="symbol">*()</span><span class="normal"> </span><span class="keyword">const</span>
<span class="normal">        </span><span class="cbracket">{</span>
<span class="normal">            </span><span class="keyword">return</span><span class="normal"> result</span><span class="symbol">;</span>
<span class="normal">        </span><span class="cbracket">}</span>

<span class="normal">        build_sa </span><span class="symbol">&amp;</span><span class="normal"> </span><span class="keyword">operator</span><span class="symbol">++()</span>
<span class="normal">        </span><span class="cbracket">{</span>
<span class="normal">            </span><span class="function">assert</span><span class="symbol">(</span><span class="normal">vmerge_sa </span><span class="symbol">!=</span><span class="normal"> </span><span class="number">0</span><span class="normal"> </span><span class="symbol">&amp;&amp;</span><span class="normal"> </span><span class="symbol">!</span><span class="normal">vmerge_sa</span><span class="symbol">-&gt;</span><span class="function">empty</span><span class="symbol">());</span>

<span class="normal">            </span><span class="symbol">++(*</span><span class="normal">vmerge_sa</span><span class="symbol">);</span>
<span class="normal">            </span><span class="keyword">if</span><span class="normal"> </span><span class="symbol">(!</span><span class="normal">vmerge_sa</span><span class="symbol">-&gt;</span><span class="function">empty</span><span class="symbol">())</span><span class="normal"> </span><span class="cbracket">{</span>
<span class="normal">                result </span><span class="symbol">=</span><span class="normal"> </span><span class="symbol">*(*</span><span class="normal">vmerge_sa</span><span class="symbol">);</span>
<span class="normal">            </span><span class="cbracket">}</span>
<span class="normal">            </span><span class="keyword">else</span><span class="normal"> </span><span class="cbracket">{</span><span class="normal">		</span><span class="comment">// cleaning up</span>
<span class="normal">                </span><span class="function">assert</span><span class="symbol">(</span><span class="normal">vmerge_sa</span><span class="symbol">-&gt;</span><span class="function">empty</span><span class="symbol">());</span>
<span class="normal">                ready </span><span class="symbol">=</span><span class="normal"> </span><span class="keyword">true</span><span class="symbol">;</span>

<span class="normal">                </span><span class="function">assert</span><span class="symbol">(</span><span class="normal">vmerge_sa </span><span class="symbol">!=</span><span class="normal"> NULL</span><span class="symbol">);</span>
<span class="normal">                </span><span class="keyword">delete</span><span class="normal"> vmerge_sa</span><span class="symbol">;</span><span class="normal"> vmerge_sa </span><span class="symbol">=</span><span class="normal"> NULL</span><span class="symbol">;</span>

<span class="normal">                </span><span class="function">assert</span><span class="symbol">(</span><span class="normal">mod0_result </span><span class="symbol">!=</span><span class="normal"> NULL </span><span class="symbol">&amp;&amp;</span><span class="normal"> mod1_result </span><span class="symbol">!=</span><span class="normal"> NULL </span><span class="symbol">&amp;&amp;</span><span class="normal"> mod2_result </span><span class="symbol">!=</span><span class="normal"> NULL</span><span class="symbol">);</span>
<span class="normal">                </span><span class="keyword">delete</span><span class="normal"> mod0_result</span><span class="symbol">;</span><span class="normal"> mod0_result </span><span class="symbol">=</span><span class="normal"> NULL</span><span class="symbol">;</span>
<span class="normal">                </span><span class="keyword">delete</span><span class="normal"> mod1_result</span><span class="symbol">;</span><span class="normal"> mod1_result </span><span class="symbol">=</span><span class="normal"> NULL</span><span class="symbol">;</span>
<span class="normal">                </span><span class="keyword">delete</span><span class="normal"> mod2_result</span><span class="symbol">;</span><span class="normal"> mod2_result </span><span class="symbol">=</span><span class="normal"> NULL</span><span class="symbol">;</span>
<span class="normal">            </span><span class="cbracket">}</span>

<span class="normal">            </span><span class="keyword">return</span><span class="normal"> </span><span class="symbol">*</span><span class="keyword">this</span><span class="symbol">;</span>
<span class="normal">        </span><span class="cbracket">}</span>

<span class="normal">        </span><span class="type">bool</span><span class="normal"> </span><span class="function">empty</span><span class="symbol">()</span><span class="normal"> </span><span class="keyword">const</span>
<span class="normal">        </span><span class="cbracket">{</span>
<span class="normal">            </span><span class="keyword">return</span><span class="normal"> ready</span><span class="symbol">;</span>
<span class="normal">        </span><span class="cbracket">}</span>
<span class="normal">    </span><span class="cbracket">}</span><span class="symbol">;</span>

<span class="preproc">#if</span><span class="normal"> LCP_CALC</span>
<span class="normal">    </span><span class="keyword">class</span><span class="normal"> </span><span class="classname">build_lcp</span>
<span class="normal">    </span><span class="cbracket">{</span>
<span class="normal">    </span><span class="keyword">public</span><span class="symbol">:</span>

<span class="normal">        </span><span class="keyword">typedef</span><span class="normal"> </span><span class="usertype">offset_type</span><span class="normal">  value_type</span><span class="symbol">;</span>

<span class="normal">    </span><span class="keyword">private</span><span class="symbol">:</span>

<span class="normal">        std</span><span class="symbol">::</span><span class="usertype">auto_ptr&lt;offset_array_type&gt;</span><span class="normal"> lcp_base</span><span class="symbol">;</span>

<span class="normal">        </span><span class="usertype">offset_array_it_rg</span><span class="normal">       lcp_baseiter</span><span class="symbol">;</span>

<span class="normal">        std</span><span class="symbol">::</span><span class="usertype">auto_ptr&lt;RMQ&gt;</span><span class="normal">      lcp_rmq</span><span class="symbol">;</span>

<span class="normal">        </span><span class="usertype">offset_type</span><span class="normal">             index</span><span class="symbol">;</span>

<span class="normal">        </span><span class="usertype">value_type</span><span class="normal">              result</span><span class="symbol">;</span>

<span class="normal">        </span><span class="type">void</span><span class="normal"> </span><span class="function">calc_next_lcp</span><span class="symbol">()</span>
<span class="normal">        </span><span class="cbracket">{</span>
<span class="normal">            </span><span class="keyword">if</span><span class="normal"> </span><span class="symbol">(</span><span class="function">empty</span><span class="symbol">())</span><span class="normal"> </span><span class="keyword">return</span><span class="symbol">;</span>

<span class="normal">            result </span><span class="symbol">=</span><span class="normal"> </span><span class="symbol">*</span><span class="normal">lcp_baseiter</span><span class="symbol">;</span>
<span class="normal">            </span><span class="function">DBG</span><span class="symbol">(</span><span class="normal">debug_lcp_build</span><span class="symbol">,</span><span class="normal"> </span><span class="string">"lcp["</span><span class="normal"> </span><span class="symbol">&lt;&lt;</span><span class="normal"> index </span><span class="symbol">&lt;&lt;</span><span class="normal"> </span><span class="string">"] = "</span><span class="normal"> </span><span class="symbol">&lt;&lt;</span><span class="normal"> result</span><span class="symbol">);</span>

<span class="normal">            </span><span class="comment">// add lcp of associated RMQ, if found.</span>
<span class="normal">            </span><span class="keyword">if</span><span class="normal"> </span><span class="symbol">(!</span><span class="normal">lcp_rmq</span><span class="symbol">-&gt;</span><span class="function">empty</span><span class="symbol">())</span>
<span class="normal">            </span><span class="cbracket">{</span>
<span class="normal">                </span><span class="keyword">if</span><span class="normal"> </span><span class="symbol">((*</span><span class="normal">lcp_rmq</span><span class="symbol">)-&gt;</span><span class="normal">first </span><span class="symbol">==</span><span class="normal"> index</span><span class="symbol">)</span>
<span class="normal">                </span><span class="cbracket">{</span>
<span class="normal">                    result </span><span class="symbol">+=</span><span class="normal"> </span><span class="symbol">(*</span><span class="normal">lcp_rmq</span><span class="symbol">)-&gt;</span><span class="normal">second</span><span class="symbol">;</span>
<span class="normal">                    </span><span class="function">DBG</span><span class="symbol">(</span><span class="normal">debug_lcp_build</span><span class="symbol">,</span><span class="normal"> </span><span class="string">"lcp["</span><span class="normal"> </span><span class="symbol">&lt;&lt;</span><span class="normal"> index </span><span class="symbol">&lt;&lt;</span><span class="normal"> </span><span class="string">"] += "</span><span class="normal"> </span><span class="symbol">&lt;&lt;</span><span class="normal"> </span><span class="symbol">(*</span><span class="normal">lcp_rmq</span><span class="symbol">)-&gt;</span><span class="normal">second </span><span class="symbol">&lt;&lt;</span><span class="normal"> </span><span class="string">" -&gt; "</span><span class="normal"> </span><span class="symbol">&lt;&lt;</span><span class="normal"> result</span><span class="symbol">);</span>
<span class="normal">                    </span><span class="symbol">++(*</span><span class="normal">lcp_rmq</span><span class="symbol">);</span>
<span class="normal">                </span><span class="cbracket">}</span>
<span class="normal">                </span><span class="function">assert</span><span class="symbol">((*</span><span class="normal">lcp_rmq</span><span class="symbol">).</span><span class="function">empty</span><span class="symbol">()</span><span class="normal"> </span><span class="symbol">||</span><span class="normal"> </span><span class="symbol">(*</span><span class="normal">lcp_rmq</span><span class="symbol">)-&gt;</span><span class="normal">first </span><span class="symbol">&gt;</span><span class="normal"> index</span><span class="symbol">);</span>
<span class="normal">            </span><span class="cbracket">}</span>
<span class="normal">        </span><span class="cbracket">}</span>

<span class="normal">    </span><span class="keyword">public</span><span class="symbol">:</span>

<span class="normal">        </span><span class="function">build_lcp</span><span class="symbol">(</span><span class="normal">offset_array_type</span><span class="symbol">*</span><span class="normal"> _lcp_base</span><span class="symbol">,</span><span class="normal"> RMQ</span><span class="symbol">*</span><span class="normal"> _lcp_rmq</span><span class="symbol">,</span><span class="normal"> uint8_array_type</span><span class="symbol">&amp;</span><span class="normal"> lcp_names</span><span class="symbol">)</span>
<span class="normal">            </span><span class="symbol">:</span><span class="normal"> </span><span class="function">lcp_base</span><span class="symbol">(</span><span class="normal">_lcp_base</span><span class="symbol">),</span>
<span class="normal">              </span><span class="function">lcp_baseiter</span><span class="symbol">(</span><span class="normal">lcp_base</span><span class="symbol">-&gt;</span><span class="function">begin</span><span class="symbol">(),</span><span class="normal"> lcp_base</span><span class="symbol">-&gt;</span><span class="function">end</span><span class="symbol">()),</span>
<span class="normal">              </span><span class="function">lcp_rmq</span><span class="symbol">(</span><span class="normal">_lcp_rmq</span><span class="symbol">),</span>
<span class="normal">              </span><span class="function">index</span><span class="symbol">(</span><span class="number">0</span><span class="symbol">)</span>
<span class="normal">        </span><span class="cbracket">{</span>
<span class="normal">            </span><span class="function">DBGMEM</span><span class="symbol">(</span><span class="string">"computing RMQs on LCP_N"</span><span class="symbol">);</span>

<span class="normal">            </span><span class="comment">// some RMQ problem on LCP_names and prepare answers for iteration</span>
<span class="normal">            </span><span class="usertype">uint8_array_it_rg</span><span class="normal"> </span><span class="function">lcp_names_stream</span><span class="symbol">(</span><span class="normal">lcp_names</span><span class="symbol">.</span><span class="function">begin</span><span class="symbol">(),</span><span class="normal"> lcp_names</span><span class="symbol">.</span><span class="function">end</span><span class="symbol">());</span>
<span class="normal">            lcp_rmq</span><span class="symbol">-&gt;</span><span class="function">compute</span><span class="symbol">(</span><span class="normal">lcp_names_stream</span><span class="symbol">);</span>

<span class="normal">            </span><span class="function">DBGMEM</span><span class="symbol">(</span><span class="string">"done computing RMQs on LCP_N"</span><span class="symbol">);</span>
<span class="normal">        </span><span class="cbracket">}</span>

<span class="normal">        </span><span class="type">void</span><span class="normal"> </span><span class="function">start_output</span><span class="symbol">(</span><span class="usertype">size_t</span><span class="normal"> memsize</span><span class="symbol">)</span>
<span class="normal">        </span><span class="cbracket">{</span>
<span class="normal">            lcp_rmq</span><span class="symbol">-&gt;</span><span class="function">start_output</span><span class="symbol">(</span><span class="normal">memsize</span><span class="symbol">);</span>
<span class="normal">            </span><span class="function">calc_next_lcp</span><span class="symbol">();</span>
<span class="normal">        </span><span class="cbracket">}</span>

<span class="normal">        </span><span class="keyword">const</span><span class="normal"> value_type </span><span class="symbol">&amp;</span><span class="normal"> </span><span class="keyword">operator</span><span class="symbol">*()</span><span class="normal"> </span><span class="keyword">const</span>
<span class="normal">        </span><span class="cbracket">{</span>
<span class="normal">            </span><span class="keyword">return</span><span class="normal"> result</span><span class="symbol">;</span>
<span class="normal">        </span><span class="cbracket">}</span>

<span class="normal">        build_lcp</span><span class="symbol">&amp;</span><span class="normal"> </span><span class="keyword">operator</span><span class="symbol">++</span><span class="normal"> </span><span class="symbol">()</span>
<span class="normal">        </span><span class="cbracket">{</span>
<span class="normal">            </span><span class="symbol">++</span><span class="normal">lcp_baseiter</span><span class="symbol">,</span><span class="normal"> </span><span class="symbol">++</span><span class="normal">index</span><span class="symbol">;</span>
<span class="normal">            </span><span class="function">calc_next_lcp</span><span class="symbol">();</span>
<span class="normal">            </span><span class="keyword">return</span><span class="normal"> </span><span class="symbol">*</span><span class="keyword">this</span><span class="symbol">;</span>
<span class="normal">        </span><span class="cbracket">}</span>

<span class="normal">        </span><span class="type">bool</span><span class="normal"> </span><span class="function">empty</span><span class="symbol">()</span><span class="normal"> </span><span class="keyword">const</span>
<span class="normal">        </span><span class="cbracket">{</span>
<span class="normal">            </span><span class="keyword">return</span><span class="normal"> lcp_baseiter</span><span class="symbol">.</span><span class="function">empty</span><span class="symbol">();</span>
<span class="normal">        </span><span class="cbracket">}</span>
<span class="normal">    </span><span class="cbracket">}</span><span class="symbol">;</span>
<span class="preproc">#endif</span><span class="normal"> </span><span class="comment">// LCP_CALC</span>

<span class="normal">    </span><span class="comment">/***********************************************************************************************</span>
<span class="comment">     * The skew algorithm                                                                          *</span>
<span class="comment">     ***********************************************************************************************/</span>

<span class="normal">    </span><span class="comment">/**</span>
<span class="comment">     * The skew algorithm (in its pure form)</span>
<span class="comment">     * </span><span class="type">@param</span><span class="comment"> Input type of the input pipe.</span>
<span class="comment">     * </span><span class="type">@param</span><span class="comment"> block_size block size of an external sorter we use.</span>
<span class="comment">     * </span><span class="type">@param</span><span class="comment"> quiet if true we omit informations about the computation process.</span>
<span class="comment">     */</span>

<span class="normal">    </span><span class="keyword">template</span><span class="normal"> </span><span class="symbol">&lt;</span><span class="keyword">class</span><span class="normal"> </span><span class="classname">Input</span><span class="symbol">,</span><span class="normal"> </span><span class="keyword">const</span><span class="normal"> </span><span class="type">int</span><span class="normal"> block_size </span><span class="symbol">=</span><span class="normal"> </span><span class="symbol">::</span><span class="normal">block_size</span><span class="symbol">&gt;</span>
<span class="normal">    </span><span class="keyword">class</span><span class="normal"> </span><span class="classname">algorithm</span>
<span class="normal">    </span><span class="cbracket">{</span>
<span class="preproc">#if</span><span class="normal"> LCP_CALC</span>
<span class="normal">        </span><span class="keyword">static</span><span class="normal"> </span><span class="keyword">const</span><span class="normal"> </span><span class="type">int</span><span class="normal"> memdivA        </span><span class="symbol">=</span><span class="normal"> </span><span class="number">5</span><span class="symbol">;</span><span class="normal">        </span><span class="comment">// memory divisor of loop</span>
<span class="preproc">#else</span>
<span class="normal">        </span><span class="keyword">static</span><span class="normal"> </span><span class="keyword">const</span><span class="normal"> </span><span class="type">int</span><span class="normal"> memdivA        </span><span class="symbol">=</span><span class="normal"> </span><span class="number">4</span><span class="symbol">;</span>
<span class="preproc">#endif</span>

<span class="normal">    </span><span class="keyword">public</span><span class="symbol">:</span>
<span class="normal">        </span><span class="keyword">typedef</span><span class="normal"> </span><span class="usertype">offset_type</span><span class="normal"> value_type</span><span class="symbol">;</span>

<span class="normal">        </span><span class="keyword">typedef</span><span class="normal"> </span><span class="keyword">typename</span><span class="normal"> </span><span class="classname">Input</span><span class="symbol">::</span><span class="usertype">value_type</span><span class="normal">       alphabet_type</span><span class="symbol">;</span>

<span class="normal">    </span><span class="keyword">private</span><span class="symbol">:</span>
<span class="normal">        </span><span class="comment">// All needed types</span>

<span class="normal">        </span><span class="comment">// *** Types for alphabet_type input - make input stream compatible to loop functors.</span>

<span class="normal">        </span><span class="keyword">typedef</span><span class="normal"> tuples</span><span class="symbol">::</span><span class="normal">counter </span><span class="symbol">&lt;</span><span class="normal">offset_type</span><span class="symbol">&gt;</span><span class="normal"> counter_stream_type</span><span class="symbol">;</span>
<span class="normal">        </span><span class="comment">// (t_i) -&gt; (i,t_i)</span>
<span class="normal">        </span><span class="keyword">typedef</span><span class="normal"> make_pairs </span><span class="symbol">&lt;</span><span class="normal">counter_stream_type</span><span class="symbol">,</span><span class="normal"> Input</span><span class="symbol">&gt;</span><span class="normal"> make_pairs_input_type</span><span class="symbol">;</span>

<span class="normal">        </span><span class="comment">// All needed types for recursive name construction loop.</span>

<span class="normal">        </span><span class="comment">// (t_i) -&gt; (i,t_i,t_{i+1},t_{i+2})</span>
<span class="normal">        </span><span class="keyword">typedef</span><span class="normal"> make_quads </span><span class="symbol">&lt;</span><span class="normal">make_pairs_input_type</span><span class="symbol">,</span><span class="normal"> offset_type</span><span class="symbol">,</span><span class="normal"> </span><span class="number">1</span><span class="symbol">&gt;</span><span class="normal"> make_quads_input_type</span><span class="symbol">;</span>
<span class="normal">        </span><span class="comment">// (t_i) -&gt; (i,t_i,t_{i+1},t_{i+2}) with i = 1,2 mod 3</span>
<span class="normal">        </span><span class="keyword">typedef</span><span class="normal"> extract_mod12 </span><span class="symbol">&lt;</span><span class="normal">make_quads_input_type</span><span class="symbol">&gt;</span><span class="normal"> mod12_quads_input_type</span><span class="symbol">;</span>

<span class="normal">        </span><span class="comment">// sort (i,t_i,t_{i+1},t_{i+2}) by (t_i,t_{i+1},t_{i+2})</span>
<span class="normal">        </span><span class="keyword">typedef</span><span class="normal"> </span><span class="keyword">typename</span><span class="normal"> </span><span class="classname">stream</span><span class="symbol">::</span><span class="usertype">sort&lt;mod12_quads_input_type, less_quad&lt;offset_type&gt;, block_size&gt;</span><span class="normal"> sort_mod12_input_type</span><span class="symbol">;</span>

<span class="normal">        </span><span class="comment">// name (i,t_i,t_{i+1},t_{i+2}) -&gt; (i,n_i)</span>
<span class="normal">        </span><span class="keyword">typedef</span><span class="normal"> naming </span><span class="symbol">&lt;</span><span class="normal">sort_mod12_input_type</span><span class="symbol">&gt;</span><span class="normal"> naming_input_type</span><span class="symbol">;</span>

<span class="normal">        </span><span class="comment">// (i,n_i) sort by (i mod 3, i div 3) to create recursive text</span>
<span class="normal">        </span><span class="keyword">typedef</span><span class="normal"> </span><span class="keyword">typename</span><span class="normal"> </span><span class="classname">stream</span><span class="symbol">::</span><span class="normal">runs_creator </span><span class="symbol">&lt;</span><span class="normal">naming_input_type</span><span class="symbol">,</span><span class="normal"> less_skew</span><span class="symbol">,</span><span class="normal"> block_size</span><span class="symbol">&gt;</span><span class="normal"> rc_order_type</span><span class="symbol">;</span>
<span class="normal">        </span><span class="keyword">typedef</span><span class="normal"> </span><span class="keyword">typename</span><span class="normal"> </span><span class="classname">rc_order_type</span><span class="symbol">::</span><span class="usertype">sorted_runs_type</span><span class="normal"> sr_order_type</span><span class="symbol">;</span>
<span class="normal">        </span><span class="keyword">typedef</span><span class="normal"> </span><span class="keyword">typename</span><span class="normal"> </span><span class="classname">stream</span><span class="symbol">::</span><span class="normal">runs_merger </span><span class="symbol">&lt;</span><span class="normal">sr_order_type</span><span class="symbol">,</span><span class="normal"> less_skew</span><span class="symbol">&gt;</span><span class="normal"> rm_order_type</span><span class="symbol">;</span>

<span class="normal">        </span><span class="comment">// (t_i) -&gt; (i,t_i,t_{i+1},t_{i+2}) with recursive text</span>
<span class="normal">        </span><span class="keyword">typedef</span><span class="normal"> make_quads </span><span class="symbol">&lt;</span><span class="normal">rm_order_type</span><span class="symbol">,</span><span class="normal"> offset_type</span><span class="symbol">,</span><span class="normal"> </span><span class="number">1</span><span class="symbol">&gt;</span><span class="normal"> make_quads_loop_type</span><span class="symbol">;</span>

<span class="normal">        </span><span class="comment">// (t_i) -&gt; (i,t_i,t_{i+1},t_{i+2}) with i = 1,2 mod 3</span>
<span class="normal">        </span><span class="keyword">typedef</span><span class="normal"> extract_mod12 </span><span class="symbol">&lt;</span><span class="normal">make_quads_loop_type</span><span class="symbol">&gt;</span><span class="normal"> mod12_quads_loop_type</span><span class="symbol">;</span>

<span class="normal">        </span><span class="comment">// sort (i,t_i,t_{i+1},t_{i+2}) by (t_i,t_{i+1},t_{i+2})</span>
<span class="normal">        </span><span class="keyword">typedef</span><span class="normal"> </span><span class="keyword">typename</span><span class="normal"> </span><span class="classname">stream</span><span class="symbol">::</span><span class="normal">sort </span><span class="symbol">&lt;</span><span class="normal">mod12_quads_loop_type</span><span class="symbol">,</span><span class="normal"> </span><span class="usertype">less_quad&lt;offset_type&gt;, block_size&gt;</span><span class="normal"> sort_loop_type</span><span class="symbol">;</span>

<span class="normal">        </span><span class="comment">// name (i,t_i,t_{i+1},t_{i+2}) -&gt; (i,n_i)</span>
<span class="normal">        </span><span class="keyword">typedef</span><span class="normal"> naming </span><span class="symbol">&lt;</span><span class="normal">sort_loop_type</span><span class="symbol">&gt;</span><span class="normal"> naming_loop_type</span><span class="symbol">;</span>

<span class="normal">        </span><span class="keyword">typedef</span><span class="normal"> </span><span class="keyword">typename</span><span class="normal"> </span><span class="classname">stream</span><span class="symbol">::</span><span class="normal">runs_creator </span><span class="symbol">&lt;</span><span class="normal">naming_loop_type</span><span class="symbol">,</span><span class="normal"> less_skew</span><span class="symbol">,</span><span class="normal"> block_size</span><span class="symbol">&gt;</span><span class="normal"> rc_loop_type</span><span class="symbol">;</span>

<span class="normal">        </span><span class="comment">// Types for sub problem loop</span>

<span class="normal">        </span><span class="comment">// build suffix array in base case from saved ISA (unique names recursion string)</span>
<span class="normal">        </span><span class="keyword">typedef</span><span class="normal"> build_sa </span><span class="symbol">&lt;</span><span class="normal">offset_array_it_rg</span><span class="symbol">,</span><span class="normal"> offset_array_it_rg</span><span class="symbol">,</span><span class="normal"> offset_array_it_rg</span><span class="symbol">,</span><span class="normal"> block_size</span><span class="symbol">,</span><span class="normal"> ram_use </span><span class="symbol">*</span><span class="normal"> </span><span class="number">3</span><span class="symbol">/</span><span class="normal">memdivA</span><span class="symbol">&gt;</span><span class="normal"> build_sa_type</span><span class="symbol">;</span>

<span class="normal">        </span><span class="comment">// Inverse sa types</span>

<span class="normal">        </span><span class="keyword">typedef</span><span class="normal"> make_pairs </span><span class="symbol">&lt;</span><span class="normal"> counter_stream_type</span><span class="symbol">,</span><span class="normal"> build_sa_type </span><span class="symbol">&gt;</span><span class="normal"> prepare_isa_type</span><span class="symbol">;</span>

<span class="normal">        </span><span class="comment">// Seperate mod1 from mod2 tuples</span>

<span class="normal">        </span><span class="keyword">typedef</span><span class="normal"> </span><span class="keyword">typename</span><span class="normal"> </span><span class="classname">stream</span><span class="symbol">::</span><span class="normal">use_push </span><span class="symbol">&lt;</span><span class="normal"> skew_pair_type </span><span class="symbol">&gt;</span><span class="normal"> isa1_push_type</span><span class="symbol">;</span>
<span class="normal">        </span><span class="keyword">typedef</span><span class="normal"> </span><span class="keyword">typename</span><span class="normal"> </span><span class="classname">stream</span><span class="symbol">::</span><span class="normal">runs_creator </span><span class="symbol">&lt;</span><span class="normal"> isa1_push_type</span><span class="symbol">,</span><span class="normal"> less_pair_2nd</span><span class="symbol">,</span><span class="normal"> block_size</span><span class="symbol">,</span><span class="normal"> RC </span><span class="symbol">&gt;</span><span class="normal"> isa1_rc_type</span><span class="symbol">;</span>
<span class="normal">        </span><span class="keyword">typedef</span><span class="normal"> </span><span class="keyword">typename</span><span class="normal"> </span><span class="classname">isa1_rc_type</span><span class="symbol">::</span><span class="usertype">sorted_runs_type</span><span class="normal"> isa1_sr_type</span><span class="symbol">;</span>
<span class="normal">        </span><span class="keyword">typedef</span><span class="normal"> </span><span class="keyword">typename</span><span class="normal"> </span><span class="classname">stream</span><span class="symbol">::</span><span class="normal">runs_merger </span><span class="symbol">&lt;</span><span class="normal"> isa1_sr_type</span><span class="symbol">,</span><span class="normal"> less_pair_2nd </span><span class="symbol">&gt;</span><span class="normal"> isa1_rm_type</span><span class="symbol">;</span>

<span class="normal">        </span><span class="keyword">typedef</span><span class="normal"> </span><span class="keyword">typename</span><span class="normal"> </span><span class="classname">stream</span><span class="symbol">::</span><span class="normal">use_push </span><span class="symbol">&lt;</span><span class="normal"> skew_pair_type </span><span class="symbol">&gt;</span><span class="normal"> isa2_push_type</span><span class="symbol">;</span>
<span class="normal">        </span><span class="keyword">typedef</span><span class="normal"> </span><span class="keyword">typename</span><span class="normal"> </span><span class="classname">stream</span><span class="symbol">::</span><span class="normal">runs_creator </span><span class="symbol">&lt;</span><span class="normal"> isa2_push_type</span><span class="symbol">,</span><span class="normal"> less_pair_2nd</span><span class="symbol">,</span><span class="normal"> block_size</span><span class="symbol">,</span><span class="normal"> RC </span><span class="symbol">&gt;</span><span class="normal"> isa2_rc_type</span><span class="symbol">;</span>
<span class="normal">        </span><span class="keyword">typedef</span><span class="normal"> </span><span class="keyword">typename</span><span class="normal"> </span><span class="classname">isa2_rc_type</span><span class="symbol">::</span><span class="usertype">sorted_runs_type</span><span class="normal"> isa2_sr_type</span><span class="symbol">;</span>
<span class="normal">        </span><span class="keyword">typedef</span><span class="normal"> </span><span class="keyword">typename</span><span class="normal"> </span><span class="classname">stream</span><span class="symbol">::</span><span class="normal">runs_merger </span><span class="symbol">&lt;</span><span class="normal"> isa2_sr_type</span><span class="symbol">,</span><span class="normal"> less_pair_2nd </span><span class="symbol">&gt;</span><span class="normal"> isa2_rm_type</span><span class="symbol">;</span>

<span class="normal">        </span><span class="comment">// Loop types</span>

<span class="normal">        </span><span class="keyword">typedef</span><span class="normal"> stream</span><span class="symbol">::</span><span class="normal">choose </span><span class="symbol">&lt;</span><span class="normal">isa1_rm_type</span><span class="symbol">,</span><span class="number">1</span><span class="symbol">&gt;</span><span class="normal"> isa1_first_type</span><span class="symbol">;</span>
<span class="normal">        </span><span class="keyword">typedef</span><span class="normal"> stream</span><span class="symbol">::</span><span class="normal">choose </span><span class="symbol">&lt;</span><span class="normal">isa2_rm_type</span><span class="symbol">,</span><span class="number">1</span><span class="symbol">&gt;</span><span class="normal"> isa2_first_type</span><span class="symbol">;</span>
<span class="normal">        </span><span class="keyword">typedef</span><span class="normal"> build_sa </span><span class="symbol">&lt;</span><span class="normal"> offset_array_it_rg</span><span class="symbol">,</span><span class="normal"> isa1_first_type</span><span class="symbol">,</span><span class="normal"> isa2_first_type</span><span class="symbol">,</span><span class="normal"> block_size</span><span class="symbol">,</span><span class="normal"> ram_use </span><span class="symbol">*</span><span class="normal"> </span><span class="number">3</span><span class="symbol">/</span><span class="normal">memdivA</span><span class="symbol">&gt;</span><span class="normal"> build_sa_loop_type</span><span class="symbol">;</span>
<span class="normal">        </span><span class="keyword">typedef</span><span class="normal"> make_pairs </span><span class="symbol">&lt;</span><span class="normal"> counter_stream_type</span><span class="symbol">,</span><span class="normal"> build_sa_loop_type </span><span class="symbol">&gt;</span><span class="normal"> prepare_isa_loop_type</span><span class="symbol">;</span>

<span class="normal">        </span><span class="keyword">typedef</span><span class="normal"> </span><span class="keyword">typename</span><span class="normal"> </span><span class="classname">stream</span><span class="symbol">::</span><span class="normal">use_push </span><span class="symbol">&lt;</span><span class="normal"> skew_pair_type </span><span class="symbol">&gt;</span><span class="normal"> isa_loop_push_type</span><span class="symbol">;</span>
<span class="normal">        </span><span class="keyword">typedef</span><span class="normal"> </span><span class="keyword">typename</span><span class="normal"> </span><span class="classname">stream</span><span class="symbol">::</span><span class="normal">runs_creator </span><span class="symbol">&lt;</span><span class="normal"> isa_loop_push_type</span><span class="symbol">,</span><span class="normal"> less_pair_2nd</span><span class="symbol">,</span><span class="normal"> block_size</span><span class="symbol">,</span><span class="normal"> RC </span><span class="symbol">&gt;</span><span class="normal"> isa_loop_rc_type</span><span class="symbol">;</span>

<span class="normal">        </span><span class="comment">// Variables</span>

<span class="preproc">#if</span><span class="normal"> </span><span class="symbol">!</span><span class="normal">LCP_CALC</span>
<span class="normal">        </span><span class="usertype">build_sa_loop_type</span><span class="normal"> </span><span class="symbol">*</span><span class="normal">out_sa</span><span class="symbol">;</span>
<span class="preproc">#else</span>
<span class="normal">        offset_array_it_rg</span><span class="symbol">*</span><span class="normal"> out_sa</span><span class="symbol">;</span>
<span class="normal">        offset_array_type</span><span class="symbol">*</span><span class="normal"> out_sa_array</span><span class="symbol">;</span>

<span class="normal">        build_lcp</span><span class="symbol">*</span><span class="normal"> out_lcp</span><span class="symbol">;</span>
<span class="preproc">#endif</span>

<span class="normal">        </span><span class="type">bool</span><span class="normal"> finished</span><span class="symbol">;</span>

<span class="normal">        </span><span class="keyword">template</span><span class="normal"> </span><span class="symbol">&lt;</span><span class="keyword">class</span><span class="normal"> </span><span class="classname">Stream</span><span class="symbol">&gt;</span>
<span class="normal">        </span><span class="keyword">static</span><span class="normal"> </span><span class="keyword">inline</span><span class="normal"> </span><span class="type">void</span><span class="normal"> </span><span class="function">print</span><span class="symbol">(</span><span class="normal">Stream</span><span class="symbol">&amp;</span><span class="normal"> s</span><span class="symbol">)</span>
<span class="normal">        </span><span class="cbracket">{</span>
<span class="normal">            </span><span class="keyword">while</span><span class="normal"> </span><span class="symbol">(!</span><span class="normal">s</span><span class="symbol">.</span><span class="function">empty</span><span class="symbol">())</span>
<span class="normal">            </span><span class="cbracket">{</span>
<span class="normal">                std</span><span class="symbol">::</span><span class="normal">cout </span><span class="symbol">&lt;&lt;</span><span class="normal"> </span><span class="symbol">*</span><span class="normal">s </span><span class="symbol">&lt;&lt;</span><span class="normal"> </span><span class="string">"</span><span class="specialchar">\n</span><span class="string">"</span><span class="symbol">;</span>
<span class="normal">                </span><span class="symbol">++</span><span class="normal">s</span><span class="symbol">;</span>
<span class="normal">            </span><span class="cbracket">}</span>
<span class="normal">        </span><span class="cbracket">}</span>

<span class="normal">    </span><span class="keyword">protected</span><span class="symbol">:</span>

<span class="preproc">#if</span><span class="normal"> LCP_CALC</span>
<span class="normal">        </span><span class="keyword">static</span><span class="normal"> build_lcp</span><span class="symbol">*</span><span class="normal"> </span><span class="function">expand_build_lcp</span><span class="symbol">(</span><span class="normal">build_lcp</span><span class="symbol">*</span><span class="normal"> prev_lcp</span><span class="symbol">,</span><span class="normal"> offset_array_type</span><span class="symbol">*</span><span class="normal"> prev_sa</span><span class="symbol">,</span><span class="normal"> </span><span class="usertype">isa1_sr_type</span><span class="normal"> </span><span class="symbol">&amp;</span><span class="normal">isa1_sr</span><span class="symbol">,</span><span class="normal"> isa2_sr_type</span><span class="symbol">&amp;</span><span class="normal"> isa2_sr</span><span class="symbol">,</span>
<span class="normal">                                           uint8_array_type</span><span class="symbol">&amp;</span><span class="normal"> lcp_names</span><span class="symbol">,</span>
<span class="normal">                                           uint8_array_type</span><span class="symbol">*</span><span class="normal"> lcp_base8</span><span class="symbol">,</span><span class="normal"> RMQ</span><span class="symbol">*</span><span class="normal"> lcp_rmq1_ptr</span><span class="symbol">,</span><span class="normal"> skew_pair_array_type</span><span class="symbol">*</span><span class="normal"> lcp_rmq1_ranks  </span><span class="symbol">)</span>
<span class="normal">        </span><span class="cbracket">{</span>
<span class="normal">            </span><span class="function">DBGMEM</span><span class="symbol">(</span><span class="string">"computing RMQs on LCP_R"</span><span class="symbol">);</span>

<span class="normal">            </span><span class="comment">// compute RMQs on recursive LCP array</span>
<span class="normal">            RMQ</span><span class="symbol">&amp;</span><span class="normal"> lcp_rmq1 </span><span class="symbol">=</span><span class="normal"> </span><span class="symbol">*</span><span class="normal">lcp_rmq1_ptr</span><span class="symbol">;</span>
<span class="normal">            prev_lcp</span><span class="symbol">-&gt;</span><span class="function">start_output</span><span class="symbol">(</span><span class="normal">ram_use </span><span class="symbol">/</span><span class="normal"> </span><span class="number">2</span><span class="symbol">);</span>
<span class="normal">            lcp_rmq1</span><span class="symbol">.</span><span class="function">compute</span><span class="symbol">(*</span><span class="normal">prev_lcp</span><span class="symbol">);</span>
<span class="normal">            </span><span class="keyword">delete</span><span class="normal"> prev_lcp</span><span class="symbol">;</span>

<span class="normal">            </span><span class="comment">// read RMQ results: create expanded lcp_next and RMQs on the LCP_lexnames array</span>

<span class="normal">            </span><span class="usertype">skew_pair_array_it_rg</span><span class="normal"> </span><span class="function">rmq1_ranks</span><span class="symbol">(</span><span class="normal">lcp_rmq1_ranks</span><span class="symbol">-&gt;</span><span class="function">begin</span><span class="symbol">(),</span><span class="normal"> lcp_rmq1_ranks</span><span class="symbol">-&gt;</span><span class="function">end</span><span class="symbol">());</span>
<span class="normal">            offset_array_type</span><span class="symbol">*</span><span class="normal"> lcp_next </span><span class="symbol">=</span><span class="normal"> </span><span class="keyword">new</span><span class="normal"> offset_array_type</span><span class="symbol">;</span>

<span class="normal">            lcp_rmq1</span><span class="symbol">.</span><span class="function">start_output</span><span class="symbol">(</span><span class="normal">ram_use </span><span class="symbol">/</span><span class="normal"> </span><span class="number">3</span><span class="symbol">);</span>
<span class="normal">            RMQ</span><span class="symbol">*</span><span class="normal"> lcp_rmq2 </span><span class="symbol">=</span><span class="normal"> </span><span class="keyword">new</span><span class="normal"> </span><span class="function">RMQ</span><span class="symbol">(</span><span class="normal">ram_use </span><span class="symbol">/</span><span class="normal"> </span><span class="number">3</span><span class="symbol">);</span>

<span class="normal">            stxxl</span><span class="symbol">::</span><span class="usertype">sorter&lt;skew_triple_type,less_triple_1st,block_size&gt;</span><span class="normal"> </span><span class="function">SAqueries</span><span class="normal"> </span><span class="symbol">(</span><span class="function">less_triple_1st</span><span class="symbol">(),</span><span class="normal"> ram_use </span><span class="symbol">/</span><span class="normal"> </span><span class="number">3</span><span class="symbol">);</span>

<span class="normal">            </span><span class="comment">// memsize: input stream, rmq1, output: rmq2 and SAqueries</span>
<span class="normal">            </span><span class="cbracket">{</span>
<span class="normal">                </span><span class="usertype">uint8_array_it_rg</span><span class="normal"> </span><span class="function">lcp_base8_stream</span><span class="symbol">(</span><span class="normal">lcp_base8</span><span class="symbol">-&gt;</span><span class="function">begin</span><span class="symbol">(),</span><span class="normal"> lcp_base8</span><span class="symbol">-&gt;</span><span class="function">end</span><span class="symbol">());</span>

<span class="normal">                </span><span class="keyword">for</span><span class="normal"> </span><span class="symbol">(</span><span class="usertype">offset_type</span><span class="normal"> index </span><span class="symbol">=</span><span class="normal"> </span><span class="number">0</span><span class="symbol">;</span><span class="normal"> </span><span class="symbol">!</span><span class="normal">lcp_base8_stream</span><span class="symbol">.</span><span class="function">empty</span><span class="symbol">();</span><span class="normal"> </span><span class="symbol">++</span><span class="normal">index</span><span class="symbol">,</span><span class="normal"> </span><span class="symbol">++</span><span class="normal">lcp_base8_stream</span><span class="symbol">)</span>
<span class="normal">                </span><span class="cbracket">{</span>
<span class="normal">                    </span><span class="usertype">offset_type</span><span class="normal"> lcp </span><span class="symbol">=</span><span class="normal"> </span><span class="symbol">*</span><span class="normal">lcp_base8_stream</span><span class="symbol">;</span>

<span class="normal">                    </span><span class="keyword">if</span><span class="normal"> </span><span class="symbol">(</span><span class="normal"> </span><span class="symbol">!</span><span class="normal">lcp_rmq1</span><span class="symbol">.</span><span class="function">empty</span><span class="symbol">()</span><span class="normal"> </span><span class="symbol">&amp;&amp;</span><span class="normal"> lcp_rmq1</span><span class="symbol">-&gt;</span><span class="normal">first </span><span class="symbol">==</span><span class="normal"> index </span><span class="symbol">)</span><span class="normal"> </span><span class="comment">// RMQ available?</span>
<span class="normal">                    </span><span class="cbracket">{</span>
<span class="normal">                        </span><span class="function">assert</span><span class="symbol">(</span><span class="normal"> </span><span class="symbol">!</span><span class="normal">rmq1_ranks</span><span class="symbol">.</span><span class="function">empty</span><span class="symbol">()</span><span class="normal"> </span><span class="symbol">);</span>

<span class="normal">                        </span><span class="keyword">if</span><span class="normal"> </span><span class="symbol">(</span><span class="normal">lcp_rmq1</span><span class="symbol">-&gt;</span><span class="normal">second </span><span class="symbol">==</span><span class="normal"> </span><span class="function">offset_type</span><span class="symbol">(</span><span class="number">0</span><span class="symbol">))</span><span class="normal"> </span><span class="comment">// RMQ result was 0 -&gt; no lookup on SA/ISA needed</span>
<span class="normal">                        </span><span class="cbracket">{</span>
<span class="normal">                            </span><span class="function">DBG</span><span class="symbol">(</span><span class="normal">debug_lcp_expand</span><span class="symbol">,</span><span class="normal"> </span><span class="string">"next_lcp["</span><span class="normal"> </span><span class="symbol">&lt;&lt;</span><span class="normal"> index </span><span class="symbol">&lt;&lt;</span><span class="normal"> </span><span class="string">"] = "</span><span class="normal"> </span><span class="symbol">&lt;&lt;</span><span class="normal"> lcp </span><span class="symbol">&lt;&lt;</span><span class="normal"> </span><span class="string">" + direct RMQ on ranks "</span><span class="normal"> </span><span class="symbol">&lt;&lt;</span><span class="normal"> </span><span class="symbol">*</span><span class="normal">rmq1_ranks</span><span class="symbol">);</span>
<span class="normal">                            </span><span class="function">assert</span><span class="symbol">(</span><span class="normal">rmq1_ranks</span><span class="symbol">-&gt;</span><span class="normal">first </span><span class="symbol">&lt;=</span><span class="normal"> rmq1_ranks</span><span class="symbol">-&gt;</span><span class="normal">second</span><span class="symbol">);</span>

<span class="normal">                            lcp_rmq2</span><span class="symbol">-&gt;</span><span class="function">query</span><span class="symbol">(</span><span class="normal"> rmq1_ranks</span><span class="symbol">-&gt;</span><span class="normal">first</span><span class="symbol">+</span><span class="number">1</span><span class="symbol">,</span><span class="normal"> rmq1_ranks</span><span class="symbol">-&gt;</span><span class="normal">second</span><span class="symbol">,</span><span class="normal"> index </span><span class="symbol">);</span>
<span class="normal">                        </span><span class="cbracket">}</span>
<span class="normal">                        </span><span class="keyword">else</span>
<span class="normal">                        </span><span class="cbracket">{</span>
<span class="normal">                            lcp </span><span class="symbol">+=</span><span class="normal"> </span><span class="number">3</span><span class="normal"> </span><span class="symbol">*</span><span class="normal"> lcp_rmq1</span><span class="symbol">-&gt;</span><span class="normal">second</span><span class="symbol">;</span><span class="normal">        </span><span class="comment">// add 3 for each matching triple</span>

<span class="normal">                            </span><span class="function">DBG</span><span class="symbol">(</span><span class="normal">debug_lcp_expand</span><span class="symbol">,</span><span class="normal"> </span><span class="string">"next_lcp["</span><span class="normal"> </span><span class="symbol">&lt;&lt;</span><span class="normal"> index </span><span class="symbol">&lt;&lt;</span><span class="normal"> </span><span class="string">"] = "</span><span class="normal"> </span><span class="symbol">&lt;&lt;</span><span class="normal"> lcp </span><span class="symbol">&lt;&lt;</span><span class="normal"> </span><span class="string">" + far RMQ on ISA[SA["</span><span class="normal"> </span><span class="symbol">&lt;&lt;</span><span class="normal"> </span><span class="symbol">*</span><span class="normal">rmq1_ranks </span><span class="symbol">&lt;&lt;</span><span class="normal"> </span><span class="string">"] + "</span><span class="normal"> </span><span class="symbol">&lt;&lt;</span><span class="normal"> lcp_rmq1</span><span class="symbol">-&gt;</span><span class="normal">second </span><span class="symbol">&lt;&lt;</span><span class="normal"> </span><span class="string">"]"</span><span class="symbol">);</span>

<span class="normal">                            SAqueries</span><span class="symbol">.</span><span class="function">push</span><span class="symbol">(</span><span class="normal"> </span><span class="function">skew_triple_type</span><span class="symbol">(</span><span class="normal">rmq1_ranks</span><span class="symbol">-&gt;</span><span class="normal">first</span><span class="symbol">,</span><span class="normal"> lcp_rmq1</span><span class="symbol">-&gt;</span><span class="normal">second</span><span class="symbol">,</span><span class="normal"> index</span><span class="symbol">)</span><span class="normal"> </span><span class="symbol">);</span>
<span class="normal">                            SAqueries</span><span class="symbol">.</span><span class="function">push</span><span class="symbol">(</span><span class="normal"> </span><span class="function">skew_triple_type</span><span class="symbol">(</span><span class="normal">rmq1_ranks</span><span class="symbol">-&gt;</span><span class="normal">second</span><span class="symbol">,</span><span class="normal"> lcp_rmq1</span><span class="symbol">-&gt;</span><span class="normal">second</span><span class="symbol">,</span><span class="normal"> index</span><span class="symbol">)</span><span class="normal"> </span><span class="symbol">);</span>
<span class="normal">                        </span><span class="cbracket">}</span>

<span class="normal">                        </span><span class="symbol">++</span><span class="normal">lcp_rmq1</span><span class="symbol">,</span><span class="normal"> </span><span class="symbol">++</span><span class="normal">rmq1_ranks</span><span class="symbol">;</span>
<span class="normal">                    </span><span class="cbracket">}</span>
<span class="normal">                    </span><span class="keyword">else</span>
<span class="normal">                    </span><span class="cbracket">{</span>
<span class="normal">                        </span><span class="function">DBG</span><span class="symbol">(</span><span class="normal">debug_lcp_expand</span><span class="symbol">,</span><span class="normal"> </span><span class="string">"next_lcp["</span><span class="normal"> </span><span class="symbol">&lt;&lt;</span><span class="normal"> index </span><span class="symbol">&lt;&lt;</span><span class="normal"> </span><span class="string">"] = "</span><span class="normal"> </span><span class="symbol">&lt;&lt;</span><span class="normal"> lcp</span><span class="symbol">);</span>
<span class="normal">                    </span><span class="cbracket">}</span>

<span class="normal">                    lcp_next</span><span class="symbol">-&gt;</span><span class="function">push_back</span><span class="symbol">(</span><span class="normal">lcp</span><span class="symbol">);</span>
<span class="normal">                </span><span class="cbracket">}</span>

<span class="normal">                </span><span class="keyword">delete</span><span class="normal"> lcp_base8</span><span class="symbol">;</span>
<span class="normal">                </span><span class="keyword">delete</span><span class="normal"> lcp_rmq1_ptr</span><span class="symbol">;</span>
<span class="normal">                </span><span class="keyword">delete</span><span class="normal"> lcp_rmq1_ranks</span><span class="symbol">;</span>
<span class="normal">            </span><span class="cbracket">}</span>

<span class="normal">            </span><span class="comment">// *** Answer queries on SA</span>

<span class="normal">            </span><span class="comment">// following processes run with lcp_rmq2 keeping it's memory!</span>
<span class="normal">            SAqueries</span><span class="symbol">.</span><span class="function">sort</span><span class="symbol">(</span><span class="normal">ram_use </span><span class="symbol">/</span><span class="normal"> </span><span class="number">3</span><span class="symbol">);</span>

<span class="normal">            </span><span class="keyword">if</span><span class="normal"> </span><span class="symbol">(</span><span class="normal">SAqueries</span><span class="symbol">.</span><span class="function">size</span><span class="symbol">())</span>
<span class="normal">            </span><span class="cbracket">{</span>
<span class="normal">                </span><span class="comment">// *** Scan saved SA_R and answer queries for SA positions</span>

<span class="normal">                stxxl</span><span class="symbol">::</span><span class="usertype">sorter&lt;skew_pair_type,less_pair_1st,block_size&gt;</span><span class="normal"> </span><span class="function">ISAqueries</span><span class="normal"> </span><span class="symbol">(</span><span class="function">less_pair_1st</span><span class="symbol">(),</span><span class="normal"> ram_use </span><span class="symbol">/</span><span class="normal"> </span><span class="number">3</span><span class="symbol">);</span>

<span class="normal">                </span><span class="usertype">offset_array_it_rg</span><span class="normal"> </span><span class="function">sa</span><span class="symbol">(</span><span class="normal">prev_sa</span><span class="symbol">-&gt;</span><span class="function">begin</span><span class="symbol">(),</span><span class="normal"> prev_sa</span><span class="symbol">-&gt;</span><span class="function">end</span><span class="symbol">());</span>

<span class="normal">                </span><span class="keyword">for</span><span class="normal"> </span><span class="symbol">(</span><span class="usertype">offset_type</span><span class="normal"> index </span><span class="symbol">=</span><span class="normal"> </span><span class="number">0</span><span class="symbol">;</span><span class="normal"> </span><span class="symbol">!</span><span class="normal">sa</span><span class="symbol">.</span><span class="function">empty</span><span class="symbol">()</span><span class="normal"> </span><span class="symbol">&amp;&amp;</span><span class="normal"> </span><span class="symbol">!</span><span class="normal">SAqueries</span><span class="symbol">.</span><span class="function">empty</span><span class="symbol">();</span><span class="normal"> </span><span class="symbol">++</span><span class="normal">index</span><span class="symbol">,</span><span class="normal"> </span><span class="symbol">++</span><span class="normal">sa</span><span class="symbol">)</span>
<span class="normal">                </span><span class="cbracket">{</span>
<span class="normal">                    </span><span class="function">DBG</span><span class="symbol">(</span><span class="normal">debug_lcp_expand</span><span class="symbol">,</span><span class="normal"> </span><span class="string">"SA["</span><span class="normal"> </span><span class="symbol">&lt;&lt;</span><span class="normal"> index </span><span class="symbol">&lt;&lt;</span><span class="normal"> </span><span class="string">"] = "</span><span class="normal"> </span><span class="symbol">&lt;&lt;</span><span class="normal"> </span><span class="symbol">*</span><span class="normal">sa</span><span class="symbol">);</span>
<span class="normal">                    </span><span class="keyword">while</span><span class="normal"> </span><span class="symbol">(</span><span class="normal"> </span><span class="symbol">!</span><span class="normal">SAqueries</span><span class="symbol">.</span><span class="function">empty</span><span class="symbol">()</span><span class="normal"> </span><span class="symbol">&amp;&amp;</span><span class="normal"> SAqueries</span><span class="symbol">-&gt;</span><span class="normal">first </span><span class="symbol">==</span><span class="normal"> index </span><span class="symbol">)</span>
<span class="normal">                    </span><span class="cbracket">{</span>
<span class="normal">                        </span><span class="function">DBG</span><span class="symbol">(</span><span class="normal">debug_lcp_expand</span><span class="symbol">,</span><span class="normal"> </span><span class="string">"Matching SA["</span><span class="normal"> </span><span class="symbol">&lt;&lt;</span><span class="normal"> index </span><span class="symbol">&lt;&lt;</span><span class="normal"> </span><span class="string">"] query with "</span><span class="normal"> </span><span class="symbol">&lt;&lt;</span><span class="normal"> </span><span class="symbol">*</span><span class="normal">sa </span><span class="symbol">&lt;&lt;</span><span class="normal"> </span><span class="string">" + "</span><span class="normal"> </span><span class="symbol">&lt;&lt;</span><span class="normal"> SAqueries</span><span class="symbol">-&gt;</span><span class="normal">second </span><span class="symbol">&lt;&lt;</span><span class="normal"> </span><span class="string">" for target "</span><span class="normal"> </span><span class="symbol">&lt;&lt;</span><span class="normal"> SAqueries</span><span class="symbol">-&gt;</span><span class="normal">third</span><span class="symbol">);</span>
<span class="normal">                        ISAqueries</span><span class="symbol">.</span><span class="function">push</span><span class="symbol">(</span><span class="normal"> </span><span class="function">skew_pair_type</span><span class="symbol">(*</span><span class="normal">sa </span><span class="symbol">+</span><span class="normal"> SAqueries</span><span class="symbol">-&gt;</span><span class="normal">second</span><span class="symbol">,</span><span class="normal"> SAqueries</span><span class="symbol">-&gt;</span><span class="normal">third</span><span class="symbol">)</span><span class="normal"> </span><span class="symbol">);</span>
<span class="normal">                        </span><span class="symbol">++</span><span class="normal">SAqueries</span><span class="symbol">;</span>
<span class="normal">                    </span><span class="cbracket">}</span>
<span class="normal">                </span><span class="cbracket">}</span>

<span class="normal">                </span><span class="function">assert</span><span class="symbol">(</span><span class="normal"> SAqueries</span><span class="symbol">.</span><span class="function">empty</span><span class="symbol">()</span><span class="normal"> </span><span class="symbol">);</span>
<span class="normal">                SAqueries</span><span class="symbol">.</span><span class="function">finish_clear</span><span class="symbol">();</span>
<span class="normal">                </span><span class="keyword">delete</span><span class="normal"> prev_sa</span><span class="symbol">;</span>

<span class="normal">                </span><span class="comment">// *** answer queries on ISA by reading SA again</span>

<span class="normal">                stxxl</span><span class="symbol">::</span><span class="usertype">sorter&lt;skew_pair_type,less_pair_1st,block_size&gt;</span><span class="normal"> </span><span class="function">ISAanswers</span><span class="normal"> </span><span class="symbol">(</span><span class="function">less_pair_1st</span><span class="symbol">(),</span><span class="normal"> ram_use </span><span class="symbol">*</span><span class="normal"> </span><span class="number">2</span><span class="symbol">/</span><span class="number">9</span><span class="symbol">);</span>
<span class="normal">                ISAqueries</span><span class="symbol">.</span><span class="function">sort</span><span class="symbol">(</span><span class="normal">ram_use </span><span class="symbol">*</span><span class="normal"> </span><span class="number">2</span><span class="symbol">/</span><span class="number">9</span><span class="symbol">);</span>

<span class="normal">                </span><span class="keyword">for</span><span class="normal"> </span><span class="symbol">(</span><span class="usertype">isa1_rm_type</span><span class="normal"> </span><span class="function">isa1_rm</span><span class="symbol">(</span><span class="normal">isa1_sr</span><span class="symbol">,</span><span class="normal"> </span><span class="function">less_pair_2nd</span><span class="symbol">(),</span><span class="normal"> ram_use </span><span class="symbol">*</span><span class="normal"> </span><span class="number">2</span><span class="symbol">/</span><span class="number">9</span><span class="symbol">);</span>
<span class="normal">                     </span><span class="symbol">!</span><span class="normal">isa1_rm</span><span class="symbol">.</span><span class="function">empty</span><span class="symbol">()</span><span class="normal"> </span><span class="symbol">&amp;&amp;</span><span class="normal"> </span><span class="symbol">!</span><span class="normal">ISAqueries</span><span class="symbol">.</span><span class="function">empty</span><span class="symbol">();</span><span class="normal"> </span><span class="symbol">++</span><span class="normal">isa1_rm</span><span class="symbol">)</span>
<span class="normal">                </span><span class="cbracket">{</span>
<span class="normal">                    </span><span class="function">DBG</span><span class="symbol">(</span><span class="normal">debug_lcp_expand</span><span class="symbol">,</span><span class="normal"> </span><span class="string">"ISA1: "</span><span class="normal"> </span><span class="symbol">&lt;&lt;</span><span class="normal"> </span><span class="symbol">*</span><span class="normal">isa1_rm</span><span class="symbol">);</span>

<span class="normal">                    </span><span class="keyword">while</span><span class="normal"> </span><span class="symbol">(</span><span class="normal"> </span><span class="symbol">!</span><span class="normal">ISAqueries</span><span class="symbol">.</span><span class="function">empty</span><span class="symbol">()</span><span class="normal"> </span><span class="symbol">&amp;&amp;</span><span class="normal"> ISAqueries</span><span class="symbol">-&gt;</span><span class="normal">first </span><span class="symbol">==</span><span class="normal"> isa1_rm</span><span class="symbol">-&gt;</span><span class="normal">second </span><span class="symbol">)</span>
<span class="normal">                    </span><span class="cbracket">{</span>
<span class="normal">                        </span><span class="function">DBG</span><span class="symbol">(</span><span class="normal">debug_lcp_expand</span><span class="symbol">,</span><span class="normal"> </span><span class="string">"Matching ISA["</span><span class="normal"> </span><span class="symbol">&lt;&lt;</span><span class="normal"> ISAqueries</span><span class="symbol">-&gt;</span><span class="normal">first </span><span class="symbol">&lt;&lt;</span><span class="normal"> </span><span class="string">"] query for target "</span><span class="normal"> </span><span class="symbol">&lt;&lt;</span><span class="normal"> ISAqueries</span><span class="symbol">-&gt;</span><span class="normal">second </span><span class="symbol">&lt;&lt;</span><span class="normal"> </span><span class="string">" with "</span><span class="normal"> </span><span class="symbol">&lt;&lt;</span><span class="normal"> isa1_rm</span><span class="symbol">-&gt;</span><span class="normal">first</span><span class="symbol">);</span>
<span class="normal">                        ISAanswers</span><span class="symbol">.</span><span class="function">push</span><span class="symbol">(</span><span class="normal"> </span><span class="function">skew_pair_type</span><span class="symbol">(</span><span class="normal">ISAqueries</span><span class="symbol">-&gt;</span><span class="normal">second</span><span class="symbol">,</span><span class="normal"> isa1_rm</span><span class="symbol">-&gt;</span><span class="normal">first</span><span class="symbol">)</span><span class="normal"> </span><span class="symbol">);</span>
<span class="normal">                        </span><span class="symbol">++</span><span class="normal">ISAqueries</span><span class="symbol">;</span>
<span class="normal">                    </span><span class="cbracket">}</span>
<span class="normal">                </span><span class="cbracket">}</span>

<span class="normal">                </span><span class="keyword">for</span><span class="normal"> </span><span class="symbol">(</span><span class="usertype">isa2_rm_type</span><span class="normal"> </span><span class="function">isa2_rm</span><span class="symbol">(</span><span class="normal">isa2_sr</span><span class="symbol">,</span><span class="normal"> </span><span class="function">less_pair_2nd</span><span class="symbol">(),</span><span class="normal"> ram_use </span><span class="symbol">*</span><span class="normal"> </span><span class="number">2</span><span class="symbol">/</span><span class="number">9</span><span class="symbol">);</span>
<span class="normal">                     </span><span class="symbol">!</span><span class="normal">isa2_rm</span><span class="symbol">.</span><span class="function">empty</span><span class="symbol">()</span><span class="normal"> </span><span class="symbol">&amp;&amp;</span><span class="normal"> </span><span class="symbol">!</span><span class="normal">ISAqueries</span><span class="symbol">.</span><span class="function">empty</span><span class="symbol">();</span><span class="normal"> </span><span class="symbol">++</span><span class="normal">isa2_rm</span><span class="symbol">)</span>
<span class="normal">                </span><span class="cbracket">{</span>
<span class="normal">                    </span><span class="function">DBG</span><span class="symbol">(</span><span class="normal">debug_lcp_expand</span><span class="symbol">,</span><span class="normal"> </span><span class="string">"ISA2: "</span><span class="normal"> </span><span class="symbol">&lt;&lt;</span><span class="normal"> </span><span class="symbol">*</span><span class="normal">isa2_rm</span><span class="symbol">);</span>

<span class="normal">                    </span><span class="keyword">while</span><span class="normal"> </span><span class="symbol">(</span><span class="normal"> </span><span class="symbol">!</span><span class="normal">ISAqueries</span><span class="symbol">.</span><span class="function">empty</span><span class="symbol">()</span><span class="normal"> </span><span class="symbol">&amp;&amp;</span><span class="normal"> ISAqueries</span><span class="symbol">-&gt;</span><span class="normal">first </span><span class="symbol">==</span><span class="normal"> isa2_rm</span><span class="symbol">-&gt;</span><span class="normal">second </span><span class="symbol">)</span>
<span class="normal">                    </span><span class="cbracket">{</span>
<span class="normal">                        </span><span class="function">DBG</span><span class="symbol">(</span><span class="normal">debug_lcp_expand</span><span class="symbol">,</span><span class="normal"> </span><span class="string">"Matching ISA["</span><span class="normal"> </span><span class="symbol">&lt;&lt;</span><span class="normal"> ISAqueries</span><span class="symbol">-&gt;</span><span class="normal">first </span><span class="symbol">&lt;&lt;</span><span class="normal"> </span><span class="string">"] query for target "</span><span class="normal"> </span><span class="symbol">&lt;&lt;</span><span class="normal"> ISAqueries</span><span class="symbol">-&gt;</span><span class="normal">second </span><span class="symbol">&lt;&lt;</span><span class="normal"> </span><span class="string">" with "</span><span class="normal"> </span><span class="symbol">&lt;&lt;</span><span class="normal"> isa2_rm</span><span class="symbol">-&gt;</span><span class="normal">first</span><span class="symbol">);</span>
<span class="normal">                        ISAanswers</span><span class="symbol">.</span><span class="function">push</span><span class="symbol">(</span><span class="normal"> </span><span class="function">skew_pair_type</span><span class="symbol">(</span><span class="normal">ISAqueries</span><span class="symbol">-&gt;</span><span class="normal">second</span><span class="symbol">,</span><span class="normal"> isa2_rm</span><span class="symbol">-&gt;</span><span class="normal">first</span><span class="symbol">)</span><span class="normal"> </span><span class="symbol">);</span>
<span class="normal">                        </span><span class="symbol">++</span><span class="normal">ISAqueries</span><span class="symbol">;</span>
<span class="normal">                    </span><span class="cbracket">}</span>
<span class="normal">                </span><span class="cbracket">}</span>

<span class="normal">                </span><span class="keyword">while</span><span class="normal"> </span><span class="symbol">(</span><span class="normal"> </span><span class="symbol">!</span><span class="normal">ISAqueries</span><span class="symbol">.</span><span class="function">empty</span><span class="symbol">()</span><span class="normal"> </span><span class="symbol">)</span>
<span class="normal">                </span><span class="cbracket">{</span>
<span class="normal">                    </span><span class="function">DBG</span><span class="symbol">(</span><span class="normal">debug_lcp_expand</span><span class="symbol">,</span><span class="normal"> </span><span class="string">"Out-of-bounds ISA["</span><span class="normal"> </span><span class="symbol">&lt;&lt;</span><span class="normal"> ISAqueries</span><span class="symbol">-&gt;</span><span class="normal">first </span><span class="symbol">&lt;&lt;</span><span class="normal"> </span><span class="string">"] query for target "</span><span class="normal"> </span><span class="symbol">&lt;&lt;</span><span class="normal"> ISAqueries</span><span class="symbol">-&gt;</span><span class="normal">second </span><span class="symbol">&lt;&lt;</span><span class="normal"> </span><span class="string">" with "</span><span class="symbol">);</span>
<span class="normal">                    </span><span class="symbol">++</span><span class="normal">ISAqueries</span><span class="symbol">;</span>
<span class="normal">                </span><span class="cbracket">}</span>

<span class="normal">                </span><span class="function">assert</span><span class="symbol">(</span><span class="normal"> ISAqueries</span><span class="symbol">.</span><span class="function">empty</span><span class="symbol">()</span><span class="normal"> </span><span class="symbol">);</span>
<span class="normal">                ISAqueries</span><span class="symbol">.</span><span class="function">finish_clear</span><span class="symbol">();</span>

<span class="normal">                </span><span class="comment">// *** collect answers from ISA and prepare RMQ on LCP_N</span>

<span class="normal">                ISAanswers</span><span class="symbol">.</span><span class="function">sort</span><span class="symbol">(</span><span class="normal">ram_use </span><span class="symbol">/</span><span class="normal"> </span><span class="number">3</span><span class="symbol">);</span>

<span class="normal">                </span><span class="keyword">while</span><span class="normal"> </span><span class="symbol">(</span><span class="normal"> </span><span class="symbol">!</span><span class="normal">ISAanswers</span><span class="symbol">.</span><span class="function">empty</span><span class="symbol">()</span><span class="normal"> </span><span class="symbol">)</span>
<span class="normal">                </span><span class="cbracket">{</span>
<span class="normal">                    </span><span class="usertype">skew_pair_type</span><span class="normal"> p1 </span><span class="symbol">=</span><span class="normal"> </span><span class="symbol">*</span><span class="normal">ISAanswers</span><span class="symbol">;</span><span class="normal"> </span><span class="symbol">++</span><span class="normal">ISAanswers</span><span class="symbol">;</span>

<span class="normal">                    </span><span class="keyword">if</span><span class="normal"> </span><span class="symbol">(</span><span class="normal"> ISAanswers</span><span class="symbol">.</span><span class="function">empty</span><span class="symbol">()</span><span class="normal"> </span><span class="symbol">||</span><span class="normal"> ISAanswers</span><span class="symbol">-&gt;</span><span class="normal">first </span><span class="symbol">!=</span><span class="normal"> p1</span><span class="symbol">.</span><span class="normal">first </span><span class="symbol">)</span>
<span class="normal">                    </span><span class="cbracket">{</span>
<span class="normal">                        </span><span class="function">DBG</span><span class="symbol">(</span><span class="normal">debug_lcp_expand</span><span class="symbol">,</span><span class="normal"> </span><span class="string">"Discarding out-of-bounds RMQ("</span><span class="normal"> </span><span class="symbol">&lt;&lt;</span><span class="normal"> p1</span><span class="symbol">.</span><span class="normal">second </span><span class="symbol">&lt;&lt;</span><span class="normal"> </span><span class="string">"+1,?) -&gt; target "</span><span class="normal"> </span><span class="symbol">&lt;&lt;</span><span class="normal"> p1</span><span class="symbol">.</span><span class="normal">first</span><span class="symbol">);</span>
<span class="normal">                        </span><span class="keyword">continue</span><span class="symbol">;</span>
<span class="normal">                    </span><span class="cbracket">}</span>

<span class="normal">                    </span><span class="usertype">skew_pair_type</span><span class="normal"> p2 </span><span class="symbol">=</span><span class="normal"> </span><span class="symbol">*</span><span class="normal">ISAanswers</span><span class="symbol">;</span><span class="normal"> </span><span class="symbol">++</span><span class="normal">ISAanswers</span><span class="symbol">;</span>
<span class="normal">                    </span><span class="function">assert</span><span class="symbol">(</span><span class="normal"> p1</span><span class="symbol">.</span><span class="normal">first </span><span class="symbol">==</span><span class="normal"> p2</span><span class="symbol">.</span><span class="normal">first </span><span class="symbol">);</span>

<span class="normal">                    </span><span class="keyword">if</span><span class="normal"> </span><span class="symbol">(</span><span class="normal">p1</span><span class="symbol">.</span><span class="normal">second </span><span class="symbol">&gt;</span><span class="normal"> p2</span><span class="symbol">.</span><span class="normal">second</span><span class="symbol">)</span><span class="normal"> std</span><span class="symbol">::</span><span class="function">swap</span><span class="symbol">(</span><span class="normal">p1</span><span class="symbol">.</span><span class="normal">second</span><span class="symbol">,</span><span class="normal"> p2</span><span class="symbol">.</span><span class="normal">second</span><span class="symbol">);</span>

<span class="normal">                    </span><span class="function">DBG</span><span class="symbol">(</span><span class="normal">debug_lcp_expand</span><span class="symbol">,</span><span class="normal"> </span><span class="string">"Matching for RMQ("</span><span class="normal"> </span><span class="symbol">&lt;&lt;</span><span class="normal"> p1</span><span class="symbol">.</span><span class="normal">second </span><span class="symbol">&lt;&lt;</span><span class="normal"> </span><span class="string">"+1,"</span><span class="normal"> </span><span class="symbol">&lt;&lt;</span><span class="normal"> p2</span><span class="symbol">.</span><span class="normal">second </span><span class="symbol">&lt;&lt;</span><span class="normal"> </span><span class="string">") -&gt; target "</span><span class="normal"> </span><span class="symbol">&lt;&lt;</span><span class="normal"> p1</span><span class="symbol">.</span><span class="normal">first</span><span class="symbol">);</span>

<span class="normal">                    lcp_rmq2</span><span class="symbol">-&gt;</span><span class="function">query</span><span class="symbol">(</span><span class="normal"> p1</span><span class="symbol">.</span><span class="normal">second</span><span class="symbol">+</span><span class="number">1</span><span class="symbol">,</span><span class="normal"> p2</span><span class="symbol">.</span><span class="normal">second</span><span class="symbol">,</span><span class="normal"> p1</span><span class="symbol">.</span><span class="normal">first </span><span class="symbol">);</span>
<span class="normal">                </span><span class="cbracket">}</span>
<span class="normal">            </span><span class="cbracket">}</span>

<span class="normal">            </span><span class="function">DBGMEM</span><span class="symbol">(</span><span class="string">"done"</span><span class="symbol">);</span>

<span class="normal">            </span><span class="comment">// Prepare LCP calculation from RMQs and LCP_lexnames</span>

<span class="normal">            </span><span class="comment">// build_lcp takes ownership of lcp_next and lcp_rmq2</span>
<span class="normal">            </span><span class="keyword">return</span><span class="normal"> </span><span class="keyword">new</span><span class="normal"> </span><span class="function">build_lcp</span><span class="symbol">(</span><span class="normal">lcp_next</span><span class="symbol">,</span><span class="normal"> lcp_rmq2</span><span class="symbol">,</span><span class="normal"> lcp_names</span><span class="symbol">);</span>
<span class="normal">        </span><span class="cbracket">}</span>
<span class="preproc">#endif</span><span class="normal"> </span><span class="comment">// LCP_CALC</span>

<span class="normal">    </span><span class="keyword">public</span><span class="symbol">:</span>
<span class="normal">        </span><span class="function">algorithm</span><span class="symbol">(</span><span class="normal">Input </span><span class="symbol">&amp;</span><span class="normal"> data_in</span><span class="symbol">)</span>
<span class="normal">            </span><span class="symbol">:</span><span class="normal"> </span><span class="function">finished</span><span class="symbol">(</span><span class="keyword">false</span><span class="symbol">)</span>
<span class="normal">        </span><span class="cbracket">{</span>
<span class="normal">            </span><span class="comment">// store intermediate STXXL-vectors</span>
<span class="normal">            </span><span class="keyword">typename</span><span class="normal"> </span><span class="classname">std</span><span class="symbol">::</span><span class="usertype">vector&lt;offset_array_type *&gt;</span><span class="normal"> vectors</span><span class="symbol">;</span>

<span class="preproc">#if</span><span class="normal"> LCP_CALC</span>
<span class="normal">            </span><span class="keyword">typename</span><span class="normal"> </span><span class="classname">std</span><span class="symbol">::</span><span class="usertype">vector&lt;uint8_array_type *&gt;</span><span class="normal"> lcp_name_vectors</span><span class="symbol">;</span>
<span class="preproc">#endif</span><span class="normal"> </span><span class="comment">// LCP_CALC</span>

<span class="normal">            </span><span class="comment">/**</span>
<span class="comment">             * Steps for building 2/3 arrays for the subproblem:</span>
<span class="comment">             * 1) Build quads </span><span class="keyword">&lt;index</span><span class="normal">,*,*,*</span><span class="keyword">&gt;</span><span class="comment">. The last three components are the characters, beginning at index.</span>
<span class="comment">             *    Store the incomming elements into a vector. Do not forget special cases.</span>
<span class="comment">             * 2) Drop the elements at positions (index modulo 3 = 0).</span>
<span class="comment">             * 3) Sort the elements in respect to the last three components (lex. order).</span>
<span class="comment">             * 4) Scann throught the elements and give to each a discarding compatible names and check for uniqueness.</span>
<span class="comment">             * 5) Sort the elements in respect to the index.</span>
<span class="comment">             * 6) Do the 1-5 within a loop, until the names are unique.</span>
<span class="comment">             * -mehnert</span>
<span class="comment">             */</span>

<span class="normal">            vectors</span><span class="symbol">.</span><span class="function">push_back</span><span class="symbol">(</span><span class="keyword">new</span><span class="normal"> offset_array_type</span><span class="symbol">);</span><span class="normal">           </span><span class="comment">// to store current S</span>
<span class="preproc">#if</span><span class="normal"> LCP_CALC</span>
<span class="normal">            lcp_name_vectors</span><span class="symbol">.</span><span class="function">push_back</span><span class="symbol">(</span><span class="keyword">new</span><span class="normal"> uint8_array_type</span><span class="symbol">);</span><span class="normal">       </span><span class="comment">// to store lcp array of lexname</span>
<span class="preproc">#endif</span><span class="normal"> </span><span class="comment">// LCP_CALC</span>

<span class="normal">            </span><span class="function">DBG</span><span class="symbol">(</span><span class="normal">debug</span><span class="symbol">,</span><span class="normal"> </span><span class="string">"Lexnaming input in depth 0"</span><span class="symbol">);</span>

<span class="normal">            </span><span class="comment">// (t_i) -&gt; (i,t_i)</span>
<span class="normal">            </span><span class="usertype">counter_stream_type</span><span class="normal"> dummy</span><span class="symbol">;</span>
<span class="normal">            </span><span class="usertype">make_pairs_input_type</span><span class="normal"> </span><span class="function">pairs_input</span><span class="symbol">(</span><span class="normal">dummy</span><span class="symbol">,</span><span class="normal"> data_in</span><span class="symbol">);</span>

<span class="normal">            </span><span class="comment">// (t_i) -&gt; (i,t_i,t_{i+1},t_{i+2})</span>
<span class="normal">            </span><span class="usertype">make_quads_input_type</span><span class="normal"> </span><span class="function">quads_input</span><span class="symbol">(</span><span class="normal">pairs_input</span><span class="symbol">,</span><span class="normal"> </span><span class="symbol">*</span><span class="normal">vectors</span><span class="symbol">.</span><span class="function">back</span><span class="symbol">());</span>

<span class="normal">            </span><span class="comment">// (t_i) -&gt; (i,t_i,t_{i+1},t_{i+2}) with i = 1,2 mod 3</span>
<span class="normal">            </span><span class="usertype">mod12_quads_input_type</span><span class="normal"> </span><span class="function">mod12_quads_input</span><span class="symbol">(</span><span class="normal">quads_input</span><span class="symbol">);</span>

<span class="normal">            </span><span class="comment">// sort (i,t_i,t_{i+1},t_{i+2}) by (t_i,t_{i+1},t_{i+2})</span>
<span class="normal">            </span><span class="usertype">sort_mod12_input_type</span><span class="normal"> </span><span class="function">sort_mod12_input</span><span class="symbol">(</span><span class="normal">mod12_quads_input</span><span class="symbol">,</span><span class="normal"> less_quad</span><span class="symbol">&lt;</span><span class="normal">offset_type</span><span class="symbol">&gt;(),</span><span class="normal"> ram_use</span><span class="symbol">,</span><span class="normal"> ram_use </span><span class="symbol">/</span><span class="normal"> </span><span class="number">2</span><span class="symbol">);</span>

<span class="normal">            </span><span class="comment">// name (i,t_i,t_{i+1},t_{i+2}) -&gt; (i,n_i)</span>
<span class="normal">            </span><span class="type">bool</span><span class="normal"> unique </span><span class="symbol">=</span><span class="normal"> </span><span class="keyword">false</span><span class="symbol">;</span><span class="normal">        </span><span class="comment">// ist the current quad array unique ?</span>
<span class="preproc">#if</span><span class="normal"> </span><span class="symbol">!</span><span class="normal">LCP_CALC</span>
<span class="normal">            </span><span class="usertype">naming_input_type</span><span class="normal"> </span><span class="function">names_input</span><span class="symbol">(</span><span class="normal">sort_mod12_input</span><span class="symbol">,</span><span class="normal"> unique</span><span class="symbol">);</span>
<span class="preproc">#else</span><span class="normal"> </span><span class="comment">// LCP_CALC</span>
<span class="normal">            </span><span class="usertype">naming_input_type</span><span class="normal"> </span><span class="function">names_input</span><span class="symbol">(</span><span class="normal">sort_mod12_input</span><span class="symbol">,</span><span class="normal"> </span><span class="symbol">*</span><span class="normal">lcp_name_vectors</span><span class="symbol">.</span><span class="function">back</span><span class="symbol">(),</span><span class="normal"> unique</span><span class="symbol">);</span>
<span class="preproc">#endif</span><span class="normal"> </span><span class="comment">// LCP_CALC</span>

<span class="normal">            </span><span class="usertype">rc_order_type</span><span class="normal"> </span><span class="symbol">*</span><span class="normal">resume_order_rc </span><span class="symbol">=</span><span class="normal"> </span><span class="keyword">new</span><span class="normal"> </span><span class="function">rc_order_type</span><span class="symbol">(</span><span class="normal">names_input</span><span class="symbol">,</span><span class="normal"> </span><span class="function">less_skew</span><span class="symbol">(),</span><span class="normal"> ram_use </span><span class="symbol">/</span><span class="normal"> </span><span class="number">2</span><span class="symbol">);</span>
<span class="normal">            </span><span class="usertype">rm_order_type</span><span class="normal"> </span><span class="symbol">*</span><span class="normal">resume_order_rm </span><span class="symbol">=</span><span class="normal"> </span><span class="keyword">new</span><span class="normal"> </span><span class="function">rm_order_type</span><span class="symbol">(</span><span class="normal">resume_order_rc</span><span class="symbol">-&gt;</span><span class="function">result</span><span class="symbol">(),</span><span class="normal"> </span><span class="function">less_skew</span><span class="symbol">(),</span><span class="normal"> ram_use </span><span class="symbol">/</span><span class="normal"> </span><span class="number">2</span><span class="symbol">);</span>
<span class="normal">            </span><span class="usertype">rc_loop_type</span><span class="normal"> </span><span class="symbol">*</span><span class="normal">loop_order_rc </span><span class="symbol">=</span><span class="normal"> NULL</span><span class="symbol">;</span>

<span class="normal">            </span><span class="function">DBGMEM</span><span class="symbol">(</span><span class="string">"First naming done"</span><span class="symbol">);</span>

<span class="normal">            </span><span class="comment">/** loop for building the skew data */</span>

<span class="normal">            </span><span class="usertype">size_t</span><span class="normal"> depth </span><span class="symbol">=</span><span class="normal"> </span><span class="number">0</span><span class="symbol">;</span>

<span class="normal">            </span><span class="keyword">while</span><span class="normal"> </span><span class="symbol">(!</span><span class="normal">unique</span><span class="symbol">)</span>
<span class="normal">            </span><span class="cbracket">{</span>
<span class="normal">                </span><span class="function">DBG</span><span class="symbol">(</span><span class="normal">debug</span><span class="symbol">,</span><span class="normal"> </span><span class="string">"Lexnaming "</span><span class="normal"> </span><span class="symbol">&lt;&lt;</span><span class="normal"> resume_order_rm</span><span class="symbol">-&gt;</span><span class="function">size</span><span class="symbol">()</span><span class="normal"> </span><span class="symbol">&lt;&lt;</span><span class="normal"> </span><span class="string">" triples in depth "</span><span class="normal"> </span><span class="symbol">&lt;&lt;</span><span class="normal"> </span><span class="symbol">++</span><span class="normal">depth</span><span class="symbol">);</span>

<span class="normal">                vectors</span><span class="symbol">.</span><span class="function">push_back</span><span class="symbol">(</span><span class="keyword">new</span><span class="normal"> offset_array_type</span><span class="symbol">);</span><span class="normal">           </span><span class="comment">// to store current S</span>
<span class="preproc">#if</span><span class="normal"> LCP_CALC</span>
<span class="normal">                lcp_name_vectors</span><span class="symbol">.</span><span class="function">push_back</span><span class="symbol">(</span><span class="keyword">new</span><span class="normal"> uint8_array_type</span><span class="symbol">);</span><span class="normal">   </span><span class="comment">// to store lcp array of lexname</span>
<span class="preproc">#endif</span><span class="normal"> </span><span class="comment">// LCP_CALC</span>

<span class="normal">                </span><span class="comment">// If we cross the border from mod1 tuples to mod2 tuples give the last two tuples</span>
<span class="normal">                </span><span class="comment">// the right name !!!!!!!!!!!! -mehnert</span>

<span class="normal">                </span><span class="comment">// (t_i) -&gt; (i,t_i,t_{i+1},t_{i+2}) with recursive text</span>
<span class="normal">                </span><span class="usertype">make_quads_loop_type</span><span class="normal"> </span><span class="function">quads_loop</span><span class="symbol">(*</span><span class="normal">resume_order_rm</span><span class="symbol">,</span><span class="normal"> </span><span class="symbol">*</span><span class="normal">vectors</span><span class="symbol">.</span><span class="function">back</span><span class="symbol">());</span>

<span class="normal">                </span><span class="comment">// (t_i) -&gt; (i,t_i,t_{i+1},t_{i+2}) with i = 1,2 mod 3</span>
<span class="normal">                </span><span class="usertype">mod12_quads_loop_type</span><span class="normal"> </span><span class="function">mod12_quads_loop</span><span class="symbol">(</span><span class="normal">quads_loop</span><span class="symbol">);</span>

<span class="normal">                </span><span class="comment">// sort (i,t_i,t_{i+1},t_{i+2}) by (t_i,t_{i+1},t_{i+2})</span>
<span class="normal">                </span><span class="usertype">sort_loop_type</span><span class="normal"> </span><span class="function">sort_quads_loop</span><span class="symbol">(</span><span class="normal">mod12_quads_loop</span><span class="symbol">,</span><span class="normal"> less_quad</span><span class="symbol">&lt;</span><span class="normal">offset_type</span><span class="symbol">&gt;(),</span><span class="normal"> ram_use </span><span class="symbol">/</span><span class="normal"> </span><span class="number">2</span><span class="symbol">);</span>

<span class="normal">                </span><span class="keyword">if</span><span class="normal"> </span><span class="symbol">(</span><span class="normal">resume_order_rc </span><span class="symbol">!=</span><span class="normal"> NULL</span><span class="symbol">)</span><span class="normal"> </span><span class="cbracket">{</span>
<span class="normal">                    </span><span class="keyword">delete</span><span class="normal"> resume_order_rc</span><span class="symbol">;</span><span class="normal"> resume_order_rc </span><span class="symbol">=</span><span class="normal"> NULL</span><span class="symbol">;</span>
<span class="normal">                </span><span class="cbracket">}</span>
<span class="normal">                </span><span class="keyword">if</span><span class="normal"> </span><span class="symbol">(</span><span class="normal">loop_order_rc </span><span class="symbol">!=</span><span class="normal"> NULL</span><span class="symbol">)</span><span class="normal"> </span><span class="cbracket">{</span>
<span class="normal">                    </span><span class="keyword">delete</span><span class="normal"> loop_order_rc</span><span class="symbol">;</span><span class="normal"> loop_order_rc </span><span class="symbol">=</span><span class="normal"> NULL</span><span class="symbol">;</span>
<span class="normal">                </span><span class="cbracket">}</span>

<span class="normal">                </span><span class="comment">// name (i,t_i,t_{i+1},t_{i+2}) -&gt; (i,n_i)</span>
<span class="preproc">#if</span><span class="normal"> </span><span class="symbol">!</span><span class="normal">LCP_CALC</span>
<span class="normal">                </span><span class="usertype">naming_loop_type</span><span class="normal"> </span><span class="function">name_quads_loop</span><span class="symbol">(</span><span class="normal">sort_quads_loop</span><span class="symbol">,</span><span class="normal"> unique</span><span class="symbol">);</span>
<span class="preproc">#else</span><span class="normal"> </span><span class="comment">// LCP_CALC</span>
<span class="normal">                </span><span class="usertype">naming_loop_type</span><span class="normal"> </span><span class="function">name_quads_loop</span><span class="symbol">(</span><span class="normal">sort_quads_loop</span><span class="symbol">,</span><span class="normal"> </span><span class="symbol">*</span><span class="normal">lcp_name_vectors</span><span class="symbol">.</span><span class="function">back</span><span class="symbol">(),</span><span class="normal"> unique</span><span class="symbol">);</span>
<span class="preproc">#endif</span><span class="normal"> </span><span class="comment">// LCP_CALC</span>

<span class="normal">                </span><span class="function">assert</span><span class="symbol">(</span><span class="normal">resume_order_rm </span><span class="symbol">!=</span><span class="normal"> NULL</span><span class="symbol">);</span>
<span class="normal">                </span><span class="keyword">delete</span><span class="normal"> resume_order_rm</span><span class="symbol">;</span><span class="normal"> resume_order_rm </span><span class="symbol">=</span><span class="normal"> NULL</span><span class="symbol">;</span>

<span class="normal">                loop_order_rc </span><span class="symbol">=</span><span class="normal"> </span><span class="keyword">new</span><span class="normal"> </span><span class="function">rc_loop_type</span><span class="symbol">(</span><span class="normal">name_quads_loop</span><span class="symbol">,</span><span class="normal"> </span><span class="function">less_skew</span><span class="symbol">(),</span><span class="normal"> ram_use </span><span class="symbol">/</span><span class="normal"> </span><span class="number">2</span><span class="symbol">);</span>
<span class="normal">                resume_order_rm </span><span class="symbol">=</span><span class="normal"> </span><span class="keyword">new</span><span class="normal"> </span><span class="function">rm_order_type</span><span class="symbol">(</span><span class="normal">loop_order_rc</span><span class="symbol">-&gt;</span><span class="function">result</span><span class="symbol">(),</span><span class="normal"> </span><span class="function">less_skew</span><span class="symbol">(),</span><span class="normal"> ram_use </span><span class="symbol">/</span><span class="normal"> </span><span class="number">2</span><span class="symbol">);</span>

<span class="normal">                </span><span class="function">DBGMEM</span><span class="symbol">(</span><span class="string">"Next naming level done"</span><span class="symbol">);</span>

<span class="normal">                </span><span class="keyword">if</span><span class="normal"> </span><span class="symbol">(</span><span class="normal">unique</span><span class="symbol">)</span><span class="normal"> </span><span class="comment">// Push the subsuffixarray on the list</span>
<span class="normal">                </span><span class="cbracket">{</span>
<span class="normal">                    vectors</span><span class="symbol">.</span><span class="function">push_back</span><span class="symbol">(</span><span class="normal"> </span><span class="keyword">new</span><span class="normal"> </span><span class="function">offset_array_type</span><span class="symbol">(</span><span class="normal">resume_order_rm</span><span class="symbol">-&gt;</span><span class="function">size</span><span class="symbol">())</span><span class="normal"> </span><span class="symbol">);</span><span class="normal">	</span><span class="comment">// to store last S</span>

<span class="normal">                    stream</span><span class="symbol">::</span><span class="usertype">choose&lt;rm_order_type,2&gt;</span><span class="normal"> </span><span class="function">merger</span><span class="symbol">(*</span><span class="normal">resume_order_rm</span><span class="symbol">);</span>
<span class="normal">                    stream</span><span class="symbol">::</span><span class="function">materialize</span><span class="symbol">(</span><span class="normal">merger</span><span class="symbol">,</span><span class="normal"> vectors</span><span class="symbol">.</span><span class="function">back</span><span class="symbol">()-&gt;</span><span class="function">begin</span><span class="symbol">(),</span><span class="normal"> vectors</span><span class="symbol">.</span><span class="function">back</span><span class="symbol">()-&gt;</span><span class="function">end</span><span class="symbol">());</span>
<span class="normal">                </span><span class="cbracket">}</span>

<span class="normal">            </span><span class="cbracket">}</span><span class="normal"> </span><span class="comment">// while (!unique)</span>

<span class="normal">            </span><span class="function">DBG</span><span class="symbol">(</span><span class="normal">debug</span><span class="symbol">,</span><span class="normal"> </span><span class="string">"Found unique lexnames."</span><span class="symbol">);</span>
<span class="normal">            g_statscache </span><span class="symbol">&gt;&gt;</span><span class="normal"> </span><span class="string">"maxdepth"</span><span class="normal"> </span><span class="symbol">&lt;&lt;</span><span class="normal"> depth</span><span class="symbol">;</span>

<span class="normal">            </span><span class="comment">// clean garbage</span>

<span class="normal">            </span><span class="keyword">if</span><span class="normal"> </span><span class="symbol">(</span><span class="normal">loop_order_rc </span><span class="symbol">!=</span><span class="normal"> NULL</span><span class="symbol">)</span><span class="normal"> </span><span class="cbracket">{</span>
<span class="normal">                </span><span class="keyword">delete</span><span class="normal"> loop_order_rc</span><span class="symbol">;</span><span class="normal"> loop_order_rc </span><span class="symbol">=</span><span class="normal"> NULL</span><span class="symbol">;</span>
<span class="normal">            </span><span class="cbracket">}</span>
<span class="normal">            </span><span class="keyword">if</span><span class="normal"> </span><span class="symbol">(</span><span class="normal">resume_order_rc </span><span class="symbol">!=</span><span class="normal"> NULL</span><span class="symbol">)</span><span class="normal"> </span><span class="cbracket">{</span>
<span class="normal">                </span><span class="keyword">delete</span><span class="normal"> resume_order_rc</span><span class="symbol">;</span><span class="normal"> resume_order_rc </span><span class="symbol">=</span><span class="normal"> NULL</span><span class="symbol">;</span>
<span class="normal">            </span><span class="cbracket">}</span>
<span class="normal">            </span><span class="keyword">if</span><span class="normal"> </span><span class="symbol">(</span><span class="normal">resume_order_rm </span><span class="symbol">!=</span><span class="normal"> NULL</span><span class="symbol">)</span><span class="normal"> </span><span class="cbracket">{</span>
<span class="normal">                </span><span class="keyword">delete</span><span class="normal"> resume_order_rm</span><span class="symbol">;</span><span class="normal"> resume_order_rm </span><span class="symbol">=</span><span class="normal"> NULL</span><span class="symbol">;</span>
<span class="normal">            </span><span class="cbracket">}</span>

<span class="normal">            </span><span class="function">DBGMEM</span><span class="symbol">(</span><span class="string">"Unique names found."</span><span class="symbol">);</span>

<span class="preproc">#if</span><span class="normal"> SKEW_DEBUG</span>
<span class="normal">            </span><span class="keyword">for</span><span class="normal"> </span><span class="symbol">(</span><span class="usertype">size_t</span><span class="normal"> i </span><span class="symbol">=</span><span class="normal"> </span><span class="number">0</span><span class="symbol">;</span><span class="normal"> i </span><span class="symbol">&lt;</span><span class="normal"> vectors</span><span class="symbol">.</span><span class="function">size</span><span class="symbol">();</span><span class="normal"> </span><span class="symbol">++</span><span class="normal">i</span><span class="symbol">)</span>
<span class="normal">            </span><span class="cbracket">{</span>
<span class="normal">                offset_array_type </span><span class="symbol">&amp;</span><span class="normal"> test </span><span class="symbol">=</span><span class="normal"> </span><span class="symbol">*</span><span class="normal">vectors</span><span class="symbol">[</span><span class="normal">i</span><span class="symbol">];</span>
<span class="normal">                </span><span class="keyword">for</span><span class="normal"> </span><span class="symbol">(</span><span class="usertype">size_t</span><span class="normal"> e </span><span class="symbol">=</span><span class="normal"> </span><span class="number">0</span><span class="symbol">;</span><span class="normal"> e </span><span class="symbol">&lt;</span><span class="normal"> test</span><span class="symbol">.</span><span class="function">size</span><span class="symbol">();</span><span class="normal"> </span><span class="symbol">++</span><span class="normal">e</span><span class="symbol">)</span>
<span class="normal">                    std</span><span class="symbol">::</span><span class="normal">cout </span><span class="symbol">&lt;&lt;</span><span class="normal"> test</span><span class="symbol">[</span><span class="normal">e</span><span class="symbol">]</span><span class="normal"> </span><span class="symbol">&lt;&lt;</span><span class="normal"> </span><span class="string">" "</span><span class="symbol">;</span>
<span class="normal">                </span><span class="keyword">if</span><span class="normal"> </span><span class="symbol">((</span><span class="normal">test</span><span class="symbol">.</span><span class="function">size</span><span class="symbol">()</span><span class="normal"> </span><span class="symbol">&amp;</span><span class="normal"> </span><span class="number">1</span><span class="symbol">)</span><span class="normal"> </span><span class="symbol">==</span><span class="normal"> </span><span class="number">1</span><span class="symbol">)</span>
<span class="normal">                    std</span><span class="symbol">::</span><span class="normal">cout </span><span class="symbol">&lt;&lt;</span><span class="normal"> </span><span class="string">" Break: "</span><span class="normal"> </span><span class="symbol">&lt;&lt;</span><span class="normal"> </span><span class="symbol">(</span><span class="normal">test</span><span class="symbol">.</span><span class="function">size</span><span class="symbol">()</span><span class="normal"> </span><span class="symbol">&gt;&gt;</span><span class="normal"> </span><span class="number">1</span><span class="symbol">)</span><span class="normal"> </span><span class="symbol">+</span><span class="normal"> </span><span class="number">1</span><span class="symbol">;</span>
<span class="normal">                </span><span class="keyword">else</span>
<span class="normal">                    std</span><span class="symbol">::</span><span class="normal">cout </span><span class="symbol">&lt;&lt;</span><span class="normal"> </span><span class="string">" Break: "</span><span class="normal"> </span><span class="symbol">&lt;&lt;</span><span class="normal"> </span><span class="symbol">(</span><span class="normal">test</span><span class="symbol">.</span><span class="function">size</span><span class="symbol">()</span><span class="normal"> </span><span class="symbol">&gt;&gt;</span><span class="normal"> </span><span class="number">1</span><span class="symbol">);</span>
<span class="normal">                std</span><span class="symbol">::</span><span class="normal">cout </span><span class="symbol">&lt;&lt;</span><span class="normal"> </span><span class="string">" Nextbreak: "</span><span class="normal"> </span><span class="symbol">&lt;&lt;</span><span class="normal"> </span><span class="function">subp_size</span><span class="symbol">(</span><span class="normal">test</span><span class="symbol">.</span><span class="function">size</span><span class="symbol">());</span>
<span class="normal">                std</span><span class="symbol">::</span><span class="normal">cout </span><span class="symbol">&lt;&lt;</span><span class="normal"> </span><span class="string">" Size: "</span><span class="normal"> </span><span class="symbol">&lt;&lt;</span><span class="normal"> test</span><span class="symbol">.</span><span class="function">size</span><span class="symbol">();</span>
<span class="normal">                std</span><span class="symbol">::</span><span class="normal">cout </span><span class="symbol">&lt;&lt;</span><span class="normal"> std</span><span class="symbol">::</span><span class="normal">endl</span><span class="symbol">;</span>
<span class="normal">            </span><span class="cbracket">}</span>
<span class="preproc">#endif</span>

<span class="normal">            </span><span class="comment">// *************************************************************************************</span>
<span class="normal">            </span><span class="comment">// *** Base case suffix array creation</span>

<span class="normal">            </span><span class="comment">/**</span>
<span class="comment">             * Simple suffix array creation in base case with unique names</span>
<span class="comment">             * Mod0 quint: </span><span class="keyword">&lt;index</span><span class="normal">, </span><span class="type">character</span><span class="normal">, </span><span class="type">character</span><span class="normal">+</span><span class="type">1</span><span class="normal">, ~</span><span class="type">SA12</span><span class="normal">+</span><span class="type">1</span><span class="normal">, ~</span><span class="type">SA12</span><span class="normal">+</span><span class="type">2</span><span class="keyword">&gt;</span>
<span class="comment">             * Mod1 quad : </span><span class="keyword">&lt;index</span><span class="normal">, ~</span><span class="type">SA12</span><span class="normal"> </span><span class="type">name</span><span class="normal">, </span><span class="type">character</span><span class="normal">, ~</span><span class="type">SA12</span><span class="normal">+</span><span class="type">1</span><span class="normal"> </span><span class="type">name</span><span class="keyword">&gt;</span>
<span class="comment">             * Mod2 quint: </span><span class="keyword">&lt;index</span><span class="normal">, ~</span><span class="type">SA12</span><span class="normal"> </span><span class="type">name</span><span class="normal">, </span><span class="type">character</span><span class="normal">, </span><span class="type">character</span><span class="normal">+</span><span class="type">1</span><span class="normal">, ~</span><span class="type">SA12</span><span class="normal">+</span><span class="type">2</span><span class="normal"> </span><span class="type">name</span><span class="keyword">&gt;</span>
<span class="comment">             * -mehnert</span>
<span class="comment">             */</span>

<span class="normal">            </span><span class="function">assert</span><span class="symbol">(</span><span class="normal">vectors</span><span class="symbol">.</span><span class="function">size</span><span class="symbol">()</span><span class="normal"> </span><span class="symbol">&gt;</span><span class="normal"> </span><span class="number">2</span><span class="symbol">);</span><span class="normal">	</span><span class="comment">// We do not want all names finished at this time ...</span>

<span class="normal">            </span><span class="usertype">isa1_sr_type</span><span class="normal"> isa1_sr</span><span class="symbol">;</span>
<span class="normal">            </span><span class="usertype">isa2_sr_type</span><span class="normal"> isa2_sr</span><span class="symbol">;</span>
<span class="preproc">#if</span><span class="normal"> LCP_CALC</span>
<span class="normal">            offset_array_type</span><span class="symbol">*</span><span class="normal"> prev_sa</span><span class="symbol">;</span>
<span class="normal">            build_lcp</span><span class="symbol">*</span><span class="normal"> prev_lcp</span><span class="symbol">;</span>
<span class="preproc">#endif</span><span class="normal"> </span><span class="comment">// LCP_CALC</span>

<span class="normal">            </span><span class="cbracket">{</span><span class="normal"> </span><span class="comment">// base case suffix array</span>

<span class="normal">                </span><span class="function">DBG</span><span class="symbol">(</span><span class="normal">debug</span><span class="symbol">,</span><span class="normal"> </span><span class="string">"Merging from base case in depth "</span><span class="normal"> </span><span class="symbol">&lt;&lt;</span><span class="normal"> depth</span><span class="symbol">);</span>

<span class="normal">                offset_array_type</span><span class="symbol">&amp;</span><span class="normal"> base_source </span><span class="symbol">=</span><span class="normal"> </span><span class="symbol">*</span><span class="normal">vectors</span><span class="symbol">.</span><span class="function">back</span><span class="symbol">();</span><span class="normal"> </span><span class="comment">// contains ISA of base case -tb</span>
<span class="normal">                offset_array_type</span><span class="symbol">&amp;</span><span class="normal"> prev_array </span><span class="symbol">=</span><span class="normal"> </span><span class="symbol">*</span><span class="normal">vectors</span><span class="symbol">[</span><span class="normal">vectors</span><span class="symbol">.</span><span class="function">size</span><span class="symbol">()</span><span class="normal"> </span><span class="symbol">-</span><span class="normal"> </span><span class="number">2</span><span class="symbol">];</span>

<span class="normal">                </span><span class="comment">// calculate start of mod2 area</span>

<span class="normal">                </span><span class="keyword">typename</span><span class="normal"> </span><span class="classname">offset_array_type</span><span class="symbol">::</span><span class="usertype">iterator</span><span class="normal"> start_mod2 </span><span class="symbol">=</span><span class="normal"> base_source</span><span class="symbol">.</span><span class="function">begin</span><span class="symbol">();</span>
<span class="normal">                start_mod2 </span><span class="symbol">=</span><span class="normal"> start_mod2 </span><span class="symbol">+</span><span class="normal"> </span><span class="symbol">((</span><span class="normal">prev_array</span><span class="symbol">.</span><span class="function">size</span><span class="symbol">()</span><span class="normal"> </span><span class="symbol">/</span><span class="normal"> </span><span class="number">3</span><span class="symbol">)</span><span class="normal"> </span><span class="symbol">+</span><span class="normal"> </span><span class="symbol">((</span><span class="normal">prev_array</span><span class="symbol">.</span><span class="function">size</span><span class="symbol">()</span><span class="normal"> </span><span class="symbol">%</span><span class="normal"> </span><span class="number">3</span><span class="symbol">)</span><span class="normal"> </span><span class="symbol">==</span><span class="normal"> </span><span class="number">2</span><span class="symbol">));</span>

<span class="normal">                </span><span class="comment">// Special case, if the injected tuple had affected the next subproblem</span>

<span class="normal">                </span><span class="usertype">size_t</span><span class="normal"> special </span><span class="symbol">=</span><span class="normal"> </span><span class="symbol">(</span><span class="function">subp_size</span><span class="symbol">(</span><span class="normal">prev_array</span><span class="symbol">.</span><span class="function">size</span><span class="symbol">())</span><span class="normal"> </span><span class="symbol">!=</span><span class="normal"> base_source</span><span class="symbol">.</span><span class="function">size</span><span class="symbol">())</span><span class="normal"> </span><span class="symbol">?</span><span class="normal"> </span><span class="number">1</span><span class="normal"> </span><span class="symbol">:</span><span class="normal"> </span><span class="number">0</span><span class="symbol">;</span>

<span class="normal">                </span><span class="comment">// Generate streams from vector</span>

<span class="normal">                </span><span class="usertype">offset_array_it_rg</span><span class="normal"> </span><span class="function">source</span><span class="symbol">(</span><span class="normal">prev_array</span><span class="symbol">.</span><span class="function">begin</span><span class="symbol">(),</span><span class="normal"> prev_array</span><span class="symbol">.</span><span class="function">end</span><span class="symbol">());</span>
<span class="normal">                </span><span class="usertype">offset_array_it_rg</span><span class="normal"> </span><span class="function">mod1</span><span class="symbol">(</span><span class="normal">base_source</span><span class="symbol">.</span><span class="function">begin</span><span class="symbol">(),</span><span class="normal"> start_mod2</span><span class="symbol">);</span>
<span class="normal">                </span><span class="usertype">offset_array_it_rg</span><span class="normal"> </span><span class="function">mod2</span><span class="symbol">(</span><span class="normal">start_mod2 </span><span class="symbol">+</span><span class="normal"> special</span><span class="symbol">,</span><span class="normal"> base_source</span><span class="symbol">.</span><span class="function">end</span><span class="symbol">());</span>

<span class="normal">                </span><span class="comment">// Build suffix array</span>
<span class="preproc">#if</span><span class="normal"> </span><span class="symbol">!</span><span class="normal">LCP_CALC</span>
<span class="normal">                </span><span class="usertype">build_sa_type</span><span class="normal"> </span><span class="function">get_sa</span><span class="symbol">(</span><span class="normal">source</span><span class="symbol">,</span><span class="normal"> mod1</span><span class="symbol">,</span><span class="normal"> mod2</span><span class="symbol">,</span><span class="normal"> prev_array</span><span class="symbol">.</span><span class="function">size</span><span class="symbol">());</span>
<span class="preproc">#else</span><span class="normal"> </span><span class="comment">// LCP_CALC</span>
<span class="normal">                </span><span class="usertype">uint8_array_type</span><span class="normal"> lcp_base8</span><span class="symbol">;</span>
<span class="normal">                RMQ</span><span class="symbol">*</span><span class="normal"> lcp_rmq </span><span class="symbol">=</span><span class="normal"> </span><span class="keyword">new</span><span class="normal"> </span><span class="function">RMQ</span><span class="symbol">(</span><span class="normal">ram_use </span><span class="symbol">/</span><span class="normal"> memdivA</span><span class="symbol">);</span>
<span class="normal">                </span><span class="usertype">skew_pair_array_type</span><span class="normal"> lcp_rmq1_ranks</span><span class="symbol">;</span>

<span class="normal">                </span><span class="usertype">build_sa_type</span><span class="normal"> </span><span class="function">get_sa</span><span class="symbol">(</span><span class="normal">source</span><span class="symbol">,</span><span class="normal"> mod1</span><span class="symbol">,</span><span class="normal"> mod2</span><span class="symbol">,</span><span class="normal"> prev_array</span><span class="symbol">.</span><span class="function">size</span><span class="symbol">(),</span><span class="normal"> lcp_base8</span><span class="symbol">,</span><span class="normal"> </span><span class="symbol">*</span><span class="normal">lcp_rmq</span><span class="symbol">,</span><span class="normal"> lcp_rmq1_ranks</span><span class="symbol">);</span>
<span class="preproc">#endif</span><span class="normal"> </span><span class="comment">// LCP_CALC</span>

<span class="normal">                </span><span class="comment">// Prepare inverse suffix array</span>

<span class="normal">                </span><span class="usertype">counter_stream_type</span><span class="normal"> isa_index</span><span class="symbol">;</span>
<span class="normal">                </span><span class="usertype">prepare_isa_type</span><span class="normal"> </span><span class="function">isa_tuples</span><span class="symbol">(</span><span class="normal">isa_index</span><span class="symbol">,</span><span class="normal"> get_sa</span><span class="symbol">);</span>

<span class="normal">                </span><span class="comment">// Seperate isa</span>

<span class="normal">                </span><span class="usertype">isa1_rc_type</span><span class="normal"> </span><span class="function">isa1_rc</span><span class="symbol">(</span><span class="function">less_pair_2nd</span><span class="symbol">(),</span><span class="normal"> ram_use </span><span class="symbol">/</span><span class="normal"> memdivA</span><span class="symbol">/</span><span class="number">2</span><span class="symbol">);</span>
<span class="normal">                </span><span class="usertype">isa2_rc_type</span><span class="normal"> </span><span class="function">isa2_rc</span><span class="symbol">(</span><span class="function">less_pair_2nd</span><span class="symbol">(),</span><span class="normal"> ram_use </span><span class="symbol">/</span><span class="normal"> memdivA</span><span class="symbol">/</span><span class="number">2</span><span class="symbol">);</span>

<span class="normal">                </span><span class="usertype">offset_array_type</span><span class="normal"> </span><span class="symbol">*</span><span class="normal">last_array </span><span class="symbol">=</span><span class="normal"> vectors</span><span class="symbol">[</span><span class="normal">vectors</span><span class="symbol">.</span><span class="function">size</span><span class="symbol">()</span><span class="normal"> </span><span class="symbol">-</span><span class="normal"> </span><span class="number">3</span><span class="symbol">];</span>
<span class="normal">                special </span><span class="symbol">=</span><span class="normal"> </span><span class="symbol">(</span><span class="normal">prev_array</span><span class="symbol">.</span><span class="function">size</span><span class="symbol">()</span><span class="normal"> </span><span class="symbol">!=</span><span class="normal"> </span><span class="function">subp_size</span><span class="symbol">(</span><span class="normal">last_array</span><span class="symbol">-&gt;</span><span class="function">size</span><span class="symbol">()));</span><span class="normal"> </span><span class="comment">// Special case (see above)</span>
<span class="normal">                </span><span class="usertype">offset_type</span><span class="normal"> mod2_pos </span><span class="symbol">=</span><span class="normal"> </span><span class="symbol">(</span><span class="function">subp_size</span><span class="symbol">(</span><span class="normal">last_array</span><span class="symbol">-&gt;</span><span class="function">size</span><span class="symbol">())</span><span class="normal"> </span><span class="symbol">&gt;&gt;</span><span class="normal"> </span><span class="number">1</span><span class="symbol">)</span><span class="normal"> </span><span class="symbol">+</span><span class="normal"> </span><span class="symbol">(</span><span class="function">subp_size</span><span class="symbol">(</span><span class="normal">last_array</span><span class="symbol">-&gt;</span><span class="function">size</span><span class="symbol">())</span><span class="normal"> </span><span class="symbol">&amp;</span><span class="normal"> </span><span class="number">1</span><span class="symbol">)</span><span class="normal"> </span><span class="symbol">+</span><span class="normal"> special</span><span class="symbol">;</span>
<span class="normal">                </span><span class="function">DBG</span><span class="symbol">(</span><span class="number">0</span><span class="symbol">,</span><span class="normal"> </span><span class="string">"mod2_pos: "</span><span class="normal"> </span><span class="symbol">&lt;&lt;</span><span class="normal"> mod2_pos </span><span class="symbol">&lt;&lt;</span><span class="normal"> </span><span class="string">" special:"</span><span class="normal"> </span><span class="symbol">&lt;&lt;</span><span class="normal"> special </span><span class="symbol">&lt;&lt;</span><span class="normal"> </span><span class="string">" minus2: "</span><span class="normal"> </span><span class="symbol">&lt;&lt;</span><span class="normal"> last_array</span><span class="symbol">-&gt;</span><span class="function">size</span><span class="symbol">()</span><span class="normal"> </span><span class="symbol">&lt;&lt;</span><span class="normal"> </span><span class="string">" prev2: "</span><span class="normal"> </span><span class="symbol">&lt;&lt;</span><span class="normal"> prev_array</span><span class="symbol">.</span><span class="function">size</span><span class="symbol">());</span>

<span class="preproc">#if</span><span class="normal"> LCP_CALC</span>
<span class="normal">                prev_sa </span><span class="symbol">=</span><span class="normal"> </span><span class="keyword">new</span><span class="normal"> offset_array_type</span><span class="symbol">;</span>
<span class="preproc">#endif</span><span class="normal"> </span><span class="comment">// LCP_CALC</span>

<span class="normal">                </span><span class="keyword">while</span><span class="normal"> </span><span class="symbol">(!</span><span class="normal">isa_tuples</span><span class="symbol">.</span><span class="function">empty</span><span class="symbol">())</span><span class="normal"> </span><span class="cbracket">{</span><span class="normal"> </span><span class="comment">// (first,second) = (idx,sa[idx])</span>
<span class="normal">                    </span><span class="keyword">const</span><span class="normal"> skew_pair_type</span><span class="symbol">&amp;</span><span class="normal"> tmp </span><span class="symbol">=</span><span class="normal"> </span><span class="symbol">*</span><span class="normal">isa_tuples</span><span class="symbol">;</span><span class="normal"> </span><span class="comment">// (first,second) = (i,sa[i])</span>

<span class="preproc">#if</span><span class="normal"> LCP_CALC</span>
<span class="normal">                    prev_sa</span><span class="symbol">-&gt;</span><span class="function">push_back</span><span class="symbol">(</span><span class="normal">tmp</span><span class="symbol">.</span><span class="normal">second</span><span class="symbol">);</span>
<span class="preproc">#endif</span><span class="normal"> </span><span class="comment">// LCP_CALC</span>

<span class="normal">                    </span><span class="keyword">if</span><span class="normal"> </span><span class="symbol">(</span><span class="normal">tmp</span><span class="symbol">.</span><span class="normal">second </span><span class="symbol">&lt;</span><span class="normal"> mod2_pos</span><span class="symbol">)</span><span class="normal"> </span><span class="cbracket">{</span>
<span class="preproc">#if</span><span class="normal"> </span><span class="symbol">!</span><span class="normal">LCP_CALC</span>
<span class="normal">                        </span><span class="keyword">if</span><span class="normal"> </span><span class="symbol">(</span><span class="normal">tmp</span><span class="symbol">.</span><span class="normal">second </span><span class="symbol">+</span><span class="normal"> special </span><span class="symbol">&lt;</span><span class="normal"> mod2_pos</span><span class="symbol">)</span><span class="normal"> </span><span class="comment">// else: special sentinel tuple is dropped -tb</span>
<span class="preproc">#endif</span>
<span class="normal">                            isa1_rc</span><span class="symbol">.</span><span class="function">push</span><span class="symbol">(</span><span class="normal">tmp</span><span class="symbol">);</span>
<span class="normal">                    </span><span class="cbracket">}</span>
<span class="normal">                    </span><span class="keyword">else</span><span class="normal"> </span><span class="cbracket">{</span>
<span class="normal">                        isa2_rc</span><span class="symbol">.</span><span class="function">push</span><span class="symbol">(</span><span class="normal">tmp</span><span class="symbol">);</span>
<span class="normal">                    </span><span class="cbracket">}</span>
<span class="normal">                    </span><span class="symbol">++</span><span class="normal">isa_tuples</span><span class="symbol">;</span>
<span class="normal">                </span><span class="cbracket">}</span>

<span class="normal">                isa1_rc</span><span class="symbol">.</span><span class="function">deallocate</span><span class="symbol">();</span><span class="normal"> </span><span class="comment">// deallocate run_creator's buffers</span>
<span class="normal">                isa2_rc</span><span class="symbol">.</span><span class="function">deallocate</span><span class="symbol">();</span>

<span class="preproc">#if</span><span class="normal"> LCP_CALC</span>
<span class="normal">                </span><span class="comment">// Prepare LCP calculation from RMQs and LCP_lexnames</span>

<span class="normal">                </span><span class="function">assert</span><span class="symbol">(</span><span class="normal">base_source</span><span class="symbol">.</span><span class="function">size</span><span class="symbol">()</span><span class="normal"> </span><span class="symbol">==</span><span class="normal"> lcp_name_vectors</span><span class="symbol">.</span><span class="function">back</span><span class="symbol">()-&gt;</span><span class="function">size</span><span class="symbol">());</span>

<span class="normal">                </span><span class="comment">// transform uint8_t lcps to offset_type</span>
<span class="normal">                offset_array_type</span><span class="symbol">*</span><span class="normal"> lcp_base </span><span class="symbol">=</span><span class="normal"> </span><span class="keyword">new</span><span class="normal"> </span><span class="function">offset_array_type</span><span class="symbol">(</span><span class="normal">lcp_base8</span><span class="symbol">.</span><span class="function">size</span><span class="symbol">());</span>
<span class="normal">                </span><span class="usertype">uint8_array_it_rg</span><span class="normal"> </span><span class="function">lcp_base8_iter</span><span class="symbol">(</span><span class="normal">lcp_base8</span><span class="symbol">.</span><span class="function">begin</span><span class="symbol">(),</span><span class="normal"> lcp_base8</span><span class="symbol">.</span><span class="function">end</span><span class="symbol">());</span>
<span class="normal">                stream</span><span class="symbol">::</span><span class="function">materialize</span><span class="symbol">(</span><span class="normal">lcp_base8_iter</span><span class="symbol">,</span><span class="normal"> lcp_base</span><span class="symbol">-&gt;</span><span class="function">begin</span><span class="symbol">(),</span><span class="normal"> lcp_base</span><span class="symbol">-&gt;</span><span class="function">end</span><span class="symbol">());</span>

<span class="normal">                </span><span class="comment">// build_lcp takes ownership of lcp_base and lcp_rmq</span>
<span class="normal">                prev_lcp </span><span class="symbol">=</span><span class="normal"> </span><span class="keyword">new</span><span class="normal"> </span><span class="function">build_lcp</span><span class="symbol">(</span><span class="normal">lcp_base</span><span class="symbol">,</span><span class="normal"> lcp_rmq</span><span class="symbol">,</span><span class="normal"> </span><span class="symbol">*</span><span class="normal">lcp_name_vectors</span><span class="symbol">.</span><span class="function">back</span><span class="symbol">());</span>

<span class="normal">                </span><span class="keyword">delete</span><span class="normal"> lcp_name_vectors</span><span class="symbol">.</span><span class="function">back</span><span class="symbol">();</span><span class="normal"> </span><span class="comment">// in build_lcp constructor the lcp_name RMQs are</span>
<span class="normal">                                                </span><span class="comment">// answered, so we can delete LCP_names here</span>
<span class="normal">                lcp_name_vectors</span><span class="symbol">.</span><span class="function">pop_back</span><span class="symbol">();</span>
<span class="preproc">#endif</span><span class="normal"> </span><span class="comment">// LCP_CALC</span>

<span class="normal">                </span><span class="comment">// Save ISA runs for next subproblem</span>
<span class="normal">                isa1_sr </span><span class="symbol">=</span><span class="normal"> isa1_rc</span><span class="symbol">.</span><span class="function">result</span><span class="symbol">();</span>
<span class="normal">                isa2_sr </span><span class="symbol">=</span><span class="normal"> isa2_rc</span><span class="symbol">.</span><span class="function">result</span><span class="symbol">();</span>

<span class="normal">                </span><span class="comment">// debug ISA</span>
<span class="normal">                </span><span class="keyword">if</span><span class="normal"> </span><span class="symbol">(</span><span class="normal">debug_isa</span><span class="symbol">)</span>
<span class="normal">                </span><span class="cbracket">{</span>
<span class="normal">                    </span><span class="keyword">for</span><span class="normal"> </span><span class="symbol">(</span><span class="usertype">isa1_rm_type</span><span class="normal"> </span><span class="function">isa1_rm</span><span class="symbol">(</span><span class="normal">isa1_sr</span><span class="symbol">,</span><span class="normal"> </span><span class="function">less_pair_2nd</span><span class="symbol">(),</span><span class="normal"> ram_use </span><span class="symbol">/</span><span class="normal"> </span><span class="number">8</span><span class="symbol">);</span>
<span class="normal">                         </span><span class="symbol">!</span><span class="normal">isa1_rm</span><span class="symbol">.</span><span class="function">empty</span><span class="symbol">();</span><span class="normal"> </span><span class="symbol">++</span><span class="normal">isa1_rm</span><span class="symbol">)</span>
<span class="normal">                        </span><span class="function">DBG</span><span class="symbol">(</span><span class="normal">debug_isa</span><span class="symbol">,</span><span class="normal"> </span><span class="string">"ISA1: "</span><span class="normal"> </span><span class="symbol">&lt;&lt;</span><span class="normal"> </span><span class="symbol">*</span><span class="normal">isa1_rm</span><span class="symbol">);</span>

<span class="normal">                    </span><span class="keyword">for</span><span class="normal"> </span><span class="symbol">(</span><span class="usertype">isa2_rm_type</span><span class="normal"> </span><span class="function">isa2_rm</span><span class="symbol">(</span><span class="normal">isa2_sr</span><span class="symbol">,</span><span class="normal"> </span><span class="function">less_pair_2nd</span><span class="symbol">(),</span><span class="normal"> ram_use </span><span class="symbol">/</span><span class="normal"> </span><span class="number">8</span><span class="symbol">);</span>
<span class="normal">                         </span><span class="symbol">!</span><span class="normal">isa2_rm</span><span class="symbol">.</span><span class="function">empty</span><span class="symbol">();</span><span class="normal"> </span><span class="symbol">++</span><span class="normal">isa2_rm</span><span class="symbol">)</span>
<span class="normal">                        </span><span class="function">DBG</span><span class="symbol">(</span><span class="normal">debug_isa</span><span class="symbol">,</span><span class="normal"> </span><span class="string">"ISA2: "</span><span class="normal"> </span><span class="symbol">&lt;&lt;</span><span class="normal"> </span><span class="symbol">*</span><span class="normal">isa2_rm</span><span class="symbol">);</span>
<span class="normal">                </span><span class="cbracket">}</span>

<span class="normal">            </span><span class="cbracket">}</span><span class="normal"> </span><span class="comment">// end base case suffix array</span>

<span class="normal">            </span><span class="comment">// *************************************************************************************</span>
<span class="normal">            </span><span class="comment">// *** Loop head</span>

<span class="normal">            </span><span class="comment">// delete last subproblem</span>
<span class="normal">            </span><span class="keyword">delete</span><span class="normal"> vectors</span><span class="symbol">.</span><span class="function">back</span><span class="symbol">();</span>
<span class="normal">            vectors</span><span class="symbol">.</span><span class="function">pop_back</span><span class="symbol">();</span>

<span class="preproc">#if</span><span class="normal"> SKEW_DEBUG</span>
<span class="normal">            </span><span class="keyword">for</span><span class="symbol">(</span><span class="usertype">size_t</span><span class="normal"> i </span><span class="symbol">=</span><span class="normal"> </span><span class="number">0</span><span class="symbol">;</span><span class="normal"> i </span><span class="symbol">&lt;</span><span class="normal"> vectors</span><span class="symbol">.</span><span class="function">size</span><span class="symbol">();</span><span class="normal"> </span><span class="symbol">++</span><span class="normal">i</span><span class="symbol">)</span><span class="normal"> </span><span class="cbracket">{</span>
<span class="normal">                offset_array_type</span><span class="symbol">&amp;</span><span class="normal"> test </span><span class="symbol">=</span><span class="normal"> </span><span class="symbol">*</span><span class="normal">vectors</span><span class="symbol">[</span><span class="normal">i</span><span class="symbol">];</span>
<span class="normal">                </span><span class="keyword">for</span><span class="symbol">(</span><span class="usertype">size_t</span><span class="normal"> e </span><span class="symbol">=</span><span class="normal"> </span><span class="number">0</span><span class="symbol">;</span><span class="normal"> e </span><span class="symbol">&lt;</span><span class="normal"> test</span><span class="symbol">.</span><span class="function">size</span><span class="symbol">();</span><span class="normal"> </span><span class="symbol">++</span><span class="normal">e</span><span class="symbol">)</span>
<span class="normal">                    std</span><span class="symbol">::</span><span class="normal">cout </span><span class="symbol">&lt;&lt;</span><span class="normal"> test</span><span class="symbol">[</span><span class="normal">e</span><span class="symbol">]</span><span class="normal"> </span><span class="symbol">&lt;&lt;</span><span class="normal"> </span><span class="string">" "</span><span class="symbol">;</span>
<span class="normal">                std</span><span class="symbol">::</span><span class="normal">cout</span><span class="symbol">.</span><span class="function">flush</span><span class="symbol">();</span>
<span class="normal">                </span><span class="keyword">if</span><span class="normal"> </span><span class="symbol">((</span><span class="normal">test</span><span class="symbol">.</span><span class="function">size</span><span class="symbol">()</span><span class="normal"> </span><span class="symbol">&amp;</span><span class="normal"> </span><span class="number">1</span><span class="symbol">)</span><span class="normal"> </span><span class="symbol">==</span><span class="normal"> </span><span class="number">1</span><span class="symbol">)</span>
<span class="normal">                    std</span><span class="symbol">::</span><span class="normal">cout </span><span class="symbol">&lt;&lt;</span><span class="normal"> </span><span class="string">" Break: "</span><span class="normal"> </span><span class="symbol">&lt;&lt;</span><span class="normal"> </span><span class="symbol">(</span><span class="normal">test</span><span class="symbol">.</span><span class="function">size</span><span class="symbol">()</span><span class="normal"> </span><span class="symbol">&gt;&gt;</span><span class="normal"> </span><span class="number">1</span><span class="symbol">)</span><span class="normal"> </span><span class="symbol">+</span><span class="normal"> </span><span class="number">1</span><span class="symbol">;</span>
<span class="normal">                </span><span class="keyword">else</span>
<span class="normal">                    std</span><span class="symbol">::</span><span class="normal">cout </span><span class="symbol">&lt;&lt;</span><span class="normal"> </span><span class="string">" Break: "</span><span class="normal"> </span><span class="symbol">&lt;&lt;</span><span class="normal"> </span><span class="symbol">(</span><span class="normal">test</span><span class="symbol">.</span><span class="function">size</span><span class="symbol">()</span><span class="normal"> </span><span class="symbol">&gt;&gt;</span><span class="normal"> </span><span class="number">1</span><span class="symbol">);</span>
<span class="normal">                std</span><span class="symbol">::</span><span class="normal">cout </span><span class="symbol">&lt;&lt;</span><span class="normal"> </span><span class="string">" Nextbreak: "</span><span class="normal"> </span><span class="symbol">&lt;&lt;</span><span class="normal"> </span><span class="function">subp_size</span><span class="symbol">(</span><span class="normal">test</span><span class="symbol">.</span><span class="function">size</span><span class="symbol">());</span>
<span class="normal">                std</span><span class="symbol">::</span><span class="normal">cout </span><span class="symbol">&lt;&lt;</span><span class="normal"> </span><span class="string">" Size: "</span><span class="normal"> </span><span class="symbol">&lt;&lt;</span><span class="normal"> test</span><span class="symbol">.</span><span class="function">size</span><span class="symbol">();</span>
<span class="normal">                std</span><span class="symbol">::</span><span class="normal">cout </span><span class="symbol">&lt;&lt;</span><span class="normal"> std</span><span class="symbol">::</span><span class="normal">endl</span><span class="symbol">;</span>
<span class="normal">            </span><span class="cbracket">}</span>
<span class="preproc">#endif</span>

<span class="normal">            </span><span class="usertype">offset_array_type</span><span class="normal"> </span><span class="symbol">*</span><span class="normal">prev_array </span><span class="symbol">=</span><span class="normal"> vectors</span><span class="symbol">[</span><span class="normal">vectors</span><span class="symbol">.</span><span class="function">size</span><span class="symbol">()</span><span class="normal"> </span><span class="symbol">-</span><span class="normal"> </span><span class="number">2</span><span class="symbol">];</span>

<span class="normal">            </span><span class="keyword">while</span><span class="normal"> </span><span class="symbol">(</span><span class="normal">vectors</span><span class="symbol">.</span><span class="function">size</span><span class="symbol">()</span><span class="normal"> </span><span class="symbol">&gt;</span><span class="normal"> </span><span class="number">2</span><span class="symbol">)</span>
<span class="normal">            </span><span class="cbracket">{</span>
<span class="normal">                </span><span class="function">DBG</span><span class="symbol">(</span><span class="normal">debug</span><span class="symbol">,</span><span class="normal"> </span><span class="string">"Exiting recursion depth "</span><span class="normal"> </span><span class="symbol">&lt;&lt;</span><span class="normal"> </span><span class="symbol">--</span><span class="normal">depth</span><span class="symbol">);</span>

<span class="normal">                </span><span class="function">DBGMEM</span><span class="symbol">(</span><span class="string">"Loop start"</span><span class="symbol">);</span>

<span class="normal">                </span><span class="usertype">isa1_rm_type</span><span class="normal"> </span><span class="function">isa1_rm</span><span class="symbol">(</span><span class="normal">isa1_sr</span><span class="symbol">,</span><span class="normal"> </span><span class="function">less_pair_2nd</span><span class="symbol">(),</span><span class="normal"> ram_use </span><span class="symbol">/</span><span class="normal"> memdivA</span><span class="symbol">/</span><span class="number">2</span><span class="symbol">);</span>
<span class="normal">                </span><span class="usertype">isa2_rm_type</span><span class="normal"> </span><span class="function">isa2_rm</span><span class="symbol">(</span><span class="normal">isa2_sr</span><span class="symbol">,</span><span class="normal"> </span><span class="function">less_pair_2nd</span><span class="symbol">(),</span><span class="normal"> ram_use </span><span class="symbol">/</span><span class="normal"> memdivA</span><span class="symbol">/</span><span class="number">2</span><span class="symbol">);</span>

<span class="normal">                </span><span class="usertype">isa1_first_type</span><span class="normal"> </span><span class="function">isa1_first</span><span class="symbol">(</span><span class="normal">isa1_rm</span><span class="symbol">);</span>
<span class="normal">                </span><span class="usertype">isa2_first_type</span><span class="normal"> </span><span class="function">isa2_first</span><span class="symbol">(</span><span class="normal">isa2_rm</span><span class="symbol">);</span>

<span class="normal">                prev_array </span><span class="symbol">=</span><span class="normal"> vectors</span><span class="symbol">[</span><span class="normal">vectors</span><span class="symbol">.</span><span class="function">size</span><span class="symbol">()</span><span class="normal"> </span><span class="symbol">-</span><span class="normal"> </span><span class="number">2</span><span class="symbol">];</span>

<span class="normal">                </span><span class="usertype">offset_array_it_rg</span><span class="normal"> </span><span class="function">source</span><span class="symbol">(</span><span class="normal">prev_array</span><span class="symbol">-&gt;</span><span class="function">begin</span><span class="symbol">(),</span><span class="normal"> prev_array</span><span class="symbol">-&gt;</span><span class="function">end</span><span class="symbol">());</span>

<span class="normal">                </span><span class="comment">// The runs merger will be emptied after suffix array construction in the following line</span>
<span class="preproc">#if</span><span class="normal"> </span><span class="symbol">!</span><span class="normal">LCP_CALC</span>

<span class="normal">                </span><span class="usertype">build_sa_loop_type</span><span class="normal"> </span><span class="function">get_sa</span><span class="symbol">(</span><span class="normal">source</span><span class="symbol">,</span><span class="normal"> isa1_first</span><span class="symbol">,</span><span class="normal"> isa2_first</span><span class="symbol">,</span><span class="normal"> prev_array</span><span class="symbol">-&gt;</span><span class="function">size</span><span class="symbol">());</span>

<span class="preproc">#else</span><span class="normal"> </span><span class="comment">// LCP_CALC</span>

<span class="normal">                uint8_array_type</span><span class="symbol">*</span><span class="normal"> lcp_base8 </span><span class="symbol">=</span><span class="normal"> </span><span class="keyword">new</span><span class="normal"> uint8_array_type</span><span class="symbol">;</span>
<span class="normal">                RMQ</span><span class="symbol">*</span><span class="normal"> lcp_rmq1 </span><span class="symbol">=</span><span class="normal"> </span><span class="keyword">new</span><span class="normal"> </span><span class="function">RMQ</span><span class="symbol">(</span><span class="normal">ram_use </span><span class="symbol">/</span><span class="normal"> memdivA</span><span class="symbol">);</span>
<span class="normal">                skew_pair_array_type</span><span class="symbol">*</span><span class="normal"> lcp_rmq1_ranks </span><span class="symbol">=</span><span class="normal"> </span><span class="keyword">new</span><span class="normal"> skew_pair_array_type</span><span class="symbol">;</span>

<span class="normal">                </span><span class="usertype">build_sa_loop_type</span><span class="normal"> </span><span class="function">get_sa</span><span class="symbol">(</span><span class="normal">source</span><span class="symbol">,</span><span class="normal"> isa1_first</span><span class="symbol">,</span><span class="normal"> isa2_first</span><span class="symbol">,</span><span class="normal"> prev_array</span><span class="symbol">-&gt;</span><span class="function">size</span><span class="symbol">(),</span>
<span class="normal">                                          </span><span class="symbol">*</span><span class="normal">lcp_base8</span><span class="symbol">,</span><span class="normal"> </span><span class="symbol">*</span><span class="normal">lcp_rmq1</span><span class="symbol">,</span><span class="normal"> </span><span class="symbol">*</span><span class="normal">lcp_rmq1_ranks</span><span class="symbol">);</span>

<span class="normal">                offset_array_type</span><span class="symbol">*</span><span class="normal"> suffixarray </span><span class="symbol">=</span><span class="normal"> </span><span class="keyword">new</span><span class="normal"> </span><span class="function">offset_array_type</span><span class="symbol">();</span>

<span class="preproc">#endif</span><span class="normal"> </span><span class="comment">// LCP_CALC</span>

<span class="normal">                isa1_rm</span><span class="symbol">.</span><span class="function">deallocate</span><span class="symbol">();</span><span class="normal"> isa2_rm</span><span class="symbol">.</span><span class="function">deallocate</span><span class="symbol">();</span>
<span class="preproc">#if</span><span class="normal"> </span><span class="symbol">!</span><span class="normal">LCP_CALC</span>
<span class="normal">                isa1_sr</span><span class="symbol">-&gt;</span><span class="function">clear</span><span class="symbol">();</span><span class="normal"> isa2_sr</span><span class="symbol">-&gt;</span><span class="function">clear</span><span class="symbol">();</span><span class="normal">       </span><span class="comment">// for LCP calculation, prev_isa is still needed.</span>
<span class="preproc">#endif</span>

<span class="normal">                </span><span class="comment">// *** Read subsuffixarray and generate ISA from it. This also generates the LCP requests</span>

<span class="normal">                </span><span class="usertype">counter_stream_type</span><span class="normal"> isa_loop_index</span><span class="symbol">;</span>
<span class="normal">                </span><span class="usertype">prepare_isa_loop_type</span><span class="normal"> </span><span class="function">isa_loop_tuples</span><span class="symbol">(</span><span class="normal">isa_loop_index</span><span class="symbol">,</span><span class="normal"> get_sa</span><span class="symbol">);</span>

<span class="normal">                </span><span class="comment">// build runs creator</span>

<span class="normal">                </span><span class="usertype">isa_loop_rc_type</span><span class="normal"> </span><span class="function">isa1_loop_rc</span><span class="symbol">(</span><span class="function">less_pair_2nd</span><span class="symbol">(),</span><span class="normal"> ram_use </span><span class="symbol">/</span><span class="normal"> memdivA</span><span class="symbol">/</span><span class="number">2</span><span class="symbol">);</span>
<span class="normal">                </span><span class="usertype">isa_loop_rc_type</span><span class="normal"> </span><span class="function">isa2_loop_rc</span><span class="symbol">(</span><span class="function">less_pair_2nd</span><span class="symbol">(),</span><span class="normal"> ram_use </span><span class="symbol">/</span><span class="normal"> memdivA</span><span class="symbol">/</span><span class="number">2</span><span class="symbol">);</span>

<span class="normal">                offset_array_type</span><span class="symbol">*</span><span class="normal"> last_array </span><span class="symbol">=</span><span class="normal"> vectors</span><span class="symbol">[</span><span class="normal">vectors</span><span class="symbol">.</span><span class="function">size</span><span class="symbol">()</span><span class="normal"> </span><span class="symbol">-</span><span class="normal"> </span><span class="number">3</span><span class="symbol">];</span>

<span class="normal">                </span><span class="usertype">size_t</span><span class="normal"> special </span><span class="symbol">=</span><span class="normal"> </span><span class="symbol">(</span><span class="normal">prev_array</span><span class="symbol">-&gt;</span><span class="function">size</span><span class="symbol">()</span><span class="normal"> </span><span class="symbol">!=</span><span class="normal"> </span><span class="function">subp_size</span><span class="symbol">(</span><span class="normal">last_array</span><span class="symbol">-&gt;</span><span class="function">size</span><span class="symbol">()))</span><span class="normal"> </span><span class="symbol">?</span><span class="normal"> </span><span class="number">1</span><span class="normal"> </span><span class="symbol">:</span><span class="normal"> </span><span class="number">0</span><span class="symbol">;</span>
<span class="normal">                </span><span class="usertype">offset_type</span><span class="normal"> mod2_loop_pos </span><span class="symbol">=</span><span class="normal"> </span><span class="symbol">(</span><span class="function">subp_size</span><span class="symbol">(</span><span class="normal">last_array</span><span class="symbol">-&gt;</span><span class="function">size</span><span class="symbol">())</span><span class="normal"> </span><span class="symbol">&gt;&gt;</span><span class="normal"> </span><span class="number">1</span><span class="symbol">)</span><span class="normal"> </span><span class="symbol">+</span><span class="normal"> </span><span class="symbol">(</span><span class="function">subp_size</span><span class="symbol">(</span><span class="normal">last_array</span><span class="symbol">-&gt;</span><span class="function">size</span><span class="symbol">())</span><span class="normal"> </span><span class="symbol">&amp;</span><span class="normal"> </span><span class="number">1</span><span class="symbol">)</span><span class="normal"> </span><span class="symbol">+</span><span class="normal"> special</span><span class="symbol">;</span>

<span class="normal">                </span><span class="function">DBG</span><span class="symbol">(</span><span class="number">0</span><span class="symbol">,</span><span class="normal"> </span><span class="string">"Mod2_Pos: "</span><span class="normal"> </span><span class="symbol">&lt;&lt;</span><span class="normal"> mod2_loop_pos </span><span class="symbol">&lt;&lt;</span><span class="normal"> </span><span class="string">" Special:"</span><span class="normal"> </span><span class="symbol">&lt;&lt;</span><span class="normal"> special </span><span class="symbol">&lt;&lt;</span><span class="normal"> </span><span class="string">" Minus2: "</span><span class="normal"> </span><span class="symbol">&lt;&lt;</span><span class="normal"> last_array</span><span class="symbol">-&gt;</span><span class="function">size</span><span class="symbol">()</span><span class="normal"> </span><span class="symbol">&lt;&lt;</span><span class="normal"> </span><span class="string">" Prev2: "</span><span class="normal"> </span><span class="symbol">&lt;&lt;</span><span class="normal"> prev_array</span><span class="symbol">-&gt;</span><span class="function">size</span><span class="symbol">()</span><span class="normal"> </span><span class="symbol">&lt;&lt;</span><span class="normal"> </span><span class="string">" Vsize:"</span><span class="normal">  </span><span class="symbol">&lt;&lt;</span><span class="normal"> vectors</span><span class="symbol">.</span><span class="function">size</span><span class="symbol">()</span><span class="normal"> </span><span class="symbol">);</span><span class="normal"> </span><span class="comment">// -mehnert</span>

<span class="normal">                </span><span class="keyword">while</span><span class="normal"> </span><span class="symbol">(!</span><span class="normal">isa_loop_tuples</span><span class="symbol">.</span><span class="function">empty</span><span class="symbol">())</span><span class="normal"> </span><span class="cbracket">{</span>
<span class="normal">                    </span><span class="keyword">const</span><span class="normal"> skew_pair_type</span><span class="symbol">&amp;</span><span class="normal"> tmp </span><span class="symbol">=</span><span class="normal"> </span><span class="symbol">*</span><span class="normal">isa_loop_tuples</span><span class="symbol">;</span><span class="normal"> </span><span class="comment">// (first,second) = (i,sa[i])</span>
<span class="preproc">#if</span><span class="normal"> LCP_CALC</span>
<span class="normal">                    suffixarray</span><span class="symbol">-&gt;</span><span class="function">push_back</span><span class="symbol">(</span><span class="normal">tmp</span><span class="symbol">.</span><span class="normal">second</span><span class="symbol">);</span>
<span class="preproc">#endif</span><span class="normal"> </span><span class="comment">// LCP_CALC</span>
<span class="normal">                    </span><span class="keyword">if</span><span class="normal"> </span><span class="symbol">(</span><span class="normal">tmp</span><span class="symbol">.</span><span class="normal">second </span><span class="symbol">&lt;</span><span class="normal"> mod2_loop_pos</span><span class="symbol">)</span><span class="normal"> </span><span class="cbracket">{</span>
<span class="preproc">#if</span><span class="normal"> </span><span class="symbol">!</span><span class="normal">LCP_CALC</span>
<span class="normal">                        </span><span class="keyword">if</span><span class="normal"> </span><span class="symbol">(</span><span class="normal">tmp</span><span class="symbol">.</span><span class="normal">second </span><span class="symbol">+</span><span class="normal"> special </span><span class="symbol">&lt;</span><span class="normal"> mod2_loop_pos</span><span class="symbol">)</span><span class="normal"> </span><span class="comment">// else: special sentinel tuple is dropped -tb</span>
<span class="preproc">#endif</span>
<span class="normal">                            isa1_loop_rc</span><span class="symbol">.</span><span class="function">push</span><span class="symbol">(</span><span class="normal">tmp</span><span class="symbol">);</span>
<span class="normal">                    </span><span class="cbracket">}</span>
<span class="normal">                    </span><span class="keyword">else</span><span class="normal"> </span><span class="cbracket">{</span>
<span class="normal">                        isa2_loop_rc</span><span class="symbol">.</span><span class="function">push</span><span class="symbol">(</span><span class="normal">tmp</span><span class="symbol">);</span>
<span class="normal">                    </span><span class="cbracket">}</span>
<span class="normal">                    </span><span class="symbol">++</span><span class="normal">isa_loop_tuples</span><span class="symbol">;</span>
<span class="normal">                </span><span class="cbracket">}</span>

<span class="normal">                isa1_rm</span><span class="symbol">.</span><span class="function">deallocate</span><span class="symbol">();</span>
<span class="normal">                isa2_rm</span><span class="symbol">.</span><span class="function">deallocate</span><span class="symbol">();</span>
<span class="normal">                isa1_loop_rc</span><span class="symbol">.</span><span class="function">deallocate</span><span class="symbol">();</span><span class="normal"> </span><span class="comment">// deallocate run_creator's buffers</span>
<span class="normal">                isa2_loop_rc</span><span class="symbol">.</span><span class="function">deallocate</span><span class="symbol">();</span>

<span class="preproc">#if</span><span class="normal"> LCP_CALC</span>
<span class="normal">                </span><span class="comment">// Prepare LCP calculation from RMQs and LCP_lexnames</span>

<span class="normal">                </span><span class="function">assert</span><span class="symbol">(</span><span class="normal"> lcp_base8</span><span class="symbol">-&gt;</span><span class="function">size</span><span class="symbol">()</span><span class="normal"> </span><span class="symbol">==</span><span class="normal"> suffixarray</span><span class="symbol">-&gt;</span><span class="function">size</span><span class="symbol">()</span><span class="normal"> </span><span class="symbol">);</span>
<span class="normal">                </span><span class="function">assert</span><span class="symbol">(</span><span class="normal"> vectors</span><span class="symbol">.</span><span class="function">back</span><span class="symbol">()-&gt;</span><span class="function">size</span><span class="symbol">()</span><span class="normal"> </span><span class="symbol">==</span><span class="normal"> lcp_name_vectors</span><span class="symbol">.</span><span class="function">back</span><span class="symbol">()-&gt;</span><span class="function">size</span><span class="symbol">()</span><span class="normal"> </span><span class="symbol">);</span>

<span class="normal">                prev_lcp </span><span class="symbol">=</span><span class="normal"> </span><span class="function">expand_build_lcp</span><span class="symbol">(</span><span class="normal">prev_lcp</span><span class="symbol">,</span><span class="normal"> prev_sa</span><span class="symbol">,</span><span class="normal"> isa1_sr</span><span class="symbol">,</span><span class="normal"> isa2_sr</span><span class="symbol">,</span>
<span class="normal">                                            </span><span class="symbol">*</span><span class="normal">lcp_name_vectors</span><span class="symbol">.</span><span class="function">back</span><span class="symbol">(),</span>
<span class="normal">                                            lcp_base8</span><span class="symbol">,</span><span class="normal"> lcp_rmq1</span><span class="symbol">,</span><span class="normal"> lcp_rmq1_ranks</span><span class="symbol">);</span>

<span class="normal">                </span><span class="keyword">delete</span><span class="normal"> lcp_name_vectors</span><span class="symbol">.</span><span class="function">back</span><span class="symbol">();</span><span class="normal"> </span><span class="comment">// in build_lcp constructor the lcp_name RMQs are</span>
<span class="normal">                                                </span><span class="comment">// answered, so we can delete LCP_names here</span>
<span class="normal">                lcp_name_vectors</span><span class="symbol">.</span><span class="function">pop_back</span><span class="symbol">();</span>
<span class="normal">                prev_sa </span><span class="symbol">=</span><span class="normal"> suffixarray</span><span class="symbol">;</span>

<span class="preproc">#endif</span><span class="normal"> </span><span class="comment">// LCP_CALC</span>

<span class="normal">                </span><span class="comment">// save ISA runs for next level -- frees previous result (smart pointer)</span>
<span class="normal">                isa1_sr </span><span class="symbol">=</span><span class="normal"> isa1_loop_rc</span><span class="symbol">.</span><span class="function">result</span><span class="symbol">();</span>
<span class="normal">                isa2_sr </span><span class="symbol">=</span><span class="normal"> isa2_loop_rc</span><span class="symbol">.</span><span class="function">result</span><span class="symbol">();</span>

<span class="normal">                </span><span class="comment">// debug ISA</span>
<span class="normal">                </span><span class="keyword">if</span><span class="normal"> </span><span class="symbol">(</span><span class="normal">debug_isa</span><span class="symbol">)</span>
<span class="normal">                </span><span class="cbracket">{</span>
<span class="normal">                    </span><span class="keyword">for</span><span class="normal"> </span><span class="symbol">(</span><span class="usertype">isa1_rm_type</span><span class="normal"> </span><span class="function">isa1_rm</span><span class="symbol">(</span><span class="normal">isa1_sr</span><span class="symbol">,</span><span class="normal"> </span><span class="function">less_pair_2nd</span><span class="symbol">(),</span><span class="normal"> ram_use </span><span class="symbol">/</span><span class="normal"> </span><span class="number">8</span><span class="symbol">);</span>
<span class="normal">                         </span><span class="symbol">!</span><span class="normal">isa1_rm</span><span class="symbol">.</span><span class="function">empty</span><span class="symbol">();</span><span class="normal"> </span><span class="symbol">++</span><span class="normal">isa1_rm</span><span class="symbol">)</span>
<span class="normal">                        </span><span class="function">DBG</span><span class="symbol">(</span><span class="normal">debug_isa</span><span class="symbol">,</span><span class="normal"> </span><span class="string">"ISA1: "</span><span class="normal"> </span><span class="symbol">&lt;&lt;</span><span class="normal"> </span><span class="symbol">*</span><span class="normal">isa1_rm</span><span class="symbol">);</span>

<span class="normal">                    </span><span class="keyword">for</span><span class="normal"> </span><span class="symbol">(</span><span class="usertype">isa2_rm_type</span><span class="normal"> </span><span class="function">isa2_rm</span><span class="symbol">(</span><span class="normal">isa2_sr</span><span class="symbol">,</span><span class="normal"> </span><span class="function">less_pair_2nd</span><span class="symbol">(),</span><span class="normal"> ram_use </span><span class="symbol">/</span><span class="normal"> </span><span class="number">8</span><span class="symbol">);</span>
<span class="normal">                         </span><span class="symbol">!</span><span class="normal">isa2_rm</span><span class="symbol">.</span><span class="function">empty</span><span class="symbol">();</span><span class="normal"> </span><span class="symbol">++</span><span class="normal">isa2_rm</span><span class="symbol">)</span>
<span class="normal">                        </span><span class="function">DBG</span><span class="symbol">(</span><span class="normal">debug_isa</span><span class="symbol">,</span><span class="normal"> </span><span class="string">"ISA2: "</span><span class="normal"> </span><span class="symbol">&lt;&lt;</span><span class="normal"> </span><span class="symbol">*</span><span class="normal">isa2_rm</span><span class="symbol">);</span>
<span class="normal">                </span><span class="cbracket">}</span>

<span class="normal">                </span><span class="comment">// delete last subproblem</span>
<span class="normal">                </span><span class="keyword">delete</span><span class="normal"> vectors</span><span class="symbol">.</span><span class="function">back</span><span class="symbol">();</span>
<span class="normal">                vectors</span><span class="symbol">.</span><span class="function">pop_back</span><span class="symbol">();</span>
<span class="normal">            </span><span class="cbracket">}</span>

<span class="normal">            </span><span class="comment">// *************************************************************************************</span>
<span class="normal">            </span><span class="comment">// *** Final stage returning top suffix array</span>

<span class="normal">            </span><span class="function">DBG</span><span class="symbol">(</span><span class="normal">debug</span><span class="symbol">,</span><span class="normal"> </span><span class="string">"Merging final suffix array."</span><span class="symbol">);</span>

<span class="normal">            </span><span class="cbracket">{</span>
<span class="normal">                </span><span class="usertype">isa1_rm_type</span><span class="normal"> </span><span class="function">isa1_rm</span><span class="symbol">(</span><span class="normal">isa1_sr</span><span class="symbol">,</span><span class="normal"> </span><span class="function">less_pair_2nd</span><span class="symbol">(),</span><span class="normal"> ram_use </span><span class="symbol">/</span><span class="normal"> memdivA</span><span class="symbol">/</span><span class="number">2</span><span class="symbol">);</span>
<span class="normal">                </span><span class="usertype">isa2_rm_type</span><span class="normal"> </span><span class="function">isa2_rm</span><span class="symbol">(</span><span class="normal">isa2_sr</span><span class="symbol">,</span><span class="normal"> </span><span class="function">less_pair_2nd</span><span class="symbol">(),</span><span class="normal"> ram_use </span><span class="symbol">/</span><span class="normal"> memdivA</span><span class="symbol">/</span><span class="number">2</span><span class="symbol">);</span>

<span class="normal">                </span><span class="usertype">isa1_first_type</span><span class="normal"> </span><span class="function">isa1_first</span><span class="symbol">(</span><span class="normal">isa1_rm</span><span class="symbol">);</span>
<span class="normal">                </span><span class="usertype">isa2_first_type</span><span class="normal"> </span><span class="function">isa2_first</span><span class="symbol">(</span><span class="normal">isa2_rm</span><span class="symbol">);</span>

<span class="normal">                prev_array </span><span class="symbol">=</span><span class="normal"> vectors</span><span class="symbol">[</span><span class="normal">vectors</span><span class="symbol">.</span><span class="function">size</span><span class="symbol">()</span><span class="normal"> </span><span class="symbol">-</span><span class="normal"> </span><span class="number">2</span><span class="symbol">];</span><span class="normal"> </span><span class="comment">// this is the plain input string</span>

<span class="normal">                </span><span class="usertype">offset_array_it_rg</span><span class="normal"> </span><span class="function">source</span><span class="symbol">(</span><span class="normal">prev_array</span><span class="symbol">-&gt;</span><span class="function">begin</span><span class="symbol">(),</span><span class="normal"> prev_array</span><span class="symbol">-&gt;</span><span class="function">end</span><span class="symbol">());</span>

<span class="normal">                </span><span class="function">DBG</span><span class="symbol">(</span><span class="normal">debug</span><span class="symbol">,</span><span class="normal"> </span><span class="string">"Final build_sa: source "</span><span class="normal"> </span><span class="symbol">&lt;&lt;</span><span class="normal"> prev_array</span><span class="symbol">-&gt;</span><span class="function">size</span><span class="symbol">()</span><span class="normal"> </span><span class="symbol">&lt;&lt;</span><span class="normal"> </span><span class="string">" - mod1 "</span><span class="normal"> </span><span class="symbol">&lt;&lt;</span><span class="normal"> isa1_rm</span><span class="symbol">.</span><span class="function">size</span><span class="symbol">()</span><span class="normal"> </span><span class="symbol">&lt;&lt;</span><span class="normal"> </span><span class="string">" - mod2 "</span><span class="normal"> </span><span class="symbol">&lt;&lt;</span><span class="normal"> isa2_rm</span><span class="symbol">.</span><span class="function">size</span><span class="symbol">());</span>

<span class="preproc">#if</span><span class="normal"> </span><span class="symbol">!</span><span class="normal">LCP_CALC</span>

<span class="normal">                out_sa </span><span class="symbol">=</span><span class="normal"> </span><span class="keyword">new</span><span class="normal"> </span><span class="function">build_sa_loop_type</span><span class="symbol">(</span><span class="normal">source</span><span class="symbol">,</span><span class="normal"> isa1_first</span><span class="symbol">,</span><span class="normal"> isa2_first</span><span class="symbol">,</span><span class="normal"> prev_array</span><span class="symbol">-&gt;</span><span class="function">size</span><span class="symbol">());</span>

<span class="preproc">#else</span><span class="normal"> </span><span class="comment">// LCP_CALC</span>

<span class="normal">                uint8_array_type</span><span class="symbol">*</span><span class="normal"> lcp_base8 </span><span class="symbol">=</span><span class="normal"> </span><span class="keyword">new</span><span class="normal"> uint8_array_type</span><span class="symbol">;</span>
<span class="normal">                RMQ</span><span class="symbol">*</span><span class="normal"> lcp_rmq1 </span><span class="symbol">=</span><span class="normal"> </span><span class="keyword">new</span><span class="normal"> </span><span class="function">RMQ</span><span class="symbol">(</span><span class="normal">ram_use </span><span class="symbol">/</span><span class="normal"> memdivA</span><span class="symbol">);</span>
<span class="normal">                skew_pair_array_type</span><span class="symbol">*</span><span class="normal"> lcp_rmq1_ranks </span><span class="symbol">=</span><span class="normal"> </span><span class="keyword">new</span><span class="normal"> skew_pair_array_type</span><span class="symbol">;</span>

<span class="normal">                out_sa_array </span><span class="symbol">=</span><span class="normal"> </span><span class="keyword">new</span><span class="normal"> </span><span class="function">offset_array_type</span><span class="symbol">(</span><span class="normal">prev_array</span><span class="symbol">-&gt;</span><span class="function">size</span><span class="symbol">());</span>

<span class="normal">                </span><span class="cbracket">{</span>
<span class="normal">                    </span><span class="usertype">build_sa_loop_type</span><span class="normal"> </span><span class="function">get_sa</span><span class="symbol">(</span><span class="normal">source</span><span class="symbol">,</span><span class="normal"> isa1_first</span><span class="symbol">,</span><span class="normal"> isa2_first</span><span class="symbol">,</span><span class="normal"> prev_array</span><span class="symbol">-&gt;</span><span class="function">size</span><span class="symbol">(),</span>
<span class="normal">                                              </span><span class="symbol">*</span><span class="normal">lcp_base8</span><span class="symbol">,</span><span class="normal"> </span><span class="symbol">*</span><span class="normal">lcp_rmq1</span><span class="symbol">,</span><span class="normal"> </span><span class="symbol">*</span><span class="normal">lcp_rmq1_ranks</span><span class="symbol">);</span>

<span class="normal">                    </span><span class="comment">// read suffixarray into vector, this also creates the lcp_base all LCP-RMQs on</span>
<span class="normal">                    </span><span class="comment">// the recursive LCP array.</span>
<span class="normal">                    stream</span><span class="symbol">::</span><span class="function">materialize</span><span class="symbol">(</span><span class="normal">get_sa</span><span class="symbol">,</span><span class="normal"> out_sa_array</span><span class="symbol">-&gt;</span><span class="function">begin</span><span class="symbol">(),</span><span class="normal"> out_sa_array</span><span class="symbol">-&gt;</span><span class="function">end</span><span class="symbol">());</span>
<span class="normal">                </span><span class="cbracket">}</span>

<span class="normal">                isa1_rm</span><span class="symbol">.</span><span class="function">deallocate</span><span class="symbol">();</span>
<span class="normal">                isa2_rm</span><span class="symbol">.</span><span class="function">deallocate</span><span class="symbol">();</span>

<span class="normal">                </span><span class="function">assert</span><span class="symbol">(</span><span class="normal"> lcp_base8</span><span class="symbol">-&gt;</span><span class="function">size</span><span class="symbol">()</span><span class="normal"> </span><span class="symbol">==</span><span class="normal"> out_sa_array</span><span class="symbol">-&gt;</span><span class="function">size</span><span class="symbol">()</span><span class="normal"> </span><span class="symbol">);</span>
<span class="normal">                </span><span class="function">assert</span><span class="symbol">(</span><span class="normal"> vectors</span><span class="symbol">.</span><span class="function">back</span><span class="symbol">()-&gt;</span><span class="function">size</span><span class="symbol">()</span><span class="normal"> </span><span class="symbol">==</span><span class="normal"> lcp_name_vectors</span><span class="symbol">.</span><span class="function">back</span><span class="symbol">()-&gt;</span><span class="function">size</span><span class="symbol">()</span><span class="normal"> </span><span class="symbol">);</span>

<span class="normal">                prev_lcp </span><span class="symbol">=</span><span class="normal"> </span><span class="function">expand_build_lcp</span><span class="symbol">(</span><span class="normal">prev_lcp</span><span class="symbol">,</span><span class="normal"> prev_sa</span><span class="symbol">,</span><span class="normal"> isa1_sr</span><span class="symbol">,</span><span class="normal"> isa2_sr</span><span class="symbol">,</span>
<span class="normal">                                            </span><span class="symbol">*</span><span class="normal">lcp_name_vectors</span><span class="symbol">.</span><span class="function">back</span><span class="symbol">(),</span>
<span class="normal">                                            lcp_base8</span><span class="symbol">,</span><span class="normal"> lcp_rmq1</span><span class="symbol">,</span><span class="normal"> lcp_rmq1_ranks</span><span class="symbol">);</span>
<span class="normal">                prev_lcp</span><span class="symbol">-&gt;</span><span class="function">start_output</span><span class="symbol">(</span><span class="normal">ram_use </span><span class="symbol">/</span><span class="normal"> </span><span class="number">4</span><span class="symbol">);</span>

<span class="normal">                </span><span class="keyword">delete</span><span class="normal"> lcp_name_vectors</span><span class="symbol">.</span><span class="function">back</span><span class="symbol">();</span><span class="normal"> </span><span class="comment">// in build_lcp constructor the lcp_name RMQs are</span>
<span class="normal">                                                </span><span class="comment">// answered, so we can delete LCP_names here</span>
<span class="normal">                lcp_name_vectors</span><span class="symbol">.</span><span class="function">pop_back</span><span class="symbol">();</span>

<span class="normal">                out_sa </span><span class="symbol">=</span><span class="normal"> </span><span class="keyword">new</span><span class="normal"> </span><span class="function">offset_array_it_rg</span><span class="symbol">(</span><span class="normal">out_sa_array</span><span class="symbol">-&gt;</span><span class="function">begin</span><span class="symbol">(),</span><span class="normal"> out_sa_array</span><span class="symbol">-&gt;</span><span class="function">end</span><span class="symbol">());</span>
<span class="normal">                out_lcp </span><span class="symbol">=</span><span class="normal"> prev_lcp</span><span class="symbol">;</span>
<span class="preproc">#endif</span>
<span class="normal">            </span><span class="cbracket">}</span>

<span class="normal">            </span><span class="function">DBG</span><span class="symbol">(</span><span class="normal">debug</span><span class="symbol">,</span><span class="normal"> </span><span class="string">"Done with final merge."</span><span class="symbol">);</span>

<span class="normal">            </span><span class="function">DBGMEM</span><span class="symbol">(</span><span class="string">"done"</span><span class="symbol">);</span>
<span class="normal">        </span><span class="cbracket">}</span>

<span class="normal">        </span><span class="keyword">const</span><span class="normal"> value_type </span><span class="symbol">&amp;</span><span class="normal"> </span><span class="keyword">operator</span><span class="symbol">*()</span><span class="normal"> </span><span class="keyword">const</span>
<span class="normal">        </span><span class="cbracket">{</span>
<span class="normal">            </span><span class="keyword">return</span><span class="normal"> </span><span class="symbol">*(*</span><span class="normal">out_sa</span><span class="symbol">);</span>
<span class="normal">        </span><span class="cbracket">}</span>

<span class="preproc">#if</span><span class="normal"> LCP_CALC</span>
<span class="normal">        </span><span class="keyword">const</span><span class="normal"> value_type</span><span class="symbol">&amp;</span><span class="normal"> </span><span class="function">lcp</span><span class="symbol">()</span><span class="normal"> </span><span class="keyword">const</span>
<span class="normal">        </span><span class="cbracket">{</span>
<span class="normal">            </span><span class="keyword">return</span><span class="normal"> </span><span class="symbol">*(*</span><span class="normal">out_lcp</span><span class="symbol">);</span>
<span class="normal">        </span><span class="cbracket">}</span>
<span class="preproc">#endif</span><span class="normal"> </span><span class="comment">// LCP_CALC</span>

<span class="normal">        algorithm </span><span class="symbol">&amp;</span><span class="normal"> </span><span class="keyword">operator</span><span class="symbol">++()</span>
<span class="normal">        </span><span class="cbracket">{</span>
<span class="normal">            </span><span class="function">assert</span><span class="symbol">(!</span><span class="normal">out_sa</span><span class="symbol">-&gt;</span><span class="function">empty</span><span class="symbol">());</span>

<span class="normal">            </span><span class="symbol">++(*</span><span class="normal">out_sa</span><span class="symbol">);</span>
<span class="preproc">#if</span><span class="normal"> LCP_CALC</span>
<span class="normal">            </span><span class="symbol">++(*</span><span class="normal">out_lcp</span><span class="symbol">);</span>
<span class="preproc">#endif</span><span class="normal"> </span><span class="comment">// LCP_CALC</span>

<span class="normal">            </span><span class="keyword">if</span><span class="normal"> </span><span class="symbol">((</span><span class="normal">out_sa </span><span class="symbol">!=</span><span class="normal"> NULL</span><span class="symbol">)</span><span class="normal"> </span><span class="symbol">&amp;&amp;</span><span class="normal"> </span><span class="symbol">(</span><span class="normal">out_sa</span><span class="symbol">-&gt;</span><span class="function">empty</span><span class="symbol">()))</span><span class="normal"> </span><span class="cbracket">{</span>
<span class="normal">                finished </span><span class="symbol">=</span><span class="normal"> </span><span class="keyword">true</span><span class="symbol">;</span>
<span class="normal">                </span><span class="keyword">delete</span><span class="normal"> out_sa</span><span class="symbol">;</span><span class="normal"> out_sa </span><span class="symbol">=</span><span class="normal"> NULL</span><span class="symbol">;</span>
<span class="preproc">#if</span><span class="normal"> LCP_CALC</span>
<span class="normal">                </span><span class="keyword">delete</span><span class="normal"> out_sa_array</span><span class="symbol">;</span><span class="normal"> out_sa_array </span><span class="symbol">=</span><span class="normal"> NULL</span><span class="symbol">;</span>
<span class="normal">                </span><span class="keyword">delete</span><span class="normal"> out_lcp</span><span class="symbol">;</span><span class="normal"> out_lcp </span><span class="symbol">=</span><span class="normal"> NULL</span><span class="symbol">;</span>
<span class="preproc">#endif</span><span class="normal"> </span><span class="comment">// LCP_CALC</span>
<span class="normal">            </span><span class="cbracket">}</span>
<span class="normal">            </span><span class="keyword">return</span><span class="normal"> </span><span class="symbol">*</span><span class="keyword">this</span><span class="symbol">;</span>
<span class="normal">        </span><span class="cbracket">}</span>

<span class="normal">        </span><span class="type">bool</span><span class="normal"> </span><span class="function">empty</span><span class="symbol">()</span><span class="normal"> </span><span class="keyword">const</span>
<span class="normal">        </span><span class="cbracket">{</span>
<span class="normal">            </span><span class="keyword">return</span><span class="normal"> finished</span><span class="symbol">;</span>
<span class="normal">        </span><span class="cbracket">}</span>
<span class="normal">    </span><span class="cbracket">}</span><span class="symbol">;</span>
<span class="cbracket">}</span><span class="symbol">;</span>

<span class="keyword">template</span><span class="normal"> </span><span class="symbol">&lt;</span><span class="keyword">typename</span><span class="normal"> </span><span class="classname">StringContainer</span><span class="symbol">,</span><span class="normal"> </span><span class="keyword">typename</span><span class="normal"> </span><span class="classname">SuffixArrayContainer</span><span class="symbol">&gt;</span>
<span class="keyword">struct</span><span class="normal"> </span><span class="classname">SACA</span>
<span class="cbracket">{</span>
<span class="normal">    std</span><span class="symbol">::</span><span class="usertype">string</span><span class="normal"> </span><span class="function">name</span><span class="symbol">()</span>
<span class="normal">    </span><span class="cbracket">{</span>
<span class="preproc">#if</span><span class="normal"> </span><span class="symbol">!</span><span class="normal">LCP_CALC</span>
<span class="normal">        </span><span class="keyword">return</span><span class="normal"> </span><span class="string">"skew3"</span><span class="symbol">;</span>
<span class="preproc">#else</span><span class="normal"> </span><span class="comment">// LCP_CALC</span>
<span class="normal">        </span><span class="keyword">return</span><span class="normal"> </span><span class="string">"skew3-lcp"</span><span class="symbol">;</span>
<span class="preproc">#endif</span><span class="normal"> </span><span class="comment">// LCP_CALC</span>
<span class="normal">    </span><span class="cbracket">}</span>

<span class="normal">    </span><span class="type">void</span><span class="normal"> </span><span class="function">prepare</span><span class="symbol">(</span><span class="keyword">const</span><span class="normal"> StringContainer</span><span class="symbol">&amp;</span><span class="normal"> string</span><span class="symbol">,</span><span class="normal"> SuffixArrayContainer</span><span class="symbol">&amp;</span><span class="normal"> suffixarray</span><span class="symbol">,</span><span class="normal"> </span><span class="type">unsigned</span><span class="normal"> </span><span class="type">int</span><span class="normal"> K</span><span class="symbol">)</span>
<span class="normal">    </span><span class="cbracket">{</span>
<span class="normal">        stxxl</span><span class="symbol">::</span><span class="function">STXXL_UNUSED</span><span class="symbol">(</span><span class="normal">string</span><span class="symbol">);</span>
<span class="normal">        stxxl</span><span class="symbol">::</span><span class="function">STXXL_UNUSED</span><span class="symbol">(</span><span class="normal">suffixarray</span><span class="symbol">);</span>
<span class="normal">        stxxl</span><span class="symbol">::</span><span class="function">STXXL_UNUSED</span><span class="symbol">(</span><span class="normal">K</span><span class="symbol">);</span>
<span class="normal">    </span><span class="cbracket">}</span>

<span class="normal">    </span><span class="type">void</span><span class="normal"> </span><span class="function">run</span><span class="symbol">(</span><span class="keyword">const</span><span class="normal"> StringContainer</span><span class="symbol">&amp;</span><span class="normal"> string</span><span class="symbol">,</span><span class="normal"> SuffixArrayContainer</span><span class="symbol">&amp;</span><span class="normal"> suffixarray</span><span class="symbol">,</span><span class="normal"> </span><span class="type">unsigned</span><span class="normal"> </span><span class="type">int</span><span class="normal"> K</span><span class="symbol">)</span>
<span class="normal">    </span><span class="cbracket">{</span>
<span class="normal">        stxxl</span><span class="symbol">::</span><span class="function">STXXL_UNUSED</span><span class="symbol">(</span><span class="normal">K</span><span class="symbol">);</span>

<span class="normal">        </span><span class="keyword">typedef</span><span class="normal"> </span><span class="keyword">typename</span><span class="normal"> </span><span class="classname">StringContainer</span><span class="symbol">::</span><span class="usertype">value_type</span><span class="normal"> alphabet_type</span><span class="symbol">;</span>
<span class="normal">        </span><span class="keyword">typedef</span><span class="normal"> </span><span class="keyword">typename</span><span class="normal"> </span><span class="classname">SuffixArrayContainer</span><span class="symbol">::</span><span class="usertype">value_type</span><span class="normal"> offset_type</span><span class="symbol">;</span>

<span class="normal">        </span><span class="keyword">typedef</span><span class="normal"> stxxl</span><span class="symbol">::</span><span class="normal">stream</span><span class="symbol">::</span><span class="usertype">vector_iterator2stream&lt; typename StringContainer::const_iterator &gt;</span><span class="normal"> input_type</span><span class="symbol">;</span>
<span class="normal">        </span><span class="keyword">typedef</span><span class="normal"> </span><span class="keyword">typename</span><span class="normal"> </span><span class="classname">skew</span><span class="symbol">&lt;</span><span class="normal">offset_type</span><span class="symbol">&gt;::</span><span class="keyword">template</span><span class="normal"> </span><span class="usertype">algorithm&lt;input_type&gt;</span><span class="normal"> saca_type</span><span class="symbol">;</span>

<span class="normal">        </span><span class="usertype">input_type</span><span class="normal"> input </span><span class="symbol">=</span><span class="normal"> </span><span class="function">input_type</span><span class="symbol">(</span><span class="normal">string</span><span class="symbol">.</span><span class="function">begin</span><span class="symbol">(),</span><span class="normal"> string</span><span class="symbol">.</span><span class="function">end</span><span class="symbol">());</span>
<span class="normal">        </span><span class="usertype">saca_type</span><span class="normal"> </span><span class="function">saca</span><span class="symbol">(</span><span class="normal">input</span><span class="symbol">);</span>
<span class="normal">        stxxl</span><span class="symbol">::</span><span class="normal">stream</span><span class="symbol">::</span><span class="function">materialize</span><span class="symbol">(</span><span class="normal">saca</span><span class="symbol">,</span><span class="normal"> suffixarray</span><span class="symbol">.</span><span class="function">begin</span><span class="symbol">(),</span><span class="normal"> suffixarray</span><span class="symbol">.</span><span class="function">end</span><span class="symbol">());</span>
<span class="normal">    </span><span class="cbracket">}</span>

<span class="preproc">#if</span><span class="normal"> LCP_CALC</span>
<span class="normal">    </span><span class="keyword">template</span><span class="normal"> </span><span class="symbol">&lt;</span><span class="keyword">typename</span><span class="normal"> </span><span class="classname">LCPArrayContainer</span><span class="symbol">&gt;</span>
<span class="normal">    </span><span class="type">void</span><span class="normal"> </span><span class="function">run_lcp</span><span class="symbol">(</span><span class="keyword">const</span><span class="normal"> StringContainer</span><span class="symbol">&amp;</span><span class="normal"> string</span><span class="symbol">,</span><span class="normal"> SuffixArrayContainer</span><span class="symbol">&amp;</span><span class="normal"> suffixarray</span><span class="symbol">,</span><span class="normal"> LCPArrayContainer</span><span class="symbol">&amp;</span><span class="normal"> lcparray</span><span class="symbol">,</span><span class="normal"> </span><span class="type">unsigned</span><span class="normal"> </span><span class="type">int</span><span class="normal"> </span><span class="comment">/* K */</span><span class="symbol">)</span>
<span class="normal">    </span><span class="cbracket">{</span>
<span class="normal">        </span><span class="keyword">typedef</span><span class="normal"> </span><span class="keyword">typename</span><span class="normal"> </span><span class="classname">StringContainer</span><span class="symbol">::</span><span class="usertype">value_type</span><span class="normal"> alphabet_type</span><span class="symbol">;</span>
<span class="normal">        </span><span class="keyword">typedef</span><span class="normal"> </span><span class="keyword">typename</span><span class="normal"> </span><span class="classname">SuffixArrayContainer</span><span class="symbol">::</span><span class="usertype">value_type</span><span class="normal"> offset_type</span><span class="symbol">;</span>

<span class="normal">        </span><span class="keyword">typedef</span><span class="normal"> stxxl</span><span class="symbol">::</span><span class="normal">stream</span><span class="symbol">::</span><span class="usertype">vector_iterator2stream&lt; typename StringContainer::const_iterator &gt;</span><span class="normal"> input_type</span><span class="symbol">;</span>
<span class="normal">        </span><span class="keyword">typedef</span><span class="normal"> </span><span class="keyword">typename</span><span class="normal"> </span><span class="classname">skew</span><span class="symbol">&lt;</span><span class="normal">offset_type</span><span class="symbol">&gt;::</span><span class="keyword">template</span><span class="normal"> </span><span class="usertype">algorithm&lt;input_type&gt;</span><span class="normal"> saca_type</span><span class="symbol">;</span>

<span class="normal">        </span><span class="usertype">input_type</span><span class="normal"> input </span><span class="symbol">=</span><span class="normal"> </span><span class="function">input_type</span><span class="symbol">(</span><span class="normal">string</span><span class="symbol">.</span><span class="function">begin</span><span class="symbol">(),</span><span class="normal"> string</span><span class="symbol">.</span><span class="function">end</span><span class="symbol">());</span>
<span class="normal">        </span><span class="usertype">saca_type</span><span class="normal"> </span><span class="function">saca</span><span class="symbol">(</span><span class="normal">input</span><span class="symbol">);</span>

<span class="normal">        stxxl</span><span class="symbol">::</span><span class="usertype">vector_bufwriter&lt;SuffixArrayContainer&gt;</span><span class="normal"> </span><span class="function">sa_writer</span><span class="normal"> </span><span class="symbol">(</span><span class="normal">suffixarray</span><span class="symbol">.</span><span class="function">begin</span><span class="symbol">(),</span><span class="normal"> suffixarray</span><span class="symbol">.</span><span class="function">end</span><span class="symbol">());</span>
<span class="normal">        stxxl</span><span class="symbol">::</span><span class="usertype">vector_bufwriter&lt;LCPArrayContainer&gt;</span><span class="normal"> </span><span class="function">lcp_writer</span><span class="normal"> </span><span class="symbol">(</span><span class="normal">lcparray</span><span class="symbol">.</span><span class="function">begin</span><span class="symbol">(),</span><span class="normal"> lcparray</span><span class="symbol">.</span><span class="function">end</span><span class="symbol">());</span>

<span class="normal">        </span><span class="keyword">for</span><span class="normal"> </span><span class="symbol">(</span><span class="usertype">size_t</span><span class="normal"> i </span><span class="symbol">=</span><span class="normal"> </span><span class="number">0</span><span class="symbol">;</span><span class="normal"> </span><span class="symbol">!</span><span class="normal">saca</span><span class="symbol">.</span><span class="function">empty</span><span class="symbol">();</span><span class="normal"> </span><span class="symbol">++</span><span class="normal">saca</span><span class="symbol">,</span><span class="normal"> </span><span class="symbol">++</span><span class="normal">i</span><span class="symbol">)</span>
<span class="normal">        </span><span class="cbracket">{</span>
<span class="normal">            </span><span class="comment">//std::cout &lt;&lt; "SA[" &lt;&lt; i &lt;&lt; "] = " &lt;&lt; operator*() &lt;&lt; " - LCP[" &lt;&lt; i &lt;&lt; "] = " &lt;&lt; lcp() &lt;&lt; "\n";</span>
<span class="normal">            sa_writer </span><span class="symbol">&lt;&lt;</span><span class="normal"> </span><span class="symbol">*</span><span class="normal">saca</span><span class="symbol">;</span>
<span class="normal">            lcp_writer </span><span class="symbol">&lt;&lt;</span><span class="normal"> saca</span><span class="symbol">.</span><span class="function">lcp</span><span class="symbol">();</span>
<span class="normal">        </span><span class="cbracket">}</span>
<span class="normal">    </span><span class="cbracket">}</span>
<span class="preproc">#endif</span><span class="normal"> </span><span class="comment">// LCP_CALC</span>
<span class="cbracket">}</span><span class="symbol">;</span>

<span class="cbracket">}</span><span class="normal"> </span><span class="comment">// namespace skew</span>
</tt></pre></div><div style="text-align: right; padding: 8pt; font-size: 13px"><a href="/xmlfeed/weblog-rss20.xml"><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAFAAAAAPAgMAAAAOp6AcAAAADFBMVEVmZmb/ZgD///+JjnlbTUWmAAAACXBIWXMAAABIAAAASABGyWs+AAAACXZwQWcAAABQAAAADwCexKkxAAAAWUlEQVQYlWNgwAa0VmGAFQyqoSCQ/x8J/CBFMCt0ZdTU/F/7/+1HEkydFpoKVPn+93sUlUujQvP/7UcRTAuNDJ2a//s/imDqtKVZofm/1qGYSZk7sfodGwAAiobBJtffoNAAAAAASUVORK5CYII=" alt="RSS 2.0 Weblog Feed" width="80" height="15"/></a> <a href="/xmlfeed/weblog-atom10.xml"><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAFAAAAAPAgMAAAAOp6AcAAAADFBMVEVmZmb/ZgD///+JjnlbTUWmAAAAaklEQVQYlWNgwAa0VmGAFQyqoSCQ/x8J/CBFMDV16rTQ/H/7V//69+//v/3/9oMEI6cuAwr+fv/+/b5d///v//0eJBgWOhMo+Gs9UPAdXDBy6lSYyn9wQZCZS0GCYDPXQcykzJ1Y/Y4NAABKvL80wyoMPgAAAABJRU5ErkJggg==" alt="Atom 1.0 Weblog Feed" width="80" height="15"/></a> <a href="http://validator.w3.org/check?uri=referer"><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAFAAAAAPCAMAAABEF7i9AAAB1FBMVEUHQIgIRY0MN4QNRYoSRYsXUpIYVJQeUpUhWpgjUJMjWpgmU5QnXJkuYZ0uYpwwV5YyZJ4zaKM3ZaA5aaI6aqM6a6E8ZqA8Z6BAbaRBbqdCbaVHd61KSkpKcaZQUFBUf69UgbBVVVVXfq9Yg7NZhbJZh7RagrNeXVxeh7RfjLdgYGBiiLZmZmZnZ2doirhpkbt0m8F3m8B3ncJ5lb55ocR+ocSDgX+Do8eEpMqGhoaHp8iIpMeJjnmJpseKqMeOqsqPsdCQrcyVlZWVsM2Zs9CZtNCfu9ahoaGhuNShudSivNSjtMWjvNSmpqWnpqSrw9qvxNqyxdmyxdyzsK6zs7Ozx9y0xt21yN22tra4y+K80eK/v7/AwMDExMTEy9DH2ejK2+jM2ujN3uvP0dLR0NDR3uvS3uvS3+zU4u3V1dXY2dnY4u7Y4+3b5e/d3d3d5u/d5/De3t7f39/h4uLj4uHj6/Ll7PXm7fTn7/Xo7/Tp7/bq7Ozr6unr8ffw8PDw9vvx9fny+P7z8/Pz9vnz9vv3+fv4+vz5+vz6+vr6+/36/P36///7+/77/Pz7/f37/f78/Pz8/f38/f79/f39/f79/f/9/v79///+/v7+/v////3///+tYR2LAAABKklEQVQ4y2PQoTJg0JlNVYDPQBsyAMTAqaFes8tdsmdPCtA3MDStr3GKKK6myMAprgJ9pcpWs/MlRExYJBvNZLR0sigycHYOV1S7mtjsQJ4gf+HIFPXoWMs6qIGzIRiKZs9GFoEaMRuZhhrYqqJXy8uZYauRxC/VHew7e3YTPAxnI5swG6JxNrKBNjB1EFmIgV0+HA6C8pqqzhXG7BbJJROQIwViMYQ7G2oDQQNn57JyG7kxiCfObrBmS5+BHMuYLkTzMnYDm5WY4lOZZRPKZocxes+aPbuwCFsYohiICLvZsKBAMrDTQ7K/StveU8icTzrOL8JdLpOyWJ49u8Bx9ozw8DY7UYW03hhdxZAOSg2c3jN79rSJs1vSKmfOnpFXNJmynELlvExlAADnaZpLFGEC2wAAAABJRU5ErkJggg==" alt="Valid XHTML 1.1" width="80" height="15"/></a> <a href="http://jigsaw.w3.org/css-validator/check/referer"><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAFAAAAAPCAMAAABEF7i9AAAB1FBMVEUHQIgIRY0MN4QNRYoSRYsXUpIYVJQeUpUhWpgjUJMjWpgmU5QnXJkuYZ0uYpwwV5YyZJ4zaKM3ZaA5aaI6aqM6a6E8ZqA8Z6BAbaRBbqdCbaVHd61KSkpKcaZQUFBUf69UgbBVVVVXfq9Yg7NZhbJZh7RagrNeXVxeh7RfjLdgYGBiiLZmZmZnZ2doirhpkbt0m8F3m8B3ncJ5lb55ocR+ocSDgX+Do8eEpMqGhoaHp8iIpMeJjnmJpseKqMeOqsqPsdCQrcyVlZWVsM2Zs9CZtNCfu9ahoaGhuNShudSivNSjtMWjvNSmpqWnpqSrw9qvxNqyxdmyxdyzsK6zs7Ozx9y0xt21yN22tra4y+K80eK/v7/AwMDExMTEy9DH2ejK2+jM2ujN3uvP0dLR0NDR3uvS3uvS3+zU4u3V1dXY2dnY4u7Y4+3b5e/d3d3d5u/d5/De3t7f39/h4uLj4uHj6/Ll7PXm7fTn7/Xo7/Tp7/bq7Ozr6unr8ffw8PDw9vvx9fny+P7z8/Pz9vnz9vv3+fv4+vz5+vz6+vr6+/36/P36///7+/77/Pz7/f37/f78/Pz8/f38/f79/f39/f79/f/9/v79///+/v7+/v////3///+tYR2LAAABEUlEQVQ4y2PQoTJg0JlNVYDPQBsyAMTAqaFes8tdsmdPCtA3MDStr3GKKK6myMAprgJ9pcpWs/MlRExYJBvNZLR0sigycHYOV1S7mtjsQJ4gf+HIFPXoWMs6mIEQCsIjwhKoga0qerW8nBm2Gkn8Ut3BvrNnN8HCcDYM2cBIogzs8uFwEJTXVHWuMGa3SC6ZgIgUqCEwdxJr4OxcVm4jNwbxxNkN1mzpM2ajGIjsPGK9PLtZiSk+lVk2oWx2GKP3rNmzC4tQwpDoIIQb2Okh2V+lbe8pZM4nHecX4S6XSVksz55d4Dh7Rnh4m52oQlpvjK5iSAelBk7vmT172sTZLWmVM2fPyCuaTFlOoXJepjIAANlljDGY/l5pAAAAAElFTkSuQmCC" alt="Valid CSS (2.1)" width="80" height="15"/></a><br/>Copyright 2005-2019 <a href="/about/">Timo Bingmann</a> - <a href="/about/impressum.html">Impressum</a></div></body></html>