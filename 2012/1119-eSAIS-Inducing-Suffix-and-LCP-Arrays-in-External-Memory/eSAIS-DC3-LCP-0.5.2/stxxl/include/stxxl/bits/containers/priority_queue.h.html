<?xml version="1.0" encoding="iso-8859-1"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta content="text/html; charset=iso-8859-1" http-equiv="content-type" /><meta name="viewport" content="initial-scale=1"><title>/2012/1119-eSAIS-Inducing-Suffix-and-LCP-Arrays-in-External-Memory/eSAIS-DC3-LCP-0.5.2/stxxl/include/stxxl/bits/containers/priority_queue.h - panthema.net</title><link rel="stylesheet" type="text/css" href="/css/base.css" /><link rel="stylesheet" type="text/css" href="/css/fonts.css" /><link rel="alternate" type="application/rss+xml" title="panthema.net Weblog Feed RSS 2.0" href="http://panthema.net/xmlfeed/weblog-rss20.xml" /><link rel="alternate" type="application/atom+xml" title="panthema.net Weblog Feed Atom 1.0" href="http://panthema.net/xmlfeed/weblog-atom10.xml" /><script type="text/javascript" src="/js/base.js"></script><script type="text/javascript">/* <!-- */makeIEHover = function() {var lis = document.getElementById('ptnav').getElementsByTagName('li');for (var i = 0; i < lis.length; i++) {lis[i].onmouseover = function() {this.className += ' sfhover';};lis[i].onmouseout = function() {this.className = this.className.replace(new RegExp(' sfhover\b'), '');};}};if (window.attachEvent) window.attachEvent('onload', makeIEHover);/* --> */</script></head><body style="background-image: url(/img/bgfractal1.jpg)" lang="en"><div class="pttopbar"><div style="float: right"><ul id="ptnav"><li class="top"><a class="ni" href="/"><i class="icon-book"></i> Weblog</a><ul style="margin-left: -6px; margin-top: 4px" class="nx"><li><a href="/2019/">2019</a></li><li><a href="/2018/">2018</a></li><li><a href="/2017/">2017</a></li><li><a href="/2016/">2016</a></li><li><a href="/2015/">2015</a></li><li><a href="/2014/">2014</a></li><li><a href="/2013/">2013</a></li><li><a href="/2012/">2012</a></li><li><a href="/2011/">2011</a></li><li><a href="/2010/">2010</a></li><li><a href="/2009/">2009</a></li><li><a href="/2008/">2008</a></li><li><a href="/2007/">2007</a></li><li><a href="/2006/">2006</a></li><li class="nt"><a href="/2005/">2005</a></li><li class="ns"><a href="/xmlfeed/weblog-rss20.xml">RSS Feed</a></li><li class="nt"><a href="/xmlfeed/weblog-atom10.xml">XML Atom</a></li><li class="ns"><a href="/search.html">Search</a></li></ul></li><li class="top"><a class="ni" href="/tags/"><i class="icon-tags"></i> Tags</a><div style="width: 14em; margin-left: -9em; margin-top: 4px"><a style="font-size: 10pt" href="/tags/algebra.html">algebra</a> <a style="font-size: 16pt" href="/tags/c++.html">c++</a> <a style="font-size: 12pt" href="/tags/code-example.html">code-example</a> <a style="font-size: 14pt" href="/tags/code-snippet.html">code-snippet</a> <a style="font-size: 11pt" href="/tags/coding_tricks.html">coding tricks</a> <a style="font-size: 10pt" href="/tags/compsci.html">compsci</a> <a style="font-size: 10pt" href="/tags/compsci_study_thesis.html">compsci study thesis</a> <a style="font-size: 9pt" href="/tags/crypto-speedtest.html">crypto-speedtest</a> <a style="font-size: 10pt" href="/tags/cryptography.html">cryptography</a> <a style="font-size: 9pt" href="/tags/cryptote.html">cryptote</a> <a style="font-size: 11pt" href="/tags/dissertation.html">dissertation</a> <a style="font-size: 10pt" href="/tags/electronics.html">electronics</a> <a style="font-size: 12pt" href="/tags/flex-bison-cpp-example.html">flex-bison-cpp-example</a> <a style="font-size: 16pt" href="/tags/frontpage.html">frontpage</a> <a style="font-size: 15pt" href="/tags/fun.html">fun</a> <a style="font-size: 10pt" href="/tags/graphviz.html">graphviz</a> <a style="font-size: 9pt" href="http://www.hmtg.de">hartmetall</a> <a style="font-size: 9pt" href="/tags/helppc.html">helppc</a> <a style="font-size: 9pt" href="/tags/hifi_selbstbau.html">hifi selbstbau</a> <a style="font-size: 10pt" href="/tags/latex.html">latex</a> <a style="font-size: 10pt" href="/tags/LEDs.html">LEDs</a> <a style="font-size: 10pt" href="/tags/librivox.html">librivox</a> <a style="font-size: 10pt" href="/tags/linux.html">linux</a> <a style="font-size: 9pt" href="/tags/market.html">market</a> <a style="font-size: 9pt" href="/tags/massive-sorting.html">massive-sorting</a> <a style="font-size: 11pt" href="/tags/maths.html">maths</a> <a style="font-size: 9pt" href="/tags/music.html">music</a> <a style="font-size: 10pt" href="/tags/netfundamentals.html">netfundamentals</a> <a style="font-size: 11pt" href="/tags/ns-3.html">ns-3</a> <a style="font-size: 10pt" href="/tags/parallel-string-sorting.html">parallel-string-sorting</a> <a style="font-size: 14pt" href="/tags/parsing.html">parsing</a> <a style="font-size: 9pt" href="/tags/qtsqlview.html">qtsqlview</a> <a style="font-size: 14pt" href="/tags/research.html">research</a> <a style="font-size: 11pt" href="/tags/sdios06.html">sdios06</a> <a style="font-size: 9pt" href="/tags/sdlfractal.html">sdlfractal</a> <a style="font-size: 16pt" href="/tags/sorting.html">sorting</a> <a style="font-size: 13pt" href="/tags/sound_of_sorting.html">sound of sorting</a> <a style="font-size: 10pt" href="/tags/stringology.html">stringology</a> <a style="font-size: 16pt" href="/tags/stx-btree.html">stx-btree</a> <a style="font-size: 16pt" href="/tags/stxxl.html">stxxl</a> <a style="font-size: 16pt" href="/tags/talk.html">talk</a> <a style="font-size: 15pt" href="/tags/thrill.html">thrill</a> <a style="font-size: 10pt" href="/tags/tutorium.html">tutorium</a> <a style="font-size: 16pt" href="/tags/university.html">university</a> <a style="font-size: 13pt" href="/tags/utilities.html">utilities</a> <a style="font-size: 10pt" href="/tags/vncrec.html">vncrec</a> <a style="font-size: 9pt" href="/tags/webdesign.html">webdesign</a> </div></li><li class="top"> <a class="ni" href="#"><i class="icon-cubes"></i> Projects</a> <ul style="margin-left: -8em; margin-top: 4px;" class="nx"> <li><a href="/2019/1008-COBS-A-Compact-Bit-Sliced-Signature-Index/">COBS</a></li> <li><a href="/2009/cryptote/">CryptoTE</a></li> <li><a href="/2009/digup/">digup</a></li> <li><a href="/2013/disk-filltest/">disk-filltest</a></li> <li><a href="/2012/1119-eSAIS-Inducing-Suffix-and-LCP-Arrays-in-External-Memory/">eSAIS-LCP</a></li> <li><a href="/2007/flex-bison-cpp-example/">Flex Bison C++ Example</a></li> <li><a href="/2013/malloc_count/">malloc_count</a></li> <li><a href="/2016/0114-diploma-thesis/">On Bispanning Graphs</a></li> <li><a href="/2013/pmbw/">Parallel Memory Bandwidth</a></li> <li><a href="/2013/parallel-string-sorting/">Parallel String Sorting</a></li> <li><a href="/2014/sqlplot-tools/">SqlPlotTools</a></li> <li><a href="/2013/sound-of-sorting/">The Sound of Sorting</a></li> <li><a href="/2007/stx-btree/">STX B+ Tree</a></li> <li><a href="/2010/stx-cbtreedb/">STX Constant BTreeDB</a></li> <li><a href="/2010/stx-execpipe/">STX ExecPipe</a></li> <li><a href="/2007/stx-exparser/">STX Expression Parser</a></li> <li><a href="/tags/stxxl.html">STXXL 1.4</a></li> <li><a href="/tags/thrill.html">Thrill - Big Data Framework</a></li> <li class="nt"><a href="/2014/vncrec-rgb/">VNCrec RGB 0.4</a></li> <li class="ns"><a href="/search.html">Search</a></li> </ul></li><li class="top"> <a class="ni" href="/publications.html"><i class="icon-graduation-cap"></i> Publications</a></li><li class="top"> <a class="ni" href="/about/"><i class="icon-info-circled"></i> About</a> <ul style="margin-left: -6em; margin-top: 4px" class="nx"> <li><a href="/about/">Timo Bingmann</a></li> <li><a href="/about/impressum.html">Impressum</a></li> </ul></li><li class="top"> <a class="ni" href="/subscribe.html"><i class="icon-rss-squared"></i> Subscribe</a></li></ul></div><div style="padding: 6px"><a href="/">panthema</a>  / <a href="/2012/">2012</a> / <a href="/2012/1119-eSAIS-Inducing-Suffix-and-LCP-Arrays-in-External-Memory/">1119-eSAIS-Inducing-Suffix-and-LCP-Arrays-in-External-Memory</a> / <a href="/2012/1119-eSAIS-Inducing-Suffix-and-LCP-Arrays-in-External-Memory/eSAIS-DC3-LCP-0.5.2/">eSAIS-DC3-LCP-0.5.2</a> / <a href="/2012/1119-eSAIS-Inducing-Suffix-and-LCP-Arrays-in-External-Memory/eSAIS-DC3-LCP-0.5.2/stxxl/">stxxl</a> / <a href="/2012/1119-eSAIS-Inducing-Suffix-and-LCP-Arrays-in-External-Memory/eSAIS-DC3-LCP-0.5.2/stxxl/include/">include</a> / <a href="/2012/1119-eSAIS-Inducing-Suffix-and-LCP-Arrays-in-External-Memory/eSAIS-DC3-LCP-0.5.2/stxxl/include/stxxl/">stxxl</a> / <a href="/2012/1119-eSAIS-Inducing-Suffix-and-LCP-Arrays-in-External-Memory/eSAIS-DC3-LCP-0.5.2/stxxl/include/stxxl/bits/">bits</a> / <a href="/2012/1119-eSAIS-Inducing-Suffix-and-LCP-Arrays-in-External-Memory/eSAIS-DC3-LCP-0.5.2/stxxl/include/stxxl/bits/containers/">containers</a> / <a href="/2012/1119-eSAIS-Inducing-Suffix-and-LCP-Arrays-in-External-Memory/eSAIS-DC3-LCP-0.5.2/stxxl/include/stxxl/bits/containers/priority_queue.h.html">priority_queue.h</a> (<a href="/2012/1119-eSAIS-Inducing-Suffix-and-LCP-Arrays-in-External-Memory/eSAIS-DC3-LCP-0.5.2/stxxl/include/stxxl/bits/containers/priority_queue.h">Download File</a>)</div></div><div class="ptfullwidth"><pre class="codesnippet" style="font-family: monospace"><tt><span class="comment">/***************************************************************************</span>
<span class="comment"> *  include/stxxl/bits/containers/priority_queue.h</span>
<span class="comment"> *</span>
<span class="comment"> *  Part of the STXXL. See </span><span class="url">http://stxxl.sourceforge.net</span>
<span class="comment"> *</span>
<span class="comment"> *  Copyright (C) 1999 Peter Sanders </span><span class="url">&lt;sanders@mpi-sb.mpg.de&gt;</span>
<span class="comment"> *  Copyright (C) 2003, 2004, 2007 Roman Dementiev </span><span class="url">&lt;dementiev@mpi-sb.mpg.de&gt;</span>
<span class="comment"> *  Copyright (C) 2007-2009 Johannes Singler </span><span class="url">&lt;singler@ira.uka.de&gt;</span>
<span class="comment"> *  Copyright (C) 2007-2010 Andreas Beckmann </span><span class="url">&lt;beckmann@cs.uni-frankfurt.de&gt;</span>
<span class="comment"> *</span>
<span class="comment"> *  Distributed under the Boost Software License, Version 1.0.</span>
<span class="comment"> *  (See accompanying file LICENSE_1_0.txt or copy at</span>
<span class="comment"> *  </span><span class="url">http://www.boost.org/LICENSE_1_0.txt</span><span class="comment">)</span>
<span class="comment"> **************************************************************************/</span>

<span class="preproc">#ifndef</span><span class="normal"> STXXL_PRIORITY_QUEUE_HEADER</span>
<span class="preproc">#define</span><span class="normal"> STXXL_PRIORITY_QUEUE_HEADER</span>

<span class="preproc">#include</span><span class="normal"> </span><span class="string">&lt;vector&gt;</span>

<span class="preproc">#include</span><span class="normal"> </span><span class="string">&lt;stxxl/bits/deprecated.h&gt;</span>
<span class="preproc">#include</span><span class="normal"> </span><span class="string">&lt;stxxl/bits/mng/typed_block.h&gt;</span>
<span class="preproc">#include</span><span class="normal"> </span><span class="string">&lt;stxxl/bits/mng/block_alloc.h&gt;</span>
<span class="preproc">#include</span><span class="normal"> </span><span class="string">&lt;stxxl/bits/mng/read_write_pool.h&gt;</span>
<span class="preproc">#include</span><span class="normal"> </span><span class="string">&lt;stxxl/bits/mng/prefetch_pool.h&gt;</span>
<span class="preproc">#include</span><span class="normal"> </span><span class="string">&lt;stxxl/bits/mng/write_pool.h&gt;</span>
<span class="preproc">#include</span><span class="normal"> </span><span class="string">&lt;stxxl/bits/common/tmeta.h&gt;</span>
<span class="preproc">#include</span><span class="normal"> </span><span class="string">&lt;stxxl/bits/algo/sort_base.h&gt;</span>
<span class="preproc">#include</span><span class="normal"> </span><span class="string">&lt;stxxl/bits/parallel.h&gt;</span>
<span class="preproc">#include</span><span class="normal"> </span><span class="string">&lt;stxxl/bits/common/is_sorted.h&gt;</span>

<span class="preproc">#if</span><span class="normal"> STXXL_PARALLEL</span>

<span class="preproc">#if</span><span class="normal"> </span><span class="function">defined</span><span class="symbol">(</span><span class="normal">STXXL_PARALLEL_MODE</span><span class="symbol">)</span><span class="normal"> </span><span class="symbol">&amp;&amp;</span><span class="normal"> </span><span class="symbol">((</span><span class="normal">__GNUC__ </span><span class="symbol">*</span><span class="normal"> </span><span class="number">10000</span><span class="normal"> </span><span class="symbol">+</span><span class="normal"> __GNUC_MINOR__ </span><span class="symbol">*</span><span class="normal"> </span><span class="number">100</span><span class="symbol">)</span><span class="normal"> </span><span class="symbol">&lt;</span><span class="normal"> </span><span class="number">40400</span><span class="symbol">)</span>
<span class="preproc">#undef</span><span class="normal"> STXXL_PARALLEL_PQ_MULTIWAY_MERGE_INTERNAL</span>
<span class="preproc">#undef</span><span class="normal"> STXXL_PARALLEL_PQ_MULTIWAY_MERGE_EXTERNAL</span>
<span class="preproc">#undef</span><span class="normal"> STXXL_PARALLEL_PQ_MULTIWAY_MERGE_DELETE_BUFFER</span>
<span class="preproc">#define</span><span class="normal"> STXXL_PARALLEL_PQ_MULTIWAY_MERGE_INTERNAL </span><span class="number">0</span>
<span class="preproc">#define</span><span class="normal"> STXXL_PARALLEL_PQ_MULTIWAY_MERGE_EXTERNAL </span><span class="number">0</span>
<span class="preproc">#define</span><span class="normal"> STXXL_PARALLEL_PQ_MULTIWAY_MERGE_DELETE_BUFFER </span><span class="number">0</span>
<span class="preproc">#endif</span>

<span class="comment">// enable/disable parallel merging for certain cases, for performance tuning</span>
<span class="preproc">#ifndef</span><span class="normal"> STXXL_PARALLEL_PQ_MULTIWAY_MERGE_INTERNAL</span>
<span class="preproc">#define</span><span class="normal"> STXXL_PARALLEL_PQ_MULTIWAY_MERGE_INTERNAL </span><span class="number">1</span>
<span class="preproc">#endif</span>
<span class="preproc">#ifndef</span><span class="normal"> STXXL_PARALLEL_PQ_MULTIWAY_MERGE_EXTERNAL</span>
<span class="preproc">#define</span><span class="normal"> STXXL_PARALLEL_PQ_MULTIWAY_MERGE_EXTERNAL </span><span class="number">1</span>
<span class="preproc">#endif</span>
<span class="preproc">#ifndef</span><span class="normal"> STXXL_PARALLEL_PQ_MULTIWAY_MERGE_DELETE_BUFFER</span>
<span class="preproc">#define</span><span class="normal"> STXXL_PARALLEL_PQ_MULTIWAY_MERGE_DELETE_BUFFER </span><span class="number">1</span>
<span class="preproc">#endif</span>

<span class="preproc">#endif</span><span class="normal"> </span><span class="comment">//STXXL_PARALLEL</span>

<span class="preproc">#if</span><span class="normal"> STXXL_PARALLEL </span><span class="symbol">&amp;&amp;</span><span class="normal"> STXXL_PARALLEL_PQ_MULTIWAY_MERGE_EXTERNAL</span>
<span class="preproc">#define</span><span class="normal"> STXXL_PQ_EXTERNAL_LOSER_TREE </span><span class="number">0</span><span class="normal"> </span><span class="comment">// no loser tree for the external sequences</span>
<span class="preproc">#else</span>
<span class="preproc">#define</span><span class="normal"> STXXL_PQ_EXTERNAL_LOSER_TREE </span><span class="number">1</span>
<span class="preproc">#endif</span>

<span class="preproc">#if</span><span class="normal"> STXXL_PARALLEL </span><span class="symbol">&amp;&amp;</span><span class="normal"> STXXL_PARALLEL_PQ_MULTIWAY_MERGE_INTERNAL</span>
<span class="preproc">#define</span><span class="normal"> STXXL_PQ_INTERNAL_LOSER_TREE </span><span class="number">0</span><span class="normal"> </span><span class="comment">// no loser tree for the internal sequences</span>
<span class="preproc">#else</span>
<span class="preproc">#define</span><span class="normal"> STXXL_PQ_INTERNAL_LOSER_TREE </span><span class="number">1</span>
<span class="preproc">#endif</span>

<span class="preproc">#define</span><span class="normal"> </span><span class="function">STXXL_VERBOSE_PQ</span><span class="symbol">(</span><span class="normal">msg</span><span class="symbol">)</span><span class="normal"> </span><span class="function">STXXL_VERBOSE2</span><span class="symbol">(</span><span class="string">"["</span><span class="normal"> </span><span class="symbol">&lt;&lt;</span><span class="normal"> </span><span class="keyword">static_cast</span><span class="symbol">&lt;</span><span class="type">void</span><span class="normal"> </span><span class="symbol">*&gt;(</span><span class="keyword">this</span><span class="symbol">)</span><span class="normal"> </span><span class="symbol">&lt;&lt;</span><span class="normal"> </span><span class="string">"] priority_queue::"</span><span class="normal"> </span><span class="symbol">&lt;&lt;</span><span class="normal"> msg</span><span class="symbol">)</span>

<span class="preproc">#include</span><span class="normal"> </span><span class="string">&lt;stxxl/bits/containers/pq_helpers.h&gt;</span>
<span class="preproc">#include</span><span class="normal"> </span><span class="string">&lt;stxxl/bits/containers/pq_mergers.h&gt;</span>
<span class="preproc">#include</span><span class="normal"> </span><span class="string">&lt;stxxl/bits/containers/pq_ext_merger.h&gt;</span>
<span class="preproc">#include</span><span class="normal"> </span><span class="string">&lt;stxxl/bits/containers/pq_losertree.h&gt;</span>

<span class="normal">__STXXL_BEGIN_NAMESPACE</span>

<span class="comment">/*</span>
<span class="comment">   KNBufferSize1 = 32;</span>
<span class="comment">   KNN = 512; // length of group 1 sequences</span>
<span class="comment">   KNKMAX = 64;  // maximal arity</span>
<span class="comment">   LogKNKMAX = 6;  // ceil(log KNKMAX)</span>
<span class="comment">   KNLevels = 4; // overall capacity &gt;= KNN*KNKMAX^KNLevels</span>
<span class="comment"> */</span>

<span class="comment">// internal memory consumption &gt;= N_*(KMAX_^IntLevels_) + ext</span>

<span class="keyword">template</span><span class="normal"> </span><span class="symbol">&lt;</span>
<span class="normal">    </span><span class="keyword">class</span><span class="normal"> </span><span class="classname">Tp_</span><span class="symbol">,</span>
<span class="normal">    </span><span class="keyword">class</span><span class="normal"> </span><span class="classname">Cmp_</span><span class="symbol">,</span>
<span class="normal">    </span><span class="type">unsigned</span><span class="normal"> BufferSize1_ </span><span class="symbol">=</span><span class="normal"> </span><span class="number">32</span><span class="symbol">,</span><span class="normal">                    </span><span class="comment">// equalize procedure call overheads etc.</span>
<span class="normal">    </span><span class="type">unsigned</span><span class="normal"> N_ </span><span class="symbol">=</span><span class="normal"> </span><span class="number">512</span><span class="symbol">,</span><span class="normal">                             </span><span class="comment">// length of group 1 sequences</span>
<span class="normal">    </span><span class="type">unsigned</span><span class="normal"> IntKMAX_ </span><span class="symbol">=</span><span class="normal"> </span><span class="number">64</span><span class="symbol">,</span><span class="normal">                        </span><span class="comment">// maximal arity for internal mergers</span>
<span class="normal">    </span><span class="type">unsigned</span><span class="normal"> IntLevels_ </span><span class="symbol">=</span><span class="normal"> </span><span class="number">4</span><span class="symbol">,</span><span class="normal">                       </span><span class="comment">// number of internal groups</span>
<span class="normal">    </span><span class="type">unsigned</span><span class="normal"> BlockSize_ </span><span class="symbol">=</span><span class="normal"> </span><span class="symbol">(</span><span class="number">2</span><span class="normal"> </span><span class="symbol">*</span><span class="normal"> </span><span class="number">1024</span><span class="normal"> </span><span class="symbol">*</span><span class="normal"> </span><span class="number">1024</span><span class="symbol">),</span><span class="normal">       </span><span class="comment">// external block size</span>
<span class="normal">    </span><span class="type">unsigned</span><span class="normal"> ExtKMAX_ </span><span class="symbol">=</span><span class="normal"> </span><span class="number">64</span><span class="symbol">,</span><span class="normal">                        </span><span class="comment">// maximal arity for external mergers</span>
<span class="normal">    </span><span class="type">unsigned</span><span class="normal"> ExtLevels_ </span><span class="symbol">=</span><span class="normal"> </span><span class="number">2</span><span class="symbol">,</span><span class="normal">                       </span><span class="comment">// number of external groups</span>
<span class="normal">    </span><span class="keyword">class</span><span class="normal"> </span><span class="classname">AllocStr_</span><span class="normal"> </span><span class="symbol">=</span><span class="normal"> STXXL_DEFAULT_ALLOC_STRATEGY</span>
<span class="normal">    </span><span class="symbol">&gt;</span>
<span class="keyword">struct</span><span class="normal"> </span><span class="classname">priority_queue_config</span>
<span class="cbracket">{</span>
<span class="normal">    </span><span class="keyword">typedef</span><span class="normal"> </span><span class="usertype">Tp_</span><span class="normal"> value_type</span><span class="symbol">;</span>
<span class="normal">    </span><span class="keyword">typedef</span><span class="normal"> </span><span class="usertype">Cmp_</span><span class="normal"> comparator_type</span><span class="symbol">;</span>
<span class="normal">    </span><span class="keyword">typedef</span><span class="normal"> </span><span class="usertype">AllocStr_</span><span class="normal"> alloc_strategy_type</span><span class="symbol">;</span>
<span class="normal">    </span><span class="keyword">enum</span>
<span class="normal">    </span><span class="cbracket">{</span>
<span class="normal">        delete_buffer_size </span><span class="symbol">=</span><span class="normal"> BufferSize1_</span><span class="symbol">,</span>
<span class="normal">        N </span><span class="symbol">=</span><span class="normal"> N_</span><span class="symbol">,</span>
<span class="normal">        IntKMAX </span><span class="symbol">=</span><span class="normal"> IntKMAX_</span><span class="symbol">,</span>
<span class="normal">        num_int_groups </span><span class="symbol">=</span><span class="normal"> IntLevels_</span><span class="symbol">,</span>
<span class="normal">        num_ext_groups </span><span class="symbol">=</span><span class="normal"> ExtLevels_</span><span class="symbol">,</span>
<span class="normal">        BlockSize </span><span class="symbol">=</span><span class="normal"> BlockSize_</span><span class="symbol">,</span>
<span class="normal">        ExtKMAX </span><span class="symbol">=</span><span class="normal"> ExtKMAX_</span><span class="symbol">,</span>
<span class="normal">        element_size </span><span class="symbol">=</span><span class="normal"> </span><span class="keyword">sizeof</span><span class="symbol">(</span><span class="normal">Tp_</span><span class="symbol">)</span>
<span class="normal">    </span><span class="cbracket">}</span><span class="symbol">;</span>
<span class="cbracket">}</span><span class="symbol">;</span>

<span class="normal">__STXXL_END_NAMESPACE</span>

<span class="keyword">namespace</span><span class="normal"> std</span>
<span class="cbracket">{</span>
<span class="normal">    </span><span class="keyword">template</span><span class="normal"> </span><span class="symbol">&lt;</span><span class="keyword">class</span><span class="normal"> </span><span class="classname">BlockType_</span><span class="symbol">,</span>
<span class="normal">              </span><span class="keyword">class</span><span class="normal"> </span><span class="classname">Cmp_</span><span class="symbol">,</span>
<span class="normal">              </span><span class="type">unsigned</span><span class="normal"> Arity_</span><span class="symbol">,</span>
<span class="normal">              </span><span class="keyword">class</span><span class="normal"> </span><span class="classname">AllocStr_</span><span class="symbol">&gt;</span>
<span class="normal">    </span><span class="type">void</span><span class="normal"> </span><span class="function">swap</span><span class="symbol">(</span><span class="normal">stxxl</span><span class="symbol">::</span><span class="normal">priority_queue_local</span><span class="symbol">::</span><span class="normal">ext_merger</span><span class="symbol">&lt;</span><span class="normal">BlockType_</span><span class="symbol">,</span><span class="normal"> Cmp_</span><span class="symbol">,</span><span class="normal"> Arity_</span><span class="symbol">,</span><span class="normal"> AllocStr_</span><span class="symbol">&gt;</span><span class="normal"> </span><span class="symbol">&amp;</span><span class="normal"> a</span><span class="symbol">,</span>
<span class="normal">              stxxl</span><span class="symbol">::</span><span class="normal">priority_queue_local</span><span class="symbol">::</span><span class="normal">ext_merger</span><span class="symbol">&lt;</span><span class="normal">BlockType_</span><span class="symbol">,</span><span class="normal"> Cmp_</span><span class="symbol">,</span><span class="normal"> Arity_</span><span class="symbol">,</span><span class="normal"> AllocStr_</span><span class="symbol">&gt;</span><span class="normal"> </span><span class="symbol">&amp;</span><span class="normal"> b</span><span class="symbol">)</span>
<span class="normal">    </span><span class="cbracket">{</span>
<span class="normal">        a</span><span class="symbol">.</span><span class="function">swap</span><span class="symbol">(</span><span class="normal">b</span><span class="symbol">);</span>
<span class="normal">    </span><span class="cbracket">}</span>
<span class="normal">    </span><span class="keyword">template</span><span class="normal"> </span><span class="symbol">&lt;</span><span class="keyword">class</span><span class="normal"> </span><span class="classname">ValTp_</span><span class="symbol">,</span><span class="normal"> </span><span class="keyword">class</span><span class="normal"> </span><span class="classname">Cmp_</span><span class="symbol">,</span><span class="normal"> </span><span class="type">unsigned</span><span class="normal"> KNKMAX</span><span class="symbol">&gt;</span>
<span class="normal">    </span><span class="type">void</span><span class="normal"> </span><span class="function">swap</span><span class="symbol">(</span><span class="normal">stxxl</span><span class="symbol">::</span><span class="normal">priority_queue_local</span><span class="symbol">::</span><span class="normal">loser_tree</span><span class="symbol">&lt;</span><span class="normal">ValTp_</span><span class="symbol">,</span><span class="normal"> Cmp_</span><span class="symbol">,</span><span class="normal"> KNKMAX</span><span class="symbol">&gt;</span><span class="normal"> </span><span class="symbol">&amp;</span><span class="normal"> a</span><span class="symbol">,</span>
<span class="normal">              stxxl</span><span class="symbol">::</span><span class="normal">priority_queue_local</span><span class="symbol">::</span><span class="normal">loser_tree</span><span class="symbol">&lt;</span><span class="normal">ValTp_</span><span class="symbol">,</span><span class="normal"> Cmp_</span><span class="symbol">,</span><span class="normal"> KNKMAX</span><span class="symbol">&gt;</span><span class="normal"> </span><span class="symbol">&amp;</span><span class="normal"> b</span><span class="symbol">)</span>
<span class="normal">    </span><span class="cbracket">{</span>
<span class="normal">        a</span><span class="symbol">.</span><span class="function">swap</span><span class="symbol">(</span><span class="normal">b</span><span class="symbol">);</span>
<span class="normal">    </span><span class="cbracket">}</span>
<span class="cbracket">}</span>

<span class="normal">__STXXL_BEGIN_NAMESPACE</span>

<span class="comment">//! \brief External priority queue data structure</span>
<span class="keyword">template</span><span class="normal"> </span><span class="symbol">&lt;</span><span class="keyword">class</span><span class="normal"> </span><span class="classname">Config_</span><span class="symbol">&gt;</span>
<span class="keyword">class</span><span class="normal"> </span><span class="classname">priority_queue</span><span class="normal"> </span><span class="symbol">:</span><span class="normal"> </span><span class="keyword">private</span><span class="normal"> noncopyable</span>
<span class="cbracket">{</span>
<span class="keyword">public</span><span class="symbol">:</span>
<span class="normal">    </span><span class="keyword">typedef</span><span class="normal"> </span><span class="usertype">Config_</span><span class="normal"> Config</span><span class="symbol">;</span>
<span class="normal">    </span><span class="keyword">enum</span>
<span class="normal">    </span><span class="cbracket">{</span>
<span class="normal">        delete_buffer_size </span><span class="symbol">=</span><span class="normal"> Config</span><span class="symbol">::</span><span class="normal">delete_buffer_size</span><span class="symbol">,</span>
<span class="normal">        N </span><span class="symbol">=</span><span class="normal"> Config</span><span class="symbol">::</span><span class="normal">N</span><span class="symbol">,</span>
<span class="normal">        IntKMAX </span><span class="symbol">=</span><span class="normal"> Config</span><span class="symbol">::</span><span class="normal">IntKMAX</span><span class="symbol">,</span>
<span class="normal">        num_int_groups </span><span class="symbol">=</span><span class="normal"> Config</span><span class="symbol">::</span><span class="normal">num_int_groups</span><span class="symbol">,</span>
<span class="normal">        num_ext_groups </span><span class="symbol">=</span><span class="normal"> Config</span><span class="symbol">::</span><span class="normal">num_ext_groups</span><span class="symbol">,</span>
<span class="normal">        total_num_groups </span><span class="symbol">=</span><span class="normal"> Config</span><span class="symbol">::</span><span class="normal">num_int_groups </span><span class="symbol">+</span><span class="normal"> Config</span><span class="symbol">::</span><span class="normal">num_ext_groups</span><span class="symbol">,</span>
<span class="normal">        BlockSize </span><span class="symbol">=</span><span class="normal"> Config</span><span class="symbol">::</span><span class="normal">BlockSize</span><span class="symbol">,</span>
<span class="normal">        ExtKMAX </span><span class="symbol">=</span><span class="normal"> Config</span><span class="symbol">::</span><span class="normal">ExtKMAX</span>
<span class="normal">    </span><span class="cbracket">}</span><span class="symbol">;</span>

<span class="normal">    </span><span class="comment">//! \brief The type of object stored in the \b priority_queue</span>
<span class="normal">    </span><span class="keyword">typedef</span><span class="normal"> </span><span class="keyword">typename</span><span class="normal"> </span><span class="classname">Config</span><span class="symbol">::</span><span class="usertype">value_type</span><span class="normal"> value_type</span><span class="symbol">;</span>
<span class="normal">    </span><span class="comment">//! \brief Comparison object</span>
<span class="normal">    </span><span class="keyword">typedef</span><span class="normal"> </span><span class="keyword">typename</span><span class="normal"> </span><span class="classname">Config</span><span class="symbol">::</span><span class="usertype">comparator_type</span><span class="normal"> comparator_type</span><span class="symbol">;</span>
<span class="normal">    </span><span class="keyword">typedef</span><span class="normal"> </span><span class="keyword">typename</span><span class="normal"> </span><span class="classname">Config</span><span class="symbol">::</span><span class="usertype">alloc_strategy_type</span><span class="normal"> alloc_strategy_type</span><span class="symbol">;</span>
<span class="normal">    </span><span class="comment">//! \brief An unsigned integral type (64 bit)</span>
<span class="normal">    </span><span class="keyword">typedef</span><span class="normal"> stxxl</span><span class="symbol">::</span><span class="usertype">uint64</span><span class="normal"> size_type</span><span class="symbol">;</span>
<span class="normal">    </span><span class="keyword">typedef</span><span class="normal"> </span><span class="usertype">typed_block&lt;BlockSize, value_type&gt;</span><span class="normal"> block_type</span><span class="symbol">;</span>
<span class="normal">    </span><span class="keyword">typedef</span><span class="normal"> </span><span class="usertype">read_write_pool&lt;block_type&gt;</span><span class="normal"> pool_type</span><span class="symbol">;</span>

<span class="keyword">protected</span><span class="symbol">:</span>
<span class="normal">    </span><span class="keyword">typedef</span><span class="normal"> priority_queue_local</span><span class="symbol">::</span><span class="normal">internal_priority_queue</span><span class="symbol">&lt;</span><span class="normal">value_type</span><span class="symbol">,</span><span class="normal"> std</span><span class="symbol">::</span><span class="normal">vector</span><span class="symbol">&lt;</span><span class="normal">value_type</span><span class="symbol">&gt;,</span><span class="normal"> comparator_type</span><span class="symbol">&gt;</span>
<span class="normal">    insert_heap_type</span><span class="symbol">;</span>

<span class="normal">    </span><span class="keyword">typedef</span><span class="normal"> priority_queue_local</span><span class="symbol">::</span><span class="normal">loser_tree</span><span class="symbol">&lt;</span>
<span class="normal">        value_type</span><span class="symbol">,</span>
<span class="normal">        comparator_type</span><span class="symbol">,</span>
<span class="normal">        IntKMAX</span><span class="symbol">&gt;</span><span class="normal"> int_merger_type</span><span class="symbol">;</span>

<span class="normal">    </span><span class="keyword">typedef</span><span class="normal"> priority_queue_local</span><span class="symbol">::</span><span class="normal">ext_merger</span><span class="symbol">&lt;</span>
<span class="normal">        block_type</span><span class="symbol">,</span>
<span class="normal">        comparator_type</span><span class="symbol">,</span>
<span class="normal">        ExtKMAX</span><span class="symbol">,</span>
<span class="normal">        alloc_strategy_type</span><span class="symbol">&gt;</span><span class="normal"> ext_merger_type</span><span class="symbol">;</span>


<span class="normal">    </span><span class="usertype">int_merger_type</span><span class="normal"> int_mergers</span><span class="symbol">[</span><span class="normal">num_int_groups</span><span class="symbol">];</span>
<span class="normal">    pool_type </span><span class="symbol">*</span><span class="normal"> pool</span><span class="symbol">;</span>
<span class="normal">    </span><span class="type">bool</span><span class="normal"> pool_owned</span><span class="symbol">;</span>
<span class="normal">    ext_merger_type </span><span class="symbol">**</span><span class="normal"> ext_mergers</span><span class="symbol">;</span>

<span class="normal">    </span><span class="comment">// one delete buffer for each tree =&gt; group buffer</span>
<span class="normal">    </span><span class="usertype">value_type</span><span class="normal"> group_buffers</span><span class="symbol">[</span><span class="normal">total_num_groups</span><span class="symbol">][</span><span class="normal">N </span><span class="symbol">+</span><span class="normal"> </span><span class="number">1</span><span class="symbol">];</span><span class="normal">          </span><span class="comment">// tree-&gt;group_buffers-&gt;delete_buffer (extra space for sentinel)</span>
<span class="normal">    value_type </span><span class="symbol">*</span><span class="normal"> group_buffer_current_mins</span><span class="symbol">[</span><span class="normal">total_num_groups</span><span class="symbol">];</span><span class="normal">   </span><span class="comment">// group_buffer_current_mins[i] is current start of group_buffers[i], end is group_buffers[i] + N</span>

<span class="normal">    </span><span class="comment">// overall delete buffer</span>
<span class="normal">    </span><span class="usertype">value_type</span><span class="normal"> delete_buffer</span><span class="symbol">[</span><span class="normal">delete_buffer_size </span><span class="symbol">+</span><span class="normal"> </span><span class="number">1</span><span class="symbol">];</span>
<span class="normal">    value_type </span><span class="symbol">*</span><span class="normal"> delete_buffer_current_min</span><span class="symbol">;</span><span class="normal">                     </span><span class="comment">// current start of delete_buffer</span>
<span class="normal">    value_type </span><span class="symbol">*</span><span class="normal"> delete_buffer_end</span><span class="symbol">;</span><span class="normal">                             </span><span class="comment">// end of delete_buffer</span>

<span class="normal">    </span><span class="usertype">comparator_type</span><span class="normal"> cmp</span><span class="symbol">;</span>

<span class="normal">    </span><span class="comment">// insert buffer</span>
<span class="normal">    </span><span class="usertype">insert_heap_type</span><span class="normal"> insert_heap</span><span class="symbol">;</span>

<span class="normal">    </span><span class="comment">// how many groups are active</span>
<span class="normal">    </span><span class="usertype">unsigned_type</span><span class="normal"> num_active_groups</span><span class="symbol">;</span>

<span class="normal">    </span><span class="comment">// total size not counting insert_heap and delete_buffer</span>
<span class="normal">    </span><span class="usertype">size_type</span><span class="normal"> size_</span><span class="symbol">;</span>

<span class="keyword">private</span><span class="symbol">:</span>
<span class="normal">    </span><span class="type">void</span><span class="normal"> </span><span class="function">init</span><span class="symbol">();</span>

<span class="normal">    </span><span class="type">void</span><span class="normal"> </span><span class="function">refill_delete_buffer</span><span class="symbol">();</span>
<span class="normal">    </span><span class="usertype">unsigned_type</span><span class="normal"> </span><span class="function">refill_group_buffer</span><span class="symbol">(</span><span class="usertype">unsigned_type</span><span class="normal"> k</span><span class="symbol">);</span>

<span class="normal">    </span><span class="usertype">unsigned_type</span><span class="normal"> </span><span class="function">make_space_available</span><span class="symbol">(</span><span class="usertype">unsigned_type</span><span class="normal"> level</span><span class="symbol">);</span>
<span class="normal">    </span><span class="type">void</span><span class="normal"> </span><span class="function">empty_insert_heap</span><span class="symbol">();</span>

<span class="normal">    </span><span class="usertype">value_type</span><span class="normal"> </span><span class="function">get_supremum</span><span class="symbol">()</span><span class="normal"> </span><span class="keyword">const</span><span class="normal"> </span><span class="cbracket">{</span><span class="normal"> </span><span class="keyword">return</span><span class="normal"> cmp</span><span class="symbol">.</span><span class="function">min_value</span><span class="symbol">();</span><span class="normal"> </span><span class="cbracket">}</span><span class="normal"> </span><span class="comment">//{ return group_buffers[0][KNN].key; }</span>
<span class="normal">    </span><span class="usertype">unsigned_type</span><span class="normal"> </span><span class="function">current_delete_buffer_size</span><span class="symbol">()</span><span class="normal"> </span><span class="keyword">const</span><span class="normal"> </span><span class="cbracket">{</span><span class="normal"> </span><span class="keyword">return</span><span class="normal"> delete_buffer_end </span><span class="symbol">-</span><span class="normal"> delete_buffer_current_min</span><span class="symbol">;</span><span class="normal"> </span><span class="cbracket">}</span>
<span class="normal">    </span><span class="usertype">unsigned_type</span><span class="normal"> </span><span class="function">current_group_buffer_size</span><span class="symbol">(</span><span class="usertype">unsigned_type</span><span class="normal"> i</span><span class="symbol">)</span><span class="normal"> </span><span class="keyword">const</span><span class="normal"> </span><span class="cbracket">{</span><span class="normal"> </span><span class="keyword">return</span><span class="normal"> </span><span class="symbol">&amp;(</span><span class="normal">group_buffers</span><span class="symbol">[</span><span class="normal">i</span><span class="symbol">][</span><span class="normal">N</span><span class="symbol">])</span><span class="normal"> </span><span class="symbol">-</span><span class="normal"> group_buffer_current_mins</span><span class="symbol">[</span><span class="normal">i</span><span class="symbol">];</span><span class="normal"> </span><span class="cbracket">}</span>

<span class="keyword">public</span><span class="symbol">:</span>
<span class="normal">    </span><span class="comment">//! \brief Constructs external priority queue object</span>
<span class="normal">    </span><span class="comment">//! \param pool_ pool of blocks that will be used</span>
<span class="normal">    </span><span class="comment">//! for data writing and prefetching for the disk&lt;-&gt;memory transfers</span>
<span class="normal">    </span><span class="comment">//! happening in the priority queue. Larger pool size</span>
<span class="normal">    </span><span class="comment">//! helps to speed up operations.</span>
<span class="normal">    </span><span class="function">priority_queue</span><span class="symbol">(</span><span class="normal">pool_type </span><span class="symbol">&amp;</span><span class="normal"> pool_</span><span class="symbol">);</span>

<span class="normal">    </span><span class="comment">//! \brief Constructs external priority queue object</span>
<span class="normal">    </span><span class="comment">//! \param p_pool_ pool of blocks that will be used</span>
<span class="normal">    </span><span class="comment">//! for data prefetching for the disk&lt;-&gt;memory transfers</span>
<span class="normal">    </span><span class="comment">//! happening in the priority queue. Larger pool size</span>
<span class="normal">    </span><span class="comment">//! helps to speed up operations.</span>
<span class="normal">    </span><span class="comment">//! \param w_pool_ pool of blocks that will be used</span>
<span class="normal">    </span><span class="comment">//! for writing data for the memory&lt;-&gt;disk transfers</span>
<span class="normal">    </span><span class="comment">//! happening in the priority queue. Larger pool size</span>
<span class="normal">    </span><span class="comment">//! helps to speed up operations.</span>
<span class="normal">    </span><span class="function">_STXXL_DEPRECATED</span><span class="symbol">(</span><span class="function">priority_queue</span><span class="symbol">(</span><span class="normal">prefetch_pool</span><span class="symbol">&lt;</span><span class="normal">block_type</span><span class="symbol">&gt;</span><span class="normal"> </span><span class="symbol">&amp;</span><span class="normal"> p_pool_</span><span class="symbol">,</span><span class="normal"> write_pool</span><span class="symbol">&lt;</span><span class="normal">block_type</span><span class="symbol">&gt;</span><span class="normal"> </span><span class="symbol">&amp;</span><span class="normal"> w_pool_</span><span class="symbol">));</span>

<span class="normal">    </span><span class="comment">//! \brief Constructs external priority queue object</span>
<span class="normal">    </span><span class="comment">//! \param p_pool_mem memory (in bytes) for prefetch pool that will be used</span>
<span class="normal">    </span><span class="comment">//! for data prefetching for the disk&lt;-&gt;memory transfers</span>
<span class="normal">    </span><span class="comment">//! happening in the priority queue. Larger pool size</span>
<span class="normal">    </span><span class="comment">//! helps to speed up operations.</span>
<span class="normal">    </span><span class="comment">//! \param w_pool_mem memory (in bytes) for buffered write pool that will be used</span>
<span class="normal">    </span><span class="comment">//! for writing data for the memory&lt;-&gt;disk transfers</span>
<span class="normal">    </span><span class="comment">//! happening in the priority queue. Larger pool size</span>
<span class="normal">    </span><span class="comment">//! helps to speed up operations.</span>
<span class="normal">    </span><span class="function">priority_queue</span><span class="symbol">(</span><span class="usertype">unsigned_type</span><span class="normal"> p_pool_mem</span><span class="symbol">,</span><span class="normal"> </span><span class="usertype">unsigned_type</span><span class="normal"> w_pool_mem</span><span class="symbol">);</span>

<span class="preproc">#if</span><span class="normal"> </span><span class="number">0</span>
<span class="normal">    </span><span class="comment">//! \brief swap this priority queue with another one</span>
<span class="normal">    </span><span class="comment">//! Implementation correctness is questionable.</span>
<span class="normal">    </span><span class="type">void</span><span class="normal"> </span><span class="function">swap</span><span class="symbol">(</span><span class="normal">priority_queue </span><span class="symbol">&amp;</span><span class="normal"> obj</span><span class="symbol">)</span>
<span class="normal">    </span><span class="cbracket">{</span>
<span class="normal">        </span><span class="comment">//swap_1D_arrays(int_mergers,obj.int_mergers,num_int_groups); // does not work in g++ 3.4.3 :( bug?</span>
<span class="normal">        </span><span class="keyword">for</span><span class="normal"> </span><span class="symbol">(</span><span class="usertype">unsigned_type</span><span class="normal"> i </span><span class="symbol">=</span><span class="normal"> </span><span class="number">0</span><span class="symbol">;</span><span class="normal"> i </span><span class="symbol">&lt;</span><span class="normal"> num_int_groups</span><span class="symbol">;</span><span class="normal"> </span><span class="symbol">++</span><span class="normal">i</span><span class="symbol">)</span>
<span class="normal">            std</span><span class="symbol">::</span><span class="function">swap</span><span class="symbol">(</span><span class="normal">int_mergers</span><span class="symbol">[</span><span class="normal">i</span><span class="symbol">],</span><span class="normal"> obj</span><span class="symbol">.</span><span class="normal">int_mergers</span><span class="symbol">[</span><span class="normal">i</span><span class="symbol">]);</span>

<span class="normal">        </span><span class="comment">//std::swap(pool,obj.pool);</span>
<span class="normal">        </span><span class="comment">//std::swap(pool_owned, obj.pool_owned);</span>
<span class="normal">        std</span><span class="symbol">::</span><span class="function">swap</span><span class="symbol">(</span><span class="normal">ext_mergers</span><span class="symbol">,</span><span class="normal"> obj</span><span class="symbol">.</span><span class="normal">ext_mergers</span><span class="symbol">);</span>
<span class="normal">        </span><span class="keyword">for</span><span class="normal"> </span><span class="symbol">(</span><span class="usertype">unsigned_type</span><span class="normal"> i1 </span><span class="symbol">=</span><span class="normal"> </span><span class="number">0</span><span class="symbol">;</span><span class="normal"> i1 </span><span class="symbol">&lt;</span><span class="normal"> total_num_groups</span><span class="symbol">;</span><span class="normal"> </span><span class="symbol">++</span><span class="normal">i1</span><span class="symbol">)</span>
<span class="normal">            </span><span class="keyword">for</span><span class="normal"> </span><span class="symbol">(</span><span class="usertype">unsigned_type</span><span class="normal"> i2 </span><span class="symbol">=</span><span class="normal"> </span><span class="number">0</span><span class="symbol">;</span><span class="normal"> i2 </span><span class="symbol">&lt;</span><span class="normal"> </span><span class="symbol">(</span><span class="normal">N </span><span class="symbol">+</span><span class="normal"> </span><span class="number">1</span><span class="symbol">);</span><span class="normal"> </span><span class="symbol">++</span><span class="normal">i2</span><span class="symbol">)</span>
<span class="normal">                std</span><span class="symbol">::</span><span class="function">swap</span><span class="symbol">(</span><span class="normal">group_buffers</span><span class="symbol">[</span><span class="normal">i1</span><span class="symbol">][</span><span class="normal">i2</span><span class="symbol">],</span><span class="normal"> obj</span><span class="symbol">.</span><span class="normal">group_buffers</span><span class="symbol">[</span><span class="normal">i1</span><span class="symbol">][</span><span class="normal">i2</span><span class="symbol">]);</span>

<span class="normal">        </span><span class="function">STXXL_STATIC_ASSERT</span><span class="symbol">(</span><span class="keyword">false</span><span class="symbol">);</span>
<span class="normal">        </span><span class="comment">// Shoot yourself in the foot: group_buffer_current_mins contains pointers into group_buffers ...</span>
<span class="normal">        </span><span class="comment">// either recompute them or add/subtract (&amp;this-&gt;group_buffers[0][0] - &amp;obj-&gt;group_buffers[0][0])</span>
<span class="normal">        </span><span class="function">swap_1D_arrays</span><span class="symbol">(</span><span class="normal">group_buffer_current_mins</span><span class="symbol">,</span><span class="normal"> obj</span><span class="symbol">.</span><span class="normal">group_buffer_current_mins</span><span class="symbol">,</span><span class="normal"> total_num_groups</span><span class="symbol">);</span>
<span class="normal">        </span><span class="function">swap_1D_arrays</span><span class="symbol">(</span><span class="normal">delete_buffer</span><span class="symbol">,</span><span class="normal"> obj</span><span class="symbol">.</span><span class="normal">delete_buffer</span><span class="symbol">,</span><span class="normal"> delete_buffer_size </span><span class="symbol">+</span><span class="normal"> </span><span class="number">1</span><span class="symbol">);</span>
<span class="normal">        std</span><span class="symbol">::</span><span class="function">swap</span><span class="symbol">(</span><span class="normal">delete_buffer_current_min</span><span class="symbol">,</span><span class="normal"> obj</span><span class="symbol">.</span><span class="normal">delete_buffer_current_min</span><span class="symbol">);</span>
<span class="normal">        std</span><span class="symbol">::</span><span class="function">swap</span><span class="symbol">(</span><span class="normal">delete_buffer_end</span><span class="symbol">,</span><span class="normal"> obj</span><span class="symbol">.</span><span class="normal">delete_buffer_end</span><span class="symbol">);</span>
<span class="normal">        std</span><span class="symbol">::</span><span class="function">swap</span><span class="symbol">(</span><span class="normal">cmp</span><span class="symbol">,</span><span class="normal"> obj</span><span class="symbol">.</span><span class="normal">cmp</span><span class="symbol">);</span>
<span class="normal">        std</span><span class="symbol">::</span><span class="function">swap</span><span class="symbol">(</span><span class="normal">insert_heap</span><span class="symbol">,</span><span class="normal"> obj</span><span class="symbol">.</span><span class="normal">insert_heap</span><span class="symbol">);</span>
<span class="normal">        std</span><span class="symbol">::</span><span class="function">swap</span><span class="symbol">(</span><span class="normal">num_active_groups</span><span class="symbol">,</span><span class="normal"> obj</span><span class="symbol">.</span><span class="normal">num_active_groups</span><span class="symbol">);</span>
<span class="normal">        std</span><span class="symbol">::</span><span class="function">swap</span><span class="symbol">(</span><span class="normal">size_</span><span class="symbol">,</span><span class="normal"> obj</span><span class="symbol">.</span><span class="normal">size_</span><span class="symbol">);</span>
<span class="normal">    </span><span class="cbracket">}</span>
<span class="preproc">#endif</span>

<span class="normal">    </span><span class="keyword">virtual</span><span class="normal"> </span><span class="symbol">~</span><span class="function">priority_queue</span><span class="symbol">();</span>

<span class="normal">    </span><span class="comment">//! \brief Returns number of elements contained</span>
<span class="normal">    </span><span class="comment">//! \return number of elements contained</span>
<span class="normal">    </span><span class="usertype">size_type</span><span class="normal"> </span><span class="function">size</span><span class="symbol">()</span><span class="normal"> </span><span class="keyword">const</span><span class="symbol">;</span>

<span class="normal">    </span><span class="comment">//! \brief Returns true if queue has no elements</span>
<span class="normal">    </span><span class="comment">//! \return \b true if queue has no elements, \b false otherwise</span>
<span class="normal">    </span><span class="type">bool</span><span class="normal"> </span><span class="function">empty</span><span class="symbol">()</span><span class="normal"> </span><span class="keyword">const</span><span class="normal"> </span><span class="cbracket">{</span><span class="normal"> </span><span class="keyword">return</span><span class="normal"> </span><span class="symbol">(</span><span class="function">size</span><span class="symbol">()</span><span class="normal"> </span><span class="symbol">==</span><span class="normal"> </span><span class="number">0</span><span class="symbol">);</span><span class="normal"> </span><span class="cbracket">}</span>

<span class="normal">    </span><span class="comment">//! \brief Returns "largest" element</span>
<span class="normal">    </span><span class="comment">//!</span>
<span class="normal">    </span><span class="comment">//! Returns a const reference to the element at the</span>
<span class="normal">    </span><span class="comment">//! top of the priority_queue. The element at the top is</span>
<span class="normal">    </span><span class="comment">//! guaranteed to be the largest element in the \b priority queue,</span>
<span class="normal">    </span><span class="comment">//! as determined by the comparison function \b Config_::comparator_type</span>
<span class="normal">    </span><span class="comment">//! (the same as the second parameter of PRIORITY_QUEUE_GENERATOR utility</span>
<span class="normal">    </span><span class="comment">//! class). That is,</span>
<span class="normal">    </span><span class="comment">//! for every other element \b x in the priority_queue,</span>
<span class="normal">    </span><span class="comment">//! \b Config_::comparator_type(Q.top(), x) is false.</span>
<span class="normal">    </span><span class="comment">//! Precondition: \c empty() is false.</span>
<span class="normal">    </span><span class="keyword">const</span><span class="normal"> value_type </span><span class="symbol">&amp;</span><span class="normal"> </span><span class="function">top</span><span class="symbol">()</span><span class="normal"> </span><span class="keyword">const</span><span class="symbol">;</span>

<span class="normal">    </span><span class="comment">//! \brief Removes the element at the top</span>
<span class="normal">    </span><span class="comment">//!</span>
<span class="normal">    </span><span class="comment">//! Removes the element at the top of the priority_queue, that</span>
<span class="normal">    </span><span class="comment">//! is, the largest element in the \b priority_queue.</span>
<span class="normal">    </span><span class="comment">//! Precondition: \c empty() is \b false.</span>
<span class="normal">    </span><span class="comment">//! Postcondition: \c size() will be decremented by 1.</span>
<span class="normal">    </span><span class="type">void</span><span class="normal"> </span><span class="function">pop</span><span class="symbol">();</span>

<span class="normal">    </span><span class="comment">//! \brief Inserts x into the priority_queue.</span>
<span class="normal">    </span><span class="comment">//!</span>
<span class="normal">    </span><span class="comment">//! Inserts x into the priority_queue. Postcondition:</span>
<span class="normal">    </span><span class="comment">//! \c size() will be incremented by 1.</span>
<span class="normal">    </span><span class="type">void</span><span class="normal"> </span><span class="function">push</span><span class="symbol">(</span><span class="keyword">const</span><span class="normal"> value_type </span><span class="symbol">&amp;</span><span class="normal"> obj</span><span class="symbol">);</span>

<span class="normal">    </span><span class="comment">//! \brief Returns number of bytes consumed by</span>
<span class="normal">    </span><span class="comment">//! the \b priority_queue</span>
<span class="normal">    </span><span class="comment">//! \brief number of bytes consumed by the \b priority_queue from</span>
<span class="normal">    </span><span class="comment">//! the internal memory not including pools (see the constructor)</span>
<span class="normal">    </span><span class="usertype">unsigned_type</span><span class="normal"> </span><span class="function">mem_cons</span><span class="symbol">()</span><span class="normal"> </span><span class="keyword">const</span>
<span class="normal">    </span><span class="cbracket">{</span>
<span class="normal">        </span><span class="usertype">unsigned_type</span><span class="normal"> dynam_alloc_mem </span><span class="symbol">=</span><span class="normal"> </span><span class="number">0</span><span class="symbol">;</span>
<span class="normal">        </span><span class="comment">//dynam_alloc_mem += w_pool.mem_cons();</span>
<span class="normal">        </span><span class="comment">//dynam_alloc_mem += p_pool.mem_cons();</span>
<span class="normal">        </span><span class="keyword">for</span><span class="normal"> </span><span class="symbol">(</span><span class="type">int</span><span class="normal"> i </span><span class="symbol">=</span><span class="normal"> </span><span class="number">0</span><span class="symbol">;</span><span class="normal"> i </span><span class="symbol">&lt;</span><span class="normal"> num_int_groups</span><span class="symbol">;</span><span class="normal"> </span><span class="symbol">++</span><span class="normal">i</span><span class="symbol">)</span>
<span class="normal">            dynam_alloc_mem </span><span class="symbol">+=</span><span class="normal"> int_mergers</span><span class="symbol">[</span><span class="normal">i</span><span class="symbol">].</span><span class="function">mem_cons</span><span class="symbol">();</span>

<span class="normal">        </span><span class="keyword">for</span><span class="normal"> </span><span class="symbol">(</span><span class="type">int</span><span class="normal"> i </span><span class="symbol">=</span><span class="normal"> </span><span class="number">0</span><span class="symbol">;</span><span class="normal"> i </span><span class="symbol">&lt;</span><span class="normal"> num_ext_groups</span><span class="symbol">;</span><span class="normal"> </span><span class="symbol">++</span><span class="normal">i</span><span class="symbol">)</span>
<span class="normal">            dynam_alloc_mem </span><span class="symbol">+=</span><span class="normal"> ext_mergers</span><span class="symbol">[</span><span class="normal">i</span><span class="symbol">]-&gt;</span><span class="function">mem_cons</span><span class="symbol">();</span>


<span class="normal">        </span><span class="keyword">return</span><span class="normal"> </span><span class="symbol">(</span><span class="keyword">sizeof</span><span class="symbol">(*</span><span class="keyword">this</span><span class="symbol">)</span><span class="normal"> </span><span class="symbol">+</span>
<span class="normal">                </span><span class="keyword">sizeof</span><span class="symbol">(</span><span class="normal">ext_merger_type</span><span class="symbol">)</span><span class="normal"> </span><span class="symbol">*</span><span class="normal"> num_ext_groups </span><span class="symbol">+</span>
<span class="normal">                dynam_alloc_mem</span><span class="symbol">);</span>
<span class="normal">    </span><span class="cbracket">}</span>

<span class="normal">    </span><span class="type">void</span><span class="normal"> </span><span class="function">dump_sizes</span><span class="symbol">()</span><span class="normal"> </span><span class="keyword">const</span><span class="symbol">;</span>
<span class="normal">    </span><span class="type">void</span><span class="normal"> </span><span class="function">dump_params</span><span class="symbol">()</span><span class="normal"> </span><span class="keyword">const</span><span class="symbol">;</span>
<span class="cbracket">}</span><span class="symbol">;</span>


<span class="keyword">template</span><span class="normal"> </span><span class="symbol">&lt;</span><span class="keyword">class</span><span class="normal"> </span><span class="classname">Config_</span><span class="symbol">&gt;</span>
<span class="keyword">inline</span><span class="normal"> </span><span class="keyword">typename</span><span class="normal"> </span><span class="classname">priority_queue</span><span class="symbol">&lt;</span><span class="normal">Config_</span><span class="symbol">&gt;::</span><span class="usertype">size_type</span><span class="normal"> priority_queue</span><span class="symbol">&lt;</span><span class="normal">Config_</span><span class="symbol">&gt;::</span><span class="function">size</span><span class="symbol">()</span><span class="normal"> </span><span class="keyword">const</span>
<span class="cbracket">{</span>
<span class="normal">    </span><span class="keyword">return</span><span class="normal"> size_ </span><span class="symbol">+</span>
<span class="normal">           insert_heap</span><span class="symbol">.</span><span class="function">size</span><span class="symbol">()</span><span class="normal"> </span><span class="symbol">-</span><span class="normal"> </span><span class="number">1</span><span class="normal"> </span><span class="symbol">+</span>
<span class="normal">           </span><span class="symbol">(</span><span class="normal">delete_buffer_end </span><span class="symbol">-</span><span class="normal"> delete_buffer_current_min</span><span class="symbol">);</span>
<span class="cbracket">}</span>


<span class="keyword">template</span><span class="normal"> </span><span class="symbol">&lt;</span><span class="keyword">class</span><span class="normal"> </span><span class="classname">Config_</span><span class="symbol">&gt;</span>
<span class="keyword">inline</span><span class="normal"> </span><span class="keyword">const</span><span class="normal"> </span><span class="keyword">typename</span><span class="normal"> </span><span class="classname">priority_queue</span><span class="symbol">&lt;</span><span class="normal">Config_</span><span class="symbol">&gt;::</span><span class="normal">value_type </span><span class="symbol">&amp;</span><span class="normal"> priority_queue</span><span class="symbol">&lt;</span><span class="normal">Config_</span><span class="symbol">&gt;::</span><span class="function">top</span><span class="symbol">()</span><span class="normal"> </span><span class="keyword">const</span>
<span class="cbracket">{</span>
<span class="normal">    </span><span class="function">assert</span><span class="symbol">(!</span><span class="normal">insert_heap</span><span class="symbol">.</span><span class="function">empty</span><span class="symbol">());</span>

<span class="normal">    </span><span class="keyword">const</span><span class="normal"> </span><span class="keyword">typename</span><span class="normal"> </span><span class="classname">priority_queue</span><span class="symbol">&lt;</span><span class="normal">Config_</span><span class="symbol">&gt;::</span><span class="normal">value_type </span><span class="symbol">&amp;</span><span class="normal"> t </span><span class="symbol">=</span><span class="normal"> insert_heap</span><span class="symbol">.</span><span class="function">top</span><span class="symbol">();</span>
<span class="normal">    </span><span class="keyword">if</span><span class="normal"> </span><span class="symbol">(</span><span class="comment">/*(!insert_heap.empty()) &amp;&amp; */</span><span class="normal"> </span><span class="function">cmp</span><span class="symbol">(*</span><span class="normal">delete_buffer_current_min</span><span class="symbol">,</span><span class="normal"> t</span><span class="symbol">))</span>
<span class="normal">        </span><span class="keyword">return</span><span class="normal"> t</span><span class="symbol">;</span>
<span class="normal">    </span><span class="keyword">else</span>
<span class="normal">        </span><span class="keyword">return</span><span class="normal"> </span><span class="symbol">*</span><span class="normal">delete_buffer_current_min</span><span class="symbol">;</span>
<span class="cbracket">}</span>

<span class="keyword">template</span><span class="normal"> </span><span class="symbol">&lt;</span><span class="keyword">class</span><span class="normal"> </span><span class="classname">Config_</span><span class="symbol">&gt;</span>
<span class="keyword">inline</span><span class="normal"> </span><span class="type">void</span><span class="normal"> priority_queue</span><span class="symbol">&lt;</span><span class="normal">Config_</span><span class="symbol">&gt;::</span><span class="function">pop</span><span class="symbol">()</span>
<span class="cbracket">{</span>
<span class="normal">    </span><span class="comment">//STXXL_VERBOSE1("priority_queue::pop()");</span>
<span class="normal">    </span><span class="function">assert</span><span class="symbol">(!</span><span class="normal">insert_heap</span><span class="symbol">.</span><span class="function">empty</span><span class="symbol">());</span>

<span class="normal">    </span><span class="keyword">if</span><span class="normal"> </span><span class="symbol">(</span><span class="comment">/*(!insert_heap.empty()) &amp;&amp; */</span><span class="normal"> </span><span class="function">cmp</span><span class="symbol">(*</span><span class="normal">delete_buffer_current_min</span><span class="symbol">,</span><span class="normal"> insert_heap</span><span class="symbol">.</span><span class="function">top</span><span class="symbol">()))</span>
<span class="normal">        insert_heap</span><span class="symbol">.</span><span class="function">pop</span><span class="symbol">();</span>
<span class="normal">    </span><span class="keyword">else</span>
<span class="normal">    </span><span class="cbracket">{</span>
<span class="normal">        </span><span class="function">assert</span><span class="symbol">(</span><span class="normal">delete_buffer_current_min </span><span class="symbol">&lt;</span><span class="normal"> delete_buffer_end</span><span class="symbol">);</span>
<span class="normal">        </span><span class="symbol">++</span><span class="normal">delete_buffer_current_min</span><span class="symbol">;</span>
<span class="normal">        </span><span class="keyword">if</span><span class="normal"> </span><span class="symbol">(</span><span class="normal">delete_buffer_current_min </span><span class="symbol">==</span><span class="normal"> delete_buffer_end</span><span class="symbol">)</span>
<span class="normal">            </span><span class="function">refill_delete_buffer</span><span class="symbol">();</span>
<span class="normal">    </span><span class="cbracket">}</span>
<span class="cbracket">}</span>

<span class="keyword">template</span><span class="normal"> </span><span class="symbol">&lt;</span><span class="keyword">class</span><span class="normal"> </span><span class="classname">Config_</span><span class="symbol">&gt;</span>
<span class="keyword">inline</span><span class="normal"> </span><span class="type">void</span><span class="normal"> priority_queue</span><span class="symbol">&lt;</span><span class="normal">Config_</span><span class="symbol">&gt;::</span><span class="function">push</span><span class="symbol">(</span><span class="keyword">const</span><span class="normal"> value_type </span><span class="symbol">&amp;</span><span class="normal"> obj</span><span class="symbol">)</span>
<span class="cbracket">{</span>
<span class="normal">    </span><span class="comment">//STXXL_VERBOSE3("priority_queue::push("&lt;&lt; obj &lt;&lt;")");</span>
<span class="normal">    </span><span class="function">assert</span><span class="symbol">(</span><span class="normal">int_mergers</span><span class="symbol">-&gt;</span><span class="function">not_sentinel</span><span class="symbol">(</span><span class="normal">obj</span><span class="symbol">));</span>
<span class="normal">    </span><span class="keyword">if</span><span class="normal"> </span><span class="symbol">(</span><span class="normal">insert_heap</span><span class="symbol">.</span><span class="function">size</span><span class="symbol">()</span><span class="normal"> </span><span class="symbol">==</span><span class="normal"> N </span><span class="symbol">+</span><span class="normal"> </span><span class="number">1</span><span class="symbol">)</span>
<span class="normal">        </span><span class="function">empty_insert_heap</span><span class="symbol">();</span>


<span class="normal">    </span><span class="function">assert</span><span class="symbol">(!</span><span class="normal">insert_heap</span><span class="symbol">.</span><span class="function">empty</span><span class="symbol">());</span>

<span class="normal">    insert_heap</span><span class="symbol">.</span><span class="function">push</span><span class="symbol">(</span><span class="normal">obj</span><span class="symbol">);</span>
<span class="cbracket">}</span>


<span class="comment">////////////////////////////////////////////////////////////////</span>

<span class="keyword">template</span><span class="normal"> </span><span class="symbol">&lt;</span><span class="keyword">class</span><span class="normal"> </span><span class="classname">Config_</span><span class="symbol">&gt;</span>
<span class="normal">priority_queue</span><span class="symbol">&lt;</span><span class="normal">Config_</span><span class="symbol">&gt;::</span><span class="function">priority_queue</span><span class="symbol">(</span><span class="normal">pool_type </span><span class="symbol">&amp;</span><span class="normal"> pool_</span><span class="symbol">)</span><span class="normal"> </span><span class="symbol">:</span>
<span class="normal">    </span><span class="function">pool</span><span class="symbol">(&amp;</span><span class="normal">pool_</span><span class="symbol">),</span>
<span class="normal">    </span><span class="function">pool_owned</span><span class="symbol">(</span><span class="keyword">false</span><span class="symbol">),</span>
<span class="normal">    </span><span class="function">delete_buffer_end</span><span class="symbol">(</span><span class="normal">delete_buffer </span><span class="symbol">+</span><span class="normal"> delete_buffer_size</span><span class="symbol">),</span>
<span class="normal">    </span><span class="function">insert_heap</span><span class="symbol">(</span><span class="normal">N </span><span class="symbol">+</span><span class="normal"> </span><span class="number">2</span><span class="symbol">),</span>
<span class="normal">    </span><span class="function">num_active_groups</span><span class="symbol">(</span><span class="number">0</span><span class="symbol">),</span><span class="normal"> </span><span class="function">size_</span><span class="symbol">(</span><span class="number">0</span><span class="symbol">)</span>
<span class="cbracket">{</span>
<span class="normal">    </span><span class="function">STXXL_VERBOSE_PQ</span><span class="symbol">(</span><span class="string">"priority_queue(pool)"</span><span class="symbol">);</span>
<span class="normal">    </span><span class="function">init</span><span class="symbol">();</span>
<span class="cbracket">}</span>

<span class="comment">// DEPRECATED</span>
<span class="keyword">template</span><span class="normal"> </span><span class="symbol">&lt;</span><span class="keyword">class</span><span class="normal"> </span><span class="classname">Config_</span><span class="symbol">&gt;</span>
<span class="normal">priority_queue</span><span class="symbol">&lt;</span><span class="normal">Config_</span><span class="symbol">&gt;::</span><span class="function">priority_queue</span><span class="symbol">(</span><span class="normal">prefetch_pool</span><span class="symbol">&lt;</span><span class="normal">block_type</span><span class="symbol">&gt;</span><span class="normal"> </span><span class="symbol">&amp;</span><span class="normal"> p_pool_</span><span class="symbol">,</span><span class="normal"> write_pool</span><span class="symbol">&lt;</span><span class="normal">block_type</span><span class="symbol">&gt;</span><span class="normal"> </span><span class="symbol">&amp;</span><span class="normal"> w_pool_</span><span class="symbol">)</span><span class="normal"> </span><span class="symbol">:</span>
<span class="normal">    </span><span class="function">pool</span><span class="symbol">(</span><span class="keyword">new</span><span class="normal"> </span><span class="function">pool_type</span><span class="symbol">(</span><span class="normal">p_pool_</span><span class="symbol">,</span><span class="normal"> w_pool_</span><span class="symbol">)),</span>
<span class="normal">    </span><span class="function">pool_owned</span><span class="symbol">(</span><span class="keyword">true</span><span class="symbol">),</span>
<span class="normal">    </span><span class="function">delete_buffer_end</span><span class="symbol">(</span><span class="normal">delete_buffer </span><span class="symbol">+</span><span class="normal"> delete_buffer_size</span><span class="symbol">),</span>
<span class="normal">    </span><span class="function">insert_heap</span><span class="symbol">(</span><span class="normal">N </span><span class="symbol">+</span><span class="normal"> </span><span class="number">2</span><span class="symbol">),</span>
<span class="normal">    </span><span class="function">num_active_groups</span><span class="symbol">(</span><span class="number">0</span><span class="symbol">),</span><span class="normal"> </span><span class="function">size_</span><span class="symbol">(</span><span class="number">0</span><span class="symbol">)</span>
<span class="cbracket">{</span>
<span class="normal">    </span><span class="function">STXXL_VERBOSE_PQ</span><span class="symbol">(</span><span class="string">"priority_queue(p_pool, w_pool)"</span><span class="symbol">);</span>
<span class="normal">    </span><span class="function">init</span><span class="symbol">();</span>
<span class="cbracket">}</span>

<span class="keyword">template</span><span class="normal"> </span><span class="symbol">&lt;</span><span class="keyword">class</span><span class="normal"> </span><span class="classname">Config_</span><span class="symbol">&gt;</span>
<span class="normal">priority_queue</span><span class="symbol">&lt;</span><span class="normal">Config_</span><span class="symbol">&gt;::</span><span class="function">priority_queue</span><span class="symbol">(</span><span class="usertype">unsigned_type</span><span class="normal"> p_pool_mem</span><span class="symbol">,</span><span class="normal"> </span><span class="usertype">unsigned_type</span><span class="normal"> w_pool_mem</span><span class="symbol">)</span><span class="normal"> </span><span class="symbol">:</span>
<span class="normal">    </span><span class="function">pool</span><span class="symbol">(</span><span class="keyword">new</span><span class="normal"> </span><span class="function">pool_type</span><span class="symbol">(</span><span class="normal">p_pool_mem </span><span class="symbol">/</span><span class="normal"> BlockSize</span><span class="symbol">,</span><span class="normal"> w_pool_mem </span><span class="symbol">/</span><span class="normal"> BlockSize</span><span class="symbol">)),</span>
<span class="normal">    </span><span class="function">pool_owned</span><span class="symbol">(</span><span class="keyword">true</span><span class="symbol">),</span>
<span class="normal">    </span><span class="function">delete_buffer_end</span><span class="symbol">(</span><span class="normal">delete_buffer </span><span class="symbol">+</span><span class="normal"> delete_buffer_size</span><span class="symbol">),</span>
<span class="normal">    </span><span class="function">insert_heap</span><span class="symbol">(</span><span class="normal">N </span><span class="symbol">+</span><span class="normal"> </span><span class="number">2</span><span class="symbol">),</span>
<span class="normal">    </span><span class="function">num_active_groups</span><span class="symbol">(</span><span class="number">0</span><span class="symbol">),</span><span class="normal"> </span><span class="function">size_</span><span class="symbol">(</span><span class="number">0</span><span class="symbol">)</span>
<span class="cbracket">{</span>
<span class="normal">    </span><span class="function">STXXL_VERBOSE_PQ</span><span class="symbol">(</span><span class="string">"priority_queue(pool sizes)"</span><span class="symbol">);</span>
<span class="normal">    </span><span class="function">init</span><span class="symbol">();</span>
<span class="cbracket">}</span>

<span class="keyword">template</span><span class="normal"> </span><span class="symbol">&lt;</span><span class="keyword">class</span><span class="normal"> </span><span class="classname">Config_</span><span class="symbol">&gt;</span>
<span class="type">void</span><span class="normal"> priority_queue</span><span class="symbol">&lt;</span><span class="normal">Config_</span><span class="symbol">&gt;::</span><span class="function">init</span><span class="symbol">()</span>
<span class="cbracket">{</span>
<span class="normal">    </span><span class="function">assert</span><span class="symbol">(!</span><span class="function">cmp</span><span class="symbol">(</span><span class="normal">cmp</span><span class="symbol">.</span><span class="function">min_value</span><span class="symbol">(),</span><span class="normal"> cmp</span><span class="symbol">.</span><span class="function">min_value</span><span class="symbol">()));</span><span class="normal"> </span><span class="comment">// verify strict weak ordering</span>

<span class="normal">    ext_mergers </span><span class="symbol">=</span><span class="normal"> </span><span class="keyword">new</span><span class="normal"> ext_merger_type</span><span class="symbol">*[</span><span class="normal">num_ext_groups</span><span class="symbol">];</span>
<span class="normal">    </span><span class="keyword">for</span><span class="normal"> </span><span class="symbol">(</span><span class="usertype">unsigned_type</span><span class="normal"> j </span><span class="symbol">=</span><span class="normal"> </span><span class="number">0</span><span class="symbol">;</span><span class="normal"> j </span><span class="symbol">&lt;</span><span class="normal"> num_ext_groups</span><span class="symbol">;</span><span class="normal"> </span><span class="symbol">++</span><span class="normal">j</span><span class="symbol">)</span><span class="normal"> </span><span class="cbracket">{</span>
<span class="normal">        ext_mergers</span><span class="symbol">[</span><span class="normal">j</span><span class="symbol">]</span><span class="normal"> </span><span class="symbol">=</span><span class="normal"> </span><span class="keyword">new</span><span class="normal"> ext_merger_type</span><span class="symbol">;</span>
<span class="normal">        ext_mergers</span><span class="symbol">[</span><span class="normal">j</span><span class="symbol">]-&gt;</span><span class="function">set_pool</span><span class="symbol">(</span><span class="normal">pool</span><span class="symbol">);</span>
<span class="normal">    </span><span class="cbracket">}</span>

<span class="normal">    </span><span class="usertype">value_type</span><span class="normal"> sentinel </span><span class="symbol">=</span><span class="normal"> cmp</span><span class="symbol">.</span><span class="function">min_value</span><span class="symbol">();</span>
<span class="normal">    insert_heap</span><span class="symbol">.</span><span class="function">push</span><span class="symbol">(</span><span class="normal">sentinel</span><span class="symbol">);</span><span class="normal">                                </span><span class="comment">// always keep the sentinel</span>
<span class="normal">    delete_buffer</span><span class="symbol">[</span><span class="normal">delete_buffer_size</span><span class="symbol">]</span><span class="normal"> </span><span class="symbol">=</span><span class="normal"> sentinel</span><span class="symbol">;</span><span class="normal">              </span><span class="comment">// sentinel</span>
<span class="normal">    delete_buffer_current_min </span><span class="symbol">=</span><span class="normal"> delete_buffer_end</span><span class="symbol">;</span><span class="normal">             </span><span class="comment">// empty</span>
<span class="normal">    </span><span class="keyword">for</span><span class="normal"> </span><span class="symbol">(</span><span class="usertype">unsigned_type</span><span class="normal"> i </span><span class="symbol">=</span><span class="normal"> </span><span class="number">0</span><span class="symbol">;</span><span class="normal"> i </span><span class="symbol">&lt;</span><span class="normal"> total_num_groups</span><span class="symbol">;</span><span class="normal"> i</span><span class="symbol">++)</span>
<span class="normal">    </span><span class="cbracket">{</span>
<span class="normal">        group_buffers</span><span class="symbol">[</span><span class="normal">i</span><span class="symbol">][</span><span class="normal">N</span><span class="symbol">]</span><span class="normal"> </span><span class="symbol">=</span><span class="normal"> sentinel</span><span class="symbol">;</span><span class="normal">                        </span><span class="comment">// sentinel</span>
<span class="normal">        group_buffer_current_mins</span><span class="symbol">[</span><span class="normal">i</span><span class="symbol">]</span><span class="normal"> </span><span class="symbol">=</span><span class="normal"> </span><span class="symbol">&amp;(</span><span class="normal">group_buffers</span><span class="symbol">[</span><span class="normal">i</span><span class="symbol">][</span><span class="normal">N</span><span class="symbol">]);</span><span class="normal"> </span><span class="comment">// empty</span>
<span class="normal">    </span><span class="cbracket">}</span>
<span class="cbracket">}</span>

<span class="keyword">template</span><span class="normal"> </span><span class="symbol">&lt;</span><span class="keyword">class</span><span class="normal"> </span><span class="classname">Config_</span><span class="symbol">&gt;</span>
<span class="normal">priority_queue</span><span class="symbol">&lt;</span><span class="normal">Config_</span><span class="symbol">&gt;::~</span><span class="function">priority_queue</span><span class="symbol">()</span>
<span class="cbracket">{</span>
<span class="normal">    </span><span class="function">STXXL_VERBOSE_PQ</span><span class="symbol">(</span><span class="string">"~priority_queue()"</span><span class="symbol">);</span>
<span class="normal">    </span><span class="keyword">if</span><span class="normal"> </span><span class="symbol">(</span><span class="normal">pool_owned</span><span class="symbol">)</span>
<span class="normal">        </span><span class="keyword">delete</span><span class="normal"> pool</span><span class="symbol">;</span>

<span class="normal">    </span><span class="keyword">for</span><span class="normal"> </span><span class="symbol">(</span><span class="usertype">unsigned_type</span><span class="normal"> j </span><span class="symbol">=</span><span class="normal"> </span><span class="number">0</span><span class="symbol">;</span><span class="normal"> j </span><span class="symbol">&lt;</span><span class="normal"> num_ext_groups</span><span class="symbol">;</span><span class="normal"> </span><span class="symbol">++</span><span class="normal">j</span><span class="symbol">)</span>
<span class="normal">        </span><span class="keyword">delete</span><span class="normal"> ext_mergers</span><span class="symbol">[</span><span class="normal">j</span><span class="symbol">];</span>
<span class="normal">    </span><span class="keyword">delete</span><span class="symbol">[]</span><span class="normal"> ext_mergers</span><span class="symbol">;</span>
<span class="cbracket">}</span>

<span class="comment">//--------------------- Buffer refilling -------------------------------</span>

<span class="comment">// refill group_buffers[j] and return number of elements found</span>
<span class="keyword">template</span><span class="normal"> </span><span class="symbol">&lt;</span><span class="keyword">class</span><span class="normal"> </span><span class="classname">Config_</span><span class="symbol">&gt;</span>
<span class="usertype">unsigned_type</span><span class="normal"> priority_queue</span><span class="symbol">&lt;</span><span class="normal">Config_</span><span class="symbol">&gt;::</span><span class="function">refill_group_buffer</span><span class="symbol">(</span><span class="usertype">unsigned_type</span><span class="normal"> group</span><span class="symbol">)</span>
<span class="cbracket">{</span>
<span class="normal">    </span><span class="function">STXXL_VERBOSE_PQ</span><span class="symbol">(</span><span class="string">"refill_group_buffer("</span><span class="normal"> </span><span class="symbol">&lt;&lt;</span><span class="normal"> group </span><span class="symbol">&lt;&lt;</span><span class="normal"> </span><span class="string">")"</span><span class="symbol">);</span>

<span class="normal">    value_type </span><span class="symbol">*</span><span class="normal"> target</span><span class="symbol">;</span>
<span class="normal">    </span><span class="usertype">unsigned_type</span><span class="normal"> length</span><span class="symbol">;</span>
<span class="normal">    </span><span class="usertype">size_type</span><span class="normal"> group_size </span><span class="symbol">=</span><span class="normal"> </span><span class="symbol">(</span><span class="normal">group </span><span class="symbol">&lt;</span><span class="normal"> num_int_groups</span><span class="symbol">)</span><span class="normal"> </span><span class="symbol">?</span>
<span class="normal">                           int_mergers</span><span class="symbol">[</span><span class="normal">group</span><span class="symbol">].</span><span class="function">size</span><span class="symbol">()</span><span class="normal"> </span><span class="symbol">:</span>
<span class="normal">                           ext_mergers</span><span class="symbol">[</span><span class="normal">group </span><span class="symbol">-</span><span class="normal"> num_int_groups</span><span class="symbol">]-&gt;</span><span class="function">size</span><span class="symbol">();</span><span class="normal">                        </span><span class="comment">// elements left in segments</span>
<span class="normal">    </span><span class="usertype">unsigned_type</span><span class="normal"> left_elements </span><span class="symbol">=</span><span class="normal"> group_buffers</span><span class="symbol">[</span><span class="normal">group</span><span class="symbol">]</span><span class="normal"> </span><span class="symbol">+</span><span class="normal"> N </span><span class="symbol">-</span><span class="normal"> group_buffer_current_mins</span><span class="symbol">[</span><span class="normal">group</span><span class="symbol">];</span><span class="normal"> </span><span class="comment">//elements left in target buffer</span>
<span class="normal">    </span><span class="keyword">if</span><span class="normal"> </span><span class="symbol">(</span><span class="normal">group_size </span><span class="symbol">+</span><span class="normal"> left_elements </span><span class="symbol">&gt;=</span><span class="normal"> </span><span class="function">size_type</span><span class="symbol">(</span><span class="normal">N</span><span class="symbol">))</span>
<span class="normal">    </span><span class="cbracket">{</span><span class="normal">                                                                                          </span><span class="comment">// buffer will be filled completely</span>
<span class="normal">        target </span><span class="symbol">=</span><span class="normal"> group_buffers</span><span class="symbol">[</span><span class="normal">group</span><span class="symbol">];</span>
<span class="normal">        length </span><span class="symbol">=</span><span class="normal"> N </span><span class="symbol">-</span><span class="normal"> left_elements</span><span class="symbol">;</span>
<span class="normal">    </span><span class="cbracket">}</span>
<span class="normal">    </span><span class="keyword">else</span>
<span class="normal">    </span><span class="cbracket">{</span>
<span class="normal">        target </span><span class="symbol">=</span><span class="normal"> group_buffers</span><span class="symbol">[</span><span class="normal">group</span><span class="symbol">]</span><span class="normal"> </span><span class="symbol">+</span><span class="normal"> N </span><span class="symbol">-</span><span class="normal"> group_size </span><span class="symbol">-</span><span class="normal"> left_elements</span><span class="symbol">;</span>
<span class="normal">        length </span><span class="symbol">=</span><span class="normal"> group_size</span><span class="symbol">;</span>
<span class="normal">    </span><span class="cbracket">}</span>

<span class="normal">    </span><span class="keyword">if</span><span class="normal"> </span><span class="symbol">(</span><span class="normal">length </span><span class="symbol">&gt;</span><span class="normal"> </span><span class="number">0</span><span class="symbol">)</span>
<span class="normal">    </span><span class="cbracket">{</span>
<span class="normal">        </span><span class="comment">// shift remaininig elements to front</span>
<span class="normal">        </span><span class="function">memmove</span><span class="symbol">(</span><span class="normal">target</span><span class="symbol">,</span><span class="normal"> group_buffer_current_mins</span><span class="symbol">[</span><span class="normal">group</span><span class="symbol">],</span><span class="normal"> left_elements </span><span class="symbol">*</span><span class="normal"> </span><span class="keyword">sizeof</span><span class="symbol">(</span><span class="normal">value_type</span><span class="symbol">));</span>
<span class="normal">        group_buffer_current_mins</span><span class="symbol">[</span><span class="normal">group</span><span class="symbol">]</span><span class="normal"> </span><span class="symbol">=</span><span class="normal"> target</span><span class="symbol">;</span>

<span class="normal">        </span><span class="comment">// fill remaining space from group</span>
<span class="normal">        </span><span class="keyword">if</span><span class="normal"> </span><span class="symbol">(</span><span class="normal">group </span><span class="symbol">&lt;</span><span class="normal"> num_int_groups</span><span class="symbol">)</span>
<span class="normal">            int_mergers</span><span class="symbol">[</span><span class="normal">group</span><span class="symbol">].</span><span class="function">multi_merge</span><span class="symbol">(</span><span class="normal">target </span><span class="symbol">+</span><span class="normal"> left_elements</span><span class="symbol">,</span><span class="normal"> length</span><span class="symbol">);</span>
<span class="normal">        </span><span class="keyword">else</span>
<span class="normal">            ext_mergers</span><span class="symbol">[</span><span class="normal">group </span><span class="symbol">-</span><span class="normal"> num_int_groups</span><span class="symbol">]-&gt;</span><span class="function">multi_merge</span><span class="symbol">(</span>
<span class="normal">                target </span><span class="symbol">+</span><span class="normal"> left_elements</span><span class="symbol">,</span>
<span class="normal">                target </span><span class="symbol">+</span><span class="normal"> left_elements </span><span class="symbol">+</span><span class="normal"> length</span><span class="symbol">);</span>
<span class="normal">    </span><span class="cbracket">}</span>

<span class="normal">    </span><span class="comment">//STXXL_MSG(length + left_elements);</span>
<span class="normal">    </span><span class="comment">//std::copy(target,target + length + left_elements,std::ostream_iterator&lt;value_type&gt;(std::cout, "\n"));</span>
<span class="preproc">#if</span><span class="normal"> STXXL_CHECK_ORDER_IN_SORTS</span>
<span class="normal">    priority_queue_local</span><span class="symbol">::</span><span class="usertype">invert_order&lt;typename Config::comparator_type, value_type, value_type&gt;</span><span class="normal"> </span><span class="function">inv_cmp</span><span class="symbol">(</span><span class="normal">cmp</span><span class="symbol">);</span>
<span class="normal">    </span><span class="keyword">if</span><span class="normal"> </span><span class="symbol">(!</span><span class="normal">stxxl</span><span class="symbol">::</span><span class="function">is_sorted</span><span class="symbol">(</span><span class="normal">group_buffer_current_mins</span><span class="symbol">[</span><span class="normal">group</span><span class="symbol">],</span><span class="normal"> group_buffers</span><span class="symbol">[</span><span class="normal">group</span><span class="symbol">]</span><span class="normal"> </span><span class="symbol">+</span><span class="normal"> N</span><span class="symbol">,</span><span class="normal"> inv_cmp</span><span class="symbol">))</span>
<span class="normal">    </span><span class="cbracket">{</span>
<span class="normal">        </span><span class="function">STXXL_VERBOSE_PQ</span><span class="symbol">(</span><span class="string">"refill_grp... length: "</span><span class="normal"> </span><span class="symbol">&lt;&lt;</span><span class="normal"> length </span><span class="symbol">&lt;&lt;</span><span class="normal"> </span><span class="string">" left_elements: "</span><span class="normal"> </span><span class="symbol">&lt;&lt;</span><span class="normal"> left_elements</span><span class="symbol">);</span>
<span class="normal">        </span><span class="keyword">for</span><span class="normal"> </span><span class="symbol">(</span><span class="normal">value_type </span><span class="symbol">*</span><span class="normal"> v </span><span class="symbol">=</span><span class="normal"> group_buffer_current_mins</span><span class="symbol">[</span><span class="normal">group</span><span class="symbol">]</span><span class="normal"> </span><span class="symbol">+</span><span class="normal"> </span><span class="number">1</span><span class="symbol">;</span><span class="normal"> v </span><span class="symbol">&lt;</span><span class="normal"> group_buffer_current_mins</span><span class="symbol">[</span><span class="normal">group</span><span class="symbol">]</span><span class="normal"> </span><span class="symbol">+</span><span class="normal"> left_elements</span><span class="symbol">;</span><span class="normal"> </span><span class="symbol">++</span><span class="normal">v</span><span class="symbol">)</span>
<span class="normal">        </span><span class="cbracket">{</span>
<span class="normal">            </span><span class="keyword">if</span><span class="normal"> </span><span class="symbol">(</span><span class="function">inv_cmp</span><span class="symbol">(*</span><span class="normal">v</span><span class="symbol">,</span><span class="normal"> </span><span class="symbol">*(</span><span class="normal">v </span><span class="symbol">-</span><span class="normal"> </span><span class="number">1</span><span class="symbol">)))</span>
<span class="normal">            </span><span class="cbracket">{</span>
<span class="normal">                </span><span class="function">STXXL_MSG</span><span class="symbol">(</span><span class="string">"Error in buffer "</span><span class="normal"> </span><span class="symbol">&lt;&lt;</span><span class="normal"> group </span><span class="symbol">&lt;&lt;</span><span class="normal"> </span><span class="string">" at position "</span><span class="normal"> </span><span class="symbol">&lt;&lt;</span><span class="normal"> </span><span class="symbol">(</span><span class="normal">v </span><span class="symbol">-</span><span class="normal"> group_buffer_current_mins</span><span class="symbol">[</span><span class="normal">group</span><span class="symbol">]</span><span class="normal"> </span><span class="symbol">-</span><span class="normal"> </span><span class="number">1</span><span class="symbol">)</span><span class="normal"> </span><span class="symbol">&lt;&lt;</span><span class="normal"> </span><span class="string">"/"</span><span class="normal"> </span><span class="symbol">&lt;&lt;</span><span class="normal"> </span><span class="symbol">(</span><span class="normal">v </span><span class="symbol">-</span><span class="normal"> group_buffer_current_mins</span><span class="symbol">[</span><span class="normal">group</span><span class="symbol">])</span><span class="normal"> </span><span class="symbol">&lt;&lt;</span><span class="normal"> </span><span class="string">"   "</span><span class="normal"> </span><span class="symbol">&lt;&lt;</span><span class="normal"> </span><span class="symbol">*(</span><span class="normal">v </span><span class="symbol">-</span><span class="normal"> </span><span class="number">2</span><span class="symbol">)</span><span class="normal"> </span><span class="symbol">&lt;&lt;</span><span class="normal"> </span><span class="string">" "</span><span class="normal"> </span><span class="symbol">&lt;&lt;</span><span class="normal"> </span><span class="symbol">*(</span><span class="normal">v </span><span class="symbol">-</span><span class="normal"> </span><span class="number">1</span><span class="symbol">)</span><span class="normal"> </span><span class="symbol">&lt;&lt;</span><span class="normal"> </span><span class="string">" "</span><span class="normal"> </span><span class="symbol">&lt;&lt;</span><span class="normal"> </span><span class="symbol">*</span><span class="normal">v </span><span class="symbol">&lt;&lt;</span><span class="normal"> </span><span class="string">" "</span><span class="normal"> </span><span class="symbol">&lt;&lt;</span><span class="normal"> </span><span class="symbol">*(</span><span class="normal">v </span><span class="symbol">+</span><span class="normal"> </span><span class="number">1</span><span class="symbol">));</span>
<span class="normal">            </span><span class="cbracket">}</span>
<span class="normal">        </span><span class="cbracket">}</span>
<span class="normal">        </span><span class="function">assert</span><span class="symbol">(</span><span class="keyword">false</span><span class="symbol">);</span>
<span class="normal">    </span><span class="cbracket">}</span>
<span class="preproc">#endif</span>

<span class="normal">    </span><span class="keyword">return</span><span class="normal"> length </span><span class="symbol">+</span><span class="normal"> left_elements</span><span class="symbol">;</span>
<span class="cbracket">}</span>


<span class="keyword">template</span><span class="normal"> </span><span class="symbol">&lt;</span><span class="keyword">class</span><span class="normal"> </span><span class="classname">Config_</span><span class="symbol">&gt;</span>
<span class="type">void</span><span class="normal"> priority_queue</span><span class="symbol">&lt;</span><span class="normal">Config_</span><span class="symbol">&gt;::</span><span class="function">refill_delete_buffer</span><span class="symbol">()</span>
<span class="cbracket">{</span>
<span class="normal">    </span><span class="function">STXXL_VERBOSE_PQ</span><span class="symbol">(</span><span class="string">"refill_delete_buffer()"</span><span class="symbol">);</span>

<span class="normal">    </span><span class="usertype">size_type</span><span class="normal"> total_group_size </span><span class="symbol">=</span><span class="normal"> </span><span class="number">0</span><span class="symbol">;</span>
<span class="normal">    </span><span class="comment">//num_active_groups is &lt;= 4</span>
<span class="normal">    </span><span class="keyword">for</span><span class="normal"> </span><span class="symbol">(</span><span class="type">int</span><span class="normal"> i </span><span class="symbol">=</span><span class="normal"> num_active_groups </span><span class="symbol">-</span><span class="normal"> </span><span class="number">1</span><span class="symbol">;</span><span class="normal"> i </span><span class="symbol">&gt;=</span><span class="normal"> </span><span class="number">0</span><span class="symbol">;</span><span class="normal"> i</span><span class="symbol">--)</span>
<span class="normal">    </span><span class="cbracket">{</span>
<span class="normal">        </span><span class="keyword">if</span><span class="normal"> </span><span class="symbol">((</span><span class="normal">group_buffers</span><span class="symbol">[</span><span class="normal">i</span><span class="symbol">]</span><span class="normal"> </span><span class="symbol">+</span><span class="normal"> N</span><span class="symbol">)</span><span class="normal"> </span><span class="symbol">-</span><span class="normal"> group_buffer_current_mins</span><span class="symbol">[</span><span class="normal">i</span><span class="symbol">]</span><span class="normal"> </span><span class="symbol">&lt;</span><span class="normal"> delete_buffer_size</span><span class="symbol">)</span>
<span class="normal">        </span><span class="cbracket">{</span>
<span class="normal">            </span><span class="usertype">unsigned_type</span><span class="normal"> length </span><span class="symbol">=</span><span class="normal"> </span><span class="function">refill_group_buffer</span><span class="symbol">(</span><span class="normal">i</span><span class="symbol">);</span>
<span class="normal">            </span><span class="comment">// max active level dry now?</span>
<span class="normal">            </span><span class="keyword">if</span><span class="normal"> </span><span class="symbol">(</span><span class="normal">length </span><span class="symbol">==</span><span class="normal"> </span><span class="number">0</span><span class="normal"> </span><span class="symbol">&amp;&amp;</span><span class="normal"> </span><span class="type">unsigned</span><span class="symbol">(</span><span class="normal">i</span><span class="symbol">)</span><span class="normal"> </span><span class="symbol">==</span><span class="normal"> num_active_groups </span><span class="symbol">-</span><span class="normal"> </span><span class="number">1</span><span class="symbol">)</span>
<span class="normal">                </span><span class="symbol">--</span><span class="normal">num_active_groups</span><span class="symbol">;</span>

<span class="normal">            total_group_size </span><span class="symbol">+=</span><span class="normal"> length</span><span class="symbol">;</span>
<span class="normal">        </span><span class="cbracket">}</span>
<span class="normal">        </span><span class="keyword">else</span>
<span class="normal">            total_group_size </span><span class="symbol">+=</span><span class="normal"> delete_buffer_size</span><span class="symbol">;</span><span class="normal">  </span><span class="comment">// actually only a sufficient lower bound</span>
<span class="normal">    </span><span class="cbracket">}</span>

<span class="normal">    </span><span class="usertype">unsigned_type</span><span class="normal"> length</span><span class="symbol">;</span>
<span class="normal">    </span><span class="keyword">if</span><span class="normal"> </span><span class="symbol">(</span><span class="normal">total_group_size </span><span class="symbol">&gt;=</span><span class="normal"> delete_buffer_size</span><span class="symbol">)</span><span class="normal">      </span><span class="comment">// buffer can be filled completely</span>
<span class="normal">    </span><span class="cbracket">{</span>
<span class="normal">        length </span><span class="symbol">=</span><span class="normal"> delete_buffer_size</span><span class="symbol">;</span><span class="normal">                 </span><span class="comment">// amount to be copied</span>
<span class="normal">        size_ </span><span class="symbol">-=</span><span class="normal"> </span><span class="function">size_type</span><span class="symbol">(</span><span class="normal">delete_buffer_size</span><span class="symbol">);</span><span class="normal">      </span><span class="comment">// amount left in group_buffers</span>
<span class="normal">    </span><span class="cbracket">}</span>
<span class="normal">    </span><span class="keyword">else</span>
<span class="normal">    </span><span class="cbracket">{</span>
<span class="normal">        length </span><span class="symbol">=</span><span class="normal"> total_group_size</span><span class="symbol">;</span>
<span class="normal">        </span><span class="function">assert</span><span class="symbol">(</span><span class="normal">size_ </span><span class="symbol">==</span><span class="normal"> </span><span class="function">size_type</span><span class="symbol">(</span><span class="normal">length</span><span class="symbol">));</span><span class="normal"> </span><span class="comment">// trees and group_buffers get empty</span>
<span class="normal">        size_ </span><span class="symbol">=</span><span class="normal"> </span><span class="number">0</span><span class="symbol">;</span>
<span class="normal">    </span><span class="cbracket">}</span>

<span class="normal">    priority_queue_local</span><span class="symbol">::</span><span class="usertype">invert_order&lt;typename Config::comparator_type, value_type, value_type&gt;</span><span class="normal"> </span><span class="function">inv_cmp</span><span class="symbol">(</span><span class="normal">cmp</span><span class="symbol">);</span>

<span class="normal">    </span><span class="comment">// now call simplified refill routines</span>
<span class="normal">    </span><span class="comment">// which can make the assumption that</span>
<span class="normal">    </span><span class="comment">// they find all they are asked in the buffers</span>
<span class="normal">    delete_buffer_current_min </span><span class="symbol">=</span><span class="normal"> delete_buffer_end </span><span class="symbol">-</span><span class="normal"> length</span><span class="symbol">;</span>
<span class="normal">    </span><span class="function">STXXL_VERBOSE_PQ</span><span class="symbol">(</span><span class="string">"refill_del... Active groups = "</span><span class="normal"> </span><span class="symbol">&lt;&lt;</span><span class="normal"> num_active_groups</span><span class="symbol">);</span>
<span class="normal">    </span><span class="keyword">switch</span><span class="normal"> </span><span class="symbol">(</span><span class="normal">num_active_groups</span><span class="symbol">)</span>
<span class="normal">    </span><span class="cbracket">{</span>
<span class="normal">    </span><span class="keyword">case</span><span class="normal"> </span><span class="number">0</span><span class="symbol">:</span>
<span class="normal">        </span><span class="keyword">break</span><span class="symbol">;</span>
<span class="normal">    </span><span class="keyword">case</span><span class="normal"> </span><span class="number">1</span><span class="symbol">:</span>
<span class="normal">        std</span><span class="symbol">::</span><span class="function">copy</span><span class="symbol">(</span><span class="normal">group_buffer_current_mins</span><span class="symbol">[</span><span class="number">0</span><span class="symbol">],</span><span class="normal"> group_buffer_current_mins</span><span class="symbol">[</span><span class="number">0</span><span class="symbol">]</span><span class="normal"> </span><span class="symbol">+</span><span class="normal"> length</span><span class="symbol">,</span><span class="normal"> delete_buffer_current_min</span><span class="symbol">);</span>
<span class="normal">        group_buffer_current_mins</span><span class="symbol">[</span><span class="number">0</span><span class="symbol">]</span><span class="normal"> </span><span class="symbol">+=</span><span class="normal"> length</span><span class="symbol">;</span>
<span class="normal">        </span><span class="keyword">break</span><span class="symbol">;</span>
<span class="normal">    </span><span class="keyword">case</span><span class="normal"> </span><span class="number">2</span><span class="symbol">:</span>
<span class="preproc">#if</span><span class="normal"> STXXL_PARALLEL </span><span class="symbol">&amp;&amp;</span><span class="normal"> STXXL_PARALLEL_PQ_MULTIWAY_MERGE_DELETE_BUFFER</span>
<span class="normal">        </span><span class="cbracket">{</span>
<span class="normal">            std</span><span class="symbol">::</span><span class="usertype">pair&lt;value_type *, value_type *&gt;</span><span class="normal"> seqs</span><span class="symbol">[</span><span class="number">2</span><span class="symbol">]</span><span class="normal"> </span><span class="symbol">=</span>
<span class="normal">            </span><span class="cbracket">{</span>
<span class="normal">                std</span><span class="symbol">::</span><span class="function">make_pair</span><span class="symbol">(</span><span class="normal">group_buffer_current_mins</span><span class="symbol">[</span><span class="number">0</span><span class="symbol">],</span><span class="normal"> group_buffers</span><span class="symbol">[</span><span class="number">0</span><span class="symbol">]</span><span class="normal"> </span><span class="symbol">+</span><span class="normal"> N</span><span class="symbol">),</span>
<span class="normal">                std</span><span class="symbol">::</span><span class="function">make_pair</span><span class="symbol">(</span><span class="normal">group_buffer_current_mins</span><span class="symbol">[</span><span class="number">1</span><span class="symbol">],</span><span class="normal"> group_buffers</span><span class="symbol">[</span><span class="number">1</span><span class="symbol">]</span><span class="normal"> </span><span class="symbol">+</span><span class="normal"> N</span><span class="symbol">)</span>
<span class="normal">            </span><span class="cbracket">}</span><span class="symbol">;</span>
<span class="normal">            parallel</span><span class="symbol">::</span><span class="function">multiway_merge_sentinel</span><span class="symbol">(</span><span class="normal">seqs</span><span class="symbol">,</span><span class="normal"> seqs </span><span class="symbol">+</span><span class="normal"> </span><span class="number">2</span><span class="symbol">,</span><span class="normal"> delete_buffer_current_min</span><span class="symbol">,</span><span class="normal"> inv_cmp</span><span class="symbol">,</span><span class="normal"> length</span><span class="symbol">);</span><span class="normal"> </span><span class="comment">//sequence iterators are progressed appropriately</span>

<span class="normal">            group_buffer_current_mins</span><span class="symbol">[</span><span class="number">0</span><span class="symbol">]</span><span class="normal"> </span><span class="symbol">=</span><span class="normal"> seqs</span><span class="symbol">[</span><span class="number">0</span><span class="symbol">].</span><span class="normal">first</span><span class="symbol">;</span>
<span class="normal">            group_buffer_current_mins</span><span class="symbol">[</span><span class="number">1</span><span class="symbol">]</span><span class="normal"> </span><span class="symbol">=</span><span class="normal"> seqs</span><span class="symbol">[</span><span class="number">1</span><span class="symbol">].</span><span class="normal">first</span><span class="symbol">;</span>
<span class="normal">        </span><span class="cbracket">}</span>
<span class="preproc">#else</span>
<span class="normal">        priority_queue_local</span><span class="symbol">::</span><span class="function">merge_iterator</span><span class="symbol">(</span>
<span class="normal">            group_buffer_current_mins</span><span class="symbol">[</span><span class="number">0</span><span class="symbol">],</span>
<span class="normal">            group_buffer_current_mins</span><span class="symbol">[</span><span class="number">1</span><span class="symbol">],</span><span class="normal"> delete_buffer_current_min</span><span class="symbol">,</span><span class="normal"> length</span><span class="symbol">,</span><span class="normal"> cmp</span><span class="symbol">);</span>
<span class="preproc">#endif</span>
<span class="normal">        </span><span class="keyword">break</span><span class="symbol">;</span>
<span class="normal">    </span><span class="keyword">case</span><span class="normal"> </span><span class="number">3</span><span class="symbol">:</span>
<span class="preproc">#if</span><span class="normal"> STXXL_PARALLEL </span><span class="symbol">&amp;&amp;</span><span class="normal"> STXXL_PARALLEL_PQ_MULTIWAY_MERGE_DELETE_BUFFER</span>
<span class="normal">        </span><span class="cbracket">{</span>
<span class="normal">            std</span><span class="symbol">::</span><span class="usertype">pair&lt;value_type *, value_type *&gt;</span><span class="normal"> seqs</span><span class="symbol">[</span><span class="number">3</span><span class="symbol">]</span><span class="normal"> </span><span class="symbol">=</span>
<span class="normal">            </span><span class="cbracket">{</span>
<span class="normal">                std</span><span class="symbol">::</span><span class="function">make_pair</span><span class="symbol">(</span><span class="normal">group_buffer_current_mins</span><span class="symbol">[</span><span class="number">0</span><span class="symbol">],</span><span class="normal"> group_buffers</span><span class="symbol">[</span><span class="number">0</span><span class="symbol">]</span><span class="normal"> </span><span class="symbol">+</span><span class="normal"> N</span><span class="symbol">),</span>
<span class="normal">                std</span><span class="symbol">::</span><span class="function">make_pair</span><span class="symbol">(</span><span class="normal">group_buffer_current_mins</span><span class="symbol">[</span><span class="number">1</span><span class="symbol">],</span><span class="normal"> group_buffers</span><span class="symbol">[</span><span class="number">1</span><span class="symbol">]</span><span class="normal"> </span><span class="symbol">+</span><span class="normal"> N</span><span class="symbol">),</span>
<span class="normal">                std</span><span class="symbol">::</span><span class="function">make_pair</span><span class="symbol">(</span><span class="normal">group_buffer_current_mins</span><span class="symbol">[</span><span class="number">2</span><span class="symbol">],</span><span class="normal"> group_buffers</span><span class="symbol">[</span><span class="number">2</span><span class="symbol">]</span><span class="normal"> </span><span class="symbol">+</span><span class="normal"> N</span><span class="symbol">)</span>
<span class="normal">            </span><span class="cbracket">}</span><span class="symbol">;</span>
<span class="normal">            parallel</span><span class="symbol">::</span><span class="function">multiway_merge_sentinel</span><span class="symbol">(</span><span class="normal">seqs</span><span class="symbol">,</span><span class="normal"> seqs </span><span class="symbol">+</span><span class="normal"> </span><span class="number">3</span><span class="symbol">,</span><span class="normal"> delete_buffer_current_min</span><span class="symbol">,</span><span class="normal"> inv_cmp</span><span class="symbol">,</span><span class="normal"> length</span><span class="symbol">);</span><span class="normal"> </span><span class="comment">//sequence iterators are progressed appropriately</span>

<span class="normal">            group_buffer_current_mins</span><span class="symbol">[</span><span class="number">0</span><span class="symbol">]</span><span class="normal"> </span><span class="symbol">=</span><span class="normal"> seqs</span><span class="symbol">[</span><span class="number">0</span><span class="symbol">].</span><span class="normal">first</span><span class="symbol">;</span>
<span class="normal">            group_buffer_current_mins</span><span class="symbol">[</span><span class="number">1</span><span class="symbol">]</span><span class="normal"> </span><span class="symbol">=</span><span class="normal"> seqs</span><span class="symbol">[</span><span class="number">1</span><span class="symbol">].</span><span class="normal">first</span><span class="symbol">;</span>
<span class="normal">            group_buffer_current_mins</span><span class="symbol">[</span><span class="number">2</span><span class="symbol">]</span><span class="normal"> </span><span class="symbol">=</span><span class="normal"> seqs</span><span class="symbol">[</span><span class="number">2</span><span class="symbol">].</span><span class="normal">first</span><span class="symbol">;</span>
<span class="normal">        </span><span class="cbracket">}</span>
<span class="preproc">#else</span>
<span class="normal">        priority_queue_local</span><span class="symbol">::</span><span class="function">merge3_iterator</span><span class="symbol">(</span>
<span class="normal">            group_buffer_current_mins</span><span class="symbol">[</span><span class="number">0</span><span class="symbol">],</span>
<span class="normal">            group_buffer_current_mins</span><span class="symbol">[</span><span class="number">1</span><span class="symbol">],</span>
<span class="normal">            group_buffer_current_mins</span><span class="symbol">[</span><span class="number">2</span><span class="symbol">],</span><span class="normal"> delete_buffer_current_min</span><span class="symbol">,</span><span class="normal"> length</span><span class="symbol">,</span><span class="normal"> cmp</span><span class="symbol">);</span>
<span class="preproc">#endif</span>
<span class="normal">        </span><span class="keyword">break</span><span class="symbol">;</span>
<span class="normal">    </span><span class="keyword">case</span><span class="normal"> </span><span class="number">4</span><span class="symbol">:</span>
<span class="preproc">#if</span><span class="normal"> STXXL_PARALLEL </span><span class="symbol">&amp;&amp;</span><span class="normal"> STXXL_PARALLEL_PQ_MULTIWAY_MERGE_DELETE_BUFFER</span>
<span class="normal">        </span><span class="cbracket">{</span>
<span class="normal">            std</span><span class="symbol">::</span><span class="usertype">pair&lt;value_type *, value_type *&gt;</span><span class="normal"> seqs</span><span class="symbol">[</span><span class="number">4</span><span class="symbol">]</span><span class="normal"> </span><span class="symbol">=</span>
<span class="normal">            </span><span class="cbracket">{</span>
<span class="normal">                std</span><span class="symbol">::</span><span class="function">make_pair</span><span class="symbol">(</span><span class="normal">group_buffer_current_mins</span><span class="symbol">[</span><span class="number">0</span><span class="symbol">],</span><span class="normal"> group_buffers</span><span class="symbol">[</span><span class="number">0</span><span class="symbol">]</span><span class="normal"> </span><span class="symbol">+</span><span class="normal"> N</span><span class="symbol">),</span>
<span class="normal">                std</span><span class="symbol">::</span><span class="function">make_pair</span><span class="symbol">(</span><span class="normal">group_buffer_current_mins</span><span class="symbol">[</span><span class="number">1</span><span class="symbol">],</span><span class="normal"> group_buffers</span><span class="symbol">[</span><span class="number">1</span><span class="symbol">]</span><span class="normal"> </span><span class="symbol">+</span><span class="normal"> N</span><span class="symbol">),</span>
<span class="normal">                std</span><span class="symbol">::</span><span class="function">make_pair</span><span class="symbol">(</span><span class="normal">group_buffer_current_mins</span><span class="symbol">[</span><span class="number">2</span><span class="symbol">],</span><span class="normal"> group_buffers</span><span class="symbol">[</span><span class="number">2</span><span class="symbol">]</span><span class="normal"> </span><span class="symbol">+</span><span class="normal"> N</span><span class="symbol">),</span>
<span class="normal">                std</span><span class="symbol">::</span><span class="function">make_pair</span><span class="symbol">(</span><span class="normal">group_buffer_current_mins</span><span class="symbol">[</span><span class="number">3</span><span class="symbol">],</span><span class="normal"> group_buffers</span><span class="symbol">[</span><span class="number">3</span><span class="symbol">]</span><span class="normal"> </span><span class="symbol">+</span><span class="normal"> N</span><span class="symbol">)</span>
<span class="normal">            </span><span class="cbracket">}</span><span class="symbol">;</span>
<span class="normal">            parallel</span><span class="symbol">::</span><span class="function">multiway_merge_sentinel</span><span class="symbol">(</span><span class="normal">seqs</span><span class="symbol">,</span><span class="normal"> seqs </span><span class="symbol">+</span><span class="normal"> </span><span class="number">4</span><span class="symbol">,</span><span class="normal"> delete_buffer_current_min</span><span class="symbol">,</span><span class="normal"> inv_cmp</span><span class="symbol">,</span><span class="normal"> length</span><span class="symbol">);</span><span class="normal"> </span><span class="comment">//sequence iterators are progressed appropriately</span>

<span class="normal">            group_buffer_current_mins</span><span class="symbol">[</span><span class="number">0</span><span class="symbol">]</span><span class="normal"> </span><span class="symbol">=</span><span class="normal"> seqs</span><span class="symbol">[</span><span class="number">0</span><span class="symbol">].</span><span class="normal">first</span><span class="symbol">;</span>
<span class="normal">            group_buffer_current_mins</span><span class="symbol">[</span><span class="number">1</span><span class="symbol">]</span><span class="normal"> </span><span class="symbol">=</span><span class="normal"> seqs</span><span class="symbol">[</span><span class="number">1</span><span class="symbol">].</span><span class="normal">first</span><span class="symbol">;</span>
<span class="normal">            group_buffer_current_mins</span><span class="symbol">[</span><span class="number">2</span><span class="symbol">]</span><span class="normal"> </span><span class="symbol">=</span><span class="normal"> seqs</span><span class="symbol">[</span><span class="number">2</span><span class="symbol">].</span><span class="normal">first</span><span class="symbol">;</span>
<span class="normal">            group_buffer_current_mins</span><span class="symbol">[</span><span class="number">3</span><span class="symbol">]</span><span class="normal"> </span><span class="symbol">=</span><span class="normal"> seqs</span><span class="symbol">[</span><span class="number">3</span><span class="symbol">].</span><span class="normal">first</span><span class="symbol">;</span>
<span class="normal">        </span><span class="cbracket">}</span>
<span class="preproc">#else</span>
<span class="normal">        priority_queue_local</span><span class="symbol">::</span><span class="function">merge4_iterator</span><span class="symbol">(</span>
<span class="normal">            group_buffer_current_mins</span><span class="symbol">[</span><span class="number">0</span><span class="symbol">],</span>
<span class="normal">            group_buffer_current_mins</span><span class="symbol">[</span><span class="number">1</span><span class="symbol">],</span>
<span class="normal">            group_buffer_current_mins</span><span class="symbol">[</span><span class="number">2</span><span class="symbol">],</span>
<span class="normal">            group_buffer_current_mins</span><span class="symbol">[</span><span class="number">3</span><span class="symbol">],</span><span class="normal"> delete_buffer_current_min</span><span class="symbol">,</span><span class="normal"> length</span><span class="symbol">,</span><span class="normal"> cmp</span><span class="symbol">);</span><span class="normal"> </span><span class="comment">//side effect free</span>
<span class="preproc">#endif</span>
<span class="normal">        </span><span class="keyword">break</span><span class="symbol">;</span>
<span class="label">    default:</span>
<span class="normal">        </span><span class="function">STXXL_THROW</span><span class="symbol">(</span><span class="normal">std</span><span class="symbol">::</span><span class="normal">runtime_error</span><span class="symbol">,</span><span class="normal"> </span><span class="string">"priority_queue&lt;...&gt;::refill_delete_buffer()"</span><span class="symbol">,</span>
<span class="normal">                    </span><span class="string">"Overflow! The number of buffers on 2nd level in stxxl::priority_queue is currently limited to 4"</span><span class="symbol">);</span>
<span class="normal">    </span><span class="cbracket">}</span>

<span class="preproc">#if</span><span class="normal"> STXXL_CHECK_ORDER_IN_SORTS</span>
<span class="normal">    </span><span class="keyword">if</span><span class="normal"> </span><span class="symbol">(!</span><span class="normal">stxxl</span><span class="symbol">::</span><span class="function">is_sorted</span><span class="symbol">(</span><span class="normal">delete_buffer_current_min</span><span class="symbol">,</span><span class="normal"> delete_buffer_end</span><span class="symbol">,</span><span class="normal"> inv_cmp</span><span class="symbol">))</span>
<span class="normal">    </span><span class="cbracket">{</span>
<span class="normal">        </span><span class="keyword">for</span><span class="normal"> </span><span class="symbol">(</span><span class="normal">value_type </span><span class="symbol">*</span><span class="normal"> v </span><span class="symbol">=</span><span class="normal"> delete_buffer_current_min </span><span class="symbol">+</span><span class="normal"> </span><span class="number">1</span><span class="symbol">;</span><span class="normal"> v </span><span class="symbol">&lt;</span><span class="normal"> delete_buffer_end</span><span class="symbol">;</span><span class="normal"> </span><span class="symbol">++</span><span class="normal">v</span><span class="symbol">)</span>
<span class="normal">        </span><span class="cbracket">{</span>
<span class="normal">            </span><span class="keyword">if</span><span class="normal"> </span><span class="symbol">(</span><span class="function">inv_cmp</span><span class="symbol">(*</span><span class="normal">v</span><span class="symbol">,</span><span class="normal"> </span><span class="symbol">*(</span><span class="normal">v </span><span class="symbol">-</span><span class="normal"> </span><span class="number">1</span><span class="symbol">)))</span>
<span class="normal">            </span><span class="cbracket">{</span>
<span class="normal">                </span><span class="function">STXXL_MSG</span><span class="symbol">(</span><span class="string">"Error at position "</span><span class="normal"> </span><span class="symbol">&lt;&lt;</span><span class="normal"> </span><span class="symbol">(</span><span class="normal">v </span><span class="symbol">-</span><span class="normal"> delete_buffer_current_min </span><span class="symbol">-</span><span class="normal"> </span><span class="number">1</span><span class="symbol">)</span><span class="normal"> </span><span class="symbol">&lt;&lt;</span><span class="normal"> </span><span class="string">"/"</span><span class="normal"> </span><span class="symbol">&lt;&lt;</span><span class="normal"> </span><span class="symbol">(</span><span class="normal">v </span><span class="symbol">-</span><span class="normal"> delete_buffer_current_min</span><span class="symbol">)</span><span class="normal"> </span><span class="symbol">&lt;&lt;</span><span class="normal"> </span><span class="string">"   "</span><span class="normal"> </span><span class="symbol">&lt;&lt;</span><span class="normal"> </span><span class="symbol">*(</span><span class="normal">v </span><span class="symbol">-</span><span class="normal"> </span><span class="number">1</span><span class="symbol">)</span><span class="normal"> </span><span class="symbol">&lt;&lt;</span><span class="normal"> </span><span class="string">" "</span><span class="normal"> </span><span class="symbol">&lt;&lt;</span><span class="normal"> </span><span class="symbol">*</span><span class="normal">v</span><span class="symbol">);</span>
<span class="normal">            </span><span class="cbracket">}</span>
<span class="normal">        </span><span class="cbracket">}</span>
<span class="normal">        </span><span class="function">assert</span><span class="symbol">(</span><span class="keyword">false</span><span class="symbol">);</span>
<span class="normal">    </span><span class="cbracket">}</span>
<span class="preproc">#endif</span>
<span class="normal">    </span><span class="comment">//std::copy(delete_buffer_current_min,delete_buffer_current_min + length,std::ostream_iterator&lt;value_type&gt;(std::cout, "\n"));</span>
<span class="cbracket">}</span>

<span class="comment">//--------------------------------------------------------------------</span>

<span class="comment">// check if space is available on level k and</span>
<span class="comment">// empty this level if necessary leading to a recursive call.</span>
<span class="comment">// return the level where space was finally available</span>
<span class="keyword">template</span><span class="normal"> </span><span class="symbol">&lt;</span><span class="keyword">class</span><span class="normal"> </span><span class="classname">Config_</span><span class="symbol">&gt;</span>
<span class="usertype">unsigned_type</span><span class="normal"> priority_queue</span><span class="symbol">&lt;</span><span class="normal">Config_</span><span class="symbol">&gt;::</span><span class="function">make_space_available</span><span class="symbol">(</span><span class="usertype">unsigned_type</span><span class="normal"> level</span><span class="symbol">)</span>
<span class="cbracket">{</span>
<span class="normal">    </span><span class="function">STXXL_VERBOSE_PQ</span><span class="symbol">(</span><span class="string">"make_space_available("</span><span class="normal"> </span><span class="symbol">&lt;&lt;</span><span class="normal"> level </span><span class="symbol">&lt;&lt;</span><span class="normal"> </span><span class="string">")"</span><span class="symbol">);</span>
<span class="normal">    </span><span class="usertype">unsigned_type</span><span class="normal"> finalLevel</span><span class="symbol">;</span>
<span class="normal">    </span><span class="function">assert</span><span class="symbol">(</span><span class="normal">level </span><span class="symbol">&lt;</span><span class="normal"> total_num_groups</span><span class="symbol">);</span>
<span class="normal">    </span><span class="function">assert</span><span class="symbol">(</span><span class="normal">level </span><span class="symbol">&lt;=</span><span class="normal"> num_active_groups</span><span class="symbol">);</span>

<span class="normal">    </span><span class="keyword">if</span><span class="normal"> </span><span class="symbol">(</span><span class="normal">level </span><span class="symbol">==</span><span class="normal"> num_active_groups</span><span class="symbol">)</span>
<span class="normal">        </span><span class="symbol">++</span><span class="normal">num_active_groups</span><span class="symbol">;</span>

<span class="normal">    </span><span class="keyword">const</span><span class="normal"> </span><span class="type">bool</span><span class="normal"> spaceIsAvailable_ </span><span class="symbol">=</span>
<span class="normal">        </span><span class="symbol">(</span><span class="normal">level </span><span class="symbol">&lt;</span><span class="normal"> num_int_groups</span><span class="symbol">)</span><span class="normal"> </span><span class="symbol">?</span><span class="normal"> int_mergers</span><span class="symbol">[</span><span class="normal">level</span><span class="symbol">].</span><span class="function">is_space_available</span><span class="symbol">()</span>
<span class="normal">        </span><span class="symbol">:</span><span class="normal"> </span><span class="symbol">(</span><span class="normal">ext_mergers</span><span class="symbol">[</span><span class="normal">level </span><span class="symbol">-</span><span class="normal"> num_int_groups</span><span class="symbol">]-&gt;</span><span class="function">is_space_available</span><span class="symbol">());</span>

<span class="normal">    </span><span class="keyword">if</span><span class="normal"> </span><span class="symbol">(</span><span class="normal">spaceIsAvailable_</span><span class="symbol">)</span>
<span class="normal">    </span><span class="cbracket">{</span>
<span class="normal">        finalLevel </span><span class="symbol">=</span><span class="normal"> level</span><span class="symbol">;</span>
<span class="normal">    </span><span class="cbracket">}</span>
<span class="normal">    </span><span class="keyword">else</span><span class="normal"> </span><span class="keyword">if</span><span class="normal"> </span><span class="symbol">(</span><span class="normal">level </span><span class="symbol">==</span><span class="normal"> total_num_groups </span><span class="symbol">-</span><span class="normal"> </span><span class="number">1</span><span class="symbol">)</span>
<span class="normal">    </span><span class="cbracket">{</span>
<span class="normal">        </span><span class="usertype">size_type</span><span class="normal"> capacity </span><span class="symbol">=</span><span class="normal"> N</span><span class="symbol">;</span>
<span class="normal">        </span><span class="keyword">for</span><span class="normal"> </span><span class="symbol">(</span><span class="type">int</span><span class="normal"> i </span><span class="symbol">=</span><span class="normal"> </span><span class="number">0</span><span class="symbol">;</span><span class="normal"> i </span><span class="symbol">&lt;</span><span class="normal"> num_int_groups</span><span class="symbol">;</span><span class="normal"> </span><span class="symbol">++</span><span class="normal">i</span><span class="symbol">)</span>
<span class="normal">            capacity </span><span class="symbol">*=</span><span class="normal"> IntKMAX</span><span class="symbol">;</span>
<span class="normal">        </span><span class="keyword">for</span><span class="normal"> </span><span class="symbol">(</span><span class="type">int</span><span class="normal"> i </span><span class="symbol">=</span><span class="normal"> </span><span class="number">0</span><span class="symbol">;</span><span class="normal"> i </span><span class="symbol">&lt;</span><span class="normal"> num_ext_groups</span><span class="symbol">;</span><span class="normal"> </span><span class="symbol">++</span><span class="normal">i</span><span class="symbol">)</span>
<span class="normal">            capacity </span><span class="symbol">*=</span><span class="normal"> ExtKMAX</span><span class="symbol">;</span>
<span class="normal">        </span><span class="function">STXXL_ERRMSG</span><span class="symbol">(</span><span class="string">"priority_queue OVERFLOW - all groups full, size="</span><span class="normal"> </span><span class="symbol">&lt;&lt;</span><span class="normal"> </span><span class="function">size</span><span class="symbol">()</span><span class="normal"> </span><span class="symbol">&lt;&lt;</span>
<span class="normal">                     </span><span class="string">", capacity(last externel group ("</span><span class="normal"> </span><span class="symbol">&lt;&lt;</span><span class="normal"> num_int_groups </span><span class="symbol">+</span><span class="normal"> num_ext_groups </span><span class="symbol">-</span><span class="normal"> </span><span class="number">1</span><span class="normal"> </span><span class="symbol">&lt;&lt;</span><span class="normal"> </span><span class="string">"))="</span><span class="normal"> </span><span class="symbol">&lt;&lt;</span><span class="normal"> capacity</span><span class="symbol">);</span>
<span class="normal">        </span><span class="function">dump_sizes</span><span class="symbol">();</span>

<span class="normal">        </span><span class="type">int</span><span class="normal"> extLevel </span><span class="symbol">=</span><span class="normal"> level </span><span class="symbol">-</span><span class="normal"> num_int_groups</span><span class="symbol">;</span>
<span class="normal">        </span><span class="keyword">const</span><span class="normal"> </span><span class="usertype">size_type</span><span class="normal"> segmentSize </span><span class="symbol">=</span><span class="normal"> ext_mergers</span><span class="symbol">[</span><span class="normal">extLevel</span><span class="symbol">]-&gt;</span><span class="function">size</span><span class="symbol">();</span>
<span class="normal">        </span><span class="function">STXXL_VERBOSE1</span><span class="symbol">(</span><span class="string">"Inserting segment into last level external: "</span><span class="normal"> </span><span class="symbol">&lt;&lt;</span><span class="normal"> level </span><span class="symbol">&lt;&lt;</span><span class="normal"> </span><span class="string">" "</span><span class="normal"> </span><span class="symbol">&lt;&lt;</span><span class="normal"> segmentSize</span><span class="symbol">);</span>
<span class="normal">        ext_merger_type </span><span class="symbol">*</span><span class="normal"> overflow_merger </span><span class="symbol">=</span><span class="normal"> </span><span class="keyword">new</span><span class="normal"> ext_merger_type</span><span class="symbol">;</span>
<span class="normal">        overflow_merger</span><span class="symbol">-&gt;</span><span class="function">set_pool</span><span class="symbol">(</span><span class="normal">pool</span><span class="symbol">);</span>
<span class="normal">        overflow_merger</span><span class="symbol">-&gt;</span><span class="function">insert_segment</span><span class="symbol">(*</span><span class="normal">ext_mergers</span><span class="symbol">[</span><span class="normal">extLevel</span><span class="symbol">],</span><span class="normal"> segmentSize</span><span class="symbol">);</span>
<span class="normal">        std</span><span class="symbol">::</span><span class="function">swap</span><span class="symbol">(</span><span class="normal">ext_mergers</span><span class="symbol">[</span><span class="normal">extLevel</span><span class="symbol">],</span><span class="normal"> overflow_merger</span><span class="symbol">);</span>
<span class="normal">        </span><span class="keyword">delete</span><span class="normal"> overflow_merger</span><span class="symbol">;</span>
<span class="normal">        finalLevel </span><span class="symbol">=</span><span class="normal"> level</span><span class="symbol">;</span>
<span class="normal">    </span><span class="cbracket">}</span>
<span class="normal">    </span><span class="keyword">else</span>
<span class="normal">    </span><span class="cbracket">{</span>
<span class="normal">        finalLevel </span><span class="symbol">=</span><span class="normal"> </span><span class="function">make_space_available</span><span class="symbol">(</span><span class="normal">level </span><span class="symbol">+</span><span class="normal"> </span><span class="number">1</span><span class="symbol">);</span>

<span class="normal">        </span><span class="keyword">if</span><span class="normal"> </span><span class="symbol">(</span><span class="normal">level </span><span class="symbol">&lt;</span><span class="normal"> num_int_groups </span><span class="symbol">-</span><span class="normal"> </span><span class="number">1</span><span class="symbol">)</span><span class="normal">                                  </span><span class="comment">// from internal to internal tree</span>
<span class="normal">        </span><span class="cbracket">{</span>
<span class="normal">            </span><span class="usertype">unsigned_type</span><span class="normal"> segmentSize </span><span class="symbol">=</span><span class="normal"> int_mergers</span><span class="symbol">[</span><span class="normal">level</span><span class="symbol">].</span><span class="function">size</span><span class="symbol">();</span>
<span class="normal">            value_type </span><span class="symbol">*</span><span class="normal"> newSegment </span><span class="symbol">=</span><span class="normal"> </span><span class="keyword">new</span><span class="normal"> value_type</span><span class="symbol">[</span><span class="normal">segmentSize </span><span class="symbol">+</span><span class="normal"> </span><span class="number">1</span><span class="symbol">];</span>
<span class="normal">            int_mergers</span><span class="symbol">[</span><span class="normal">level</span><span class="symbol">].</span><span class="function">multi_merge</span><span class="symbol">(</span><span class="normal">newSegment</span><span class="symbol">,</span><span class="normal"> segmentSize</span><span class="symbol">);</span><span class="normal">     </span><span class="comment">// empty this level</span>

<span class="normal">            newSegment</span><span class="symbol">[</span><span class="normal">segmentSize</span><span class="symbol">]</span><span class="normal"> </span><span class="symbol">=</span><span class="normal"> delete_buffer</span><span class="symbol">[</span><span class="normal">delete_buffer_size</span><span class="symbol">];</span><span class="normal"> </span><span class="comment">// sentinel</span>
<span class="normal">            </span><span class="comment">// for queues where size &lt;&lt; #inserts</span>
<span class="normal">            </span><span class="comment">// it might make sense to stay in this level if</span>
<span class="normal">            </span><span class="comment">// segmentSize &lt; alpha * KNN * k^level for some alpha &lt; 1</span>
<span class="normal">            int_mergers</span><span class="symbol">[</span><span class="normal">level </span><span class="symbol">+</span><span class="normal"> </span><span class="number">1</span><span class="symbol">].</span><span class="function">insert_segment</span><span class="symbol">(</span><span class="normal">newSegment</span><span class="symbol">,</span><span class="normal"> segmentSize</span><span class="symbol">);</span>
<span class="normal">        </span><span class="cbracket">}</span>
<span class="normal">        </span><span class="keyword">else</span>
<span class="normal">        </span><span class="cbracket">{</span>
<span class="normal">            </span><span class="keyword">if</span><span class="normal"> </span><span class="symbol">(</span><span class="normal">level </span><span class="symbol">==</span><span class="normal"> num_int_groups </span><span class="symbol">-</span><span class="normal"> </span><span class="number">1</span><span class="symbol">)</span><span class="normal"> </span><span class="comment">// from internal to external tree</span>
<span class="normal">            </span><span class="cbracket">{</span>
<span class="normal">                </span><span class="keyword">const</span><span class="normal"> </span><span class="usertype">unsigned_type</span><span class="normal"> segmentSize </span><span class="symbol">=</span><span class="normal"> int_mergers</span><span class="symbol">[</span><span class="normal">num_int_groups </span><span class="symbol">-</span><span class="normal"> </span><span class="number">1</span><span class="symbol">].</span><span class="function">size</span><span class="symbol">();</span>
<span class="normal">                </span><span class="function">STXXL_VERBOSE_PQ</span><span class="symbol">(</span><span class="string">"make_space... Inserting segment into first level external: "</span><span class="normal"> </span><span class="symbol">&lt;&lt;</span><span class="normal"> level </span><span class="symbol">&lt;&lt;</span><span class="normal"> </span><span class="string">" "</span><span class="normal"> </span><span class="symbol">&lt;&lt;</span><span class="normal"> segmentSize</span><span class="symbol">);</span>
<span class="normal">                ext_mergers</span><span class="symbol">[</span><span class="number">0</span><span class="symbol">]-&gt;</span><span class="function">insert_segment</span><span class="symbol">(</span><span class="normal">int_mergers</span><span class="symbol">[</span><span class="normal">num_int_groups </span><span class="symbol">-</span><span class="normal"> </span><span class="number">1</span><span class="symbol">],</span><span class="normal"> segmentSize</span><span class="symbol">);</span>
<span class="normal">            </span><span class="cbracket">}</span>
<span class="normal">            </span><span class="keyword">else</span><span class="normal"> </span><span class="comment">// from external to external tree</span>
<span class="normal">            </span><span class="cbracket">{</span>
<span class="normal">                </span><span class="keyword">const</span><span class="normal"> </span><span class="usertype">size_type</span><span class="normal"> segmentSize </span><span class="symbol">=</span><span class="normal"> ext_mergers</span><span class="symbol">[</span><span class="normal">level </span><span class="symbol">-</span><span class="normal"> num_int_groups</span><span class="symbol">]-&gt;</span><span class="function">size</span><span class="symbol">();</span>
<span class="normal">                </span><span class="function">STXXL_VERBOSE_PQ</span><span class="symbol">(</span><span class="string">"make_space... Inserting segment into second level external: "</span><span class="normal"> </span><span class="symbol">&lt;&lt;</span><span class="normal"> level </span><span class="symbol">&lt;&lt;</span><span class="normal"> </span><span class="string">" "</span><span class="normal"> </span><span class="symbol">&lt;&lt;</span><span class="normal"> segmentSize</span><span class="symbol">);</span>
<span class="normal">                ext_mergers</span><span class="symbol">[</span><span class="normal">level </span><span class="symbol">-</span><span class="normal"> num_int_groups </span><span class="symbol">+</span><span class="normal"> </span><span class="number">1</span><span class="symbol">]-&gt;</span><span class="function">insert_segment</span><span class="symbol">(*</span><span class="normal">ext_mergers</span><span class="symbol">[</span><span class="normal">level </span><span class="symbol">-</span><span class="normal"> num_int_groups</span><span class="symbol">],</span><span class="normal"> segmentSize</span><span class="symbol">);</span>
<span class="normal">            </span><span class="cbracket">}</span>
<span class="normal">        </span><span class="cbracket">}</span>
<span class="normal">    </span><span class="cbracket">}</span>
<span class="normal">    </span><span class="keyword">return</span><span class="normal"> finalLevel</span><span class="symbol">;</span>
<span class="cbracket">}</span>


<span class="comment">// empty the insert heap into the main data structure</span>
<span class="keyword">template</span><span class="normal"> </span><span class="symbol">&lt;</span><span class="keyword">class</span><span class="normal"> </span><span class="classname">Config_</span><span class="symbol">&gt;</span>
<span class="type">void</span><span class="normal"> priority_queue</span><span class="symbol">&lt;</span><span class="normal">Config_</span><span class="symbol">&gt;::</span><span class="function">empty_insert_heap</span><span class="symbol">()</span>
<span class="cbracket">{</span>
<span class="normal">    </span><span class="function">STXXL_VERBOSE_PQ</span><span class="symbol">(</span><span class="string">"empty_insert_heap()"</span><span class="symbol">);</span>
<span class="normal">    </span><span class="function">assert</span><span class="symbol">(</span><span class="normal">insert_heap</span><span class="symbol">.</span><span class="function">size</span><span class="symbol">()</span><span class="normal"> </span><span class="symbol">==</span><span class="normal"> </span><span class="symbol">(</span><span class="normal">N </span><span class="symbol">+</span><span class="normal"> </span><span class="number">1</span><span class="symbol">));</span>

<span class="normal">    </span><span class="keyword">const</span><span class="normal"> </span><span class="usertype">value_type</span><span class="normal"> sup </span><span class="symbol">=</span><span class="normal"> </span><span class="function">get_supremum</span><span class="symbol">();</span>

<span class="normal">    </span><span class="comment">// build new segment</span>
<span class="normal">    value_type </span><span class="symbol">*</span><span class="normal"> newSegment </span><span class="symbol">=</span><span class="normal"> </span><span class="keyword">new</span><span class="normal"> value_type</span><span class="symbol">[</span><span class="normal">N </span><span class="symbol">+</span><span class="normal"> </span><span class="number">1</span><span class="symbol">];</span>
<span class="normal">    value_type </span><span class="symbol">*</span><span class="normal"> newPos </span><span class="symbol">=</span><span class="normal"> newSegment</span><span class="symbol">;</span>

<span class="normal">    </span><span class="comment">// put the new data there for now</span>
<span class="normal">    </span><span class="comment">//insert_heap.sortTo(newSegment);</span>
<span class="normal">    value_type </span><span class="symbol">*</span><span class="normal"> SortTo </span><span class="symbol">=</span><span class="normal"> newSegment</span><span class="symbol">;</span>

<span class="normal">    insert_heap</span><span class="symbol">.</span><span class="function">sort_to</span><span class="symbol">(</span><span class="normal">SortTo</span><span class="symbol">);</span>

<span class="normal">    SortTo </span><span class="symbol">=</span><span class="normal"> newSegment </span><span class="symbol">+</span><span class="normal"> N</span><span class="symbol">;</span>
<span class="normal">    insert_heap</span><span class="symbol">.</span><span class="function">clear</span><span class="symbol">();</span>
<span class="normal">    insert_heap</span><span class="symbol">.</span><span class="function">push</span><span class="symbol">(*</span><span class="normal">SortTo</span><span class="symbol">);</span>

<span class="normal">    </span><span class="function">assert</span><span class="symbol">(</span><span class="normal">insert_heap</span><span class="symbol">.</span><span class="function">size</span><span class="symbol">()</span><span class="normal"> </span><span class="symbol">==</span><span class="normal"> </span><span class="number">1</span><span class="symbol">);</span>

<span class="normal">    newSegment</span><span class="symbol">[</span><span class="normal">N</span><span class="symbol">]</span><span class="normal"> </span><span class="symbol">=</span><span class="normal"> sup</span><span class="symbol">;</span><span class="normal"> </span><span class="comment">// sentinel</span>

<span class="normal">    </span><span class="comment">// copy the delete_buffer and group_buffers[0] to temporary storage</span>
<span class="normal">    </span><span class="comment">// (the temporary can be eliminated using some dirty tricks)</span>
<span class="normal">    </span><span class="keyword">const</span><span class="normal"> </span><span class="usertype">unsigned_type</span><span class="normal"> tempSize </span><span class="symbol">=</span><span class="normal"> N </span><span class="symbol">+</span><span class="normal"> delete_buffer_size</span><span class="symbol">;</span>
<span class="normal">    </span><span class="usertype">value_type</span><span class="normal"> temp</span><span class="symbol">[</span><span class="normal">tempSize </span><span class="symbol">+</span><span class="normal"> </span><span class="number">1</span><span class="symbol">];</span>
<span class="normal">    </span><span class="usertype">unsigned_type</span><span class="normal"> sz1 </span><span class="symbol">=</span><span class="normal"> </span><span class="function">current_delete_buffer_size</span><span class="symbol">();</span>
<span class="normal">    </span><span class="usertype">unsigned_type</span><span class="normal"> sz2 </span><span class="symbol">=</span><span class="normal"> </span><span class="function">current_group_buffer_size</span><span class="symbol">(</span><span class="number">0</span><span class="symbol">);</span>
<span class="normal">    value_type </span><span class="symbol">*</span><span class="normal"> pos </span><span class="symbol">=</span><span class="normal"> temp </span><span class="symbol">+</span><span class="normal"> tempSize </span><span class="symbol">-</span><span class="normal"> sz1 </span><span class="symbol">-</span><span class="normal"> sz2</span><span class="symbol">;</span>
<span class="normal">    std</span><span class="symbol">::</span><span class="function">copy</span><span class="symbol">(</span><span class="normal">delete_buffer_current_min</span><span class="symbol">,</span><span class="normal"> delete_buffer_current_min </span><span class="symbol">+</span><span class="normal"> sz1</span><span class="symbol">,</span><span class="normal"> pos</span><span class="symbol">);</span>
<span class="normal">    std</span><span class="symbol">::</span><span class="function">copy</span><span class="symbol">(</span><span class="normal">group_buffer_current_mins</span><span class="symbol">[</span><span class="number">0</span><span class="symbol">],</span><span class="normal"> group_buffer_current_mins</span><span class="symbol">[</span><span class="number">0</span><span class="symbol">]</span><span class="normal"> </span><span class="symbol">+</span><span class="normal"> sz2</span><span class="symbol">,</span><span class="normal"> pos </span><span class="symbol">+</span><span class="normal"> sz1</span><span class="symbol">);</span>
<span class="normal">    temp</span><span class="symbol">[</span><span class="normal">tempSize</span><span class="symbol">]</span><span class="normal"> </span><span class="symbol">=</span><span class="normal"> sup</span><span class="symbol">;</span><span class="normal"> </span><span class="comment">// sentinel</span>

<span class="normal">    </span><span class="comment">// refill delete_buffer</span>
<span class="normal">    </span><span class="comment">// (using more complicated code it could be made somewhat fuller</span>
<span class="normal">    </span><span class="comment">// in certain circumstances)</span>
<span class="normal">    priority_queue_local</span><span class="symbol">::</span><span class="function">merge_iterator</span><span class="symbol">(</span><span class="normal">pos</span><span class="symbol">,</span><span class="normal"> newPos</span><span class="symbol">,</span><span class="normal"> delete_buffer_current_min</span><span class="symbol">,</span><span class="normal"> sz1</span><span class="symbol">,</span><span class="normal"> cmp</span><span class="symbol">);</span>

<span class="normal">    </span><span class="comment">// refill group_buffers[0]</span>
<span class="normal">    </span><span class="comment">// (as above we might want to take the opportunity</span>
<span class="normal">    </span><span class="comment">// to make group_buffers[0] fuller)</span>
<span class="normal">    priority_queue_local</span><span class="symbol">::</span><span class="function">merge_iterator</span><span class="symbol">(</span><span class="normal">pos</span><span class="symbol">,</span><span class="normal"> newPos</span><span class="symbol">,</span><span class="normal"> group_buffer_current_mins</span><span class="symbol">[</span><span class="number">0</span><span class="symbol">],</span><span class="normal"> sz2</span><span class="symbol">,</span><span class="normal"> cmp</span><span class="symbol">);</span>

<span class="normal">    </span><span class="comment">// merge the rest to the new segment</span>
<span class="normal">    </span><span class="comment">// note that merge exactly trips into the footsteps</span>
<span class="normal">    </span><span class="comment">// of itself</span>
<span class="normal">    priority_queue_local</span><span class="symbol">::</span><span class="function">merge_iterator</span><span class="symbol">(</span><span class="normal">pos</span><span class="symbol">,</span><span class="normal"> newPos</span><span class="symbol">,</span><span class="normal"> newSegment</span><span class="symbol">,</span><span class="normal"> N</span><span class="symbol">,</span><span class="normal"> cmp</span><span class="symbol">);</span>

<span class="normal">    </span><span class="comment">// and insert it</span>
<span class="normal">    </span><span class="usertype">unsigned_type</span><span class="normal"> freeLevel </span><span class="symbol">=</span><span class="normal"> </span><span class="function">make_space_available</span><span class="symbol">(</span><span class="number">0</span><span class="symbol">);</span>
<span class="normal">    </span><span class="function">assert</span><span class="symbol">(</span><span class="normal">freeLevel </span><span class="symbol">==</span><span class="normal"> </span><span class="number">0</span><span class="normal"> </span><span class="symbol">||</span><span class="normal"> int_mergers</span><span class="symbol">[</span><span class="number">0</span><span class="symbol">].</span><span class="function">size</span><span class="symbol">()</span><span class="normal"> </span><span class="symbol">==</span><span class="normal"> </span><span class="number">0</span><span class="symbol">);</span>
<span class="normal">    int_mergers</span><span class="symbol">[</span><span class="number">0</span><span class="symbol">].</span><span class="function">insert_segment</span><span class="symbol">(</span><span class="normal">newSegment</span><span class="symbol">,</span><span class="normal"> N</span><span class="symbol">);</span>

<span class="normal">    </span><span class="comment">// get rid of invalid level 2 buffers</span>
<span class="normal">    </span><span class="comment">// by inserting them into tree 0 (which is almost empty in this case)</span>
<span class="normal">    </span><span class="keyword">if</span><span class="normal"> </span><span class="symbol">(</span><span class="normal">freeLevel </span><span class="symbol">&gt;</span><span class="normal"> </span><span class="number">0</span><span class="symbol">)</span>
<span class="normal">    </span><span class="cbracket">{</span>
<span class="normal">        </span><span class="keyword">for</span><span class="normal"> </span><span class="symbol">(</span><span class="usertype">int_type</span><span class="normal"> i </span><span class="symbol">=</span><span class="normal"> freeLevel</span><span class="symbol">;</span><span class="normal"> i </span><span class="symbol">&gt;=</span><span class="normal"> </span><span class="number">0</span><span class="symbol">;</span><span class="normal"> i</span><span class="symbol">--)</span>
<span class="normal">        </span><span class="cbracket">{</span>
<span class="normal">            </span><span class="comment">// reverse order not needed</span>
<span class="normal">            </span><span class="comment">// but would allow immediate refill</span>

<span class="normal">            newSegment </span><span class="symbol">=</span><span class="normal"> </span><span class="keyword">new</span><span class="normal"> value_type</span><span class="symbol">[</span><span class="function">current_group_buffer_size</span><span class="symbol">(</span><span class="normal">i</span><span class="symbol">)</span><span class="normal"> </span><span class="symbol">+</span><span class="normal"> </span><span class="number">1</span><span class="symbol">];</span><span class="normal"> </span><span class="comment">// with sentinel</span>
<span class="normal">            std</span><span class="symbol">::</span><span class="function">copy</span><span class="symbol">(</span><span class="normal">group_buffer_current_mins</span><span class="symbol">[</span><span class="normal">i</span><span class="symbol">],</span><span class="normal"> group_buffer_current_mins</span><span class="symbol">[</span><span class="normal">i</span><span class="symbol">]</span><span class="normal"> </span><span class="symbol">+</span><span class="normal"> </span><span class="function">current_group_buffer_size</span><span class="symbol">(</span><span class="normal">i</span><span class="symbol">)</span><span class="normal"> </span><span class="symbol">+</span><span class="normal"> </span><span class="number">1</span><span class="symbol">,</span><span class="normal"> newSegment</span><span class="symbol">);</span>
<span class="normal">            int_mergers</span><span class="symbol">[</span><span class="number">0</span><span class="symbol">].</span><span class="function">insert_segment</span><span class="symbol">(</span><span class="normal">newSegment</span><span class="symbol">,</span><span class="normal"> </span><span class="function">current_group_buffer_size</span><span class="symbol">(</span><span class="normal">i</span><span class="symbol">));</span>
<span class="normal">            group_buffer_current_mins</span><span class="symbol">[</span><span class="normal">i</span><span class="symbol">]</span><span class="normal"> </span><span class="symbol">=</span><span class="normal"> group_buffers</span><span class="symbol">[</span><span class="normal">i</span><span class="symbol">]</span><span class="normal"> </span><span class="symbol">+</span><span class="normal"> N</span><span class="symbol">;</span><span class="normal">           </span><span class="comment">// empty</span>
<span class="normal">        </span><span class="cbracket">}</span>
<span class="normal">    </span><span class="cbracket">}</span>

<span class="normal">    </span><span class="comment">// update size</span>
<span class="normal">    size_ </span><span class="symbol">+=</span><span class="normal"> </span><span class="function">size_type</span><span class="symbol">(</span><span class="normal">N</span><span class="symbol">);</span>

<span class="normal">    </span><span class="comment">// special case if the tree was empty before</span>
<span class="normal">    </span><span class="keyword">if</span><span class="normal"> </span><span class="symbol">(</span><span class="normal">delete_buffer_current_min </span><span class="symbol">==</span><span class="normal"> delete_buffer_end</span><span class="symbol">)</span>
<span class="normal">        </span><span class="function">refill_delete_buffer</span><span class="symbol">();</span>
<span class="cbracket">}</span>

<span class="keyword">template</span><span class="normal"> </span><span class="symbol">&lt;</span><span class="keyword">class</span><span class="normal"> </span><span class="classname">Config_</span><span class="symbol">&gt;</span>
<span class="type">void</span><span class="normal"> priority_queue</span><span class="symbol">&lt;</span><span class="normal">Config_</span><span class="symbol">&gt;::</span><span class="function">dump_sizes</span><span class="symbol">()</span><span class="normal"> </span><span class="keyword">const</span>
<span class="cbracket">{</span>
<span class="normal">    </span><span class="usertype">unsigned_type</span><span class="normal"> capacity </span><span class="symbol">=</span><span class="normal"> N</span><span class="symbol">;</span>
<span class="normal">    </span><span class="function">STXXL_MSG</span><span class="symbol">(</span><span class="string">"pq::size()</span><span class="specialchar">\t</span><span class="string">= "</span><span class="normal"> </span><span class="symbol">&lt;&lt;</span><span class="normal"> </span><span class="function">size</span><span class="symbol">());</span>
<span class="normal">    </span><span class="function">STXXL_MSG</span><span class="symbol">(</span><span class="string">"  insert_heap</span><span class="specialchar">\t</span><span class="string">= "</span><span class="normal"> </span><span class="symbol">&lt;&lt;</span><span class="normal"> insert_heap</span><span class="symbol">.</span><span class="function">size</span><span class="symbol">()</span><span class="normal"> </span><span class="symbol">-</span><span class="normal"> </span><span class="number">1</span><span class="normal"> </span><span class="symbol">&lt;&lt;</span><span class="normal"> </span><span class="string">"/"</span><span class="normal"> </span><span class="symbol">&lt;&lt;</span><span class="normal"> capacity</span><span class="symbol">);</span>
<span class="normal">    </span><span class="function">STXXL_MSG</span><span class="symbol">(</span><span class="string">"  delete_buffer</span><span class="specialchar">\t</span><span class="string">= "</span><span class="normal"> </span><span class="symbol">&lt;&lt;</span><span class="normal"> </span><span class="symbol">(</span><span class="normal">delete_buffer_end </span><span class="symbol">-</span><span class="normal"> delete_buffer_current_min</span><span class="symbol">)</span><span class="normal"> </span><span class="symbol">&lt;&lt;</span><span class="normal"> </span><span class="string">"/"</span><span class="normal"> </span><span class="symbol">&lt;&lt;</span><span class="normal"> delete_buffer_size</span><span class="symbol">);</span>
<span class="normal">    </span><span class="keyword">for</span><span class="normal"> </span><span class="symbol">(</span><span class="type">int</span><span class="normal"> i </span><span class="symbol">=</span><span class="normal"> </span><span class="number">0</span><span class="symbol">;</span><span class="normal"> i </span><span class="symbol">&lt;</span><span class="normal"> num_int_groups</span><span class="symbol">;</span><span class="normal"> </span><span class="symbol">++</span><span class="normal">i</span><span class="symbol">)</span><span class="normal"> </span><span class="cbracket">{</span>
<span class="normal">        capacity </span><span class="symbol">*=</span><span class="normal"> IntKMAX</span><span class="symbol">;</span>
<span class="normal">        </span><span class="function">STXXL_MSG</span><span class="symbol">(</span><span class="string">"  grp "</span><span class="normal"> </span><span class="symbol">&lt;&lt;</span><span class="normal"> i </span><span class="symbol">&lt;&lt;</span><span class="normal"> </span><span class="string">" int"</span><span class="normal"> </span><span class="symbol">&lt;&lt;</span>
<span class="normal">                </span><span class="string">" grpbuf="</span><span class="normal"> </span><span class="symbol">&lt;&lt;</span><span class="normal"> </span><span class="function">current_group_buffer_size</span><span class="symbol">(</span><span class="normal">i</span><span class="symbol">)</span><span class="normal"> </span><span class="symbol">&lt;&lt;</span>
<span class="normal">                </span><span class="string">" size="</span><span class="normal"> </span><span class="symbol">&lt;&lt;</span><span class="normal"> int_mergers</span><span class="symbol">[</span><span class="normal">i</span><span class="symbol">].</span><span class="function">size</span><span class="symbol">()</span><span class="normal"> </span><span class="symbol">&lt;&lt;</span><span class="normal"> </span><span class="string">"/"</span><span class="normal"> </span><span class="symbol">&lt;&lt;</span><span class="normal"> capacity </span><span class="symbol">&lt;&lt;</span><span class="normal"> </span>
<span class="normal">                </span><span class="string">" space="</span><span class="normal"> </span><span class="symbol">&lt;&lt;</span><span class="normal"> int_mergers</span><span class="symbol">[</span><span class="normal">i</span><span class="symbol">].</span><span class="function">is_space_available</span><span class="symbol">());</span>
<span class="normal">    </span><span class="cbracket">}</span>
<span class="normal">    </span><span class="keyword">for</span><span class="normal"> </span><span class="symbol">(</span><span class="type">int</span><span class="normal"> i </span><span class="symbol">=</span><span class="normal"> </span><span class="number">0</span><span class="symbol">;</span><span class="normal"> i </span><span class="symbol">&lt;</span><span class="normal"> num_ext_groups</span><span class="symbol">;</span><span class="normal"> </span><span class="symbol">++</span><span class="normal">i</span><span class="symbol">)</span><span class="normal"> </span><span class="cbracket">{</span>
<span class="normal">        capacity </span><span class="symbol">*=</span><span class="normal"> ExtKMAX</span><span class="symbol">;</span>
<span class="normal">        </span><span class="function">STXXL_MSG</span><span class="symbol">(</span><span class="string">"  grp "</span><span class="normal"> </span><span class="symbol">&lt;&lt;</span><span class="normal"> i </span><span class="symbol">+</span><span class="normal"> num_int_groups </span><span class="symbol">&lt;&lt;</span><span class="normal"> </span><span class="string">" ext"</span><span class="normal"> </span><span class="symbol">&lt;&lt;</span>
<span class="normal">                </span><span class="string">" grpbuf="</span><span class="normal"> </span><span class="symbol">&lt;&lt;</span><span class="normal"> </span><span class="function">current_group_buffer_size</span><span class="symbol">(</span><span class="normal">i </span><span class="symbol">+</span><span class="normal"> num_int_groups</span><span class="symbol">)</span><span class="normal"> </span><span class="symbol">&lt;&lt;</span>
<span class="normal">                </span><span class="string">" size="</span><span class="normal"> </span><span class="symbol">&lt;&lt;</span><span class="normal"> ext_mergers</span><span class="symbol">[</span><span class="normal">i</span><span class="symbol">]-&gt;</span><span class="function">size</span><span class="symbol">()</span><span class="normal"> </span><span class="symbol">&lt;&lt;</span><span class="normal"> </span><span class="string">"/"</span><span class="normal"> </span><span class="symbol">&lt;&lt;</span><span class="normal"> capacity </span><span class="symbol">&lt;&lt;</span>
<span class="normal">                </span><span class="string">" space="</span><span class="normal"> </span><span class="symbol">&lt;&lt;</span><span class="normal"> ext_mergers</span><span class="symbol">[</span><span class="normal">i</span><span class="symbol">]-&gt;</span><span class="function">is_space_available</span><span class="symbol">());</span>
<span class="normal">    </span><span class="cbracket">}</span>
<span class="normal">    </span><span class="function">dump_params</span><span class="symbol">();</span>
<span class="cbracket">}</span>

<span class="keyword">template</span><span class="normal"> </span><span class="symbol">&lt;</span><span class="keyword">class</span><span class="normal"> </span><span class="classname">Config_</span><span class="symbol">&gt;</span>
<span class="type">void</span><span class="normal"> priority_queue</span><span class="symbol">&lt;</span><span class="normal">Config_</span><span class="symbol">&gt;::</span><span class="function">dump_params</span><span class="symbol">()</span><span class="normal"> </span><span class="keyword">const</span>
<span class="cbracket">{</span>
<span class="normal">    </span><span class="function">STXXL_MSG</span><span class="symbol">(</span><span class="string">"params: delete_buffer_size="</span><span class="normal"> </span><span class="symbol">&lt;&lt;</span><span class="normal"> delete_buffer_size </span><span class="symbol">&lt;&lt;</span><span class="normal"> </span><span class="string">" N="</span><span class="normal"> </span><span class="symbol">&lt;&lt;</span><span class="normal"> N </span><span class="symbol">&lt;&lt;</span><span class="normal"> </span><span class="string">" IntKMAX="</span><span class="normal"> </span><span class="symbol">&lt;&lt;</span><span class="normal"> IntKMAX </span><span class="symbol">&lt;&lt;</span><span class="normal"> </span><span class="string">" num_int_groups="</span><span class="normal"> </span><span class="symbol">&lt;&lt;</span><span class="normal"> num_int_groups </span><span class="symbol">&lt;&lt;</span><span class="normal"> </span><span class="string">" ExtKMAX="</span><span class="normal"> </span><span class="symbol">&lt;&lt;</span><span class="normal"> ExtKMAX </span><span class="symbol">&lt;&lt;</span><span class="normal"> </span><span class="string">" num_ext_groups="</span><span class="normal"> </span><span class="symbol">&lt;&lt;</span><span class="normal"> num_ext_groups </span><span class="symbol">&lt;&lt;</span><span class="normal"> </span><span class="string">" BlockSize="</span><span class="normal"> </span><span class="symbol">&lt;&lt;</span><span class="normal"> BlockSize</span><span class="symbol">);</span>
<span class="cbracket">}</span>

<span class="keyword">namespace</span><span class="normal"> priority_queue_local</span>
<span class="cbracket">{</span>
<span class="normal">    </span><span class="keyword">struct</span><span class="normal"> </span><span class="classname">Parameters_for_priority_queue_not_found_Increase_IntM</span>
<span class="normal">    </span><span class="cbracket">{</span>
<span class="normal">        </span><span class="keyword">enum</span><span class="normal"> </span><span class="cbracket">{</span><span class="normal"> fits </span><span class="symbol">=</span><span class="normal"> </span><span class="keyword">false</span><span class="normal"> </span><span class="cbracket">}</span><span class="symbol">;</span>
<span class="normal">        </span><span class="keyword">typedef</span><span class="normal"> </span><span class="usertype">Parameters_for_priority_queue_not_found_Increase_IntM</span><span class="normal"> result</span><span class="symbol">;</span>
<span class="normal">    </span><span class="cbracket">}</span><span class="symbol">;</span>

<span class="normal">    </span><span class="keyword">struct</span><span class="normal"> </span><span class="classname">dummy</span>
<span class="normal">    </span><span class="cbracket">{</span>
<span class="normal">        </span><span class="keyword">enum</span><span class="normal"> </span><span class="cbracket">{</span><span class="normal"> fits </span><span class="symbol">=</span><span class="normal"> </span><span class="keyword">false</span><span class="normal"> </span><span class="cbracket">}</span><span class="symbol">;</span>
<span class="normal">        </span><span class="keyword">typedef</span><span class="normal"> </span><span class="usertype">dummy</span><span class="normal"> result</span><span class="symbol">;</span>
<span class="normal">    </span><span class="cbracket">}</span><span class="symbol">;</span>

<span class="normal">    </span><span class="keyword">template</span><span class="normal"> </span><span class="symbol">&lt;</span><span class="usertype">unsigned_type</span><span class="normal"> E_</span><span class="symbol">,</span><span class="normal"> </span><span class="usertype">unsigned_type</span><span class="normal"> IntM_</span><span class="symbol">,</span><span class="normal"> </span><span class="usertype">unsigned_type</span><span class="normal"> MaxS_</span><span class="symbol">,</span><span class="normal"> </span><span class="usertype">unsigned_type</span><span class="normal"> B_</span><span class="symbol">,</span><span class="normal"> </span><span class="usertype">unsigned_type</span><span class="normal"> m_</span><span class="symbol">,</span><span class="normal"> </span><span class="type">bool</span><span class="normal"> stop </span><span class="symbol">=</span><span class="normal"> </span><span class="keyword">false</span><span class="symbol">&gt;</span>
<span class="normal">    </span><span class="keyword">struct</span><span class="normal"> </span><span class="classname">find_B_m</span>
<span class="normal">    </span><span class="cbracket">{</span>
<span class="normal">        </span><span class="keyword">typedef</span><span class="normal"> </span><span class="usertype">find_B_m&lt;E_, IntM_, MaxS_, B_, m_, stop&gt;</span><span class="normal"> Self</span><span class="symbol">;</span>
<span class="normal">        </span><span class="keyword">enum</span><span class="normal"> </span><span class="cbracket">{</span>
<span class="normal">            k </span><span class="symbol">=</span><span class="normal"> IntM_ </span><span class="symbol">/</span><span class="normal"> B_</span><span class="symbol">,</span><span class="normal">    </span><span class="comment">// number of blocks that fit into M</span>
<span class="normal">            element_size </span><span class="symbol">=</span><span class="normal"> E_</span><span class="symbol">,</span><span class="normal"> </span><span class="comment">// element size</span>
<span class="normal">            IntM </span><span class="symbol">=</span><span class="normal"> IntM_</span><span class="symbol">,</span>
<span class="normal">            B </span><span class="symbol">=</span><span class="normal"> B_</span><span class="symbol">,</span><span class="normal">            </span><span class="comment">// block size</span>
<span class="normal">            m </span><span class="symbol">=</span><span class="normal"> m_</span><span class="symbol">,</span><span class="normal">            </span><span class="comment">// number of blocks fitting into buffers</span>
<span class="normal">            c </span><span class="symbol">=</span><span class="normal"> k </span><span class="symbol">-</span><span class="normal"> m_</span><span class="symbol">,</span>
<span class="normal">            </span><span class="comment">// memory occ. by block must be at least 10 times larger than size of ext sequence</span>
<span class="normal">            </span><span class="comment">// &amp;&amp; satisfy memory req &amp;&amp; if we have two ext mergers their degree must be at least 64=m/2</span>
<span class="normal">            fits </span><span class="symbol">=</span><span class="normal"> c </span><span class="symbol">&gt;</span><span class="normal"> </span><span class="number">10</span><span class="normal"> </span><span class="symbol">&amp;&amp;</span><span class="normal"> </span><span class="symbol">((</span><span class="normal">k </span><span class="symbol">-</span><span class="normal"> m</span><span class="symbol">)</span><span class="normal"> </span><span class="symbol">*</span><span class="normal"> </span><span class="symbol">(</span><span class="normal">m</span><span class="symbol">)</span><span class="normal"> </span><span class="symbol">*</span><span class="normal"> </span><span class="symbol">(</span><span class="normal">m </span><span class="symbol">*</span><span class="normal"> B </span><span class="symbol">/</span><span class="normal"> </span><span class="symbol">(</span><span class="normal">element_size </span><span class="symbol">*</span><span class="normal"> </span><span class="number">4</span><span class="normal"> </span><span class="symbol">*</span><span class="normal"> </span><span class="number">1024</span><span class="symbol">)))</span><span class="normal"> </span><span class="symbol">&gt;=</span><span class="normal"> MaxS_</span>
<span class="normal">                   </span><span class="symbol">&amp;&amp;</span><span class="normal"> </span><span class="symbol">((</span><span class="normal">MaxS_ </span><span class="symbol">&lt;</span><span class="normal"> </span><span class="symbol">((</span><span class="normal">k </span><span class="symbol">-</span><span class="normal"> m</span><span class="symbol">)</span><span class="normal"> </span><span class="symbol">*</span><span class="normal"> m </span><span class="symbol">/</span><span class="normal"> </span><span class="symbol">(</span><span class="number">2</span><span class="normal"> </span><span class="symbol">*</span><span class="normal"> element_size</span><span class="symbol">))</span><span class="normal"> </span><span class="symbol">*</span><span class="normal"> </span><span class="number">1024</span><span class="symbol">)</span><span class="normal"> </span><span class="symbol">||</span><span class="normal"> m </span><span class="symbol">&gt;=</span><span class="normal"> </span><span class="number">128</span><span class="symbol">),</span>
<span class="normal">            step </span><span class="symbol">=</span><span class="normal"> </span><span class="number">1</span>
<span class="normal">        </span><span class="cbracket">}</span><span class="symbol">;</span>

<span class="normal">        </span><span class="keyword">typedef</span><span class="normal"> </span><span class="keyword">typename</span><span class="normal"> </span><span class="classname">find_B_m</span><span class="symbol">&lt;</span><span class="normal">element_size</span><span class="symbol">,</span><span class="normal"> IntM</span><span class="symbol">,</span><span class="normal"> MaxS_</span><span class="symbol">,</span><span class="normal"> B</span><span class="symbol">,</span><span class="normal"> m </span><span class="symbol">+</span><span class="normal"> step</span><span class="symbol">,</span><span class="normal"> fits </span><span class="symbol">||</span><span class="normal"> </span><span class="symbol">(</span><span class="normal">m </span><span class="symbol">&gt;=</span><span class="normal"> k </span><span class="symbol">-</span><span class="normal"> step</span><span class="symbol">)&gt;::</span><span class="usertype">result</span><span class="normal"> candidate1</span><span class="symbol">;</span>
<span class="normal">        </span><span class="keyword">typedef</span><span class="normal"> </span><span class="keyword">typename</span><span class="normal"> </span><span class="classname">find_B_m</span><span class="symbol">&lt;</span><span class="normal">element_size</span><span class="symbol">,</span><span class="normal"> IntM</span><span class="symbol">,</span><span class="normal"> MaxS_</span><span class="symbol">,</span><span class="normal"> B </span><span class="symbol">/</span><span class="normal"> </span><span class="number">2</span><span class="symbol">,</span><span class="normal"> </span><span class="number">1</span><span class="symbol">,</span><span class="normal"> fits </span><span class="symbol">||</span><span class="normal"> candidate1</span><span class="symbol">::</span><span class="normal">fits</span><span class="symbol">&gt;::</span><span class="usertype">result</span><span class="normal"> candidate2</span><span class="symbol">;</span>
<span class="normal">        </span><span class="keyword">typedef</span><span class="normal"> </span><span class="keyword">typename</span><span class="normal"> </span><span class="classname">IF</span><span class="symbol">&lt;</span><span class="normal">fits</span><span class="symbol">,</span><span class="normal"> Self</span><span class="symbol">,</span><span class="normal"> </span><span class="keyword">typename</span><span class="normal"> </span><span class="classname">IF</span><span class="symbol">&lt;</span><span class="normal">candidate1</span><span class="symbol">::</span><span class="normal">fits</span><span class="symbol">,</span><span class="normal"> candidate1</span><span class="symbol">,</span><span class="normal"> candidate2</span><span class="symbol">&gt;::</span><span class="normal">result</span><span class="symbol">&gt;::</span><span class="usertype">result</span><span class="normal"> result</span><span class="symbol">;</span>
<span class="normal">    </span><span class="cbracket">}</span><span class="symbol">;</span>

<span class="normal">    </span><span class="comment">// specialization for the case when no valid parameters are found</span>
<span class="normal">    </span><span class="keyword">template</span><span class="normal"> </span><span class="symbol">&lt;</span><span class="usertype">unsigned_type</span><span class="normal"> E_</span><span class="symbol">,</span><span class="normal"> </span><span class="usertype">unsigned_type</span><span class="normal"> IntM_</span><span class="symbol">,</span><span class="normal"> </span><span class="usertype">unsigned_type</span><span class="normal"> MaxS_</span><span class="symbol">,</span><span class="normal"> </span><span class="type">bool</span><span class="normal"> stop</span><span class="symbol">&gt;</span>
<span class="normal">    </span><span class="keyword">struct</span><span class="normal"> </span><span class="classname">find_B_m</span><span class="symbol">&lt;</span><span class="normal">E_</span><span class="symbol">,</span><span class="normal"> IntM_</span><span class="symbol">,</span><span class="normal"> MaxS_</span><span class="symbol">,</span><span class="normal"> </span><span class="number">2048</span><span class="symbol">,</span><span class="normal"> </span><span class="number">1</span><span class="symbol">,</span><span class="normal"> stop</span><span class="symbol">&gt;</span>
<span class="normal">    </span><span class="cbracket">{</span>
<span class="normal">        </span><span class="keyword">enum</span><span class="normal"> </span><span class="cbracket">{</span><span class="normal"> fits </span><span class="symbol">=</span><span class="normal"> </span><span class="keyword">false</span><span class="normal"> </span><span class="cbracket">}</span><span class="symbol">;</span>
<span class="normal">        </span><span class="keyword">typedef</span><span class="normal"> </span><span class="usertype">Parameters_for_priority_queue_not_found_Increase_IntM</span><span class="normal"> result</span><span class="symbol">;</span>
<span class="normal">    </span><span class="cbracket">}</span><span class="symbol">;</span>

<span class="normal">    </span><span class="comment">// to speedup search</span>
<span class="normal">    </span><span class="keyword">template</span><span class="normal"> </span><span class="symbol">&lt;</span><span class="usertype">unsigned_type</span><span class="normal"> E_</span><span class="symbol">,</span><span class="normal"> </span><span class="usertype">unsigned_type</span><span class="normal"> IntM_</span><span class="symbol">,</span><span class="normal"> </span><span class="usertype">unsigned_type</span><span class="normal"> MaxS_</span><span class="symbol">,</span><span class="normal"> </span><span class="usertype">unsigned_type</span><span class="normal"> B_</span><span class="symbol">,</span><span class="normal"> </span><span class="usertype">unsigned_type</span><span class="normal"> m_</span><span class="symbol">&gt;</span>
<span class="normal">    </span><span class="keyword">struct</span><span class="normal"> </span><span class="classname">find_B_m</span><span class="symbol">&lt;</span><span class="normal">E_</span><span class="symbol">,</span><span class="normal"> IntM_</span><span class="symbol">,</span><span class="normal"> MaxS_</span><span class="symbol">,</span><span class="normal"> B_</span><span class="symbol">,</span><span class="normal"> m_</span><span class="symbol">,</span><span class="normal"> </span><span class="keyword">true</span><span class="symbol">&gt;</span>
<span class="normal">    </span><span class="cbracket">{</span>
<span class="normal">        </span><span class="keyword">enum</span><span class="normal"> </span><span class="cbracket">{</span><span class="normal"> fits </span><span class="symbol">=</span><span class="normal"> </span><span class="keyword">false</span><span class="normal"> </span><span class="cbracket">}</span><span class="symbol">;</span>
<span class="normal">        </span><span class="keyword">typedef</span><span class="normal"> </span><span class="usertype">dummy</span><span class="normal"> result</span><span class="symbol">;</span>
<span class="normal">    </span><span class="cbracket">}</span><span class="symbol">;</span>

<span class="normal">    </span><span class="comment">// E_ size of element in bytes</span>
<span class="normal">    </span><span class="keyword">template</span><span class="normal"> </span><span class="symbol">&lt;</span><span class="usertype">unsigned_type</span><span class="normal"> E_</span><span class="symbol">,</span><span class="normal"> </span><span class="usertype">unsigned_type</span><span class="normal"> IntM_</span><span class="symbol">,</span><span class="normal"> </span><span class="usertype">unsigned_type</span><span class="normal"> MaxS_</span><span class="symbol">&gt;</span>
<span class="normal">    </span><span class="keyword">struct</span><span class="normal"> </span><span class="classname">find_settings</span>
<span class="normal">    </span><span class="cbracket">{</span>
<span class="normal">        </span><span class="comment">// start from block size (8*1024*1024) bytes</span>
<span class="normal">        </span><span class="keyword">typedef</span><span class="normal"> </span><span class="keyword">typename</span><span class="normal"> </span><span class="classname">find_B_m</span><span class="symbol">&lt;</span><span class="normal">E_</span><span class="symbol">,</span><span class="normal"> IntM_</span><span class="symbol">,</span><span class="normal"> MaxS_</span><span class="symbol">,</span><span class="normal"> </span><span class="symbol">(</span><span class="number">8</span><span class="normal"> </span><span class="symbol">*</span><span class="normal"> </span><span class="number">1024</span><span class="normal"> </span><span class="symbol">*</span><span class="normal"> </span><span class="number">1024</span><span class="symbol">),</span><span class="normal"> </span><span class="number">1</span><span class="symbol">&gt;::</span><span class="usertype">result</span><span class="normal"> result</span><span class="symbol">;</span>
<span class="normal">    </span><span class="cbracket">}</span><span class="symbol">;</span>

<span class="normal">    </span><span class="keyword">struct</span><span class="normal"> </span><span class="classname">Parameters_not_found_Try_to_change_the_Tune_parameter</span>
<span class="normal">    </span><span class="cbracket">{</span>
<span class="normal">        </span><span class="keyword">typedef</span><span class="normal"> </span><span class="usertype">Parameters_not_found_Try_to_change_the_Tune_parameter</span><span class="normal"> result</span><span class="symbol">;</span>
<span class="normal">    </span><span class="cbracket">}</span><span class="symbol">;</span>


<span class="normal">    </span><span class="keyword">template</span><span class="normal"> </span><span class="symbol">&lt;</span><span class="usertype">unsigned_type</span><span class="normal"> AI_</span><span class="symbol">,</span><span class="normal"> </span><span class="usertype">unsigned_type</span><span class="normal"> X_</span><span class="symbol">,</span><span class="normal"> </span><span class="usertype">unsigned_type</span><span class="normal"> CriticalSize_</span><span class="symbol">&gt;</span>
<span class="normal">    </span><span class="keyword">struct</span><span class="normal"> </span><span class="classname">compute_N</span>
<span class="normal">    </span><span class="cbracket">{</span>
<span class="normal">        </span><span class="keyword">typedef</span><span class="normal"> </span><span class="usertype">compute_N&lt;AI_, X_, CriticalSize_&gt;</span><span class="normal"> Self</span><span class="symbol">;</span>
<span class="normal">        </span><span class="keyword">enum</span>
<span class="normal">        </span><span class="cbracket">{</span>
<span class="normal">            X </span><span class="symbol">=</span><span class="normal"> X_</span><span class="symbol">,</span>
<span class="normal">            AI </span><span class="symbol">=</span><span class="normal"> AI_</span><span class="symbol">,</span>
<span class="normal">            N </span><span class="symbol">=</span><span class="normal"> X </span><span class="symbol">/</span><span class="normal"> </span><span class="symbol">(</span><span class="normal">AI </span><span class="symbol">*</span><span class="normal"> AI</span><span class="symbol">)</span><span class="normal"> </span><span class="comment">// two stage internal</span>
<span class="normal">        </span><span class="cbracket">}</span><span class="symbol">;</span>
<span class="normal">        </span><span class="keyword">typedef</span><span class="normal"> </span><span class="keyword">typename</span><span class="normal"> </span><span class="classname">IF</span><span class="symbol">&lt;(</span><span class="normal">N </span><span class="symbol">&gt;=</span><span class="normal"> CriticalSize_</span><span class="symbol">),</span><span class="normal"> Self</span><span class="symbol">,</span><span class="normal"> </span><span class="keyword">typename</span><span class="normal"> </span><span class="classname">compute_N</span><span class="symbol">&lt;</span><span class="normal">AI </span><span class="symbol">/</span><span class="normal"> </span><span class="number">2</span><span class="symbol">,</span><span class="normal"> X</span><span class="symbol">,</span><span class="normal"> CriticalSize_</span><span class="symbol">&gt;::</span><span class="normal">result</span><span class="symbol">&gt;::</span><span class="usertype">result</span><span class="normal"> result</span><span class="symbol">;</span>
<span class="normal">    </span><span class="cbracket">}</span><span class="symbol">;</span>

<span class="normal">    </span><span class="keyword">template</span><span class="normal"> </span><span class="symbol">&lt;</span><span class="usertype">unsigned_type</span><span class="normal"> X_</span><span class="symbol">,</span><span class="normal"> </span><span class="usertype">unsigned_type</span><span class="normal"> CriticalSize_</span><span class="symbol">&gt;</span>
<span class="normal">    </span><span class="keyword">struct</span><span class="normal"> </span><span class="classname">compute_N</span><span class="symbol">&lt;</span><span class="number">1</span><span class="symbol">,</span><span class="normal"> X_</span><span class="symbol">,</span><span class="normal"> CriticalSize_</span><span class="symbol">&gt;</span>
<span class="normal">    </span><span class="cbracket">{</span>
<span class="normal">        </span><span class="keyword">typedef</span><span class="normal"> </span><span class="usertype">Parameters_not_found_Try_to_change_the_Tune_parameter</span><span class="normal"> result</span><span class="symbol">;</span>
<span class="normal">    </span><span class="cbracket">}</span><span class="symbol">;</span>
<span class="cbracket">}</span>

<span class="comment">//! \}</span>

<span class="comment">//! \addtogroup stlcont</span>
<span class="comment">//! \{</span>

<span class="comment">//! \brief Priority queue type generator</span>

<span class="comment">//! Implements a data structure from "Peter Sanders. Fast Priority Queues</span>
<span class="comment">//! for Cached Memory. ALENEX'99" for external memory.</span>
<span class="comment">//! &lt;BR&gt;</span>
<span class="comment">//! \tparam type of the contained objects (POD with no references to internal memory)</span>
<span class="comment">//! \tparam the comparison type used to determine</span>
<span class="comment">//! whether one element is smaller than another element.</span>
<span class="comment">//! If Cmp_(x,y) is true, then x is smaller than y. The element</span>
<span class="comment">//! returned by Q.top() is the largest element in the priority</span>
<span class="comment">//! queue. That is, it has the property that, for every other</span>
<span class="comment">//! element \b x in the priority queue, Cmp_(Q.top(), x) is false.</span>
<span class="comment">//! Cmp_ must also provide min_value method, that returns value of type Tp_ that is</span>
<span class="comment">//! smaller than any element of the queue \b x , i.e. Cmp_(Cmp_.min_value(),x) is</span>
<span class="comment">//! always \b true . &lt;BR&gt;</span>
<span class="comment">//! &lt;BR&gt;</span>
<span class="comment">//! Example: comparison object for priority queue</span>
<span class="comment">//! where \b top() returns the \b smallest contained integer:</span>
<span class="comment">//! \verbatim</span>
<span class="comment">//! struct CmpIntGreater</span>
<span class="comment">//! {</span>
<span class="comment">//!   bool operator () (const int &amp; a, const int &amp; b) const { return a&gt;b; }</span>
<span class="comment">//!   int min_value() const  { return std::numeric_limits&lt;int&gt;::max(); }</span>
<span class="comment">//! };</span>
<span class="comment">//! \endverbatim</span>
<span class="comment">//! Example: comparison object for priority queue</span>
<span class="comment">//! where \b top() returns the \b largest contained integer:</span>
<span class="comment">//! \verbatim</span>
<span class="comment">//! struct CmpIntLess</span>
<span class="comment">//! {</span>
<span class="comment">//!   bool operator () (const int &amp; a, const int &amp; b) const { return a&lt;b; }</span>
<span class="comment">//!   int min_value() const  { return std::numeric_limits&lt;int&gt;::min(); }</span>
<span class="comment">//! };</span>
<span class="comment">//! \endverbatim</span>
<span class="comment">//! Note that Cmp_ must define strict weak ordering.</span>
<span class="comment">//! (&lt;A HREF="http://www.sgi.com/tech/stl/StrictWeakOrdering.html"&gt;see what it is&lt;/A&gt;)</span>
<span class="comment">//! - \c IntM_ upper limit for internal memory consumption in bytes.</span>
<span class="comment">//! - \c MaxS_ upper limit for number of elements contained in the priority queue (in 1024 units).</span>
<span class="comment">//! Example: if you are sure that priority queue contains no more than</span>
<span class="comment">//! one million elements in a time, then the right parameter is (1000000/1024)= 976 .</span>
<span class="comment">//! - \c Tune_ tuning parameter. Try to play with it if the code does not compile</span>
<span class="comment">//! (larger than default values might help). Code does not compile</span>
<span class="comment">//! if no suitable internal parameters were found for given IntM_ and MaxS_.</span>
<span class="comment">//! It might also happen that given IntM_ is too small for given MaxS_, try larger values.</span>
<span class="comment">//! &lt;BR&gt;</span>
<span class="comment">//! \c PRIORITY_QUEUE_GENERATOR is template meta program that searches</span>
<span class="comment">//! for \b 7 configuration parameters of \b stxxl::priority_queue that both</span>
<span class="comment">//! minimize internal memory consumption of the priority queue to</span>
<span class="comment">//! match IntM_ and maximize performance of priority queue operations.</span>
<span class="comment">//! Actual memory consumption might be larger (use</span>
<span class="comment">//! \c stxxl::priority_queue::mem_cons() method to track it), since the search</span>
<span class="comment">//! assumes rather optimistic schedule of push'es and pop'es for the</span>
<span class="comment">//! estimation of the maximum memory consumption. To keep actual memory</span>
<span class="comment">//! requirements low increase the value of MaxS_ parameter.</span>
<span class="comment">//! &lt;BR&gt;</span>
<span class="comment">//! For functioning a priority queue object requires two pools of blocks</span>
<span class="comment">//! (See constructor of \c priority_queue ). To construct \c \&lt;stxxl\&gt; block</span>
<span class="comment">//! pools you might need \b block \b type that will be used by priority queue.</span>
<span class="comment">//! Note that block's size and hence it's type is generated by</span>
<span class="comment">//! the \c PRIORITY_QUEUE_GENERATOR in compile type from IntM_, MaxS_ and sizeof(Tp_) and</span>
<span class="comment">//! not given directly by user as a template parameter. Block type can be extracted as</span>
<span class="comment">//! \c PRIORITY_QUEUE_GENERATOR&lt;some_parameters&gt;::result::block_type .</span>
<span class="comment">//! For an example see p_queue.cpp .</span>
<span class="comment">//! Configured priority queue type is available as \c PRIORITY_QUEUE_GENERATOR&lt;&gt;::result. &lt;BR&gt; &lt;BR&gt;</span>
<span class="keyword">template</span><span class="normal"> </span><span class="symbol">&lt;</span><span class="keyword">class</span><span class="normal"> </span><span class="classname">Tp_</span><span class="symbol">,</span><span class="normal"> </span><span class="keyword">class</span><span class="normal"> </span><span class="classname">Cmp_</span><span class="symbol">,</span><span class="normal"> </span><span class="usertype">unsigned_type</span><span class="normal"> IntM_</span><span class="symbol">,</span><span class="normal"> </span><span class="type">unsigned</span><span class="normal"> MaxS_</span><span class="symbol">,</span><span class="normal"> </span><span class="type">unsigned</span><span class="normal"> Tune_ </span><span class="symbol">=</span><span class="normal"> </span><span class="number">6</span><span class="symbol">&gt;</span>
<span class="keyword">class</span><span class="normal"> </span><span class="classname">PRIORITY_QUEUE_GENERATOR</span>
<span class="cbracket">{</span>
<span class="keyword">public</span><span class="symbol">:</span>
<span class="normal">    </span><span class="comment">// actual calculation of B, m, k and element_size</span>
<span class="normal">    </span><span class="keyword">typedef</span><span class="normal"> </span><span class="keyword">typename</span><span class="normal"> </span><span class="classname">priority_queue_local</span><span class="symbol">::</span><span class="normal">find_settings</span><span class="symbol">&lt;</span><span class="keyword">sizeof</span><span class="symbol">(</span><span class="normal">Tp_</span><span class="symbol">),</span><span class="normal"> IntM_</span><span class="symbol">,</span><span class="normal"> MaxS_</span><span class="symbol">&gt;::</span><span class="usertype">result</span><span class="normal"> settings</span><span class="symbol">;</span>
<span class="normal">    </span><span class="keyword">enum</span><span class="normal"> </span><span class="cbracket">{</span>
<span class="normal">        B </span><span class="symbol">=</span><span class="normal"> settings</span><span class="symbol">::</span><span class="normal">B</span><span class="symbol">,</span>
<span class="normal">        m </span><span class="symbol">=</span><span class="normal"> settings</span><span class="symbol">::</span><span class="normal">m</span><span class="symbol">,</span>
<span class="normal">        X </span><span class="symbol">=</span><span class="normal"> B </span><span class="symbol">*</span><span class="normal"> </span><span class="symbol">(</span><span class="normal">settings</span><span class="symbol">::</span><span class="normal">k </span><span class="symbol">-</span><span class="normal"> m</span><span class="symbol">)</span><span class="normal"> </span><span class="symbol">/</span><span class="normal"> settings</span><span class="symbol">::</span><span class="normal">element_size</span><span class="symbol">,</span><span class="normal">  </span><span class="comment">// interpretation of result</span>
<span class="normal">        Buffer1Size </span><span class="symbol">=</span><span class="normal"> </span><span class="number">32</span><span class="normal">                                     </span><span class="comment">// fixed</span>
<span class="normal">    </span><span class="cbracket">}</span><span class="symbol">;</span>
<span class="normal">    </span><span class="comment">// derivation of N, AI, AE</span>
<span class="normal">    </span><span class="keyword">typedef</span><span class="normal"> </span><span class="keyword">typename</span><span class="normal"> </span><span class="classname">priority_queue_local</span><span class="symbol">::</span><span class="normal">compute_N</span><span class="symbol">&lt;(</span><span class="number">1</span><span class="normal"> </span><span class="symbol">&lt;&lt;</span><span class="normal"> Tune_</span><span class="symbol">),</span><span class="normal"> X</span><span class="symbol">,</span><span class="normal"> </span><span class="number">4</span><span class="normal"> </span><span class="symbol">*</span><span class="normal"> Buffer1Size</span><span class="symbol">&gt;::</span><span class="usertype">result</span><span class="normal"> ComputeN</span><span class="symbol">;</span>
<span class="normal">    </span><span class="keyword">enum</span>
<span class="normal">    </span><span class="cbracket">{</span>
<span class="normal">        N </span><span class="symbol">=</span><span class="normal"> ComputeN</span><span class="symbol">::</span><span class="normal">N</span><span class="symbol">,</span>
<span class="normal">        AI </span><span class="symbol">=</span><span class="normal"> ComputeN</span><span class="symbol">::</span><span class="normal">AI</span><span class="symbol">,</span>
<span class="normal">        AE </span><span class="symbol">=</span><span class="normal"> </span><span class="symbol">(</span><span class="normal">m </span><span class="symbol">/</span><span class="normal"> </span><span class="number">2</span><span class="normal"> </span><span class="symbol">&lt;</span><span class="normal"> </span><span class="number">2</span><span class="symbol">)</span><span class="normal"> </span><span class="symbol">?</span><span class="normal"> </span><span class="number">2</span><span class="normal"> </span><span class="symbol">:</span><span class="normal"> </span><span class="symbol">(</span><span class="normal">m </span><span class="symbol">/</span><span class="normal"> </span><span class="number">2</span><span class="symbol">)</span><span class="normal">            </span><span class="comment">// at least 2</span>
<span class="normal">    </span><span class="cbracket">}</span><span class="symbol">;</span>
<span class="normal">    </span><span class="keyword">enum</span><span class="normal"> </span><span class="cbracket">{</span>
<span class="normal">        </span><span class="comment">// Estimation of maximum internal memory consumption (in bytes)</span>
<span class="normal">        EConsumption </span><span class="symbol">=</span><span class="normal"> X </span><span class="symbol">*</span><span class="normal"> settings</span><span class="symbol">::</span><span class="normal">element_size </span><span class="symbol">+</span><span class="normal"> settings</span><span class="symbol">::</span><span class="normal">B </span><span class="symbol">*</span><span class="normal"> AE </span><span class="symbol">+</span><span class="normal"> </span><span class="symbol">((</span><span class="normal">MaxS_ </span><span class="symbol">/</span><span class="normal"> X</span><span class="symbol">)</span><span class="normal"> </span><span class="symbol">/</span><span class="normal"> AE</span><span class="symbol">)</span><span class="normal"> </span><span class="symbol">*</span><span class="normal"> settings</span><span class="symbol">::</span><span class="normal">B </span><span class="symbol">*</span><span class="normal"> </span><span class="number">1024</span>
<span class="normal">    </span><span class="cbracket">}</span><span class="symbol">;</span>
<span class="normal">    </span><span class="comment">/*</span>
<span class="comment">        unsigned BufferSize1_ = 32, // equalize procedure call overheads etc.</span>
<span class="comment">        unsigned N_ = 512,          // bandwidth</span>
<span class="comment">        unsigned IntKMAX_ = 64,     // maximal arity for internal mergers</span>
<span class="comment">        unsigned IntLevels_ = 4,</span>
<span class="comment">        unsigned BlockSize_ = (2*1024*1024),</span>
<span class="comment">        unsigned ExtKMAX_ = 64,     // maximal arity for external mergers</span>
<span class="comment">        unsigned ExtLevels_ = 2,</span>
<span class="comment">     */</span>
<span class="normal">    </span><span class="keyword">typedef</span><span class="normal"> </span><span class="usertype">priority_queue&lt;priority_queue_config&lt;Tp_, Cmp_, Buffer1Size, N, AI, 2, B, AE, 2&gt; &gt;</span><span class="normal"> result</span><span class="symbol">;</span>
<span class="cbracket">}</span><span class="symbol">;</span>

<span class="comment">//! \}</span>

<span class="normal">__STXXL_END_NAMESPACE</span>


<span class="keyword">namespace</span><span class="normal"> std</span>
<span class="cbracket">{</span>
<span class="normal">    </span><span class="keyword">template</span><span class="normal"> </span><span class="symbol">&lt;</span><span class="keyword">class</span><span class="normal"> </span><span class="classname">Config_</span><span class="symbol">&gt;</span>
<span class="normal">    </span><span class="type">void</span><span class="normal"> </span><span class="function">swap</span><span class="symbol">(</span><span class="normal">stxxl</span><span class="symbol">::</span><span class="normal">priority_queue</span><span class="symbol">&lt;</span><span class="normal">Config_</span><span class="symbol">&gt;</span><span class="normal"> </span><span class="symbol">&amp;</span><span class="normal"> a</span><span class="symbol">,</span>
<span class="normal">              stxxl</span><span class="symbol">::</span><span class="normal">priority_queue</span><span class="symbol">&lt;</span><span class="normal">Config_</span><span class="symbol">&gt;</span><span class="normal"> </span><span class="symbol">&amp;</span><span class="normal"> b</span><span class="symbol">)</span>
<span class="normal">    </span><span class="cbracket">{</span>
<span class="normal">        a</span><span class="symbol">.</span><span class="function">swap</span><span class="symbol">(</span><span class="normal">b</span><span class="symbol">);</span>
<span class="normal">    </span><span class="cbracket">}</span>
<span class="cbracket">}</span>

<span class="preproc">#endif</span><span class="normal"> </span><span class="comment">// !STXXL_PRIORITY_QUEUE_HEADER</span>
<span class="comment">// vim: et:ts=4:sw=4</span>
</tt></pre></div><div style="text-align: right; padding: 8pt; font-size: 13px"><a href="/xmlfeed/weblog-rss20.xml"><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAFAAAAAPAgMAAAAOp6AcAAAADFBMVEVmZmb/ZgD///+JjnlbTUWmAAAACXBIWXMAAABIAAAASABGyWs+AAAACXZwQWcAAABQAAAADwCexKkxAAAAWUlEQVQYlWNgwAa0VmGAFQyqoSCQ/x8J/CBFMCt0ZdTU/F/7/+1HEkydFpoKVPn+93sUlUujQvP/7UcRTAuNDJ2a//s/imDqtKVZofm/1qGYSZk7sfodGwAAiobBJtffoNAAAAAASUVORK5CYII=" alt="RSS 2.0 Weblog Feed" width="80" height="15"/></a> <a href="/xmlfeed/weblog-atom10.xml"><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAFAAAAAPAgMAAAAOp6AcAAAADFBMVEVmZmb/ZgD///+JjnlbTUWmAAAAaklEQVQYlWNgwAa0VmGAFQyqoSCQ/x8J/CBFMDV16rTQ/H/7V//69+//v/3/9oMEI6cuAwr+fv/+/b5d///v//0eJBgWOhMo+Gs9UPAdXDBy6lSYyn9wQZCZS0GCYDPXQcykzJ1Y/Y4NAABKvL80wyoMPgAAAABJRU5ErkJggg==" alt="Atom 1.0 Weblog Feed" width="80" height="15"/></a> <a href="http://validator.w3.org/check?uri=referer"><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAFAAAAAPCAMAAABEF7i9AAAB1FBMVEUHQIgIRY0MN4QNRYoSRYsXUpIYVJQeUpUhWpgjUJMjWpgmU5QnXJkuYZ0uYpwwV5YyZJ4zaKM3ZaA5aaI6aqM6a6E8ZqA8Z6BAbaRBbqdCbaVHd61KSkpKcaZQUFBUf69UgbBVVVVXfq9Yg7NZhbJZh7RagrNeXVxeh7RfjLdgYGBiiLZmZmZnZ2doirhpkbt0m8F3m8B3ncJ5lb55ocR+ocSDgX+Do8eEpMqGhoaHp8iIpMeJjnmJpseKqMeOqsqPsdCQrcyVlZWVsM2Zs9CZtNCfu9ahoaGhuNShudSivNSjtMWjvNSmpqWnpqSrw9qvxNqyxdmyxdyzsK6zs7Ozx9y0xt21yN22tra4y+K80eK/v7/AwMDExMTEy9DH2ejK2+jM2ujN3uvP0dLR0NDR3uvS3uvS3+zU4u3V1dXY2dnY4u7Y4+3b5e/d3d3d5u/d5/De3t7f39/h4uLj4uHj6/Ll7PXm7fTn7/Xo7/Tp7/bq7Ozr6unr8ffw8PDw9vvx9fny+P7z8/Pz9vnz9vv3+fv4+vz5+vz6+vr6+/36/P36///7+/77/Pz7/f37/f78/Pz8/f38/f79/f39/f79/f/9/v79///+/v7+/v////3///+tYR2LAAABKklEQVQ4y2PQoTJg0JlNVYDPQBsyAMTAqaFes8tdsmdPCtA3MDStr3GKKK6myMAprgJ9pcpWs/MlRExYJBvNZLR0sigycHYOV1S7mtjsQJ4gf+HIFPXoWMs6qIGzIRiKZs9GFoEaMRuZhhrYqqJXy8uZYauRxC/VHew7e3YTPAxnI5swG6JxNrKBNjB1EFmIgV0+HA6C8pqqzhXG7BbJJROQIwViMYQ7G2oDQQNn57JyG7kxiCfObrBmS5+BHMuYLkTzMnYDm5WY4lOZZRPKZocxes+aPbuwCFsYohiICLvZsKBAMrDTQ7K/StveU8icTzrOL8JdLpOyWJ49u8Bx9ozw8DY7UYW03hhdxZAOSg2c3jN79rSJs1vSKmfOnpFXNJmynELlvExlAADnaZpLFGEC2wAAAABJRU5ErkJggg==" alt="Valid XHTML 1.1" width="80" height="15"/></a> <a href="http://jigsaw.w3.org/css-validator/check/referer"><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAFAAAAAPCAMAAABEF7i9AAAB1FBMVEUHQIgIRY0MN4QNRYoSRYsXUpIYVJQeUpUhWpgjUJMjWpgmU5QnXJkuYZ0uYpwwV5YyZJ4zaKM3ZaA5aaI6aqM6a6E8ZqA8Z6BAbaRBbqdCbaVHd61KSkpKcaZQUFBUf69UgbBVVVVXfq9Yg7NZhbJZh7RagrNeXVxeh7RfjLdgYGBiiLZmZmZnZ2doirhpkbt0m8F3m8B3ncJ5lb55ocR+ocSDgX+Do8eEpMqGhoaHp8iIpMeJjnmJpseKqMeOqsqPsdCQrcyVlZWVsM2Zs9CZtNCfu9ahoaGhuNShudSivNSjtMWjvNSmpqWnpqSrw9qvxNqyxdmyxdyzsK6zs7Ozx9y0xt21yN22tra4y+K80eK/v7/AwMDExMTEy9DH2ejK2+jM2ujN3uvP0dLR0NDR3uvS3uvS3+zU4u3V1dXY2dnY4u7Y4+3b5e/d3d3d5u/d5/De3t7f39/h4uLj4uHj6/Ll7PXm7fTn7/Xo7/Tp7/bq7Ozr6unr8ffw8PDw9vvx9fny+P7z8/Pz9vnz9vv3+fv4+vz5+vz6+vr6+/36/P36///7+/77/Pz7/f37/f78/Pz8/f38/f79/f39/f79/f/9/v79///+/v7+/v////3///+tYR2LAAABEUlEQVQ4y2PQoTJg0JlNVYDPQBsyAMTAqaFes8tdsmdPCtA3MDStr3GKKK6myMAprgJ9pcpWs/MlRExYJBvNZLR0sigycHYOV1S7mtjsQJ4gf+HIFPXoWMs6mIEQCsIjwhKoga0qerW8nBm2Gkn8Ut3BvrNnN8HCcDYM2cBIogzs8uFwEJTXVHWuMGa3SC6ZgIgUqCEwdxJr4OxcVm4jNwbxxNkN1mzpM2ajGIjsPGK9PLtZiSk+lVk2oWx2GKP3rNmzC4tQwpDoIIQb2Okh2V+lbe8pZM4nHecX4S6XSVksz55d4Dh7Rnh4m52oQlpvjK5iSAelBk7vmT172sTZLWmVM2fPyCuaTFlOoXJepjIAANlljDGY/l5pAAAAAElFTkSuQmCC" alt="Valid CSS (2.1)" width="80" height="15"/></a><br/>Copyright 2005-2019 <a href="/about/">Timo Bingmann</a> - <a href="/about/impressum.html">Impressum</a></div></body></html>