<?xml version="1.0" encoding="iso-8859-1"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta content="text/html; charset=iso-8859-1" http-equiv="content-type" /><meta name="viewport" content="initial-scale=1"><title>/2009/cryptote/cryptote-0.5.390/libstc/PlatWX.cpp - panthema.net</title><link rel="stylesheet" type="text/css" href="/css/base.css" /><link rel="stylesheet" type="text/css" href="/css/fonts.css" /><link rel="alternate" type="application/rss+xml" title="panthema.net Weblog Feed RSS 2.0" href="http://panthema.net/xmlfeed/weblog-rss20.xml" /><link rel="alternate" type="application/atom+xml" title="panthema.net Weblog Feed Atom 1.0" href="http://panthema.net/xmlfeed/weblog-atom10.xml" /><script type="text/javascript" src="/js/base.js"></script><script type="text/javascript">/* <!-- */makeIEHover = function() {var lis = document.getElementById('ptnav').getElementsByTagName('li');for (var i = 0; i < lis.length; i++) {lis[i].onmouseover = function() {this.className += ' sfhover';};lis[i].onmouseout = function() {this.className = this.className.replace(new RegExp(' sfhover\b'), '');};}};if (window.attachEvent) window.attachEvent('onload', makeIEHover);/* --> */</script></head><body style="background-image: url(/img/bgfractal2.jpg)" lang="en"><div class="pttopbar"><div style="float: right"><ul id="ptnav"><li class="top"><a class="ni" href="/"><i class="icon-book"></i> Weblog</a><ul style="margin-left: -6px; margin-top: 4px" class="nx"><li><a href="/2019/">2019</a></li><li><a href="/2018/">2018</a></li><li><a href="/2017/">2017</a></li><li><a href="/2016/">2016</a></li><li><a href="/2015/">2015</a></li><li><a href="/2014/">2014</a></li><li><a href="/2013/">2013</a></li><li><a href="/2012/">2012</a></li><li><a href="/2011/">2011</a></li><li><a href="/2010/">2010</a></li><li><a href="/2009/">2009</a></li><li><a href="/2008/">2008</a></li><li><a href="/2007/">2007</a></li><li><a href="/2006/">2006</a></li><li class="nt"><a href="/2005/">2005</a></li><li class="ns"><a href="/xmlfeed/weblog-rss20.xml">RSS Feed</a></li><li class="nt"><a href="/xmlfeed/weblog-atom10.xml">XML Atom</a></li><li class="ns"><a href="/search.html">Search</a></li></ul></li><li class="top"><a class="ni" href="/tags/"><i class="icon-tags"></i> Tags</a><div style="width: 14em; margin-left: -9em; margin-top: 4px"><a style="font-size: 10pt" href="/tags/algebra.html">algebra</a> <a style="font-size: 10pt" href="/tags/blinken-algorithms.html">blinken-algorithms</a> <a style="font-size: 16pt" href="/tags/c++.html">c++</a> <a style="font-size: 12pt" href="/tags/code-example.html">code-example</a> <a style="font-size: 14pt" href="/tags/code-snippet.html">code-snippet</a> <a style="font-size: 11pt" href="/tags/coding_tricks.html">coding tricks</a> <a style="font-size: 10pt" href="/tags/compsci.html">compsci</a> <a style="font-size: 10pt" href="/tags/compsci_study_thesis.html">compsci study thesis</a> <a style="font-size: 9pt" href="/tags/crypto-speedtest.html">crypto-speedtest</a> <a style="font-size: 10pt" href="/tags/cryptography.html">cryptography</a> <a style="font-size: 9pt" href="/tags/cryptote.html">cryptote</a> <a style="font-size: 11pt" href="/tags/dissertation.html">dissertation</a> <a style="font-size: 10pt" href="/tags/electronics.html">electronics</a> <a style="font-size: 12pt" href="/tags/flex-bison-cpp-example.html">flex-bison-cpp-example</a> <a style="font-size: 16pt" href="/tags/frontpage.html">frontpage</a> <a style="font-size: 15pt" href="/tags/fun.html">fun</a> <a style="font-size: 10pt" href="/tags/graphviz.html">graphviz</a> <a style="font-size: 9pt" href="http://www.hmtg.de">hartmetall</a> <a style="font-size: 9pt" href="/tags/helppc.html">helppc</a> <a style="font-size: 9pt" href="/tags/hifi_selbstbau.html">hifi selbstbau</a> <a style="font-size: 10pt" href="/tags/latex.html">latex</a> <a style="font-size: 10pt" href="/tags/LEDs.html">LEDs</a> <a style="font-size: 10pt" href="/tags/librivox.html">librivox</a> <a style="font-size: 10pt" href="/tags/linux.html">linux</a> <a style="font-size: 9pt" href="/tags/market.html">market</a> <a style="font-size: 9pt" href="/tags/massive-sorting.html">massive-sorting</a> <a style="font-size: 11pt" href="/tags/maths.html">maths</a> <a style="font-size: 9pt" href="/tags/music.html">music</a> <a style="font-size: 10pt" href="/tags/netfundamentals.html">netfundamentals</a> <a style="font-size: 11pt" href="/tags/ns-3.html">ns-3</a> <a style="font-size: 10pt" href="/tags/parallel-string-sorting.html">parallel-string-sorting</a> <a style="font-size: 14pt" href="/tags/parsing.html">parsing</a> <a style="font-size: 9pt" href="/tags/qtsqlview.html">qtsqlview</a> <a style="font-size: 14pt" href="/tags/research.html">research</a> <a style="font-size: 11pt" href="/tags/sdios06.html">sdios06</a> <a style="font-size: 9pt" href="/tags/sdlfractal.html">sdlfractal</a> <a style="font-size: 16pt" href="/tags/sorting.html">sorting</a> <a style="font-size: 13pt" href="/tags/sound_of_sorting.html">sound of sorting</a> <a style="font-size: 10pt" href="/tags/stringology.html">stringology</a> <a style="font-size: 16pt" href="/tags/stx-btree.html">stx-btree</a> <a style="font-size: 16pt" href="/tags/stxxl.html">stxxl</a> <a style="font-size: 16pt" href="/tags/talk.html">talk</a> <a style="font-size: 15pt" href="/tags/thrill.html">thrill</a> <a style="font-size: 10pt" href="/tags/tutorium.html">tutorium</a> <a style="font-size: 16pt" href="/tags/university.html">university</a> <a style="font-size: 14pt" href="/tags/utilities.html">utilities</a> <a style="font-size: 10pt" href="/tags/vncrec.html">vncrec</a> <a style="font-size: 9pt" href="/tags/webdesign.html">webdesign</a> </div></li><li class="top"> <a class="ni" href="#"><i class="icon-cubes"></i> Projects</a> <ul style="margin-left: -8em; margin-top: 4px;" class="nx"> <li><a href="/2019/1008-COBS-A-Compact-Bit-Sliced-Signature-Index/">COBS</a></li> <li><a href="/2009/cryptote/">CryptoTE</a></li> <li><a href="/2009/digup/">digup</a></li> <li><a href="/2013/disk-filltest/">disk-filltest</a></li> <li><a href="/2012/1119-eSAIS-Inducing-Suffix-and-LCP-Arrays-in-External-Memory/">eSAIS-LCP</a></li> <li><a href="/2007/flex-bison-cpp-example/">Flex Bison C++ Example</a></li> <li><a href="/2013/malloc_count/">malloc_count</a></li> <li><a href="/2016/0114-diploma-thesis/">On Bispanning Graphs</a></li> <li><a href="/2013/pmbw/">Parallel Memory Bandwidth</a></li> <li><a href="/2013/parallel-string-sorting/">Parallel String Sorting</a></li> <li><a href="/2014/sqlplot-tools/">SqlPlotTools</a></li> <li><a href="/2013/sound-of-sorting/">The Sound of Sorting</a></li> <li><a href="/2007/stx-btree/">STX B+ Tree</a></li> <li><a href="/2010/stx-cbtreedb/">STX Constant BTreeDB</a></li> <li><a href="/2010/stx-execpipe/">STX ExecPipe</a></li> <li><a href="/2007/stx-exparser/">STX Expression Parser</a></li> <li><a href="/tags/stxxl.html">STXXL 1.4</a></li> <li><a href="/tags/thrill.html">Thrill - Big Data Framework</a></li> <li class="nt"><a href="/2014/vncrec-rgb/">VNCrec RGB 0.4</a></li> <li class="ns"><a href="/search.html">Search</a></li> </ul></li><li class="top"> <a class="ni" href="/publications.html"><i class="icon-graduation-cap"></i> Publications</a></li><li class="top"> <a class="ni" href="/about/"><i class="icon-info-circled"></i> About</a> <ul style="margin-left: -6em; margin-top: 4px" class="nx"> <li><a href="/about/">Timo Bingmann</a></li> <li><a href="/about/impressum.html">Impressum</a></li> </ul></li><li class="top"> <a class="ni" href="/subscribe.html"><i class="icon-rss-squared"></i> Subscribe</a></li></ul></div><div style="padding: 6px"><a href="/">panthema</a>  / <a href="/2009/">2009</a> / <a href="/2009/cryptote/">cryptote</a> / <a href="/2009/cryptote/cryptote-0.5.390/">cryptote-0.5.390</a> / <a href="/2009/cryptote/cryptote-0.5.390/libstc/">libstc</a> / <a href="/2009/cryptote/cryptote-0.5.390/libstc/PlatWX.cpp.html">PlatWX.cpp</a> (<a href="/2009/cryptote/cryptote-0.5.390/libstc/PlatWX.cpp">Download File</a>)</div></div><div class="ptfullwidth"><pre class="codesnippet" style="font-family: monospace"><tt><span class="comment">// Scintilla source code edit control</span>
<span class="comment">// PlatWX.cxx - implementation of platform facilities on wxWidgets</span>
<span class="comment">// Copyright 1998-1999 by Neil Hodgson &lt;neilh@scintilla.org&gt;</span>
<span class="comment">//                        Robin Dunn &lt;robin@aldunn.com&gt;</span>
<span class="comment">//           2008-2009 Timo Bingmann (adaptation to newer Scintilla versions)</span>
<span class="comment">// The License.txt file describes the conditions under which this software may be distributed.</span>

<span class="preproc">#include</span><span class="normal"> </span><span class="string">&lt;ctype.h&gt;</span>

<span class="preproc">#include</span><span class="normal"> </span><span class="string">"wx/wx.h"</span>
<span class="preproc">#include</span><span class="normal"> </span><span class="string">"wx/encconv.h"</span>
<span class="preproc">#include</span><span class="normal"> </span><span class="string">"wx/listctrl.h"</span>
<span class="preproc">#include</span><span class="normal"> </span><span class="string">"wx/mstream.h"</span>
<span class="preproc">#include</span><span class="normal"> </span><span class="string">"wx/image.h"</span>
<span class="preproc">#include</span><span class="normal"> </span><span class="string">"wx/imaglist.h"</span>
<span class="preproc">#include</span><span class="normal"> </span><span class="string">"wx/tokenzr.h"</span>

<span class="preproc">#ifdef</span><span class="normal"> wxHAVE_RAW_BITMAP</span>
<span class="preproc">#include</span><span class="normal"> </span><span class="string">"wx/rawbmp.h"</span>
<span class="preproc">#endif</span>

<span class="preproc">#include</span><span class="normal"> </span><span class="string">"Platform.h"</span>
<span class="preproc">#include</span><span class="normal"> </span><span class="string">"PlatWX.h"</span>
<span class="preproc">#include</span><span class="normal"> </span><span class="string">"stc.h"</span>

<span class="preproc">#if</span><span class="normal"> wxUSE_POPUPWIN</span>
<span class="preproc">#include</span><span class="normal"> </span><span class="string">&lt;wx/popupwin.h&gt;</span>
<span class="preproc">#endif</span>

<span class="keyword">namespace</span><span class="normal"> Scintilla </span><span class="cbracket">{</span>

<span class="usertype">Point</span><span class="normal"> Point</span><span class="symbol">::</span><span class="function">FromLong</span><span class="symbol">(</span><span class="type">long</span><span class="normal"> lpoint</span><span class="symbol">)</span><span class="normal"> </span><span class="cbracket">{</span>
<span class="normal">    </span><span class="keyword">return</span><span class="normal"> </span><span class="function">Point</span><span class="symbol">(</span><span class="normal">lpoint </span><span class="symbol">&amp;</span><span class="normal"> </span><span class="number">0xFFFF</span><span class="symbol">,</span><span class="normal"> lpoint </span><span class="symbol">&gt;&gt;</span><span class="normal"> </span><span class="number">16</span><span class="symbol">);</span>
<span class="cbracket">}</span>

<span class="usertype">wxRect</span><span class="normal"> </span><span class="function">wxRectFromPRectangle</span><span class="symbol">(</span><span class="usertype">PRectangle</span><span class="normal"> prc</span><span class="symbol">)</span><span class="normal"> </span><span class="cbracket">{</span>
<span class="normal">    </span><span class="usertype">wxRect</span><span class="normal"> </span><span class="function">r</span><span class="symbol">(</span><span class="normal">prc</span><span class="symbol">.</span><span class="normal">left</span><span class="symbol">,</span><span class="normal"> prc</span><span class="symbol">.</span><span class="normal">top</span><span class="symbol">,</span>
<span class="normal">             prc</span><span class="symbol">.</span><span class="function">Width</span><span class="symbol">(),</span><span class="normal"> prc</span><span class="symbol">.</span><span class="function">Height</span><span class="symbol">());</span>
<span class="normal">    </span><span class="keyword">return</span><span class="normal"> r</span><span class="symbol">;</span>
<span class="cbracket">}</span>

<span class="usertype">PRectangle</span><span class="normal"> </span><span class="function">PRectangleFromwxRect</span><span class="symbol">(</span><span class="usertype">wxRect</span><span class="normal"> rc</span><span class="symbol">)</span><span class="normal"> </span><span class="cbracket">{</span>
<span class="normal">    </span><span class="keyword">return</span><span class="normal"> </span><span class="function">PRectangle</span><span class="symbol">(</span><span class="normal">rc</span><span class="symbol">.</span><span class="function">GetLeft</span><span class="symbol">(),</span><span class="normal"> rc</span><span class="symbol">.</span><span class="function">GetTop</span><span class="symbol">(),</span>
<span class="normal">                      rc</span><span class="symbol">.</span><span class="function">GetRight</span><span class="symbol">()+</span><span class="number">1</span><span class="symbol">,</span><span class="normal"> rc</span><span class="symbol">.</span><span class="function">GetBottom</span><span class="symbol">()+</span><span class="number">1</span><span class="symbol">);</span>
<span class="cbracket">}</span>

<span class="usertype">wxColour</span><span class="normal"> </span><span class="function">wxColourFromCA</span><span class="symbol">(</span><span class="keyword">const</span><span class="normal"> ColourAllocated</span><span class="symbol">&amp;</span><span class="normal"> ca</span><span class="symbol">)</span><span class="normal"> </span><span class="cbracket">{</span>
<span class="normal">    </span><span class="usertype">ColourDesired</span><span class="normal"> </span><span class="function">cd</span><span class="symbol">(</span><span class="normal">ca</span><span class="symbol">.</span><span class="function">AsLong</span><span class="symbol">());</span>
<span class="normal">    </span><span class="keyword">return</span><span class="normal"> </span><span class="function">wxColour</span><span class="symbol">((</span><span class="type">unsigned</span><span class="normal"> </span><span class="type">char</span><span class="symbol">)</span><span class="normal">cd</span><span class="symbol">.</span><span class="function">GetRed</span><span class="symbol">(),</span>
<span class="normal">                    </span><span class="symbol">(</span><span class="type">unsigned</span><span class="normal"> </span><span class="type">char</span><span class="symbol">)</span><span class="normal">cd</span><span class="symbol">.</span><span class="function">GetGreen</span><span class="symbol">(),</span>
<span class="normal">                    </span><span class="symbol">(</span><span class="type">unsigned</span><span class="normal"> </span><span class="type">char</span><span class="symbol">)</span><span class="normal">cd</span><span class="symbol">.</span><span class="function">GetBlue</span><span class="symbol">());</span>
<span class="cbracket">}</span>

<span class="comment">//----------------------------------------------------------------------</span>

<span class="normal">Palette</span><span class="symbol">::</span><span class="function">Palette</span><span class="symbol">()</span><span class="normal"> </span><span class="cbracket">{</span>
<span class="normal">    used </span><span class="symbol">=</span><span class="normal"> </span><span class="number">0</span><span class="symbol">;</span>
<span class="normal">    allowRealization </span><span class="symbol">=</span><span class="normal"> </span><span class="keyword">false</span><span class="symbol">;</span>
<span class="normal">    size </span><span class="symbol">=</span><span class="normal"> </span><span class="number">100</span><span class="symbol">;</span>
<span class="normal">    entries </span><span class="symbol">=</span><span class="normal"> </span><span class="keyword">new</span><span class="normal"> ColourPair</span><span class="symbol">[</span><span class="normal">size</span><span class="symbol">];</span>
<span class="cbracket">}</span>

<span class="normal">Palette</span><span class="symbol">::~</span><span class="function">Palette</span><span class="symbol">()</span><span class="normal"> </span><span class="cbracket">{</span>
<span class="normal">    </span><span class="function">Release</span><span class="symbol">();</span>
<span class="normal">    </span><span class="keyword">delete</span><span class="normal"> </span><span class="symbol">[]</span><span class="normal"> entries</span><span class="symbol">;</span>
<span class="normal">    entries </span><span class="symbol">=</span><span class="normal"> </span><span class="number">0</span><span class="symbol">;</span>
<span class="cbracket">}</span>

<span class="type">void</span><span class="normal"> Palette</span><span class="symbol">::</span><span class="function">Release</span><span class="symbol">()</span><span class="normal"> </span><span class="cbracket">{</span>
<span class="normal">    used </span><span class="symbol">=</span><span class="normal"> </span><span class="number">0</span><span class="symbol">;</span>
<span class="normal">    </span><span class="keyword">delete</span><span class="normal"> </span><span class="symbol">[]</span><span class="normal"> entries</span><span class="symbol">;</span>
<span class="normal">    size </span><span class="symbol">=</span><span class="normal"> </span><span class="number">100</span><span class="symbol">;</span>
<span class="normal">    entries </span><span class="symbol">=</span><span class="normal"> </span><span class="keyword">new</span><span class="normal"> ColourPair</span><span class="symbol">[</span><span class="normal">size</span><span class="symbol">];</span>
<span class="cbracket">}</span>

<span class="comment">// This method either adds a colour to the list of wanted colours (want==true)</span>
<span class="comment">// or retrieves the allocated colour back to the ColourPair.</span>
<span class="comment">// This is one method to make it easier to keep the code for wanting and retrieving in sync.</span>
<span class="type">void</span><span class="normal"> Palette</span><span class="symbol">::</span><span class="function">WantFind</span><span class="symbol">(</span><span class="usertype">ColourPair</span><span class="normal"> </span><span class="symbol">&amp;</span><span class="normal">cp</span><span class="symbol">,</span><span class="normal"> </span><span class="type">bool</span><span class="normal"> want</span><span class="symbol">)</span><span class="normal"> </span><span class="cbracket">{</span>
<span class="normal">    </span><span class="keyword">if</span><span class="normal"> </span><span class="symbol">(</span><span class="normal">want</span><span class="symbol">)</span><span class="normal"> </span><span class="cbracket">{</span>
<span class="normal">        </span><span class="keyword">for</span><span class="normal"> </span><span class="symbol">(</span><span class="type">int</span><span class="normal"> i</span><span class="symbol">=</span><span class="number">0</span><span class="symbol">;</span><span class="normal"> i </span><span class="symbol">&lt;</span><span class="normal"> used</span><span class="symbol">;</span><span class="normal"> i</span><span class="symbol">++)</span><span class="normal"> </span><span class="cbracket">{</span>
<span class="normal">            </span><span class="keyword">if</span><span class="normal"> </span><span class="symbol">(</span><span class="normal">entries</span><span class="symbol">[</span><span class="normal">i</span><span class="symbol">].</span><span class="normal">desired </span><span class="symbol">==</span><span class="normal"> cp</span><span class="symbol">.</span><span class="normal">desired</span><span class="symbol">)</span>
<span class="normal">                </span><span class="keyword">return</span><span class="symbol">;</span>
<span class="normal">        </span><span class="cbracket">}</span>

<span class="normal">        </span><span class="keyword">if</span><span class="normal"> </span><span class="symbol">(</span><span class="normal">used </span><span class="symbol">&gt;=</span><span class="normal"> size</span><span class="symbol">)</span><span class="normal"> </span><span class="cbracket">{</span>
<span class="normal">            </span><span class="type">int</span><span class="normal"> sizeNew </span><span class="symbol">=</span><span class="normal"> size </span><span class="symbol">*</span><span class="normal"> </span><span class="number">2</span><span class="symbol">;</span>
<span class="normal">            </span><span class="usertype">ColourPair</span><span class="normal"> </span><span class="symbol">*</span><span class="normal">entriesNew </span><span class="symbol">=</span><span class="normal"> </span><span class="keyword">new</span><span class="normal"> ColourPair</span><span class="symbol">[</span><span class="normal">sizeNew</span><span class="symbol">];</span>
<span class="normal">            </span><span class="keyword">for</span><span class="normal"> </span><span class="symbol">(</span><span class="type">int</span><span class="normal"> j</span><span class="symbol">=</span><span class="number">0</span><span class="symbol">;</span><span class="normal"> j</span><span class="symbol">&lt;</span><span class="normal">size</span><span class="symbol">;</span><span class="normal"> j</span><span class="symbol">++)</span><span class="normal"> </span><span class="cbracket">{</span>
<span class="normal">                entriesNew</span><span class="symbol">[</span><span class="normal">j</span><span class="symbol">]</span><span class="normal"> </span><span class="symbol">=</span><span class="normal"> entries</span><span class="symbol">[</span><span class="normal">j</span><span class="symbol">];</span>
<span class="normal">            </span><span class="cbracket">}</span>
<span class="normal">            </span><span class="keyword">delete</span><span class="normal"> </span><span class="symbol">[]</span><span class="normal">entries</span><span class="symbol">;</span>
<span class="normal">            entries </span><span class="symbol">=</span><span class="normal"> entriesNew</span><span class="symbol">;</span>
<span class="normal">            size </span><span class="symbol">=</span><span class="normal"> sizeNew</span><span class="symbol">;</span>
<span class="normal">        </span><span class="cbracket">}</span>

<span class="normal">        entries</span><span class="symbol">[</span><span class="normal">used</span><span class="symbol">].</span><span class="normal">desired </span><span class="symbol">=</span><span class="normal"> cp</span><span class="symbol">.</span><span class="normal">desired</span><span class="symbol">;</span>
<span class="normal">        entries</span><span class="symbol">[</span><span class="normal">used</span><span class="symbol">].</span><span class="normal">allocated</span><span class="symbol">.</span><span class="function">Set</span><span class="symbol">(</span><span class="normal">cp</span><span class="symbol">.</span><span class="normal">desired</span><span class="symbol">.</span><span class="function">AsLong</span><span class="symbol">());</span>
<span class="normal">        used</span><span class="symbol">++;</span>
<span class="normal">    </span><span class="cbracket">}</span><span class="normal"> </span><span class="keyword">else</span><span class="normal"> </span><span class="cbracket">{</span>
<span class="normal">        </span><span class="keyword">for</span><span class="normal"> </span><span class="symbol">(</span><span class="type">int</span><span class="normal"> i</span><span class="symbol">=</span><span class="number">0</span><span class="symbol">;</span><span class="normal"> i </span><span class="symbol">&lt;</span><span class="normal"> used</span><span class="symbol">;</span><span class="normal"> i</span><span class="symbol">++)</span><span class="normal"> </span><span class="cbracket">{</span>
<span class="normal">            </span><span class="keyword">if</span><span class="normal"> </span><span class="symbol">(</span><span class="normal">entries</span><span class="symbol">[</span><span class="normal">i</span><span class="symbol">].</span><span class="normal">desired </span><span class="symbol">==</span><span class="normal"> cp</span><span class="symbol">.</span><span class="normal">desired</span><span class="symbol">)</span><span class="normal"> </span><span class="cbracket">{</span>
<span class="normal">                cp</span><span class="symbol">.</span><span class="normal">allocated </span><span class="symbol">=</span><span class="normal"> entries</span><span class="symbol">[</span><span class="normal">i</span><span class="symbol">].</span><span class="normal">allocated</span><span class="symbol">;</span>
<span class="normal">                </span><span class="keyword">return</span><span class="symbol">;</span>
<span class="normal">            </span><span class="cbracket">}</span>
<span class="normal">        </span><span class="cbracket">}</span>
<span class="normal">        cp</span><span class="symbol">.</span><span class="normal">allocated</span><span class="symbol">.</span><span class="function">Set</span><span class="symbol">(</span><span class="normal">cp</span><span class="symbol">.</span><span class="normal">desired</span><span class="symbol">.</span><span class="function">AsLong</span><span class="symbol">());</span>
<span class="normal">    </span><span class="cbracket">}</span>
<span class="cbracket">}</span>

<span class="type">void</span><span class="normal"> Palette</span><span class="symbol">::</span><span class="function">Allocate</span><span class="symbol">(</span><span class="normal">Window </span><span class="symbol">&amp;)</span><span class="normal"> </span><span class="cbracket">{</span>
<span class="normal">    </span><span class="keyword">if</span><span class="normal"> </span><span class="symbol">(</span><span class="normal">allowRealization</span><span class="symbol">)</span><span class="normal"> </span><span class="cbracket">{</span>
<span class="normal">    </span><span class="cbracket">}</span>
<span class="cbracket">}</span>


<span class="comment">//----------------------------------------------------------------------</span>

<span class="normal">Font</span><span class="symbol">::</span><span class="function">Font</span><span class="symbol">()</span><span class="normal"> </span><span class="cbracket">{</span>
<span class="normal">    fid </span><span class="symbol">=</span><span class="normal"> </span><span class="number">0</span><span class="symbol">;</span>
<span class="normal">    ascent </span><span class="symbol">=</span><span class="normal"> </span><span class="number">0</span><span class="symbol">;</span>
<span class="cbracket">}</span>

<span class="normal">Font</span><span class="symbol">::~</span><span class="function">Font</span><span class="symbol">()</span><span class="normal"> </span><span class="cbracket">{</span>
<span class="cbracket">}</span>

<span class="type">void</span><span class="normal"> Font</span><span class="symbol">::</span><span class="function">Create</span><span class="symbol">(</span><span class="keyword">const</span><span class="normal"> </span><span class="type">char</span><span class="normal"> </span><span class="symbol">*</span><span class="normal">faceName</span><span class="symbol">,</span><span class="normal"> </span><span class="type">int</span><span class="normal"> characterSet</span><span class="symbol">,</span><span class="normal"> </span><span class="type">int</span><span class="normal"> size</span><span class="symbol">,</span><span class="normal"> </span><span class="type">bool</span><span class="normal"> bold</span><span class="symbol">,</span><span class="normal"> </span><span class="type">bool</span><span class="normal"> italic</span><span class="symbol">,</span><span class="normal"> </span><span class="type">bool</span><span class="normal"> extraFontFlag</span><span class="symbol">)</span><span class="normal"> </span><span class="cbracket">{</span>

<span class="normal">    </span><span class="function">Release</span><span class="symbol">();</span>

<span class="normal">    </span><span class="comment">// The minus one is done because since Scintilla uses SC_SHARSET_DEFAULT</span>
<span class="normal">    </span><span class="comment">// internally and we need to have wxFONENCODING_DEFAULT == SC_SHARSET_DEFAULT</span>
<span class="normal">    </span><span class="comment">// so we adjust the encoding before passing it to Scintilla.  See also</span>
<span class="normal">    </span><span class="comment">// wxStyledTextCtrl::StyleSetCharacterSet</span>
<span class="normal">    </span><span class="usertype">wxFontEncoding</span><span class="normal"> encoding </span><span class="symbol">=</span><span class="normal"> </span><span class="symbol">(</span><span class="normal">wxFontEncoding</span><span class="symbol">)(</span><span class="normal">characterSet</span><span class="symbol">-</span><span class="number">1</span><span class="symbol">);</span>

<span class="normal">    </span><span class="usertype">wxFontEncodingArray</span><span class="normal"> ea </span><span class="symbol">=</span><span class="normal"> wxEncodingConverter</span><span class="symbol">::</span><span class="function">GetPlatformEquivalents</span><span class="symbol">(</span><span class="normal">encoding</span><span class="symbol">);</span>
<span class="normal">    </span><span class="keyword">if</span><span class="normal"> </span><span class="symbol">(</span><span class="normal">ea</span><span class="symbol">.</span><span class="function">GetCount</span><span class="symbol">())</span>
<span class="normal">        encoding </span><span class="symbol">=</span><span class="normal"> ea</span><span class="symbol">[</span><span class="number">0</span><span class="symbol">];</span>

<span class="normal">    wxFont</span><span class="symbol">*</span><span class="normal"> font </span><span class="symbol">=</span><span class="normal"> </span><span class="keyword">new</span><span class="normal"> </span><span class="function">wxFont</span><span class="symbol">(</span><span class="normal">size</span><span class="symbol">,</span>
<span class="normal">                    wxDEFAULT</span><span class="symbol">,</span>
<span class="normal">                    italic </span><span class="symbol">?</span><span class="normal"> wxITALIC </span><span class="symbol">:</span><span class="normal">  wxNORMAL</span><span class="symbol">,</span>
<span class="normal">                    bold </span><span class="symbol">?</span><span class="normal"> wxBOLD </span><span class="symbol">:</span><span class="normal"> wxNORMAL</span><span class="symbol">,</span>
<span class="normal">                    </span><span class="keyword">false</span><span class="symbol">,</span>
<span class="normal">                    </span><span class="function">stc2wx</span><span class="symbol">(</span><span class="normal">faceName</span><span class="symbol">),</span>
<span class="normal">                    encoding</span><span class="symbol">);</span>
<span class="normal">    font</span><span class="symbol">-&gt;</span><span class="function">SetNoAntiAliasing</span><span class="symbol">(!</span><span class="normal">extraFontFlag</span><span class="symbol">);</span>
<span class="normal">    fid </span><span class="symbol">=</span><span class="normal"> font</span><span class="symbol">;</span>
<span class="cbracket">}</span>


<span class="type">void</span><span class="normal"> Font</span><span class="symbol">::</span><span class="function">Release</span><span class="symbol">()</span><span class="normal"> </span><span class="cbracket">{</span>
<span class="normal">    </span><span class="keyword">if</span><span class="normal"> </span><span class="symbol">(</span><span class="normal">fid</span><span class="symbol">)</span>
<span class="normal">        </span><span class="keyword">delete</span><span class="normal"> </span><span class="symbol">(</span><span class="normal">wxFont</span><span class="symbol">*)</span><span class="normal">fid</span><span class="symbol">;</span>
<span class="normal">    fid </span><span class="symbol">=</span><span class="normal"> </span><span class="number">0</span><span class="symbol">;</span>
<span class="cbracket">}</span>

<span class="comment">//----------------------------------------------------------------------</span>

<span class="keyword">class</span><span class="normal"> </span><span class="classname">SurfaceImpl</span><span class="normal"> </span><span class="symbol">:</span><span class="normal"> </span><span class="keyword">public</span><span class="normal"> Surface </span><span class="cbracket">{</span>
<span class="keyword">private</span><span class="symbol">:</span>
<span class="normal">    wxDC</span><span class="symbol">*</span><span class="normal">       hdc</span><span class="symbol">;</span>
<span class="normal">    </span><span class="type">bool</span><span class="normal">        hdcOwned</span><span class="symbol">;</span>
<span class="normal">    wxBitmap</span><span class="symbol">*</span><span class="normal">   bitmap</span><span class="symbol">;</span>
<span class="normal">    </span><span class="type">int</span><span class="normal">         x</span><span class="symbol">;</span>
<span class="normal">    </span><span class="type">int</span><span class="normal">         y</span><span class="symbol">;</span>
<span class="normal">    </span><span class="type">bool</span><span class="normal">        unicodeMode</span><span class="symbol">;</span>

<span class="keyword">public</span><span class="symbol">:</span>
<span class="normal">    </span><span class="function">SurfaceImpl</span><span class="symbol">();</span>
<span class="normal">    </span><span class="symbol">~</span><span class="function">SurfaceImpl</span><span class="symbol">();</span>

<span class="normal">    </span><span class="keyword">virtual</span><span class="normal"> </span><span class="type">void</span><span class="normal"> </span><span class="function">Init</span><span class="symbol">(</span><span class="usertype">WindowID</span><span class="normal"> wid</span><span class="symbol">);</span>
<span class="normal">    </span><span class="keyword">virtual</span><span class="normal"> </span><span class="type">void</span><span class="normal"> </span><span class="function">Init</span><span class="symbol">(</span><span class="usertype">SurfaceID</span><span class="normal"> sid</span><span class="symbol">,</span><span class="normal"> </span><span class="usertype">WindowID</span><span class="normal"> wid</span><span class="symbol">);</span>
<span class="normal">    </span><span class="keyword">virtual</span><span class="normal"> </span><span class="type">void</span><span class="normal"> </span><span class="function">InitPixMap</span><span class="symbol">(</span><span class="type">int</span><span class="normal"> width</span><span class="symbol">,</span><span class="normal"> </span><span class="type">int</span><span class="normal"> height</span><span class="symbol">,</span><span class="normal"> </span><span class="usertype">Surface</span><span class="normal"> </span><span class="symbol">*</span><span class="normal">surface_</span><span class="symbol">,</span><span class="normal"> </span><span class="usertype">WindowID</span><span class="normal"> wid</span><span class="symbol">);</span>

<span class="normal">    </span><span class="keyword">virtual</span><span class="normal"> </span><span class="type">void</span><span class="normal"> </span><span class="function">Release</span><span class="symbol">();</span>
<span class="normal">    </span><span class="keyword">virtual</span><span class="normal"> </span><span class="type">bool</span><span class="normal"> </span><span class="function">Initialised</span><span class="symbol">();</span>
<span class="normal">    </span><span class="keyword">virtual</span><span class="normal"> </span><span class="type">void</span><span class="normal"> </span><span class="function">PenColour</span><span class="symbol">(</span><span class="usertype">ColourAllocated</span><span class="normal"> fore</span><span class="symbol">);</span>
<span class="normal">    </span><span class="keyword">virtual</span><span class="normal"> </span><span class="type">int</span><span class="normal"> </span><span class="function">LogPixelsY</span><span class="symbol">();</span>
<span class="normal">    </span><span class="keyword">virtual</span><span class="normal"> </span><span class="type">int</span><span class="normal"> </span><span class="function">DeviceHeightFont</span><span class="symbol">(</span><span class="type">int</span><span class="normal"> points</span><span class="symbol">);</span>
<span class="normal">    </span><span class="keyword">virtual</span><span class="normal"> </span><span class="type">void</span><span class="normal"> </span><span class="function">MoveTo</span><span class="symbol">(</span><span class="type">int</span><span class="normal"> x_</span><span class="symbol">,</span><span class="normal"> </span><span class="type">int</span><span class="normal"> y_</span><span class="symbol">);</span>
<span class="normal">    </span><span class="keyword">virtual</span><span class="normal"> </span><span class="type">void</span><span class="normal"> </span><span class="function">LineTo</span><span class="symbol">(</span><span class="type">int</span><span class="normal"> x_</span><span class="symbol">,</span><span class="normal"> </span><span class="type">int</span><span class="normal"> y_</span><span class="symbol">);</span>
<span class="normal">    </span><span class="keyword">virtual</span><span class="normal"> </span><span class="type">void</span><span class="normal"> </span><span class="function">Polygon</span><span class="symbol">(</span><span class="usertype">Point</span><span class="normal"> </span><span class="symbol">*</span><span class="normal">pts</span><span class="symbol">,</span><span class="normal"> </span><span class="type">int</span><span class="normal"> npts</span><span class="symbol">,</span><span class="normal"> </span><span class="usertype">ColourAllocated</span><span class="normal"> fore</span><span class="symbol">,</span><span class="normal"> </span><span class="usertype">ColourAllocated</span><span class="normal"> back</span><span class="symbol">);</span>
<span class="normal">    </span><span class="keyword">virtual</span><span class="normal"> </span><span class="type">void</span><span class="normal"> </span><span class="function">RectangleDraw</span><span class="symbol">(</span><span class="usertype">PRectangle</span><span class="normal"> rc</span><span class="symbol">,</span><span class="normal"> </span><span class="usertype">ColourAllocated</span><span class="normal"> fore</span><span class="symbol">,</span><span class="normal"> </span><span class="usertype">ColourAllocated</span><span class="normal"> back</span><span class="symbol">);</span>
<span class="normal">    </span><span class="keyword">virtual</span><span class="normal"> </span><span class="type">void</span><span class="normal"> </span><span class="function">FillRectangle</span><span class="symbol">(</span><span class="usertype">PRectangle</span><span class="normal"> rc</span><span class="symbol">,</span><span class="normal"> </span><span class="usertype">ColourAllocated</span><span class="normal"> back</span><span class="symbol">);</span>
<span class="normal">    </span><span class="keyword">virtual</span><span class="normal"> </span><span class="type">void</span><span class="normal"> </span><span class="function">FillRectangle</span><span class="symbol">(</span><span class="usertype">PRectangle</span><span class="normal"> rc</span><span class="symbol">,</span><span class="normal"> </span><span class="usertype">Surface</span><span class="normal"> </span><span class="symbol">&amp;</span><span class="normal">surfacePattern</span><span class="symbol">);</span>
<span class="normal">    </span><span class="keyword">virtual</span><span class="normal"> </span><span class="type">void</span><span class="normal"> </span><span class="function">RoundedRectangle</span><span class="symbol">(</span><span class="usertype">PRectangle</span><span class="normal"> rc</span><span class="symbol">,</span><span class="normal"> </span><span class="usertype">ColourAllocated</span><span class="normal"> fore</span><span class="symbol">,</span><span class="normal"> </span><span class="usertype">ColourAllocated</span><span class="normal"> back</span><span class="symbol">);</span>
<span class="normal">    </span><span class="keyword">virtual</span><span class="normal"> </span><span class="type">void</span><span class="normal"> </span><span class="function">AlphaRectangle</span><span class="symbol">(</span><span class="usertype">PRectangle</span><span class="normal"> rc</span><span class="symbol">,</span><span class="normal"> </span><span class="type">int</span><span class="normal"> cornerSize</span><span class="symbol">,</span><span class="normal"> </span><span class="usertype">ColourAllocated</span><span class="normal"> fill</span><span class="symbol">,</span><span class="normal"> </span><span class="type">int</span><span class="normal"> alphaFill</span><span class="symbol">,</span>
<span class="normal">                                </span><span class="usertype">ColourAllocated</span><span class="normal"> outline</span><span class="symbol">,</span><span class="normal"> </span><span class="type">int</span><span class="normal"> alphaOutline</span><span class="symbol">,</span><span class="normal"> </span><span class="type">int</span><span class="normal"> flags</span><span class="symbol">);</span>
<span class="normal">    </span><span class="keyword">virtual</span><span class="normal"> </span><span class="type">void</span><span class="normal"> </span><span class="function">Ellipse</span><span class="symbol">(</span><span class="usertype">PRectangle</span><span class="normal"> rc</span><span class="symbol">,</span><span class="normal"> </span><span class="usertype">ColourAllocated</span><span class="normal"> fore</span><span class="symbol">,</span><span class="normal"> </span><span class="usertype">ColourAllocated</span><span class="normal"> back</span><span class="symbol">);</span>
<span class="normal">    </span><span class="keyword">virtual</span><span class="normal"> </span><span class="type">void</span><span class="normal"> </span><span class="function">Copy</span><span class="symbol">(</span><span class="usertype">PRectangle</span><span class="normal"> rc</span><span class="symbol">,</span><span class="normal"> </span><span class="usertype">Point</span><span class="normal"> from</span><span class="symbol">,</span><span class="normal"> </span><span class="usertype">Surface</span><span class="normal"> </span><span class="symbol">&amp;</span><span class="normal">surfaceSource</span><span class="symbol">);</span>

<span class="normal">    </span><span class="keyword">virtual</span><span class="normal"> </span><span class="type">void</span><span class="normal"> </span><span class="function">DrawTextNoClip</span><span class="symbol">(</span><span class="usertype">PRectangle</span><span class="normal"> rc</span><span class="symbol">,</span><span class="normal"> </span><span class="usertype">Font</span><span class="normal"> </span><span class="symbol">&amp;</span><span class="normal">font_</span><span class="symbol">,</span><span class="normal"> </span><span class="type">int</span><span class="normal"> ybase</span><span class="symbol">,</span><span class="normal"> </span><span class="keyword">const</span><span class="normal"> </span><span class="type">char</span><span class="normal"> </span><span class="symbol">*</span><span class="normal">s</span><span class="symbol">,</span><span class="normal"> </span><span class="type">int</span><span class="normal"> len</span><span class="symbol">,</span><span class="normal"> </span><span class="usertype">ColourAllocated</span><span class="normal"> fore</span><span class="symbol">,</span><span class="normal"> </span><span class="usertype">ColourAllocated</span><span class="normal"> back</span><span class="symbol">);</span>
<span class="normal">    </span><span class="keyword">virtual</span><span class="normal"> </span><span class="type">void</span><span class="normal"> </span><span class="function">DrawTextClipped</span><span class="symbol">(</span><span class="usertype">PRectangle</span><span class="normal"> rc</span><span class="symbol">,</span><span class="normal"> </span><span class="usertype">Font</span><span class="normal"> </span><span class="symbol">&amp;</span><span class="normal">font_</span><span class="symbol">,</span><span class="normal"> </span><span class="type">int</span><span class="normal"> ybase</span><span class="symbol">,</span><span class="normal"> </span><span class="keyword">const</span><span class="normal"> </span><span class="type">char</span><span class="normal"> </span><span class="symbol">*</span><span class="normal">s</span><span class="symbol">,</span><span class="normal"> </span><span class="type">int</span><span class="normal"> len</span><span class="symbol">,</span><span class="normal"> </span><span class="usertype">ColourAllocated</span><span class="normal"> fore</span><span class="symbol">,</span><span class="normal"> </span><span class="usertype">ColourAllocated</span><span class="normal"> back</span><span class="symbol">);</span>
<span class="normal">    </span><span class="keyword">virtual</span><span class="normal"> </span><span class="type">void</span><span class="normal"> </span><span class="function">DrawTextTransparent</span><span class="symbol">(</span><span class="usertype">PRectangle</span><span class="normal"> rc</span><span class="symbol">,</span><span class="normal"> </span><span class="usertype">Font</span><span class="normal"> </span><span class="symbol">&amp;</span><span class="normal">font_</span><span class="symbol">,</span><span class="normal"> </span><span class="type">int</span><span class="normal"> ybase</span><span class="symbol">,</span><span class="normal"> </span><span class="keyword">const</span><span class="normal"> </span><span class="type">char</span><span class="normal"> </span><span class="symbol">*</span><span class="normal">s</span><span class="symbol">,</span><span class="normal"> </span><span class="type">int</span><span class="normal"> len</span><span class="symbol">,</span><span class="normal"> </span><span class="usertype">ColourAllocated</span><span class="normal"> fore</span><span class="symbol">);</span>
<span class="normal">    </span><span class="keyword">virtual</span><span class="normal"> </span><span class="type">void</span><span class="normal"> </span><span class="function">MeasureWidths</span><span class="symbol">(</span><span class="usertype">Font</span><span class="normal"> </span><span class="symbol">&amp;</span><span class="normal">font_</span><span class="symbol">,</span><span class="normal"> </span><span class="keyword">const</span><span class="normal"> </span><span class="type">char</span><span class="normal"> </span><span class="symbol">*</span><span class="normal">s</span><span class="symbol">,</span><span class="normal"> </span><span class="type">int</span><span class="normal"> len</span><span class="symbol">,</span><span class="normal"> </span><span class="type">int</span><span class="normal"> </span><span class="symbol">*</span><span class="normal">positions</span><span class="symbol">);</span>
<span class="normal">    </span><span class="keyword">virtual</span><span class="normal"> </span><span class="type">int</span><span class="normal"> </span><span class="function">WidthText</span><span class="symbol">(</span><span class="usertype">Font</span><span class="normal"> </span><span class="symbol">&amp;</span><span class="normal">font_</span><span class="symbol">,</span><span class="normal"> </span><span class="keyword">const</span><span class="normal"> </span><span class="type">char</span><span class="normal"> </span><span class="symbol">*</span><span class="normal">s</span><span class="symbol">,</span><span class="normal"> </span><span class="type">int</span><span class="normal"> len</span><span class="symbol">);</span>
<span class="normal">    </span><span class="keyword">virtual</span><span class="normal"> </span><span class="type">int</span><span class="normal"> </span><span class="function">WidthChar</span><span class="symbol">(</span><span class="usertype">Font</span><span class="normal"> </span><span class="symbol">&amp;</span><span class="normal">font_</span><span class="symbol">,</span><span class="normal"> </span><span class="type">char</span><span class="normal"> ch</span><span class="symbol">);</span>
<span class="normal">    </span><span class="keyword">virtual</span><span class="normal"> </span><span class="type">int</span><span class="normal"> </span><span class="function">Ascent</span><span class="symbol">(</span><span class="usertype">Font</span><span class="normal"> </span><span class="symbol">&amp;</span><span class="normal">font_</span><span class="symbol">);</span>
<span class="normal">    </span><span class="keyword">virtual</span><span class="normal"> </span><span class="type">int</span><span class="normal"> </span><span class="function">Descent</span><span class="symbol">(</span><span class="usertype">Font</span><span class="normal"> </span><span class="symbol">&amp;</span><span class="normal">font_</span><span class="symbol">);</span>
<span class="normal">    </span><span class="keyword">virtual</span><span class="normal"> </span><span class="type">int</span><span class="normal"> </span><span class="function">InternalLeading</span><span class="symbol">(</span><span class="usertype">Font</span><span class="normal"> </span><span class="symbol">&amp;</span><span class="normal">font_</span><span class="symbol">);</span>
<span class="normal">    </span><span class="keyword">virtual</span><span class="normal"> </span><span class="type">int</span><span class="normal"> </span><span class="function">ExternalLeading</span><span class="symbol">(</span><span class="usertype">Font</span><span class="normal"> </span><span class="symbol">&amp;</span><span class="normal">font_</span><span class="symbol">);</span>
<span class="normal">    </span><span class="keyword">virtual</span><span class="normal"> </span><span class="type">int</span><span class="normal"> </span><span class="function">Height</span><span class="symbol">(</span><span class="usertype">Font</span><span class="normal"> </span><span class="symbol">&amp;</span><span class="normal">font_</span><span class="symbol">);</span>
<span class="normal">    </span><span class="keyword">virtual</span><span class="normal"> </span><span class="type">int</span><span class="normal"> </span><span class="function">AverageCharWidth</span><span class="symbol">(</span><span class="usertype">Font</span><span class="normal"> </span><span class="symbol">&amp;</span><span class="normal">font_</span><span class="symbol">);</span>

<span class="normal">    </span><span class="keyword">virtual</span><span class="normal"> </span><span class="type">int</span><span class="normal"> </span><span class="function">SetPalette</span><span class="symbol">(</span><span class="usertype">Palette</span><span class="normal"> </span><span class="symbol">*</span><span class="normal">pal</span><span class="symbol">,</span><span class="normal"> </span><span class="type">bool</span><span class="normal"> inBackGround</span><span class="symbol">);</span>
<span class="normal">    </span><span class="keyword">virtual</span><span class="normal"> </span><span class="type">void</span><span class="normal"> </span><span class="function">SetClip</span><span class="symbol">(</span><span class="usertype">PRectangle</span><span class="normal"> rc</span><span class="symbol">);</span>
<span class="normal">    </span><span class="keyword">virtual</span><span class="normal"> </span><span class="type">void</span><span class="normal"> </span><span class="function">FlushCachedState</span><span class="symbol">();</span>

<span class="normal">    </span><span class="keyword">virtual</span><span class="normal"> </span><span class="type">void</span><span class="normal"> </span><span class="function">SetUnicodeMode</span><span class="symbol">(</span><span class="type">bool</span><span class="normal"> unicodeMode_</span><span class="symbol">);</span>
<span class="normal">    </span><span class="keyword">virtual</span><span class="normal"> </span><span class="type">void</span><span class="normal"> </span><span class="function">SetDBCSMode</span><span class="symbol">(</span><span class="type">int</span><span class="normal"> codePage</span><span class="symbol">);</span>

<span class="normal">    </span><span class="type">void</span><span class="normal"> </span><span class="function">BrushColour</span><span class="symbol">(</span><span class="usertype">ColourAllocated</span><span class="normal"> back</span><span class="symbol">);</span>
<span class="normal">    </span><span class="type">void</span><span class="normal"> </span><span class="function">SetFont</span><span class="symbol">(</span><span class="usertype">Font</span><span class="normal"> </span><span class="symbol">&amp;</span><span class="normal">font_</span><span class="symbol">);</span>
<span class="cbracket">}</span><span class="symbol">;</span>



<span class="normal">SurfaceImpl</span><span class="symbol">::</span><span class="function">SurfaceImpl</span><span class="symbol">()</span><span class="normal"> </span><span class="symbol">:</span>
<span class="normal">    </span><span class="function">hdc</span><span class="symbol">(</span><span class="number">0</span><span class="symbol">),</span><span class="normal"> </span><span class="function">hdcOwned</span><span class="symbol">(</span><span class="number">0</span><span class="symbol">),</span><span class="normal"> </span><span class="function">bitmap</span><span class="symbol">(</span><span class="number">0</span><span class="symbol">),</span>
<span class="normal">    </span><span class="function">x</span><span class="symbol">(</span><span class="number">0</span><span class="symbol">),</span><span class="normal"> </span><span class="function">y</span><span class="symbol">(</span><span class="number">0</span><span class="symbol">),</span><span class="normal"> </span><span class="function">unicodeMode</span><span class="symbol">(</span><span class="number">0</span><span class="symbol">)</span>
<span class="cbracket">{}</span>

<span class="normal">SurfaceImpl</span><span class="symbol">::~</span><span class="function">SurfaceImpl</span><span class="symbol">()</span><span class="normal"> </span><span class="cbracket">{</span>
<span class="normal">    </span><span class="function">Release</span><span class="symbol">();</span>
<span class="cbracket">}</span>

<span class="type">void</span><span class="normal"> SurfaceImpl</span><span class="symbol">::</span><span class="function">Init</span><span class="symbol">(</span><span class="usertype">WindowID</span><span class="normal"> wid</span><span class="symbol">)</span><span class="normal"> </span><span class="cbracket">{</span>
<span class="preproc">#if</span><span class="normal"> </span><span class="number">0</span>
<span class="normal">    </span><span class="function">Release</span><span class="symbol">();</span>
<span class="normal">    hdc </span><span class="symbol">=</span><span class="normal"> </span><span class="keyword">new</span><span class="normal"> </span><span class="function">wxMemoryDC</span><span class="symbol">();</span>
<span class="normal">    hdcOwned </span><span class="symbol">=</span><span class="normal"> </span><span class="keyword">true</span><span class="symbol">;</span>
<span class="preproc">#else</span>
<span class="normal">    </span><span class="comment">// On Mac and GTK the DC is not really valid until it has a bitmap</span>
<span class="normal">    </span><span class="comment">// selected into it.  So instead of just creating the DC with no bitmap,</span>
<span class="normal">    </span><span class="comment">// go ahead and give it one.</span>
<span class="normal">    </span><span class="function">InitPixMap</span><span class="symbol">(</span><span class="number">1</span><span class="symbol">,</span><span class="number">1</span><span class="symbol">,</span><span class="normal">NULL</span><span class="symbol">,</span><span class="normal">wid</span><span class="symbol">);</span>
<span class="preproc">#endif</span>
<span class="cbracket">}</span>

<span class="type">void</span><span class="normal"> SurfaceImpl</span><span class="symbol">::</span><span class="function">Init</span><span class="symbol">(</span><span class="usertype">SurfaceID</span><span class="normal"> hdc_</span><span class="symbol">,</span><span class="normal"> WindowID</span><span class="symbol">)</span><span class="normal"> </span><span class="cbracket">{</span>
<span class="normal">    </span><span class="function">Release</span><span class="symbol">();</span>
<span class="normal">    hdc </span><span class="symbol">=</span><span class="normal"> </span><span class="symbol">(</span><span class="normal">wxDC</span><span class="symbol">*)</span><span class="normal">hdc_</span><span class="symbol">;</span>
<span class="cbracket">}</span>

<span class="type">void</span><span class="normal"> SurfaceImpl</span><span class="symbol">::</span><span class="function">InitPixMap</span><span class="symbol">(</span><span class="type">int</span><span class="normal"> width</span><span class="symbol">,</span><span class="normal"> </span><span class="type">int</span><span class="normal"> height</span><span class="symbol">,</span><span class="normal"> </span><span class="usertype">Surface</span><span class="normal"> </span><span class="symbol">*</span><span class="function">WXUNUSED</span><span class="symbol">(</span><span class="normal">surface_</span><span class="symbol">),</span><span class="normal"> WindowID</span><span class="symbol">)</span><span class="normal"> </span><span class="cbracket">{</span>
<span class="normal">    </span><span class="function">Release</span><span class="symbol">();</span>
<span class="normal">    hdc </span><span class="symbol">=</span><span class="normal"> </span><span class="keyword">new</span><span class="normal"> </span><span class="function">wxMemoryDC</span><span class="symbol">();</span>
<span class="normal">    hdcOwned </span><span class="symbol">=</span><span class="normal"> </span><span class="keyword">true</span><span class="symbol">;</span>
<span class="normal">    </span><span class="keyword">if</span><span class="normal"> </span><span class="symbol">(</span><span class="normal">width </span><span class="symbol">&lt;</span><span class="normal"> </span><span class="number">1</span><span class="symbol">)</span><span class="normal"> width </span><span class="symbol">=</span><span class="normal"> </span><span class="number">1</span><span class="symbol">;</span>
<span class="normal">    </span><span class="keyword">if</span><span class="normal"> </span><span class="symbol">(</span><span class="normal">height </span><span class="symbol">&lt;</span><span class="normal"> </span><span class="number">1</span><span class="symbol">)</span><span class="normal"> height </span><span class="symbol">=</span><span class="normal"> </span><span class="number">1</span><span class="symbol">;</span>
<span class="normal">    bitmap </span><span class="symbol">=</span><span class="normal"> </span><span class="keyword">new</span><span class="normal"> </span><span class="function">wxBitmap</span><span class="symbol">(</span><span class="normal">width</span><span class="symbol">,</span><span class="normal"> height</span><span class="symbol">);</span>
<span class="normal">    </span><span class="symbol">((</span><span class="normal">wxMemoryDC</span><span class="symbol">*)</span><span class="normal">hdc</span><span class="symbol">)-&gt;</span><span class="function">SelectObject</span><span class="symbol">(*</span><span class="normal">bitmap</span><span class="symbol">);</span>
<span class="cbracket">}</span>


<span class="type">void</span><span class="normal"> SurfaceImpl</span><span class="symbol">::</span><span class="function">Release</span><span class="symbol">()</span><span class="normal"> </span><span class="cbracket">{</span>
<span class="normal">    </span><span class="keyword">if</span><span class="normal"> </span><span class="symbol">(</span><span class="normal">bitmap</span><span class="symbol">)</span><span class="normal"> </span><span class="cbracket">{</span>
<span class="normal">        </span><span class="symbol">((</span><span class="normal">wxMemoryDC</span><span class="symbol">*)</span><span class="normal">hdc</span><span class="symbol">)-&gt;</span><span class="function">SelectObject</span><span class="symbol">(</span><span class="normal">wxNullBitmap</span><span class="symbol">);</span>
<span class="normal">        </span><span class="keyword">delete</span><span class="normal"> bitmap</span><span class="symbol">;</span>
<span class="normal">        bitmap </span><span class="symbol">=</span><span class="normal"> </span><span class="number">0</span><span class="symbol">;</span>
<span class="normal">    </span><span class="cbracket">}</span>
<span class="normal">    </span><span class="keyword">if</span><span class="normal"> </span><span class="symbol">(</span><span class="normal">hdcOwned</span><span class="symbol">)</span><span class="normal"> </span><span class="cbracket">{</span>
<span class="normal">        </span><span class="keyword">delete</span><span class="normal"> hdc</span><span class="symbol">;</span>
<span class="normal">        hdc </span><span class="symbol">=</span><span class="normal"> </span><span class="number">0</span><span class="symbol">;</span>
<span class="normal">        hdcOwned </span><span class="symbol">=</span><span class="normal"> </span><span class="keyword">false</span><span class="symbol">;</span>
<span class="normal">    </span><span class="cbracket">}</span>
<span class="cbracket">}</span>


<span class="type">bool</span><span class="normal"> SurfaceImpl</span><span class="symbol">::</span><span class="function">Initialised</span><span class="symbol">()</span><span class="normal"> </span><span class="cbracket">{</span>
<span class="normal">    </span><span class="keyword">return</span><span class="normal"> hdc </span><span class="symbol">!=</span><span class="normal"> </span><span class="number">0</span><span class="symbol">;</span>
<span class="cbracket">}</span>


<span class="type">void</span><span class="normal"> SurfaceImpl</span><span class="symbol">::</span><span class="function">PenColour</span><span class="symbol">(</span><span class="usertype">ColourAllocated</span><span class="normal"> fore</span><span class="symbol">)</span><span class="normal"> </span><span class="cbracket">{</span>
<span class="normal">    hdc</span><span class="symbol">-&gt;</span><span class="function">SetPen</span><span class="symbol">(</span><span class="function">wxPen</span><span class="symbol">(</span><span class="function">wxColourFromCA</span><span class="symbol">(</span><span class="normal">fore</span><span class="symbol">),</span><span class="normal"> </span><span class="number">1</span><span class="symbol">,</span><span class="normal"> wxSOLID</span><span class="symbol">));</span>
<span class="cbracket">}</span>

<span class="type">void</span><span class="normal"> SurfaceImpl</span><span class="symbol">::</span><span class="function">BrushColour</span><span class="symbol">(</span><span class="usertype">ColourAllocated</span><span class="normal"> back</span><span class="symbol">)</span><span class="normal"> </span><span class="cbracket">{</span>
<span class="normal">    hdc</span><span class="symbol">-&gt;</span><span class="function">SetBrush</span><span class="symbol">(</span><span class="function">wxBrush</span><span class="symbol">(</span><span class="function">wxColourFromCA</span><span class="symbol">(</span><span class="normal">back</span><span class="symbol">),</span><span class="normal"> wxSOLID</span><span class="symbol">));</span>
<span class="cbracket">}</span>

<span class="type">void</span><span class="normal"> SurfaceImpl</span><span class="symbol">::</span><span class="function">SetFont</span><span class="symbol">(</span><span class="usertype">Font</span><span class="normal"> </span><span class="symbol">&amp;</span><span class="normal">font_</span><span class="symbol">)</span><span class="normal"> </span><span class="cbracket">{</span>
<span class="normal">  </span><span class="keyword">if</span><span class="normal"> </span><span class="symbol">(</span><span class="normal">font_</span><span class="symbol">.</span><span class="function">GetID</span><span class="symbol">())</span><span class="normal"> </span><span class="cbracket">{</span>
<span class="normal">      hdc</span><span class="symbol">-&gt;</span><span class="function">SetFont</span><span class="symbol">(*((</span><span class="normal">wxFont</span><span class="symbol">*)</span><span class="normal">font_</span><span class="symbol">.</span><span class="function">GetID</span><span class="symbol">()));</span>
<span class="normal">    </span><span class="cbracket">}</span>
<span class="cbracket">}</span>

<span class="type">int</span><span class="normal"> SurfaceImpl</span><span class="symbol">::</span><span class="function">LogPixelsY</span><span class="symbol">()</span><span class="normal"> </span><span class="cbracket">{</span>
<span class="normal">    </span><span class="keyword">return</span><span class="normal"> hdc</span><span class="symbol">-&gt;</span><span class="function">GetPPI</span><span class="symbol">().</span><span class="normal">y</span><span class="symbol">;</span>
<span class="cbracket">}</span>

<span class="type">int</span><span class="normal"> SurfaceImpl</span><span class="symbol">::</span><span class="function">DeviceHeightFont</span><span class="symbol">(</span><span class="type">int</span><span class="normal"> points</span><span class="symbol">)</span><span class="normal"> </span><span class="cbracket">{</span>
<span class="normal">    </span><span class="keyword">return</span><span class="normal"> points</span><span class="symbol">;</span>
<span class="cbracket">}</span>

<span class="type">void</span><span class="normal"> SurfaceImpl</span><span class="symbol">::</span><span class="function">MoveTo</span><span class="symbol">(</span><span class="type">int</span><span class="normal"> x_</span><span class="symbol">,</span><span class="normal"> </span><span class="type">int</span><span class="normal"> y_</span><span class="symbol">)</span><span class="normal"> </span><span class="cbracket">{</span>
<span class="normal">    x </span><span class="symbol">=</span><span class="normal"> x_</span><span class="symbol">;</span>
<span class="normal">    y </span><span class="symbol">=</span><span class="normal"> y_</span><span class="symbol">;</span>
<span class="cbracket">}</span>

<span class="type">void</span><span class="normal"> SurfaceImpl</span><span class="symbol">::</span><span class="function">LineTo</span><span class="symbol">(</span><span class="type">int</span><span class="normal"> x_</span><span class="symbol">,</span><span class="normal"> </span><span class="type">int</span><span class="normal"> y_</span><span class="symbol">)</span><span class="normal"> </span><span class="cbracket">{</span>
<span class="normal">    hdc</span><span class="symbol">-&gt;</span><span class="function">DrawLine</span><span class="symbol">(</span><span class="normal">x</span><span class="symbol">,</span><span class="normal">y</span><span class="symbol">,</span><span class="normal"> x_</span><span class="symbol">,</span><span class="normal">y_</span><span class="symbol">);</span>
<span class="normal">    x </span><span class="symbol">=</span><span class="normal"> x_</span><span class="symbol">;</span>
<span class="normal">    y </span><span class="symbol">=</span><span class="normal"> y_</span><span class="symbol">;</span>
<span class="cbracket">}</span>

<span class="type">void</span><span class="normal"> SurfaceImpl</span><span class="symbol">::</span><span class="function">Polygon</span><span class="symbol">(</span><span class="usertype">Point</span><span class="normal"> </span><span class="symbol">*</span><span class="normal">pts</span><span class="symbol">,</span><span class="normal"> </span><span class="type">int</span><span class="normal"> npts</span><span class="symbol">,</span><span class="normal"> </span><span class="usertype">ColourAllocated</span><span class="normal"> fore</span><span class="symbol">,</span><span class="normal"> </span><span class="usertype">ColourAllocated</span><span class="normal"> back</span><span class="symbol">)</span><span class="normal"> </span><span class="cbracket">{</span>
<span class="normal">    </span><span class="function">PenColour</span><span class="symbol">(</span><span class="normal">fore</span><span class="symbol">);</span>
<span class="normal">    </span><span class="function">BrushColour</span><span class="symbol">(</span><span class="normal">back</span><span class="symbol">);</span>
<span class="normal">    hdc</span><span class="symbol">-&gt;</span><span class="function">DrawPolygon</span><span class="symbol">(</span><span class="normal">npts</span><span class="symbol">,</span><span class="normal"> </span><span class="symbol">(</span><span class="normal">wxPoint</span><span class="symbol">*)</span><span class="normal">pts</span><span class="symbol">);</span>
<span class="cbracket">}</span>

<span class="type">void</span><span class="normal"> SurfaceImpl</span><span class="symbol">::</span><span class="function">RectangleDraw</span><span class="symbol">(</span><span class="usertype">PRectangle</span><span class="normal"> rc</span><span class="symbol">,</span><span class="normal"> </span><span class="usertype">ColourAllocated</span><span class="normal"> fore</span><span class="symbol">,</span><span class="normal"> </span><span class="usertype">ColourAllocated</span><span class="normal"> back</span><span class="symbol">)</span><span class="normal"> </span><span class="cbracket">{</span>
<span class="normal">    </span><span class="function">PenColour</span><span class="symbol">(</span><span class="normal">fore</span><span class="symbol">);</span>
<span class="normal">    </span><span class="function">BrushColour</span><span class="symbol">(</span><span class="normal">back</span><span class="symbol">);</span>
<span class="normal">    hdc</span><span class="symbol">-&gt;</span><span class="function">DrawRectangle</span><span class="symbol">(</span><span class="function">wxRectFromPRectangle</span><span class="symbol">(</span><span class="normal">rc</span><span class="symbol">));</span>
<span class="cbracket">}</span>

<span class="type">void</span><span class="normal"> SurfaceImpl</span><span class="symbol">::</span><span class="function">FillRectangle</span><span class="symbol">(</span><span class="usertype">PRectangle</span><span class="normal"> rc</span><span class="symbol">,</span><span class="normal"> </span><span class="usertype">ColourAllocated</span><span class="normal"> back</span><span class="symbol">)</span><span class="normal"> </span><span class="cbracket">{</span>
<span class="normal">    </span><span class="function">BrushColour</span><span class="symbol">(</span><span class="normal">back</span><span class="symbol">);</span>
<span class="normal">    hdc</span><span class="symbol">-&gt;</span><span class="function">SetPen</span><span class="symbol">(*</span><span class="normal">wxTRANSPARENT_PEN</span><span class="symbol">);</span>
<span class="normal">    hdc</span><span class="symbol">-&gt;</span><span class="function">DrawRectangle</span><span class="symbol">(</span><span class="function">wxRectFromPRectangle</span><span class="symbol">(</span><span class="normal">rc</span><span class="symbol">));</span>
<span class="cbracket">}</span>

<span class="type">void</span><span class="normal"> SurfaceImpl</span><span class="symbol">::</span><span class="function">FillRectangle</span><span class="symbol">(</span><span class="usertype">PRectangle</span><span class="normal"> rc</span><span class="symbol">,</span><span class="normal"> </span><span class="usertype">Surface</span><span class="normal"> </span><span class="symbol">&amp;</span><span class="normal">surfacePattern</span><span class="symbol">)</span><span class="normal"> </span><span class="cbracket">{</span>
<span class="normal">    </span><span class="usertype">wxBrush</span><span class="normal"> br</span><span class="symbol">;</span>
<span class="normal">    </span><span class="keyword">if</span><span class="normal"> </span><span class="symbol">(((</span><span class="normal">SurfaceImpl</span><span class="symbol">&amp;)</span><span class="normal">surfacePattern</span><span class="symbol">).</span><span class="normal">bitmap</span><span class="symbol">)</span>
<span class="normal">        br </span><span class="symbol">=</span><span class="normal"> </span><span class="function">wxBrush</span><span class="symbol">(*((</span><span class="normal">SurfaceImpl</span><span class="symbol">&amp;)</span><span class="normal">surfacePattern</span><span class="symbol">).</span><span class="normal">bitmap</span><span class="symbol">);</span>
<span class="normal">    </span><span class="keyword">else</span><span class="normal">    </span><span class="comment">// Something is wrong so display in red</span>
<span class="normal">        br </span><span class="symbol">=</span><span class="normal"> </span><span class="function">wxBrush</span><span class="symbol">(*</span><span class="normal">wxRED</span><span class="symbol">,</span><span class="normal"> wxSOLID</span><span class="symbol">);</span>
<span class="normal">    hdc</span><span class="symbol">-&gt;</span><span class="function">SetPen</span><span class="symbol">(*</span><span class="normal">wxTRANSPARENT_PEN</span><span class="symbol">);</span>
<span class="normal">    hdc</span><span class="symbol">-&gt;</span><span class="function">SetBrush</span><span class="symbol">(</span><span class="normal">br</span><span class="symbol">);</span>
<span class="normal">    hdc</span><span class="symbol">-&gt;</span><span class="function">DrawRectangle</span><span class="symbol">(</span><span class="function">wxRectFromPRectangle</span><span class="symbol">(</span><span class="normal">rc</span><span class="symbol">));</span>
<span class="cbracket">}</span>

<span class="type">void</span><span class="normal"> SurfaceImpl</span><span class="symbol">::</span><span class="function">RoundedRectangle</span><span class="symbol">(</span><span class="usertype">PRectangle</span><span class="normal"> rc</span><span class="symbol">,</span><span class="normal"> </span><span class="usertype">ColourAllocated</span><span class="normal"> fore</span><span class="symbol">,</span><span class="normal"> </span><span class="usertype">ColourAllocated</span><span class="normal"> back</span><span class="symbol">)</span><span class="normal"> </span><span class="cbracket">{</span>
<span class="normal">    </span><span class="function">PenColour</span><span class="symbol">(</span><span class="normal">fore</span><span class="symbol">);</span>
<span class="normal">    </span><span class="function">BrushColour</span><span class="symbol">(</span><span class="normal">back</span><span class="symbol">);</span>
<span class="normal">    hdc</span><span class="symbol">-&gt;</span><span class="function">DrawRoundedRectangle</span><span class="symbol">(</span><span class="function">wxRectFromPRectangle</span><span class="symbol">(</span><span class="normal">rc</span><span class="symbol">),</span><span class="normal"> </span><span class="number">4</span><span class="symbol">);</span>
<span class="cbracket">}</span>

<span class="preproc">#ifdef</span><span class="normal"> __WXMSW__</span>
<span class="preproc">#define</span><span class="normal"> </span><span class="function">wxPy_premultiply</span><span class="symbol">(</span><span class="normal">p</span><span class="symbol">,</span><span class="normal"> a</span><span class="symbol">)</span><span class="normal">   </span><span class="symbol">((</span><span class="normal">p</span><span class="symbol">)</span><span class="normal"> </span><span class="symbol">*</span><span class="normal"> </span><span class="symbol">(</span><span class="normal">a</span><span class="symbol">)</span><span class="normal"> </span><span class="symbol">/</span><span class="normal"> </span><span class="number">0xff</span><span class="symbol">)</span>
<span class="preproc">#else</span>
<span class="preproc">#define</span><span class="normal"> </span><span class="function">wxPy_premultiply</span><span class="symbol">(</span><span class="normal">p</span><span class="symbol">,</span><span class="normal"> a</span><span class="symbol">)</span><span class="normal">   </span><span class="symbol">(</span><span class="normal">p</span><span class="symbol">)</span>
<span class="preproc">#endif</span>

<span class="type">void</span><span class="normal"> SurfaceImpl</span><span class="symbol">::</span><span class="function">AlphaRectangle</span><span class="symbol">(</span><span class="usertype">PRectangle</span><span class="normal"> rc</span><span class="symbol">,</span><span class="normal"> </span><span class="type">int</span><span class="normal"> cornerSize</span><span class="symbol">,</span>
<span class="normal">                                 </span><span class="usertype">ColourAllocated</span><span class="normal"> fill</span><span class="symbol">,</span><span class="normal"> </span><span class="type">int</span><span class="normal"> alphaFill</span><span class="symbol">,</span>
<span class="normal">                                 </span><span class="usertype">ColourAllocated</span><span class="normal"> outline</span><span class="symbol">,</span><span class="normal"> </span><span class="type">int</span><span class="normal"> alphaOutline</span><span class="symbol">,</span>
<span class="normal">                                 </span><span class="type">int</span><span class="normal"> </span><span class="comment">/*flags*/</span><span class="symbol">)</span><span class="normal"> </span><span class="cbracket">{</span>
<span class="preproc">#ifdef</span><span class="normal"> wxHAVE_RAW_BITMAP</span>

<span class="normal">    </span><span class="comment">// TODO:  do something with cornerSize</span>
<span class="normal">    </span><span class="function">wxUnusedVar</span><span class="symbol">(</span><span class="normal">cornerSize</span><span class="symbol">);</span>
<span class="normal">    </span>
<span class="normal">    </span><span class="type">int</span><span class="normal"> x</span><span class="symbol">,</span><span class="normal"> y</span><span class="symbol">;</span>
<span class="normal">    </span><span class="usertype">wxRect</span><span class="normal"> r </span><span class="symbol">=</span><span class="normal"> </span><span class="function">wxRectFromPRectangle</span><span class="symbol">(</span><span class="normal">rc</span><span class="symbol">);</span>
<span class="normal">    </span><span class="usertype">wxBitmap</span><span class="normal"> </span><span class="function">bmp</span><span class="symbol">(</span><span class="normal">r</span><span class="symbol">.</span><span class="normal">width</span><span class="symbol">,</span><span class="normal"> r</span><span class="symbol">.</span><span class="normal">height</span><span class="symbol">,</span><span class="normal"> </span><span class="number">32</span><span class="symbol">);</span>
<span class="normal">    </span><span class="usertype">wxAlphaPixelData</span><span class="normal"> </span><span class="function">pixData</span><span class="symbol">(</span><span class="normal">bmp</span><span class="symbol">);</span>
<span class="normal">    pixData</span><span class="symbol">.</span><span class="function">UseAlpha</span><span class="symbol">();</span>

<span class="normal">    </span><span class="comment">// Set the fill pixels</span>
<span class="normal">    </span><span class="usertype">ColourDesired</span><span class="normal"> </span><span class="function">cdf</span><span class="symbol">(</span><span class="normal">fill</span><span class="symbol">.</span><span class="function">AsLong</span><span class="symbol">());</span>
<span class="normal">    </span><span class="type">int</span><span class="normal"> red   </span><span class="symbol">=</span><span class="normal"> cdf</span><span class="symbol">.</span><span class="function">GetRed</span><span class="symbol">();</span>
<span class="normal">    </span><span class="type">int</span><span class="normal"> green </span><span class="symbol">=</span><span class="normal"> cdf</span><span class="symbol">.</span><span class="function">GetGreen</span><span class="symbol">();</span>
<span class="normal">    </span><span class="type">int</span><span class="normal"> blue  </span><span class="symbol">=</span><span class="normal"> cdf</span><span class="symbol">.</span><span class="function">GetBlue</span><span class="symbol">();</span>

<span class="normal">    wxAlphaPixelData</span><span class="symbol">::</span><span class="usertype">Iterator</span><span class="normal"> </span><span class="function">p</span><span class="symbol">(</span><span class="normal">pixData</span><span class="symbol">);</span>
<span class="normal">    </span><span class="keyword">for</span><span class="normal"> </span><span class="symbol">(</span><span class="normal">y</span><span class="symbol">=</span><span class="number">0</span><span class="symbol">;</span><span class="normal"> y</span><span class="symbol">&lt;</span><span class="normal">r</span><span class="symbol">.</span><span class="normal">height</span><span class="symbol">;</span><span class="normal"> y</span><span class="symbol">++)</span><span class="normal"> </span><span class="cbracket">{</span>
<span class="normal">        p</span><span class="symbol">.</span><span class="function">MoveTo</span><span class="symbol">(</span><span class="normal">pixData</span><span class="symbol">,</span><span class="normal"> </span><span class="number">0</span><span class="symbol">,</span><span class="normal"> y</span><span class="symbol">);</span>
<span class="normal">        </span><span class="keyword">for</span><span class="normal"> </span><span class="symbol">(</span><span class="normal">x</span><span class="symbol">=</span><span class="number">0</span><span class="symbol">;</span><span class="normal"> x</span><span class="symbol">&lt;</span><span class="normal">r</span><span class="symbol">.</span><span class="normal">width</span><span class="symbol">;</span><span class="normal"> x</span><span class="symbol">++)</span><span class="normal"> </span><span class="cbracket">{</span>
<span class="normal">            p</span><span class="symbol">.</span><span class="function">Red</span><span class="symbol">()</span><span class="normal">   </span><span class="symbol">=</span><span class="normal"> </span><span class="function">wxPy_premultiply</span><span class="symbol">(</span><span class="normal">red</span><span class="symbol">,</span><span class="normal">   alphaFill</span><span class="symbol">);</span>
<span class="normal">            p</span><span class="symbol">.</span><span class="function">Green</span><span class="symbol">()</span><span class="normal"> </span><span class="symbol">=</span><span class="normal"> </span><span class="function">wxPy_premultiply</span><span class="symbol">(</span><span class="normal">green</span><span class="symbol">,</span><span class="normal"> alphaFill</span><span class="symbol">);</span>
<span class="normal">            p</span><span class="symbol">.</span><span class="function">Blue</span><span class="symbol">()</span><span class="normal">  </span><span class="symbol">=</span><span class="normal"> </span><span class="function">wxPy_premultiply</span><span class="symbol">(</span><span class="normal">blue</span><span class="symbol">,</span><span class="normal">  alphaFill</span><span class="symbol">);</span>
<span class="normal">            p</span><span class="symbol">.</span><span class="function">Alpha</span><span class="symbol">()</span><span class="normal"> </span><span class="symbol">=</span><span class="normal"> alphaFill</span><span class="symbol">;</span>
<span class="normal">            </span><span class="symbol">++</span><span class="normal">p</span><span class="symbol">;</span><span class="normal"> </span>
<span class="normal">        </span><span class="cbracket">}</span>
<span class="normal">    </span><span class="cbracket">}</span>

<span class="normal">    </span><span class="comment">// Set the outline pixels</span>
<span class="normal">    </span><span class="usertype">ColourDesired</span><span class="normal"> </span><span class="function">cdo</span><span class="symbol">(</span><span class="normal">outline</span><span class="symbol">.</span><span class="function">AsLong</span><span class="symbol">());</span>
<span class="normal">    red   </span><span class="symbol">=</span><span class="normal"> cdo</span><span class="symbol">.</span><span class="function">GetRed</span><span class="symbol">();</span>
<span class="normal">    green </span><span class="symbol">=</span><span class="normal"> cdo</span><span class="symbol">.</span><span class="function">GetGreen</span><span class="symbol">();</span>
<span class="normal">    blue  </span><span class="symbol">=</span><span class="normal"> cdo</span><span class="symbol">.</span><span class="function">GetBlue</span><span class="symbol">();</span>
<span class="normal">    </span><span class="keyword">for</span><span class="normal"> </span><span class="symbol">(</span><span class="normal">x</span><span class="symbol">=</span><span class="number">0</span><span class="symbol">;</span><span class="normal"> x</span><span class="symbol">&lt;</span><span class="normal">r</span><span class="symbol">.</span><span class="normal">width</span><span class="symbol">;</span><span class="normal"> x</span><span class="symbol">++)</span><span class="normal"> </span><span class="cbracket">{</span>
<span class="normal">        p</span><span class="symbol">.</span><span class="function">MoveTo</span><span class="symbol">(</span><span class="normal">pixData</span><span class="symbol">,</span><span class="normal"> x</span><span class="symbol">,</span><span class="normal"> </span><span class="number">0</span><span class="symbol">);</span>
<span class="normal">        p</span><span class="symbol">.</span><span class="function">Red</span><span class="symbol">()</span><span class="normal">   </span><span class="symbol">=</span><span class="normal"> </span><span class="function">wxPy_premultiply</span><span class="symbol">(</span><span class="normal">red</span><span class="symbol">,</span><span class="normal">   alphaOutline</span><span class="symbol">);</span>
<span class="normal">        p</span><span class="symbol">.</span><span class="function">Green</span><span class="symbol">()</span><span class="normal"> </span><span class="symbol">=</span><span class="normal"> </span><span class="function">wxPy_premultiply</span><span class="symbol">(</span><span class="normal">green</span><span class="symbol">,</span><span class="normal"> alphaOutline</span><span class="symbol">);</span>
<span class="normal">        p</span><span class="symbol">.</span><span class="function">Blue</span><span class="symbol">()</span><span class="normal">  </span><span class="symbol">=</span><span class="normal"> </span><span class="function">wxPy_premultiply</span><span class="symbol">(</span><span class="normal">blue</span><span class="symbol">,</span><span class="normal">  alphaOutline</span><span class="symbol">);</span>
<span class="normal">        p</span><span class="symbol">.</span><span class="function">Alpha</span><span class="symbol">()</span><span class="normal"> </span><span class="symbol">=</span><span class="normal"> alphaOutline</span><span class="symbol">;</span><span class="normal">        </span>
<span class="normal">        p</span><span class="symbol">.</span><span class="function">MoveTo</span><span class="symbol">(</span><span class="normal">pixData</span><span class="symbol">,</span><span class="normal"> x</span><span class="symbol">,</span><span class="normal"> r</span><span class="symbol">.</span><span class="normal">height</span><span class="symbol">-</span><span class="number">1</span><span class="symbol">);</span>
<span class="normal">        p</span><span class="symbol">.</span><span class="function">Red</span><span class="symbol">()</span><span class="normal">   </span><span class="symbol">=</span><span class="normal"> </span><span class="function">wxPy_premultiply</span><span class="symbol">(</span><span class="normal">red</span><span class="symbol">,</span><span class="normal">   alphaOutline</span><span class="symbol">);</span>
<span class="normal">        p</span><span class="symbol">.</span><span class="function">Green</span><span class="symbol">()</span><span class="normal"> </span><span class="symbol">=</span><span class="normal"> </span><span class="function">wxPy_premultiply</span><span class="symbol">(</span><span class="normal">green</span><span class="symbol">,</span><span class="normal"> alphaOutline</span><span class="symbol">);</span>
<span class="normal">        p</span><span class="symbol">.</span><span class="function">Blue</span><span class="symbol">()</span><span class="normal">  </span><span class="symbol">=</span><span class="normal"> </span><span class="function">wxPy_premultiply</span><span class="symbol">(</span><span class="normal">blue</span><span class="symbol">,</span><span class="normal">  alphaOutline</span><span class="symbol">);</span>
<span class="normal">        p</span><span class="symbol">.</span><span class="function">Alpha</span><span class="symbol">()</span><span class="normal"> </span><span class="symbol">=</span><span class="normal"> alphaOutline</span><span class="symbol">;</span><span class="normal">        </span>
<span class="normal">    </span><span class="cbracket">}</span>

<span class="normal">    </span><span class="keyword">for</span><span class="normal"> </span><span class="symbol">(</span><span class="normal">y</span><span class="symbol">=</span><span class="number">0</span><span class="symbol">;</span><span class="normal"> y</span><span class="symbol">&lt;</span><span class="normal">r</span><span class="symbol">.</span><span class="normal">height</span><span class="symbol">;</span><span class="normal"> y</span><span class="symbol">++)</span><span class="normal"> </span><span class="cbracket">{</span>
<span class="normal">        p</span><span class="symbol">.</span><span class="function">MoveTo</span><span class="symbol">(</span><span class="normal">pixData</span><span class="symbol">,</span><span class="normal"> </span><span class="number">0</span><span class="symbol">,</span><span class="normal"> y</span><span class="symbol">);</span>
<span class="normal">        p</span><span class="symbol">.</span><span class="function">Red</span><span class="symbol">()</span><span class="normal">   </span><span class="symbol">=</span><span class="normal"> </span><span class="function">wxPy_premultiply</span><span class="symbol">(</span><span class="normal">red</span><span class="symbol">,</span><span class="normal">   alphaOutline</span><span class="symbol">);</span>
<span class="normal">        p</span><span class="symbol">.</span><span class="function">Green</span><span class="symbol">()</span><span class="normal"> </span><span class="symbol">=</span><span class="normal"> </span><span class="function">wxPy_premultiply</span><span class="symbol">(</span><span class="normal">green</span><span class="symbol">,</span><span class="normal"> alphaOutline</span><span class="symbol">);</span>
<span class="normal">        p</span><span class="symbol">.</span><span class="function">Blue</span><span class="symbol">()</span><span class="normal">  </span><span class="symbol">=</span><span class="normal"> </span><span class="function">wxPy_premultiply</span><span class="symbol">(</span><span class="normal">blue</span><span class="symbol">,</span><span class="normal">  alphaOutline</span><span class="symbol">);</span>
<span class="normal">        p</span><span class="symbol">.</span><span class="function">Alpha</span><span class="symbol">()</span><span class="normal"> </span><span class="symbol">=</span><span class="normal"> alphaOutline</span><span class="symbol">;</span><span class="normal">        </span>
<span class="normal">        p</span><span class="symbol">.</span><span class="function">MoveTo</span><span class="symbol">(</span><span class="normal">pixData</span><span class="symbol">,</span><span class="normal"> r</span><span class="symbol">.</span><span class="normal">width</span><span class="symbol">-</span><span class="number">1</span><span class="symbol">,</span><span class="normal"> y</span><span class="symbol">);</span>
<span class="normal">        p</span><span class="symbol">.</span><span class="function">Red</span><span class="symbol">()</span><span class="normal">   </span><span class="symbol">=</span><span class="normal"> </span><span class="function">wxPy_premultiply</span><span class="symbol">(</span><span class="normal">red</span><span class="symbol">,</span><span class="normal">   alphaOutline</span><span class="symbol">);</span>
<span class="normal">        p</span><span class="symbol">.</span><span class="function">Green</span><span class="symbol">()</span><span class="normal"> </span><span class="symbol">=</span><span class="normal"> </span><span class="function">wxPy_premultiply</span><span class="symbol">(</span><span class="normal">green</span><span class="symbol">,</span><span class="normal"> alphaOutline</span><span class="symbol">);</span>
<span class="normal">        p</span><span class="symbol">.</span><span class="function">Blue</span><span class="symbol">()</span><span class="normal">  </span><span class="symbol">=</span><span class="normal"> </span><span class="function">wxPy_premultiply</span><span class="symbol">(</span><span class="normal">blue</span><span class="symbol">,</span><span class="normal">  alphaOutline</span><span class="symbol">);</span>
<span class="normal">        p</span><span class="symbol">.</span><span class="function">Alpha</span><span class="symbol">()</span><span class="normal"> </span><span class="symbol">=</span><span class="normal"> alphaOutline</span><span class="symbol">;</span><span class="normal">        </span>
<span class="normal">    </span><span class="cbracket">}</span>
<span class="normal">    </span>
<span class="normal">    </span><span class="comment">// Draw the bitmap</span>
<span class="normal">    hdc</span><span class="symbol">-&gt;</span><span class="function">DrawBitmap</span><span class="symbol">(</span><span class="normal">bmp</span><span class="symbol">,</span><span class="normal"> r</span><span class="symbol">.</span><span class="normal">x</span><span class="symbol">,</span><span class="normal"> r</span><span class="symbol">.</span><span class="normal">y</span><span class="symbol">,</span><span class="normal"> </span><span class="keyword">true</span><span class="symbol">);</span>

<span class="preproc">#else</span>
<span class="normal">    </span><span class="function">wxUnusedVar</span><span class="symbol">(</span><span class="normal">cornerSize</span><span class="symbol">);</span>
<span class="normal">    </span><span class="function">wxUnusedVar</span><span class="symbol">(</span><span class="normal">alphaFill</span><span class="symbol">);</span>
<span class="normal">    </span><span class="function">wxUnusedVar</span><span class="symbol">(</span><span class="normal">alphaOutline</span><span class="symbol">);</span>
<span class="normal">    </span><span class="function">RectangleDraw</span><span class="symbol">(</span><span class="normal">rc</span><span class="symbol">,</span><span class="normal"> outline</span><span class="symbol">,</span><span class="normal"> fill</span><span class="symbol">);</span>
<span class="preproc">#endif</span>
<span class="cbracket">}</span>

<span class="type">void</span><span class="normal"> SurfaceImpl</span><span class="symbol">::</span><span class="function">Ellipse</span><span class="symbol">(</span><span class="usertype">PRectangle</span><span class="normal"> rc</span><span class="symbol">,</span><span class="normal"> </span><span class="usertype">ColourAllocated</span><span class="normal"> fore</span><span class="symbol">,</span><span class="normal"> </span><span class="usertype">ColourAllocated</span><span class="normal"> back</span><span class="symbol">)</span><span class="normal"> </span><span class="cbracket">{</span>
<span class="normal">    </span><span class="function">PenColour</span><span class="symbol">(</span><span class="normal">fore</span><span class="symbol">);</span>
<span class="normal">    </span><span class="function">BrushColour</span><span class="symbol">(</span><span class="normal">back</span><span class="symbol">);</span>
<span class="normal">    hdc</span><span class="symbol">-&gt;</span><span class="function">DrawEllipse</span><span class="symbol">(</span><span class="function">wxRectFromPRectangle</span><span class="symbol">(</span><span class="normal">rc</span><span class="symbol">));</span>
<span class="cbracket">}</span>

<span class="type">void</span><span class="normal"> SurfaceImpl</span><span class="symbol">::</span><span class="function">Copy</span><span class="symbol">(</span><span class="usertype">PRectangle</span><span class="normal"> rc</span><span class="symbol">,</span><span class="normal"> </span><span class="usertype">Point</span><span class="normal"> from</span><span class="symbol">,</span><span class="normal"> </span><span class="usertype">Surface</span><span class="normal"> </span><span class="symbol">&amp;</span><span class="normal">surfaceSource</span><span class="symbol">)</span><span class="normal"> </span><span class="cbracket">{</span>
<span class="normal">    </span><span class="usertype">wxRect</span><span class="normal"> r </span><span class="symbol">=</span><span class="normal"> </span><span class="function">wxRectFromPRectangle</span><span class="symbol">(</span><span class="normal">rc</span><span class="symbol">);</span>
<span class="normal">    hdc</span><span class="symbol">-&gt;</span><span class="function">Blit</span><span class="symbol">(</span><span class="normal">r</span><span class="symbol">.</span><span class="normal">x</span><span class="symbol">,</span><span class="normal"> r</span><span class="symbol">.</span><span class="normal">y</span><span class="symbol">,</span><span class="normal"> r</span><span class="symbol">.</span><span class="normal">width</span><span class="symbol">,</span><span class="normal"> r</span><span class="symbol">.</span><span class="normal">height</span><span class="symbol">,</span>
<span class="normal">              </span><span class="symbol">((</span><span class="normal">SurfaceImpl</span><span class="symbol">&amp;)</span><span class="normal">surfaceSource</span><span class="symbol">).</span><span class="normal">hdc</span><span class="symbol">,</span>
<span class="normal">              from</span><span class="symbol">.</span><span class="normal">x</span><span class="symbol">,</span><span class="normal"> from</span><span class="symbol">.</span><span class="normal">y</span><span class="symbol">,</span><span class="normal"> wxCOPY</span><span class="symbol">);</span>
<span class="cbracket">}</span>

<span class="type">void</span><span class="normal"> SurfaceImpl</span><span class="symbol">::</span><span class="function">DrawTextNoClip</span><span class="symbol">(</span><span class="usertype">PRectangle</span><span class="normal"> rc</span><span class="symbol">,</span><span class="normal"> </span><span class="usertype">Font</span><span class="normal"> </span><span class="symbol">&amp;</span><span class="normal">font</span><span class="symbol">,</span><span class="normal"> </span><span class="type">int</span><span class="normal"> ybase</span><span class="symbol">,</span>
<span class="normal">                                 </span><span class="keyword">const</span><span class="normal"> </span><span class="type">char</span><span class="normal"> </span><span class="symbol">*</span><span class="normal">s</span><span class="symbol">,</span><span class="normal"> </span><span class="type">int</span><span class="normal"> len</span><span class="symbol">,</span>
<span class="normal">                                 </span><span class="usertype">ColourAllocated</span><span class="normal"> fore</span><span class="symbol">,</span><span class="normal"> </span><span class="usertype">ColourAllocated</span><span class="normal"> back</span><span class="symbol">)</span><span class="normal"> </span><span class="cbracket">{</span>
<span class="normal">    </span><span class="function">SetFont</span><span class="symbol">(</span><span class="normal">font</span><span class="symbol">);</span>
<span class="normal">    hdc</span><span class="symbol">-&gt;</span><span class="function">SetTextForeground</span><span class="symbol">(</span><span class="function">wxColourFromCA</span><span class="symbol">(</span><span class="normal">fore</span><span class="symbol">));</span>
<span class="normal">    hdc</span><span class="symbol">-&gt;</span><span class="function">SetTextBackground</span><span class="symbol">(</span><span class="function">wxColourFromCA</span><span class="symbol">(</span><span class="normal">back</span><span class="symbol">));</span>
<span class="normal">    </span><span class="function">FillRectangle</span><span class="symbol">(</span><span class="normal">rc</span><span class="symbol">,</span><span class="normal"> back</span><span class="symbol">);</span>

<span class="normal">    </span><span class="comment">// ybase is where the baseline should be, but wxWin uses the upper left</span>
<span class="normal">    </span><span class="comment">// corner, so I need to calculate the real position for the text...</span>
<span class="normal">    hdc</span><span class="symbol">-&gt;</span><span class="function">DrawText</span><span class="symbol">(</span><span class="function">stc2wx</span><span class="symbol">(</span><span class="normal">s</span><span class="symbol">,</span><span class="normal"> len</span><span class="symbol">),</span><span class="normal"> rc</span><span class="symbol">.</span><span class="normal">left</span><span class="symbol">,</span><span class="normal"> ybase </span><span class="symbol">-</span><span class="normal"> font</span><span class="symbol">.</span><span class="normal">ascent</span><span class="symbol">);</span>
<span class="cbracket">}</span>

<span class="type">void</span><span class="normal"> SurfaceImpl</span><span class="symbol">::</span><span class="function">DrawTextClipped</span><span class="symbol">(</span><span class="usertype">PRectangle</span><span class="normal"> rc</span><span class="symbol">,</span><span class="normal"> </span><span class="usertype">Font</span><span class="normal"> </span><span class="symbol">&amp;</span><span class="normal">font</span><span class="symbol">,</span><span class="normal"> </span><span class="type">int</span><span class="normal"> ybase</span><span class="symbol">,</span>
<span class="normal">                                  </span><span class="keyword">const</span><span class="normal"> </span><span class="type">char</span><span class="normal"> </span><span class="symbol">*</span><span class="normal">s</span><span class="symbol">,</span><span class="normal"> </span><span class="type">int</span><span class="normal"> len</span><span class="symbol">,</span>
<span class="normal">                                  </span><span class="usertype">ColourAllocated</span><span class="normal"> fore</span><span class="symbol">,</span><span class="normal"> </span><span class="usertype">ColourAllocated</span><span class="normal"> back</span><span class="symbol">)</span><span class="normal"> </span><span class="cbracket">{</span>
<span class="normal">    </span><span class="function">SetFont</span><span class="symbol">(</span><span class="normal">font</span><span class="symbol">);</span>
<span class="normal">    hdc</span><span class="symbol">-&gt;</span><span class="function">SetTextForeground</span><span class="symbol">(</span><span class="function">wxColourFromCA</span><span class="symbol">(</span><span class="normal">fore</span><span class="symbol">));</span>
<span class="normal">    hdc</span><span class="symbol">-&gt;</span><span class="function">SetTextBackground</span><span class="symbol">(</span><span class="function">wxColourFromCA</span><span class="symbol">(</span><span class="normal">back</span><span class="symbol">));</span>
<span class="normal">    </span><span class="function">FillRectangle</span><span class="symbol">(</span><span class="normal">rc</span><span class="symbol">,</span><span class="normal"> back</span><span class="symbol">);</span>
<span class="normal">    hdc</span><span class="symbol">-&gt;</span><span class="function">SetClippingRegion</span><span class="symbol">(</span><span class="function">wxRectFromPRectangle</span><span class="symbol">(</span><span class="normal">rc</span><span class="symbol">));</span>

<span class="normal">    </span><span class="comment">// see comments above</span>
<span class="normal">    hdc</span><span class="symbol">-&gt;</span><span class="function">DrawText</span><span class="symbol">(</span><span class="function">stc2wx</span><span class="symbol">(</span><span class="normal">s</span><span class="symbol">,</span><span class="normal"> len</span><span class="symbol">),</span><span class="normal"> rc</span><span class="symbol">.</span><span class="normal">left</span><span class="symbol">,</span><span class="normal"> ybase </span><span class="symbol">-</span><span class="normal"> font</span><span class="symbol">.</span><span class="normal">ascent</span><span class="symbol">);</span>
<span class="normal">    hdc</span><span class="symbol">-&gt;</span><span class="function">DestroyClippingRegion</span><span class="symbol">();</span>
<span class="cbracket">}</span>


<span class="type">void</span><span class="normal"> SurfaceImpl</span><span class="symbol">::</span><span class="function">DrawTextTransparent</span><span class="symbol">(</span><span class="usertype">PRectangle</span><span class="normal"> rc</span><span class="symbol">,</span><span class="normal"> </span><span class="usertype">Font</span><span class="normal"> </span><span class="symbol">&amp;</span><span class="normal">font</span><span class="symbol">,</span><span class="normal"> </span><span class="type">int</span><span class="normal"> ybase</span><span class="symbol">,</span>
<span class="normal">                                      </span><span class="keyword">const</span><span class="normal"> </span><span class="type">char</span><span class="normal"> </span><span class="symbol">*</span><span class="normal">s</span><span class="symbol">,</span><span class="normal"> </span><span class="type">int</span><span class="normal"> len</span><span class="symbol">,</span>
<span class="normal">                                      </span><span class="usertype">ColourAllocated</span><span class="normal"> fore</span><span class="symbol">)</span><span class="normal"> </span><span class="cbracket">{</span>

<span class="normal">    </span><span class="function">SetFont</span><span class="symbol">(</span><span class="normal">font</span><span class="symbol">);</span>
<span class="normal">    hdc</span><span class="symbol">-&gt;</span><span class="function">SetTextForeground</span><span class="symbol">(</span><span class="function">wxColourFromCA</span><span class="symbol">(</span><span class="normal">fore</span><span class="symbol">));</span>
<span class="normal">    hdc</span><span class="symbol">-&gt;</span><span class="function">SetBackgroundMode</span><span class="symbol">(</span><span class="normal">wxTRANSPARENT</span><span class="symbol">);</span>

<span class="normal">    </span><span class="comment">// ybase is where the baseline should be, but wxWin uses the upper left</span>
<span class="normal">    </span><span class="comment">// corner, so I need to calculate the real position for the text...</span>
<span class="normal">    hdc</span><span class="symbol">-&gt;</span><span class="function">DrawText</span><span class="symbol">(</span><span class="function">stc2wx</span><span class="symbol">(</span><span class="normal">s</span><span class="symbol">,</span><span class="normal"> len</span><span class="symbol">),</span><span class="normal"> rc</span><span class="symbol">.</span><span class="normal">left</span><span class="symbol">,</span><span class="normal"> ybase </span><span class="symbol">-</span><span class="normal"> font</span><span class="symbol">.</span><span class="normal">ascent</span><span class="symbol">);</span>

<span class="normal">    hdc</span><span class="symbol">-&gt;</span><span class="function">SetBackgroundMode</span><span class="symbol">(</span><span class="normal">wxSOLID</span><span class="symbol">);</span>
<span class="cbracket">}</span>


<span class="type">void</span><span class="normal"> SurfaceImpl</span><span class="symbol">::</span><span class="function">MeasureWidths</span><span class="symbol">(</span><span class="usertype">Font</span><span class="normal"> </span><span class="symbol">&amp;</span><span class="normal">font</span><span class="symbol">,</span><span class="normal"> </span><span class="keyword">const</span><span class="normal"> </span><span class="type">char</span><span class="normal"> </span><span class="symbol">*</span><span class="normal">s</span><span class="symbol">,</span><span class="normal"> </span><span class="type">int</span><span class="normal"> len</span><span class="symbol">,</span><span class="normal"> </span><span class="type">int</span><span class="normal"> </span><span class="symbol">*</span><span class="normal">positions</span><span class="symbol">)</span><span class="normal"> </span><span class="cbracket">{</span>

<span class="normal">    </span><span class="usertype">wxString</span><span class="normal">   str </span><span class="symbol">=</span><span class="normal"> </span><span class="function">stc2wx</span><span class="symbol">(</span><span class="normal">s</span><span class="symbol">,</span><span class="normal"> len</span><span class="symbol">);</span>
<span class="normal">    </span><span class="usertype">wxArrayInt</span><span class="normal"> tpos</span><span class="symbol">;</span>

<span class="normal">    </span><span class="function">SetFont</span><span class="symbol">(</span><span class="normal">font</span><span class="symbol">);</span>

<span class="normal">    hdc</span><span class="symbol">-&gt;</span><span class="function">GetPartialTextExtents</span><span class="symbol">(</span><span class="normal">str</span><span class="symbol">,</span><span class="normal"> tpos</span><span class="symbol">);</span>

<span class="preproc">#if</span><span class="normal"> wxUSE_UNICODE</span>
<span class="normal">    </span><span class="comment">// Map the widths for UCS-2 characters back to the UTF-8 input string</span>
<span class="normal">    </span><span class="comment">// NOTE:  I don't think this is right for when sizeof(wxChar) &gt; 2, ie wxGTK2</span>
<span class="normal">    </span><span class="comment">// so figure it out and fix it!</span>
<span class="normal">    </span><span class="usertype">size_t</span><span class="normal"> i </span><span class="symbol">=</span><span class="normal"> </span><span class="number">0</span><span class="symbol">;</span>
<span class="normal">    </span><span class="usertype">size_t</span><span class="normal"> ui </span><span class="symbol">=</span><span class="normal"> </span><span class="number">0</span><span class="symbol">;</span>
<span class="normal">    </span><span class="keyword">while</span><span class="normal"> </span><span class="symbol">((</span><span class="type">int</span><span class="symbol">)</span><span class="normal">i </span><span class="symbol">&lt;</span><span class="normal"> len</span><span class="symbol">)</span><span class="normal"> </span><span class="cbracket">{</span>
<span class="normal">        </span><span class="type">unsigned</span><span class="normal"> </span><span class="type">char</span><span class="normal"> uch </span><span class="symbol">=</span><span class="normal"> </span><span class="symbol">(</span><span class="type">unsigned</span><span class="normal"> </span><span class="type">char</span><span class="symbol">)</span><span class="normal">s</span><span class="symbol">[</span><span class="normal">i</span><span class="symbol">];</span>
<span class="normal">        positions</span><span class="symbol">[</span><span class="normal">i</span><span class="symbol">++]</span><span class="normal"> </span><span class="symbol">=</span><span class="normal"> tpos</span><span class="symbol">[</span><span class="normal">ui</span><span class="symbol">];</span>
<span class="normal">        </span><span class="keyword">if</span><span class="normal"> </span><span class="symbol">(</span><span class="normal">uch </span><span class="symbol">&gt;=</span><span class="normal"> </span><span class="number">0x80</span><span class="symbol">)</span><span class="normal"> </span><span class="cbracket">{</span>
<span class="normal">            </span><span class="keyword">if</span><span class="normal"> </span><span class="symbol">(</span><span class="normal">uch </span><span class="symbol">&lt;</span><span class="normal"> </span><span class="symbol">(</span><span class="number">0x80</span><span class="normal"> </span><span class="symbol">+</span><span class="normal"> </span><span class="number">0x40</span><span class="normal"> </span><span class="symbol">+</span><span class="normal"> </span><span class="number">0x20</span><span class="symbol">))</span><span class="normal"> </span><span class="cbracket">{</span>
<span class="normal">                positions</span><span class="symbol">[</span><span class="normal">i</span><span class="symbol">++]</span><span class="normal"> </span><span class="symbol">=</span><span class="normal"> tpos</span><span class="symbol">[</span><span class="normal">ui</span><span class="symbol">];</span>
<span class="normal">            </span><span class="cbracket">}</span><span class="normal"> </span><span class="keyword">else</span><span class="normal"> </span><span class="cbracket">{</span>
<span class="normal">                positions</span><span class="symbol">[</span><span class="normal">i</span><span class="symbol">++]</span><span class="normal"> </span><span class="symbol">=</span><span class="normal"> tpos</span><span class="symbol">[</span><span class="normal">ui</span><span class="symbol">];</span>
<span class="normal">                positions</span><span class="symbol">[</span><span class="normal">i</span><span class="symbol">++]</span><span class="normal"> </span><span class="symbol">=</span><span class="normal"> tpos</span><span class="symbol">[</span><span class="normal">ui</span><span class="symbol">];</span>
<span class="normal">            </span><span class="cbracket">}</span>
<span class="normal">        </span><span class="cbracket">}</span>
<span class="normal">        ui</span><span class="symbol">++;</span>
<span class="normal">    </span><span class="cbracket">}</span>
<span class="preproc">#else</span>

<span class="normal">    </span><span class="comment">// If not unicode then just use the widths we have</span>
<span class="preproc">#if</span><span class="normal"> wxUSE_STL</span>
<span class="normal">    std</span><span class="symbol">::</span><span class="function">copy</span><span class="symbol">(</span><span class="normal">tpos</span><span class="symbol">.</span><span class="function">begin</span><span class="symbol">(),</span><span class="normal"> tpos</span><span class="symbol">.</span><span class="function">end</span><span class="symbol">(),</span><span class="normal"> positions</span><span class="symbol">);</span>
<span class="preproc">#else</span>
<span class="normal">    </span><span class="function">memcpy</span><span class="symbol">(</span><span class="normal">positions</span><span class="symbol">,</span><span class="normal"> tpos</span><span class="symbol">.</span><span class="function">begin</span><span class="symbol">(),</span><span class="normal"> len </span><span class="symbol">*</span><span class="normal"> </span><span class="keyword">sizeof</span><span class="symbol">(</span><span class="type">int</span><span class="symbol">));</span>
<span class="preproc">#endif</span>
<span class="preproc">#endif</span>
<span class="cbracket">}</span>


<span class="type">int</span><span class="normal"> SurfaceImpl</span><span class="symbol">::</span><span class="function">WidthText</span><span class="symbol">(</span><span class="usertype">Font</span><span class="normal"> </span><span class="symbol">&amp;</span><span class="normal">font</span><span class="symbol">,</span><span class="normal"> </span><span class="keyword">const</span><span class="normal"> </span><span class="type">char</span><span class="normal"> </span><span class="symbol">*</span><span class="normal">s</span><span class="symbol">,</span><span class="normal"> </span><span class="type">int</span><span class="normal"> len</span><span class="symbol">)</span><span class="normal"> </span><span class="cbracket">{</span>
<span class="normal">    </span><span class="function">SetFont</span><span class="symbol">(</span><span class="normal">font</span><span class="symbol">);</span>
<span class="normal">    </span><span class="type">int</span><span class="normal"> w</span><span class="symbol">;</span>
<span class="normal">    </span><span class="type">int</span><span class="normal"> h</span><span class="symbol">;</span>

<span class="normal">    hdc</span><span class="symbol">-&gt;</span><span class="function">GetTextExtent</span><span class="symbol">(</span><span class="function">stc2wx</span><span class="symbol">(</span><span class="normal">s</span><span class="symbol">,</span><span class="normal"> len</span><span class="symbol">),</span><span class="normal"> </span><span class="symbol">&amp;</span><span class="normal">w</span><span class="symbol">,</span><span class="normal"> </span><span class="symbol">&amp;</span><span class="normal">h</span><span class="symbol">);</span>
<span class="normal">    </span><span class="keyword">return</span><span class="normal"> w</span><span class="symbol">;</span>
<span class="cbracket">}</span>


<span class="type">int</span><span class="normal"> SurfaceImpl</span><span class="symbol">::</span><span class="function">WidthChar</span><span class="symbol">(</span><span class="usertype">Font</span><span class="normal"> </span><span class="symbol">&amp;</span><span class="normal">font</span><span class="symbol">,</span><span class="normal"> </span><span class="type">char</span><span class="normal"> ch</span><span class="symbol">)</span><span class="normal"> </span><span class="cbracket">{</span>
<span class="normal">    </span><span class="function">SetFont</span><span class="symbol">(</span><span class="normal">font</span><span class="symbol">);</span>
<span class="normal">    </span><span class="type">int</span><span class="normal"> w</span><span class="symbol">;</span>
<span class="normal">    </span><span class="type">int</span><span class="normal"> h</span><span class="symbol">;</span>
<span class="normal">    </span><span class="type">char</span><span class="normal"> s</span><span class="symbol">[</span><span class="number">2</span><span class="symbol">]</span><span class="normal"> </span><span class="symbol">=</span><span class="normal"> </span><span class="cbracket">{</span><span class="normal"> ch</span><span class="symbol">,</span><span class="normal"> </span><span class="number">0</span><span class="normal"> </span><span class="cbracket">}</span><span class="symbol">;</span>

<span class="normal">    hdc</span><span class="symbol">-&gt;</span><span class="function">GetTextExtent</span><span class="symbol">(</span><span class="function">stc2wx</span><span class="symbol">(</span><span class="normal">s</span><span class="symbol">,</span><span class="normal"> </span><span class="number">1</span><span class="symbol">),</span><span class="normal"> </span><span class="symbol">&amp;</span><span class="normal">w</span><span class="symbol">,</span><span class="normal"> </span><span class="symbol">&amp;</span><span class="normal">h</span><span class="symbol">);</span>
<span class="normal">    </span><span class="keyword">return</span><span class="normal"> w</span><span class="symbol">;</span>
<span class="cbracket">}</span>

<span class="preproc">#define</span><span class="normal"> </span><span class="usertype">EXTENT_TEST</span><span class="normal"> </span><span class="function">wxT</span><span class="symbol">(</span><span class="string">" `~!@#$%^&amp;*()-_=+</span><span class="specialchar">\\</span><span class="string">|[]{};:</span><span class="specialchar">\"\'</span><span class="string">&lt;,&gt;.?/1234567890abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ"</span><span class="symbol">)</span>

<span class="type">int</span><span class="normal"> SurfaceImpl</span><span class="symbol">::</span><span class="function">Ascent</span><span class="symbol">(</span><span class="usertype">Font</span><span class="normal"> </span><span class="symbol">&amp;</span><span class="normal">font</span><span class="symbol">)</span><span class="normal"> </span><span class="cbracket">{</span>
<span class="normal">    </span><span class="function">SetFont</span><span class="symbol">(</span><span class="normal">font</span><span class="symbol">);</span>
<span class="normal">    </span><span class="type">int</span><span class="normal"> w</span><span class="symbol">,</span><span class="normal"> h</span><span class="symbol">,</span><span class="normal"> d</span><span class="symbol">,</span><span class="normal"> e</span><span class="symbol">;</span>
<span class="normal">    hdc</span><span class="symbol">-&gt;</span><span class="function">GetTextExtent</span><span class="symbol">(</span><span class="normal">EXTENT_TEST</span><span class="symbol">,</span><span class="normal"> </span><span class="symbol">&amp;</span><span class="normal">w</span><span class="symbol">,</span><span class="normal"> </span><span class="symbol">&amp;</span><span class="normal">h</span><span class="symbol">,</span><span class="normal"> </span><span class="symbol">&amp;</span><span class="normal">d</span><span class="symbol">,</span><span class="normal"> </span><span class="symbol">&amp;</span><span class="normal">e</span><span class="symbol">);</span>
<span class="normal">    font</span><span class="symbol">.</span><span class="normal">ascent </span><span class="symbol">=</span><span class="normal"> h </span><span class="symbol">-</span><span class="normal"> d</span><span class="symbol">;</span>
<span class="normal">    </span><span class="keyword">return</span><span class="normal"> font</span><span class="symbol">.</span><span class="normal">ascent</span><span class="symbol">;</span>
<span class="cbracket">}</span>

<span class="type">int</span><span class="normal"> SurfaceImpl</span><span class="symbol">::</span><span class="function">Descent</span><span class="symbol">(</span><span class="usertype">Font</span><span class="normal"> </span><span class="symbol">&amp;</span><span class="normal">font</span><span class="symbol">)</span><span class="normal"> </span><span class="cbracket">{</span>
<span class="normal">    </span><span class="function">SetFont</span><span class="symbol">(</span><span class="normal">font</span><span class="symbol">);</span>
<span class="normal">    </span><span class="type">int</span><span class="normal"> w</span><span class="symbol">,</span><span class="normal"> h</span><span class="symbol">,</span><span class="normal"> d</span><span class="symbol">,</span><span class="normal"> e</span><span class="symbol">;</span>
<span class="normal">    hdc</span><span class="symbol">-&gt;</span><span class="function">GetTextExtent</span><span class="symbol">(</span><span class="normal">EXTENT_TEST</span><span class="symbol">,</span><span class="normal"> </span><span class="symbol">&amp;</span><span class="normal">w</span><span class="symbol">,</span><span class="normal"> </span><span class="symbol">&amp;</span><span class="normal">h</span><span class="symbol">,</span><span class="normal"> </span><span class="symbol">&amp;</span><span class="normal">d</span><span class="symbol">,</span><span class="normal"> </span><span class="symbol">&amp;</span><span class="normal">e</span><span class="symbol">);</span>
<span class="normal">    </span><span class="keyword">return</span><span class="normal"> d</span><span class="symbol">;</span>
<span class="cbracket">}</span>

<span class="type">int</span><span class="normal"> SurfaceImpl</span><span class="symbol">::</span><span class="function">InternalLeading</span><span class="symbol">(</span><span class="usertype">Font</span><span class="normal"> </span><span class="symbol">&amp;</span><span class="function">WXUNUSED</span><span class="symbol">(</span><span class="normal">font</span><span class="symbol">))</span><span class="normal"> </span><span class="cbracket">{</span>
<span class="normal">    </span><span class="keyword">return</span><span class="normal"> </span><span class="number">0</span><span class="symbol">;</span>
<span class="cbracket">}</span>

<span class="type">int</span><span class="normal"> SurfaceImpl</span><span class="symbol">::</span><span class="function">ExternalLeading</span><span class="symbol">(</span><span class="usertype">Font</span><span class="normal"> </span><span class="symbol">&amp;</span><span class="normal">font</span><span class="symbol">)</span><span class="normal"> </span><span class="cbracket">{</span>
<span class="normal">    </span><span class="function">SetFont</span><span class="symbol">(</span><span class="normal">font</span><span class="symbol">);</span>
<span class="normal">    </span><span class="type">int</span><span class="normal"> w</span><span class="symbol">,</span><span class="normal"> h</span><span class="symbol">,</span><span class="normal"> d</span><span class="symbol">,</span><span class="normal"> e</span><span class="symbol">;</span>
<span class="normal">    hdc</span><span class="symbol">-&gt;</span><span class="function">GetTextExtent</span><span class="symbol">(</span><span class="normal">EXTENT_TEST</span><span class="symbol">,</span><span class="normal"> </span><span class="symbol">&amp;</span><span class="normal">w</span><span class="symbol">,</span><span class="normal"> </span><span class="symbol">&amp;</span><span class="normal">h</span><span class="symbol">,</span><span class="normal"> </span><span class="symbol">&amp;</span><span class="normal">d</span><span class="symbol">,</span><span class="normal"> </span><span class="symbol">&amp;</span><span class="normal">e</span><span class="symbol">);</span>
<span class="normal">    </span><span class="keyword">return</span><span class="normal"> e</span><span class="symbol">;</span>
<span class="cbracket">}</span>

<span class="type">int</span><span class="normal"> SurfaceImpl</span><span class="symbol">::</span><span class="function">Height</span><span class="symbol">(</span><span class="usertype">Font</span><span class="normal"> </span><span class="symbol">&amp;</span><span class="normal">font</span><span class="symbol">)</span><span class="normal"> </span><span class="cbracket">{</span>
<span class="normal">    </span><span class="function">SetFont</span><span class="symbol">(</span><span class="normal">font</span><span class="symbol">);</span>
<span class="normal">    </span><span class="keyword">return</span><span class="normal"> hdc</span><span class="symbol">-&gt;</span><span class="function">GetCharHeight</span><span class="symbol">()</span><span class="normal"> </span><span class="symbol">+</span><span class="normal"> </span><span class="number">1</span><span class="symbol">;</span>
<span class="cbracket">}</span>

<span class="type">int</span><span class="normal"> SurfaceImpl</span><span class="symbol">::</span><span class="function">AverageCharWidth</span><span class="symbol">(</span><span class="usertype">Font</span><span class="normal"> </span><span class="symbol">&amp;</span><span class="normal">font</span><span class="symbol">)</span><span class="normal"> </span><span class="cbracket">{</span>
<span class="normal">    </span><span class="function">SetFont</span><span class="symbol">(</span><span class="normal">font</span><span class="symbol">);</span>
<span class="normal">    </span><span class="keyword">return</span><span class="normal"> hdc</span><span class="symbol">-&gt;</span><span class="function">GetCharWidth</span><span class="symbol">();</span>
<span class="cbracket">}</span>

<span class="type">int</span><span class="normal"> SurfaceImpl</span><span class="symbol">::</span><span class="function">SetPalette</span><span class="symbol">(</span><span class="usertype">Palette</span><span class="normal"> </span><span class="symbol">*</span><span class="function">WXUNUSED</span><span class="symbol">(</span><span class="normal">pal</span><span class="symbol">),</span><span class="normal"> </span><span class="type">bool</span><span class="normal"> </span><span class="function">WXUNUSED</span><span class="symbol">(</span><span class="normal">inBackGround</span><span class="symbol">))</span><span class="normal"> </span><span class="cbracket">{</span>
<span class="normal">    </span><span class="keyword">return</span><span class="normal"> </span><span class="number">0</span><span class="symbol">;</span>
<span class="cbracket">}</span>

<span class="type">void</span><span class="normal"> SurfaceImpl</span><span class="symbol">::</span><span class="function">SetClip</span><span class="symbol">(</span><span class="usertype">PRectangle</span><span class="normal"> rc</span><span class="symbol">)</span><span class="normal"> </span><span class="cbracket">{</span>
<span class="normal">    hdc</span><span class="symbol">-&gt;</span><span class="function">SetClippingRegion</span><span class="symbol">(</span><span class="function">wxRectFromPRectangle</span><span class="symbol">(</span><span class="normal">rc</span><span class="symbol">));</span>
<span class="cbracket">}</span>

<span class="type">void</span><span class="normal"> SurfaceImpl</span><span class="symbol">::</span><span class="function">FlushCachedState</span><span class="symbol">()</span><span class="normal"> </span><span class="cbracket">{</span>
<span class="cbracket">}</span>

<span class="type">void</span><span class="normal"> SurfaceImpl</span><span class="symbol">::</span><span class="function">SetUnicodeMode</span><span class="symbol">(</span><span class="type">bool</span><span class="normal"> unicodeMode_</span><span class="symbol">)</span><span class="normal"> </span><span class="cbracket">{</span>
<span class="normal">    unicodeMode</span><span class="symbol">=</span><span class="normal">unicodeMode_</span><span class="symbol">;</span>
<span class="cbracket">}</span>

<span class="type">void</span><span class="normal"> SurfaceImpl</span><span class="symbol">::</span><span class="function">SetDBCSMode</span><span class="symbol">(</span><span class="type">int</span><span class="normal"> </span><span class="function">WXUNUSED</span><span class="symbol">(</span><span class="normal">codePage</span><span class="symbol">))</span><span class="normal"> </span><span class="cbracket">{</span>
<span class="normal">    </span><span class="comment">// dbcsMode = codePage == SC_CP_DBCS;</span>
<span class="cbracket">}</span>


<span class="usertype">Surface</span><span class="normal"> </span><span class="symbol">*</span><span class="normal">Surface</span><span class="symbol">::</span><span class="function">Allocate</span><span class="symbol">()</span><span class="normal"> </span><span class="cbracket">{</span>
<span class="normal">    </span><span class="keyword">return</span><span class="normal"> </span><span class="keyword">new</span><span class="normal"> SurfaceImpl</span><span class="symbol">;</span>
<span class="cbracket">}</span>


<span class="comment">//----------------------------------------------------------------------</span>


<span class="keyword">inline</span><span class="normal"> wxWindow</span><span class="symbol">*</span><span class="normal"> </span><span class="function">GETWIN</span><span class="symbol">(</span><span class="usertype">WindowID</span><span class="normal"> id</span><span class="symbol">)</span><span class="normal"> </span><span class="cbracket">{</span><span class="normal"> </span><span class="keyword">return</span><span class="normal"> </span><span class="symbol">(</span><span class="normal">wxWindow</span><span class="symbol">*)</span><span class="normal">id</span><span class="symbol">;</span><span class="normal"> </span><span class="cbracket">}</span>

<span class="normal">Window</span><span class="symbol">::~</span><span class="function">Window</span><span class="symbol">()</span><span class="normal"> </span><span class="cbracket">{</span>
<span class="cbracket">}</span>

<span class="type">void</span><span class="normal"> Window</span><span class="symbol">::</span><span class="function">Destroy</span><span class="symbol">()</span><span class="normal"> </span><span class="cbracket">{</span>
<span class="normal">    </span><span class="keyword">if</span><span class="normal"> </span><span class="symbol">(</span><span class="normal">wid</span><span class="symbol">)</span><span class="normal"> </span><span class="cbracket">{</span>
<span class="normal">        </span><span class="function">Show</span><span class="symbol">(</span><span class="keyword">false</span><span class="symbol">);</span>
<span class="normal">        </span><span class="function">GETWIN</span><span class="symbol">(</span><span class="normal">wid</span><span class="symbol">)-&gt;</span><span class="function">Destroy</span><span class="symbol">();</span>
<span class="normal">    </span><span class="cbracket">}</span>
<span class="normal">    wid </span><span class="symbol">=</span><span class="normal"> </span><span class="number">0</span><span class="symbol">;</span>
<span class="cbracket">}</span>

<span class="type">bool</span><span class="normal"> Window</span><span class="symbol">::</span><span class="function">HasFocus</span><span class="symbol">()</span><span class="normal"> </span><span class="cbracket">{</span>
<span class="normal">    </span><span class="keyword">return</span><span class="normal"> wxWindow</span><span class="symbol">::</span><span class="function">FindFocus</span><span class="symbol">()</span><span class="normal"> </span><span class="symbol">==</span><span class="normal"> </span><span class="function">GETWIN</span><span class="symbol">(</span><span class="normal">wid</span><span class="symbol">);</span>
<span class="cbracket">}</span>

<span class="usertype">PRectangle</span><span class="normal"> Window</span><span class="symbol">::</span><span class="function">GetPosition</span><span class="symbol">()</span><span class="normal"> </span><span class="cbracket">{</span>
<span class="normal">    </span><span class="keyword">if</span><span class="normal"> </span><span class="symbol">(!</span><span class="normal"> wid</span><span class="symbol">)</span><span class="normal"> </span><span class="keyword">return</span><span class="normal"> </span><span class="function">PRectangle</span><span class="symbol">();</span>
<span class="normal">    </span><span class="usertype">wxRect</span><span class="normal"> </span><span class="function">rc</span><span class="symbol">(</span><span class="function">GETWIN</span><span class="symbol">(</span><span class="normal">wid</span><span class="symbol">)-&gt;</span><span class="function">GetPosition</span><span class="symbol">(),</span><span class="normal"> </span><span class="function">GETWIN</span><span class="symbol">(</span><span class="normal">wid</span><span class="symbol">)-&gt;</span><span class="function">GetSize</span><span class="symbol">());</span>
<span class="normal">    </span><span class="keyword">return</span><span class="normal"> </span><span class="function">PRectangleFromwxRect</span><span class="symbol">(</span><span class="normal">rc</span><span class="symbol">);</span>
<span class="cbracket">}</span>

<span class="type">void</span><span class="normal"> Window</span><span class="symbol">::</span><span class="function">SetPosition</span><span class="symbol">(</span><span class="usertype">PRectangle</span><span class="normal"> rc</span><span class="symbol">)</span><span class="normal"> </span><span class="cbracket">{</span>
<span class="normal">    </span><span class="usertype">wxRect</span><span class="normal"> r </span><span class="symbol">=</span><span class="normal"> </span><span class="function">wxRectFromPRectangle</span><span class="symbol">(</span><span class="normal">rc</span><span class="symbol">);</span>
<span class="normal">    </span><span class="function">GETWIN</span><span class="symbol">(</span><span class="normal">wid</span><span class="symbol">)-&gt;</span><span class="function">SetSize</span><span class="symbol">(</span><span class="normal">r</span><span class="symbol">);</span>
<span class="cbracket">}</span>

<span class="type">void</span><span class="normal"> Window</span><span class="symbol">::</span><span class="function">SetPositionRelative</span><span class="symbol">(</span><span class="usertype">PRectangle</span><span class="normal"> rc</span><span class="symbol">,</span><span class="normal"> Window</span><span class="symbol">)</span><span class="normal"> </span><span class="cbracket">{</span>
<span class="normal">    </span><span class="function">SetPosition</span><span class="symbol">(</span><span class="normal">rc</span><span class="symbol">);</span><span class="normal">  </span><span class="comment">// ????</span>
<span class="cbracket">}</span>

<span class="usertype">PRectangle</span><span class="normal"> Window</span><span class="symbol">::</span><span class="function">GetClientPosition</span><span class="symbol">()</span><span class="normal"> </span><span class="cbracket">{</span>
<span class="normal">    </span><span class="keyword">if</span><span class="normal"> </span><span class="symbol">(!</span><span class="normal"> wid</span><span class="symbol">)</span><span class="normal"> </span><span class="keyword">return</span><span class="normal"> </span><span class="function">PRectangle</span><span class="symbol">();</span>
<span class="normal">    </span><span class="usertype">wxSize</span><span class="normal"> sz </span><span class="symbol">=</span><span class="normal"> </span><span class="function">GETWIN</span><span class="symbol">(</span><span class="normal">wid</span><span class="symbol">)-&gt;</span><span class="function">GetClientSize</span><span class="symbol">();</span>
<span class="normal">    </span><span class="keyword">return</span><span class="normal">  </span><span class="function">PRectangle</span><span class="symbol">(</span><span class="number">0</span><span class="symbol">,</span><span class="normal"> </span><span class="number">0</span><span class="symbol">,</span><span class="normal"> sz</span><span class="symbol">.</span><span class="normal">x</span><span class="symbol">,</span><span class="normal"> sz</span><span class="symbol">.</span><span class="normal">y</span><span class="symbol">);</span>
<span class="cbracket">}</span>

<span class="type">void</span><span class="normal"> Window</span><span class="symbol">::</span><span class="function">Show</span><span class="symbol">(</span><span class="type">bool</span><span class="normal"> show</span><span class="symbol">)</span><span class="normal"> </span><span class="cbracket">{</span>
<span class="normal">    </span><span class="function">GETWIN</span><span class="symbol">(</span><span class="normal">wid</span><span class="symbol">)-&gt;</span><span class="function">Show</span><span class="symbol">(</span><span class="normal">show</span><span class="symbol">);</span>
<span class="cbracket">}</span>

<span class="type">void</span><span class="normal"> Window</span><span class="symbol">::</span><span class="function">InvalidateAll</span><span class="symbol">()</span><span class="normal"> </span><span class="cbracket">{</span>
<span class="normal">    </span><span class="function">GETWIN</span><span class="symbol">(</span><span class="normal">wid</span><span class="symbol">)-&gt;</span><span class="function">Refresh</span><span class="symbol">(</span><span class="keyword">false</span><span class="symbol">);</span>
<span class="cbracket">}</span>

<span class="type">void</span><span class="normal"> Window</span><span class="symbol">::</span><span class="function">InvalidateRectangle</span><span class="symbol">(</span><span class="usertype">PRectangle</span><span class="normal"> rc</span><span class="symbol">)</span><span class="normal"> </span><span class="cbracket">{</span>
<span class="normal">    </span><span class="usertype">wxRect</span><span class="normal"> r </span><span class="symbol">=</span><span class="normal"> </span><span class="function">wxRectFromPRectangle</span><span class="symbol">(</span><span class="normal">rc</span><span class="symbol">);</span>
<span class="normal">    </span><span class="function">GETWIN</span><span class="symbol">(</span><span class="normal">wid</span><span class="symbol">)-&gt;</span><span class="function">Refresh</span><span class="symbol">(</span><span class="keyword">false</span><span class="symbol">,</span><span class="normal"> </span><span class="symbol">&amp;</span><span class="normal">r</span><span class="symbol">);</span>
<span class="cbracket">}</span>

<span class="type">void</span><span class="normal"> Window</span><span class="symbol">::</span><span class="function">SetFont</span><span class="symbol">(</span><span class="usertype">Font</span><span class="normal"> </span><span class="symbol">&amp;</span><span class="normal">font</span><span class="symbol">)</span><span class="normal"> </span><span class="cbracket">{</span>
<span class="normal">    </span><span class="function">GETWIN</span><span class="symbol">(</span><span class="normal">wid</span><span class="symbol">)-&gt;</span><span class="function">SetFont</span><span class="symbol">(*((</span><span class="normal">wxFont</span><span class="symbol">*)</span><span class="normal">font</span><span class="symbol">.</span><span class="function">GetID</span><span class="symbol">()));</span>
<span class="cbracket">}</span>

<span class="type">void</span><span class="normal"> Window</span><span class="symbol">::</span><span class="function">SetCursor</span><span class="symbol">(</span><span class="usertype">Cursor</span><span class="normal"> curs</span><span class="symbol">)</span><span class="normal"> </span><span class="cbracket">{</span>
<span class="normal">    </span><span class="type">int</span><span class="normal"> cursorId</span><span class="symbol">;</span>

<span class="normal">    </span><span class="keyword">switch</span><span class="normal"> </span><span class="symbol">(</span><span class="normal">curs</span><span class="symbol">)</span><span class="normal"> </span><span class="cbracket">{</span>
<span class="normal">    </span><span class="keyword">case</span><span class="normal"> cursorText</span><span class="symbol">:</span>
<span class="normal">        cursorId </span><span class="symbol">=</span><span class="normal"> wxCURSOR_IBEAM</span><span class="symbol">;</span>
<span class="normal">        </span><span class="keyword">break</span><span class="symbol">;</span>
<span class="normal">    </span><span class="keyword">case</span><span class="normal"> cursorArrow</span><span class="symbol">:</span>
<span class="normal">        cursorId </span><span class="symbol">=</span><span class="normal"> wxCURSOR_ARROW</span><span class="symbol">;</span>
<span class="normal">        </span><span class="keyword">break</span><span class="symbol">;</span>
<span class="normal">    </span><span class="keyword">case</span><span class="normal"> cursorUp</span><span class="symbol">:</span>
<span class="normal">        cursorId </span><span class="symbol">=</span><span class="normal"> wxCURSOR_ARROW</span><span class="symbol">;</span><span class="normal"> </span><span class="comment">// ** no up arrow...  wxCURSOR_UPARROW;</span>
<span class="normal">        </span><span class="keyword">break</span><span class="symbol">;</span>
<span class="normal">    </span><span class="keyword">case</span><span class="normal"> cursorWait</span><span class="symbol">:</span>
<span class="normal">        cursorId </span><span class="symbol">=</span><span class="normal"> wxCURSOR_WAIT</span><span class="symbol">;</span>
<span class="normal">        </span><span class="keyword">break</span><span class="symbol">;</span>
<span class="normal">    </span><span class="keyword">case</span><span class="normal"> cursorHoriz</span><span class="symbol">:</span>
<span class="normal">        cursorId </span><span class="symbol">=</span><span class="normal"> wxCURSOR_SIZEWE</span><span class="symbol">;</span>
<span class="normal">        </span><span class="keyword">break</span><span class="symbol">;</span>
<span class="normal">    </span><span class="keyword">case</span><span class="normal"> cursorVert</span><span class="symbol">:</span>
<span class="normal">        cursorId </span><span class="symbol">=</span><span class="normal"> wxCURSOR_SIZENS</span><span class="symbol">;</span>
<span class="normal">        </span><span class="keyword">break</span><span class="symbol">;</span>
<span class="normal">    </span><span class="keyword">case</span><span class="normal"> cursorReverseArrow</span><span class="symbol">:</span>
<span class="normal">        cursorId </span><span class="symbol">=</span><span class="normal"> wxCURSOR_RIGHT_ARROW</span><span class="symbol">;</span>
<span class="normal">        </span><span class="keyword">break</span><span class="symbol">;</span>
<span class="normal">    </span><span class="keyword">case</span><span class="normal"> cursorHand</span><span class="symbol">:</span>
<span class="normal">        cursorId </span><span class="symbol">=</span><span class="normal"> wxCURSOR_HAND</span><span class="symbol">;</span>
<span class="normal">        </span><span class="keyword">break</span><span class="symbol">;</span>
<span class="label">    default:</span>
<span class="normal">        cursorId </span><span class="symbol">=</span><span class="normal"> wxCURSOR_ARROW</span><span class="symbol">;</span>
<span class="normal">        </span><span class="keyword">break</span><span class="symbol">;</span>
<span class="normal">    </span><span class="cbracket">}</span>
<span class="preproc">#ifdef</span><span class="normal"> __WXMOTIF__</span>
<span class="normal">       </span><span class="usertype">wxCursor</span><span class="normal"> wc </span><span class="symbol">=</span><span class="normal"> </span><span class="function">wxStockCursor</span><span class="symbol">(</span><span class="normal">cursorId</span><span class="symbol">)</span><span class="normal"> </span><span class="symbol">;</span>
<span class="preproc">#else</span>
<span class="normal">       </span><span class="usertype">wxCursor</span><span class="normal"> wc </span><span class="symbol">=</span><span class="normal"> </span><span class="function">wxCursor</span><span class="symbol">(</span><span class="normal">cursorId</span><span class="symbol">)</span><span class="normal"> </span><span class="symbol">;</span>
<span class="preproc">#endif</span>
<span class="normal">       </span><span class="keyword">if</span><span class="symbol">(</span><span class="normal">curs </span><span class="symbol">!=</span><span class="normal"> cursorLast</span><span class="symbol">)</span>
<span class="normal">       </span><span class="cbracket">{</span>
<span class="normal">           </span><span class="function">GETWIN</span><span class="symbol">(</span><span class="normal">wid</span><span class="symbol">)-&gt;</span><span class="function">SetCursor</span><span class="symbol">(</span><span class="normal">wc</span><span class="symbol">);</span>
<span class="normal">           cursorLast </span><span class="symbol">=</span><span class="normal"> curs</span><span class="symbol">;</span>
<span class="normal">       </span><span class="cbracket">}</span>
<span class="cbracket">}</span>

<span class="type">void</span><span class="normal"> Window</span><span class="symbol">::</span><span class="function">SetTitle</span><span class="symbol">(</span><span class="keyword">const</span><span class="normal"> </span><span class="type">char</span><span class="normal"> </span><span class="symbol">*</span><span class="normal">s</span><span class="symbol">)</span><span class="normal"> </span><span class="cbracket">{</span>
<span class="normal">    </span><span class="function">GETWIN</span><span class="symbol">(</span><span class="normal">wid</span><span class="symbol">)-&gt;</span><span class="function">SetLabel</span><span class="symbol">(</span><span class="function">stc2wx</span><span class="symbol">(</span><span class="normal">s</span><span class="symbol">));</span>
<span class="cbracket">}</span>

<span class="comment">/* Returns rectangle of monitor pt is on, both rect and pt are in Window's</span>
<span class="comment">   gdk window coordinates */</span>
<span class="usertype">PRectangle</span><span class="normal"> Window</span><span class="symbol">::</span><span class="function">GetMonitorRect</span><span class="symbol">(</span><span class="usertype">Point</span><span class="normal"> pt</span><span class="symbol">)</span><span class="normal"> </span><span class="cbracket">{</span>
<span class="normal">    </span><span class="keyword">return</span><span class="normal"> </span><span class="function">PRectangle</span><span class="symbol">();</span>
<span class="cbracket">}</span>

<span class="comment">//----------------------------------------------------------------------</span>
<span class="comment">// Helper classes for ListBox</span>


<span class="comment">// This is a simple subclass of wxListView that just resets focus to the</span>
<span class="comment">// parent when it gets it.</span>
<span class="keyword">class</span><span class="normal"> </span><span class="classname">wxSTCListBox</span><span class="normal"> </span><span class="symbol">:</span><span class="normal"> </span><span class="keyword">public</span><span class="normal"> wxListView </span><span class="cbracket">{</span>
<span class="keyword">public</span><span class="symbol">:</span>
<span class="normal">    </span><span class="function">wxSTCListBox</span><span class="symbol">(</span><span class="normal">wxWindow</span><span class="symbol">*</span><span class="normal"> parent</span><span class="symbol">,</span><span class="normal"> </span><span class="usertype">wxWindowID</span><span class="normal"> id</span><span class="symbol">,</span>
<span class="normal">                 </span><span class="keyword">const</span><span class="normal"> wxPoint</span><span class="symbol">&amp;</span><span class="normal"> pos</span><span class="symbol">,</span><span class="normal"> </span><span class="keyword">const</span><span class="normal"> wxSize</span><span class="symbol">&amp;</span><span class="normal"> size</span><span class="symbol">,</span>
<span class="normal">                 </span><span class="type">long</span><span class="normal"> style</span><span class="symbol">)</span>
<span class="normal">        </span><span class="symbol">:</span><span class="normal"> </span><span class="function">wxListView</span><span class="symbol">()</span>
<span class="normal">    </span><span class="cbracket">{</span>
<span class="preproc">#ifdef</span><span class="normal"> __WXMSW__</span>
<span class="normal">        </span><span class="function">Hide</span><span class="symbol">();</span><span class="normal"> </span><span class="comment">// don't flicker as we move it around...</span>
<span class="preproc">#endif</span>
<span class="normal">        </span><span class="function">Create</span><span class="symbol">(</span><span class="normal">parent</span><span class="symbol">,</span><span class="normal"> id</span><span class="symbol">,</span><span class="normal"> pos</span><span class="symbol">,</span><span class="normal"> size</span><span class="symbol">,</span><span class="normal"> style</span><span class="symbol">);</span>
<span class="normal">    </span><span class="cbracket">}</span>


<span class="normal">    </span><span class="type">void</span><span class="normal"> </span><span class="function">OnFocus</span><span class="symbol">(</span><span class="normal">wxFocusEvent</span><span class="symbol">&amp;</span><span class="normal"> event</span><span class="symbol">)</span><span class="normal"> </span><span class="cbracket">{</span>
<span class="normal">        </span><span class="function">GetParent</span><span class="symbol">()-&gt;</span><span class="function">SetFocus</span><span class="symbol">();</span>
<span class="normal">        event</span><span class="symbol">.</span><span class="function">Skip</span><span class="symbol">();</span>
<span class="normal">    </span><span class="cbracket">}</span>

<span class="normal">    </span><span class="type">void</span><span class="normal"> </span><span class="function">OnKillFocus</span><span class="symbol">(</span><span class="normal">wxFocusEvent</span><span class="symbol">&amp;</span><span class="normal"> </span><span class="function">WXUNUSED</span><span class="symbol">(</span><span class="normal">event</span><span class="symbol">))</span><span class="normal"> </span><span class="cbracket">{</span>
<span class="normal">        </span><span class="comment">// Do nothing.  Prevents base class from resetting the colors...</span>
<span class="normal">    </span><span class="cbracket">}</span>

<span class="preproc">#ifdef</span><span class="normal"> __WXMAC__</span>
<span class="normal">    </span><span class="comment">// For some reason I don't understand yet the focus doesn't really leave</span>
<span class="normal">    </span><span class="comment">// the listbox like it should, so if we get any events feed them back to</span>
<span class="normal">    </span><span class="comment">// the wxSTC</span>
<span class="normal">    </span><span class="type">void</span><span class="normal"> </span><span class="function">OnKeyDown</span><span class="symbol">(</span><span class="normal">wxKeyEvent</span><span class="symbol">&amp;</span><span class="normal"> event</span><span class="symbol">)</span><span class="normal"> </span><span class="cbracket">{</span>
<span class="normal">        </span><span class="function">GetGrandParent</span><span class="symbol">()-&gt;</span><span class="function">GetEventHandler</span><span class="symbol">()-&gt;</span><span class="function">ProcessEvent</span><span class="symbol">(</span><span class="normal">event</span><span class="symbol">);</span>
<span class="normal">    </span><span class="cbracket">}</span>
<span class="normal">    </span><span class="type">void</span><span class="normal"> </span><span class="function">OnChar</span><span class="symbol">(</span><span class="normal">wxKeyEvent</span><span class="symbol">&amp;</span><span class="normal"> event</span><span class="symbol">)</span><span class="normal"> </span><span class="cbracket">{</span>
<span class="normal">        </span><span class="function">GetGrandParent</span><span class="symbol">()-&gt;</span><span class="function">GetEventHandler</span><span class="symbol">()-&gt;</span><span class="function">ProcessEvent</span><span class="symbol">(</span><span class="normal">event</span><span class="symbol">);</span>
<span class="normal">    </span><span class="cbracket">}</span>

<span class="normal">    </span><span class="comment">// And we need to force the focus back when being destroyed</span>
<span class="normal">    </span><span class="symbol">~</span><span class="function">wxSTCListBox</span><span class="symbol">()</span><span class="normal"> </span><span class="cbracket">{</span>
<span class="normal">        </span><span class="function">GetGrandParent</span><span class="symbol">()-&gt;</span><span class="function">SetFocus</span><span class="symbol">();</span>
<span class="normal">    </span><span class="cbracket">}</span>
<span class="preproc">#endif</span>

<span class="keyword">private</span><span class="symbol">:</span>
<span class="normal">    </span><span class="function">DECLARE_EVENT_TABLE</span><span class="symbol">()</span>
<span class="cbracket">}</span><span class="symbol">;</span>

<span class="function">BEGIN_EVENT_TABLE</span><span class="symbol">(</span><span class="normal">wxSTCListBox</span><span class="symbol">,</span><span class="normal"> wxListView</span><span class="symbol">)</span>
<span class="normal">    </span><span class="function">EVT_SET_FOCUS</span><span class="symbol">(</span><span class="normal"> wxSTCListBox</span><span class="symbol">::</span><span class="normal">OnFocus</span><span class="symbol">)</span>
<span class="normal">    </span><span class="function">EVT_KILL_FOCUS</span><span class="symbol">(</span><span class="normal">wxSTCListBox</span><span class="symbol">::</span><span class="normal">OnKillFocus</span><span class="symbol">)</span>
<span class="preproc">#ifdef</span><span class="normal"> __WXMAC__</span>
<span class="normal">    </span><span class="function">EVT_KEY_DOWN</span><span class="symbol">(</span><span class="normal">  wxSTCListBox</span><span class="symbol">::</span><span class="normal">OnKeyDown</span><span class="symbol">)</span>
<span class="normal">    </span><span class="function">EVT_CHAR</span><span class="symbol">(</span><span class="normal">      wxSTCListBox</span><span class="symbol">::</span><span class="normal">OnChar</span><span class="symbol">)</span>
<span class="preproc">#endif</span>
<span class="function">END_EVENT_TABLE</span><span class="symbol">()</span>



<span class="preproc">#if</span><span class="normal"> wxUSE_POPUPWIN </span><span class="comment">//-----------------------------------</span>

<span class="comment">//</span>
<span class="comment">// TODO: Refactor these two classes to have a common base (or a mix-in) to get</span>
<span class="comment">// rid of the code duplication.  (Either that or convince somebody to</span>
<span class="comment">// implement wxPopupWindow for the Mac!!)</span>
<span class="comment">//</span>
<span class="comment">// In the meantime, be careful to duplicate any changes as needed...</span>
<span class="comment">//</span>

<span class="comment">// A popup window to place the wxSTCListBox upon</span>
<span class="keyword">class</span><span class="normal"> </span><span class="classname">wxSTCListBoxWin</span><span class="normal"> </span><span class="symbol">:</span><span class="normal"> </span><span class="keyword">public</span><span class="normal"> wxPopupWindow</span>
<span class="cbracket">{</span>
<span class="keyword">private</span><span class="symbol">:</span>
<span class="normal">    wxListView</span><span class="symbol">*</span><span class="normal">         lv</span><span class="symbol">;</span>
<span class="normal">    </span><span class="usertype">CallBackAction</span><span class="normal">      doubleClickAction</span><span class="symbol">;</span>
<span class="normal">    </span><span class="type">void</span><span class="symbol">*</span><span class="normal">               doubleClickActionData</span><span class="symbol">;</span>
<span class="keyword">public</span><span class="symbol">:</span>
<span class="normal">    </span><span class="function">wxSTCListBoxWin</span><span class="symbol">(</span><span class="normal">wxWindow</span><span class="symbol">*</span><span class="normal"> parent</span><span class="symbol">,</span><span class="normal"> </span><span class="usertype">wxWindowID</span><span class="normal"> id</span><span class="symbol">,</span><span class="normal"> </span><span class="usertype">Point</span><span class="normal"> </span><span class="function">WXUNUSED</span><span class="symbol">(</span><span class="normal">location</span><span class="symbol">))</span><span class="normal"> </span><span class="symbol">:</span>
<span class="normal">        </span><span class="function">wxPopupWindow</span><span class="symbol">(</span><span class="normal">parent</span><span class="symbol">,</span><span class="normal"> wxBORDER_NONE</span><span class="symbol">)</span>
<span class="normal">    </span><span class="cbracket">{</span>
<span class="normal">        </span>
<span class="normal">        </span><span class="function">SetBackgroundColour</span><span class="symbol">(*</span><span class="normal">wxBLACK</span><span class="symbol">);</span><span class="normal">  </span><span class="comment">// for our simple border</span>

<span class="normal">        lv </span><span class="symbol">=</span><span class="normal"> </span><span class="keyword">new</span><span class="normal"> </span><span class="function">wxSTCListBox</span><span class="symbol">(</span><span class="normal">parent</span><span class="symbol">,</span><span class="normal"> id</span><span class="symbol">,</span><span class="normal"> </span><span class="function">wxPoint</span><span class="symbol">(-</span><span class="number">50</span><span class="symbol">,-</span><span class="number">50</span><span class="symbol">),</span><span class="normal"> wxDefaultSize</span><span class="symbol">,</span>
<span class="normal">                              wxLC_REPORT </span><span class="symbol">|</span><span class="normal"> wxLC_SINGLE_SEL </span><span class="symbol">|</span><span class="normal"> wxLC_NO_HEADER </span><span class="symbol">|</span><span class="normal"> wxBORDER_NONE</span><span class="symbol">);</span>
<span class="normal">        lv</span><span class="symbol">-&gt;</span><span class="function">SetCursor</span><span class="symbol">(</span><span class="function">wxCursor</span><span class="symbol">(</span><span class="normal">wxCURSOR_ARROW</span><span class="symbol">));</span>
<span class="normal">        lv</span><span class="symbol">-&gt;</span><span class="function">InsertColumn</span><span class="symbol">(</span><span class="number">0</span><span class="symbol">,</span><span class="normal"> wxEmptyString</span><span class="symbol">);</span>
<span class="normal">        lv</span><span class="symbol">-&gt;</span><span class="function">InsertColumn</span><span class="symbol">(</span><span class="number">1</span><span class="symbol">,</span><span class="normal"> wxEmptyString</span><span class="symbol">);</span>

<span class="normal">        </span><span class="comment">// NOTE: We need to fool the wxListView into thinking that it has the</span>
<span class="normal">        </span><span class="comment">// focus so it will use the normal selection colour and will look</span>
<span class="normal">        </span><span class="comment">// "right" to the user.  But since the wxPopupWindow or its children</span>
<span class="normal">        </span><span class="comment">// can't receive focus then we have to pull a fast one and temporarily</span>
<span class="normal">        </span><span class="comment">// parent the listctrl on the STC window and then call SetFocus and</span>
<span class="normal">        </span><span class="comment">// then reparent it back to the popup.</span>
<span class="normal">        lv</span><span class="symbol">-&gt;</span><span class="function">SetFocus</span><span class="symbol">();</span>
<span class="normal">        lv</span><span class="symbol">-&gt;</span><span class="function">Reparent</span><span class="symbol">(</span><span class="keyword">this</span><span class="symbol">);</span>
<span class="preproc">#ifdef</span><span class="normal"> __WXMSW__</span>
<span class="normal">        lv</span><span class="symbol">-&gt;</span><span class="function">Show</span><span class="symbol">();</span>
<span class="preproc">#endif</span>
<span class="normal">    </span><span class="cbracket">}</span>


<span class="normal">    </span><span class="comment">// Set position in client coords</span>
<span class="normal">    </span><span class="keyword">virtual</span><span class="normal"> </span><span class="type">void</span><span class="normal"> </span><span class="function">DoSetSize</span><span class="symbol">(</span><span class="type">int</span><span class="normal"> x</span><span class="symbol">,</span><span class="normal"> </span><span class="type">int</span><span class="normal"> y</span><span class="symbol">,</span>
<span class="normal">                           </span><span class="type">int</span><span class="normal"> width</span><span class="symbol">,</span><span class="normal"> </span><span class="type">int</span><span class="normal"> height</span><span class="symbol">,</span>
<span class="normal">                           </span><span class="type">int</span><span class="normal"> sizeFlags </span><span class="symbol">=</span><span class="normal"> wxSIZE_AUTO</span><span class="symbol">)</span><span class="normal"> </span><span class="cbracket">{</span>
<span class="normal">        </span><span class="keyword">if</span><span class="normal"> </span><span class="symbol">(</span><span class="normal">x </span><span class="symbol">!=</span><span class="normal"> wxDefaultCoord</span><span class="symbol">)</span><span class="normal"> </span><span class="cbracket">{</span>
<span class="normal">            </span><span class="function">GetParent</span><span class="symbol">()-&gt;</span><span class="function">ClientToScreen</span><span class="symbol">(&amp;</span><span class="normal">x</span><span class="symbol">,</span><span class="normal"> NULL</span><span class="symbol">);</span>
<span class="normal">        </span><span class="cbracket">}</span>
<span class="normal">        </span><span class="keyword">if</span><span class="normal"> </span><span class="symbol">(</span><span class="normal">y </span><span class="symbol">!=</span><span class="normal"> wxDefaultCoord</span><span class="symbol">)</span><span class="normal"> </span><span class="cbracket">{</span>
<span class="normal">            </span><span class="function">GetParent</span><span class="symbol">()-&gt;</span><span class="function">ClientToScreen</span><span class="symbol">(</span><span class="normal">NULL</span><span class="symbol">,</span><span class="normal"> </span><span class="symbol">&amp;</span><span class="normal">y</span><span class="symbol">);</span>
<span class="normal">        </span><span class="cbracket">}</span>
<span class="normal">        wxPopupWindow</span><span class="symbol">::</span><span class="function">DoSetSize</span><span class="symbol">(</span><span class="normal">x</span><span class="symbol">,</span><span class="normal"> y</span><span class="symbol">,</span><span class="normal"> width</span><span class="symbol">,</span><span class="normal"> height</span><span class="symbol">,</span><span class="normal"> sizeFlags</span><span class="symbol">);</span>
<span class="normal">    </span><span class="cbracket">}</span>

<span class="normal">    </span><span class="comment">// return position as if it were in client coords</span>
<span class="normal">    </span><span class="keyword">virtual</span><span class="normal"> </span><span class="type">void</span><span class="normal"> </span><span class="function">DoGetPosition</span><span class="symbol">(</span><span class="normal"> </span><span class="type">int</span><span class="normal"> </span><span class="symbol">*</span><span class="normal">x</span><span class="symbol">,</span><span class="normal"> </span><span class="type">int</span><span class="normal"> </span><span class="symbol">*</span><span class="normal">y </span><span class="symbol">)</span><span class="normal"> </span><span class="keyword">const</span><span class="normal"> </span><span class="cbracket">{</span>
<span class="normal">        </span><span class="type">int</span><span class="normal"> sx</span><span class="symbol">,</span><span class="normal"> sy</span><span class="symbol">;</span>
<span class="normal">        wxPopupWindow</span><span class="symbol">::</span><span class="function">DoGetPosition</span><span class="symbol">(&amp;</span><span class="normal">sx</span><span class="symbol">,</span><span class="normal"> </span><span class="symbol">&amp;</span><span class="normal">sy</span><span class="symbol">);</span>
<span class="normal">        </span><span class="function">GetParent</span><span class="symbol">()-&gt;</span><span class="function">ScreenToClient</span><span class="symbol">(&amp;</span><span class="normal">sx</span><span class="symbol">,</span><span class="normal"> </span><span class="symbol">&amp;</span><span class="normal">sy</span><span class="symbol">);</span>
<span class="normal">        </span><span class="keyword">if</span><span class="normal"> </span><span class="symbol">(</span><span class="normal">x</span><span class="symbol">)</span><span class="normal"> </span><span class="symbol">*</span><span class="normal">x </span><span class="symbol">=</span><span class="normal"> sx</span><span class="symbol">;</span>
<span class="normal">        </span><span class="keyword">if</span><span class="normal"> </span><span class="symbol">(</span><span class="normal">y</span><span class="symbol">)</span><span class="normal"> </span><span class="symbol">*</span><span class="normal">y </span><span class="symbol">=</span><span class="normal"> sy</span><span class="symbol">;</span>
<span class="normal">    </span><span class="cbracket">}</span>


<span class="normal">    </span><span class="type">bool</span><span class="normal"> </span><span class="function">Destroy</span><span class="symbol">()</span><span class="normal"> </span><span class="cbracket">{</span>
<span class="normal">        </span><span class="keyword">if</span><span class="normal"> </span><span class="symbol">(</span><span class="normal"> </span><span class="symbol">!</span><span class="normal">wxPendingDelete</span><span class="symbol">.</span><span class="function">Member</span><span class="symbol">(</span><span class="keyword">this</span><span class="symbol">)</span><span class="normal"> </span><span class="symbol">)</span>
<span class="normal">            wxPendingDelete</span><span class="symbol">.</span><span class="function">Append</span><span class="symbol">(</span><span class="keyword">this</span><span class="symbol">);</span>
<span class="normal">        </span><span class="keyword">return</span><span class="normal"> </span><span class="keyword">true</span><span class="symbol">;</span>
<span class="normal">    </span><span class="cbracket">}</span>


<span class="normal">    </span><span class="type">int</span><span class="normal"> </span><span class="function">IconWidth</span><span class="symbol">()</span><span class="normal"> </span><span class="cbracket">{</span>
<span class="normal">        wxImageList</span><span class="symbol">*</span><span class="normal"> il </span><span class="symbol">=</span><span class="normal"> lv</span><span class="symbol">-&gt;</span><span class="function">GetImageList</span><span class="symbol">(</span><span class="normal">wxIMAGE_LIST_SMALL</span><span class="symbol">);</span>
<span class="normal">        </span><span class="keyword">if</span><span class="normal"> </span><span class="symbol">(</span><span class="normal">il </span><span class="symbol">!=</span><span class="normal"> NULL</span><span class="symbol">)</span><span class="normal"> </span><span class="cbracket">{</span>
<span class="normal">            </span><span class="type">int</span><span class="normal"> w</span><span class="symbol">,</span><span class="normal"> h</span><span class="symbol">;</span>
<span class="normal">            il</span><span class="symbol">-&gt;</span><span class="function">GetSize</span><span class="symbol">(</span><span class="number">0</span><span class="symbol">,</span><span class="normal"> w</span><span class="symbol">,</span><span class="normal"> h</span><span class="symbol">);</span>
<span class="normal">            </span><span class="keyword">return</span><span class="normal"> w</span><span class="symbol">;</span>
<span class="normal">        </span><span class="cbracket">}</span>
<span class="normal">        </span><span class="keyword">return</span><span class="normal"> </span><span class="number">0</span><span class="symbol">;</span>
<span class="normal">    </span><span class="cbracket">}</span>


<span class="normal">    </span><span class="type">void</span><span class="normal"> </span><span class="function">SetDoubleClickAction</span><span class="symbol">(</span><span class="usertype">CallBackAction</span><span class="normal"> action</span><span class="symbol">,</span><span class="normal"> </span><span class="type">void</span><span class="normal"> </span><span class="symbol">*</span><span class="normal">data</span><span class="symbol">)</span><span class="normal"> </span><span class="cbracket">{</span>
<span class="normal">        doubleClickAction </span><span class="symbol">=</span><span class="normal"> action</span><span class="symbol">;</span>
<span class="normal">        doubleClickActionData </span><span class="symbol">=</span><span class="normal"> data</span><span class="symbol">;</span>
<span class="normal">    </span><span class="cbracket">}</span>


<span class="normal">    </span><span class="type">void</span><span class="normal"> </span><span class="function">OnFocus</span><span class="symbol">(</span><span class="normal">wxFocusEvent</span><span class="symbol">&amp;</span><span class="normal"> event</span><span class="symbol">)</span><span class="normal"> </span><span class="cbracket">{</span>
<span class="normal">        </span><span class="function">GetParent</span><span class="symbol">()-&gt;</span><span class="function">SetFocus</span><span class="symbol">();</span>
<span class="normal">        event</span><span class="symbol">.</span><span class="function">Skip</span><span class="symbol">();</span>
<span class="normal">    </span><span class="cbracket">}</span>

<span class="normal">    </span><span class="type">void</span><span class="normal"> </span><span class="function">OnSize</span><span class="symbol">(</span><span class="normal">wxSizeEvent</span><span class="symbol">&amp;</span><span class="normal"> event</span><span class="symbol">)</span><span class="normal"> </span><span class="cbracket">{</span>
<span class="normal">        </span><span class="comment">// resize the child</span>
<span class="normal">        </span><span class="usertype">wxSize</span><span class="normal"> sz </span><span class="symbol">=</span><span class="normal"> </span><span class="function">GetSize</span><span class="symbol">();</span>
<span class="normal">        sz</span><span class="symbol">.</span><span class="normal">x </span><span class="symbol">-=</span><span class="normal"> </span><span class="number">2</span><span class="symbol">;</span>
<span class="normal">        sz</span><span class="symbol">.</span><span class="normal">y </span><span class="symbol">-=</span><span class="normal"> </span><span class="number">2</span><span class="symbol">;</span>
<span class="normal">        lv</span><span class="symbol">-&gt;</span><span class="function">SetSize</span><span class="symbol">(</span><span class="number">1</span><span class="symbol">,</span><span class="normal"> </span><span class="number">1</span><span class="symbol">,</span><span class="normal"> sz</span><span class="symbol">.</span><span class="normal">x</span><span class="symbol">,</span><span class="normal"> sz</span><span class="symbol">.</span><span class="normal">y</span><span class="symbol">);</span>
<span class="normal">        </span><span class="comment">// reset the column widths</span>
<span class="normal">        lv</span><span class="symbol">-&gt;</span><span class="function">SetColumnWidth</span><span class="symbol">(</span><span class="number">0</span><span class="symbol">,</span><span class="normal"> </span><span class="function">IconWidth</span><span class="symbol">()+</span><span class="number">4</span><span class="symbol">);</span>
<span class="normal">        lv</span><span class="symbol">-&gt;</span><span class="function">SetColumnWidth</span><span class="symbol">(</span><span class="number">1</span><span class="symbol">,</span><span class="normal"> sz</span><span class="symbol">.</span><span class="normal">x </span><span class="symbol">-</span><span class="normal"> </span><span class="number">2</span><span class="normal"> </span><span class="symbol">-</span><span class="normal"> lv</span><span class="symbol">-&gt;</span><span class="function">GetColumnWidth</span><span class="symbol">(</span><span class="number">0</span><span class="symbol">)</span><span class="normal"> </span><span class="symbol">-</span>
<span class="normal">                           wxSystemSettings</span><span class="symbol">::</span><span class="function">GetMetric</span><span class="symbol">(</span><span class="normal">wxSYS_VSCROLL_X</span><span class="symbol">));</span>
<span class="normal">        event</span><span class="symbol">.</span><span class="function">Skip</span><span class="symbol">();</span>
<span class="normal">    </span><span class="cbracket">}</span>

<span class="normal">    </span><span class="type">void</span><span class="normal"> </span><span class="function">OnActivate</span><span class="symbol">(</span><span class="normal">wxListEvent</span><span class="symbol">&amp;</span><span class="normal"> </span><span class="function">WXUNUSED</span><span class="symbol">(</span><span class="normal">event</span><span class="symbol">))</span><span class="normal"> </span><span class="cbracket">{</span>
<span class="normal">        </span><span class="function">doubleClickAction</span><span class="symbol">(</span><span class="normal">doubleClickActionData</span><span class="symbol">);</span>
<span class="normal">    </span><span class="cbracket">}</span>

<span class="normal">    wxListView</span><span class="symbol">*</span><span class="normal"> </span><span class="function">GetLB</span><span class="symbol">()</span><span class="normal"> </span><span class="cbracket">{</span><span class="normal"> </span><span class="keyword">return</span><span class="normal"> lv</span><span class="symbol">;</span><span class="normal"> </span><span class="cbracket">}</span>

<span class="keyword">private</span><span class="symbol">:</span>
<span class="normal">    </span><span class="function">DECLARE_EVENT_TABLE</span><span class="symbol">()</span>

<span class="cbracket">}</span><span class="symbol">;</span>

<span class="function">BEGIN_EVENT_TABLE</span><span class="symbol">(</span><span class="normal">wxSTCListBoxWin</span><span class="symbol">,</span><span class="normal"> wxPopupWindow</span><span class="symbol">)</span>
<span class="normal">    </span><span class="function">EVT_SET_FOCUS</span><span class="normal">          </span><span class="symbol">(</span><span class="normal">          wxSTCListBoxWin</span><span class="symbol">::</span><span class="normal">OnFocus</span><span class="symbol">)</span>
<span class="normal">    </span><span class="function">EVT_SIZE</span><span class="normal">               </span><span class="symbol">(</span><span class="normal">          wxSTCListBoxWin</span><span class="symbol">::</span><span class="normal">OnSize</span><span class="symbol">)</span>
<span class="normal">    </span><span class="function">EVT_LIST_ITEM_ACTIVATED</span><span class="symbol">(</span><span class="normal">wxID_ANY</span><span class="symbol">,</span><span class="normal"> wxSTCListBoxWin</span><span class="symbol">::</span><span class="normal">OnActivate</span><span class="symbol">)</span>
<span class="function">END_EVENT_TABLE</span><span class="symbol">()</span>



<span class="preproc">#else</span><span class="normal"> </span><span class="comment">// !wxUSE_POPUPWIN -----------------------------------</span>

<span class="comment">// A normal window to place the wxSTCListBox upon, but make it behave as much</span>
<span class="comment">// like a wxPopupWindow as possible</span>
<span class="keyword">class</span><span class="normal"> </span><span class="classname">wxSTCListBoxWin</span><span class="normal"> </span><span class="symbol">:</span><span class="normal"> </span><span class="keyword">public</span><span class="normal"> wxFrame </span><span class="cbracket">{</span>
<span class="keyword">private</span><span class="symbol">:</span>
<span class="normal">    wxListView</span><span class="symbol">*</span><span class="normal">         lv</span><span class="symbol">;</span>
<span class="normal">    </span><span class="usertype">CallBackAction</span><span class="normal">      doubleClickAction</span><span class="symbol">;</span>
<span class="normal">    </span><span class="type">void</span><span class="symbol">*</span><span class="normal">               doubleClickActionData</span><span class="symbol">;</span>
<span class="keyword">public</span><span class="symbol">:</span>
<span class="normal">    </span><span class="function">wxSTCListBoxWin</span><span class="symbol">(</span><span class="normal">wxWindow</span><span class="symbol">*</span><span class="normal"> parent</span><span class="symbol">,</span><span class="normal"> </span><span class="usertype">wxWindowID</span><span class="normal"> id</span><span class="symbol">,</span><span class="normal"> </span><span class="usertype">Point</span><span class="normal"> location</span><span class="symbol">)</span><span class="normal"> </span><span class="symbol">:</span>
<span class="normal">        </span><span class="function">wxFrame</span><span class="symbol">(</span><span class="normal">parent</span><span class="symbol">,</span><span class="normal"> id</span><span class="symbol">,</span><span class="normal"> wxEmptyString</span><span class="symbol">,</span><span class="normal"> </span><span class="function">wxPoint</span><span class="symbol">(</span><span class="normal">location</span><span class="symbol">.</span><span class="normal">x</span><span class="symbol">,</span><span class="normal"> location</span><span class="symbol">.</span><span class="normal">y</span><span class="symbol">),</span><span class="normal"> </span><span class="function">wxSize</span><span class="symbol">(</span><span class="number">0</span><span class="symbol">,</span><span class="number">0</span><span class="symbol">),</span>
<span class="normal">                wxFRAME_NO_TASKBAR</span>
<span class="normal">                </span><span class="symbol">|</span><span class="normal"> wxFRAME_FLOAT_ON_PARENT</span>
<span class="preproc">#ifdef</span><span class="normal"> __WXMAC__</span>
<span class="normal">                </span><span class="symbol">|</span><span class="normal"> wxPOPUP_WINDOW </span>
<span class="normal">                </span><span class="symbol">|</span><span class="normal"> wxNO_BORDER</span>
<span class="preproc">#else</span>
<span class="normal">                </span><span class="symbol">|</span><span class="normal"> wxSIMPLE_BORDER</span>
<span class="preproc">#endif</span>
<span class="normal">            </span><span class="symbol">)</span>
<span class="normal">    </span><span class="cbracket">{</span>

<span class="normal">        lv </span><span class="symbol">=</span><span class="normal"> </span><span class="keyword">new</span><span class="normal"> </span><span class="function">wxSTCListBox</span><span class="symbol">(</span><span class="keyword">this</span><span class="symbol">,</span><span class="normal"> id</span><span class="symbol">,</span><span class="normal"> wxDefaultPosition</span><span class="symbol">,</span><span class="normal"> wxDefaultSize</span><span class="symbol">,</span>
<span class="normal">                              wxLC_REPORT </span><span class="symbol">|</span><span class="normal"> wxLC_SINGLE_SEL </span><span class="symbol">|</span><span class="normal"> wxLC_NO_HEADER </span><span class="symbol">|</span><span class="normal"> wxNO_BORDER</span><span class="symbol">);</span>
<span class="normal">        lv</span><span class="symbol">-&gt;</span><span class="function">SetCursor</span><span class="symbol">(</span><span class="function">wxCursor</span><span class="symbol">(</span><span class="normal">wxCURSOR_ARROW</span><span class="symbol">));</span>
<span class="normal">        lv</span><span class="symbol">-&gt;</span><span class="function">InsertColumn</span><span class="symbol">(</span><span class="number">0</span><span class="symbol">,</span><span class="normal"> wxEmptyString</span><span class="symbol">);</span>
<span class="normal">        lv</span><span class="symbol">-&gt;</span><span class="function">InsertColumn</span><span class="symbol">(</span><span class="number">1</span><span class="symbol">,</span><span class="normal"> wxEmptyString</span><span class="symbol">);</span>

<span class="normal">        </span><span class="comment">// Eventhough we immediately reset the focus to the parent, this helps</span>
<span class="normal">        </span><span class="comment">// things to look right...</span>
<span class="normal">        lv</span><span class="symbol">-&gt;</span><span class="function">SetFocus</span><span class="symbol">();</span>

<span class="normal">        </span><span class="function">Hide</span><span class="symbol">();</span>
<span class="normal">    </span><span class="cbracket">}</span><span class="normal"> </span>


<span class="normal">    </span><span class="comment">// On OSX and (possibly others) there can still be pending</span>
<span class="normal">    </span><span class="comment">// messages/events for the list control when Scintilla wants to</span>
<span class="normal">    </span><span class="comment">// close it, so do a pending delete of it instead of destroying</span>
<span class="normal">    </span><span class="comment">// immediately.</span>
<span class="normal">    </span><span class="type">bool</span><span class="normal"> </span><span class="function">Destroy</span><span class="symbol">()</span>
<span class="normal">    </span><span class="cbracket">{</span>
<span class="preproc">#ifdef</span><span class="normal"> __WXMAC__</span>
<span class="normal">        </span><span class="comment">// The bottom edge of this window is not getting properly</span>
<span class="normal">        </span><span class="comment">// refreshed upon deletion, so help it out...</span>
<span class="normal">        wxWindow</span><span class="symbol">*</span><span class="normal"> p </span><span class="symbol">=</span><span class="normal"> </span><span class="function">GetParent</span><span class="symbol">();</span>
<span class="normal">        </span><span class="usertype">wxRect</span><span class="normal"> </span><span class="function">r</span><span class="symbol">(</span><span class="function">GetPosition</span><span class="symbol">(),</span><span class="normal"> </span><span class="function">GetSize</span><span class="symbol">());</span>
<span class="normal">        r</span><span class="symbol">.</span><span class="function">SetHeight</span><span class="symbol">(</span><span class="normal">r</span><span class="symbol">.</span><span class="function">GetHeight</span><span class="symbol">()+</span><span class="number">1</span><span class="symbol">);</span>
<span class="normal">        p</span><span class="symbol">-&gt;</span><span class="function">Refresh</span><span class="symbol">(</span><span class="keyword">false</span><span class="symbol">,</span><span class="normal"> </span><span class="symbol">&amp;</span><span class="normal">r</span><span class="symbol">);</span>
<span class="preproc">#endif</span>
<span class="normal">        </span><span class="keyword">if</span><span class="normal"> </span><span class="symbol">(</span><span class="normal"> </span><span class="symbol">!</span><span class="normal">wxPendingDelete</span><span class="symbol">.</span><span class="function">Member</span><span class="symbol">(</span><span class="keyword">this</span><span class="symbol">)</span><span class="normal"> </span><span class="symbol">)</span>
<span class="normal">            wxPendingDelete</span><span class="symbol">.</span><span class="function">Append</span><span class="symbol">(</span><span class="keyword">this</span><span class="symbol">);</span>
<span class="normal">        </span><span class="keyword">return</span><span class="normal"> </span><span class="keyword">true</span><span class="symbol">;</span>
<span class="normal">    </span><span class="cbracket">}</span>


<span class="normal">    </span><span class="type">int</span><span class="normal"> </span><span class="function">IconWidth</span><span class="symbol">()</span>
<span class="normal">    </span><span class="cbracket">{</span>
<span class="normal">        wxImageList</span><span class="symbol">*</span><span class="normal"> il </span><span class="symbol">=</span><span class="normal"> lv</span><span class="symbol">-&gt;</span><span class="function">GetImageList</span><span class="symbol">(</span><span class="normal">wxIMAGE_LIST_SMALL</span><span class="symbol">);</span>
<span class="normal">        </span><span class="keyword">if</span><span class="normal"> </span><span class="symbol">(</span><span class="normal">il </span><span class="symbol">!=</span><span class="normal"> NULL</span><span class="symbol">)</span><span class="normal"> </span><span class="cbracket">{</span>
<span class="normal">            </span><span class="type">int</span><span class="normal"> w</span><span class="symbol">,</span><span class="normal"> h</span><span class="symbol">;</span>
<span class="normal">            il</span><span class="symbol">-&gt;</span><span class="function">GetSize</span><span class="symbol">(</span><span class="number">0</span><span class="symbol">,</span><span class="normal"> w</span><span class="symbol">,</span><span class="normal"> h</span><span class="symbol">);</span>
<span class="normal">            </span><span class="keyword">return</span><span class="normal"> w</span><span class="symbol">;</span>
<span class="normal">        </span><span class="cbracket">}</span>
<span class="normal">        </span><span class="keyword">return</span><span class="normal"> </span><span class="number">0</span><span class="symbol">;</span>
<span class="normal">    </span><span class="cbracket">}</span>


<span class="normal">    </span><span class="type">void</span><span class="normal"> </span><span class="function">SetDoubleClickAction</span><span class="symbol">(</span><span class="usertype">CallBackAction</span><span class="normal"> action</span><span class="symbol">,</span><span class="normal"> </span><span class="type">void</span><span class="normal"> </span><span class="symbol">*</span><span class="normal">data</span><span class="symbol">)</span>
<span class="normal">    </span><span class="cbracket">{</span>
<span class="normal">        doubleClickAction </span><span class="symbol">=</span><span class="normal"> action</span><span class="symbol">;</span>
<span class="normal">        doubleClickActionData </span><span class="symbol">=</span><span class="normal"> data</span><span class="symbol">;</span>
<span class="normal">    </span><span class="cbracket">}</span>


<span class="normal">    </span><span class="type">void</span><span class="normal"> </span><span class="function">OnFocus</span><span class="symbol">(</span><span class="normal">wxFocusEvent</span><span class="symbol">&amp;</span><span class="normal"> event</span><span class="symbol">)</span>
<span class="normal">    </span><span class="cbracket">{</span>
<span class="normal">        </span><span class="function">ActivateParent</span><span class="symbol">();</span>
<span class="normal">        </span><span class="function">GetParent</span><span class="symbol">()-&gt;</span><span class="function">SetFocus</span><span class="symbol">();</span>
<span class="normal">        event</span><span class="symbol">.</span><span class="function">Skip</span><span class="symbol">();</span>
<span class="normal">    </span><span class="cbracket">}</span>

<span class="normal">    </span><span class="type">void</span><span class="normal"> </span><span class="function">OnSize</span><span class="symbol">(</span><span class="normal">wxSizeEvent</span><span class="symbol">&amp;</span><span class="normal"> event</span><span class="symbol">)</span>
<span class="normal">    </span><span class="cbracket">{</span>
<span class="normal">        </span><span class="comment">// resize the child</span>
<span class="normal">        </span><span class="usertype">wxSize</span><span class="normal"> sz </span><span class="symbol">=</span><span class="normal"> </span><span class="function">GetClientSize</span><span class="symbol">();</span>
<span class="normal">        lv</span><span class="symbol">-&gt;</span><span class="function">SetSize</span><span class="symbol">(</span><span class="normal">sz</span><span class="symbol">);</span>
<span class="normal">        </span><span class="comment">// reset the column widths</span>
<span class="normal">        lv</span><span class="symbol">-&gt;</span><span class="function">SetColumnWidth</span><span class="symbol">(</span><span class="number">0</span><span class="symbol">,</span><span class="normal"> </span><span class="function">IconWidth</span><span class="symbol">()+</span><span class="number">4</span><span class="symbol">);</span>
<span class="normal">        lv</span><span class="symbol">-&gt;</span><span class="function">SetColumnWidth</span><span class="symbol">(</span><span class="number">1</span><span class="symbol">,</span><span class="normal"> sz</span><span class="symbol">.</span><span class="normal">x </span><span class="symbol">-</span><span class="normal"> </span><span class="number">2</span><span class="normal"> </span><span class="symbol">-</span><span class="normal"> lv</span><span class="symbol">-&gt;</span><span class="function">GetColumnWidth</span><span class="symbol">(</span><span class="number">0</span><span class="symbol">)</span><span class="normal"> </span><span class="symbol">-</span>
<span class="normal">                           wxSystemSettings</span><span class="symbol">::</span><span class="function">GetMetric</span><span class="symbol">(</span><span class="normal">wxSYS_VSCROLL_X</span><span class="symbol">));</span>
<span class="normal">        event</span><span class="symbol">.</span><span class="function">Skip</span><span class="symbol">();</span>
<span class="normal">    </span><span class="cbracket">}</span>

<span class="normal">    </span><span class="type">void</span><span class="normal"> </span><span class="function">ActivateParent</span><span class="symbol">()</span>
<span class="normal">    </span><span class="cbracket">{</span>
<span class="normal">        </span><span class="comment">// Although we're a frame, we always want the parent to be active, so</span>
<span class="normal">        </span><span class="comment">// raise it whenever we get shown, focused, etc.</span>
<span class="normal">        </span><span class="usertype">wxTopLevelWindow</span><span class="normal"> </span><span class="symbol">*</span><span class="normal">frame </span><span class="symbol">=</span><span class="normal"> </span><span class="function">wxDynamicCast</span><span class="symbol">(</span>
<span class="normal">            </span><span class="function">wxGetTopLevelParent</span><span class="symbol">(</span><span class="function">GetParent</span><span class="symbol">()),</span><span class="normal"> wxTopLevelWindow</span><span class="symbol">);</span>
<span class="normal">        </span><span class="keyword">if</span><span class="normal"> </span><span class="symbol">(</span><span class="normal">frame</span><span class="symbol">)</span>
<span class="normal">            frame</span><span class="symbol">-&gt;</span><span class="function">Raise</span><span class="symbol">();</span>
<span class="normal">    </span><span class="cbracket">}</span>
<span class="normal">        </span>

<span class="normal">    </span><span class="keyword">virtual</span><span class="normal"> </span><span class="type">void</span><span class="normal"> </span><span class="function">DoSetSize</span><span class="symbol">(</span><span class="type">int</span><span class="normal"> x</span><span class="symbol">,</span><span class="normal"> </span><span class="type">int</span><span class="normal"> y</span><span class="symbol">,</span>
<span class="normal">                           </span><span class="type">int</span><span class="normal"> width</span><span class="symbol">,</span><span class="normal"> </span><span class="type">int</span><span class="normal"> height</span><span class="symbol">,</span>
<span class="normal">                           </span><span class="type">int</span><span class="normal"> sizeFlags </span><span class="symbol">=</span><span class="normal"> wxSIZE_AUTO</span><span class="symbol">)</span>
<span class="normal">    </span><span class="cbracket">{</span>
<span class="normal">        </span><span class="comment">// convert coords to screen coords since we're a top-level window</span>
<span class="normal">        </span><span class="keyword">if</span><span class="normal"> </span><span class="symbol">(</span><span class="normal">x </span><span class="symbol">!=</span><span class="normal"> wxDefaultCoord</span><span class="symbol">)</span><span class="normal"> </span><span class="cbracket">{</span>
<span class="normal">            </span><span class="function">GetParent</span><span class="symbol">()-&gt;</span><span class="function">ClientToScreen</span><span class="symbol">(&amp;</span><span class="normal">x</span><span class="symbol">,</span><span class="normal"> NULL</span><span class="symbol">);</span>
<span class="normal">        </span><span class="cbracket">}</span>
<span class="normal">        </span><span class="keyword">if</span><span class="normal"> </span><span class="symbol">(</span><span class="normal">y </span><span class="symbol">!=</span><span class="normal"> wxDefaultCoord</span><span class="symbol">)</span><span class="normal"> </span><span class="cbracket">{</span>
<span class="normal">            </span><span class="function">GetParent</span><span class="symbol">()-&gt;</span><span class="function">ClientToScreen</span><span class="symbol">(</span><span class="normal">NULL</span><span class="symbol">,</span><span class="normal"> </span><span class="symbol">&amp;</span><span class="normal">y</span><span class="symbol">);</span>
<span class="normal">        </span><span class="cbracket">}</span>
<span class="normal">        wxFrame</span><span class="symbol">::</span><span class="function">DoSetSize</span><span class="symbol">(</span><span class="normal">x</span><span class="symbol">,</span><span class="normal"> y</span><span class="symbol">,</span><span class="normal"> width</span><span class="symbol">,</span><span class="normal"> height</span><span class="symbol">,</span><span class="normal"> sizeFlags</span><span class="symbol">);</span>
<span class="normal">    </span><span class="cbracket">}</span>

<span class="normal">    </span><span class="keyword">virtual</span><span class="normal"> </span><span class="type">bool</span><span class="normal"> </span><span class="function">Show</span><span class="symbol">(</span><span class="type">bool</span><span class="normal"> show </span><span class="symbol">=</span><span class="normal"> </span><span class="keyword">true</span><span class="symbol">)</span>
<span class="normal">    </span><span class="cbracket">{</span>
<span class="normal">        </span><span class="type">bool</span><span class="normal"> rv </span><span class="symbol">=</span><span class="normal"> wxFrame</span><span class="symbol">::</span><span class="function">Show</span><span class="symbol">(</span><span class="normal">show</span><span class="symbol">);</span>
<span class="normal">        </span><span class="keyword">if</span><span class="normal"> </span><span class="symbol">(</span><span class="normal">rv </span><span class="symbol">&amp;&amp;</span><span class="normal"> show</span><span class="symbol">)</span>
<span class="normal">            </span><span class="function">ActivateParent</span><span class="symbol">();</span>
<span class="preproc">#ifdef</span><span class="normal"> __WXMAC__</span>
<span class="normal">        </span><span class="function">GetParent</span><span class="symbol">()-&gt;</span><span class="function">Refresh</span><span class="symbol">(</span><span class="keyword">false</span><span class="symbol">);</span>
<span class="preproc">#endif</span>
<span class="normal">        </span><span class="keyword">return</span><span class="normal"> rv</span><span class="symbol">;</span>
<span class="normal">    </span><span class="cbracket">}</span>

<span class="normal">    </span><span class="type">void</span><span class="normal"> </span><span class="function">OnActivate</span><span class="symbol">(</span><span class="normal">wxListEvent</span><span class="symbol">&amp;</span><span class="normal"> </span><span class="function">WXUNUSED</span><span class="symbol">(</span><span class="normal">event</span><span class="symbol">))</span>
<span class="normal">    </span><span class="cbracket">{</span>
<span class="normal">        </span><span class="function">doubleClickAction</span><span class="symbol">(</span><span class="normal">doubleClickActionData</span><span class="symbol">);</span>
<span class="normal">    </span><span class="cbracket">}</span>

<span class="normal">    wxListView</span><span class="symbol">*</span><span class="normal"> </span><span class="function">GetLB</span><span class="symbol">()</span><span class="normal"> </span><span class="cbracket">{</span><span class="normal"> </span><span class="keyword">return</span><span class="normal"> lv</span><span class="symbol">;</span><span class="normal"> </span><span class="cbracket">}</span>

<span class="keyword">private</span><span class="symbol">:</span>
<span class="normal">    </span><span class="function">DECLARE_EVENT_TABLE</span><span class="symbol">()</span>
<span class="cbracket">}</span><span class="symbol">;</span>


<span class="function">BEGIN_EVENT_TABLE</span><span class="symbol">(</span><span class="normal">wxSTCListBoxWin</span><span class="symbol">,</span><span class="normal"> wxWindow</span><span class="symbol">)</span>
<span class="normal">    </span><span class="function">EVT_SET_FOCUS</span><span class="normal">          </span><span class="symbol">(</span><span class="normal">          wxSTCListBoxWin</span><span class="symbol">::</span><span class="normal">OnFocus</span><span class="symbol">)</span>
<span class="normal">    </span><span class="function">EVT_SIZE</span><span class="normal">               </span><span class="symbol">(</span><span class="normal">          wxSTCListBoxWin</span><span class="symbol">::</span><span class="normal">OnSize</span><span class="symbol">)</span>
<span class="normal">    </span><span class="function">EVT_LIST_ITEM_ACTIVATED</span><span class="symbol">(</span><span class="normal">wxID_ANY</span><span class="symbol">,</span><span class="normal"> wxSTCListBoxWin</span><span class="symbol">::</span><span class="normal">OnActivate</span><span class="symbol">)</span>
<span class="function">END_EVENT_TABLE</span><span class="symbol">()</span>

<span class="preproc">#endif</span><span class="normal"> </span><span class="comment">// wxUSE_POPUPWIN -----------------------------------</span>


<span class="keyword">inline</span><span class="normal"> wxSTCListBoxWin</span><span class="symbol">*</span><span class="normal"> </span><span class="function">GETLBW</span><span class="symbol">(</span><span class="usertype">WindowID</span><span class="normal"> win</span><span class="symbol">)</span><span class="normal"> </span><span class="cbracket">{</span>
<span class="normal">    </span><span class="keyword">return</span><span class="normal"> </span><span class="symbol">((</span><span class="normal">wxSTCListBoxWin</span><span class="symbol">*)</span><span class="normal">win</span><span class="symbol">);</span>
<span class="cbracket">}</span>

<span class="keyword">inline</span><span class="normal"> wxListView</span><span class="symbol">*</span><span class="normal"> </span><span class="function">GETLB</span><span class="symbol">(</span><span class="usertype">WindowID</span><span class="normal"> win</span><span class="symbol">)</span><span class="normal"> </span><span class="cbracket">{</span>
<span class="normal">    </span><span class="keyword">return</span><span class="normal"> </span><span class="function">GETLBW</span><span class="symbol">(</span><span class="normal">win</span><span class="symbol">)-&gt;</span><span class="function">GetLB</span><span class="symbol">();</span>
<span class="cbracket">}</span>

<span class="comment">//----------------------------------------------------------------------</span>

<span class="keyword">class</span><span class="normal"> </span><span class="classname">ListBoxImpl</span><span class="normal"> </span><span class="symbol">:</span><span class="normal"> </span><span class="keyword">public</span><span class="normal"> ListBox </span><span class="cbracket">{</span>
<span class="keyword">private</span><span class="symbol">:</span>
<span class="normal">    </span><span class="type">int</span><span class="normal">                 lineHeight</span><span class="symbol">;</span>
<span class="normal">    </span><span class="type">bool</span><span class="normal">                unicodeMode</span><span class="symbol">;</span>
<span class="normal">    </span><span class="type">int</span><span class="normal">                 desiredVisibleRows</span><span class="symbol">;</span>
<span class="normal">    </span><span class="type">int</span><span class="normal">                 aveCharWidth</span><span class="symbol">;</span>
<span class="normal">    </span><span class="usertype">size_t</span><span class="normal">              maxStrWidth</span><span class="symbol">;</span>
<span class="normal">    </span><span class="usertype">Point</span><span class="normal">               location</span><span class="symbol">;</span><span class="normal">       </span><span class="comment">// Caret location at which the list is opened</span>
<span class="normal">    wxImageList</span><span class="symbol">*</span><span class="normal">        imgList</span><span class="symbol">;</span>
<span class="normal">    wxArrayInt</span><span class="symbol">*</span><span class="normal">         imgTypeMap</span><span class="symbol">;</span>

<span class="keyword">public</span><span class="symbol">:</span>
<span class="normal">    </span><span class="function">ListBoxImpl</span><span class="symbol">();</span>
<span class="normal">    </span><span class="symbol">~</span><span class="function">ListBoxImpl</span><span class="symbol">();</span>

<span class="normal">    </span><span class="keyword">virtual</span><span class="normal"> </span><span class="type">void</span><span class="normal"> </span><span class="function">SetFont</span><span class="symbol">(</span><span class="usertype">Font</span><span class="normal"> </span><span class="symbol">&amp;</span><span class="normal">font</span><span class="symbol">);</span>
<span class="normal">    </span><span class="keyword">virtual</span><span class="normal"> </span><span class="type">void</span><span class="normal"> </span><span class="function">Create</span><span class="symbol">(</span><span class="usertype">Window</span><span class="normal"> </span><span class="symbol">&amp;</span><span class="normal">parent</span><span class="symbol">,</span><span class="normal"> </span><span class="type">int</span><span class="normal"> ctrlID</span><span class="symbol">,</span><span class="normal"> </span><span class="usertype">Point</span><span class="normal"> location_</span><span class="symbol">,</span><span class="normal"> </span><span class="type">int</span><span class="normal"> lineHeight_</span><span class="symbol">,</span><span class="normal"> </span><span class="type">bool</span><span class="normal"> unicodeMode_</span><span class="symbol">);</span>
<span class="normal">    </span><span class="keyword">virtual</span><span class="normal"> </span><span class="type">void</span><span class="normal"> </span><span class="function">SetAverageCharWidth</span><span class="symbol">(</span><span class="type">int</span><span class="normal"> width</span><span class="symbol">);</span>
<span class="normal">    </span><span class="keyword">virtual</span><span class="normal"> </span><span class="type">void</span><span class="normal"> </span><span class="function">SetVisibleRows</span><span class="symbol">(</span><span class="type">int</span><span class="normal"> rows</span><span class="symbol">);</span>
<span class="normal">    </span><span class="keyword">virtual</span><span class="normal"> </span><span class="type">int</span><span class="normal"> </span><span class="function">GetVisibleRows</span><span class="symbol">()</span><span class="normal"> </span><span class="keyword">const</span><span class="symbol">;</span>
<span class="normal">    </span><span class="keyword">virtual</span><span class="normal"> </span><span class="usertype">PRectangle</span><span class="normal"> </span><span class="function">GetDesiredRect</span><span class="symbol">();</span>
<span class="normal">    </span><span class="keyword">virtual</span><span class="normal"> </span><span class="type">int</span><span class="normal"> </span><span class="function">CaretFromEdge</span><span class="symbol">();</span>
<span class="normal">    </span><span class="keyword">virtual</span><span class="normal"> </span><span class="type">void</span><span class="normal"> </span><span class="function">Clear</span><span class="symbol">();</span>
<span class="normal">    </span><span class="keyword">virtual</span><span class="normal"> </span><span class="type">void</span><span class="normal"> </span><span class="function">Append</span><span class="symbol">(</span><span class="type">char</span><span class="normal"> </span><span class="symbol">*</span><span class="normal">s</span><span class="symbol">,</span><span class="normal"> </span><span class="type">int</span><span class="normal"> type </span><span class="symbol">=</span><span class="normal"> </span><span class="symbol">-</span><span class="number">1</span><span class="symbol">);</span>
<span class="normal">            </span><span class="type">void</span><span class="normal"> </span><span class="function">Append</span><span class="symbol">(</span><span class="keyword">const</span><span class="normal"> wxString</span><span class="symbol">&amp;</span><span class="normal"> text</span><span class="symbol">,</span><span class="normal"> </span><span class="type">int</span><span class="normal"> type</span><span class="symbol">);</span>
<span class="normal">    </span><span class="keyword">virtual</span><span class="normal"> </span><span class="type">int</span><span class="normal"> </span><span class="function">Length</span><span class="symbol">();</span>
<span class="normal">    </span><span class="keyword">virtual</span><span class="normal"> </span><span class="type">void</span><span class="normal"> </span><span class="function">Select</span><span class="symbol">(</span><span class="type">int</span><span class="normal"> n</span><span class="symbol">);</span>
<span class="normal">    </span><span class="keyword">virtual</span><span class="normal"> </span><span class="type">int</span><span class="normal"> </span><span class="function">GetSelection</span><span class="symbol">();</span>
<span class="normal">    </span><span class="keyword">virtual</span><span class="normal"> </span><span class="type">int</span><span class="normal"> </span><span class="function">Find</span><span class="symbol">(</span><span class="keyword">const</span><span class="normal"> </span><span class="type">char</span><span class="normal"> </span><span class="symbol">*</span><span class="normal">prefix</span><span class="symbol">);</span>
<span class="normal">    </span><span class="keyword">virtual</span><span class="normal"> </span><span class="type">void</span><span class="normal"> </span><span class="function">GetValue</span><span class="symbol">(</span><span class="type">int</span><span class="normal"> n</span><span class="symbol">,</span><span class="normal"> </span><span class="type">char</span><span class="normal"> </span><span class="symbol">*</span><span class="normal">value</span><span class="symbol">,</span><span class="normal"> </span><span class="type">int</span><span class="normal"> len</span><span class="symbol">);</span>
<span class="normal">    </span><span class="keyword">virtual</span><span class="normal"> </span><span class="type">void</span><span class="normal"> </span><span class="function">RegisterImage</span><span class="symbol">(</span><span class="type">int</span><span class="normal"> type</span><span class="symbol">,</span><span class="normal"> </span><span class="keyword">const</span><span class="normal"> </span><span class="type">char</span><span class="normal"> </span><span class="symbol">*</span><span class="normal">xpm_data</span><span class="symbol">);</span>
<span class="normal">    </span><span class="keyword">virtual</span><span class="normal"> </span><span class="type">void</span><span class="normal"> </span><span class="function">ClearRegisteredImages</span><span class="symbol">();</span>
<span class="normal">    </span><span class="keyword">virtual</span><span class="normal"> </span><span class="type">void</span><span class="normal"> </span><span class="function">SetDoubleClickAction</span><span class="symbol">(</span><span class="normal">CallBackAction</span><span class="symbol">,</span><span class="normal"> </span><span class="type">void</span><span class="normal"> </span><span class="symbol">*);</span>
<span class="normal">    </span><span class="keyword">virtual</span><span class="normal"> </span><span class="type">void</span><span class="normal"> </span><span class="function">SetList</span><span class="symbol">(</span><span class="keyword">const</span><span class="normal"> </span><span class="type">char</span><span class="symbol">*</span><span class="normal"> list</span><span class="symbol">,</span><span class="normal"> </span><span class="type">char</span><span class="normal"> separator</span><span class="symbol">,</span><span class="normal"> </span><span class="type">char</span><span class="normal"> typesep</span><span class="symbol">);</span>
<span class="cbracket">}</span><span class="symbol">;</span>


<span class="normal">ListBoxImpl</span><span class="symbol">::</span><span class="function">ListBoxImpl</span><span class="symbol">()</span>
<span class="normal">    </span><span class="symbol">:</span><span class="normal"> </span><span class="function">lineHeight</span><span class="symbol">(</span><span class="number">10</span><span class="symbol">),</span><span class="normal"> </span><span class="function">unicodeMode</span><span class="symbol">(</span><span class="keyword">false</span><span class="symbol">),</span>
<span class="normal">      </span><span class="function">desiredVisibleRows</span><span class="symbol">(</span><span class="number">5</span><span class="symbol">),</span><span class="normal"> </span><span class="function">aveCharWidth</span><span class="symbol">(</span><span class="number">8</span><span class="symbol">),</span><span class="normal"> </span><span class="function">maxStrWidth</span><span class="symbol">(</span><span class="number">0</span><span class="symbol">),</span>
<span class="normal">      </span><span class="function">imgList</span><span class="symbol">(</span><span class="normal">NULL</span><span class="symbol">),</span><span class="normal"> </span><span class="function">imgTypeMap</span><span class="symbol">(</span><span class="normal">NULL</span><span class="symbol">)</span>
<span class="cbracket">{</span>
<span class="cbracket">}</span>

<span class="normal">ListBoxImpl</span><span class="symbol">::~</span><span class="function">ListBoxImpl</span><span class="symbol">()</span><span class="normal"> </span><span class="cbracket">{</span>
<span class="normal">    </span><span class="keyword">if</span><span class="normal"> </span><span class="symbol">(</span><span class="normal">imgList</span><span class="symbol">)</span><span class="normal"> </span><span class="cbracket">{</span>
<span class="normal">        </span><span class="keyword">delete</span><span class="normal"> imgList</span><span class="symbol">;</span>
<span class="normal">        imgList </span><span class="symbol">=</span><span class="normal"> NULL</span><span class="symbol">;</span>
<span class="normal">    </span><span class="cbracket">}</span>
<span class="normal">    </span><span class="keyword">if</span><span class="normal"> </span><span class="symbol">(</span><span class="normal">imgTypeMap</span><span class="symbol">)</span><span class="normal"> </span><span class="cbracket">{</span>
<span class="normal">        </span><span class="keyword">delete</span><span class="normal"> imgTypeMap</span><span class="symbol">;</span>
<span class="normal">        imgTypeMap </span><span class="symbol">=</span><span class="normal"> NULL</span><span class="symbol">;</span>
<span class="normal">    </span><span class="cbracket">}</span>
<span class="cbracket">}</span>


<span class="type">void</span><span class="normal"> ListBoxImpl</span><span class="symbol">::</span><span class="function">SetFont</span><span class="symbol">(</span><span class="usertype">Font</span><span class="normal"> </span><span class="symbol">&amp;</span><span class="normal">font</span><span class="symbol">)</span><span class="normal"> </span><span class="cbracket">{</span>
<span class="normal">    </span><span class="function">GETLB</span><span class="symbol">(</span><span class="normal">wid</span><span class="symbol">)-&gt;</span><span class="function">SetFont</span><span class="symbol">(*((</span><span class="normal">wxFont</span><span class="symbol">*)</span><span class="normal">font</span><span class="symbol">.</span><span class="function">GetID</span><span class="symbol">()));</span>
<span class="cbracket">}</span>


<span class="type">void</span><span class="normal"> ListBoxImpl</span><span class="symbol">::</span><span class="function">Create</span><span class="symbol">(</span><span class="usertype">Window</span><span class="normal"> </span><span class="symbol">&amp;</span><span class="normal">parent</span><span class="symbol">,</span><span class="normal"> </span><span class="type">int</span><span class="normal"> ctrlID</span><span class="symbol">,</span><span class="normal"> </span><span class="usertype">Point</span><span class="normal"> location_</span><span class="symbol">,</span><span class="normal"> </span><span class="type">int</span><span class="normal"> lineHeight_</span><span class="symbol">,</span><span class="normal"> </span><span class="type">bool</span><span class="normal"> unicodeMode_</span><span class="symbol">)</span><span class="normal"> </span><span class="cbracket">{</span>
<span class="normal">    location </span><span class="symbol">=</span><span class="normal"> location_</span><span class="symbol">;</span>
<span class="normal">    lineHeight </span><span class="symbol">=</span><span class="normal">  lineHeight_</span><span class="symbol">;</span>
<span class="normal">    unicodeMode </span><span class="symbol">=</span><span class="normal"> unicodeMode_</span><span class="symbol">;</span>
<span class="normal">    maxStrWidth </span><span class="symbol">=</span><span class="normal"> </span><span class="number">0</span><span class="symbol">;</span>
<span class="normal">    wid </span><span class="symbol">=</span><span class="normal"> </span><span class="keyword">new</span><span class="normal"> </span><span class="function">wxSTCListBoxWin</span><span class="symbol">(</span><span class="function">GETWIN</span><span class="symbol">(</span><span class="normal">parent</span><span class="symbol">.</span><span class="function">GetID</span><span class="symbol">()),</span><span class="normal"> ctrlID</span><span class="symbol">,</span><span class="normal"> location</span><span class="symbol">);</span>
<span class="normal">    </span><span class="keyword">if</span><span class="normal"> </span><span class="symbol">(</span><span class="normal">imgList </span><span class="symbol">!=</span><span class="normal"> NULL</span><span class="symbol">)</span>
<span class="normal">        </span><span class="function">GETLB</span><span class="symbol">(</span><span class="normal">wid</span><span class="symbol">)-&gt;</span><span class="function">SetImageList</span><span class="symbol">(</span><span class="normal">imgList</span><span class="symbol">,</span><span class="normal"> wxIMAGE_LIST_SMALL</span><span class="symbol">);</span>
<span class="cbracket">}</span>


<span class="type">void</span><span class="normal"> ListBoxImpl</span><span class="symbol">::</span><span class="function">SetAverageCharWidth</span><span class="symbol">(</span><span class="type">int</span><span class="normal"> width</span><span class="symbol">)</span><span class="normal"> </span><span class="cbracket">{</span>
<span class="normal">    aveCharWidth </span><span class="symbol">=</span><span class="normal"> width</span><span class="symbol">;</span>
<span class="cbracket">}</span>


<span class="type">void</span><span class="normal"> ListBoxImpl</span><span class="symbol">::</span><span class="function">SetVisibleRows</span><span class="symbol">(</span><span class="type">int</span><span class="normal"> rows</span><span class="symbol">)</span><span class="normal"> </span><span class="cbracket">{</span>
<span class="normal">    desiredVisibleRows </span><span class="symbol">=</span><span class="normal"> rows</span><span class="symbol">;</span>
<span class="cbracket">}</span>


<span class="type">int</span><span class="normal"> ListBoxImpl</span><span class="symbol">::</span><span class="function">GetVisibleRows</span><span class="symbol">()</span><span class="normal"> </span><span class="keyword">const</span><span class="normal"> </span><span class="cbracket">{</span>
<span class="normal">    </span><span class="keyword">return</span><span class="normal"> desiredVisibleRows</span><span class="symbol">;</span>
<span class="cbracket">}</span>

<span class="usertype">PRectangle</span><span class="normal"> ListBoxImpl</span><span class="symbol">::</span><span class="function">GetDesiredRect</span><span class="symbol">()</span><span class="normal"> </span><span class="cbracket">{</span>
<span class="normal">    </span><span class="comment">// wxListCtrl doesn't have a DoGetBestSize, so instead we kept track of</span>
<span class="normal">    </span><span class="comment">// the max size in Append and calculate it here...</span>
<span class="normal">    </span><span class="type">int</span><span class="normal"> maxw </span><span class="symbol">=</span><span class="normal"> maxStrWidth </span><span class="symbol">*</span><span class="normal"> aveCharWidth</span><span class="symbol">;</span>
<span class="normal">    </span><span class="type">int</span><span class="normal"> maxh </span><span class="symbol">;</span>

<span class="normal">    </span><span class="comment">// give it a default if there are no lines, and/or add a bit more</span>
<span class="normal">    </span><span class="keyword">if</span><span class="normal"> </span><span class="symbol">(</span><span class="normal">maxw </span><span class="symbol">==</span><span class="normal"> </span><span class="number">0</span><span class="symbol">)</span><span class="normal"> maxw </span><span class="symbol">=</span><span class="normal"> </span><span class="number">100</span><span class="symbol">;</span>
<span class="normal">    maxw </span><span class="symbol">+=</span><span class="normal"> aveCharWidth </span><span class="symbol">*</span><span class="normal"> </span><span class="number">3</span><span class="normal"> </span><span class="symbol">+</span>
<span class="normal">            </span><span class="function">GETLBW</span><span class="symbol">(</span><span class="normal">wid</span><span class="symbol">)-&gt;</span><span class="function">IconWidth</span><span class="symbol">()</span><span class="normal"> </span><span class="symbol">+</span><span class="normal"> wxSystemSettings</span><span class="symbol">::</span><span class="function">GetMetric</span><span class="symbol">(</span><span class="normal">wxSYS_VSCROLL_X</span><span class="symbol">);</span>
<span class="normal">    </span><span class="keyword">if</span><span class="normal"> </span><span class="symbol">(</span><span class="normal">maxw </span><span class="symbol">&gt;</span><span class="normal"> </span><span class="number">350</span><span class="symbol">)</span>
<span class="normal">        maxw </span><span class="symbol">=</span><span class="normal"> </span><span class="number">350</span><span class="symbol">;</span>

<span class="normal">    </span><span class="comment">// estimate a desired height</span>
<span class="normal">    </span><span class="type">int</span><span class="normal"> count </span><span class="symbol">=</span><span class="normal"> </span><span class="function">GETLB</span><span class="symbol">(</span><span class="normal">wid</span><span class="symbol">)-&gt;</span><span class="function">GetItemCount</span><span class="symbol">();</span>
<span class="normal">    </span><span class="keyword">if</span><span class="normal"> </span><span class="symbol">(</span><span class="normal">count</span><span class="symbol">)</span><span class="normal"> </span><span class="cbracket">{</span>
<span class="normal">        </span><span class="usertype">wxRect</span><span class="normal"> rect</span><span class="symbol">;</span>
<span class="normal">        </span><span class="function">GETLB</span><span class="symbol">(</span><span class="normal">wid</span><span class="symbol">)-&gt;</span><span class="function">GetItemRect</span><span class="symbol">(</span><span class="number">0</span><span class="symbol">,</span><span class="normal"> rect</span><span class="symbol">);</span>
<span class="normal">        maxh </span><span class="symbol">=</span><span class="normal"> count </span><span class="symbol">*</span><span class="normal"> rect</span><span class="symbol">.</span><span class="function">GetHeight</span><span class="symbol">();</span>
<span class="normal">        </span><span class="keyword">if</span><span class="normal"> </span><span class="symbol">(</span><span class="normal">maxh </span><span class="symbol">&gt;</span><span class="normal"> </span><span class="number">140</span><span class="symbol">)</span><span class="normal">  </span><span class="comment">// TODO:  Use desiredVisibleRows??</span>
<span class="normal">            maxh </span><span class="symbol">=</span><span class="normal"> </span><span class="number">140</span><span class="symbol">;</span>

<span class="normal">        </span><span class="comment">// Try to make the size an exact multiple of some number of lines</span>
<span class="normal">        </span><span class="type">int</span><span class="normal"> lines </span><span class="symbol">=</span><span class="normal"> maxh </span><span class="symbol">/</span><span class="normal"> rect</span><span class="symbol">.</span><span class="function">GetHeight</span><span class="symbol">();</span>
<span class="normal">        maxh </span><span class="symbol">=</span><span class="normal"> </span><span class="symbol">(</span><span class="normal">lines </span><span class="symbol">+</span><span class="normal"> </span><span class="number">1</span><span class="symbol">)</span><span class="normal"> </span><span class="symbol">*</span><span class="normal"> rect</span><span class="symbol">.</span><span class="function">GetHeight</span><span class="symbol">()</span><span class="normal"> </span><span class="symbol">+</span><span class="normal"> </span><span class="number">2</span><span class="symbol">;</span>
<span class="normal">    </span><span class="cbracket">}</span>
<span class="normal">    </span><span class="keyword">else</span>
<span class="normal">        maxh </span><span class="symbol">=</span><span class="normal"> </span><span class="number">100</span><span class="symbol">;</span>

<span class="normal">    </span><span class="usertype">PRectangle</span><span class="normal"> rc</span><span class="symbol">;</span>
<span class="normal">    rc</span><span class="symbol">.</span><span class="normal">top </span><span class="symbol">=</span><span class="normal"> </span><span class="number">0</span><span class="symbol">;</span>
<span class="normal">    rc</span><span class="symbol">.</span><span class="normal">left </span><span class="symbol">=</span><span class="normal"> </span><span class="number">0</span><span class="symbol">;</span>
<span class="normal">    rc</span><span class="symbol">.</span><span class="normal">right </span><span class="symbol">=</span><span class="normal"> maxw</span><span class="symbol">;</span>
<span class="normal">    rc</span><span class="symbol">.</span><span class="normal">bottom </span><span class="symbol">=</span><span class="normal"> maxh</span><span class="symbol">;</span>
<span class="normal">    </span><span class="keyword">return</span><span class="normal"> rc</span><span class="symbol">;</span>
<span class="cbracket">}</span>


<span class="type">int</span><span class="normal"> ListBoxImpl</span><span class="symbol">::</span><span class="function">CaretFromEdge</span><span class="symbol">()</span><span class="normal"> </span><span class="cbracket">{</span>
<span class="normal">    </span><span class="keyword">return</span><span class="normal"> </span><span class="number">4</span><span class="normal"> </span><span class="symbol">+</span><span class="normal"> </span><span class="function">GETLBW</span><span class="symbol">(</span><span class="normal">wid</span><span class="symbol">)-&gt;</span><span class="function">IconWidth</span><span class="symbol">();</span>
<span class="cbracket">}</span>


<span class="type">void</span><span class="normal"> ListBoxImpl</span><span class="symbol">::</span><span class="function">Clear</span><span class="symbol">()</span><span class="normal"> </span><span class="cbracket">{</span>
<span class="normal">    </span><span class="function">GETLB</span><span class="symbol">(</span><span class="normal">wid</span><span class="symbol">)-&gt;</span><span class="function">DeleteAllItems</span><span class="symbol">();</span>
<span class="cbracket">}</span>


<span class="type">void</span><span class="normal"> ListBoxImpl</span><span class="symbol">::</span><span class="function">Append</span><span class="symbol">(</span><span class="type">char</span><span class="normal"> </span><span class="symbol">*</span><span class="normal">s</span><span class="symbol">,</span><span class="normal"> </span><span class="type">int</span><span class="normal"> type</span><span class="symbol">)</span><span class="normal"> </span><span class="cbracket">{</span>
<span class="normal">    </span><span class="function">Append</span><span class="symbol">(</span><span class="function">stc2wx</span><span class="symbol">(</span><span class="normal">s</span><span class="symbol">),</span><span class="normal"> type</span><span class="symbol">);</span>
<span class="cbracket">}</span>

<span class="type">void</span><span class="normal"> ListBoxImpl</span><span class="symbol">::</span><span class="function">Append</span><span class="symbol">(</span><span class="keyword">const</span><span class="normal"> wxString</span><span class="symbol">&amp;</span><span class="normal"> text</span><span class="symbol">,</span><span class="normal"> </span><span class="type">int</span><span class="normal"> type</span><span class="symbol">)</span><span class="normal"> </span><span class="cbracket">{</span>
<span class="normal">    </span><span class="type">long</span><span class="normal"> count  </span><span class="symbol">=</span><span class="normal"> </span><span class="function">GETLB</span><span class="symbol">(</span><span class="normal">wid</span><span class="symbol">)-&gt;</span><span class="function">GetItemCount</span><span class="symbol">();</span>
<span class="normal">    </span><span class="type">long</span><span class="normal"> itemID  </span><span class="symbol">=</span><span class="normal"> </span><span class="function">GETLB</span><span class="symbol">(</span><span class="normal">wid</span><span class="symbol">)-&gt;</span><span class="function">InsertItem</span><span class="symbol">(</span><span class="normal">count</span><span class="symbol">,</span><span class="normal"> wxEmptyString</span><span class="symbol">);</span>
<span class="normal">    </span><span class="function">GETLB</span><span class="symbol">(</span><span class="normal">wid</span><span class="symbol">)-&gt;</span><span class="function">SetItem</span><span class="symbol">(</span><span class="normal">itemID</span><span class="symbol">,</span><span class="normal"> </span><span class="number">1</span><span class="symbol">,</span><span class="normal"> text</span><span class="symbol">);</span>
<span class="normal">    maxStrWidth </span><span class="symbol">=</span><span class="normal"> </span><span class="function">wxMax</span><span class="symbol">(</span><span class="normal">maxStrWidth</span><span class="symbol">,</span><span class="normal"> text</span><span class="symbol">.</span><span class="function">length</span><span class="symbol">());</span>
<span class="normal">    </span><span class="keyword">if</span><span class="normal"> </span><span class="symbol">(</span><span class="normal">type </span><span class="symbol">!=</span><span class="normal"> </span><span class="symbol">-</span><span class="number">1</span><span class="symbol">)</span><span class="normal"> </span><span class="cbracket">{</span>
<span class="normal">        </span><span class="function">wxCHECK_RET</span><span class="symbol">(</span><span class="normal">imgTypeMap</span><span class="symbol">,</span><span class="normal"> </span><span class="function">wxT</span><span class="symbol">(</span><span class="string">"Unexpected NULL imgTypeMap"</span><span class="symbol">));</span>
<span class="normal">        </span><span class="type">long</span><span class="normal"> idx </span><span class="symbol">=</span><span class="normal"> imgTypeMap</span><span class="symbol">-&gt;</span><span class="function">Item</span><span class="symbol">(</span><span class="normal">type</span><span class="symbol">);</span>
<span class="normal">        </span><span class="function">GETLB</span><span class="symbol">(</span><span class="normal">wid</span><span class="symbol">)-&gt;</span><span class="function">SetItemImage</span><span class="symbol">(</span><span class="normal">itemID</span><span class="symbol">,</span><span class="normal"> idx</span><span class="symbol">,</span><span class="normal"> idx</span><span class="symbol">);</span>
<span class="normal">    </span><span class="cbracket">}</span>
<span class="cbracket">}</span>

<span class="type">void</span><span class="normal"> ListBoxImpl</span><span class="symbol">::</span><span class="function">SetList</span><span class="symbol">(</span><span class="keyword">const</span><span class="normal"> </span><span class="type">char</span><span class="symbol">*</span><span class="normal"> list</span><span class="symbol">,</span><span class="normal"> </span><span class="type">char</span><span class="normal"> separator</span><span class="symbol">,</span><span class="normal"> </span><span class="type">char</span><span class="normal"> typesep</span><span class="symbol">)</span><span class="normal"> </span><span class="cbracket">{</span>
<span class="normal">    </span><span class="function">GETLB</span><span class="symbol">(</span><span class="normal">wid</span><span class="symbol">)-&gt;</span><span class="function">Freeze</span><span class="symbol">();</span>
<span class="normal">    </span><span class="function">Clear</span><span class="symbol">();</span>
<span class="normal">    </span><span class="usertype">wxStringTokenizer</span><span class="normal"> </span><span class="function">tkzr</span><span class="symbol">(</span><span class="function">stc2wx</span><span class="symbol">(</span><span class="normal">list</span><span class="symbol">),</span><span class="normal"> </span><span class="symbol">(</span><span class="normal">wxChar</span><span class="symbol">)</span><span class="normal">separator</span><span class="symbol">);</span>
<span class="normal">    </span><span class="keyword">while</span><span class="normal"> </span><span class="symbol">(</span><span class="normal"> tkzr</span><span class="symbol">.</span><span class="function">HasMoreTokens</span><span class="symbol">()</span><span class="normal"> </span><span class="symbol">)</span><span class="normal"> </span><span class="cbracket">{</span>
<span class="normal">        </span><span class="usertype">wxString</span><span class="normal"> token </span><span class="symbol">=</span><span class="normal"> tkzr</span><span class="symbol">.</span><span class="function">GetNextToken</span><span class="symbol">();</span>
<span class="normal">        </span><span class="type">long</span><span class="normal"> type </span><span class="symbol">=</span><span class="normal"> </span><span class="symbol">-</span><span class="number">1</span><span class="symbol">;</span>
<span class="normal">        </span><span class="type">int</span><span class="normal"> pos </span><span class="symbol">=</span><span class="normal"> token</span><span class="symbol">.</span><span class="function">Find</span><span class="symbol">(</span><span class="normal">typesep</span><span class="symbol">);</span>
<span class="normal">        </span><span class="keyword">if</span><span class="normal"> </span><span class="symbol">(</span><span class="normal">pos </span><span class="symbol">!=</span><span class="normal"> </span><span class="symbol">-</span><span class="number">1</span><span class="symbol">)</span><span class="normal"> </span><span class="cbracket">{</span>
<span class="normal">            token</span><span class="symbol">.</span><span class="function">Mid</span><span class="symbol">(</span><span class="normal">pos</span><span class="symbol">+</span><span class="number">1</span><span class="symbol">).</span><span class="function">ToLong</span><span class="symbol">(&amp;</span><span class="normal">type</span><span class="symbol">);</span>
<span class="normal">            token</span><span class="symbol">.</span><span class="function">Truncate</span><span class="symbol">(</span><span class="normal">pos</span><span class="symbol">);</span>
<span class="normal">        </span><span class="cbracket">}</span>
<span class="normal">        </span><span class="function">Append</span><span class="symbol">(</span><span class="normal">token</span><span class="symbol">,</span><span class="normal"> </span><span class="symbol">(</span><span class="type">int</span><span class="symbol">)</span><span class="normal">type</span><span class="symbol">);</span>
<span class="normal">    </span><span class="cbracket">}</span>
<span class="normal">    </span><span class="function">GETLB</span><span class="symbol">(</span><span class="normal">wid</span><span class="symbol">)-&gt;</span><span class="function">Thaw</span><span class="symbol">();</span>
<span class="cbracket">}</span>


<span class="type">int</span><span class="normal"> ListBoxImpl</span><span class="symbol">::</span><span class="function">Length</span><span class="symbol">()</span><span class="normal"> </span><span class="cbracket">{</span>
<span class="normal">    </span><span class="keyword">return</span><span class="normal"> </span><span class="function">GETLB</span><span class="symbol">(</span><span class="normal">wid</span><span class="symbol">)-&gt;</span><span class="function">GetItemCount</span><span class="symbol">();</span>
<span class="cbracket">}</span>


<span class="type">void</span><span class="normal"> ListBoxImpl</span><span class="symbol">::</span><span class="function">Select</span><span class="symbol">(</span><span class="type">int</span><span class="normal"> n</span><span class="symbol">)</span><span class="normal"> </span><span class="cbracket">{</span>
<span class="normal">    </span><span class="type">bool</span><span class="normal"> select </span><span class="symbol">=</span><span class="normal"> </span><span class="keyword">true</span><span class="symbol">;</span>
<span class="normal">    </span><span class="keyword">if</span><span class="normal"> </span><span class="symbol">(</span><span class="normal">n </span><span class="symbol">==</span><span class="normal"> </span><span class="symbol">-</span><span class="number">1</span><span class="symbol">)</span><span class="normal"> </span><span class="cbracket">{</span>
<span class="normal">        n </span><span class="symbol">=</span><span class="normal"> </span><span class="number">0</span><span class="symbol">;</span>
<span class="normal">        select </span><span class="symbol">=</span><span class="normal"> </span><span class="keyword">false</span><span class="symbol">;</span>
<span class="normal">    </span><span class="cbracket">}</span>
<span class="normal">    </span><span class="function">GETLB</span><span class="symbol">(</span><span class="normal">wid</span><span class="symbol">)-&gt;</span><span class="function">EnsureVisible</span><span class="symbol">(</span><span class="normal">n</span><span class="symbol">);</span>
<span class="normal">    </span><span class="function">GETLB</span><span class="symbol">(</span><span class="normal">wid</span><span class="symbol">)-&gt;</span><span class="function">Select</span><span class="symbol">(</span><span class="normal">n</span><span class="symbol">,</span><span class="normal"> select</span><span class="symbol">);</span>
<span class="cbracket">}</span>


<span class="type">int</span><span class="normal"> ListBoxImpl</span><span class="symbol">::</span><span class="function">GetSelection</span><span class="symbol">()</span><span class="normal"> </span><span class="cbracket">{</span>
<span class="normal">    </span><span class="keyword">return</span><span class="normal"> </span><span class="function">GETLB</span><span class="symbol">(</span><span class="normal">wid</span><span class="symbol">)-&gt;</span><span class="function">GetFirstSelected</span><span class="symbol">();</span>
<span class="cbracket">}</span>


<span class="type">int</span><span class="normal"> ListBoxImpl</span><span class="symbol">::</span><span class="function">Find</span><span class="symbol">(</span><span class="keyword">const</span><span class="normal"> </span><span class="type">char</span><span class="normal"> </span><span class="symbol">*</span><span class="function">WXUNUSED</span><span class="symbol">(</span><span class="normal">prefix</span><span class="symbol">))</span><span class="normal"> </span><span class="cbracket">{</span>
<span class="normal">    </span><span class="comment">// No longer used</span>
<span class="normal">    </span><span class="keyword">return</span><span class="normal"> wxNOT_FOUND</span><span class="symbol">;</span>
<span class="cbracket">}</span>


<span class="type">void</span><span class="normal"> ListBoxImpl</span><span class="symbol">::</span><span class="function">GetValue</span><span class="symbol">(</span><span class="type">int</span><span class="normal"> n</span><span class="symbol">,</span><span class="normal"> </span><span class="type">char</span><span class="normal"> </span><span class="symbol">*</span><span class="normal">value</span><span class="symbol">,</span><span class="normal"> </span><span class="type">int</span><span class="normal"> len</span><span class="symbol">)</span><span class="normal"> </span><span class="cbracket">{</span>
<span class="normal">    </span><span class="usertype">wxListItem</span><span class="normal"> item</span><span class="symbol">;</span>
<span class="normal">    item</span><span class="symbol">.</span><span class="function">SetId</span><span class="symbol">(</span><span class="normal">n</span><span class="symbol">);</span>
<span class="normal">    item</span><span class="symbol">.</span><span class="function">SetColumn</span><span class="symbol">(</span><span class="number">1</span><span class="symbol">);</span>
<span class="normal">    item</span><span class="symbol">.</span><span class="function">SetMask</span><span class="symbol">(</span><span class="normal">wxLIST_MASK_TEXT</span><span class="symbol">);</span>
<span class="normal">    </span><span class="function">GETLB</span><span class="symbol">(</span><span class="normal">wid</span><span class="symbol">)-&gt;</span><span class="function">GetItem</span><span class="symbol">(</span><span class="normal">item</span><span class="symbol">);</span>
<span class="normal">    </span><span class="function">strncpy</span><span class="symbol">(</span><span class="normal">value</span><span class="symbol">,</span><span class="normal"> </span><span class="function">wx2stcz</span><span class="symbol">(</span><span class="normal">item</span><span class="symbol">.</span><span class="function">GetText</span><span class="symbol">()),</span><span class="normal"> len</span><span class="symbol">);</span>
<span class="normal">    value</span><span class="symbol">[</span><span class="normal">len</span><span class="symbol">-</span><span class="number">1</span><span class="symbol">]</span><span class="normal"> </span><span class="symbol">=</span><span class="normal"> </span><span class="string">'</span><span class="specialchar">\0</span><span class="string">'</span><span class="symbol">;</span>
<span class="cbracket">}</span>


<span class="type">void</span><span class="normal"> ListBoxImpl</span><span class="symbol">::</span><span class="function">RegisterImage</span><span class="symbol">(</span><span class="type">int</span><span class="normal"> type</span><span class="symbol">,</span><span class="normal"> </span><span class="keyword">const</span><span class="normal"> </span><span class="type">char</span><span class="normal"> </span><span class="symbol">*</span><span class="normal">xpm_data</span><span class="symbol">)</span><span class="normal"> </span><span class="cbracket">{</span>
<span class="normal">    </span><span class="usertype">wxMemoryInputStream</span><span class="normal"> </span><span class="function">stream</span><span class="symbol">(</span><span class="normal">xpm_data</span><span class="symbol">,</span><span class="normal"> </span><span class="function">strlen</span><span class="symbol">(</span><span class="normal">xpm_data</span><span class="symbol">)+</span><span class="number">1</span><span class="symbol">);</span>
<span class="normal">    </span><span class="usertype">wxImage</span><span class="normal"> </span><span class="function">img</span><span class="symbol">(</span><span class="normal">stream</span><span class="symbol">,</span><span class="normal"> wxBITMAP_TYPE_XPM</span><span class="symbol">);</span>
<span class="normal">    </span><span class="usertype">wxBitmap</span><span class="normal"> </span><span class="function">bmp</span><span class="symbol">(</span><span class="normal">img</span><span class="symbol">);</span>

<span class="normal">    </span><span class="keyword">if</span><span class="normal"> </span><span class="symbol">(!</span><span class="normal"> imgList</span><span class="symbol">)</span><span class="normal"> </span><span class="cbracket">{</span>
<span class="normal">        </span><span class="comment">// assumes all images are the same size</span>
<span class="normal">        imgList </span><span class="symbol">=</span><span class="normal"> </span><span class="keyword">new</span><span class="normal"> </span><span class="function">wxImageList</span><span class="symbol">(</span><span class="normal">bmp</span><span class="symbol">.</span><span class="function">GetWidth</span><span class="symbol">(),</span><span class="normal"> bmp</span><span class="symbol">.</span><span class="function">GetHeight</span><span class="symbol">(),</span><span class="normal"> </span><span class="keyword">true</span><span class="symbol">);</span>
<span class="normal">        imgTypeMap </span><span class="symbol">=</span><span class="normal"> </span><span class="keyword">new</span><span class="normal"> wxArrayInt</span><span class="symbol">;</span>
<span class="normal">    </span><span class="cbracket">}</span>

<span class="normal">    </span><span class="type">int</span><span class="normal"> idx </span><span class="symbol">=</span><span class="normal"> imgList</span><span class="symbol">-&gt;</span><span class="function">Add</span><span class="symbol">(</span><span class="normal">bmp</span><span class="symbol">);</span>

<span class="normal">    </span><span class="comment">// do we need to extend the mapping array?</span>
<span class="normal">    wxArrayInt</span><span class="symbol">&amp;</span><span class="normal"> itm </span><span class="symbol">=</span><span class="normal"> </span><span class="symbol">*</span><span class="normal">imgTypeMap</span><span class="symbol">;</span>
<span class="normal">    </span><span class="keyword">if</span><span class="normal"> </span><span class="symbol">(</span><span class="normal"> itm</span><span class="symbol">.</span><span class="function">GetCount</span><span class="symbol">()</span><span class="normal"> </span><span class="symbol">&lt;</span><span class="normal"> </span><span class="symbol">(</span><span class="normal">size_t</span><span class="symbol">)</span><span class="normal">type</span><span class="symbol">+</span><span class="number">1</span><span class="symbol">)</span>
<span class="normal">        itm</span><span class="symbol">.</span><span class="function">Add</span><span class="symbol">(-</span><span class="number">1</span><span class="symbol">,</span><span class="normal"> type </span><span class="symbol">-</span><span class="normal"> itm</span><span class="symbol">.</span><span class="function">GetCount</span><span class="symbol">()</span><span class="normal"> </span><span class="symbol">+</span><span class="normal"> </span><span class="number">1</span><span class="symbol">);</span>

<span class="normal">    </span><span class="comment">// Add an item that maps type to the image index</span>
<span class="normal">    itm</span><span class="symbol">[</span><span class="normal">type</span><span class="symbol">]</span><span class="normal"> </span><span class="symbol">=</span><span class="normal"> idx</span><span class="symbol">;</span>
<span class="cbracket">}</span>

<span class="type">void</span><span class="normal"> ListBoxImpl</span><span class="symbol">::</span><span class="function">ClearRegisteredImages</span><span class="symbol">()</span><span class="normal"> </span><span class="cbracket">{</span>
<span class="normal">    </span><span class="keyword">if</span><span class="normal"> </span><span class="symbol">(</span><span class="normal">imgList</span><span class="symbol">)</span><span class="normal"> </span><span class="cbracket">{</span>
<span class="normal">        </span><span class="keyword">delete</span><span class="normal"> imgList</span><span class="symbol">;</span>
<span class="normal">        imgList </span><span class="symbol">=</span><span class="normal"> NULL</span><span class="symbol">;</span>
<span class="normal">    </span><span class="cbracket">}</span>
<span class="normal">    </span><span class="keyword">if</span><span class="normal"> </span><span class="symbol">(</span><span class="normal">imgTypeMap</span><span class="symbol">)</span><span class="normal"> </span><span class="cbracket">{</span>
<span class="normal">        </span><span class="keyword">delete</span><span class="normal"> imgTypeMap</span><span class="symbol">;</span>
<span class="normal">        imgTypeMap </span><span class="symbol">=</span><span class="normal"> NULL</span><span class="symbol">;</span>
<span class="normal">    </span><span class="cbracket">}</span>
<span class="normal">    </span><span class="keyword">if</span><span class="normal"> </span><span class="symbol">(</span><span class="normal">wid</span><span class="symbol">)</span>
<span class="normal">        </span><span class="function">GETLB</span><span class="symbol">(</span><span class="normal">wid</span><span class="symbol">)-&gt;</span><span class="function">SetImageList</span><span class="symbol">(</span><span class="normal">NULL</span><span class="symbol">,</span><span class="normal"> wxIMAGE_LIST_SMALL</span><span class="symbol">);</span>
<span class="cbracket">}</span>


<span class="type">void</span><span class="normal"> ListBoxImpl</span><span class="symbol">::</span><span class="function">SetDoubleClickAction</span><span class="symbol">(</span><span class="usertype">CallBackAction</span><span class="normal"> action</span><span class="symbol">,</span><span class="normal"> </span><span class="type">void</span><span class="normal"> </span><span class="symbol">*</span><span class="normal">data</span><span class="symbol">)</span><span class="normal"> </span><span class="cbracket">{</span>
<span class="normal">    </span><span class="function">GETLBW</span><span class="symbol">(</span><span class="normal">wid</span><span class="symbol">)-&gt;</span><span class="function">SetDoubleClickAction</span><span class="symbol">(</span><span class="normal">action</span><span class="symbol">,</span><span class="normal"> data</span><span class="symbol">);</span>
<span class="cbracket">}</span>


<span class="normal">ListBox</span><span class="symbol">::</span><span class="function">ListBox</span><span class="symbol">()</span><span class="normal"> </span><span class="cbracket">{</span>
<span class="cbracket">}</span>

<span class="normal">ListBox</span><span class="symbol">::~</span><span class="function">ListBox</span><span class="symbol">()</span><span class="normal"> </span><span class="cbracket">{</span>
<span class="cbracket">}</span>

<span class="usertype">ListBox</span><span class="normal"> </span><span class="symbol">*</span><span class="normal">ListBox</span><span class="symbol">::</span><span class="function">Allocate</span><span class="symbol">()</span><span class="normal"> </span><span class="cbracket">{</span>
<span class="normal">    </span><span class="keyword">return</span><span class="normal"> </span><span class="keyword">new</span><span class="normal"> </span><span class="function">ListBoxImpl</span><span class="symbol">();</span>
<span class="cbracket">}</span>

<span class="comment">//----------------------------------------------------------------------</span>

<span class="normal">Menu</span><span class="symbol">::</span><span class="function">Menu</span><span class="symbol">()</span><span class="normal"> </span><span class="symbol">:</span><span class="normal"> </span><span class="function">mid</span><span class="symbol">(</span><span class="number">0</span><span class="symbol">)</span><span class="normal"> </span><span class="cbracket">{</span>
<span class="cbracket">}</span>

<span class="type">void</span><span class="normal"> Menu</span><span class="symbol">::</span><span class="function">CreatePopUp</span><span class="symbol">()</span><span class="normal"> </span><span class="cbracket">{</span>
<span class="normal">    </span><span class="function">Destroy</span><span class="symbol">();</span>
<span class="normal">    mid </span><span class="symbol">=</span><span class="normal"> </span><span class="keyword">new</span><span class="normal"> </span><span class="function">wxMenu</span><span class="symbol">();</span>
<span class="cbracket">}</span>

<span class="type">void</span><span class="normal"> Menu</span><span class="symbol">::</span><span class="function">Destroy</span><span class="symbol">()</span><span class="normal"> </span><span class="cbracket">{</span>
<span class="normal">    </span><span class="keyword">if</span><span class="normal"> </span><span class="symbol">(</span><span class="normal">mid</span><span class="symbol">)</span>
<span class="normal">        </span><span class="keyword">delete</span><span class="normal"> </span><span class="symbol">(</span><span class="normal">wxMenu</span><span class="symbol">*)</span><span class="normal">mid</span><span class="symbol">;</span>
<span class="normal">    mid </span><span class="symbol">=</span><span class="normal"> </span><span class="number">0</span><span class="symbol">;</span>
<span class="cbracket">}</span>

<span class="type">void</span><span class="normal"> Menu</span><span class="symbol">::</span><span class="function">Show</span><span class="symbol">(</span><span class="usertype">Point</span><span class="normal"> pt</span><span class="symbol">,</span><span class="normal"> </span><span class="usertype">Window</span><span class="normal"> </span><span class="symbol">&amp;</span><span class="normal">w</span><span class="symbol">)</span><span class="normal"> </span><span class="cbracket">{</span>
<span class="normal">    </span><span class="function">GETWIN</span><span class="symbol">(</span><span class="normal">w</span><span class="symbol">.</span><span class="function">GetID</span><span class="symbol">())-&gt;</span><span class="function">PopupMenu</span><span class="symbol">((</span><span class="normal">wxMenu</span><span class="symbol">*)</span><span class="normal">mid</span><span class="symbol">,</span><span class="normal"> pt</span><span class="symbol">.</span><span class="normal">x </span><span class="symbol">-</span><span class="normal"> </span><span class="number">4</span><span class="symbol">,</span><span class="normal"> pt</span><span class="symbol">.</span><span class="normal">y</span><span class="symbol">);</span>
<span class="normal">    </span><span class="function">Destroy</span><span class="symbol">();</span>
<span class="cbracket">}</span>

<span class="comment">//----------------------------------------------------------------------</span>

<span class="usertype">DynamicLibrary</span><span class="normal"> </span><span class="symbol">*</span><span class="normal">DynamicLibrary</span><span class="symbol">::</span><span class="function">Load</span><span class="symbol">(</span><span class="keyword">const</span><span class="normal"> </span><span class="type">char</span><span class="normal"> </span><span class="symbol">*</span><span class="function">WXUNUSED</span><span class="symbol">(</span><span class="normal">modulePath</span><span class="symbol">))</span><span class="normal"> </span><span class="cbracket">{</span>
<span class="normal">    </span><span class="function">wxFAIL_MSG</span><span class="symbol">(</span><span class="function">wxT</span><span class="symbol">(</span><span class="string">"Dynamic lexer loading not implemented yet"</span><span class="symbol">));</span>
<span class="normal">    </span><span class="keyword">return</span><span class="normal"> NULL</span><span class="symbol">;</span>
<span class="cbracket">}</span>

<span class="comment">//----------------------------------------------------------------------</span>

<span class="usertype">ColourDesired</span><span class="normal"> Platform</span><span class="symbol">::</span><span class="function">Chrome</span><span class="symbol">()</span><span class="normal"> </span><span class="cbracket">{</span>
<span class="normal">    </span><span class="usertype">wxColour</span><span class="normal"> c</span><span class="symbol">;</span>
<span class="normal">    c </span><span class="symbol">=</span><span class="normal"> wxSystemSettings</span><span class="symbol">::</span><span class="function">GetColour</span><span class="symbol">(</span><span class="normal">wxSYS_COLOUR_3DFACE</span><span class="symbol">);</span>
<span class="normal">    </span><span class="keyword">return</span><span class="normal"> </span><span class="function">ColourDesired</span><span class="symbol">(</span><span class="normal">c</span><span class="symbol">.</span><span class="function">Red</span><span class="symbol">(),</span><span class="normal"> c</span><span class="symbol">.</span><span class="function">Green</span><span class="symbol">(),</span><span class="normal"> c</span><span class="symbol">.</span><span class="function">Blue</span><span class="symbol">());</span>
<span class="cbracket">}</span>

<span class="usertype">ColourDesired</span><span class="normal"> Platform</span><span class="symbol">::</span><span class="function">ChromeHighlight</span><span class="symbol">()</span><span class="normal"> </span><span class="cbracket">{</span>
<span class="normal">    </span><span class="usertype">wxColour</span><span class="normal"> c</span><span class="symbol">;</span>
<span class="normal">    c </span><span class="symbol">=</span><span class="normal"> wxSystemSettings</span><span class="symbol">::</span><span class="function">GetColour</span><span class="symbol">(</span><span class="normal">wxSYS_COLOUR_3DHIGHLIGHT</span><span class="symbol">);</span>
<span class="normal">    </span><span class="keyword">return</span><span class="normal"> </span><span class="function">ColourDesired</span><span class="symbol">(</span><span class="normal">c</span><span class="symbol">.</span><span class="function">Red</span><span class="symbol">(),</span><span class="normal"> c</span><span class="symbol">.</span><span class="function">Green</span><span class="symbol">(),</span><span class="normal"> c</span><span class="symbol">.</span><span class="function">Blue</span><span class="symbol">());</span>
<span class="cbracket">}</span>

<span class="keyword">const</span><span class="normal"> </span><span class="type">char</span><span class="normal"> </span><span class="symbol">*</span><span class="normal">Platform</span><span class="symbol">::</span><span class="function">DefaultFont</span><span class="symbol">()</span><span class="normal"> </span><span class="cbracket">{</span>
<span class="normal">    </span><span class="keyword">static</span><span class="normal"> </span><span class="type">char</span><span class="normal"> buf</span><span class="symbol">[</span><span class="number">128</span><span class="symbol">];</span>
<span class="normal">    </span><span class="function">strcpy</span><span class="symbol">(</span><span class="normal">buf</span><span class="symbol">,</span><span class="normal"> wxNORMAL_FONT</span><span class="symbol">-&gt;</span><span class="function">GetFaceName</span><span class="symbol">().</span><span class="function">mbc_str</span><span class="symbol">());</span>
<span class="normal">    </span><span class="keyword">return</span><span class="normal"> buf</span><span class="symbol">;</span>
<span class="cbracket">}</span>

<span class="type">int</span><span class="normal"> Platform</span><span class="symbol">::</span><span class="function">DefaultFontSize</span><span class="symbol">()</span><span class="normal"> </span><span class="cbracket">{</span>
<span class="normal">    </span><span class="keyword">return</span><span class="normal"> wxNORMAL_FONT</span><span class="symbol">-&gt;</span><span class="function">GetPointSize</span><span class="symbol">();</span>
<span class="cbracket">}</span>

<span class="type">unsigned</span><span class="normal"> </span><span class="type">int</span><span class="normal"> Platform</span><span class="symbol">::</span><span class="function">DoubleClickTime</span><span class="symbol">()</span><span class="normal"> </span><span class="cbracket">{</span>
<span class="normal">    </span><span class="keyword">return</span><span class="normal"> </span><span class="number">500</span><span class="symbol">;</span><span class="normal">   </span><span class="comment">// **** ::GetDoubleClickTime();</span>
<span class="cbracket">}</span>

<span class="type">bool</span><span class="normal"> Platform</span><span class="symbol">::</span><span class="function">MouseButtonBounce</span><span class="symbol">()</span><span class="normal"> </span><span class="cbracket">{</span>
<span class="normal">    </span><span class="keyword">return</span><span class="normal"> </span><span class="keyword">false</span><span class="symbol">;</span>
<span class="cbracket">}</span>

<span class="type">bool</span><span class="normal"> Platform</span><span class="symbol">::</span><span class="function">IsKeyDown</span><span class="symbol">(</span><span class="type">int</span><span class="normal"> </span><span class="function">WXUNUSED</span><span class="symbol">(</span><span class="normal">key</span><span class="symbol">))</span><span class="normal"> </span><span class="cbracket">{</span>
<span class="normal">    </span><span class="keyword">return</span><span class="normal"> </span><span class="keyword">false</span><span class="symbol">;</span><span class="normal">  </span><span class="comment">// I don't think we'll need this.</span>
<span class="cbracket">}</span>

<span class="type">long</span><span class="normal"> Platform</span><span class="symbol">::</span><span class="function">SendScintilla</span><span class="symbol">(</span><span class="usertype">WindowID</span><span class="normal"> w</span><span class="symbol">,</span>
<span class="normal">                             </span><span class="type">unsigned</span><span class="normal"> </span><span class="type">int</span><span class="normal"> msg</span><span class="symbol">,</span>
<span class="normal">                             </span><span class="type">unsigned</span><span class="normal"> </span><span class="type">long</span><span class="normal"> wParam</span><span class="symbol">,</span>
<span class="normal">                             </span><span class="type">long</span><span class="normal"> lParam</span><span class="symbol">)</span><span class="normal"> </span><span class="cbracket">{</span>

<span class="normal">    wxStyledTextCtrl</span><span class="symbol">*</span><span class="normal"> stc </span><span class="symbol">=</span><span class="normal"> </span><span class="symbol">(</span><span class="normal">wxStyledTextCtrl</span><span class="symbol">*)</span><span class="normal">w</span><span class="symbol">;</span>
<span class="normal">    </span><span class="keyword">return</span><span class="normal"> stc</span><span class="symbol">-&gt;</span><span class="function">SendMsg</span><span class="symbol">(</span><span class="normal">msg</span><span class="symbol">,</span><span class="normal"> wParam</span><span class="symbol">,</span><span class="normal"> lParam</span><span class="symbol">);</span>
<span class="cbracket">}</span>

<span class="type">long</span><span class="normal"> Platform</span><span class="symbol">::</span><span class="function">SendScintillaPointer</span><span class="symbol">(</span><span class="usertype">WindowID</span><span class="normal"> w</span><span class="symbol">,</span>
<span class="normal">                                    </span><span class="type">unsigned</span><span class="normal"> </span><span class="type">int</span><span class="normal"> msg</span><span class="symbol">,</span>
<span class="normal">                                    </span><span class="type">unsigned</span><span class="normal"> </span><span class="type">long</span><span class="normal"> wParam</span><span class="symbol">,</span>
<span class="normal">                                    </span><span class="type">void</span><span class="normal"> </span><span class="symbol">*</span><span class="normal">lParam</span><span class="symbol">)</span><span class="normal"> </span><span class="cbracket">{</span>

<span class="normal">    wxStyledTextCtrl</span><span class="symbol">*</span><span class="normal"> stc </span><span class="symbol">=</span><span class="normal"> </span><span class="symbol">(</span><span class="normal">wxStyledTextCtrl</span><span class="symbol">*)</span><span class="normal">w</span><span class="symbol">;</span>
<span class="normal">    </span><span class="keyword">return</span><span class="normal"> stc</span><span class="symbol">-&gt;</span><span class="function">SendMsg</span><span class="symbol">(</span><span class="normal">msg</span><span class="symbol">,</span><span class="normal"> wParam</span><span class="symbol">,</span><span class="normal"> </span><span class="symbol">(</span><span class="type">long</span><span class="symbol">)</span><span class="normal">lParam</span><span class="symbol">);</span>
<span class="cbracket">}</span>


<span class="comment">// These are utility functions not really tied to a platform</span>

<span class="type">int</span><span class="normal"> Platform</span><span class="symbol">::</span><span class="function">Minimum</span><span class="symbol">(</span><span class="type">int</span><span class="normal"> a</span><span class="symbol">,</span><span class="normal"> </span><span class="type">int</span><span class="normal"> b</span><span class="symbol">)</span><span class="normal"> </span><span class="cbracket">{</span>
<span class="normal">    </span><span class="keyword">if</span><span class="normal"> </span><span class="symbol">(</span><span class="normal">a </span><span class="symbol">&lt;</span><span class="normal"> b</span><span class="symbol">)</span>
<span class="normal">        </span><span class="keyword">return</span><span class="normal"> a</span><span class="symbol">;</span>
<span class="normal">    </span><span class="keyword">else</span>
<span class="normal">        </span><span class="keyword">return</span><span class="normal"> b</span><span class="symbol">;</span>
<span class="cbracket">}</span>

<span class="type">int</span><span class="normal"> Platform</span><span class="symbol">::</span><span class="function">Maximum</span><span class="symbol">(</span><span class="type">int</span><span class="normal"> a</span><span class="symbol">,</span><span class="normal"> </span><span class="type">int</span><span class="normal"> b</span><span class="symbol">)</span><span class="normal"> </span><span class="cbracket">{</span>
<span class="normal">    </span><span class="keyword">if</span><span class="normal"> </span><span class="symbol">(</span><span class="normal">a </span><span class="symbol">&gt;</span><span class="normal"> b</span><span class="symbol">)</span>
<span class="normal">        </span><span class="keyword">return</span><span class="normal"> a</span><span class="symbol">;</span>
<span class="normal">    </span><span class="keyword">else</span>
<span class="normal">        </span><span class="keyword">return</span><span class="normal"> b</span><span class="symbol">;</span>
<span class="cbracket">}</span>

<span class="comment">//#define TRACE</span>

<span class="type">void</span><span class="normal"> Platform</span><span class="symbol">::</span><span class="function">DebugDisplay</span><span class="symbol">(</span><span class="keyword">const</span><span class="normal"> </span><span class="type">char</span><span class="normal"> </span><span class="symbol">*</span><span class="normal">s</span><span class="symbol">)</span><span class="normal"> </span><span class="cbracket">{</span>
<span class="preproc">#ifdef</span><span class="normal"> TRACE</span>
<span class="normal">    </span><span class="function">wxLogDebug</span><span class="symbol">(</span><span class="function">stc2wx</span><span class="symbol">(</span><span class="normal">s</span><span class="symbol">));</span>
<span class="preproc">#else</span>
<span class="normal">    </span><span class="function">wxUnusedVar</span><span class="symbol">(</span><span class="normal">s</span><span class="symbol">);</span>
<span class="preproc">#endif</span>
<span class="cbracket">}</span>

<span class="type">void</span><span class="normal"> Platform</span><span class="symbol">::</span><span class="function">DebugPrintf</span><span class="symbol">(</span><span class="keyword">const</span><span class="normal"> </span><span class="type">char</span><span class="normal"> </span><span class="symbol">*</span><span class="normal">format</span><span class="symbol">,</span><span class="normal"> </span><span class="symbol">...)</span><span class="normal"> </span><span class="cbracket">{</span>
<span class="preproc">#ifdef</span><span class="normal"> TRACE</span>
<span class="normal">    </span><span class="type">char</span><span class="normal"> buffer</span><span class="symbol">[</span><span class="number">2000</span><span class="symbol">];</span>
<span class="normal">    </span><span class="usertype">va_list</span><span class="normal"> pArguments</span><span class="symbol">;</span>
<span class="normal">    </span><span class="function">va_start</span><span class="symbol">(</span><span class="normal">pArguments</span><span class="symbol">,</span><span class="normal"> format</span><span class="symbol">);</span>
<span class="normal">    </span><span class="function">vsprintf</span><span class="symbol">(</span><span class="normal">buffer</span><span class="symbol">,</span><span class="normal">format</span><span class="symbol">,</span><span class="normal">pArguments</span><span class="symbol">);</span>
<span class="normal">    </span><span class="function">va_end</span><span class="symbol">(</span><span class="normal">pArguments</span><span class="symbol">);</span>
<span class="normal">    Platform</span><span class="symbol">::</span><span class="function">DebugDisplay</span><span class="symbol">(</span><span class="normal">buffer</span><span class="symbol">);</span>
<span class="preproc">#endif</span>
<span class="cbracket">}</span>


<span class="keyword">static</span><span class="normal"> </span><span class="type">bool</span><span class="normal"> assertionPopUps </span><span class="symbol">=</span><span class="normal"> </span><span class="keyword">true</span><span class="symbol">;</span>

<span class="type">bool</span><span class="normal"> Platform</span><span class="symbol">::</span><span class="function">ShowAssertionPopUps</span><span class="symbol">(</span><span class="type">bool</span><span class="normal"> assertionPopUps_</span><span class="symbol">)</span><span class="normal"> </span><span class="cbracket">{</span>
<span class="normal">    </span><span class="type">bool</span><span class="normal"> ret </span><span class="symbol">=</span><span class="normal"> assertionPopUps</span><span class="symbol">;</span>
<span class="normal">    assertionPopUps </span><span class="symbol">=</span><span class="normal"> assertionPopUps_</span><span class="symbol">;</span>
<span class="normal">    </span><span class="keyword">return</span><span class="normal"> ret</span><span class="symbol">;</span>
<span class="cbracket">}</span>

<span class="type">void</span><span class="normal"> Platform</span><span class="symbol">::</span><span class="function">Assert</span><span class="symbol">(</span><span class="keyword">const</span><span class="normal"> </span><span class="type">char</span><span class="normal"> </span><span class="symbol">*</span><span class="normal">c</span><span class="symbol">,</span><span class="normal"> </span><span class="keyword">const</span><span class="normal"> </span><span class="type">char</span><span class="normal"> </span><span class="symbol">*</span><span class="normal">file</span><span class="symbol">,</span><span class="normal"> </span><span class="type">int</span><span class="normal"> line</span><span class="symbol">)</span><span class="normal"> </span><span class="cbracket">{</span>
<span class="preproc">#ifdef</span><span class="normal"> TRACE</span>
<span class="normal">    </span><span class="type">char</span><span class="normal"> buffer</span><span class="symbol">[</span><span class="number">2000</span><span class="symbol">];</span>
<span class="normal">    </span><span class="function">sprintf</span><span class="symbol">(</span><span class="normal">buffer</span><span class="symbol">,</span><span class="normal"> </span><span class="string">"Assertion [%s] failed at %s %d"</span><span class="symbol">,</span><span class="normal"> c</span><span class="symbol">,</span><span class="normal"> file</span><span class="symbol">,</span><span class="normal"> line</span><span class="symbol">);</span>
<span class="normal">    </span><span class="keyword">if</span><span class="normal"> </span><span class="symbol">(</span><span class="normal">assertionPopUps</span><span class="symbol">)</span><span class="normal"> </span><span class="cbracket">{</span>
<span class="normal">        </span><span class="comment">/*int idButton = */</span>
<span class="normal">        </span><span class="function">wxMessageBox</span><span class="symbol">(</span><span class="function">stc2wx</span><span class="symbol">(</span><span class="normal">buffer</span><span class="symbol">),</span>
<span class="normal">                     </span><span class="function">wxT</span><span class="symbol">(</span><span class="string">"Assertion failure"</span><span class="symbol">),</span>
<span class="normal">                     wxICON_HAND </span><span class="symbol">|</span><span class="normal"> wxOK</span><span class="symbol">);</span>
<span class="normal">    </span><span class="cbracket">}</span><span class="normal"> </span><span class="keyword">else</span><span class="normal"> </span><span class="cbracket">{</span>
<span class="normal">        </span><span class="function">strcat</span><span class="symbol">(</span><span class="normal">buffer</span><span class="symbol">,</span><span class="normal"> </span><span class="string">"</span><span class="specialchar">\r\n</span><span class="string">"</span><span class="symbol">);</span>
<span class="normal">        Platform</span><span class="symbol">::</span><span class="function">DebugDisplay</span><span class="symbol">(</span><span class="normal">buffer</span><span class="symbol">);</span>
<span class="normal">        </span><span class="function">abort</span><span class="symbol">();</span>
<span class="normal">    </span><span class="cbracket">}</span>
<span class="preproc">#else</span>
<span class="normal">    </span><span class="function">wxUnusedVar</span><span class="symbol">(</span><span class="normal">c</span><span class="symbol">);</span>
<span class="normal">    </span><span class="function">wxUnusedVar</span><span class="symbol">(</span><span class="normal">file</span><span class="symbol">);</span>
<span class="normal">    </span><span class="function">wxUnusedVar</span><span class="symbol">(</span><span class="normal">line</span><span class="symbol">);</span>
<span class="preproc">#endif</span>
<span class="cbracket">}</span>


<span class="type">int</span><span class="normal"> Platform</span><span class="symbol">::</span><span class="function">Clamp</span><span class="symbol">(</span><span class="type">int</span><span class="normal"> val</span><span class="symbol">,</span><span class="normal"> </span><span class="type">int</span><span class="normal"> minVal</span><span class="symbol">,</span><span class="normal"> </span><span class="type">int</span><span class="normal"> maxVal</span><span class="symbol">)</span><span class="normal"> </span><span class="cbracket">{</span>
<span class="normal">    </span><span class="keyword">if</span><span class="normal"> </span><span class="symbol">(</span><span class="normal">val </span><span class="symbol">&gt;</span><span class="normal"> maxVal</span><span class="symbol">)</span>
<span class="normal">        val </span><span class="symbol">=</span><span class="normal"> maxVal</span><span class="symbol">;</span>
<span class="normal">    </span><span class="keyword">if</span><span class="normal"> </span><span class="symbol">(</span><span class="normal">val </span><span class="symbol">&lt;</span><span class="normal"> minVal</span><span class="symbol">)</span>
<span class="normal">        val </span><span class="symbol">=</span><span class="normal"> minVal</span><span class="symbol">;</span>
<span class="normal">    </span><span class="keyword">return</span><span class="normal"> val</span><span class="symbol">;</span>
<span class="cbracket">}</span>


<span class="type">bool</span><span class="normal"> Platform</span><span class="symbol">::</span><span class="function">IsDBCSLeadByte</span><span class="symbol">(</span><span class="type">int</span><span class="normal"> </span><span class="function">WXUNUSED</span><span class="symbol">(</span><span class="normal">codePage</span><span class="symbol">),</span><span class="normal"> </span><span class="type">char</span><span class="normal"> </span><span class="function">WXUNUSED</span><span class="symbol">(</span><span class="normal">ch</span><span class="symbol">))</span><span class="normal"> </span><span class="cbracket">{</span>
<span class="normal">    </span><span class="keyword">return</span><span class="normal"> </span><span class="keyword">false</span><span class="symbol">;</span>
<span class="cbracket">}</span>

<span class="type">int</span><span class="normal"> Platform</span><span class="symbol">::</span><span class="function">DBCSCharLength</span><span class="symbol">(</span><span class="type">int</span><span class="normal"> </span><span class="function">WXUNUSED</span><span class="symbol">(</span><span class="normal">codePage</span><span class="symbol">),</span><span class="normal"> </span><span class="keyword">const</span><span class="normal"> </span><span class="type">char</span><span class="normal"> </span><span class="symbol">*</span><span class="function">WXUNUSED</span><span class="symbol">(</span><span class="normal">s</span><span class="symbol">))</span><span class="normal"> </span><span class="cbracket">{</span>
<span class="normal">    </span><span class="keyword">return</span><span class="normal"> </span><span class="number">1</span><span class="symbol">;</span>
<span class="cbracket">}</span>

<span class="type">int</span><span class="normal"> Platform</span><span class="symbol">::</span><span class="function">DBCSCharMaxLength</span><span class="symbol">()</span><span class="normal"> </span><span class="cbracket">{</span>
<span class="normal">    </span><span class="keyword">return</span><span class="normal"> </span><span class="number">1</span><span class="symbol">;</span>
<span class="cbracket">}</span>


<span class="comment">//----------------------------------------------------------------------</span>

<span class="normal">ElapsedTime</span><span class="symbol">::</span><span class="function">ElapsedTime</span><span class="symbol">()</span><span class="normal"> </span><span class="cbracket">{</span>
<span class="normal">    </span><span class="usertype">wxLongLong</span><span class="normal"> localTime </span><span class="symbol">=</span><span class="normal"> </span><span class="function">wxGetLocalTimeMillis</span><span class="symbol">();</span>
<span class="normal">    littleBit </span><span class="symbol">=</span><span class="normal"> localTime</span><span class="symbol">.</span><span class="function">GetLo</span><span class="symbol">();</span>
<span class="normal">    bigBit </span><span class="symbol">=</span><span class="normal"> localTime</span><span class="symbol">.</span><span class="function">GetHi</span><span class="symbol">();</span>
<span class="cbracket">}</span>

<span class="type">double</span><span class="normal"> ElapsedTime</span><span class="symbol">::</span><span class="function">Duration</span><span class="symbol">(</span><span class="type">bool</span><span class="normal"> reset</span><span class="symbol">)</span><span class="normal"> </span><span class="cbracket">{</span>
<span class="normal">    </span><span class="usertype">wxLongLong</span><span class="normal"> </span><span class="function">prevTime</span><span class="symbol">(</span><span class="normal">bigBit</span><span class="symbol">,</span><span class="normal"> littleBit</span><span class="symbol">);</span>
<span class="normal">    </span><span class="usertype">wxLongLong</span><span class="normal"> localTime </span><span class="symbol">=</span><span class="normal"> </span><span class="function">wxGetLocalTimeMillis</span><span class="symbol">();</span>
<span class="normal">    </span><span class="keyword">if</span><span class="symbol">(</span><span class="normal">reset</span><span class="symbol">)</span><span class="normal"> </span><span class="cbracket">{</span>
<span class="normal">        littleBit </span><span class="symbol">=</span><span class="normal"> localTime</span><span class="symbol">.</span><span class="function">GetLo</span><span class="symbol">();</span>
<span class="normal">        bigBit </span><span class="symbol">=</span><span class="normal"> localTime</span><span class="symbol">.</span><span class="function">GetHi</span><span class="symbol">();</span>
<span class="normal">    </span><span class="cbracket">}</span>
<span class="normal">    </span><span class="usertype">wxLongLong</span><span class="normal"> duration </span><span class="symbol">=</span><span class="normal"> localTime </span><span class="symbol">-</span><span class="normal"> prevTime</span><span class="symbol">;</span>
<span class="normal">    </span><span class="type">double</span><span class="normal"> result </span><span class="symbol">=</span><span class="normal"> duration</span><span class="symbol">.</span><span class="function">ToDouble</span><span class="symbol">();</span>
<span class="normal">    result </span><span class="symbol">/=</span><span class="normal"> </span><span class="number">1000.0</span><span class="symbol">;</span>
<span class="normal">    </span><span class="keyword">return</span><span class="normal"> result</span><span class="symbol">;</span>
<span class="cbracket">}</span>

<span class="cbracket">}</span><span class="normal"> </span><span class="comment">// namespace Scintilla</span>

<span class="comment">//----------------------------------------------------------------------</span>

<span class="preproc">#if</span><span class="normal"> wxUSE_UNICODE</span>

<span class="preproc">#include</span><span class="normal"> </span><span class="string">"UniConversion.h"</span>

<span class="comment">// Convert using Scintilla's functions instead of wx's, Scintilla's are more</span>
<span class="comment">// forgiving and won't assert...</span>

<span class="usertype">wxString</span><span class="normal"> </span><span class="function">stc2wx</span><span class="symbol">(</span><span class="keyword">const</span><span class="normal"> </span><span class="type">char</span><span class="symbol">*</span><span class="normal"> str</span><span class="symbol">)</span>
<span class="cbracket">{</span>
<span class="normal">    </span><span class="keyword">return</span><span class="normal"> </span><span class="function">stc2wx</span><span class="symbol">(</span><span class="normal">str</span><span class="symbol">,</span><span class="normal"> </span><span class="function">strlen</span><span class="symbol">(</span><span class="normal">str</span><span class="symbol">));</span>
<span class="cbracket">}</span>

<span class="usertype">wxString</span><span class="normal"> </span><span class="function">stc2wx</span><span class="symbol">(</span><span class="keyword">const</span><span class="normal"> </span><span class="type">char</span><span class="symbol">*</span><span class="normal"> str</span><span class="symbol">,</span><span class="normal"> </span><span class="usertype">size_t</span><span class="normal"> len</span><span class="symbol">)</span>
<span class="cbracket">{</span>
<span class="normal">    </span><span class="keyword">if</span><span class="normal"> </span><span class="symbol">(!</span><span class="normal">len</span><span class="symbol">)</span><span class="normal"> </span><span class="keyword">return</span><span class="normal"> wxEmptyString</span><span class="symbol">;</span>

<span class="normal">    </span><span class="usertype">size_t</span><span class="normal"> wclen </span><span class="symbol">=</span><span class="normal"> </span><span class="function">UTF16Length</span><span class="symbol">(</span><span class="normal">str</span><span class="symbol">,</span><span class="normal"> len</span><span class="symbol">);</span>
<span class="normal">    </span><span class="usertype">wxWCharBuffer</span><span class="normal"> </span><span class="function">buffer</span><span class="symbol">(</span><span class="normal">wclen</span><span class="symbol">+</span><span class="number">1</span><span class="symbol">);</span>

<span class="normal">    </span><span class="usertype">size_t</span><span class="normal"> actualLen </span><span class="symbol">=</span><span class="normal"> </span><span class="function">UTF16FromUTF8</span><span class="symbol">(</span><span class="normal">str</span><span class="symbol">,</span><span class="normal"> len</span><span class="symbol">,</span><span class="normal"> buffer</span><span class="symbol">.</span><span class="function">data</span><span class="symbol">(),</span><span class="normal"> wclen</span><span class="symbol">+</span><span class="number">1</span><span class="symbol">);</span>
<span class="normal">    </span><span class="keyword">return</span><span class="normal"> </span><span class="function">wxString</span><span class="symbol">(</span><span class="normal">buffer</span><span class="symbol">.</span><span class="function">data</span><span class="symbol">(),</span><span class="normal"> actualLen</span><span class="symbol">);</span>
<span class="cbracket">}</span>

<span class="keyword">const</span><span class="normal"> </span><span class="usertype">wxWX2MBbuf</span><span class="normal"> </span><span class="function">wx2stcz</span><span class="symbol">(</span><span class="keyword">const</span><span class="normal"> wxString</span><span class="symbol">&amp;</span><span class="normal"> str</span><span class="symbol">)</span>
<span class="cbracket">{</span>
<span class="normal">    </span><span class="keyword">const</span><span class="normal"> </span><span class="type">wchar_t</span><span class="symbol">*</span><span class="normal"> wcstr </span><span class="symbol">=</span><span class="normal"> str</span><span class="symbol">.</span><span class="function">c_str</span><span class="symbol">();</span>
<span class="normal">    </span><span class="usertype">size_t</span><span class="normal"> wclen         </span><span class="symbol">=</span><span class="normal"> str</span><span class="symbol">.</span><span class="function">length</span><span class="symbol">();</span>
<span class="normal">    </span><span class="usertype">size_t</span><span class="normal"> len           </span><span class="symbol">=</span><span class="normal"> </span><span class="function">UTF8Length</span><span class="symbol">(</span><span class="normal">wcstr</span><span class="symbol">,</span><span class="normal"> wclen</span><span class="symbol">);</span>

<span class="normal">    </span><span class="usertype">wxCharBuffer</span><span class="normal"> </span><span class="function">buffer</span><span class="symbol">(</span><span class="normal">len</span><span class="symbol">+</span><span class="number">1</span><span class="symbol">);</span>
<span class="normal">    </span><span class="function">UTF8FromUTF16</span><span class="symbol">(</span><span class="normal">wcstr</span><span class="symbol">,</span><span class="normal"> wclen</span><span class="symbol">,</span><span class="normal"> buffer</span><span class="symbol">.</span><span class="function">data</span><span class="symbol">(),</span><span class="normal"> len</span><span class="symbol">);</span>

<span class="normal">    </span><span class="comment">// TODO check NULL termination!!</span>

<span class="normal">    </span><span class="keyword">return</span><span class="normal"> buffer</span><span class="symbol">;</span>
<span class="cbracket">}</span>

<span class="keyword">const</span><span class="normal"> </span><span class="usertype">wxWX2MBbuf</span><span class="normal"> </span><span class="function">wx2stc</span><span class="symbol">(</span><span class="keyword">const</span><span class="normal"> wxString</span><span class="symbol">&amp;</span><span class="normal"> str</span><span class="symbol">,</span><span class="normal"> size_t</span><span class="symbol">&amp;</span><span class="normal"> outsize</span><span class="symbol">)</span>
<span class="cbracket">{</span>
<span class="normal">    </span><span class="keyword">const</span><span class="normal"> </span><span class="type">wchar_t</span><span class="symbol">*</span><span class="normal"> wcstr </span><span class="symbol">=</span><span class="normal"> str</span><span class="symbol">.</span><span class="function">c_str</span><span class="symbol">();</span>
<span class="normal">    </span><span class="usertype">size_t</span><span class="normal"> wclen         </span><span class="symbol">=</span><span class="normal"> str</span><span class="symbol">.</span><span class="function">length</span><span class="symbol">();</span>
<span class="normal">    </span><span class="usertype">size_t</span><span class="normal"> len           </span><span class="symbol">=</span><span class="normal"> </span><span class="function">UTF8Length</span><span class="symbol">(</span><span class="normal">wcstr</span><span class="symbol">,</span><span class="normal"> wclen</span><span class="symbol">);</span>

<span class="normal">    </span><span class="usertype">wxCharBuffer</span><span class="normal"> </span><span class="function">buffer</span><span class="symbol">(</span><span class="normal">len</span><span class="symbol">+</span><span class="number">1</span><span class="symbol">);</span>
<span class="normal">    </span><span class="function">UTF8FromUTF16</span><span class="symbol">(</span><span class="normal">wcstr</span><span class="symbol">,</span><span class="normal"> wclen</span><span class="symbol">,</span><span class="normal"> buffer</span><span class="symbol">.</span><span class="function">data</span><span class="symbol">(),</span><span class="normal"> len</span><span class="symbol">);</span>

<span class="normal">    outsize </span><span class="symbol">=</span><span class="normal"> len</span><span class="symbol">;</span>
<span class="normal">    </span><span class="keyword">return</span><span class="normal"> buffer</span><span class="symbol">;</span>
<span class="cbracket">}</span>

<span class="preproc">#endif</span>
</tt></pre></div><div style="text-align: right; padding: 8pt; font-size: 13px"><a href="/xmlfeed/weblog-rss20.xml"><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAFAAAAAPAgMAAAAOp6AcAAAADFBMVEVmZmb/ZgD///+JjnlbTUWmAAAACXBIWXMAAABIAAAASABGyWs+AAAACXZwQWcAAABQAAAADwCexKkxAAAAWUlEQVQYlWNgwAa0VmGAFQyqoSCQ/x8J/CBFMCt0ZdTU/F/7/+1HEkydFpoKVPn+93sUlUujQvP/7UcRTAuNDJ2a//s/imDqtKVZofm/1qGYSZk7sfodGwAAiobBJtffoNAAAAAASUVORK5CYII=" alt="RSS 2.0 Weblog Feed" width="80" height="15"/></a> <a href="/xmlfeed/weblog-atom10.xml"><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAFAAAAAPAgMAAAAOp6AcAAAADFBMVEVmZmb/ZgD///+JjnlbTUWmAAAAaklEQVQYlWNgwAa0VmGAFQyqoSCQ/x8J/CBFMDV16rTQ/H/7V//69+//v/3/9oMEI6cuAwr+fv/+/b5d///v//0eJBgWOhMo+Gs9UPAdXDBy6lSYyn9wQZCZS0GCYDPXQcykzJ1Y/Y4NAABKvL80wyoMPgAAAABJRU5ErkJggg==" alt="Atom 1.0 Weblog Feed" width="80" height="15"/></a> <a href="http://validator.w3.org/check?uri=referer"><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAFAAAAAPCAMAAABEF7i9AAAB1FBMVEUHQIgIRY0MN4QNRYoSRYsXUpIYVJQeUpUhWpgjUJMjWpgmU5QnXJkuYZ0uYpwwV5YyZJ4zaKM3ZaA5aaI6aqM6a6E8ZqA8Z6BAbaRBbqdCbaVHd61KSkpKcaZQUFBUf69UgbBVVVVXfq9Yg7NZhbJZh7RagrNeXVxeh7RfjLdgYGBiiLZmZmZnZ2doirhpkbt0m8F3m8B3ncJ5lb55ocR+ocSDgX+Do8eEpMqGhoaHp8iIpMeJjnmJpseKqMeOqsqPsdCQrcyVlZWVsM2Zs9CZtNCfu9ahoaGhuNShudSivNSjtMWjvNSmpqWnpqSrw9qvxNqyxdmyxdyzsK6zs7Ozx9y0xt21yN22tra4y+K80eK/v7/AwMDExMTEy9DH2ejK2+jM2ujN3uvP0dLR0NDR3uvS3uvS3+zU4u3V1dXY2dnY4u7Y4+3b5e/d3d3d5u/d5/De3t7f39/h4uLj4uHj6/Ll7PXm7fTn7/Xo7/Tp7/bq7Ozr6unr8ffw8PDw9vvx9fny+P7z8/Pz9vnz9vv3+fv4+vz5+vz6+vr6+/36/P36///7+/77/Pz7/f37/f78/Pz8/f38/f79/f39/f79/f/9/v79///+/v7+/v////3///+tYR2LAAABKklEQVQ4y2PQoTJg0JlNVYDPQBsyAMTAqaFes8tdsmdPCtA3MDStr3GKKK6myMAprgJ9pcpWs/MlRExYJBvNZLR0sigycHYOV1S7mtjsQJ4gf+HIFPXoWMs6qIGzIRiKZs9GFoEaMRuZhhrYqqJXy8uZYauRxC/VHew7e3YTPAxnI5swG6JxNrKBNjB1EFmIgV0+HA6C8pqqzhXG7BbJJROQIwViMYQ7G2oDQQNn57JyG7kxiCfObrBmS5+BHMuYLkTzMnYDm5WY4lOZZRPKZocxes+aPbuwCFsYohiICLvZsKBAMrDTQ7K/StveU8icTzrOL8JdLpOyWJ49u8Bx9ozw8DY7UYW03hhdxZAOSg2c3jN79rSJs1vSKmfOnpFXNJmynELlvExlAADnaZpLFGEC2wAAAABJRU5ErkJggg==" alt="Valid XHTML 1.1" width="80" height="15"/></a> <a href="http://jigsaw.w3.org/css-validator/check/referer"><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAFAAAAAPCAMAAABEF7i9AAAB1FBMVEUHQIgIRY0MN4QNRYoSRYsXUpIYVJQeUpUhWpgjUJMjWpgmU5QnXJkuYZ0uYpwwV5YyZJ4zaKM3ZaA5aaI6aqM6a6E8ZqA8Z6BAbaRBbqdCbaVHd61KSkpKcaZQUFBUf69UgbBVVVVXfq9Yg7NZhbJZh7RagrNeXVxeh7RfjLdgYGBiiLZmZmZnZ2doirhpkbt0m8F3m8B3ncJ5lb55ocR+ocSDgX+Do8eEpMqGhoaHp8iIpMeJjnmJpseKqMeOqsqPsdCQrcyVlZWVsM2Zs9CZtNCfu9ahoaGhuNShudSivNSjtMWjvNSmpqWnpqSrw9qvxNqyxdmyxdyzsK6zs7Ozx9y0xt21yN22tra4y+K80eK/v7/AwMDExMTEy9DH2ejK2+jM2ujN3uvP0dLR0NDR3uvS3uvS3+zU4u3V1dXY2dnY4u7Y4+3b5e/d3d3d5u/d5/De3t7f39/h4uLj4uHj6/Ll7PXm7fTn7/Xo7/Tp7/bq7Ozr6unr8ffw8PDw9vvx9fny+P7z8/Pz9vnz9vv3+fv4+vz5+vz6+vr6+/36/P36///7+/77/Pz7/f37/f78/Pz8/f38/f79/f39/f79/f/9/v79///+/v7+/v////3///+tYR2LAAABEUlEQVQ4y2PQoTJg0JlNVYDPQBsyAMTAqaFes8tdsmdPCtA3MDStr3GKKK6myMAprgJ9pcpWs/MlRExYJBvNZLR0sigycHYOV1S7mtjsQJ4gf+HIFPXoWMs6mIEQCsIjwhKoga0qerW8nBm2Gkn8Ut3BvrNnN8HCcDYM2cBIogzs8uFwEJTXVHWuMGa3SC6ZgIgUqCEwdxJr4OxcVm4jNwbxxNkN1mzpM2ajGIjsPGK9PLtZiSk+lVk2oWx2GKP3rNmzC4tQwpDoIIQb2Okh2V+lbe8pZM4nHecX4S6XSVksz55d4Dh7Rnh4m52oQlpvjK5iSAelBk7vmT172sTZLWmVM2fPyCuaTFlOoXJepjIAANlljDGY/l5pAAAAAElFTkSuQmCC" alt="Valid CSS (2.1)" width="80" height="15"/></a><br/>Copyright 2005-2020 <a href="/about/">Timo Bingmann</a> - <a href="/about/impressum.html">Impressum</a></div></body></html>