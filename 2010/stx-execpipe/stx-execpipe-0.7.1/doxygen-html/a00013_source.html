<!-- This comment will put IE 6, 7 and 8 in quirks mode -->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>STX Execution Pipe: stx-execpipe.cc Source File</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javaScript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body onload='searchBox.OnSelectItem(0);'>
<!-- Generated by Doxygen 1.6.3 -->
<script type="text/javascript"><!--
var searchBox = new SearchBox("searchBox", "search",false,'Search');
--></script>
<div class="navigation" id="top">
  <div class="tabs">
    <ul>
      <li><a href="index.html"><span>Main&nbsp;Page</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
      <li><a href="examples.html"><span>Examples</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <img id="MSearchSelect" src="search/search.png"
             onmouseover="return searchBox.OnSearchSelectShow()"
             onmouseout="return searchBox.OnSearchSelectHide()"
             alt=""/>
        <input type="text" id="MSearchField" value="Search" accesskey="S"
             onfocus="searchBox.OnSearchFieldFocus(true)" 
             onblur="searchBox.OnSearchFieldFocus(false)" 
             onkeyup="searchBox.OnSearchFieldChange(event)"/>
        <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
        </div>
      </li>
    </ul>
  </div>
  <div class="tabs">
    <ul>
      <li><a href="files.html"><span>File&nbsp;List</span></a></li>
    </ul>
  </div>
<h1>stx-execpipe.cc</h1><div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 <span class="comment">// -*- mode: c++; fill-column: 79 -*-</span>
<a name="l00002"></a>00002 <span class="comment">// $Id: stx-execpipe.cc 16 2010-07-30 15:04:11Z tb $</span>
<a name="l00003"></a>00003 
<a name="l00004"></a>00004 <span class="comment">/*</span>
<a name="l00005"></a>00005 <span class="comment"> * STX Execution Pipe Library v0.7.1</span>
<a name="l00006"></a>00006 <span class="comment"> * Copyright (C) 2010 Timo Bingmann</span>
<a name="l00007"></a>00007 <span class="comment"> *</span>
<a name="l00008"></a>00008 <span class="comment"> * This library is free software; you can redistribute it and/or modify it</span>
<a name="l00009"></a>00009 <span class="comment"> * under the terms of the GNU Lesser General Public License as published by the</span>
<a name="l00010"></a>00010 <span class="comment"> * Free Software Foundation; either version 2.1 of the License, or (at your</span>
<a name="l00011"></a>00011 <span class="comment"> * option) any later version.</span>
<a name="l00012"></a>00012 <span class="comment"> *</span>
<a name="l00013"></a>00013 <span class="comment"> * This library is distributed in the hope that it will be useful, but WITHOUT</span>
<a name="l00014"></a>00014 <span class="comment"> * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or</span>
<a name="l00015"></a>00015 <span class="comment"> * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU Lesser General Public License</span>
<a name="l00016"></a>00016 <span class="comment"> * for more details.</span>
<a name="l00017"></a>00017 <span class="comment"> *</span>
<a name="l00018"></a>00018 <span class="comment"> * You should have received a copy of the GNU Lesser General Public License</span>
<a name="l00019"></a>00019 <span class="comment"> * along with this library; if not, write to the Free Software Foundation,</span>
<a name="l00020"></a>00020 <span class="comment"> * Inc., 51 Franklin Street, Fifth Floor, Boston, MA 02110-1301 USA</span>
<a name="l00021"></a>00021 <span class="comment"> */</span>
<a name="l00022"></a>00022 
<a name="l00023"></a>00023 <span class="comment">// this should be set by autoconf. check it again here if compiled separately.</span>
<a name="l00024"></a>00024 <span class="preprocessor">#ifndef _FILE_OFFSET_BITS</span>
<a name="l00025"></a>00025 <span class="preprocessor"></span><span class="preprocessor">#define _FILE_OFFSET_BITS 64</span>
<a name="l00026"></a>00026 <span class="preprocessor"></span><span class="preprocessor">#endif</span>
<a name="l00027"></a>00027 <span class="preprocessor"></span>
<a name="l00028"></a>00028 <span class="preprocessor">#include &quot;stx-execpipe.h&quot;</span>
<a name="l00029"></a>00029 
<a name="l00030"></a>00030 <span class="preprocessor">#include &lt;stdexcept&gt;</span>
<a name="l00031"></a>00031 <span class="preprocessor">#include &lt;sstream&gt;</span>
<a name="l00032"></a>00032 <span class="preprocessor">#include &lt;iostream&gt;</span>
<a name="l00033"></a>00033 
<a name="l00034"></a>00034 <span class="preprocessor">#include &lt;assert.h&gt;</span>
<a name="l00035"></a>00035 <span class="preprocessor">#include &lt;stdlib.h&gt;</span>
<a name="l00036"></a>00036 <span class="preprocessor">#include &lt;string.h&gt;</span>
<a name="l00037"></a>00037 <span class="preprocessor">#include &lt;unistd.h&gt;</span>
<a name="l00038"></a>00038 <span class="preprocessor">#include &lt;errno.h&gt;</span>
<a name="l00039"></a>00039 <span class="preprocessor">#include &lt;fcntl.h&gt;</span>
<a name="l00040"></a>00040 <span class="preprocessor">#include &lt;sys/types.h&gt;</span>
<a name="l00041"></a>00041 <span class="preprocessor">#include &lt;sys/wait.h&gt;</span>
<a name="l00042"></a>00042 <span class="preprocessor">#include &lt;sys/select.h&gt;</span>
<a name="l00043"></a>00043 
<a name="l00044"></a>00044 <span class="preprocessor">#define LOG_OUTPUT(msg, level)                           \</span>
<a name="l00045"></a>00045 <span class="preprocessor">    do {                                                 \</span>
<a name="l00046"></a>00046 <span class="preprocessor">        if (m_debug_level &gt;= level) {                    \</span>
<a name="l00047"></a>00047 <span class="preprocessor">            std::ostringstream oss;                      \</span>
<a name="l00048"></a>00048 <span class="preprocessor">            oss &lt;&lt; msg;                                  \</span>
<a name="l00049"></a>00049 <span class="preprocessor">            if (m_debug_output)                          \</span>
<a name="l00050"></a>00050 <span class="preprocessor">                m_debug_output(oss.str().c_str());       \</span>
<a name="l00051"></a>00051 <span class="preprocessor">            else                                         \</span>
<a name="l00052"></a>00052 <span class="preprocessor">                std::cout &lt;&lt; oss.str() &lt;&lt; std::endl;     \</span>
<a name="l00053"></a>00053 <span class="preprocessor">        }                                                \</span>
<a name="l00054"></a>00054 <span class="preprocessor">    } while (0)</span>
<a name="l00055"></a>00055 <span class="preprocessor"></span>
<a name="l00056"></a>00056 <span class="preprocessor">#define LOG_ERROR(msg)  LOG_OUTPUT(msg, ExecPipe::DL_ERROR)</span>
<a name="l00057"></a>00057 <span class="preprocessor"></span><span class="preprocessor">#define LOG_INFO(msg)   LOG_OUTPUT(msg, ExecPipe::DL_INFO)</span>
<a name="l00058"></a>00058 <span class="preprocessor"></span><span class="preprocessor">#define LOG_DEBUG(msg)  LOG_OUTPUT(msg, ExecPipe::DL_DEBUG)</span>
<a name="l00059"></a>00059 <span class="preprocessor"></span><span class="preprocessor">#define LOG_TRACE(msg)  LOG_OUTPUT(msg, ExecPipe::DL_TRACE)</span>
<a name="l00060"></a>00060 <span class="preprocessor"></span>
<a name="l00061"></a><a class="code" href="a00016.html">00061</a> <span class="keyword">namespace </span>stx {
<a name="l00062"></a>00062 
<a name="l00063"></a>00063 <span class="preprocessor">#ifndef _STX_RINGBUFFER_H_</span>
<a name="l00064"></a>00064 <span class="preprocessor"></span><span class="preprocessor">#define _STX_RINGBUFFER_H_</span>
<a name="l00065"></a>00065 <span class="preprocessor"></span>
<a name="l00067"></a><a class="code" href="a00017.html">00067</a> <span class="keyword">namespace </span>{
<a name="l00068"></a>00068 
<a name="l00103"></a><a class="code" href="a00010.html">00103</a> <span class="keyword">class </span><a class="code" href="a00010.html" title="RingBuffer is a byte-oriented, pipe memory buffer which uses the underlying space...">RingBuffer</a>
<a name="l00104"></a>00104 {
<a name="l00105"></a>00105 <span class="keyword">private</span>:
<a name="l00107"></a><a class="code" href="a00010.html#a083625dadf19cb30b39238e810520516">00107</a>     <span class="keywordtype">char</span>*               m_data;
<a name="l00108"></a>00108 
<a name="l00110"></a><a class="code" href="a00010.html#a37fa710801341eed1ac81f605346f496">00110</a>     <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span>        m_buffsize;
<a name="l00111"></a>00111 
<a name="l00113"></a><a class="code" href="a00010.html#a68e15125ca06ea716c78c968498a59fb">00113</a>     <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span>        m_size;
<a name="l00114"></a>00114 
<a name="l00116"></a><a class="code" href="a00010.html#a08a0e448c450d471a604872c013fd71f">00116</a>     <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span>        m_bottom;
<a name="l00117"></a>00117 
<a name="l00118"></a>00118 <span class="keyword">public</span>:
<a name="l00120"></a><a class="code" href="a00010.html#a05e7fa13168083e7499a44b261850434">00120</a>     <span class="keyword">inline</span> <a class="code" href="a00010.html" title="RingBuffer is a byte-oriented, pipe memory buffer which uses the underlying space...">RingBuffer</a>()
<a name="l00121"></a>00121         : m_data(NULL),
<a name="l00122"></a>00122           m_buffsize(0), m_size(0), m_bottom(0)
<a name="l00123"></a>00123     {
<a name="l00124"></a>00124     }
<a name="l00125"></a>00125 
<a name="l00127"></a><a class="code" href="a00010.html#a44fc69e41a387afe271e85e0ad4bbdee">00127</a>     <span class="keyword">inline</span> ~<a class="code" href="a00010.html" title="RingBuffer is a byte-oriented, pipe memory buffer which uses the underlying space...">RingBuffer</a>()
<a name="l00128"></a>00128     {
<a name="l00129"></a>00129         <span class="keywordflow">if</span> (m_data) free(m_data);
<a name="l00130"></a>00130     }
<a name="l00131"></a>00131     
<a name="l00133"></a><a class="code" href="a00010.html#ac61edc37d3a140f85d5d03a90caa99d3">00133</a>     <span class="keyword">inline</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> size()<span class="keyword"> const</span>
<a name="l00134"></a>00134 <span class="keyword">    </span>{
<a name="l00135"></a>00135         <span class="keywordflow">return</span> m_size;
<a name="l00136"></a>00136     }
<a name="l00137"></a>00137 
<a name="l00139"></a><a class="code" href="a00010.html#a51282a1070942fd602a564bd995ebd54">00139</a>     <span class="keyword">inline</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> buffsize()<span class="keyword"> const</span>
<a name="l00140"></a>00140 <span class="keyword">    </span>{
<a name="l00141"></a>00141         <span class="keywordflow">return</span> m_buffsize;
<a name="l00142"></a>00142     }
<a name="l00143"></a>00143 
<a name="l00145"></a><a class="code" href="a00010.html#aab5a470e8097447e606fb05d7e6c1838">00145</a>     <span class="keyword">inline</span> <span class="keywordtype">void</span> clear()
<a name="l00146"></a>00146     {
<a name="l00147"></a>00147         m_size = m_bottom = 0;
<a name="l00148"></a>00148     }
<a name="l00149"></a>00149 
<a name="l00155"></a><a class="code" href="a00010.html#a012dc29acfd70ee119cfa01df968e387">00155</a>     <span class="keyword">inline</span> <span class="keywordtype">char</span>* bottom()<span class="keyword"> const</span>
<a name="l00156"></a>00156 <span class="keyword">    </span>{
<a name="l00157"></a>00157         <span class="keywordflow">return</span> m_data + m_bottom;
<a name="l00158"></a>00158     }
<a name="l00159"></a>00159 
<a name="l00161"></a><a class="code" href="a00010.html#a1510e28c3398fc3e2ca6ad0ee03ae808">00161</a>     <span class="keyword">inline</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> bottomsize()<span class="keyword"> const</span>
<a name="l00162"></a>00162 <span class="keyword">    </span>{
<a name="l00163"></a>00163         <span class="keywordflow">return</span> (m_bottom + m_size &gt; m_buffsize)
<a name="l00164"></a>00164             ? (m_buffsize - m_bottom)
<a name="l00165"></a>00165             : (m_size);
<a name="l00166"></a>00166     }
<a name="l00167"></a>00167 
<a name="l00172"></a><a class="code" href="a00010.html#ace014bd2afb9ef3105eb0c0a4630750c">00172</a>     <span class="keyword">inline</span> <span class="keywordtype">void</span> advance(<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> n)
<a name="l00173"></a>00173     {
<a name="l00174"></a>00174         assert(m_size &gt;= n);
<a name="l00175"></a>00175         m_bottom += n;
<a name="l00176"></a>00176         m_size -= n;
<a name="l00177"></a>00177         <span class="keywordflow">if</span> (m_bottom &gt;= m_buffsize) m_bottom -= m_buffsize;
<a name="l00178"></a>00178     }
<a name="l00179"></a>00179 
<a name="l00184"></a><a class="code" href="a00010.html#a416900a85c216e384ddaf105ab919367">00184</a>     <span class="keywordtype">void</span> write(<span class="keyword">const</span> <span class="keywordtype">void</span> *src, <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> len)
<a name="l00185"></a>00185     {
<a name="l00186"></a>00186         <span class="keywordflow">if</span> (len == 0) <span class="keywordflow">return</span>;
<a name="l00187"></a>00187 
<a name="l00188"></a>00188         <span class="keywordflow">if</span> (m_buffsize &lt; m_size + len)
<a name="l00189"></a>00189         {
<a name="l00190"></a>00190             <span class="comment">// won&#39;t fit, we have to grow the buffer, we&#39;ll grow the buffer to</span>
<a name="l00191"></a>00191             <span class="comment">// twice the size.</span>
<a name="l00192"></a>00192 
<a name="l00193"></a>00193             <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> newbuffsize = m_buffsize;
<a name="l00194"></a>00194             <span class="keywordflow">while</span> (newbuffsize &lt; m_size + len)
<a name="l00195"></a>00195             {
<a name="l00196"></a>00196                 <span class="keywordflow">if</span> (newbuffsize == 0) newbuffsize = 1024;
<a name="l00197"></a>00197                 <span class="keywordflow">else</span> newbuffsize = newbuffsize * 2;
<a name="l00198"></a>00198             }
<a name="l00199"></a>00199 
<a name="l00200"></a>00200             m_data = <span class="keyword">static_cast&lt;</span><span class="keywordtype">char</span>*<span class="keyword">&gt;</span>(realloc(m_data, newbuffsize));
<a name="l00201"></a>00201 
<a name="l00202"></a>00202             <span class="keywordflow">if</span> (m_bottom + m_size &gt; m_buffsize)
<a name="l00203"></a>00203             {
<a name="l00204"></a>00204                 <span class="comment">// copy the ringbuffer&#39;s tail to the new buffer end, use memcpy</span>
<a name="l00205"></a>00205                 <span class="comment">// here because there cannot be any overlapping area.</span>
<a name="l00206"></a>00206 
<a name="l00207"></a>00207                 <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> taillen = m_buffsize - m_bottom;
<a name="l00208"></a>00208 
<a name="l00209"></a>00209                 memcpy(m_data + newbuffsize - taillen,
<a name="l00210"></a>00210                        m_data + m_bottom, taillen);
<a name="l00211"></a>00211 
<a name="l00212"></a>00212                 m_bottom = newbuffsize - taillen;
<a name="l00213"></a>00213             }
<a name="l00214"></a>00214 
<a name="l00215"></a>00215             m_buffsize = newbuffsize;
<a name="l00216"></a>00216         }
<a name="l00217"></a>00217 
<a name="l00218"></a>00218         <span class="comment">// block now fits into the buffer somehow</span>
<a name="l00219"></a>00219 
<a name="l00220"></a>00220         <span class="comment">// check if the new memory fits into the middle space</span>
<a name="l00221"></a>00221         <span class="keywordflow">if</span> (m_bottom + m_size &gt; m_buffsize)
<a name="l00222"></a>00222         {
<a name="l00223"></a>00223             memcpy(m_data + m_bottom + m_size - m_buffsize, src, len);
<a name="l00224"></a>00224             m_size += len;
<a name="l00225"></a>00225         }
<a name="l00226"></a>00226         <span class="keywordflow">else</span> 
<a name="l00227"></a>00227         {
<a name="l00228"></a>00228             <span class="comment">// first fill up the buffer&#39;s tail, which has tailfit bytes room</span>
<a name="l00229"></a>00229             <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> tailfit = m_buffsize - (m_bottom + m_size);
<a name="l00230"></a>00230 
<a name="l00231"></a>00231             <span class="keywordflow">if</span> (tailfit &gt;= len)
<a name="l00232"></a>00232             {
<a name="l00233"></a>00233                 memcpy(m_data + m_bottom + m_size, src, len);
<a name="l00234"></a>00234                 m_size += len;
<a name="l00235"></a>00235             }
<a name="l00236"></a>00236             <span class="keywordflow">else</span>
<a name="l00237"></a>00237             {
<a name="l00238"></a>00238                 <span class="comment">// doesn&#39;t fit into the tail alone, we have to break it up</span>
<a name="l00239"></a>00239                 memcpy(m_data + m_bottom + m_size, src, tailfit);
<a name="l00240"></a>00240                 memcpy(m_data, reinterpret_cast&lt;const char*&gt;(src) + tailfit,
<a name="l00241"></a>00241                        len - tailfit);
<a name="l00242"></a>00242                 m_size += len;
<a name="l00243"></a>00243             }
<a name="l00244"></a>00244         }
<a name="l00245"></a>00245     }
<a name="l00246"></a>00246 };
<a name="l00247"></a>00247 
<a name="l00248"></a>00248 } <span class="comment">// namespace &lt;anonymous&gt;</span>
<a name="l00249"></a>00249 
<a name="l00250"></a>00250 <span class="preprocessor">#endif // _STX_RINGBUFFER_H_</span>
<a name="l00251"></a>00251 <span class="preprocessor"></span>
<a name="l00258"></a><a class="code" href="a00006.html">00258</a> <span class="keyword">class </span><a class="code" href="a00006.html" title="Main library implementation (internal object).">ExecPipeImpl</a>
<a name="l00259"></a>00259 {
<a name="l00260"></a>00260 <span class="keyword">private</span>:
<a name="l00261"></a>00261 
<a name="l00263"></a><a class="code" href="a00006.html#a617bddcdd15805bcb0908eebd32e6a13">00263</a>     <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span>        <a class="code" href="a00006.html#a617bddcdd15805bcb0908eebd32e6a13" title="reference counter">m_refs</a>;
<a name="l00264"></a>00264 
<a name="l00265"></a>00265 <span class="keyword">private</span>:
<a name="l00266"></a>00266 
<a name="l00267"></a>00267     <span class="comment">// *** Debugging Output ***</span>
<a name="l00268"></a>00268     
<a name="l00270"></a><a class="code" href="a00006.html#a0a90391261b1d41ad50444038f65ba6b">00270</a>     <span class="keyword">enum</span> <a class="code" href="a00005.html#a734df6d57aeb61f58303da95536ce28d" title="Enumeration for ascending debug levels.">ExecPipe::DebugLevel</a>   <a class="code" href="a00006.html#a0a90391261b1d41ad50444038f65ba6b" title="currently set debug level">m_debug_level</a>;
<a name="l00271"></a>00271 
<a name="l00273"></a><a class="code" href="a00006.html#acdd55eedd26734aa6bfe15a75e69740d">00273</a>     void                (*<a class="code" href="a00006.html#acdd55eedd26734aa6bfe15a75e69740d" title="current debug line output function">m_debug_output</a>)(<span class="keyword">const</span> <span class="keywordtype">char</span>* line);
<a name="l00274"></a>00274 
<a name="l00275"></a>00275 <span class="keyword">public</span>:
<a name="l00276"></a>00276 
<a name="l00278"></a><a class="code" href="a00006.html#a33fd022e5040f5704c9b2ac60b926ade">00278</a>     <span class="keywordtype">void</span> <a class="code" href="a00006.html#a33fd022e5040f5704c9b2ac60b926ade" title="Change the current debug level. The default is DL_ERROR.">set_debug_level</a>(<span class="keyword">enum</span> <a class="code" href="a00005.html#a734df6d57aeb61f58303da95536ce28d" title="Enumeration for ascending debug levels.">ExecPipe::DebugLevel</a> dl)
<a name="l00279"></a>00279     {
<a name="l00280"></a>00280         <a class="code" href="a00006.html#a0a90391261b1d41ad50444038f65ba6b" title="currently set debug level">m_debug_level</a> = dl;
<a name="l00281"></a>00281     }
<a name="l00282"></a>00282 
<a name="l00285"></a><a class="code" href="a00006.html#a9a85c2633b19b3178d09034a05a22947">00285</a>     <span class="keywordtype">void</span> <a class="code" href="a00006.html#a9a85c2633b19b3178d09034a05a22947" title="Change output function for debug messages.">set_debug_output</a>(<span class="keywordtype">void</span> (*output)(<span class="keyword">const</span> <span class="keywordtype">char</span> *line))
<a name="l00286"></a>00286     {
<a name="l00287"></a>00287         <a class="code" href="a00006.html#acdd55eedd26734aa6bfe15a75e69740d" title="current debug line output function">m_debug_output</a> = output;
<a name="l00288"></a>00288     }
<a name="l00289"></a>00289 
<a name="l00290"></a>00290 <span class="keyword">private</span>:
<a name="l00291"></a>00291 
<a name="l00293"></a><a class="code" href="a00006.html#a8ab2d8746a3f5871229e3b0761b2808c">00293</a>     <span class="keyword">enum</span> <a class="code" href="a00006.html#a8ab2d8746a3f5871229e3b0761b2808c" title="Enumeration describing the currently set input or output stream type.">StreamType</a>
<a name="l00294"></a>00294     {
<a name="l00295"></a><a class="code" href="a00006.html#a8ab2d8746a3f5871229e3b0761b2808caddee570cb9632b8dd02671e7f27181af">00295</a>         <a class="code" href="a00006.html#a8ab2d8746a3f5871229e3b0761b2808caddee570cb9632b8dd02671e7f27181af" title="no special redirection requested">ST_NONE</a> = 0,    
<a name="l00296"></a><a class="code" href="a00006.html#a8ab2d8746a3f5871229e3b0761b2808ca2ffd509d901b0a0d028d39687b2f381b">00296</a>         <a class="code" href="a00006.html#a8ab2d8746a3f5871229e3b0761b2808ca2ffd509d901b0a0d028d39687b2f381b" title="redirection to existing fd">ST_FD</a>,          
<a name="l00297"></a><a class="code" href="a00006.html#a8ab2d8746a3f5871229e3b0761b2808cae193ecc1648fa5588716772d53e36cc2">00297</a>         <a class="code" href="a00006.html#a8ab2d8746a3f5871229e3b0761b2808cae193ecc1648fa5588716772d53e36cc2" title="redirection to file path">ST_FILE</a>,        
<a name="l00298"></a><a class="code" href="a00006.html#a8ab2d8746a3f5871229e3b0761b2808cab0a9adf05e9c0522629909727f1df6af">00298</a>         <a class="code" href="a00006.html#a8ab2d8746a3f5871229e3b0761b2808cab0a9adf05e9c0522629909727f1df6af" title="input/output directed by/to string">ST_STRING</a>,      
<a name="l00299"></a><a class="code" href="a00006.html#a8ab2d8746a3f5871229e3b0761b2808cab01843bdc62c33c2af3b3ec097c8a604">00299</a>         <a class="code" href="a00006.html#a8ab2d8746a3f5871229e3b0761b2808cab01843bdc62c33c2af3b3ec097c8a604" title="input/output attached to program object">ST_OBJECT</a>       
<a name="l00300"></a>00300     };
<a name="l00301"></a>00301 
<a name="l00303"></a><a class="code" href="a00006.html#a4bbcc66a56bca7de4be39c94608486eb">00303</a>     <a class="code" href="a00006.html#a8ab2d8746a3f5871229e3b0761b2808c" title="Enumeration describing the currently set input or output stream type.">StreamType</a>          <a class="code" href="a00006.html#a4bbcc66a56bca7de4be39c94608486eb" title="describes the currently set input stream type">m_input</a>;
<a name="l00304"></a>00304 
<a name="l00305"></a>00305     <span class="comment">// *** Input Stream ***</span>
<a name="l00306"></a>00306 
<a name="l00309"></a><a class="code" href="a00006.html#ad9fae45735aadea8bf6d089afbf92acc">00309</a>     <span class="keywordtype">int</span>                 <a class="code" href="a00006.html#ad9fae45735aadea8bf6d089afbf92acc" title="for ST_FD the input fd given by the user.">m_input_fd</a>;
<a name="l00310"></a>00310 
<a name="l00312"></a><a class="code" href="a00006.html#a58746b4b902781dca44309e44aff2bca">00312</a>     <span class="keyword">const</span> <span class="keywordtype">char</span>*         <a class="code" href="a00006.html#a58746b4b902781dca44309e44aff2bca" title="for ST_FILE the path of the input file.">m_input_file</a>;
<a name="l00313"></a>00313 
<a name="l00316"></a><a class="code" href="a00006.html#a0d2189ceb94350948649ef256c471596">00316</a>     <span class="keyword">const</span> std::string*  <a class="code" href="a00006.html#a0d2189ceb94350948649ef256c471596" title="for ST_STRING a pointer to the user-supplied std::string input stream object.">m_input_string</a>;
<a name="l00317"></a>00317 
<a name="l00319"></a><a class="code" href="a00006.html#a598f7eb31d7ee38ee0cb7d6d10f92126">00319</a>     std::string::size_type <a class="code" href="a00006.html#a598f7eb31d7ee38ee0cb7d6d10f92126" title="for ST_STRING the current position in the input stream object.">m_input_string_pos</a>;
<a name="l00320"></a>00320 
<a name="l00322"></a><a class="code" href="a00006.html#a8c3e36cb34a9dc56448d65e55a72adec">00322</a>     <a class="code" href="a00009.html" title="Abstract class used as an input stream source for an ExecPipe.">PipeSource</a>*         <a class="code" href="a00006.html#a8c3e36cb34a9dc56448d65e55a72adec" title="for ST_OBJECT the input stream source object">m_input_source</a>;
<a name="l00323"></a>00323 
<a name="l00325"></a><a class="code" href="a00006.html#a2eaebf5e5913c7e6fac335401fc9cecb">00325</a>     RingBuffer          <a class="code" href="a00006.html#a2eaebf5e5913c7e6fac335401fc9cecb" title="for ST_OBJECT the input stream ring buffer">m_input_rbuffer</a>;
<a name="l00326"></a>00326 
<a name="l00327"></a>00327     <span class="comment">// *** Output Stream ***</span>
<a name="l00328"></a>00328 
<a name="l00330"></a><a class="code" href="a00006.html#a14758ab95bd946f5fab64b8852ad6c13">00330</a>     <a class="code" href="a00006.html#a8ab2d8746a3f5871229e3b0761b2808c" title="Enumeration describing the currently set input or output stream type.">StreamType</a>          <a class="code" href="a00006.html#a14758ab95bd946f5fab64b8852ad6c13" title="describes the currently set input stream type">m_output</a>;
<a name="l00331"></a>00331 
<a name="l00334"></a><a class="code" href="a00006.html#ac85c02dcbd63dbd74a295fa9e0081ace">00334</a>     <span class="keywordtype">int</span>                 <a class="code" href="a00006.html#ac85c02dcbd63dbd74a295fa9e0081ace" title="for ST_FD the output fd given by the user.">m_output_fd</a>;
<a name="l00335"></a>00335 
<a name="l00337"></a><a class="code" href="a00006.html#a21a643369af0869e5cc33ea231f5cc6f">00337</a>     <span class="keyword">const</span> <span class="keywordtype">char</span>*         <a class="code" href="a00006.html#a21a643369af0869e5cc33ea231f5cc6f" title="for ST_FILE the path of the output file.">m_output_file</a>;
<a name="l00338"></a>00338 
<a name="l00340"></a><a class="code" href="a00006.html#af27954420b773f819bbea46573147f9f">00340</a>     <span class="keywordtype">int</span>                 <a class="code" href="a00006.html#af27954420b773f819bbea46573147f9f" title="for ST_FILE the permission used in the open() call.">m_output_file_mode</a>;
<a name="l00341"></a>00341 
<a name="l00344"></a><a class="code" href="a00006.html#ad346150703dc6bb47d87917816e66219">00344</a>     std::string*        <a class="code" href="a00006.html#ad346150703dc6bb47d87917816e66219" title="for ST_STRING a pointer to the user-supplied std::string output stream object.">m_output_string</a>;
<a name="l00345"></a>00345 
<a name="l00347"></a><a class="code" href="a00006.html#ae6fc1cb223754dfc3deb1000f7f7409d">00347</a>     <a class="code" href="a00008.html" title="Abstract class used as an output stream source for an ExecPipe.">PipeSink</a>*           <a class="code" href="a00006.html#ae6fc1cb223754dfc3deb1000f7f7409d" title="for ST_OBJECT the output stream source object">m_output_sink</a>;
<a name="l00348"></a>00348 
<a name="l00349"></a>00349     <span class="comment">// *** Pipe Stages ***</span>
<a name="l00350"></a>00350 
<a name="l00355"></a><a class="code" href="a00011.html">00355</a>     <span class="keyword">struct </span><a class="code" href="a00011.html" title="Structure representing each stage in the pipe.">Stage</a>
<a name="l00356"></a>00356     {
<a name="l00358"></a><a class="code" href="a00011.html#afad7f62b97eb759f0e804ee659b77f9e">00358</a>         std::vector&lt;std::string&gt;        <a class="code" href="a00011.html#afad7f62b97eb759f0e804ee659b77f9e" title="List of program and arguments copied from simple add_exec() calls.">args</a>;
<a name="l00359"></a>00359 
<a name="l00361"></a><a class="code" href="a00011.html#a8d0e755bf46a3c2e4b7f896bfd25bfd6">00361</a>         <span class="keyword">const</span> <span class="keywordtype">char</span>*                     <a class="code" href="a00011.html#a8d0e755bf46a3c2e4b7f896bfd25bfd6" title="Character pointer to program path called.">prog</a>;
<a name="l00362"></a>00362 
<a name="l00364"></a><a class="code" href="a00011.html#a57297eb0e67d4b6596eb3fc136ce5f23">00364</a>         <span class="keyword">const</span> std::vector&lt;std::string&gt;* <a class="code" href="a00011.html#a57297eb0e67d4b6596eb3fc136ce5f23" title="Pointer to user list of program and arguments.">argsp</a>;
<a name="l00365"></a>00365 
<a name="l00367"></a><a class="code" href="a00011.html#a83f7d9fd7af20efdb1a288fa166a87e6">00367</a>         <span class="keyword">const</span> std::vector&lt;std::string&gt;* <a class="code" href="a00011.html#a83f7d9fd7af20efdb1a288fa166a87e6" title="Pointer to environment list supplied by user.">envp</a>;
<a name="l00368"></a>00368 
<a name="l00370"></a><a class="code" href="a00011.html#ab759077c602561ba35d19dff5feea7d9">00370</a>         <a class="code" href="a00007.html" title="Abstract class used as an intermediate pipe stage between executed processes.">PipeFunction</a>*                   <a class="code" href="a00011.html#ab759077c602561ba35d19dff5feea7d9" title="Pipe stage function object.">func</a>;
<a name="l00371"></a>00371 
<a name="l00373"></a><a class="code" href="a00011.html#ae4a1b9bd93578720fd0fed0c89c6e6ff">00373</a>         RingBuffer                      <a class="code" href="a00011.html#ae4a1b9bd93578720fd0fed0c89c6e6ff" title="Output stream buffer for function object.">outbuffer</a>;
<a name="l00374"></a>00374 
<a name="l00375"></a>00375         <span class="comment">// *** Exec Stages Variables ***</span>
<a name="l00376"></a>00376 
<a name="l00378"></a><a class="code" href="a00011.html#a93952d9df3074d261f7a039fa5de55ce">00378</a>         <span class="keywordtype">bool</span>    <a class="code" href="a00011.html#a93952d9df3074d261f7a039fa5de55ce" title="Call execp() variants.">withpath</a>;
<a name="l00379"></a>00379 
<a name="l00381"></a><a class="code" href="a00011.html#afc6b4056389606cd3b1a8db01982d4a4">00381</a>         pid_t   <a class="code" href="a00011.html#afc6b4056389606cd3b1a8db01982d4a4" title="Pid of the running child process.">pid</a>;
<a name="l00382"></a>00382 
<a name="l00384"></a><a class="code" href="a00011.html#a6d56f15732a8213d2a508bcad30f528b">00384</a>         <span class="keywordtype">int</span>     <a class="code" href="a00011.html#a6d56f15732a8213d2a508bcad30f528b" title="Return status of wait() after child exit.">retstatus</a>;
<a name="l00385"></a>00385         
<a name="l00387"></a><a class="code" href="a00011.html#addabfbf2159ca94741b7d554cb354c02">00387</a>         <span class="keywordtype">int</span>     <a class="code" href="a00011.html#addabfbf2159ca94741b7d554cb354c02" title="File descriptor for child stdin. This is dup2()-ed to STDIN.">stdin_fd</a>;
<a name="l00388"></a>00388 
<a name="l00390"></a><a class="code" href="a00011.html#a3efb75f0067aec695b104e6f331b45a7">00390</a>         <span class="keywordtype">int</span>     <a class="code" href="a00011.html#a3efb75f0067aec695b104e6f331b45a7" title="File descriptor for child stdout. This is dup2()-ed to STDOUT.">stdout_fd</a>;
<a name="l00391"></a>00391 
<a name="l00393"></a><a class="code" href="a00011.html#a22e8e2615e6fb1c479a2496e6b1f7cae">00393</a>         <a class="code" href="a00011.html#a22e8e2615e6fb1c479a2496e6b1f7cae" title="Constructor reseting all variables.">Stage</a>()
<a name="l00394"></a>00394             : <a class="code" href="a00011.html#a8d0e755bf46a3c2e4b7f896bfd25bfd6" title="Character pointer to program path called.">prog</a>(NULL), <a class="code" href="a00011.html#a57297eb0e67d4b6596eb3fc136ce5f23" title="Pointer to user list of program and arguments.">argsp</a>(NULL), <a class="code" href="a00011.html#a83f7d9fd7af20efdb1a288fa166a87e6" title="Pointer to environment list supplied by user.">envp</a>(NULL), <a class="code" href="a00011.html#ab759077c602561ba35d19dff5feea7d9" title="Pipe stage function object.">func</a>(NULL),
<a name="l00395"></a>00395               <a class="code" href="a00011.html#a93952d9df3074d261f7a039fa5de55ce" title="Call execp() variants.">withpath</a>(false), <a class="code" href="a00011.html#afc6b4056389606cd3b1a8db01982d4a4" title="Pid of the running child process.">pid</a>(0), <a class="code" href="a00011.html#a6d56f15732a8213d2a508bcad30f528b" title="Return status of wait() after child exit.">retstatus</a>(0),
<a name="l00396"></a>00396               <a class="code" href="a00011.html#addabfbf2159ca94741b7d554cb354c02" title="File descriptor for child stdin. This is dup2()-ed to STDIN.">stdin_fd</a>(-1), <a class="code" href="a00011.html#a3efb75f0067aec695b104e6f331b45a7" title="File descriptor for child stdout. This is dup2()-ed to STDOUT.">stdout_fd</a>(-1)
<a name="l00397"></a>00397         {
<a name="l00398"></a>00398         }
<a name="l00399"></a>00399     };
<a name="l00400"></a>00400 
<a name="l00402"></a><a class="code" href="a00006.html#ab1d62680a019877f896f661a0a7d39b3">00402</a>     <span class="keyword">typedef</span> std::vector&lt;Stage&gt; <a class="code" href="a00006.html#ab1d62680a019877f896f661a0a7d39b3" title="typedef of list of pipe stages.">stagelist_type</a>;
<a name="l00403"></a>00403 
<a name="l00405"></a><a class="code" href="a00006.html#a07c35268f2e3b72d3e85d3cefe991765">00405</a>     <a class="code" href="a00006.html#ab1d62680a019877f896f661a0a7d39b3" title="typedef of list of pipe stages.">stagelist_type</a>      <a class="code" href="a00006.html#a07c35268f2e3b72d3e85d3cefe991765" title="list of pipe stages.">m_stages</a>;
<a name="l00406"></a>00406 
<a name="l00408"></a><a class="code" href="a00006.html#a50c69aabf47793e001b1c56264a0d705">00408</a>     <span class="keywordtype">char</span>                <a class="code" href="a00006.html#a50c69aabf47793e001b1c56264a0d705" title="general buffer used for read() and write() calls.">m_buffer</a>[4096];
<a name="l00409"></a>00409 
<a name="l00410"></a>00410 <span class="keyword">public</span>:
<a name="l00411"></a>00411 
<a name="l00413"></a><a class="code" href="a00006.html#a85401a9353c1dd610b24595ceb3fd086">00413</a>     <a class="code" href="a00006.html#a85401a9353c1dd610b24595ceb3fd086" title="Create a new pipe implementation with zero reference counter.">ExecPipeImpl</a>()
<a name="l00414"></a>00414         : <a class="code" href="a00006.html#a617bddcdd15805bcb0908eebd32e6a13" title="reference counter">m_refs</a>(0),
<a name="l00415"></a>00415           <a class="code" href="a00006.html#a0a90391261b1d41ad50444038f65ba6b" title="currently set debug level">m_debug_level</a>(<a class="code" href="a00005.html" title="Main library interface (reference counted pointer).">ExecPipe</a>::DL_ERROR),
<a name="l00416"></a>00416           <a class="code" href="a00006.html#acdd55eedd26734aa6bfe15a75e69740d" title="current debug line output function">m_debug_output</a>(NULL),
<a name="l00417"></a>00417           <a class="code" href="a00006.html#a4bbcc66a56bca7de4be39c94608486eb" title="describes the currently set input stream type">m_input</a>(<a class="code" href="a00006.html#a8ab2d8746a3f5871229e3b0761b2808caddee570cb9632b8dd02671e7f27181af" title="no special redirection requested">ST_NONE</a>),
<a name="l00418"></a>00418           <a class="code" href="a00006.html#ad9fae45735aadea8bf6d089afbf92acc" title="for ST_FD the input fd given by the user.">m_input_fd</a>(-1),
<a name="l00419"></a>00419           <a class="code" href="a00006.html#a14758ab95bd946f5fab64b8852ad6c13" title="describes the currently set input stream type">m_output</a>(<a class="code" href="a00006.html#a8ab2d8746a3f5871229e3b0761b2808caddee570cb9632b8dd02671e7f27181af" title="no special redirection requested">ST_NONE</a>),
<a name="l00420"></a>00420           <a class="code" href="a00006.html#ac85c02dcbd63dbd74a295fa9e0081ace" title="for ST_FD the output fd given by the user.">m_output_fd</a>(-1)
<a name="l00421"></a>00421     {
<a name="l00422"></a>00422     }
<a name="l00423"></a>00423 
<a name="l00425"></a><a class="code" href="a00006.html#a388602062827c90cf689f9112075bf40">00425</a>     <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span>&amp; <a class="code" href="a00006.html#a388602062827c90cf689f9112075bf40" title="Return writable reference to counter.">refs</a>()
<a name="l00426"></a>00426     {
<a name="l00427"></a>00427         <span class="keywordflow">return</span> <a class="code" href="a00006.html#a617bddcdd15805bcb0908eebd32e6a13" title="reference counter">m_refs</a>;
<a name="l00428"></a>00428     }
<a name="l00429"></a>00429 
<a name="l00430"></a>00430     <span class="comment">// *** Input Selectors ***</span>
<a name="l00431"></a>00431 
<a name="l00433"></a>00433 
<a name="l00438"></a><a class="code" href="a00006.html#a473653cf8b5cff978232c0663d912085">00438</a>     <span class="keywordtype">void</span> <a class="code" href="a00006.html#a473653cf8b5cff978232c0663d912085" title="Assign an already opened file descriptor as input stream for the first exec stage...">set_input_fd</a>(<span class="keywordtype">int</span> fd)
<a name="l00439"></a>00439     {
<a name="l00440"></a>00440         assert(<a class="code" href="a00006.html#a4bbcc66a56bca7de4be39c94608486eb" title="describes the currently set input stream type">m_input</a> == <a class="code" href="a00006.html#a8ab2d8746a3f5871229e3b0761b2808caddee570cb9632b8dd02671e7f27181af" title="no special redirection requested">ST_NONE</a>);
<a name="l00441"></a>00441         <span class="keywordflow">if</span> (<a class="code" href="a00006.html#a4bbcc66a56bca7de4be39c94608486eb" title="describes the currently set input stream type">m_input</a> != <a class="code" href="a00006.html#a8ab2d8746a3f5871229e3b0761b2808caddee570cb9632b8dd02671e7f27181af" title="no special redirection requested">ST_NONE</a>) <span class="keywordflow">return</span>;
<a name="l00442"></a>00442 
<a name="l00443"></a>00443         <a class="code" href="a00006.html#a4bbcc66a56bca7de4be39c94608486eb" title="describes the currently set input stream type">m_input</a> = <a class="code" href="a00006.html#a8ab2d8746a3f5871229e3b0761b2808ca2ffd509d901b0a0d028d39687b2f381b" title="redirection to existing fd">ST_FD</a>;
<a name="l00444"></a>00444         <a class="code" href="a00006.html#ad9fae45735aadea8bf6d089afbf92acc" title="for ST_FD the input fd given by the user.">m_input_fd</a> = fd;
<a name="l00445"></a>00445     }
<a name="l00446"></a>00446 
<a name="l00451"></a><a class="code" href="a00006.html#af61214f8c015b537a590795091d8bde9">00451</a>     <span class="keywordtype">void</span> <a class="code" href="a00006.html#af61214f8c015b537a590795091d8bde9" title="Assign a file as input stream source.">set_input_file</a>(<span class="keyword">const</span> <span class="keywordtype">char</span>* path)
<a name="l00452"></a>00452     {
<a name="l00453"></a>00453         assert(<a class="code" href="a00006.html#a4bbcc66a56bca7de4be39c94608486eb" title="describes the currently set input stream type">m_input</a> == <a class="code" href="a00006.html#a8ab2d8746a3f5871229e3b0761b2808caddee570cb9632b8dd02671e7f27181af" title="no special redirection requested">ST_NONE</a>);
<a name="l00454"></a>00454         <span class="keywordflow">if</span> (<a class="code" href="a00006.html#a4bbcc66a56bca7de4be39c94608486eb" title="describes the currently set input stream type">m_input</a> != <a class="code" href="a00006.html#a8ab2d8746a3f5871229e3b0761b2808caddee570cb9632b8dd02671e7f27181af" title="no special redirection requested">ST_NONE</a>) <span class="keywordflow">return</span>;
<a name="l00455"></a>00455 
<a name="l00456"></a>00456         <a class="code" href="a00006.html#a4bbcc66a56bca7de4be39c94608486eb" title="describes the currently set input stream type">m_input</a> = <a class="code" href="a00006.html#a8ab2d8746a3f5871229e3b0761b2808cae193ecc1648fa5588716772d53e36cc2" title="redirection to file path">ST_FILE</a>;
<a name="l00457"></a>00457         <a class="code" href="a00006.html#a58746b4b902781dca44309e44aff2bca" title="for ST_FILE the path of the input file.">m_input_file</a> = path;
<a name="l00458"></a>00458     }    
<a name="l00459"></a>00459 
<a name="l00465"></a><a class="code" href="a00006.html#ab0bf8f67de38e68b6490e3d877696de3">00465</a>     <span class="keywordtype">void</span> <a class="code" href="a00006.html#ab0bf8f67de38e68b6490e3d877696de3" title="Assign a std::string as input stream source.">set_input_string</a>(<span class="keyword">const</span> std::string* input)
<a name="l00466"></a>00466     {
<a name="l00467"></a>00467         assert(<a class="code" href="a00006.html#a4bbcc66a56bca7de4be39c94608486eb" title="describes the currently set input stream type">m_input</a> == <a class="code" href="a00006.html#a8ab2d8746a3f5871229e3b0761b2808caddee570cb9632b8dd02671e7f27181af" title="no special redirection requested">ST_NONE</a>);
<a name="l00468"></a>00468         <span class="keywordflow">if</span> (<a class="code" href="a00006.html#a4bbcc66a56bca7de4be39c94608486eb" title="describes the currently set input stream type">m_input</a> != <a class="code" href="a00006.html#a8ab2d8746a3f5871229e3b0761b2808caddee570cb9632b8dd02671e7f27181af" title="no special redirection requested">ST_NONE</a>) <span class="keywordflow">return</span>;
<a name="l00469"></a>00469 
<a name="l00470"></a>00470         <a class="code" href="a00006.html#a4bbcc66a56bca7de4be39c94608486eb" title="describes the currently set input stream type">m_input</a> = <a class="code" href="a00006.html#a8ab2d8746a3f5871229e3b0761b2808cab0a9adf05e9c0522629909727f1df6af" title="input/output directed by/to string">ST_STRING</a>;
<a name="l00471"></a>00471         <a class="code" href="a00006.html#a0d2189ceb94350948649ef256c471596" title="for ST_STRING a pointer to the user-supplied std::string input stream object.">m_input_string</a> = input;
<a name="l00472"></a>00472         <a class="code" href="a00006.html#a598f7eb31d7ee38ee0cb7d6d10f92126" title="for ST_STRING the current position in the input stream object.">m_input_string_pos</a> = 0;
<a name="l00473"></a>00473     }
<a name="l00474"></a>00474 
<a name="l00480"></a><a class="code" href="a00006.html#a01f83eb33bb50c2bdefc3d82d8e03c1d">00480</a>     <span class="keywordtype">void</span> <a class="code" href="a00006.html#a01f83eb33bb50c2bdefc3d82d8e03c1d" title="Assign a PipeSource as input stream source.">set_input_source</a>(<a class="code" href="a00009.html" title="Abstract class used as an input stream source for an ExecPipe.">PipeSource</a>* source)
<a name="l00481"></a>00481     {
<a name="l00482"></a>00482         assert(<a class="code" href="a00006.html#a4bbcc66a56bca7de4be39c94608486eb" title="describes the currently set input stream type">m_input</a> == <a class="code" href="a00006.html#a8ab2d8746a3f5871229e3b0761b2808caddee570cb9632b8dd02671e7f27181af" title="no special redirection requested">ST_NONE</a>);
<a name="l00483"></a>00483         <span class="keywordflow">if</span> (<a class="code" href="a00006.html#a4bbcc66a56bca7de4be39c94608486eb" title="describes the currently set input stream type">m_input</a> != <a class="code" href="a00006.html#a8ab2d8746a3f5871229e3b0761b2808caddee570cb9632b8dd02671e7f27181af" title="no special redirection requested">ST_NONE</a>) <span class="keywordflow">return</span>;
<a name="l00484"></a>00484 
<a name="l00485"></a>00485         <a class="code" href="a00006.html#a4bbcc66a56bca7de4be39c94608486eb" title="describes the currently set input stream type">m_input</a> = <a class="code" href="a00006.html#a8ab2d8746a3f5871229e3b0761b2808cab01843bdc62c33c2af3b3ec097c8a604" title="input/output attached to program object">ST_OBJECT</a>;
<a name="l00486"></a>00486         <a class="code" href="a00006.html#a8c3e36cb34a9dc56448d65e55a72adec" title="for ST_OBJECT the input stream source object">m_input_source</a> = source;
<a name="l00487"></a>00487         source-&gt;<a class="code" href="a00009.html#ad68c42870f68f3c5aaa740c04ec1908a" title="pointer to associated pipe. filled by ExecPipe::add_input_source()">m_impl</a> = <span class="keyword">this</span>;
<a name="l00488"></a>00488     }
<a name="l00489"></a>00489 
<a name="l00491"></a>00491     
<a name="l00496"></a><a class="code" href="a00006.html#ad42faa9a62f10524ee15b0c5e91744db">00496</a>     <span class="keywordtype">void</span> <a class="code" href="a00006.html#ad42faa9a62f10524ee15b0c5e91744db" title="Function called by PipeSource::write() to push data into the ring buffer.">input_source_write</a>(<span class="keyword">const</span> <span class="keywordtype">void</span>* data, <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> datalen)
<a name="l00497"></a>00497     {
<a name="l00498"></a>00498         <a class="code" href="a00006.html#a2eaebf5e5913c7e6fac335401fc9cecb" title="for ST_OBJECT the input stream ring buffer">m_input_rbuffer</a>.write(data, datalen);
<a name="l00499"></a>00499     }
<a name="l00500"></a>00500 
<a name="l00501"></a>00501     <span class="comment">// *** Output Selectors ***</span>
<a name="l00502"></a>00502 
<a name="l00504"></a>00504 
<a name="l00509"></a><a class="code" href="a00006.html#a6a19b51e2f35870f85d1db85fe44bb53">00509</a>     <span class="keywordtype">void</span> <a class="code" href="a00006.html#a6a19b51e2f35870f85d1db85fe44bb53" title="Assign an already opened file descriptor as output stream for the last exec stage...">set_output_fd</a>(<span class="keywordtype">int</span> fd)
<a name="l00510"></a>00510     {
<a name="l00511"></a>00511         assert(<a class="code" href="a00006.html#a14758ab95bd946f5fab64b8852ad6c13" title="describes the currently set input stream type">m_output</a> == <a class="code" href="a00006.html#a8ab2d8746a3f5871229e3b0761b2808caddee570cb9632b8dd02671e7f27181af" title="no special redirection requested">ST_NONE</a>);
<a name="l00512"></a>00512         <span class="keywordflow">if</span> (<a class="code" href="a00006.html#a14758ab95bd946f5fab64b8852ad6c13" title="describes the currently set input stream type">m_output</a> != <a class="code" href="a00006.html#a8ab2d8746a3f5871229e3b0761b2808caddee570cb9632b8dd02671e7f27181af" title="no special redirection requested">ST_NONE</a>) <span class="keywordflow">return</span>;
<a name="l00513"></a>00513 
<a name="l00514"></a>00514         <a class="code" href="a00006.html#a14758ab95bd946f5fab64b8852ad6c13" title="describes the currently set input stream type">m_output</a> = <a class="code" href="a00006.html#a8ab2d8746a3f5871229e3b0761b2808ca2ffd509d901b0a0d028d39687b2f381b" title="redirection to existing fd">ST_FD</a>;
<a name="l00515"></a>00515         <a class="code" href="a00006.html#ac85c02dcbd63dbd74a295fa9e0081ace" title="for ST_FD the output fd given by the user.">m_output_fd</a> = fd;
<a name="l00516"></a>00516     }
<a name="l00517"></a>00517 
<a name="l00522"></a><a class="code" href="a00006.html#afb5eb52d6b56d9a7ab0c9c6bdcdeec52">00522</a>     <span class="keywordtype">void</span> <a class="code" href="a00006.html#afb5eb52d6b56d9a7ab0c9c6bdcdeec52" title="Assign a file as output stream destination.">set_output_file</a>(<span class="keyword">const</span> <span class="keywordtype">char</span>* path, <span class="keywordtype">int</span> mode = 0666)
<a name="l00523"></a>00523     {
<a name="l00524"></a>00524         assert(<a class="code" href="a00006.html#a14758ab95bd946f5fab64b8852ad6c13" title="describes the currently set input stream type">m_output</a> == <a class="code" href="a00006.html#a8ab2d8746a3f5871229e3b0761b2808caddee570cb9632b8dd02671e7f27181af" title="no special redirection requested">ST_NONE</a>);
<a name="l00525"></a>00525         <span class="keywordflow">if</span> (<a class="code" href="a00006.html#a14758ab95bd946f5fab64b8852ad6c13" title="describes the currently set input stream type">m_output</a> != <a class="code" href="a00006.html#a8ab2d8746a3f5871229e3b0761b2808caddee570cb9632b8dd02671e7f27181af" title="no special redirection requested">ST_NONE</a>) <span class="keywordflow">return</span>;
<a name="l00526"></a>00526 
<a name="l00527"></a>00527         <a class="code" href="a00006.html#a14758ab95bd946f5fab64b8852ad6c13" title="describes the currently set input stream type">m_output</a> = <a class="code" href="a00006.html#a8ab2d8746a3f5871229e3b0761b2808cae193ecc1648fa5588716772d53e36cc2" title="redirection to file path">ST_FILE</a>;
<a name="l00528"></a>00528         <a class="code" href="a00006.html#a21a643369af0869e5cc33ea231f5cc6f" title="for ST_FILE the path of the output file.">m_output_file</a> = path;
<a name="l00529"></a>00529         <a class="code" href="a00006.html#af27954420b773f819bbea46573147f9f" title="for ST_FILE the permission used in the open() call.">m_output_file_mode</a> = mode;
<a name="l00530"></a>00530     }    
<a name="l00531"></a>00531 
<a name="l00537"></a><a class="code" href="a00006.html#aed9907487ff26e0b42fdb12641117e9c">00537</a>     <span class="keywordtype">void</span> <a class="code" href="a00006.html#aed9907487ff26e0b42fdb12641117e9c" title="Assign a std::string as output stream destination.">set_output_string</a>(std::string* output)
<a name="l00538"></a>00538     {
<a name="l00539"></a>00539         assert(<a class="code" href="a00006.html#a14758ab95bd946f5fab64b8852ad6c13" title="describes the currently set input stream type">m_output</a> == <a class="code" href="a00006.html#a8ab2d8746a3f5871229e3b0761b2808caddee570cb9632b8dd02671e7f27181af" title="no special redirection requested">ST_NONE</a>);
<a name="l00540"></a>00540         <span class="keywordflow">if</span> (<a class="code" href="a00006.html#a14758ab95bd946f5fab64b8852ad6c13" title="describes the currently set input stream type">m_output</a> != <a class="code" href="a00006.html#a8ab2d8746a3f5871229e3b0761b2808caddee570cb9632b8dd02671e7f27181af" title="no special redirection requested">ST_NONE</a>) <span class="keywordflow">return</span>;
<a name="l00541"></a>00541 
<a name="l00542"></a>00542         <a class="code" href="a00006.html#a14758ab95bd946f5fab64b8852ad6c13" title="describes the currently set input stream type">m_output</a> = <a class="code" href="a00006.html#a8ab2d8746a3f5871229e3b0761b2808cab0a9adf05e9c0522629909727f1df6af" title="input/output directed by/to string">ST_STRING</a>;
<a name="l00543"></a>00543         <a class="code" href="a00006.html#ad346150703dc6bb47d87917816e66219" title="for ST_STRING a pointer to the user-supplied std::string output stream object.">m_output_string</a> = output;
<a name="l00544"></a>00544     }
<a name="l00545"></a>00545 
<a name="l00550"></a><a class="code" href="a00006.html#a528bac3e7649c2f2f26c001c631e9e7c">00550</a>     <span class="keywordtype">void</span> <a class="code" href="a00006.html#a528bac3e7649c2f2f26c001c631e9e7c" title="Assign a PipeSink as output stream destination.">set_output_sink</a>(<a class="code" href="a00008.html" title="Abstract class used as an output stream source for an ExecPipe.">PipeSink</a>* sink)
<a name="l00551"></a>00551     {
<a name="l00552"></a>00552         assert(<a class="code" href="a00006.html#a14758ab95bd946f5fab64b8852ad6c13" title="describes the currently set input stream type">m_output</a> == <a class="code" href="a00006.html#a8ab2d8746a3f5871229e3b0761b2808caddee570cb9632b8dd02671e7f27181af" title="no special redirection requested">ST_NONE</a>);
<a name="l00553"></a>00553         <span class="keywordflow">if</span> (<a class="code" href="a00006.html#a14758ab95bd946f5fab64b8852ad6c13" title="describes the currently set input stream type">m_output</a> != <a class="code" href="a00006.html#a8ab2d8746a3f5871229e3b0761b2808caddee570cb9632b8dd02671e7f27181af" title="no special redirection requested">ST_NONE</a>) <span class="keywordflow">return</span>;
<a name="l00554"></a>00554 
<a name="l00555"></a>00555         <a class="code" href="a00006.html#a14758ab95bd946f5fab64b8852ad6c13" title="describes the currently set input stream type">m_output</a> = <a class="code" href="a00006.html#a8ab2d8746a3f5871229e3b0761b2808cab01843bdc62c33c2af3b3ec097c8a604" title="input/output attached to program object">ST_OBJECT</a>;
<a name="l00556"></a>00556         <a class="code" href="a00006.html#ae6fc1cb223754dfc3deb1000f7f7409d" title="for ST_OBJECT the output stream source object">m_output_sink</a> = sink;
<a name="l00557"></a>00557     }
<a name="l00558"></a>00558 
<a name="l00560"></a>00560 
<a name="l00561"></a>00561     <span class="comment">// *** Pipe Stages ***</span>
<a name="l00562"></a>00562 
<a name="l00564"></a>00564 
<a name="l00568"></a><a class="code" href="a00006.html#ab7097e05c0418971d7be8a541b4c01de">00568</a>     <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="a00006.html#ab7097e05c0418971d7be8a541b4c01de" title="Return the number of pipe stages added.">size</a>()<span class="keyword"> const</span>
<a name="l00569"></a>00569 <span class="keyword">    </span>{
<a name="l00570"></a>00570         <span class="keywordflow">return</span> <a class="code" href="a00006.html#a07c35268f2e3b72d3e85d3cefe991765" title="list of pipe stages.">m_stages</a>.size();
<a name="l00571"></a>00571     }
<a name="l00572"></a>00572 
<a name="l00577"></a><a class="code" href="a00006.html#a21e0256c55f3c13e7cb8b31078a3fde6">00577</a>     <span class="keywordtype">void</span> <a class="code" href="a00006.html#a21e0256c55f3c13e7cb8b31078a3fde6" title="Add an exec() stage to the pipe with given arguments.">add_exec</a>(<span class="keyword">const</span> <span class="keywordtype">char</span>* prog)
<a name="l00578"></a>00578     {
<a name="l00579"></a>00579         <span class="keyword">struct </span><a class="code" href="a00011.html" title="Structure representing each stage in the pipe.">Stage</a> newstage;
<a name="l00580"></a>00580         newstage.<a class="code" href="a00011.html#a8d0e755bf46a3c2e4b7f896bfd25bfd6" title="Character pointer to program path called.">prog</a> = prog;
<a name="l00581"></a>00581         newstage.<a class="code" href="a00011.html#afad7f62b97eb759f0e804ee659b77f9e" title="List of program and arguments copied from simple add_exec() calls.">args</a>.push_back(prog);
<a name="l00582"></a>00582         <a class="code" href="a00006.html#a07c35268f2e3b72d3e85d3cefe991765" title="list of pipe stages.">m_stages</a>.push_back(newstage);
<a name="l00583"></a>00583     }
<a name="l00584"></a>00584 
<a name="l00589"></a><a class="code" href="a00006.html#a4f01e30c0741fad0e1e9529168b35782">00589</a>     <span class="keywordtype">void</span> <a class="code" href="a00006.html#a21e0256c55f3c13e7cb8b31078a3fde6" title="Add an exec() stage to the pipe with given arguments.">add_exec</a>(<span class="keyword">const</span> <span class="keywordtype">char</span>* prog, <span class="keyword">const</span> <span class="keywordtype">char</span>* arg1)
<a name="l00590"></a>00590     {
<a name="l00591"></a>00591         <span class="keyword">struct </span><a class="code" href="a00011.html" title="Structure representing each stage in the pipe.">Stage</a> newstage;
<a name="l00592"></a>00592         newstage.<a class="code" href="a00011.html#a8d0e755bf46a3c2e4b7f896bfd25bfd6" title="Character pointer to program path called.">prog</a> = prog;
<a name="l00593"></a>00593         newstage.<a class="code" href="a00011.html#afad7f62b97eb759f0e804ee659b77f9e" title="List of program and arguments copied from simple add_exec() calls.">args</a>.push_back(prog);
<a name="l00594"></a>00594         newstage.<a class="code" href="a00011.html#afad7f62b97eb759f0e804ee659b77f9e" title="List of program and arguments copied from simple add_exec() calls.">args</a>.push_back(arg1);
<a name="l00595"></a>00595         <a class="code" href="a00006.html#a07c35268f2e3b72d3e85d3cefe991765" title="list of pipe stages.">m_stages</a>.push_back(newstage);
<a name="l00596"></a>00596     }
<a name="l00597"></a>00597 
<a name="l00602"></a><a class="code" href="a00006.html#ac9296b8b66e8bc28f5986e5693c6d2bc">00602</a>     <span class="keywordtype">void</span> <a class="code" href="a00006.html#a21e0256c55f3c13e7cb8b31078a3fde6" title="Add an exec() stage to the pipe with given arguments.">add_exec</a>(<span class="keyword">const</span> <span class="keywordtype">char</span>* prog, <span class="keyword">const</span> <span class="keywordtype">char</span>* arg1, <span class="keyword">const</span> <span class="keywordtype">char</span>* arg2)
<a name="l00603"></a>00603     {
<a name="l00604"></a>00604         <span class="keyword">struct </span><a class="code" href="a00011.html" title="Structure representing each stage in the pipe.">Stage</a> newstage;
<a name="l00605"></a>00605         newstage.<a class="code" href="a00011.html#a8d0e755bf46a3c2e4b7f896bfd25bfd6" title="Character pointer to program path called.">prog</a> = prog;
<a name="l00606"></a>00606         newstage.<a class="code" href="a00011.html#afad7f62b97eb759f0e804ee659b77f9e" title="List of program and arguments copied from simple add_exec() calls.">args</a>.push_back(prog);
<a name="l00607"></a>00607         newstage.<a class="code" href="a00011.html#afad7f62b97eb759f0e804ee659b77f9e" title="List of program and arguments copied from simple add_exec() calls.">args</a>.push_back(arg1);
<a name="l00608"></a>00608         newstage.<a class="code" href="a00011.html#afad7f62b97eb759f0e804ee659b77f9e" title="List of program and arguments copied from simple add_exec() calls.">args</a>.push_back(arg2);
<a name="l00609"></a>00609         <a class="code" href="a00006.html#a07c35268f2e3b72d3e85d3cefe991765" title="list of pipe stages.">m_stages</a>.push_back(newstage);
<a name="l00610"></a>00610     }
<a name="l00611"></a>00611 
<a name="l00616"></a><a class="code" href="a00006.html#ab2f01f1384c31aefa289d268aa83de6b">00616</a>     <span class="keywordtype">void</span> <a class="code" href="a00006.html#a21e0256c55f3c13e7cb8b31078a3fde6" title="Add an exec() stage to the pipe with given arguments.">add_exec</a>(<span class="keyword">const</span> <span class="keywordtype">char</span>* prog, <span class="keyword">const</span> <span class="keywordtype">char</span>* arg1, <span class="keyword">const</span> <span class="keywordtype">char</span>* arg2, <span class="keyword">const</span> <span class="keywordtype">char</span>* arg3)
<a name="l00617"></a>00617     {
<a name="l00618"></a>00618         <span class="keyword">struct </span><a class="code" href="a00011.html" title="Structure representing each stage in the pipe.">Stage</a> newstage;
<a name="l00619"></a>00619         newstage.<a class="code" href="a00011.html#a8d0e755bf46a3c2e4b7f896bfd25bfd6" title="Character pointer to program path called.">prog</a> = prog;
<a name="l00620"></a>00620         newstage.<a class="code" href="a00011.html#afad7f62b97eb759f0e804ee659b77f9e" title="List of program and arguments copied from simple add_exec() calls.">args</a>.push_back(prog);
<a name="l00621"></a>00621         newstage.<a class="code" href="a00011.html#afad7f62b97eb759f0e804ee659b77f9e" title="List of program and arguments copied from simple add_exec() calls.">args</a>.push_back(arg1);
<a name="l00622"></a>00622         newstage.<a class="code" href="a00011.html#afad7f62b97eb759f0e804ee659b77f9e" title="List of program and arguments copied from simple add_exec() calls.">args</a>.push_back(arg2);
<a name="l00623"></a>00623         newstage.<a class="code" href="a00011.html#afad7f62b97eb759f0e804ee659b77f9e" title="List of program and arguments copied from simple add_exec() calls.">args</a>.push_back(arg3);
<a name="l00624"></a>00624         <a class="code" href="a00006.html#a07c35268f2e3b72d3e85d3cefe991765" title="list of pipe stages.">m_stages</a>.push_back(newstage);
<a name="l00625"></a>00625     }
<a name="l00626"></a>00626 
<a name="l00632"></a><a class="code" href="a00006.html#a77adb002d66a65b57570e9215cfacb91">00632</a>     <span class="keywordtype">void</span> <a class="code" href="a00006.html#a21e0256c55f3c13e7cb8b31078a3fde6" title="Add an exec() stage to the pipe with given arguments.">add_exec</a>(<span class="keyword">const</span> std::vector&lt;std::string&gt;* args)
<a name="l00633"></a>00633     {
<a name="l00634"></a>00634         assert(args-&gt;size() &gt; 0);
<a name="l00635"></a>00635         <span class="keywordflow">if</span> (args-&gt;size() == 0) <span class="keywordflow">return</span>;
<a name="l00636"></a>00636 
<a name="l00637"></a>00637         <span class="keyword">struct </span><a class="code" href="a00011.html" title="Structure representing each stage in the pipe.">Stage</a> newstage;
<a name="l00638"></a>00638         newstage.<a class="code" href="a00011.html#a8d0e755bf46a3c2e4b7f896bfd25bfd6" title="Character pointer to program path called.">prog</a> = (*args)[0].c_str();
<a name="l00639"></a>00639         newstage.<a class="code" href="a00011.html#a57297eb0e67d4b6596eb3fc136ce5f23" title="Pointer to user list of program and arguments.">argsp</a> = args;
<a name="l00640"></a>00640         <a class="code" href="a00006.html#a07c35268f2e3b72d3e85d3cefe991765" title="list of pipe stages.">m_stages</a>.push_back(newstage);
<a name="l00641"></a>00641     }
<a name="l00642"></a>00642 
<a name="l00648"></a><a class="code" href="a00006.html#ab88f4227bd432173937571cd31606413">00648</a>     <span class="keywordtype">void</span> <a class="code" href="a00006.html#ab88f4227bd432173937571cd31606413" title="Add an execp() stage to the pipe with given arguments.">add_execp</a>(<span class="keyword">const</span> <span class="keywordtype">char</span>* prog)
<a name="l00649"></a>00649     {
<a name="l00650"></a>00650         <span class="keyword">struct </span><a class="code" href="a00011.html" title="Structure representing each stage in the pipe.">Stage</a> newstage;
<a name="l00651"></a>00651         newstage.<a class="code" href="a00011.html#a8d0e755bf46a3c2e4b7f896bfd25bfd6" title="Character pointer to program path called.">prog</a> = prog;
<a name="l00652"></a>00652         newstage.<a class="code" href="a00011.html#afad7f62b97eb759f0e804ee659b77f9e" title="List of program and arguments copied from simple add_exec() calls.">args</a>.push_back(prog);
<a name="l00653"></a>00653         newstage.<a class="code" href="a00011.html#a93952d9df3074d261f7a039fa5de55ce" title="Call execp() variants.">withpath</a> = <span class="keyword">true</span>;
<a name="l00654"></a>00654         <a class="code" href="a00006.html#a07c35268f2e3b72d3e85d3cefe991765" title="list of pipe stages.">m_stages</a>.push_back(newstage);
<a name="l00655"></a>00655     }
<a name="l00656"></a>00656 
<a name="l00662"></a><a class="code" href="a00006.html#a9f82259868710a6d8689851c9eed17a3">00662</a>     <span class="keywordtype">void</span> <a class="code" href="a00006.html#ab88f4227bd432173937571cd31606413" title="Add an execp() stage to the pipe with given arguments.">add_execp</a>(<span class="keyword">const</span> <span class="keywordtype">char</span>* prog, <span class="keyword">const</span> <span class="keywordtype">char</span>* arg1)
<a name="l00663"></a>00663     {
<a name="l00664"></a>00664         <span class="keyword">struct </span><a class="code" href="a00011.html" title="Structure representing each stage in the pipe.">Stage</a> newstage;
<a name="l00665"></a>00665         newstage.<a class="code" href="a00011.html#a8d0e755bf46a3c2e4b7f896bfd25bfd6" title="Character pointer to program path called.">prog</a> = prog;
<a name="l00666"></a>00666         newstage.<a class="code" href="a00011.html#afad7f62b97eb759f0e804ee659b77f9e" title="List of program and arguments copied from simple add_exec() calls.">args</a>.push_back(prog);
<a name="l00667"></a>00667         newstage.<a class="code" href="a00011.html#afad7f62b97eb759f0e804ee659b77f9e" title="List of program and arguments copied from simple add_exec() calls.">args</a>.push_back(arg1);
<a name="l00668"></a>00668         newstage.<a class="code" href="a00011.html#a93952d9df3074d261f7a039fa5de55ce" title="Call execp() variants.">withpath</a> = <span class="keyword">true</span>;
<a name="l00669"></a>00669         <a class="code" href="a00006.html#a07c35268f2e3b72d3e85d3cefe991765" title="list of pipe stages.">m_stages</a>.push_back(newstage);
<a name="l00670"></a>00670     }
<a name="l00671"></a>00671 
<a name="l00677"></a><a class="code" href="a00006.html#ab03040c108a8f2aa1ed40604f6b5500a">00677</a>     <span class="keywordtype">void</span> <a class="code" href="a00006.html#ab88f4227bd432173937571cd31606413" title="Add an execp() stage to the pipe with given arguments.">add_execp</a>(<span class="keyword">const</span> <span class="keywordtype">char</span>* prog, <span class="keyword">const</span> <span class="keywordtype">char</span>* arg1, <span class="keyword">const</span> <span class="keywordtype">char</span>* arg2)
<a name="l00678"></a>00678     {
<a name="l00679"></a>00679         <span class="keyword">struct </span><a class="code" href="a00011.html" title="Structure representing each stage in the pipe.">Stage</a> newstage;
<a name="l00680"></a>00680         newstage.<a class="code" href="a00011.html#a8d0e755bf46a3c2e4b7f896bfd25bfd6" title="Character pointer to program path called.">prog</a> = prog;
<a name="l00681"></a>00681         newstage.<a class="code" href="a00011.html#afad7f62b97eb759f0e804ee659b77f9e" title="List of program and arguments copied from simple add_exec() calls.">args</a>.push_back(prog);
<a name="l00682"></a>00682         newstage.<a class="code" href="a00011.html#afad7f62b97eb759f0e804ee659b77f9e" title="List of program and arguments copied from simple add_exec() calls.">args</a>.push_back(arg1);
<a name="l00683"></a>00683         newstage.<a class="code" href="a00011.html#afad7f62b97eb759f0e804ee659b77f9e" title="List of program and arguments copied from simple add_exec() calls.">args</a>.push_back(arg2);
<a name="l00684"></a>00684         newstage.<a class="code" href="a00011.html#a93952d9df3074d261f7a039fa5de55ce" title="Call execp() variants.">withpath</a> = <span class="keyword">true</span>;
<a name="l00685"></a>00685         <a class="code" href="a00006.html#a07c35268f2e3b72d3e85d3cefe991765" title="list of pipe stages.">m_stages</a>.push_back(newstage);
<a name="l00686"></a>00686     }
<a name="l00687"></a>00687 
<a name="l00693"></a><a class="code" href="a00006.html#a4708b329b36b899b619963e25714df74">00693</a>     <span class="keywordtype">void</span> <a class="code" href="a00006.html#ab88f4227bd432173937571cd31606413" title="Add an execp() stage to the pipe with given arguments.">add_execp</a>(<span class="keyword">const</span> <span class="keywordtype">char</span>* prog, <span class="keyword">const</span> <span class="keywordtype">char</span>* arg1, <span class="keyword">const</span> <span class="keywordtype">char</span>* arg2, <span class="keyword">const</span> <span class="keywordtype">char</span>* arg3)
<a name="l00694"></a>00694     {
<a name="l00695"></a>00695         <span class="keyword">struct </span><a class="code" href="a00011.html" title="Structure representing each stage in the pipe.">Stage</a> newstage;
<a name="l00696"></a>00696         newstage.<a class="code" href="a00011.html#a8d0e755bf46a3c2e4b7f896bfd25bfd6" title="Character pointer to program path called.">prog</a> = prog;
<a name="l00697"></a>00697         newstage.<a class="code" href="a00011.html#afad7f62b97eb759f0e804ee659b77f9e" title="List of program and arguments copied from simple add_exec() calls.">args</a>.push_back(prog);
<a name="l00698"></a>00698         newstage.<a class="code" href="a00011.html#afad7f62b97eb759f0e804ee659b77f9e" title="List of program and arguments copied from simple add_exec() calls.">args</a>.push_back(arg1);
<a name="l00699"></a>00699         newstage.<a class="code" href="a00011.html#afad7f62b97eb759f0e804ee659b77f9e" title="List of program and arguments copied from simple add_exec() calls.">args</a>.push_back(arg2);
<a name="l00700"></a>00700         newstage.<a class="code" href="a00011.html#afad7f62b97eb759f0e804ee659b77f9e" title="List of program and arguments copied from simple add_exec() calls.">args</a>.push_back(arg3);
<a name="l00701"></a>00701         newstage.<a class="code" href="a00011.html#a93952d9df3074d261f7a039fa5de55ce" title="Call execp() variants.">withpath</a> = <span class="keyword">true</span>;
<a name="l00702"></a>00702         <a class="code" href="a00006.html#a07c35268f2e3b72d3e85d3cefe991765" title="list of pipe stages.">m_stages</a>.push_back(newstage);
<a name="l00703"></a>00703     }
<a name="l00704"></a>00704 
<a name="l00711"></a><a class="code" href="a00006.html#a7789bffcfdc0be553a7000d1eb48b530">00711</a>     <span class="keywordtype">void</span> <a class="code" href="a00006.html#ab88f4227bd432173937571cd31606413" title="Add an execp() stage to the pipe with given arguments.">add_execp</a>(<span class="keyword">const</span> std::vector&lt;std::string&gt;* args)
<a name="l00712"></a>00712     {
<a name="l00713"></a>00713         assert(args-&gt;size() &gt; 0);
<a name="l00714"></a>00714         <span class="keywordflow">if</span> (args-&gt;size() == 0) <span class="keywordflow">return</span>;
<a name="l00715"></a>00715 
<a name="l00716"></a>00716         <span class="keyword">struct </span><a class="code" href="a00011.html" title="Structure representing each stage in the pipe.">Stage</a> newstage;
<a name="l00717"></a>00717         newstage.<a class="code" href="a00011.html#a8d0e755bf46a3c2e4b7f896bfd25bfd6" title="Character pointer to program path called.">prog</a> = (*args)[0].c_str();
<a name="l00718"></a>00718         newstage.<a class="code" href="a00011.html#a57297eb0e67d4b6596eb3fc136ce5f23" title="Pointer to user list of program and arguments.">argsp</a> = args;
<a name="l00719"></a>00719         newstage.<a class="code" href="a00011.html#a93952d9df3074d261f7a039fa5de55ce" title="Call execp() variants.">withpath</a> = <span class="keyword">true</span>;
<a name="l00720"></a>00720         <a class="code" href="a00006.html#a07c35268f2e3b72d3e85d3cefe991765" title="list of pipe stages.">m_stages</a>.push_back(newstage);
<a name="l00721"></a>00721     }
<a name="l00722"></a>00722 
<a name="l00731"></a><a class="code" href="a00006.html#a5c70345c74782153f4f3953385c4dc74">00731</a>     <span class="keywordtype">void</span> <a class="code" href="a00006.html#a5c70345c74782153f4f3953385c4dc74" title="Add an exece() stage to the pipe with the given arguments and environments.">add_exece</a>(<span class="keyword">const</span> <span class="keywordtype">char</span>* path,
<a name="l00732"></a>00732                    <span class="keyword">const</span> std::vector&lt;std::string&gt;* argsp,
<a name="l00733"></a>00733                    <span class="keyword">const</span> std::vector&lt;std::string&gt;* envp)
<a name="l00734"></a>00734     {
<a name="l00735"></a>00735         assert(path &amp;&amp; argsp);
<a name="l00736"></a>00736         assert(argsp-&gt;size() &gt; 0);
<a name="l00737"></a>00737         <span class="keywordflow">if</span> (argsp-&gt;size() == 0) <span class="keywordflow">return</span>;
<a name="l00738"></a>00738 
<a name="l00739"></a>00739         <span class="keyword">struct </span><a class="code" href="a00011.html" title="Structure representing each stage in the pipe.">Stage</a> newstage;
<a name="l00740"></a>00740         newstage.<a class="code" href="a00011.html#a8d0e755bf46a3c2e4b7f896bfd25bfd6" title="Character pointer to program path called.">prog</a> = path;
<a name="l00741"></a>00741         newstage.<a class="code" href="a00011.html#a57297eb0e67d4b6596eb3fc136ce5f23" title="Pointer to user list of program and arguments.">argsp</a> = argsp;
<a name="l00742"></a>00742         newstage.<a class="code" href="a00011.html#a83f7d9fd7af20efdb1a288fa166a87e6" title="Pointer to environment list supplied by user.">envp</a> = envp;
<a name="l00743"></a>00743         <a class="code" href="a00006.html#a07c35268f2e3b72d3e85d3cefe991765" title="list of pipe stages.">m_stages</a>.push_back(newstage);
<a name="l00744"></a>00744     }
<a name="l00745"></a>00745 
<a name="l00751"></a><a class="code" href="a00006.html#adff71b352fa9eb441015b225af45c22a">00751</a>     <span class="keywordtype">void</span> <a class="code" href="a00006.html#adff71b352fa9eb441015b225af45c22a" title="Add a function stage to the pipe.">add_function</a>(<a class="code" href="a00007.html" title="Abstract class used as an intermediate pipe stage between executed processes.">PipeFunction</a>* func)
<a name="l00752"></a>00752     {
<a name="l00753"></a>00753         assert(func);
<a name="l00754"></a>00754         <span class="keywordflow">if</span> (!func) <span class="keywordflow">return</span>;
<a name="l00755"></a>00755 
<a name="l00756"></a>00756         func-&gt;<a class="code" href="a00007.html#ae0f526902d5edbdd71d86e6f8bda9e1d" title="pointer to associated pipe filled by ExecPipe::add_function()">m_impl</a> = <span class="keyword">this</span>;
<a name="l00757"></a>00757         func-&gt;<a class="code" href="a00007.html#a1469003fd12371862030dae2317f2070" title="pipe stage identifier">m_stageid</a> = <a class="code" href="a00006.html#a07c35268f2e3b72d3e85d3cefe991765" title="list of pipe stages.">m_stages</a>.size();
<a name="l00758"></a>00758 
<a name="l00759"></a>00759         <span class="keyword">struct </span><a class="code" href="a00011.html" title="Structure representing each stage in the pipe.">Stage</a> newstage;
<a name="l00760"></a>00760         newstage.<a class="code" href="a00011.html#ab759077c602561ba35d19dff5feea7d9" title="Pipe stage function object.">func</a> = func;
<a name="l00761"></a>00761         <a class="code" href="a00006.html#a07c35268f2e3b72d3e85d3cefe991765" title="list of pipe stages.">m_stages</a>.push_back(newstage);
<a name="l00762"></a>00762     }
<a name="l00763"></a>00763 
<a name="l00765"></a>00765 
<a name="l00770"></a><a class="code" href="a00006.html#adfe1f0659c982151887a41e70debf258">00770</a>     <span class="keywordtype">void</span> <a class="code" href="a00006.html#adfe1f0659c982151887a41e70debf258" title="Function called by PipeSource::write() to push data into the ring buffer.">stage_function_write</a>(<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> st, <span class="keyword">const</span> <span class="keywordtype">void</span>* data, <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> datalen)
<a name="l00771"></a>00771     {
<a name="l00772"></a>00772         assert(st &lt; <a class="code" href="a00006.html#a07c35268f2e3b72d3e85d3cefe991765" title="list of pipe stages.">m_stages</a>.size());
<a name="l00773"></a>00773 
<a name="l00774"></a>00774         <span class="keywordflow">return</span> <a class="code" href="a00006.html#a07c35268f2e3b72d3e85d3cefe991765" title="list of pipe stages.">m_stages</a>[st].outbuffer.write(data, datalen);
<a name="l00775"></a>00775     }
<a name="l00776"></a>00776 
<a name="l00777"></a>00777     <span class="comment">// *** Run Pipe ***</span>
<a name="l00778"></a>00778 
<a name="l00786"></a>00786     <span class="keywordtype">void</span> <a class="code" href="a00006.html#a5cdfc07991ed22e1fb1dee25a9509ec1" title="Run the configured pipe sequence and wait for all children processes to complete...">run</a>();
<a name="l00787"></a>00787 
<a name="l00788"></a>00788     <span class="comment">// *** Inspection After Pipe Execution ***</span>
<a name="l00789"></a>00789 
<a name="l00791"></a>00791 
<a name="l00796"></a><a class="code" href="a00006.html#a13c456f97e74bcbb04ef488a79deaac7">00796</a>     <span class="keywordtype">int</span> <a class="code" href="a00006.html#a13c456f97e74bcbb04ef488a79deaac7" title="Get the return status of exec() stage&amp;#39;s program run after pipe execution as indicated...">get_return_status</a>(<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> stageid)<span class="keyword"> const</span>
<a name="l00797"></a>00797 <span class="keyword">    </span>{
<a name="l00798"></a>00798         assert(stageid &lt; <a class="code" href="a00006.html#a07c35268f2e3b72d3e85d3cefe991765" title="list of pipe stages.">m_stages</a>.size());
<a name="l00799"></a>00799         assert(!<a class="code" href="a00006.html#a07c35268f2e3b72d3e85d3cefe991765" title="list of pipe stages.">m_stages</a>[stageid].func);
<a name="l00800"></a>00800 
<a name="l00801"></a>00801         <span class="keywordflow">return</span> <a class="code" href="a00006.html#a07c35268f2e3b72d3e85d3cefe991765" title="list of pipe stages.">m_stages</a>[stageid].retstatus;
<a name="l00802"></a>00802     }
<a name="l00803"></a>00803 
<a name="l00808"></a><a class="code" href="a00006.html#a3ad393d45c80839b3b3fe0840fdaa3b5">00808</a>     <span class="keywordtype">int</span> <a class="code" href="a00006.html#a3ad393d45c80839b3b3fe0840fdaa3b5" title="Get the return code of exec() stage&amp;#39;s program run after pipe execution, or -1...">get_return_code</a>(<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> stageid)<span class="keyword"> const</span>
<a name="l00809"></a>00809 <span class="keyword">    </span>{
<a name="l00810"></a>00810         assert(stageid &lt; <a class="code" href="a00006.html#a07c35268f2e3b72d3e85d3cefe991765" title="list of pipe stages.">m_stages</a>.size());
<a name="l00811"></a>00811         assert(!<a class="code" href="a00006.html#a07c35268f2e3b72d3e85d3cefe991765" title="list of pipe stages.">m_stages</a>[stageid].func);
<a name="l00812"></a>00812 
<a name="l00813"></a>00813         <span class="keywordflow">if</span> (WIFEXITED(<a class="code" href="a00006.html#a07c35268f2e3b72d3e85d3cefe991765" title="list of pipe stages.">m_stages</a>[stageid].retstatus))
<a name="l00814"></a>00814             <span class="keywordflow">return</span> WEXITSTATUS(<a class="code" href="a00006.html#a07c35268f2e3b72d3e85d3cefe991765" title="list of pipe stages.">m_stages</a>[stageid].retstatus);
<a name="l00815"></a>00815         <span class="keywordflow">else</span>
<a name="l00816"></a>00816             <span class="keywordflow">return</span> -1;
<a name="l00817"></a>00817     }
<a name="l00818"></a>00818 
<a name="l00823"></a><a class="code" href="a00006.html#af0a115971095800245f7a4fff69c1473">00823</a>     <span class="keywordtype">int</span> <a class="code" href="a00006.html#af0a115971095800245f7a4fff69c1473" title="Get the signal of the abnormally terminated exec() stage&amp;#39;s program run after...">get_return_signal</a>(<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> stageid)<span class="keyword"> const</span>
<a name="l00824"></a>00824 <span class="keyword">    </span>{
<a name="l00825"></a>00825         assert(stageid &lt; <a class="code" href="a00006.html#a07c35268f2e3b72d3e85d3cefe991765" title="list of pipe stages.">m_stages</a>.size());
<a name="l00826"></a>00826         assert(!<a class="code" href="a00006.html#a07c35268f2e3b72d3e85d3cefe991765" title="list of pipe stages.">m_stages</a>[stageid].func);
<a name="l00827"></a>00827 
<a name="l00828"></a>00828         <span class="keywordflow">if</span> (WIFSIGNALED(<a class="code" href="a00006.html#a07c35268f2e3b72d3e85d3cefe991765" title="list of pipe stages.">m_stages</a>[stageid].retstatus))
<a name="l00829"></a>00829             <span class="keywordflow">return</span> WTERMSIG(<a class="code" href="a00006.html#a07c35268f2e3b72d3e85d3cefe991765" title="list of pipe stages.">m_stages</a>[stageid].retstatus);
<a name="l00830"></a>00830         <span class="keywordflow">else</span>
<a name="l00831"></a>00831             <span class="keywordflow">return</span> -1;
<a name="l00832"></a>00832     }
<a name="l00833"></a>00833 
<a name="l00837"></a><a class="code" href="a00006.html#a3f55d7c6852f6b42388bc08ae31555b2">00837</a>     <span class="keywordtype">bool</span> <a class="code" href="a00006.html#a3f55d7c6852f6b42388bc08ae31555b2" title="Return true if the return code of all exec() stages were zero.">all_return_codes_zero</a>()<span class="keyword"> const</span>
<a name="l00838"></a>00838 <span class="keyword">    </span>{
<a name="l00839"></a>00839         <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i = 0; i &lt; <a class="code" href="a00006.html#a07c35268f2e3b72d3e85d3cefe991765" title="list of pipe stages.">m_stages</a>.size(); ++i)
<a name="l00840"></a>00840         {
<a name="l00841"></a>00841             <span class="keywordflow">if</span> (<a class="code" href="a00006.html#a07c35268f2e3b72d3e85d3cefe991765" title="list of pipe stages.">m_stages</a>[i].func) <span class="keywordflow">continue</span>;
<a name="l00842"></a>00842 
<a name="l00843"></a>00843             <span class="keywordflow">if</span> (<a class="code" href="a00006.html#a3ad393d45c80839b3b3fe0840fdaa3b5" title="Get the return code of exec() stage&amp;#39;s program run after pipe execution, or -1...">get_return_code</a>(i) != 0)
<a name="l00844"></a>00844                 <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00845"></a>00845         }
<a name="l00846"></a>00846 
<a name="l00847"></a>00847         <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l00848"></a>00848     }
<a name="l00849"></a>00849 
<a name="l00851"></a>00851 
<a name="l00852"></a>00852 <span class="keyword">protected</span>:
<a name="l00853"></a>00853 
<a name="l00854"></a>00854     <span class="comment">// *** Helper Function for run() ***</span>
<a name="l00855"></a>00855 
<a name="l00858"></a>00858     <span class="keywordtype">void</span>        <a class="code" href="a00006.html#a3a7184ae172885e1515a9a8f381529af" title="Transform arguments and launch an exec stage using the correct exec() variant.">exec_stage</a>(<span class="keyword">const</span> Stage&amp; stage);
<a name="l00859"></a>00859 
<a name="l00861"></a>00861     <span class="keywordtype">void</span>        <a class="code" href="a00006.html#ac66a3fee0c9408e4d923a2272e5b5e09" title="Print all arguments of exec() call.">print_exec</a>(<span class="keyword">const</span> std::vector&lt;std::string&gt;&amp; args);
<a name="l00862"></a>00862 
<a name="l00864"></a>00864     <span class="keywordtype">void</span>        <a class="code" href="a00006.html#a025d172f9111ee2e70c8b5e0d1835dde" title="Safe close() call and output error if fd was already closed.">sclose</a>(<span class="keywordtype">int</span> fd);
<a name="l00865"></a>00865 };
<a name="l00866"></a>00866 
<a name="l00867"></a>00867 <span class="comment">// --- ExecPipeImpl ----------------------------------------------------- //</span>
<a name="l00868"></a>00868 
<a name="l00869"></a><a class="code" href="a00006.html#ac66a3fee0c9408e4d923a2272e5b5e09">00869</a> <span class="keywordtype">void</span> <a class="code" href="a00006.html#ac66a3fee0c9408e4d923a2272e5b5e09" title="Print all arguments of exec() call.">ExecPipeImpl::print_exec</a>(<span class="keyword">const</span> std::vector&lt;std::string&gt;&amp; args)
<a name="l00870"></a>00870 {
<a name="l00871"></a>00871     std::ostringstream oss;
<a name="l00872"></a>00872     oss &lt;&lt; <span class="stringliteral">&quot;Exec()&quot;</span>;
<a name="l00873"></a>00873     <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> ai = 0; ai &lt; args.size(); ++ai)
<a name="l00874"></a>00874     {
<a name="l00875"></a>00875         oss &lt;&lt; <span class="stringliteral">&quot; &quot;</span> &lt;&lt; args[ai];
<a name="l00876"></a>00876     }
<a name="l00877"></a>00877     LOG_INFO(oss.str());
<a name="l00878"></a>00878 }
<a name="l00879"></a>00879 
<a name="l00880"></a><a class="code" href="a00006.html#a3a7184ae172885e1515a9a8f381529af">00880</a> <span class="keywordtype">void</span> <a class="code" href="a00006.html#a3a7184ae172885e1515a9a8f381529af" title="Transform arguments and launch an exec stage using the correct exec() variant.">ExecPipeImpl::exec_stage</a>(<span class="keyword">const</span> <a class="code" href="a00011.html" title="Structure representing each stage in the pipe.">Stage</a>&amp; stage)
<a name="l00881"></a>00881 {
<a name="l00882"></a>00882     <span class="comment">// select arguments vector</span>
<a name="l00883"></a>00883     <span class="keyword">const</span> std::vector&lt;std::string&gt;&amp; args = stage.<a class="code" href="a00011.html#a57297eb0e67d4b6596eb3fc136ce5f23" title="Pointer to user list of program and arguments.">argsp</a> ? *stage.<a class="code" href="a00011.html#a57297eb0e67d4b6596eb3fc136ce5f23" title="Pointer to user list of program and arguments.">argsp</a> : stage.<a class="code" href="a00011.html#afad7f62b97eb759f0e804ee659b77f9e" title="List of program and arguments copied from simple add_exec() calls.">args</a>;
<a name="l00884"></a>00884 
<a name="l00885"></a>00885     <span class="comment">// create const char*[] of prog and arguments for syscall.</span>
<a name="l00886"></a>00886 
<a name="l00887"></a>00887     <span class="keyword">const</span> <span class="keywordtype">char</span>* cargs[args.size()+1];
<a name="l00888"></a>00888 
<a name="l00889"></a>00889     <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> ai = 0; ai &lt; args.size(); ++ai)
<a name="l00890"></a>00890     {
<a name="l00891"></a>00891         cargs[ai] = args[ai].c_str();
<a name="l00892"></a>00892     }
<a name="l00893"></a>00893     cargs[ args.size() ] = NULL;
<a name="l00894"></a>00894 
<a name="l00895"></a>00895     <span class="keywordflow">if</span> (!stage.<a class="code" href="a00011.html#a83f7d9fd7af20efdb1a288fa166a87e6" title="Pointer to environment list supplied by user.">envp</a>)
<a name="l00896"></a>00896     {
<a name="l00897"></a>00897         <span class="keywordflow">if</span> (stage.<a class="code" href="a00011.html#a93952d9df3074d261f7a039fa5de55ce" title="Call execp() variants.">withpath</a>)
<a name="l00898"></a>00898             execvp(stage.<a class="code" href="a00011.html#a8d0e755bf46a3c2e4b7f896bfd25bfd6" title="Character pointer to program path called.">prog</a>, (<span class="keywordtype">char</span>* <span class="keyword">const</span>*)cargs);
<a name="l00899"></a>00899         <span class="keywordflow">else</span>
<a name="l00900"></a>00900             execv(stage.<a class="code" href="a00011.html#a8d0e755bf46a3c2e4b7f896bfd25bfd6" title="Character pointer to program path called.">prog</a>, (<span class="keywordtype">char</span>* <span class="keyword">const</span>*)cargs);
<a name="l00901"></a>00901     }
<a name="l00902"></a>00902     <span class="keywordflow">else</span>
<a name="l00903"></a>00903     {
<a name="l00904"></a>00904         <span class="comment">// create envp const char*[] for syscall.</span>
<a name="l00905"></a>00905 
<a name="l00906"></a>00906         <span class="keyword">const</span> <span class="keywordtype">char</span>* cenv[args.size()+1];
<a name="l00907"></a>00907 
<a name="l00908"></a>00908         <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> ei = 0; ei &lt; stage.<a class="code" href="a00011.html#a83f7d9fd7af20efdb1a288fa166a87e6" title="Pointer to environment list supplied by user.">envp</a>-&gt;size(); ++ei)
<a name="l00909"></a>00909         {       
<a name="l00910"></a>00910             cenv[ei] = (*stage.<a class="code" href="a00011.html#a83f7d9fd7af20efdb1a288fa166a87e6" title="Pointer to environment list supplied by user.">envp</a>)[ei].c_str();
<a name="l00911"></a>00911         }
<a name="l00912"></a>00912         cenv[ stage.<a class="code" href="a00011.html#a83f7d9fd7af20efdb1a288fa166a87e6" title="Pointer to environment list supplied by user.">envp</a>-&gt;size() ] = NULL;
<a name="l00913"></a>00913 
<a name="l00914"></a>00914         execve(stage.<a class="code" href="a00011.html#a8d0e755bf46a3c2e4b7f896bfd25bfd6" title="Character pointer to program path called.">prog</a>, (<span class="keywordtype">char</span>* <span class="keyword">const</span>*)cargs, (<span class="keywordtype">char</span>* <span class="keyword">const</span>*)cenv);
<a name="l00915"></a>00915     }
<a name="l00916"></a>00916 
<a name="l00917"></a>00917     LOG_ERROR(<span class="stringliteral">&quot;Error executing child process: &quot;</span> &lt;&lt; strerror(errno));
<a name="l00918"></a>00918 }
<a name="l00919"></a>00919 
<a name="l00920"></a><a class="code" href="a00006.html#a025d172f9111ee2e70c8b5e0d1835dde">00920</a> <span class="keywordtype">void</span> <a class="code" href="a00006.html#a025d172f9111ee2e70c8b5e0d1835dde" title="Safe close() call and output error if fd was already closed.">ExecPipeImpl::sclose</a>(<span class="keywordtype">int</span> fd)
<a name="l00921"></a>00921 {
<a name="l00922"></a>00922     <span class="keywordtype">int</span> r = close(fd);
<a name="l00923"></a>00923 
<a name="l00924"></a>00924     <span class="keywordflow">if</span> (r != 0) {
<a name="l00925"></a>00925         LOG_ERROR(<span class="stringliteral">&quot;Could not correctly close fd: &quot;</span> &lt;&lt; strerror(errno));
<a name="l00926"></a>00926     }
<a name="l00927"></a>00927 }
<a name="l00928"></a>00928 
<a name="l00929"></a>00929 <span class="comment">// --- ExecPipeImpl::run() ---------------------------------------------- //</span>
<a name="l00930"></a>00930 
<a name="l00931"></a><a class="code" href="a00006.html#a5cdfc07991ed22e1fb1dee25a9509ec1">00931</a> <span class="keywordtype">void</span> <a class="code" href="a00006.html#a5cdfc07991ed22e1fb1dee25a9509ec1" title="Run the configured pipe sequence and wait for all children processes to complete...">ExecPipeImpl::run</a>()
<a name="l00932"></a>00932 {
<a name="l00933"></a>00933     <span class="keywordflow">if</span> (<a class="code" href="a00006.html#a07c35268f2e3b72d3e85d3cefe991765" title="list of pipe stages.">m_stages</a>.size() == 0)
<a name="l00934"></a>00934         <span class="keywordflow">throw</span>(std::runtime_error(<span class="stringliteral">&quot;No stages to in exec pipe.&quot;</span>));
<a name="l00935"></a>00935 
<a name="l00936"></a>00936     <span class="comment">// *** Phase 1: prepare all file descriptors ************************* //</span>
<a name="l00937"></a>00937 
<a name="l00938"></a>00938     <span class="comment">// set up input stream accordingly</span>
<a name="l00939"></a>00939     <span class="keywordflow">switch</span>(<a class="code" href="a00006.html#a4bbcc66a56bca7de4be39c94608486eb" title="describes the currently set input stream type">m_input</a>)
<a name="l00940"></a>00940     {
<a name="l00941"></a>00941     <span class="keywordflow">case</span> <a class="code" href="a00006.html#a8ab2d8746a3f5871229e3b0761b2808caddee570cb9632b8dd02671e7f27181af" title="no special redirection requested">ST_NONE</a>:
<a name="l00942"></a>00942         <span class="comment">// no file change of file descriptor after fork.</span>
<a name="l00943"></a>00943         <a class="code" href="a00006.html#a07c35268f2e3b72d3e85d3cefe991765" title="list of pipe stages.">m_stages</a>[0].stdin_fd = -1;
<a name="l00944"></a>00944         <span class="keywordflow">break</span>;
<a name="l00945"></a>00945 
<a name="l00946"></a>00946     <span class="keywordflow">case</span> <a class="code" href="a00006.html#a8ab2d8746a3f5871229e3b0761b2808cab0a9adf05e9c0522629909727f1df6af" title="input/output directed by/to string">ST_STRING</a>:
<a name="l00947"></a>00947     <span class="keywordflow">case</span> <a class="code" href="a00006.html#a8ab2d8746a3f5871229e3b0761b2808cab01843bdc62c33c2af3b3ec097c8a604" title="input/output attached to program object">ST_OBJECT</a>: {
<a name="l00948"></a>00948         <span class="comment">// create input pipe for strings and function objects.</span>
<a name="l00949"></a>00949         <span class="keywordtype">int</span> pipefd[2];
<a name="l00950"></a>00950 
<a name="l00951"></a>00951         <span class="keywordflow">if</span> (pipe(pipefd) != 0)
<a name="l00952"></a>00952             <span class="keywordflow">throw</span>(std::runtime_error(std::string(<span class="stringliteral">&quot;Could not create an input pipe: &quot;</span>) + strerror(errno)));
<a name="l00953"></a>00953 
<a name="l00954"></a>00954         <span class="keywordflow">if</span> (fcntl(pipefd[1], F_SETFL, O_NONBLOCK) != 0)
<a name="l00955"></a>00955             <span class="keywordflow">throw</span>(std::runtime_error(std::string(<span class="stringliteral">&quot;Could not set non-block mode on input pipe: &quot;</span>) + strerror(errno)));
<a name="l00956"></a>00956 
<a name="l00957"></a>00957         <a class="code" href="a00006.html#ad9fae45735aadea8bf6d089afbf92acc" title="for ST_FD the input fd given by the user.">m_input_fd</a> = pipefd[1];
<a name="l00958"></a>00958         <a class="code" href="a00006.html#a07c35268f2e3b72d3e85d3cefe991765" title="list of pipe stages.">m_stages</a>[0].stdin_fd = pipefd[0];
<a name="l00959"></a>00959         <span class="keywordflow">break</span>;
<a name="l00960"></a>00960     }
<a name="l00961"></a>00961     <span class="keywordflow">case</span> <a class="code" href="a00006.html#a8ab2d8746a3f5871229e3b0761b2808cae193ecc1648fa5588716772d53e36cc2" title="redirection to file path">ST_FILE</a>: {
<a name="l00962"></a>00962         <span class="comment">// open input file</span>
<a name="l00963"></a>00963 
<a name="l00964"></a>00964         <span class="keywordtype">int</span> infd = open(<a class="code" href="a00006.html#a58746b4b902781dca44309e44aff2bca" title="for ST_FILE the path of the input file.">m_input_file</a>, O_RDONLY);
<a name="l00965"></a>00965         <span class="keywordflow">if</span> (infd &lt; 0)
<a name="l00966"></a>00966             <span class="keywordflow">throw</span>(std::runtime_error(std::string(<span class="stringliteral">&quot;Could not open input file: &quot;</span>) + strerror(errno)));
<a name="l00967"></a>00967 
<a name="l00968"></a>00968         <a class="code" href="a00006.html#a07c35268f2e3b72d3e85d3cefe991765" title="list of pipe stages.">m_stages</a>[0].stdin_fd = infd;
<a name="l00969"></a>00969         <span class="keywordflow">break</span>;
<a name="l00970"></a>00970     }
<a name="l00971"></a>00971     <span class="keywordflow">case</span> <a class="code" href="a00006.html#a8ab2d8746a3f5871229e3b0761b2808ca2ffd509d901b0a0d028d39687b2f381b" title="redirection to existing fd">ST_FD</a>:
<a name="l00972"></a>00972         <span class="comment">// assign user-provided fd to first process</span>
<a name="l00973"></a>00973         <a class="code" href="a00006.html#a07c35268f2e3b72d3e85d3cefe991765" title="list of pipe stages.">m_stages</a>[0].stdin_fd = <a class="code" href="a00006.html#ad9fae45735aadea8bf6d089afbf92acc" title="for ST_FD the input fd given by the user.">m_input_fd</a>;
<a name="l00974"></a>00974         <a class="code" href="a00006.html#ad9fae45735aadea8bf6d089afbf92acc" title="for ST_FD the input fd given by the user.">m_input_fd</a> = -1;
<a name="l00975"></a>00975         <span class="keywordflow">break</span>;
<a name="l00976"></a>00976     }
<a name="l00977"></a>00977 
<a name="l00978"></a>00978     <span class="comment">// create pipes between exec stages</span>
<a name="l00979"></a>00979     <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i = 0; i &lt; <a class="code" href="a00006.html#a07c35268f2e3b72d3e85d3cefe991765" title="list of pipe stages.">m_stages</a>.size() - 1; ++i)
<a name="l00980"></a>00980     {
<a name="l00981"></a>00981         <span class="keywordtype">int</span> pipefd[2];
<a name="l00982"></a>00982 
<a name="l00983"></a>00983         <span class="keywordflow">if</span> (pipe(pipefd) != 0)
<a name="l00984"></a>00984             <span class="keywordflow">throw</span>(std::runtime_error(std::string(<span class="stringliteral">&quot;Could not create a stage pipe: &quot;</span>) + strerror(errno)));
<a name="l00985"></a>00985 
<a name="l00986"></a>00986         <a class="code" href="a00006.html#a07c35268f2e3b72d3e85d3cefe991765" title="list of pipe stages.">m_stages</a>[i].stdout_fd = pipefd[1];
<a name="l00987"></a>00987         <a class="code" href="a00006.html#a07c35268f2e3b72d3e85d3cefe991765" title="list of pipe stages.">m_stages</a>[i+1].stdin_fd = pipefd[0];
<a name="l00988"></a>00988 
<a name="l00989"></a>00989         <span class="keywordflow">if</span> (<a class="code" href="a00006.html#a07c35268f2e3b72d3e85d3cefe991765" title="list of pipe stages.">m_stages</a>[i].func)
<a name="l00990"></a>00990         {
<a name="l00991"></a>00991             <span class="keywordflow">if</span> (fcntl(<a class="code" href="a00006.html#a07c35268f2e3b72d3e85d3cefe991765" title="list of pipe stages.">m_stages</a>[i].stdout_fd, F_SETFL, O_NONBLOCK) != 0)
<a name="l00992"></a>00992                 <span class="keywordflow">throw</span>(std::runtime_error(std::string(<span class="stringliteral">&quot;Could not set non-block mode on a stage pipe: &quot;</span>) + strerror(errno)));
<a name="l00993"></a>00993         }
<a name="l00994"></a>00994         <span class="keywordflow">if</span> (<a class="code" href="a00006.html#a07c35268f2e3b72d3e85d3cefe991765" title="list of pipe stages.">m_stages</a>[i+1].func)
<a name="l00995"></a>00995         {
<a name="l00996"></a>00996             <span class="keywordflow">if</span> (fcntl(<a class="code" href="a00006.html#a07c35268f2e3b72d3e85d3cefe991765" title="list of pipe stages.">m_stages</a>[i+1].stdin_fd, F_SETFL, O_NONBLOCK) != 0)
<a name="l00997"></a>00997                 <span class="keywordflow">throw</span>(std::runtime_error(std::string(<span class="stringliteral">&quot;Could not set non-block mode on a stage pipe: &quot;</span>) + strerror(errno)));
<a name="l00998"></a>00998         }
<a name="l00999"></a>00999     }
<a name="l01000"></a>01000 
<a name="l01001"></a>01001     <span class="comment">// set up output stream accordingly</span>
<a name="l01002"></a>01002     <span class="keywordflow">switch</span>(<a class="code" href="a00006.html#a14758ab95bd946f5fab64b8852ad6c13" title="describes the currently set input stream type">m_output</a>)
<a name="l01003"></a>01003     {
<a name="l01004"></a>01004     <span class="keywordflow">case</span> <a class="code" href="a00006.html#a8ab2d8746a3f5871229e3b0761b2808caddee570cb9632b8dd02671e7f27181af" title="no special redirection requested">ST_NONE</a>:
<a name="l01005"></a>01005         <span class="comment">// no file change of file descriptor after fork.</span>
<a name="l01006"></a>01006         <a class="code" href="a00006.html#a07c35268f2e3b72d3e85d3cefe991765" title="list of pipe stages.">m_stages</a>.back().stdout_fd = -1;
<a name="l01007"></a>01007         <span class="keywordflow">break</span>;
<a name="l01008"></a>01008 
<a name="l01009"></a>01009     <span class="keywordflow">case</span> <a class="code" href="a00006.html#a8ab2d8746a3f5871229e3b0761b2808cab0a9adf05e9c0522629909727f1df6af" title="input/output directed by/to string">ST_STRING</a>: 
<a name="l01010"></a>01010     <span class="keywordflow">case</span> <a class="code" href="a00006.html#a8ab2d8746a3f5871229e3b0761b2808cab01843bdc62c33c2af3b3ec097c8a604" title="input/output attached to program object">ST_OBJECT</a>: {
<a name="l01011"></a>01011         <span class="comment">// create output pipe for strings and objects.</span>
<a name="l01012"></a>01012         <span class="keywordtype">int</span> pipefd[2];
<a name="l01013"></a>01013 
<a name="l01014"></a>01014         <span class="keywordflow">if</span> (pipe(pipefd) != 0)
<a name="l01015"></a>01015             <span class="keywordflow">throw</span>(std::runtime_error(std::string(<span class="stringliteral">&quot;Could not create an output pipe: &quot;</span>) + strerror(errno)));
<a name="l01016"></a>01016 
<a name="l01017"></a>01017         <span class="keywordflow">if</span> (fcntl(pipefd[0], F_SETFL, O_NONBLOCK) != 0)
<a name="l01018"></a>01018             <span class="keywordflow">throw</span>(std::runtime_error(std::string(<span class="stringliteral">&quot;Could not set non-block mode on output pipe: &quot;</span>) + strerror(errno)));
<a name="l01019"></a>01019 
<a name="l01020"></a>01020         <a class="code" href="a00006.html#a07c35268f2e3b72d3e85d3cefe991765" title="list of pipe stages.">m_stages</a>.back().stdout_fd = pipefd[1];
<a name="l01021"></a>01021         <a class="code" href="a00006.html#ac85c02dcbd63dbd74a295fa9e0081ace" title="for ST_FD the output fd given by the user.">m_output_fd</a> = pipefd[0];
<a name="l01022"></a>01022         <span class="keywordflow">break</span>;
<a name="l01023"></a>01023     }
<a name="l01024"></a>01024     <span class="keywordflow">case</span> <a class="code" href="a00006.html#a8ab2d8746a3f5871229e3b0761b2808cae193ecc1648fa5588716772d53e36cc2" title="redirection to file path">ST_FILE</a>: {
<a name="l01025"></a>01025         <span class="comment">// create or truncate output file</span>
<a name="l01026"></a>01026 
<a name="l01027"></a>01027         <span class="keywordtype">int</span> outfd = open(<a class="code" href="a00006.html#a21a643369af0869e5cc33ea231f5cc6f" title="for ST_FILE the path of the output file.">m_output_file</a>, O_WRONLY | O_CREAT | O_TRUNC, <a class="code" href="a00006.html#af27954420b773f819bbea46573147f9f" title="for ST_FILE the permission used in the open() call.">m_output_file_mode</a>);
<a name="l01028"></a>01028         <span class="keywordflow">if</span> (outfd &lt; 0)
<a name="l01029"></a>01029             <span class="keywordflow">throw</span>(std::runtime_error(std::string(<span class="stringliteral">&quot;Could not open output file: &quot;</span>) + strerror(errno)));
<a name="l01030"></a>01030 
<a name="l01031"></a>01031         <a class="code" href="a00006.html#a07c35268f2e3b72d3e85d3cefe991765" title="list of pipe stages.">m_stages</a>.back().stdout_fd = outfd;
<a name="l01032"></a>01032         <span class="keywordflow">break</span>;
<a name="l01033"></a>01033     }
<a name="l01034"></a>01034     <span class="keywordflow">case</span> <a class="code" href="a00006.html#a8ab2d8746a3f5871229e3b0761b2808ca2ffd509d901b0a0d028d39687b2f381b" title="redirection to existing fd">ST_FD</a>:
<a name="l01035"></a>01035         <span class="comment">// assign user-provided fd to last process</span>
<a name="l01036"></a>01036         <a class="code" href="a00006.html#a07c35268f2e3b72d3e85d3cefe991765" title="list of pipe stages.">m_stages</a>.back().stdout_fd = <a class="code" href="a00006.html#ac85c02dcbd63dbd74a295fa9e0081ace" title="for ST_FD the output fd given by the user.">m_output_fd</a>;
<a name="l01037"></a>01037         <a class="code" href="a00006.html#ac85c02dcbd63dbd74a295fa9e0081ace" title="for ST_FD the output fd given by the user.">m_output_fd</a> = -1;
<a name="l01038"></a>01038         <span class="keywordflow">break</span>;
<a name="l01039"></a>01039     }
<a name="l01040"></a>01040 
<a name="l01041"></a>01041     <span class="comment">// *** Phase 2: launch child processes ******************************* //</span>
<a name="l01042"></a>01042 
<a name="l01043"></a>01043     <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i = 0; i &lt; <a class="code" href="a00006.html#a07c35268f2e3b72d3e85d3cefe991765" title="list of pipe stages.">m_stages</a>.size(); ++i)
<a name="l01044"></a>01044     {
<a name="l01045"></a>01045         <span class="keywordflow">if</span> (<a class="code" href="a00006.html#a07c35268f2e3b72d3e85d3cefe991765" title="list of pipe stages.">m_stages</a>[i].func) <span class="keywordflow">continue</span>;
<a name="l01046"></a>01046 
<a name="l01047"></a>01047         <a class="code" href="a00006.html#ac66a3fee0c9408e4d923a2272e5b5e09" title="Print all arguments of exec() call.">print_exec</a>(<a class="code" href="a00006.html#a07c35268f2e3b72d3e85d3cefe991765" title="list of pipe stages.">m_stages</a>[i].args);
<a name="l01048"></a>01048 
<a name="l01049"></a>01049         pid_t child = fork();
<a name="l01050"></a>01050         <span class="keywordflow">if</span> (child == 0)
<a name="l01051"></a>01051         {
<a name="l01052"></a>01052             <span class="comment">// inside child process</span>
<a name="l01053"></a>01053 
<a name="l01054"></a>01054             <span class="comment">// move assigned file descriptors and close all others</span>
<a name="l01055"></a>01055             <span class="keywordflow">if</span> (<a class="code" href="a00006.html#ad9fae45735aadea8bf6d089afbf92acc" title="for ST_FD the input fd given by the user.">m_input_fd</a> &gt;= 0)
<a name="l01056"></a>01056                 <a class="code" href="a00006.html#a025d172f9111ee2e70c8b5e0d1835dde" title="Safe close() call and output error if fd was already closed.">sclose</a>(<a class="code" href="a00006.html#ad9fae45735aadea8bf6d089afbf92acc" title="for ST_FD the input fd given by the user.">m_input_fd</a>);
<a name="l01057"></a>01057 
<a name="l01058"></a>01058             <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> j = 0; j &lt; <a class="code" href="a00006.html#a07c35268f2e3b72d3e85d3cefe991765" title="list of pipe stages.">m_stages</a>.size(); ++j)
<a name="l01059"></a>01059             {
<a name="l01060"></a>01060                 <span class="keywordflow">if</span> (i == j)
<a name="l01061"></a>01061                 {
<a name="l01062"></a>01062                     <span class="comment">// dup2 file descriptors assigned for this stage as stdin and stdout</span>
<a name="l01063"></a>01063 
<a name="l01064"></a>01064                     <span class="keywordflow">if</span> (<a class="code" href="a00006.html#a07c35268f2e3b72d3e85d3cefe991765" title="list of pipe stages.">m_stages</a>[i].stdin_fd &gt;= 0)
<a name="l01065"></a>01065                     {
<a name="l01066"></a>01066                         <span class="keywordflow">if</span> (dup2(<a class="code" href="a00006.html#a07c35268f2e3b72d3e85d3cefe991765" title="list of pipe stages.">m_stages</a>[i].stdin_fd, STDIN_FILENO) == -1) {
<a name="l01067"></a>01067                             LOG_ERROR(<span class="stringliteral">&quot;Could not redirect file descriptor: &quot;</span> &lt;&lt; strerror(errno));
<a name="l01068"></a>01068                             exit(255);
<a name="l01069"></a>01069                         }
<a name="l01070"></a>01070                     }
<a name="l01071"></a>01071 
<a name="l01072"></a>01072                     <span class="keywordflow">if</span> (<a class="code" href="a00006.html#a07c35268f2e3b72d3e85d3cefe991765" title="list of pipe stages.">m_stages</a>[i].stdout_fd &gt;= 0)
<a name="l01073"></a>01073                     {
<a name="l01074"></a>01074                         <span class="keywordflow">if</span> (dup2(<a class="code" href="a00006.html#a07c35268f2e3b72d3e85d3cefe991765" title="list of pipe stages.">m_stages</a>[i].stdout_fd, STDOUT_FILENO) == -1) {
<a name="l01075"></a>01075                             LOG_ERROR(<span class="stringliteral">&quot;Could not redirect file descriptor: &quot;</span> &lt;&lt; strerror(errno));
<a name="l01076"></a>01076                             exit(255);
<a name="l01077"></a>01077                         }
<a name="l01078"></a>01078                     }
<a name="l01079"></a>01079                 }
<a name="l01080"></a>01080                 <span class="keywordflow">else</span>
<a name="l01081"></a>01081                 {
<a name="l01082"></a>01082                     <span class="comment">// close file descriptors of other stages</span>
<a name="l01083"></a>01083 
<a name="l01084"></a>01084                     <span class="keywordflow">if</span> (<a class="code" href="a00006.html#a07c35268f2e3b72d3e85d3cefe991765" title="list of pipe stages.">m_stages</a>[j].stdin_fd &gt;= 0)
<a name="l01085"></a>01085                         <a class="code" href="a00006.html#a025d172f9111ee2e70c8b5e0d1835dde" title="Safe close() call and output error if fd was already closed.">sclose</a>(<a class="code" href="a00006.html#a07c35268f2e3b72d3e85d3cefe991765" title="list of pipe stages.">m_stages</a>[j].stdin_fd);
<a name="l01086"></a>01086 
<a name="l01087"></a>01087                     <span class="keywordflow">if</span> (<a class="code" href="a00006.html#a07c35268f2e3b72d3e85d3cefe991765" title="list of pipe stages.">m_stages</a>[j].stdout_fd &gt;= 0)
<a name="l01088"></a>01088                         <a class="code" href="a00006.html#a025d172f9111ee2e70c8b5e0d1835dde" title="Safe close() call and output error if fd was already closed.">sclose</a>(<a class="code" href="a00006.html#a07c35268f2e3b72d3e85d3cefe991765" title="list of pipe stages.">m_stages</a>[j].stdout_fd);
<a name="l01089"></a>01089                 }
<a name="l01090"></a>01090             }
<a name="l01091"></a>01091 
<a name="l01092"></a>01092             <span class="keywordflow">if</span> (<a class="code" href="a00006.html#ac85c02dcbd63dbd74a295fa9e0081ace" title="for ST_FD the output fd given by the user.">m_output_fd</a> &gt;= 0)
<a name="l01093"></a>01093                 <a class="code" href="a00006.html#a025d172f9111ee2e70c8b5e0d1835dde" title="Safe close() call and output error if fd was already closed.">sclose</a>(<a class="code" href="a00006.html#ac85c02dcbd63dbd74a295fa9e0081ace" title="for ST_FD the output fd given by the user.">m_output_fd</a>);
<a name="l01094"></a>01094 
<a name="l01095"></a>01095             <span class="comment">// run program</span>
<a name="l01096"></a>01096             <a class="code" href="a00006.html#a3a7184ae172885e1515a9a8f381529af" title="Transform arguments and launch an exec stage using the correct exec() variant.">exec_stage</a>(<a class="code" href="a00006.html#a07c35268f2e3b72d3e85d3cefe991765" title="list of pipe stages.">m_stages</a>[i]);
<a name="l01097"></a>01097 
<a name="l01098"></a>01098             exit(255);
<a name="l01099"></a>01099         }
<a name="l01100"></a>01100 
<a name="l01101"></a>01101         <a class="code" href="a00006.html#a07c35268f2e3b72d3e85d3cefe991765" title="list of pipe stages.">m_stages</a>[i].pid = child;
<a name="l01102"></a>01102     }
<a name="l01103"></a>01103 
<a name="l01104"></a>01104     <span class="comment">// parent process: close all unneeded file descriptors of exec stages.</span>
<a name="l01105"></a>01105 
<a name="l01106"></a>01106     <span class="keywordflow">for</span> (stagelist_type::const_iterator st = <a class="code" href="a00006.html#a07c35268f2e3b72d3e85d3cefe991765" title="list of pipe stages.">m_stages</a>.begin();
<a name="l01107"></a>01107          st != <a class="code" href="a00006.html#a07c35268f2e3b72d3e85d3cefe991765" title="list of pipe stages.">m_stages</a>.end(); ++st)
<a name="l01108"></a>01108     {
<a name="l01109"></a>01109         <span class="keywordflow">if</span> (st-&gt;func) <span class="keywordflow">continue</span>;
<a name="l01110"></a>01110 
<a name="l01111"></a>01111         <span class="keywordflow">if</span> (st-&gt;stdin_fd &gt;= 0)
<a name="l01112"></a>01112             <a class="code" href="a00006.html#a025d172f9111ee2e70c8b5e0d1835dde" title="Safe close() call and output error if fd was already closed.">sclose</a>(st-&gt;stdin_fd);
<a name="l01113"></a>01113 
<a name="l01114"></a>01114         <span class="keywordflow">if</span> (st-&gt;stdout_fd &gt;= 0)
<a name="l01115"></a>01115             <a class="code" href="a00006.html#a025d172f9111ee2e70c8b5e0d1835dde" title="Safe close() call and output error if fd was already closed.">sclose</a>(st-&gt;stdout_fd);
<a name="l01116"></a>01116     }
<a name="l01117"></a>01117 
<a name="l01118"></a>01118     <span class="comment">// *** Phase 3: run select() loop and process data ******************* //</span>
<a name="l01119"></a>01119 
<a name="l01120"></a>01120     <span class="keywordflow">while</span>(1)
<a name="l01121"></a>01121     {
<a name="l01122"></a>01122         <span class="comment">// build file descriptor sets</span>
<a name="l01123"></a>01123 
<a name="l01124"></a>01124         <span class="keywordtype">int</span> max_fds = -1;
<a name="l01125"></a>01125         fd_set read_fds, write_fds;
<a name="l01126"></a>01126 
<a name="l01127"></a>01127         FD_ZERO(&amp;read_fds);
<a name="l01128"></a>01128         FD_ZERO(&amp;write_fds);
<a name="l01129"></a>01129 
<a name="l01130"></a>01130         <span class="keywordflow">if</span> (<a class="code" href="a00006.html#ad9fae45735aadea8bf6d089afbf92acc" title="for ST_FD the input fd given by the user.">m_input_fd</a> &gt;= 0)
<a name="l01131"></a>01131         {
<a name="l01132"></a>01132             <span class="keywordflow">if</span> (<a class="code" href="a00006.html#a4bbcc66a56bca7de4be39c94608486eb" title="describes the currently set input stream type">m_input</a> == <a class="code" href="a00006.html#a8ab2d8746a3f5871229e3b0761b2808cab01843bdc62c33c2af3b3ec097c8a604" title="input/output attached to program object">ST_OBJECT</a>)
<a name="l01133"></a>01133             {
<a name="l01134"></a>01134                 assert(<a class="code" href="a00006.html#a8c3e36cb34a9dc56448d65e55a72adec" title="for ST_OBJECT the input stream source object">m_input_source</a>);
<a name="l01135"></a>01135 
<a name="l01136"></a>01136                 <span class="keywordflow">if</span> (!<a class="code" href="a00006.html#a2eaebf5e5913c7e6fac335401fc9cecb" title="for ST_OBJECT the input stream ring buffer">m_input_rbuffer</a>.size() &amp;&amp; !<a class="code" href="a00006.html#a8c3e36cb34a9dc56448d65e55a72adec" title="for ST_OBJECT the input stream source object">m_input_source</a>-&gt;<a class="code" href="a00009.html#a95df51330c144a7782efc103ace6d453" title="Poll the input source for new data.">poll</a>() &amp;&amp; !<a class="code" href="a00006.html#a2eaebf5e5913c7e6fac335401fc9cecb" title="for ST_OBJECT the input stream ring buffer">m_input_rbuffer</a>.size())
<a name="l01137"></a>01137                 {
<a name="l01138"></a>01138                     <a class="code" href="a00006.html#a025d172f9111ee2e70c8b5e0d1835dde" title="Safe close() call and output error if fd was already closed.">sclose</a>(<a class="code" href="a00006.html#ad9fae45735aadea8bf6d089afbf92acc" title="for ST_FD the input fd given by the user.">m_input_fd</a>);
<a name="l01139"></a>01139                     <a class="code" href="a00006.html#ad9fae45735aadea8bf6d089afbf92acc" title="for ST_FD the input fd given by the user.">m_input_fd</a> = -1;
<a name="l01140"></a>01140 
<a name="l01141"></a>01141                     LOG_INFO(<span class="stringliteral">&quot;Closing input file descriptor: &quot;</span> &lt;&lt; strerror(errno));
<a name="l01142"></a>01142                 }
<a name="l01143"></a>01143                 <span class="keywordflow">else</span>
<a name="l01144"></a>01144                 {
<a name="l01145"></a>01145                     FD_SET(<a class="code" href="a00006.html#ad9fae45735aadea8bf6d089afbf92acc" title="for ST_FD the input fd given by the user.">m_input_fd</a>, &amp;write_fds);
<a name="l01146"></a>01146                     <span class="keywordflow">if</span> (max_fds &lt; <a class="code" href="a00006.html#ad9fae45735aadea8bf6d089afbf92acc" title="for ST_FD the input fd given by the user.">m_input_fd</a>) max_fds = <a class="code" href="a00006.html#ad9fae45735aadea8bf6d089afbf92acc" title="for ST_FD the input fd given by the user.">m_input_fd</a>;
<a name="l01147"></a>01147 
<a name="l01148"></a>01148                     LOG_DEBUG(<span class="stringliteral">&quot;Select on input file descriptor&quot;</span>);
<a name="l01149"></a>01149                 }
<a name="l01150"></a>01150             }
<a name="l01151"></a>01151             <span class="keywordflow">else</span>
<a name="l01152"></a>01152             {
<a name="l01153"></a>01153                 FD_SET(<a class="code" href="a00006.html#ad9fae45735aadea8bf6d089afbf92acc" title="for ST_FD the input fd given by the user.">m_input_fd</a>, &amp;write_fds);
<a name="l01154"></a>01154                 <span class="keywordflow">if</span> (max_fds &lt; <a class="code" href="a00006.html#ad9fae45735aadea8bf6d089afbf92acc" title="for ST_FD the input fd given by the user.">m_input_fd</a>) max_fds = <a class="code" href="a00006.html#ad9fae45735aadea8bf6d089afbf92acc" title="for ST_FD the input fd given by the user.">m_input_fd</a>;
<a name="l01155"></a>01155 
<a name="l01156"></a>01156                 LOG_DEBUG(<span class="stringliteral">&quot;Select on input file descriptor&quot;</span>);
<a name="l01157"></a>01157             }
<a name="l01158"></a>01158         }
<a name="l01159"></a>01159 
<a name="l01160"></a>01160         <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i = 0; i &lt; <a class="code" href="a00006.html#a07c35268f2e3b72d3e85d3cefe991765" title="list of pipe stages.">m_stages</a>.size(); ++i)
<a name="l01161"></a>01161         {
<a name="l01162"></a>01162             <span class="keywordflow">if</span> (!<a class="code" href="a00006.html#a07c35268f2e3b72d3e85d3cefe991765" title="list of pipe stages.">m_stages</a>[i].func) <span class="keywordflow">continue</span>;
<a name="l01163"></a>01163 
<a name="l01164"></a>01164             <span class="keywordflow">if</span> (<a class="code" href="a00006.html#a07c35268f2e3b72d3e85d3cefe991765" title="list of pipe stages.">m_stages</a>[i].stdin_fd &gt;= 0)
<a name="l01165"></a>01165             {
<a name="l01166"></a>01166                 FD_SET(<a class="code" href="a00006.html#a07c35268f2e3b72d3e85d3cefe991765" title="list of pipe stages.">m_stages</a>[i].stdin_fd, &amp;read_fds);
<a name="l01167"></a>01167                 <span class="keywordflow">if</span> (max_fds &lt; <a class="code" href="a00006.html#a07c35268f2e3b72d3e85d3cefe991765" title="list of pipe stages.">m_stages</a>[i].stdin_fd) max_fds = <a class="code" href="a00006.html#a07c35268f2e3b72d3e85d3cefe991765" title="list of pipe stages.">m_stages</a>[i].stdin_fd;
<a name="l01168"></a>01168 
<a name="l01169"></a>01169                 LOG_DEBUG(<span class="stringliteral">&quot;Select on stage input file descriptor&quot;</span>);
<a name="l01170"></a>01170             }
<a name="l01171"></a>01171 
<a name="l01172"></a>01172             <span class="keywordflow">if</span> (<a class="code" href="a00006.html#a07c35268f2e3b72d3e85d3cefe991765" title="list of pipe stages.">m_stages</a>[i].stdout_fd &gt;= 0)
<a name="l01173"></a>01173             {
<a name="l01174"></a>01174                 <span class="keywordflow">if</span> (<a class="code" href="a00006.html#a07c35268f2e3b72d3e85d3cefe991765" title="list of pipe stages.">m_stages</a>[i].outbuffer.size())
<a name="l01175"></a>01175                 {
<a name="l01176"></a>01176                     FD_SET(<a class="code" href="a00006.html#a07c35268f2e3b72d3e85d3cefe991765" title="list of pipe stages.">m_stages</a>[i].stdout_fd, &amp;write_fds);
<a name="l01177"></a>01177                     <span class="keywordflow">if</span> (max_fds &lt; <a class="code" href="a00006.html#a07c35268f2e3b72d3e85d3cefe991765" title="list of pipe stages.">m_stages</a>[i].stdout_fd) max_fds = <a class="code" href="a00006.html#a07c35268f2e3b72d3e85d3cefe991765" title="list of pipe stages.">m_stages</a>[i].stdout_fd;
<a name="l01178"></a>01178 
<a name="l01179"></a>01179                     LOG_DEBUG(<span class="stringliteral">&quot;Select on stage output file descriptor&quot;</span>);
<a name="l01180"></a>01180                 }
<a name="l01181"></a>01181                 <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="a00006.html#a07c35268f2e3b72d3e85d3cefe991765" title="list of pipe stages.">m_stages</a>[i].stdin_fd &lt; 0 &amp;&amp; !<a class="code" href="a00006.html#a07c35268f2e3b72d3e85d3cefe991765" title="list of pipe stages.">m_stages</a>[i].outbuffer.size())
<a name="l01182"></a>01182                 {
<a name="l01183"></a>01183                     <a class="code" href="a00006.html#a025d172f9111ee2e70c8b5e0d1835dde" title="Safe close() call and output error if fd was already closed.">sclose</a>(<a class="code" href="a00006.html#a07c35268f2e3b72d3e85d3cefe991765" title="list of pipe stages.">m_stages</a>[i].stdout_fd);
<a name="l01184"></a>01184                     <a class="code" href="a00006.html#a07c35268f2e3b72d3e85d3cefe991765" title="list of pipe stages.">m_stages</a>[i].stdout_fd = -1;
<a name="l01185"></a>01185 
<a name="l01186"></a>01186                     LOG_INFO(<span class="stringliteral">&quot;Close stage output file descriptor&quot;</span>);
<a name="l01187"></a>01187                 }
<a name="l01188"></a>01188             }
<a name="l01189"></a>01189         }
<a name="l01190"></a>01190 
<a name="l01191"></a>01191         <span class="keywordflow">if</span> (<a class="code" href="a00006.html#ac85c02dcbd63dbd74a295fa9e0081ace" title="for ST_FD the output fd given by the user.">m_output_fd</a> &gt;= 0)
<a name="l01192"></a>01192         {
<a name="l01193"></a>01193             FD_SET(<a class="code" href="a00006.html#ac85c02dcbd63dbd74a295fa9e0081ace" title="for ST_FD the output fd given by the user.">m_output_fd</a>, &amp;read_fds);
<a name="l01194"></a>01194             <span class="keywordflow">if</span> (max_fds &lt; <a class="code" href="a00006.html#ac85c02dcbd63dbd74a295fa9e0081ace" title="for ST_FD the output fd given by the user.">m_output_fd</a>) max_fds = <a class="code" href="a00006.html#ac85c02dcbd63dbd74a295fa9e0081ace" title="for ST_FD the output fd given by the user.">m_output_fd</a>;
<a name="l01195"></a>01195 
<a name="l01196"></a>01196             LOG_DEBUG(<span class="stringliteral">&quot;Select on output file descriptor&quot;</span>);
<a name="l01197"></a>01197         }
<a name="l01198"></a>01198 
<a name="l01199"></a>01199         <span class="comment">// issue select() call</span>
<a name="l01200"></a>01200 
<a name="l01201"></a>01201         <span class="keywordflow">if</span> (max_fds &lt; 0)
<a name="l01202"></a>01202             <span class="keywordflow">break</span>;
<a name="l01203"></a>01203 
<a name="l01204"></a>01204         <span class="keywordtype">int</span> retval = select(max_fds+1, &amp;read_fds, &amp;write_fds, NULL, NULL);
<a name="l01205"></a>01205         <span class="keywordflow">if</span> (retval &lt; 0)
<a name="l01206"></a>01206             <span class="keywordflow">throw</span>(std::runtime_error(std::string(<span class="stringliteral">&quot;Error during select() on file descriptors: &quot;</span>) + strerror(errno)));
<a name="l01207"></a>01207 
<a name="l01208"></a>01208         LOG_TRACE(<span class="stringliteral">&quot;select() on &quot;</span> &lt;&lt; retval &lt;&lt; <span class="stringliteral">&quot; file descriptors: &quot;</span> &lt;&lt; strerror(errno));
<a name="l01209"></a>01209 
<a name="l01210"></a>01210         <span class="comment">// handle file descriptors marked by select() in both sets</span>
<a name="l01211"></a>01211 
<a name="l01212"></a>01212         <span class="keywordflow">if</span> (<a class="code" href="a00006.html#ad9fae45735aadea8bf6d089afbf92acc" title="for ST_FD the input fd given by the user.">m_input_fd</a> &gt;= 0 &amp;&amp; FD_ISSET(<a class="code" href="a00006.html#ad9fae45735aadea8bf6d089afbf92acc" title="for ST_FD the input fd given by the user.">m_input_fd</a>, &amp;write_fds))
<a name="l01213"></a>01213         {
<a name="l01214"></a>01214             <span class="keywordflow">if</span> (<a class="code" href="a00006.html#a4bbcc66a56bca7de4be39c94608486eb" title="describes the currently set input stream type">m_input</a> == <a class="code" href="a00006.html#a8ab2d8746a3f5871229e3b0761b2808cab0a9adf05e9c0522629909727f1df6af" title="input/output directed by/to string">ST_STRING</a>)
<a name="l01215"></a>01215             {
<a name="l01216"></a>01216                 <span class="comment">// write string data to first stdin file descriptor.</span>
<a name="l01217"></a>01217 
<a name="l01218"></a>01218                 assert(<a class="code" href="a00006.html#a0d2189ceb94350948649ef256c471596" title="for ST_STRING a pointer to the user-supplied std::string input stream object.">m_input_string</a>);
<a name="l01219"></a>01219                 assert(m_input_string_pos &lt; m_input_string-&gt;<a class="code" href="a00006.html#ab7097e05c0418971d7be8a541b4c01de" title="Return the number of pipe stages added.">size</a>());
<a name="l01220"></a>01220 
<a name="l01221"></a>01221                 ssize_t wb;
<a name="l01222"></a>01222 
<a name="l01223"></a>01223                 <span class="keywordflow">do</span>
<a name="l01224"></a>01224                 {
<a name="l01225"></a>01225                     wb = write(<a class="code" href="a00006.html#ad9fae45735aadea8bf6d089afbf92acc" title="for ST_FD the input fd given by the user.">m_input_fd</a>,
<a name="l01226"></a>01226                                <a class="code" href="a00006.html#a0d2189ceb94350948649ef256c471596" title="for ST_STRING a pointer to the user-supplied std::string input stream object.">m_input_string</a>-&gt;data() + <a class="code" href="a00006.html#a598f7eb31d7ee38ee0cb7d6d10f92126" title="for ST_STRING the current position in the input stream object.">m_input_string_pos</a>,
<a name="l01227"></a>01227                                <a class="code" href="a00006.html#a0d2189ceb94350948649ef256c471596" title="for ST_STRING a pointer to the user-supplied std::string input stream object.">m_input_string</a>-&gt;size() - <a class="code" href="a00006.html#a598f7eb31d7ee38ee0cb7d6d10f92126" title="for ST_STRING the current position in the input stream object.">m_input_string_pos</a>);
<a name="l01228"></a>01228 
<a name="l01229"></a>01229                     LOG_TRACE(<span class="stringliteral">&quot;Write on input fd: &quot;</span> &lt;&lt; wb);
<a name="l01230"></a>01230 
<a name="l01231"></a>01231                     <span class="keywordflow">if</span> (wb &lt; 0)
<a name="l01232"></a>01232                     {
<a name="l01233"></a>01233                         <span class="keywordflow">if</span> (errno == EAGAIN || errno == EINTR)
<a name="l01234"></a>01234                         {
<a name="l01235"></a>01235                         }
<a name="l01236"></a>01236                         <span class="keywordflow">else</span>
<a name="l01237"></a>01237                         {
<a name="l01238"></a>01238                             LOG_DEBUG(<span class="stringliteral">&quot;Error writing to input file descriptor: &quot;</span> &lt;&lt; strerror(errno));
<a name="l01239"></a>01239 
<a name="l01240"></a>01240                             <a class="code" href="a00006.html#a025d172f9111ee2e70c8b5e0d1835dde" title="Safe close() call and output error if fd was already closed.">sclose</a>(<a class="code" href="a00006.html#ad9fae45735aadea8bf6d089afbf92acc" title="for ST_FD the input fd given by the user.">m_input_fd</a>);
<a name="l01241"></a>01241                             <a class="code" href="a00006.html#ad9fae45735aadea8bf6d089afbf92acc" title="for ST_FD the input fd given by the user.">m_input_fd</a> = -1;
<a name="l01242"></a>01242 
<a name="l01243"></a>01243                             LOG_INFO(<span class="stringliteral">&quot;Closing input file descriptor: &quot;</span> &lt;&lt; strerror(errno));
<a name="l01244"></a>01244                         }
<a name="l01245"></a>01245                     }
<a name="l01246"></a>01246                     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (wb &gt; 0)
<a name="l01247"></a>01247                     {
<a name="l01248"></a>01248                         <a class="code" href="a00006.html#a598f7eb31d7ee38ee0cb7d6d10f92126" title="for ST_STRING the current position in the input stream object.">m_input_string_pos</a> += wb;
<a name="l01249"></a>01249 
<a name="l01250"></a>01250                         <span class="keywordflow">if</span> (<a class="code" href="a00006.html#a598f7eb31d7ee38ee0cb7d6d10f92126" title="for ST_STRING the current position in the input stream object.">m_input_string_pos</a> &gt;= <a class="code" href="a00006.html#a0d2189ceb94350948649ef256c471596" title="for ST_STRING a pointer to the user-supplied std::string input stream object.">m_input_string</a>-&gt;size())
<a name="l01251"></a>01251                         {
<a name="l01252"></a>01252                             <a class="code" href="a00006.html#a025d172f9111ee2e70c8b5e0d1835dde" title="Safe close() call and output error if fd was already closed.">sclose</a>(<a class="code" href="a00006.html#ad9fae45735aadea8bf6d089afbf92acc" title="for ST_FD the input fd given by the user.">m_input_fd</a>);
<a name="l01253"></a>01253                             <a class="code" href="a00006.html#ad9fae45735aadea8bf6d089afbf92acc" title="for ST_FD the input fd given by the user.">m_input_fd</a> = -1;
<a name="l01254"></a>01254 
<a name="l01255"></a>01255                             LOG_INFO(<span class="stringliteral">&quot;Closing input file descriptor: &quot;</span> &lt;&lt; strerror(errno));
<a name="l01256"></a>01256                             <span class="keywordflow">break</span>;
<a name="l01257"></a>01257                         }
<a name="l01258"></a>01258                     }
<a name="l01259"></a>01259                 } <span class="keywordflow">while</span> (wb &gt; 0);
<a name="l01260"></a>01260 
<a name="l01261"></a>01261             }
<a name="l01262"></a>01262             <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="a00006.html#a4bbcc66a56bca7de4be39c94608486eb" title="describes the currently set input stream type">m_input</a> == <a class="code" href="a00006.html#a8ab2d8746a3f5871229e3b0761b2808cab01843bdc62c33c2af3b3ec097c8a604" title="input/output attached to program object">ST_OBJECT</a>)
<a name="l01263"></a>01263             {
<a name="l01264"></a>01264                 <span class="comment">// write buffered data to first stdin file descriptor.</span>
<a name="l01265"></a>01265                 
<a name="l01266"></a>01266                 ssize_t wb;
<a name="l01267"></a>01267 
<a name="l01268"></a>01268                 <span class="keywordflow">do</span>
<a name="l01269"></a>01269                 {
<a name="l01270"></a>01270                     wb = write(<a class="code" href="a00006.html#ad9fae45735aadea8bf6d089afbf92acc" title="for ST_FD the input fd given by the user.">m_input_fd</a>,
<a name="l01271"></a>01271                                <a class="code" href="a00006.html#a2eaebf5e5913c7e6fac335401fc9cecb" title="for ST_OBJECT the input stream ring buffer">m_input_rbuffer</a>.bottom(),
<a name="l01272"></a>01272                                <a class="code" href="a00006.html#a2eaebf5e5913c7e6fac335401fc9cecb" title="for ST_OBJECT the input stream ring buffer">m_input_rbuffer</a>.bottomsize());
<a name="l01273"></a>01273 
<a name="l01274"></a>01274                     LOG_TRACE(<span class="stringliteral">&quot;Write on input fd: &quot;</span> &lt;&lt; wb);
<a name="l01275"></a>01275 
<a name="l01276"></a>01276                     <span class="keywordflow">if</span> (wb &lt; 0)
<a name="l01277"></a>01277                     {
<a name="l01278"></a>01278                         <span class="keywordflow">if</span> (errno == EAGAIN || errno == EINTR)
<a name="l01279"></a>01279                         {
<a name="l01280"></a>01280                         }
<a name="l01281"></a>01281                         <span class="keywordflow">else</span>
<a name="l01282"></a>01282                         {
<a name="l01283"></a>01283                             LOG_INFO(<span class="stringliteral">&quot;Error writing to input file descriptor: &quot;</span> &lt;&lt; strerror(errno));
<a name="l01284"></a>01284 
<a name="l01285"></a>01285                             <a class="code" href="a00006.html#a025d172f9111ee2e70c8b5e0d1835dde" title="Safe close() call and output error if fd was already closed.">sclose</a>(<a class="code" href="a00006.html#ad9fae45735aadea8bf6d089afbf92acc" title="for ST_FD the input fd given by the user.">m_input_fd</a>);
<a name="l01286"></a>01286                             <a class="code" href="a00006.html#ad9fae45735aadea8bf6d089afbf92acc" title="for ST_FD the input fd given by the user.">m_input_fd</a> = -1;
<a name="l01287"></a>01287 
<a name="l01288"></a>01288                             LOG_INFO(<span class="stringliteral">&quot;Closing input file descriptor: &quot;</span> &lt;&lt; strerror(errno));
<a name="l01289"></a>01289                         }
<a name="l01290"></a>01290                     }
<a name="l01291"></a>01291                     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (wb &gt; 0)
<a name="l01292"></a>01292                     {
<a name="l01293"></a>01293                         <a class="code" href="a00006.html#a2eaebf5e5913c7e6fac335401fc9cecb" title="for ST_OBJECT the input stream ring buffer">m_input_rbuffer</a>.advance(wb);
<a name="l01294"></a>01294                     }
<a name="l01295"></a>01295                 } <span class="keywordflow">while</span> (wb &gt; 0);
<a name="l01296"></a>01296             }
<a name="l01297"></a>01297         }
<a name="l01298"></a>01298 
<a name="l01299"></a>01299         <span class="keywordflow">if</span> (<a class="code" href="a00006.html#ac85c02dcbd63dbd74a295fa9e0081ace" title="for ST_FD the output fd given by the user.">m_output_fd</a> &gt;= 0 &amp;&amp; FD_ISSET(<a class="code" href="a00006.html#ac85c02dcbd63dbd74a295fa9e0081ace" title="for ST_FD the output fd given by the user.">m_output_fd</a>, &amp;read_fds))
<a name="l01300"></a>01300         {
<a name="l01301"></a>01301             <span class="comment">// read data from last stdout file descriptor</span>
<a name="l01302"></a>01302 
<a name="l01303"></a>01303             ssize_t rb;
<a name="l01304"></a>01304 
<a name="l01305"></a>01305             <span class="keywordflow">do</span>
<a name="l01306"></a>01306             {
<a name="l01307"></a>01307                 errno = 0;
<a name="l01308"></a>01308 
<a name="l01309"></a>01309                 rb = read(<a class="code" href="a00006.html#ac85c02dcbd63dbd74a295fa9e0081ace" title="for ST_FD the output fd given by the user.">m_output_fd</a>, 
<a name="l01310"></a>01310                           <a class="code" href="a00006.html#a50c69aabf47793e001b1c56264a0d705" title="general buffer used for read() and write() calls.">m_buffer</a>, <span class="keyword">sizeof</span>(<a class="code" href="a00006.html#a50c69aabf47793e001b1c56264a0d705" title="general buffer used for read() and write() calls.">m_buffer</a>));
<a name="l01311"></a>01311 
<a name="l01312"></a>01312                 LOG_TRACE(<span class="stringliteral">&quot;Read on output fd: &quot;</span> &lt;&lt; rb);
<a name="l01313"></a>01313 
<a name="l01314"></a>01314                 <span class="keywordflow">if</span> (rb &lt;= 0)
<a name="l01315"></a>01315                 {
<a name="l01316"></a>01316                     <span class="keywordflow">if</span> (rb == 0 &amp;&amp; errno == 0)
<a name="l01317"></a>01317                     {
<a name="l01318"></a>01318                         <span class="comment">// zero read indicates eof</span>
<a name="l01319"></a>01319 
<a name="l01320"></a>01320                         LOG_INFO(<span class="stringliteral">&quot;Closing output file descriptor: &quot;</span> &lt;&lt; strerror(errno));
<a name="l01321"></a>01321 
<a name="l01322"></a>01322                         <span class="keywordflow">if</span> (<a class="code" href="a00006.html#a14758ab95bd946f5fab64b8852ad6c13" title="describes the currently set input stream type">m_output</a> == <a class="code" href="a00006.html#a8ab2d8746a3f5871229e3b0761b2808cab01843bdc62c33c2af3b3ec097c8a604" title="input/output attached to program object">ST_OBJECT</a>)
<a name="l01323"></a>01323                         {
<a name="l01324"></a>01324                             assert(<a class="code" href="a00006.html#ae6fc1cb223754dfc3deb1000f7f7409d" title="for ST_OBJECT the output stream source object">m_output_sink</a>);
<a name="l01325"></a>01325                             <a class="code" href="a00006.html#ae6fc1cb223754dfc3deb1000f7f7409d" title="for ST_OBJECT the output stream source object">m_output_sink</a>-&gt;<a class="code" href="a00008.html#a7704c6b4f69a974236bd0ed771b659a3" title="Pure virtual function called when the final or preceding pipe stage finishes.">eof</a>();
<a name="l01326"></a>01326                         }
<a name="l01327"></a>01327 
<a name="l01328"></a>01328                         <a class="code" href="a00006.html#a025d172f9111ee2e70c8b5e0d1835dde" title="Safe close() call and output error if fd was already closed.">sclose</a>(<a class="code" href="a00006.html#ac85c02dcbd63dbd74a295fa9e0081ace" title="for ST_FD the output fd given by the user.">m_output_fd</a>);
<a name="l01329"></a>01329                         <a class="code" href="a00006.html#ac85c02dcbd63dbd74a295fa9e0081ace" title="for ST_FD the output fd given by the user.">m_output_fd</a> = -1;
<a name="l01330"></a>01330                     }
<a name="l01331"></a>01331                     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (errno == EAGAIN || errno == EINTR)
<a name="l01332"></a>01332                     {
<a name="l01333"></a>01333                     }
<a name="l01334"></a>01334                     <span class="keywordflow">else</span>
<a name="l01335"></a>01335                     {
<a name="l01336"></a>01336                         LOG_ERROR(<span class="stringliteral">&quot;Error reading from output file descriptor: &quot;</span> &lt;&lt; strerror(errno));
<a name="l01337"></a>01337                     }
<a name="l01338"></a>01338                 }
<a name="l01339"></a>01339                 <span class="keywordflow">else</span>
<a name="l01340"></a>01340                 {
<a name="l01341"></a>01341                     <span class="keywordflow">if</span> (<a class="code" href="a00006.html#a14758ab95bd946f5fab64b8852ad6c13" title="describes the currently set input stream type">m_output</a> == <a class="code" href="a00006.html#a8ab2d8746a3f5871229e3b0761b2808cab0a9adf05e9c0522629909727f1df6af" title="input/output directed by/to string">ST_STRING</a>)
<a name="l01342"></a>01342                     {
<a name="l01343"></a>01343                         assert(<a class="code" href="a00006.html#ad346150703dc6bb47d87917816e66219" title="for ST_STRING a pointer to the user-supplied std::string output stream object.">m_output_string</a>);
<a name="l01344"></a>01344                         <a class="code" href="a00006.html#ad346150703dc6bb47d87917816e66219" title="for ST_STRING a pointer to the user-supplied std::string output stream object.">m_output_string</a>-&gt;append(<a class="code" href="a00006.html#a50c69aabf47793e001b1c56264a0d705" title="general buffer used for read() and write() calls.">m_buffer</a>, rb);
<a name="l01345"></a>01345                     }
<a name="l01346"></a>01346                     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="a00006.html#a14758ab95bd946f5fab64b8852ad6c13" title="describes the currently set input stream type">m_output</a> == <a class="code" href="a00006.html#a8ab2d8746a3f5871229e3b0761b2808cab01843bdc62c33c2af3b3ec097c8a604" title="input/output attached to program object">ST_OBJECT</a>)
<a name="l01347"></a>01347                     {
<a name="l01348"></a>01348                         assert(<a class="code" href="a00006.html#ae6fc1cb223754dfc3deb1000f7f7409d" title="for ST_OBJECT the output stream source object">m_output_sink</a>);
<a name="l01349"></a>01349                         <a class="code" href="a00006.html#ae6fc1cb223754dfc3deb1000f7f7409d" title="for ST_OBJECT the output stream source object">m_output_sink</a>-&gt;<a class="code" href="a00008.html#aad674114373316816576fe4f8a64e23f" title="Pure virtual function which receives the output stream as read from the final or...">process</a>(<a class="code" href="a00006.html#a50c69aabf47793e001b1c56264a0d705" title="general buffer used for read() and write() calls.">m_buffer</a>, rb);
<a name="l01350"></a>01350                     }
<a name="l01351"></a>01351                 }
<a name="l01352"></a>01352             } <span class="keywordflow">while</span> (rb &gt; 0);
<a name="l01353"></a>01353         }
<a name="l01354"></a>01354             
<a name="l01355"></a>01355         <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i = 0; i &lt; <a class="code" href="a00006.html#a07c35268f2e3b72d3e85d3cefe991765" title="list of pipe stages.">m_stages</a>.size(); ++i)
<a name="l01356"></a>01356         {
<a name="l01357"></a>01357             <span class="keywordflow">if</span> (!<a class="code" href="a00006.html#a07c35268f2e3b72d3e85d3cefe991765" title="list of pipe stages.">m_stages</a>[i].func) <span class="keywordflow">continue</span>;
<a name="l01358"></a>01358 
<a name="l01359"></a>01359             <span class="keywordflow">if</span> (<a class="code" href="a00006.html#a07c35268f2e3b72d3e85d3cefe991765" title="list of pipe stages.">m_stages</a>[i].stdin_fd &gt;= 0 &amp;&amp; FD_ISSET(<a class="code" href="a00006.html#a07c35268f2e3b72d3e85d3cefe991765" title="list of pipe stages.">m_stages</a>[i].stdin_fd, &amp;read_fds))
<a name="l01360"></a>01360             {
<a name="l01361"></a>01361                 ssize_t rb;
<a name="l01362"></a>01362 
<a name="l01363"></a>01363                 <span class="keywordflow">do</span>
<a name="l01364"></a>01364                 {
<a name="l01365"></a>01365                     errno = 0;
<a name="l01366"></a>01366 
<a name="l01367"></a>01367                     rb = read(<a class="code" href="a00006.html#a07c35268f2e3b72d3e85d3cefe991765" title="list of pipe stages.">m_stages</a>[i].stdin_fd, 
<a name="l01368"></a>01368                               <a class="code" href="a00006.html#a50c69aabf47793e001b1c56264a0d705" title="general buffer used for read() and write() calls.">m_buffer</a>, <span class="keyword">sizeof</span>(<a class="code" href="a00006.html#a50c69aabf47793e001b1c56264a0d705" title="general buffer used for read() and write() calls.">m_buffer</a>));
<a name="l01369"></a>01369 
<a name="l01370"></a>01370                     LOG_TRACE(<span class="stringliteral">&quot;Read on stage fd: &quot;</span> &lt;&lt; rb);
<a name="l01371"></a>01371 
<a name="l01372"></a>01372                     <span class="keywordflow">if</span> (rb &lt;= 0)
<a name="l01373"></a>01373                     {
<a name="l01374"></a>01374                         <span class="keywordflow">if</span> (rb == 0 &amp;&amp; errno == 0)
<a name="l01375"></a>01375                         {
<a name="l01376"></a>01376                             <span class="comment">// zero read indicates eof</span>
<a name="l01377"></a>01377 
<a name="l01378"></a>01378                             LOG_INFO(<span class="stringliteral">&quot;Closing stage input file descriptor: &quot;</span> &lt;&lt; strerror(errno));
<a name="l01379"></a>01379 
<a name="l01380"></a>01380                             <a class="code" href="a00006.html#a07c35268f2e3b72d3e85d3cefe991765" title="list of pipe stages.">m_stages</a>[i].func-&gt;eof();
<a name="l01381"></a>01381 
<a name="l01382"></a>01382                             <a class="code" href="a00006.html#a025d172f9111ee2e70c8b5e0d1835dde" title="Safe close() call and output error if fd was already closed.">sclose</a>(<a class="code" href="a00006.html#a07c35268f2e3b72d3e85d3cefe991765" title="list of pipe stages.">m_stages</a>[i].stdin_fd);
<a name="l01383"></a>01383                             <a class="code" href="a00006.html#a07c35268f2e3b72d3e85d3cefe991765" title="list of pipe stages.">m_stages</a>[i].stdin_fd = -1;
<a name="l01384"></a>01384                         }
<a name="l01385"></a>01385                         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (errno == EAGAIN || errno == EINTR)
<a name="l01386"></a>01386                         {
<a name="l01387"></a>01387                         }
<a name="l01388"></a>01388                         <span class="keywordflow">else</span>
<a name="l01389"></a>01389                         {
<a name="l01390"></a>01390                             LOG_ERROR(<span class="stringliteral">&quot;Error reading from stage input file descriptor: &quot;</span> &lt;&lt; strerror(errno));
<a name="l01391"></a>01391                         }
<a name="l01392"></a>01392                     }
<a name="l01393"></a>01393                     <span class="keywordflow">else</span>
<a name="l01394"></a>01394                     {
<a name="l01395"></a>01395                         <a class="code" href="a00006.html#a07c35268f2e3b72d3e85d3cefe991765" title="list of pipe stages.">m_stages</a>[i].func-&gt;process(<a class="code" href="a00006.html#a50c69aabf47793e001b1c56264a0d705" title="general buffer used for read() and write() calls.">m_buffer</a>, rb);
<a name="l01396"></a>01396                     }
<a name="l01397"></a>01397                 } <span class="keywordflow">while</span> (rb &gt; 0);
<a name="l01398"></a>01398             }
<a name="l01399"></a>01399 
<a name="l01400"></a>01400             <span class="keywordflow">if</span> (<a class="code" href="a00006.html#a07c35268f2e3b72d3e85d3cefe991765" title="list of pipe stages.">m_stages</a>[i].stdout_fd &gt;= 0 &amp;&amp; FD_ISSET(<a class="code" href="a00006.html#a07c35268f2e3b72d3e85d3cefe991765" title="list of pipe stages.">m_stages</a>[i].stdout_fd, &amp;write_fds))
<a name="l01401"></a>01401             {
<a name="l01402"></a>01402                 <span class="keywordflow">while</span> (<a class="code" href="a00006.html#a07c35268f2e3b72d3e85d3cefe991765" title="list of pipe stages.">m_stages</a>[i].outbuffer.size() &gt; 0)
<a name="l01403"></a>01403                 {
<a name="l01404"></a>01404                     ssize_t wb = write(<a class="code" href="a00006.html#a07c35268f2e3b72d3e85d3cefe991765" title="list of pipe stages.">m_stages</a>[i].stdout_fd,
<a name="l01405"></a>01405                                        <a class="code" href="a00006.html#a07c35268f2e3b72d3e85d3cefe991765" title="list of pipe stages.">m_stages</a>[i].outbuffer.bottom(),
<a name="l01406"></a>01406                                        <a class="code" href="a00006.html#a07c35268f2e3b72d3e85d3cefe991765" title="list of pipe stages.">m_stages</a>[i].outbuffer.bottomsize());
<a name="l01407"></a>01407 
<a name="l01408"></a>01408                     LOG_TRACE(<span class="stringliteral">&quot;Write on stage fd: &quot;</span> &lt;&lt; wb);
<a name="l01409"></a>01409 
<a name="l01410"></a>01410                     <span class="keywordflow">if</span> (wb &lt; 0)
<a name="l01411"></a>01411                     {
<a name="l01412"></a>01412                         <span class="keywordflow">if</span> (errno == EAGAIN || errno == EINTR)
<a name="l01413"></a>01413                         {
<a name="l01414"></a>01414                         }
<a name="l01415"></a>01415                         <span class="keywordflow">else</span>
<a name="l01416"></a>01416                         {
<a name="l01417"></a>01417                             LOG_INFO(<span class="stringliteral">&quot;Error writing to stage output file descriptor: &quot;</span> &lt;&lt; strerror(errno));
<a name="l01418"></a>01418                         }
<a name="l01419"></a>01419                         <span class="keywordflow">break</span>;
<a name="l01420"></a>01420                     }
<a name="l01421"></a>01421                     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (wb &gt; 0)
<a name="l01422"></a>01422                     {
<a name="l01423"></a>01423                         <a class="code" href="a00006.html#a07c35268f2e3b72d3e85d3cefe991765" title="list of pipe stages.">m_stages</a>[i].outbuffer.advance(wb);
<a name="l01424"></a>01424                     }
<a name="l01425"></a>01425                 }
<a name="l01426"></a>01426 
<a name="l01427"></a>01427                 <span class="keywordflow">if</span> (<a class="code" href="a00006.html#a07c35268f2e3b72d3e85d3cefe991765" title="list of pipe stages.">m_stages</a>[i].stdin_fd &lt; 0 &amp;&amp; !<a class="code" href="a00006.html#a07c35268f2e3b72d3e85d3cefe991765" title="list of pipe stages.">m_stages</a>[i].outbuffer.size())
<a name="l01428"></a>01428                 {
<a name="l01429"></a>01429                     LOG_INFO(<span class="stringliteral">&quot;Closing stage output file descriptor: &quot;</span> &lt;&lt; strerror(errno));
<a name="l01430"></a>01430 
<a name="l01431"></a>01431                     <a class="code" href="a00006.html#a025d172f9111ee2e70c8b5e0d1835dde" title="Safe close() call and output error if fd was already closed.">sclose</a>(<a class="code" href="a00006.html#a07c35268f2e3b72d3e85d3cefe991765" title="list of pipe stages.">m_stages</a>[i].stdout_fd);
<a name="l01432"></a>01432                     <a class="code" href="a00006.html#a07c35268f2e3b72d3e85d3cefe991765" title="list of pipe stages.">m_stages</a>[i].stdout_fd = -1;
<a name="l01433"></a>01433                 }
<a name="l01434"></a>01434             }
<a name="l01435"></a>01435         }
<a name="l01436"></a>01436     }
<a name="l01437"></a>01437 
<a name="l01438"></a>01438     <span class="comment">// *** Phase 4: call wait() for all children processes *************** //</span>
<a name="l01439"></a>01439 
<a name="l01440"></a>01440     <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> donepid = 0;
<a name="l01441"></a>01441 
<a name="l01442"></a>01442     <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i = 0; i &lt; <a class="code" href="a00006.html#a07c35268f2e3b72d3e85d3cefe991765" title="list of pipe stages.">m_stages</a>.size(); ++i)
<a name="l01443"></a>01443     {
<a name="l01444"></a>01444         <span class="keywordflow">if</span> (!<a class="code" href="a00006.html#a07c35268f2e3b72d3e85d3cefe991765" title="list of pipe stages.">m_stages</a>[i].func) <span class="keywordflow">continue</span>;
<a name="l01445"></a>01445         ++donepid;
<a name="l01446"></a>01446     }
<a name="l01447"></a>01447 
<a name="l01448"></a>01448     <span class="keywordflow">while</span> (donepid != <a class="code" href="a00006.html#a07c35268f2e3b72d3e85d3cefe991765" title="list of pipe stages.">m_stages</a>.size())
<a name="l01449"></a>01449     {
<a name="l01450"></a>01450         <span class="keywordtype">int</span> status;
<a name="l01451"></a>01451         <span class="keywordtype">int</span> p = wait(&amp;status);
<a name="l01452"></a>01452 
<a name="l01453"></a>01453         <span class="keywordflow">if</span> (p &lt; 0)
<a name="l01454"></a>01454         {
<a name="l01455"></a>01455             LOG_ERROR(<span class="stringliteral">&quot;Error calling wait(): &quot;</span> &lt;&lt; strerror(errno));
<a name="l01456"></a>01456             <span class="keywordflow">break</span>;
<a name="l01457"></a>01457         }
<a name="l01458"></a>01458 
<a name="l01459"></a>01459         <span class="keywordtype">bool</span> found = <span class="keyword">false</span>;
<a name="l01460"></a>01460 
<a name="l01461"></a>01461         <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i = 0; i &lt; <a class="code" href="a00006.html#a07c35268f2e3b72d3e85d3cefe991765" title="list of pipe stages.">m_stages</a>.size(); ++i)
<a name="l01462"></a>01462         {
<a name="l01463"></a>01463             <span class="keywordflow">if</span> (p == <a class="code" href="a00006.html#a07c35268f2e3b72d3e85d3cefe991765" title="list of pipe stages.">m_stages</a>[i].pid)
<a name="l01464"></a>01464             {
<a name="l01465"></a>01465                 <a class="code" href="a00006.html#a07c35268f2e3b72d3e85d3cefe991765" title="list of pipe stages.">m_stages</a>[i].retstatus = status;
<a name="l01466"></a>01466 
<a name="l01467"></a>01467                 <span class="keywordflow">if</span> (WIFEXITED(status))
<a name="l01468"></a>01468                 {
<a name="l01469"></a>01469                     LOG_INFO(<span class="stringliteral">&quot;Finished exec() stage &quot;</span> &lt;&lt; p &lt;&lt; <span class="stringliteral">&quot; with retcode &quot;</span> &lt;&lt; WEXITSTATUS(status));
<a name="l01470"></a>01470                 }
<a name="l01471"></a>01471                 <span class="keywordflow">else</span> <span class="keywordflow">if</span> (WIFSIGNALED(status))
<a name="l01472"></a>01472                 {
<a name="l01473"></a>01473                     LOG_INFO(<span class="stringliteral">&quot;Finished exec() stage &quot;</span> &lt;&lt; p &lt;&lt; <span class="stringliteral">&quot; with signal &quot;</span> &lt;&lt; WTERMSIG(status));
<a name="l01474"></a>01474                 }
<a name="l01475"></a>01475                 <span class="keywordflow">else</span>
<a name="l01476"></a>01476                 {
<a name="l01477"></a>01477                     LOG_ERROR(<span class="stringliteral">&quot;Error in wait(): unknown return status for pid &quot;</span> &lt;&lt; p);
<a name="l01478"></a>01478                 }
<a name="l01479"></a>01479 
<a name="l01480"></a>01480                 ++donepid;
<a name="l01481"></a>01481                 found = <span class="keyword">true</span>;
<a name="l01482"></a>01482                 <span class="keywordflow">break</span>;
<a name="l01483"></a>01483             }
<a name="l01484"></a>01484         }
<a name="l01485"></a>01485 
<a name="l01486"></a>01486         <span class="keywordflow">if</span> (!found)
<a name="l01487"></a>01487         {
<a name="l01488"></a>01488             LOG_ERROR(<span class="stringliteral">&quot;Error in wait(): syscall returned an unknown child pid.&quot;</span>);
<a name="l01489"></a>01489         }
<a name="l01490"></a>01490     }
<a name="l01491"></a>01491 
<a name="l01492"></a>01492     LOG_INFO(<span class="stringliteral">&quot;Finished running pipe.&quot;</span>);
<a name="l01493"></a>01493 }
<a name="l01494"></a>01494 
<a name="l01495"></a>01495 <span class="comment">// --- ExecPipe --------------------------------------------------------- //</span>
<a name="l01496"></a>01496 
<a name="l01497"></a><a class="code" href="a00005.html#abf40df4272d216c8a5e942958771c9a3">01497</a> <a class="code" href="a00005.html#abf40df4272d216c8a5e942958771c9a3" title="Construct a new uninitialize execution pipe.">ExecPipe::ExecPipe</a>()
<a name="l01498"></a>01498     : m_impl(new <a class="code" href="a00006.html" title="Main library implementation (internal object).">ExecPipeImpl</a>)
<a name="l01499"></a>01499 {
<a name="l01500"></a>01500     ++<a class="code" href="a00005.html#a8c347680da2a13221448596d4d051c6c" title="reference-counted pointer implementation">m_impl</a>-&gt;<a class="code" href="a00006.html#a388602062827c90cf689f9112075bf40" title="Return writable reference to counter.">refs</a>();
<a name="l01501"></a>01501 }
<a name="l01502"></a>01502 
<a name="l01503"></a><a class="code" href="a00005.html#a91db2137baa133ed9aeee3939ad27c4f">01503</a> <a class="code" href="a00005.html#a91db2137baa133ed9aeee3939ad27c4f" title="Release reference to execution pipe.">ExecPipe::~ExecPipe</a>()
<a name="l01504"></a>01504 {
<a name="l01505"></a>01505     <span class="keywordflow">if</span> (--<a class="code" href="a00005.html#a8c347680da2a13221448596d4d051c6c" title="reference-counted pointer implementation">m_impl</a>-&gt;<a class="code" href="a00006.html#a388602062827c90cf689f9112075bf40" title="Return writable reference to counter.">refs</a>() == 0)
<a name="l01506"></a>01506         <span class="keyword">delete</span> <a class="code" href="a00005.html#a8c347680da2a13221448596d4d051c6c" title="reference-counted pointer implementation">m_impl</a>;
<a name="l01507"></a>01507 }
<a name="l01508"></a>01508 
<a name="l01509"></a><a class="code" href="a00005.html#af24c9634f03cf703149c4106dd49093d">01509</a> <a class="code" href="a00005.html#abf40df4272d216c8a5e942958771c9a3" title="Construct a new uninitialize execution pipe.">ExecPipe::ExecPipe</a>(<span class="keyword">const</span> <a class="code" href="a00005.html" title="Main library interface (reference counted pointer).">ExecPipe</a>&amp; ep)
<a name="l01510"></a>01510     : m_impl(ep.m_impl)
<a name="l01511"></a>01511 {
<a name="l01512"></a>01512     ++<a class="code" href="a00005.html#a8c347680da2a13221448596d4d051c6c" title="reference-counted pointer implementation">m_impl</a>-&gt;<a class="code" href="a00006.html#a388602062827c90cf689f9112075bf40" title="Return writable reference to counter.">refs</a>();
<a name="l01513"></a>01513 }
<a name="l01514"></a>01514 
<a name="l01515"></a><a class="code" href="a00005.html#a7eabb99ea766f48d7e38e55f4612ca6f">01515</a> <a class="code" href="a00005.html" title="Main library interface (reference counted pointer).">ExecPipe</a>&amp; <a class="code" href="a00005.html#a7eabb99ea766f48d7e38e55f4612ca6f" title="Assignment operator creates a new reference to the right pipe.">ExecPipe::operator=</a>(<span class="keyword">const</span> <a class="code" href="a00005.html" title="Main library interface (reference counted pointer).">ExecPipe</a>&amp; ep)
<a name="l01516"></a>01516 {
<a name="l01517"></a>01517     <span class="keywordflow">if</span> (<span class="keyword">this</span> != &amp;ep)
<a name="l01518"></a>01518     {
<a name="l01519"></a>01519         <span class="keywordflow">if</span> (--<a class="code" href="a00005.html#a8c347680da2a13221448596d4d051c6c" title="reference-counted pointer implementation">m_impl</a>-&gt;<a class="code" href="a00006.html#a388602062827c90cf689f9112075bf40" title="Return writable reference to counter.">refs</a>() == 0)
<a name="l01520"></a>01520             <span class="keyword">delete</span> <a class="code" href="a00005.html#a8c347680da2a13221448596d4d051c6c" title="reference-counted pointer implementation">m_impl</a>;
<a name="l01521"></a>01521 
<a name="l01522"></a>01522         <a class="code" href="a00005.html#a8c347680da2a13221448596d4d051c6c" title="reference-counted pointer implementation">m_impl</a> = ep.<a class="code" href="a00005.html#a8c347680da2a13221448596d4d051c6c" title="reference-counted pointer implementation">m_impl</a>;
<a name="l01523"></a>01523         ++<a class="code" href="a00005.html#a8c347680da2a13221448596d4d051c6c" title="reference-counted pointer implementation">m_impl</a>-&gt;<a class="code" href="a00006.html#a388602062827c90cf689f9112075bf40" title="Return writable reference to counter.">refs</a>();
<a name="l01524"></a>01524     }
<a name="l01525"></a>01525     <span class="keywordflow">return</span> *<span class="keyword">this</span>;
<a name="l01526"></a>01526 }
<a name="l01527"></a>01527 
<a name="l01528"></a><a class="code" href="a00005.html#a8890462668087c4c6e7f58781fcb16c0">01528</a> <span class="keywordtype">void</span> <a class="code" href="a00005.html#a8890462668087c4c6e7f58781fcb16c0" title="Change the current debug level. The default is DL_ERROR.">ExecPipe::set_debug_level</a>(<span class="keyword">enum</span> <a class="code" href="a00005.html#a734df6d57aeb61f58303da95536ce28d" title="Enumeration for ascending debug levels.">DebugLevel</a> dl)
<a name="l01529"></a>01529 {
<a name="l01530"></a>01530     <span class="keywordflow">return</span> <a class="code" href="a00005.html#a8c347680da2a13221448596d4d051c6c" title="reference-counted pointer implementation">m_impl</a>-&gt;<a class="code" href="a00006.html#a33fd022e5040f5704c9b2ac60b926ade" title="Change the current debug level. The default is DL_ERROR.">set_debug_level</a>(dl);
<a name="l01531"></a>01531 }
<a name="l01532"></a>01532 
<a name="l01533"></a><a class="code" href="a00005.html#a2c77f408c98f66c2889c484f5e5efb4a">01533</a> <span class="keywordtype">void</span> <a class="code" href="a00005.html#a2c77f408c98f66c2889c484f5e5efb4a" title="Change output function for debug messages.">ExecPipe::set_debug_output</a>(<span class="keywordtype">void</span> (*output)(<span class="keyword">const</span> <span class="keywordtype">char</span> *line))
<a name="l01534"></a>01534 {
<a name="l01535"></a>01535     <span class="keywordflow">return</span> <a class="code" href="a00005.html#a8c347680da2a13221448596d4d051c6c" title="reference-counted pointer implementation">m_impl</a>-&gt;<a class="code" href="a00006.html#a9a85c2633b19b3178d09034a05a22947" title="Change output function for debug messages.">set_debug_output</a>(output);
<a name="l01536"></a>01536 }
<a name="l01537"></a>01537 
<a name="l01538"></a><a class="code" href="a00005.html#aff77e25ccbb4e666ed4f0342a059b9dd">01538</a> <span class="keywordtype">void</span> <a class="code" href="a00005.html#aff77e25ccbb4e666ed4f0342a059b9dd" title="Assign an already opened file descriptor as input stream for the first exec stage...">ExecPipe::set_input_fd</a>(<span class="keywordtype">int</span> fd)
<a name="l01539"></a>01539 {
<a name="l01540"></a>01540     <span class="keywordflow">return</span> <a class="code" href="a00005.html#a8c347680da2a13221448596d4d051c6c" title="reference-counted pointer implementation">m_impl</a>-&gt;<a class="code" href="a00006.html#a473653cf8b5cff978232c0663d912085" title="Assign an already opened file descriptor as input stream for the first exec stage...">set_input_fd</a>(fd);
<a name="l01541"></a>01541 }
<a name="l01542"></a>01542 
<a name="l01543"></a><a class="code" href="a00005.html#a9afb508b49785a7ee6b664148588014b">01543</a> <span class="keywordtype">void</span> <a class="code" href="a00005.html#a9afb508b49785a7ee6b664148588014b" title="Assign a file as input stream source.">ExecPipe::set_input_file</a>(<span class="keyword">const</span> <span class="keywordtype">char</span>* path)
<a name="l01544"></a>01544 {
<a name="l01545"></a>01545     <span class="keywordflow">return</span> <a class="code" href="a00005.html#a8c347680da2a13221448596d4d051c6c" title="reference-counted pointer implementation">m_impl</a>-&gt;<a class="code" href="a00006.html#af61214f8c015b537a590795091d8bde9" title="Assign a file as input stream source.">set_input_file</a>(path);
<a name="l01546"></a>01546 }
<a name="l01547"></a>01547 
<a name="l01548"></a><a class="code" href="a00005.html#a9a0f38ea61b4cbc86aecc5f04e037fa2">01548</a> <span class="keywordtype">void</span> <a class="code" href="a00005.html#a9a0f38ea61b4cbc86aecc5f04e037fa2" title="Assign a std::string as input stream source.">ExecPipe::set_input_string</a>(<span class="keyword">const</span> std::string* input)
<a name="l01549"></a>01549 {
<a name="l01550"></a>01550     <span class="keywordflow">return</span> <a class="code" href="a00005.html#a8c347680da2a13221448596d4d051c6c" title="reference-counted pointer implementation">m_impl</a>-&gt;<a class="code" href="a00006.html#ab0bf8f67de38e68b6490e3d877696de3" title="Assign a std::string as input stream source.">set_input_string</a>(input);
<a name="l01551"></a>01551 }
<a name="l01552"></a>01552 
<a name="l01553"></a><a class="code" href="a00005.html#ab1de27be9540428386031c0378405037">01553</a> <span class="keywordtype">void</span> <a class="code" href="a00005.html#ab1de27be9540428386031c0378405037" title="Assign a PipeSource as input stream source.">ExecPipe::set_input_source</a>(<a class="code" href="a00009.html" title="Abstract class used as an input stream source for an ExecPipe.">PipeSource</a>* source)
<a name="l01554"></a>01554 {
<a name="l01555"></a>01555     <span class="keywordflow">return</span> <a class="code" href="a00005.html#a8c347680da2a13221448596d4d051c6c" title="reference-counted pointer implementation">m_impl</a>-&gt;<a class="code" href="a00006.html#a01f83eb33bb50c2bdefc3d82d8e03c1d" title="Assign a PipeSource as input stream source.">set_input_source</a>(source);
<a name="l01556"></a>01556 }
<a name="l01557"></a>01557    
<a name="l01558"></a><a class="code" href="a00005.html#a1668a23be41fea81f7899dcbebbe767d">01558</a> <span class="keywordtype">void</span> <a class="code" href="a00005.html#a1668a23be41fea81f7899dcbebbe767d" title="Assign an already opened file descriptor as output stream for the last exec stage...">ExecPipe::set_output_fd</a>(<span class="keywordtype">int</span> fd)
<a name="l01559"></a>01559 {
<a name="l01560"></a>01560     <span class="keywordflow">return</span> <a class="code" href="a00005.html#a8c347680da2a13221448596d4d051c6c" title="reference-counted pointer implementation">m_impl</a>-&gt;<a class="code" href="a00006.html#a6a19b51e2f35870f85d1db85fe44bb53" title="Assign an already opened file descriptor as output stream for the last exec stage...">set_output_fd</a>(fd);
<a name="l01561"></a>01561 }
<a name="l01562"></a>01562 
<a name="l01563"></a><a class="code" href="a00005.html#ad8bc4dd1a0f2e137544876ae0ba78ee9">01563</a> <span class="keywordtype">void</span> <a class="code" href="a00005.html#ad8bc4dd1a0f2e137544876ae0ba78ee9" title="Assign a file as output stream destination.">ExecPipe::set_output_file</a>(<span class="keyword">const</span> <span class="keywordtype">char</span>* path, <span class="keywordtype">int</span> mode)
<a name="l01564"></a>01564 {
<a name="l01565"></a>01565     <span class="keywordflow">return</span> <a class="code" href="a00005.html#a8c347680da2a13221448596d4d051c6c" title="reference-counted pointer implementation">m_impl</a>-&gt;<a class="code" href="a00006.html#afb5eb52d6b56d9a7ab0c9c6bdcdeec52" title="Assign a file as output stream destination.">set_output_file</a>(path, mode);
<a name="l01566"></a>01566 }
<a name="l01567"></a>01567 
<a name="l01568"></a><a class="code" href="a00005.html#a9536d076bbf9e82dd17e09c9aa77f7a8">01568</a> <span class="keywordtype">void</span> <a class="code" href="a00005.html#a9536d076bbf9e82dd17e09c9aa77f7a8" title="Assign a std::string as output stream destination.">ExecPipe::set_output_string</a>(std::string* output)
<a name="l01569"></a>01569 {
<a name="l01570"></a>01570     <span class="keywordflow">return</span> <a class="code" href="a00005.html#a8c347680da2a13221448596d4d051c6c" title="reference-counted pointer implementation">m_impl</a>-&gt;<a class="code" href="a00006.html#aed9907487ff26e0b42fdb12641117e9c" title="Assign a std::string as output stream destination.">set_output_string</a>(output);
<a name="l01571"></a>01571 }
<a name="l01572"></a>01572 
<a name="l01573"></a><a class="code" href="a00005.html#a313a290fea965ec30b6c159a74973945">01573</a> <span class="keywordtype">void</span> <a class="code" href="a00005.html#a313a290fea965ec30b6c159a74973945" title="Assign a PipeSink as output stream destination.">ExecPipe::set_output_sink</a>(<a class="code" href="a00008.html" title="Abstract class used as an output stream source for an ExecPipe.">PipeSink</a>* sink)
<a name="l01574"></a>01574 {
<a name="l01575"></a>01575     <span class="keywordflow">return</span> <a class="code" href="a00005.html#a8c347680da2a13221448596d4d051c6c" title="reference-counted pointer implementation">m_impl</a>-&gt;<a class="code" href="a00006.html#a528bac3e7649c2f2f26c001c631e9e7c" title="Assign a PipeSink as output stream destination.">set_output_sink</a>(sink);
<a name="l01576"></a>01576 }
<a name="l01577"></a>01577 
<a name="l01578"></a><a class="code" href="a00005.html#a815c68ac13f65597312b9efa2e2c54d6">01578</a> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="a00005.html#a815c68ac13f65597312b9efa2e2c54d6" title="Return the number of pipe stages added.">ExecPipe::size</a>()<span class="keyword"> const</span>
<a name="l01579"></a>01579 <span class="keyword"></span>{
<a name="l01580"></a>01580     <span class="keywordflow">return</span> <a class="code" href="a00005.html#a8c347680da2a13221448596d4d051c6c" title="reference-counted pointer implementation">m_impl</a>-&gt;<a class="code" href="a00006.html#ab7097e05c0418971d7be8a541b4c01de" title="Return the number of pipe stages added.">size</a>();
<a name="l01581"></a>01581 }
<a name="l01582"></a>01582 
<a name="l01583"></a><a class="code" href="a00005.html#abef69ffbc8c00ed14536c1474f182175">01583</a> <span class="keywordtype">void</span> <a class="code" href="a00005.html#abef69ffbc8c00ed14536c1474f182175" title="Add an exec() stage to the pipe with given arguments.">ExecPipe::add_exec</a>(<span class="keyword">const</span> <span class="keywordtype">char</span>* prog)
<a name="l01584"></a>01584 {
<a name="l01585"></a>01585     <span class="keywordflow">return</span> <a class="code" href="a00005.html#a8c347680da2a13221448596d4d051c6c" title="reference-counted pointer implementation">m_impl</a>-&gt;<a class="code" href="a00006.html#a21e0256c55f3c13e7cb8b31078a3fde6" title="Add an exec() stage to the pipe with given arguments.">add_exec</a>(prog);
<a name="l01586"></a>01586 }
<a name="l01587"></a>01587 
<a name="l01588"></a><a class="code" href="a00005.html#ac402b3b99ca613c9911f019f55867935">01588</a> <span class="keywordtype">void</span> <a class="code" href="a00005.html#abef69ffbc8c00ed14536c1474f182175" title="Add an exec() stage to the pipe with given arguments.">ExecPipe::add_exec</a>(<span class="keyword">const</span> <span class="keywordtype">char</span>* prog, <span class="keyword">const</span> <span class="keywordtype">char</span>* arg1)
<a name="l01589"></a>01589 {
<a name="l01590"></a>01590     <span class="keywordflow">return</span> <a class="code" href="a00005.html#a8c347680da2a13221448596d4d051c6c" title="reference-counted pointer implementation">m_impl</a>-&gt;<a class="code" href="a00006.html#a21e0256c55f3c13e7cb8b31078a3fde6" title="Add an exec() stage to the pipe with given arguments.">add_exec</a>(prog, arg1);
<a name="l01591"></a>01591 }
<a name="l01592"></a>01592 
<a name="l01593"></a><a class="code" href="a00005.html#ae392e8b1841e3b62a5f8cce2f95ea299">01593</a> <span class="keywordtype">void</span> <a class="code" href="a00005.html#abef69ffbc8c00ed14536c1474f182175" title="Add an exec() stage to the pipe with given arguments.">ExecPipe::add_exec</a>(<span class="keyword">const</span> <span class="keywordtype">char</span>* prog, <span class="keyword">const</span> <span class="keywordtype">char</span>* arg1, <span class="keyword">const</span> <span class="keywordtype">char</span>* arg2)
<a name="l01594"></a>01594 {
<a name="l01595"></a>01595     <span class="keywordflow">return</span> <a class="code" href="a00005.html#a8c347680da2a13221448596d4d051c6c" title="reference-counted pointer implementation">m_impl</a>-&gt;<a class="code" href="a00006.html#a21e0256c55f3c13e7cb8b31078a3fde6" title="Add an exec() stage to the pipe with given arguments.">add_exec</a>(prog, arg1, arg2);
<a name="l01596"></a>01596 }
<a name="l01597"></a>01597 
<a name="l01598"></a><a class="code" href="a00005.html#ad0ecfa9555f7877b57d83e41ad476523">01598</a> <span class="keywordtype">void</span> <a class="code" href="a00005.html#abef69ffbc8c00ed14536c1474f182175" title="Add an exec() stage to the pipe with given arguments.">ExecPipe::add_exec</a>(<span class="keyword">const</span> <span class="keywordtype">char</span>* prog, <span class="keyword">const</span> <span class="keywordtype">char</span>* arg1, <span class="keyword">const</span> <span class="keywordtype">char</span>* arg2, <span class="keyword">const</span> <span class="keywordtype">char</span>* arg3)
<a name="l01599"></a>01599 {
<a name="l01600"></a>01600     <span class="keywordflow">return</span> <a class="code" href="a00005.html#a8c347680da2a13221448596d4d051c6c" title="reference-counted pointer implementation">m_impl</a>-&gt;<a class="code" href="a00006.html#a21e0256c55f3c13e7cb8b31078a3fde6" title="Add an exec() stage to the pipe with given arguments.">add_exec</a>(prog, arg1, arg2, arg3);
<a name="l01601"></a>01601 }
<a name="l01602"></a>01602 
<a name="l01603"></a><a class="code" href="a00005.html#a737e2649b3f2c48d2eda5143c8c182b1">01603</a> <span class="keywordtype">void</span> <a class="code" href="a00005.html#abef69ffbc8c00ed14536c1474f182175" title="Add an exec() stage to the pipe with given arguments.">ExecPipe::add_exec</a>(<span class="keyword">const</span> std::vector&lt;std::string&gt;* args)
<a name="l01604"></a>01604 {
<a name="l01605"></a>01605     <span class="keywordflow">return</span> <a class="code" href="a00005.html#a8c347680da2a13221448596d4d051c6c" title="reference-counted pointer implementation">m_impl</a>-&gt;<a class="code" href="a00006.html#a21e0256c55f3c13e7cb8b31078a3fde6" title="Add an exec() stage to the pipe with given arguments.">add_exec</a>(args);
<a name="l01606"></a>01606 }
<a name="l01607"></a>01607 
<a name="l01608"></a><a class="code" href="a00005.html#a02209f5cbef544191957d95c6f2eb27b">01608</a> <span class="keywordtype">void</span> <a class="code" href="a00005.html#a02209f5cbef544191957d95c6f2eb27b" title="Add an execp() stage to the pipe with given arguments.">ExecPipe::add_execp</a>(<span class="keyword">const</span> <span class="keywordtype">char</span>* prog)
<a name="l01609"></a>01609 {
<a name="l01610"></a>01610     <span class="keywordflow">return</span> <a class="code" href="a00005.html#a8c347680da2a13221448596d4d051c6c" title="reference-counted pointer implementation">m_impl</a>-&gt;<a class="code" href="a00006.html#ab88f4227bd432173937571cd31606413" title="Add an execp() stage to the pipe with given arguments.">add_execp</a>(prog);
<a name="l01611"></a>01611 }
<a name="l01612"></a>01612 
<a name="l01613"></a><a class="code" href="a00005.html#adc90e47020856e7dcafe5d00bf82049e">01613</a> <span class="keywordtype">void</span> <a class="code" href="a00005.html#a02209f5cbef544191957d95c6f2eb27b" title="Add an execp() stage to the pipe with given arguments.">ExecPipe::add_execp</a>(<span class="keyword">const</span> <span class="keywordtype">char</span>* prog, <span class="keyword">const</span> <span class="keywordtype">char</span>* arg1)
<a name="l01614"></a>01614 {
<a name="l01615"></a>01615     <span class="keywordflow">return</span> <a class="code" href="a00005.html#a8c347680da2a13221448596d4d051c6c" title="reference-counted pointer implementation">m_impl</a>-&gt;<a class="code" href="a00006.html#ab88f4227bd432173937571cd31606413" title="Add an execp() stage to the pipe with given arguments.">add_execp</a>(prog, arg1);
<a name="l01616"></a>01616 }
<a name="l01617"></a>01617 
<a name="l01618"></a><a class="code" href="a00005.html#a4234eb0e289096bf75ecaaf1e536fc8f">01618</a> <span class="keywordtype">void</span> <a class="code" href="a00005.html#a02209f5cbef544191957d95c6f2eb27b" title="Add an execp() stage to the pipe with given arguments.">ExecPipe::add_execp</a>(<span class="keyword">const</span> <span class="keywordtype">char</span>* prog, <span class="keyword">const</span> <span class="keywordtype">char</span>* arg1, <span class="keyword">const</span> <span class="keywordtype">char</span>* arg2)
<a name="l01619"></a>01619 {
<a name="l01620"></a>01620     <span class="keywordflow">return</span> <a class="code" href="a00005.html#a8c347680da2a13221448596d4d051c6c" title="reference-counted pointer implementation">m_impl</a>-&gt;<a class="code" href="a00006.html#ab88f4227bd432173937571cd31606413" title="Add an execp() stage to the pipe with given arguments.">add_execp</a>(prog, arg1, arg2);
<a name="l01621"></a>01621 }
<a name="l01622"></a>01622 
<a name="l01623"></a><a class="code" href="a00005.html#aba87beabbfa6b9a3f9bab985e6476bd2">01623</a> <span class="keywordtype">void</span> <a class="code" href="a00005.html#a02209f5cbef544191957d95c6f2eb27b" title="Add an execp() stage to the pipe with given arguments.">ExecPipe::add_execp</a>(<span class="keyword">const</span> <span class="keywordtype">char</span>* prog, <span class="keyword">const</span> <span class="keywordtype">char</span>* arg1, <span class="keyword">const</span> <span class="keywordtype">char</span>* arg2, <span class="keyword">const</span> <span class="keywordtype">char</span>* arg3)
<a name="l01624"></a>01624 {
<a name="l01625"></a>01625     <span class="keywordflow">return</span> <a class="code" href="a00005.html#a8c347680da2a13221448596d4d051c6c" title="reference-counted pointer implementation">m_impl</a>-&gt;<a class="code" href="a00006.html#ab88f4227bd432173937571cd31606413" title="Add an execp() stage to the pipe with given arguments.">add_execp</a>(prog, arg1, arg2, arg3);
<a name="l01626"></a>01626 }
<a name="l01627"></a>01627 
<a name="l01628"></a><a class="code" href="a00005.html#a93f23ddba358ea3eceb9ee9a62ddb481">01628</a> <span class="keywordtype">void</span> <a class="code" href="a00005.html#a02209f5cbef544191957d95c6f2eb27b" title="Add an execp() stage to the pipe with given arguments.">ExecPipe::add_execp</a>(<span class="keyword">const</span> std::vector&lt;std::string&gt;* args)
<a name="l01629"></a>01629 {
<a name="l01630"></a>01630     <span class="keywordflow">return</span> <a class="code" href="a00005.html#a8c347680da2a13221448596d4d051c6c" title="reference-counted pointer implementation">m_impl</a>-&gt;<a class="code" href="a00006.html#ab88f4227bd432173937571cd31606413" title="Add an execp() stage to the pipe with given arguments.">add_execp</a>(args);
<a name="l01631"></a>01631 }
<a name="l01632"></a>01632 
<a name="l01633"></a><a class="code" href="a00005.html#add73caa3ad28e575227e212c23dde72b">01633</a> <span class="keywordtype">void</span> <a class="code" href="a00005.html#add73caa3ad28e575227e212c23dde72b" title="Add an exece() stage to the pipe with the given arguments and environments.">ExecPipe::add_exece</a>(<span class="keyword">const</span> <span class="keywordtype">char</span>* path,
<a name="l01634"></a>01634                          <span class="keyword">const</span> std::vector&lt;std::string&gt;* args,
<a name="l01635"></a>01635                          <span class="keyword">const</span> std::vector&lt;std::string&gt;* env)
<a name="l01636"></a>01636 {
<a name="l01637"></a>01637     <span class="keywordflow">return</span> <a class="code" href="a00005.html#a8c347680da2a13221448596d4d051c6c" title="reference-counted pointer implementation">m_impl</a>-&gt;<a class="code" href="a00006.html#a5c70345c74782153f4f3953385c4dc74" title="Add an exece() stage to the pipe with the given arguments and environments.">add_exece</a>(path, args, env);
<a name="l01638"></a>01638 }
<a name="l01639"></a>01639 
<a name="l01640"></a><a class="code" href="a00005.html#ad4ace2eacec24c0a07694d3503dcf03d">01640</a> <span class="keywordtype">void</span> <a class="code" href="a00005.html#ad4ace2eacec24c0a07694d3503dcf03d" title="Add a function stage to the pipe.">ExecPipe::add_function</a>(<a class="code" href="a00007.html" title="Abstract class used as an intermediate pipe stage between executed processes.">PipeFunction</a>* func)
<a name="l01641"></a>01641 {       
<a name="l01642"></a>01642     <span class="keywordflow">return</span> <a class="code" href="a00005.html#a8c347680da2a13221448596d4d051c6c" title="reference-counted pointer implementation">m_impl</a>-&gt;<a class="code" href="a00006.html#adff71b352fa9eb441015b225af45c22a" title="Add a function stage to the pipe.">add_function</a>(func);
<a name="l01643"></a>01643 }
<a name="l01644"></a>01644 
<a name="l01645"></a><a class="code" href="a00005.html#a305267e99ac1f905b673da3997960543">01645</a> <a class="code" href="a00005.html" title="Main library interface (reference counted pointer).">ExecPipe</a>&amp; <a class="code" href="a00005.html#a305267e99ac1f905b673da3997960543" title="Run the configured pipe sequence and wait for all children processes to complete...">ExecPipe::run</a>()
<a name="l01646"></a>01646 {
<a name="l01647"></a>01647     <a class="code" href="a00005.html#a8c347680da2a13221448596d4d051c6c" title="reference-counted pointer implementation">m_impl</a>-&gt;<a class="code" href="a00006.html#a5cdfc07991ed22e1fb1dee25a9509ec1" title="Run the configured pipe sequence and wait for all children processes to complete...">run</a>();
<a name="l01648"></a>01648     <span class="keywordflow">return</span> *<span class="keyword">this</span>;
<a name="l01649"></a>01649 }
<a name="l01650"></a>01650 
<a name="l01651"></a><a class="code" href="a00005.html#ad4c4c5f819976489131c45611578594f">01651</a> <span class="keywordtype">int</span> <a class="code" href="a00005.html#ad4c4c5f819976489131c45611578594f" title="Get the return status of exec() stage&amp;#39;s program run after pipe execution as indicated...">ExecPipe::get_return_status</a>(<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> stageid)<span class="keyword"> const</span>
<a name="l01652"></a>01652 <span class="keyword"></span>{
<a name="l01653"></a>01653     <span class="keywordflow">return</span> <a class="code" href="a00005.html#a8c347680da2a13221448596d4d051c6c" title="reference-counted pointer implementation">m_impl</a>-&gt;<a class="code" href="a00006.html#a13c456f97e74bcbb04ef488a79deaac7" title="Get the return status of exec() stage&amp;#39;s program run after pipe execution as indicated...">get_return_status</a>(stageid);
<a name="l01654"></a>01654 }
<a name="l01655"></a>01655 
<a name="l01656"></a><a class="code" href="a00005.html#a26720fa668df3398398f10c503a52f9d">01656</a> <span class="keywordtype">int</span> <a class="code" href="a00005.html#a26720fa668df3398398f10c503a52f9d" title="Get the return code of exec() stage&amp;#39;s program run after pipe execution, or -1...">ExecPipe::get_return_code</a>(<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> stageid)<span class="keyword"> const</span>
<a name="l01657"></a>01657 <span class="keyword"></span>{
<a name="l01658"></a>01658     <span class="keywordflow">return</span> <a class="code" href="a00005.html#a8c347680da2a13221448596d4d051c6c" title="reference-counted pointer implementation">m_impl</a>-&gt;<a class="code" href="a00006.html#a3ad393d45c80839b3b3fe0840fdaa3b5" title="Get the return code of exec() stage&amp;#39;s program run after pipe execution, or -1...">get_return_code</a>(stageid);
<a name="l01659"></a>01659 }
<a name="l01660"></a>01660 
<a name="l01661"></a><a class="code" href="a00005.html#a477d189d73e8344ca4fa4b333207bc15">01661</a> <span class="keywordtype">int</span> <a class="code" href="a00005.html#a477d189d73e8344ca4fa4b333207bc15" title="Get the signal of the abnormally terminated exec() stage&amp;#39;s program run after...">ExecPipe::get_return_signal</a>(<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> stageid)<span class="keyword"> const</span>
<a name="l01662"></a>01662 <span class="keyword"></span>{
<a name="l01663"></a>01663     <span class="keywordflow">return</span> <a class="code" href="a00005.html#a8c347680da2a13221448596d4d051c6c" title="reference-counted pointer implementation">m_impl</a>-&gt;<a class="code" href="a00006.html#af0a115971095800245f7a4fff69c1473" title="Get the signal of the abnormally terminated exec() stage&amp;#39;s program run after...">get_return_signal</a>(stageid);
<a name="l01664"></a>01664 }
<a name="l01665"></a>01665 
<a name="l01666"></a><a class="code" href="a00005.html#aac626dcd623778ce5a1475cc12ac596f">01666</a> <span class="keywordtype">bool</span> <a class="code" href="a00005.html#aac626dcd623778ce5a1475cc12ac596f" title="Return true if the return code of all exec() stages were zero.">ExecPipe::all_return_codes_zero</a>()<span class="keyword"> const</span>
<a name="l01667"></a>01667 <span class="keyword"></span>{
<a name="l01668"></a>01668     <span class="keywordflow">return</span> <a class="code" href="a00005.html#a8c347680da2a13221448596d4d051c6c" title="reference-counted pointer implementation">m_impl</a>-&gt;<a class="code" href="a00006.html#a3f55d7c6852f6b42388bc08ae31555b2" title="Return true if the return code of all exec() stages were zero.">all_return_codes_zero</a>();
<a name="l01669"></a>01669 }
<a name="l01670"></a>01670 
<a name="l01671"></a>01671 <span class="comment">// --- PipeSource ------------------------------------------------------- //</span>
<a name="l01672"></a>01672 
<a name="l01673"></a><a class="code" href="a00009.html#a3fbdd07cf4671804348b1dd69e8825cc">01673</a> <a class="code" href="a00009.html#a3fbdd07cf4671804348b1dd69e8825cc" title="Constructor which clears m_impl.">PipeSource::PipeSource</a>()
<a name="l01674"></a>01674     : m_impl(NULL)
<a name="l01675"></a>01675 {
<a name="l01676"></a>01676 }
<a name="l01677"></a>01677 
<a name="l01678"></a><a class="code" href="a00009.html#a356519e2fbbeacbf06b6e33c78dde7ad">01678</a> <span class="keywordtype">void</span> <a class="code" href="a00009.html#a356519e2fbbeacbf06b6e33c78dde7ad" title="Write input data to the first stage via a buffer.">PipeSource::write</a>(<span class="keyword">const</span> <span class="keywordtype">void</span>* data, <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> datalen)
<a name="l01679"></a>01679 {
<a name="l01680"></a>01680     assert(<a class="code" href="a00009.html#ad68c42870f68f3c5aaa740c04ec1908a" title="pointer to associated pipe. filled by ExecPipe::add_input_source()">m_impl</a>);
<a name="l01681"></a>01681     <span class="keywordflow">return</span> <a class="code" href="a00009.html#ad68c42870f68f3c5aaa740c04ec1908a" title="pointer to associated pipe. filled by ExecPipe::add_input_source()">m_impl</a>-&gt;<a class="code" href="a00006.html#ad42faa9a62f10524ee15b0c5e91744db" title="Function called by PipeSource::write() to push data into the ring buffer.">input_source_write</a>(data, datalen);
<a name="l01682"></a>01682 }
<a name="l01683"></a>01683 
<a name="l01684"></a>01684 <span class="comment">// --- PipeFunction ----------------------------------------------------- //</span>
<a name="l01685"></a>01685 
<a name="l01686"></a><a class="code" href="a00007.html#ab11f24b752504dde4446b36245e4be69">01686</a> <a class="code" href="a00007.html#ab11f24b752504dde4446b36245e4be69" title="Constructor which clears m_impl and m_stageid.">PipeFunction::PipeFunction</a>()
<a name="l01687"></a>01687     : m_impl(NULL), m_stageid(0)
<a name="l01688"></a>01688 {
<a name="l01689"></a>01689 }
<a name="l01690"></a>01690 
<a name="l01691"></a><a class="code" href="a00007.html#af188fdba0b40670aedb24ad5fddc64dc">01691</a> <span class="keywordtype">void</span> <a class="code" href="a00007.html#af188fdba0b40670aedb24ad5fddc64dc" title="Write input data to the next pipe stage via a buffer.">PipeFunction::write</a>(<span class="keyword">const</span> <span class="keywordtype">void</span>* data, <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> datalen)
<a name="l01692"></a>01692 {
<a name="l01693"></a>01693     assert(<a class="code" href="a00007.html#ae0f526902d5edbdd71d86e6f8bda9e1d" title="pointer to associated pipe filled by ExecPipe::add_function()">m_impl</a>);
<a name="l01694"></a>01694     <span class="keywordflow">return</span> <a class="code" href="a00007.html#ae0f526902d5edbdd71d86e6f8bda9e1d" title="pointer to associated pipe filled by ExecPipe::add_function()">m_impl</a>-&gt;<a class="code" href="a00006.html#adfe1f0659c982151887a41e70debf258" title="Function called by PipeSource::write() to push data into the ring buffer.">stage_function_write</a>(<a class="code" href="a00007.html#a1469003fd12371862030dae2317f2070" title="pipe stage identifier">m_stageid</a>, data, datalen);
<a name="l01695"></a>01695 }
<a name="l01696"></a>01696 
<a name="l01697"></a>01697 <span class="comment">// ---------------------------------------------------------------------- //</span>
<a name="l01698"></a>01698 
<a name="l01699"></a>01699 } <span class="comment">// namespace stx</span>
</pre></div></div>
<!--- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&nbsp;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&nbsp;</span>Classes</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&nbsp;</span>Namespaces</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&nbsp;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&nbsp;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&nbsp;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&nbsp;</span>Typedefs</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&nbsp;</span>Enumerations</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(8)"><span class="SelectionMark">&nbsp;</span>Enumerator</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(9)"><span class="SelectionMark">&nbsp;</span>Friends</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<hr class="footer"/><address style="text-align: right;"><small>Generated on Fri Jul 30 17:07:13 2010 for STX Execution Pipe by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.6.3 </small></address>
</body>
</html>
