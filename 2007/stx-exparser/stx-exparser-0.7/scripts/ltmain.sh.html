<?xml version="1.0" encoding="iso-8859-1"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta content="text/html; charset=iso-8859-1" http-equiv="content-type" /><meta name="viewport" content="initial-scale=1"><title>/2007/stx-exparser/stx-exparser-0.7/scripts/ltmain.sh - panthema.net</title><link rel="stylesheet" type="text/css" href="/css/base.css" /><link rel="stylesheet" type="text/css" href="/css/fonts.css" /><link rel="alternate" type="application/rss+xml" title="panthema.net Weblog Feed RSS 2.0" href="http://panthema.net/xmlfeed/weblog-rss20.xml" /><link rel="alternate" type="application/atom+xml" title="panthema.net Weblog Feed Atom 1.0" href="http://panthema.net/xmlfeed/weblog-atom10.xml" /><script type="text/javascript" src="/js/base.js"></script><script type="text/javascript">/* <!-- */makeIEHover = function() {var lis = document.getElementById('ptnav').getElementsByTagName('li');for (var i = 0; i < lis.length; i++) {lis[i].onmouseover = function() {this.className += ' sfhover';};lis[i].onmouseout = function() {this.className = this.className.replace(new RegExp(' sfhover\b'), '');};}};if (window.attachEvent) window.attachEvent('onload', makeIEHover);/* --> */</script></head><body style="background-image: url(/img/bgfractal4.jpg)"><div class="pttopbar"><div style="float: right"><ul id="ptnav"><li class="top"><a class="ni" href="/"><i class="icon-book"></i> Weblog</a><ul style="margin-left: -6px; margin-top: 4px" class="nx"><li><a href="/2017/">2017</a></li><li><a href="/2016/">2016</a></li><li><a href="/2015/">2015</a></li><li><a href="/2014/">2014</a></li><li><a href="/2013/">2013</a></li><li><a href="/2012/">2012</a></li><li><a href="/2011/">2011</a></li><li><a href="/2010/">2010</a></li><li><a href="/2009/">2009</a></li><li><a href="/2008/">2008</a></li><li><a href="/2007/">2007</a></li><li><a href="/2006/">2006</a></li><li class="nt"><a href="/2005/">2005</a></li><li class="ns"><a href="/xmlfeed/weblog-rss20.xml">RSS Feed</a></li><li class="nt"><a href="/xmlfeed/weblog-atom10.xml">XML Atom</a></li><li class="ns"><a href="/search.html">Search</a></li></ul></li><li class="top"><a class="ni" href="/tags/"><i class="icon-tags"></i> Tags</a><div style="width: 14em; margin-left: -9em; margin-top: 4px"><a style="font-size: 10pt" href="/tags/algebra.html">algebra</a> <a style="font-size: 16pt" href="/tags/c++.html">c++</a> <a style="font-size: 12pt" href="/tags/code-example.html">code-example</a> <a style="font-size: 14pt" href="/tags/code-snippet.html">code-snippet</a> <a style="font-size: 11pt" href="/tags/coding_tricks.html">coding tricks</a> <a style="font-size: 10pt" href="/tags/compsci.html">compsci</a> <a style="font-size: 10pt" href="/tags/compsci_study_thesis.html">compsci study thesis</a> <a style="font-size: 9pt" href="/tags/crypto-speedtest.html">crypto-speedtest</a> <a style="font-size: 10pt" href="/tags/cryptography.html">cryptography</a> <a style="font-size: 9pt" href="/tags/cryptote.html">cryptote</a> <a style="font-size: 12pt" href="/tags/flex-bison-cpp-example.html">flex-bison-cpp-example</a> <a style="font-size: 16pt" href="/tags/frontpage.html">frontpage</a> <a style="font-size: 14pt" href="/tags/fun.html">fun</a> <a style="font-size: 10pt" href="/tags/graphviz.html">graphviz</a> <a style="font-size: 9pt" href="http://www.hmtg.de">hartmetall</a> <a style="font-size: 9pt" href="/tags/helppc.html">helppc</a> <a style="font-size: 9pt" href="/tags/hifi_selbstbau.html">hifi selbstbau</a> <a style="font-size: 10pt" href="/tags/latex.html">latex</a> <a style="font-size: 10pt" href="/tags/librivox.html">librivox</a> <a style="font-size: 10pt" href="/tags/linux.html">linux</a> <a style="font-size: 9pt" href="/tags/massive-sorting.html">massive-sorting</a> <a style="font-size: 11pt" href="/tags/maths.html">maths</a> <a style="font-size: 9pt" href="/tags/music.html">music</a> <a style="font-size: 10pt" href="/tags/netfundamentals.html">netfundamentals</a> <a style="font-size: 11pt" href="/tags/ns-3.html">ns-3</a> <a style="font-size: 10pt" href="/tags/parallel-string-sorting.html">parallel-string-sorting</a> <a style="font-size: 9pt" href="/tags/qtsqlview.html">qtsqlview</a> <a style="font-size: 14pt" href="/tags/research.html">research</a> <a style="font-size: 11pt" href="/tags/sdios06.html">sdios06</a> <a style="font-size: 9pt" href="/tags/sdlfractal.html">sdlfractal</a> <a style="font-size: 14pt" href="/tags/sorting.html">sorting</a> <a style="font-size: 11pt" href="/tags/sound_of_sorting.html">sound of sorting</a> <a style="font-size: 10pt" href="/tags/stringology.html">stringology</a> <a style="font-size: 16pt" href="/tags/stx-btree.html">stx-btree</a> <a style="font-size: 9pt" href="/tags/stx-exparser.html">stx-exparser</a> <a style="font-size: 15pt" href="/tags/stxxl.html">stxxl</a> <a style="font-size: 16pt" href="/tags/talk.html">talk</a> <a style="font-size: 13pt" href="/tags/thrill.html">thrill</a> <a style="font-size: 10pt" href="/tags/tutorium.html">tutorium</a> <a style="font-size: 16pt" href="/tags/university.html">university</a> <a style="font-size: 13pt" href="/tags/utilities.html">utilities</a> <a style="font-size: 10pt" href="/tags/vncrec.html">vncrec</a> <a style="font-size: 9pt" href="/tags/webdesign.html">webdesign</a> </div></li><li class="top"> <a class="ni" href="#"><i class="icon-cubes"></i> Projects</a> <ul style="margin-left: -8em; margin-top: 4px;" class="nx"> <li><a href="/2009/cryptote/">CryptoTE</a></li> <li><a href="/2009/digup/">digup</a></li> <li><a href="/2013/disk-filltest/">disk-filltest</a></li> <li><a href="/2012/1119-eSAIS-Inducing-Suffix-and-LCP-Arrays-in-External-Memory/">eSAIS-LCP</a></li> <li><a href="/2007/flex-bison-cpp-example/">Flex Bison C++ Example</a></li> <li><a href="/2013/malloc_count/">malloc_count</a></li> <li><a href="/2013/parallel-string-sorting/">parallel-string-sorting</a></li> <li><a href="/2013/pmbw/">Parallel Memory Bandwidth</a></li> <li><a href="/2014/sqlplot-tools/">SqlPlotTools</a></li> <li><a href="/2013/sound-of-sorting/">The Sound of Sorting</a></li> <li><a href="/2007/stx-btree/">STX B+ Tree</a></li> <li><a href="/2010/stx-cbtreedb/">STX Constant BTreeDB</a></li> <li><a href="/2010/stx-execpipe/">STX ExecPipe</a></li> <li><a href="/2007/stx-exparser/">STX Expression Parser</a></li> <li><a href="/tags/stxxl.html">STXXL 1.4</a></li> <li class="nt"><a href="/2014/vncrec-rgb/">VNCrec RGB 0.4</a></li> <li class="ns"><a href="/search.html">Search</a></li> </ul></li><li class="top"> <a class="ni" href="#"><i class="icon-graduation-cap"></i> Research</a> <ul style="margin-left: -16em; margin-top: 4px" class="nx"> <li><a href="/2012/1119-eSAIS-Inducing-Suffix-and-LCP-Arrays-in-External-Memory/">eSAIS-LCP - External Memory Suffix Sorting</a></li> <li><a href="/2016/0114-diploma-thesis/">On Bispanning Graphs</a></li> <li><a href="/2013/parallel-string-sorting/">Parallel String Sorting</a></li> <li><a href="/tags/massive-sorting.html">Practical Massively Parallel Sorting</a></li> <li><a href="/tags/stxxl.html">STXXL - External Memory Algorithms</a></li> <li><a href="/tags/thrill.html">Thrill - Distributed Batch Big Data Processing</a></li> <li class="ns"><a href="/search.html">Search</a></li> </ul></li><li class="top"> <a class="ni" href="/about/"><i class="icon-info-circled"></i> About</a> <ul style="margin-left: -6em; margin-top: 4px" class="nx"> <li><a href="/about/">Timo Bingmann</a></li> <li><a href="/about/impressum.html">Impressum</a></li> </ul></li><li class="top"> <a class="ni" href="/subscribe.html"><i class="icon-rss-squared"></i> Subscribe</a></li></ul></div><div style="padding: 6px"><a href="/">panthema</a>  / <a href="/2007/">2007</a> / <a href="/2007/stx-exparser/">stx-exparser</a> / <a href="/2007/stx-exparser/stx-exparser-0.7/">stx-exparser-0.7</a> / <a href="/2007/stx-exparser/stx-exparser-0.7/scripts/">scripts</a> / <a href="/2007/stx-exparser/stx-exparser-0.7/scripts/ltmain.sh.html">ltmain.sh</a> (<a href="/2007/stx-exparser/stx-exparser-0.7/scripts/ltmain.sh">Download File</a>)</div></div><div class="ptfullwidth"><pre class="codesnippet" style="font-family: monospace"><tt><span class="comment"># ltmain.sh - Provide generalized library-building support services.</span>
<span class="comment"># NOTE: Changing this file will not affect anything until you rerun configure.</span>
<span class="comment">#</span>
<span class="comment"># Copyright (C) 1996, 1997, 1998, 1999, 2000, 2001, 2003, 2004, 2005, 2006,</span>
<span class="comment"># 2007  Free Software Foundation, Inc.</span>
<span class="comment"># Originally by Gordon Matzigkeit &lt;gord@gnu.ai.mit.edu&gt;, 1996</span>
<span class="comment">#</span>
<span class="comment"># This program is free software; you can redistribute it and/or modify</span>
<span class="comment"># it under the terms of the GNU General Public License as published by</span>
<span class="comment"># the Free Software Foundation; either version 2 of the License, or</span>
<span class="comment"># (at your option) any later version.</span>
<span class="comment">#</span>
<span class="comment"># This program is distributed in the hope that it will be useful, but</span>
<span class="comment"># WITHOUT ANY WARRANTY; without even the implied warranty of</span>
<span class="comment"># MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU</span>
<span class="comment"># General Public License for more details.</span>
<span class="comment">#</span>
<span class="comment"># You should have received a copy of the GNU General Public License</span>
<span class="comment"># along with this program; if not, write to the Free Software</span>
<span class="comment"># Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA 02110-1301, USA.</span>
<span class="comment">#</span>
<span class="comment"># As a special exception to the GNU General Public License, if you</span>
<span class="comment"># distribute this file as part of a program that contains a</span>
<span class="comment"># configuration script generated by Autoconf, you may include it under</span>
<span class="comment"># the same distribution terms that you use for the rest of that program.</span>

<span class="variable">basename</span><span class="symbol">=</span><span class="string">"s,^.*/,,g"</span>

<span class="comment"># Work around backward compatibility issue on IRIX 6.5. On IRIX 6.4+, sh</span>
<span class="comment"># is ksh but when the shell is invoked as "sh" and the current value of</span>
<span class="comment"># the _XPG environment variable is not equal to 1 (one), the special</span>
<span class="comment"># positional parameter $0, within a function call, is the name of the</span>
<span class="comment"># function.</span>
<span class="variable">progpath</span><span class="symbol">=</span><span class="string">"$0"</span>

<span class="comment"># The name of this program:</span>
<span class="variable">progname</span><span class="symbol">=</span><span class="normal">`echo </span><span class="string">"$progpath"</span><span class="normal"> </span><span class="symbol">|</span><span class="normal"> </span><span class="variable">$SED</span><span class="normal"> </span><span class="variable">$basename</span><span class="normal">`</span>
<span class="variable">modename</span><span class="symbol">=</span><span class="string">"$progname"</span>

<span class="comment"># Global variables:</span>
<span class="variable">EXIT_SUCCESS</span><span class="symbol">=</span><span class="number">0</span>
<span class="variable">EXIT_FAILURE</span><span class="symbol">=</span><span class="number">1</span>

<span class="variable">PROGRAM</span><span class="symbol">=</span><span class="normal">ltmain</span><span class="symbol">.</span><span class="normal">sh</span>
<span class="variable">PACKAGE</span><span class="symbol">=</span><span class="normal">libtool</span>
<span class="variable">VERSION</span><span class="symbol">=</span><span class="number">1.5</span><span class="symbol">.</span><span class="normal">23b</span>
<span class="variable">TIMESTAMP</span><span class="symbol">=</span><span class="string">" (1.1220.2.437 2007/02/17 09:08:45)"</span>

<span class="comment"># Be Bourne compatible (taken from Autoconf:_AS_BOURNE_COMPATIBLE).</span>
<span class="keyword">if</span><span class="normal"> </span><span class="keyword">test</span><span class="normal"> -n </span><span class="string">"${ZSH_VERSION+set}"</span><span class="normal"> </span><span class="symbol">&amp;&amp;</span><span class="normal"> </span><span class="symbol">(</span><span class="normal">emulate sh</span><span class="symbol">)</span><span class="normal"> </span><span class="symbol">&gt;</span><span class="normal">/dev/null </span><span class="number">2</span><span class="symbol">&gt;&amp;</span><span class="number">1</span><span class="symbol">;</span><span class="normal"> </span><span class="keyword">then</span>
<span class="normal">  emulate sh</span>
<span class="normal">  </span><span class="variable">NULLCMD</span><span class="symbol">=:</span>
<span class="normal">  </span><span class="comment"># Zsh 3.x and 4.x performs word splitting on ${1+"$@"}, which</span>
<span class="normal">  </span><span class="comment"># is contrary to our usage.  Disable this feature.</span>
<span class="normal">  </span><span class="keyword">alias</span><span class="normal"> -g </span><span class="string">'${1+"$@"}'</span><span class="symbol">=</span><span class="string">'"$@"'</span>
<span class="normal">  setopt NO_GLOB_SUBST</span>
<span class="keyword">else</span>
<span class="normal">  </span><span class="keyword">case</span><span class="normal"> `</span><span class="symbol">(</span><span class="keyword">set</span><span class="normal"> -o</span><span class="symbol">)</span><span class="normal"> </span><span class="number">2</span><span class="symbol">&gt;</span><span class="normal">/dev/null` </span><span class="keyword">in</span><span class="normal"> </span><span class="symbol">*</span><span class="normal">posix</span><span class="symbol">*)</span><span class="normal"> </span><span class="keyword">set</span><span class="normal"> -o posix</span><span class="symbol">;;</span><span class="normal"> </span><span class="keyword">esac</span>
<span class="keyword">fi</span>
<span class="variable">BIN_SH</span><span class="symbol">=</span><span class="normal">xpg4</span><span class="symbol">;</span><span class="normal"> </span><span class="keyword">export</span><span class="normal"> BIN_SH </span><span class="comment"># for Tru64</span>
<span class="variable">DUALCASE</span><span class="symbol">=</span><span class="number">1</span><span class="symbol">;</span><span class="normal"> </span><span class="keyword">export</span><span class="normal"> DUALCASE </span><span class="comment"># for MKS sh</span>

<span class="comment"># Check that we have a working $echo.</span>
<span class="keyword">if</span><span class="normal"> </span><span class="keyword">test</span><span class="normal"> </span><span class="string">"X$1"</span><span class="normal"> </span><span class="symbol">=</span><span class="normal"> X--no-reexec</span><span class="symbol">;</span><span class="normal"> </span><span class="keyword">then</span>
<span class="normal">  </span><span class="comment"># Discard the --no-reexec flag, and continue.</span>
<span class="normal">  </span><span class="keyword">shift</span>
<span class="keyword">elif</span><span class="normal"> </span><span class="keyword">test</span><span class="normal"> </span><span class="string">"X$1"</span><span class="normal"> </span><span class="symbol">=</span><span class="normal"> X--fallback-echo</span><span class="symbol">;</span><span class="normal"> </span><span class="keyword">then</span>
<span class="normal">  </span><span class="comment"># Avoid inline document here, it may be left over</span>
<span class="normal">  </span><span class="symbol">:</span>
<span class="keyword">elif</span><span class="normal"> </span><span class="keyword">test</span><span class="normal"> </span><span class="string">"X`($echo '</span><span class="specialchar">\t</span><span class="string">') 2&gt;/dev/null`"</span><span class="normal"> </span><span class="symbol">=</span><span class="normal"> </span><span class="string">'X</span><span class="specialchar">\t</span><span class="string">'</span><span class="symbol">;</span><span class="normal"> </span><span class="keyword">then</span>
<span class="normal">  </span><span class="comment"># Yippee, $echo works!</span>
<span class="normal">  </span><span class="symbol">:</span>
<span class="keyword">else</span>
<span class="normal">  </span><span class="comment"># Restart under the correct shell, and then maybe $echo will work.</span>
<span class="normal">  </span><span class="keyword">exec</span><span class="normal"> </span><span class="variable">$SHELL</span><span class="normal"> </span><span class="string">"$progpath"</span><span class="normal"> --no-reexec </span><span class="variable">${1+"$@"}</span>
<span class="keyword">fi</span>

<span class="keyword">if</span><span class="normal"> </span><span class="keyword">test</span><span class="normal"> </span><span class="string">"X$1"</span><span class="normal"> </span><span class="symbol">=</span><span class="normal"> X--fallback-echo</span><span class="symbol">;</span><span class="normal"> </span><span class="keyword">then</span>
<span class="normal">  </span><span class="comment"># used as fallback echo</span>
<span class="normal">  </span><span class="keyword">shift</span>
<span class="normal">  cat </span><span class="symbol">&lt;&lt;</span><span class="normal">EOF</span>
<span class="variable">$*</span>
<span class="normal">EOF</span>
<span class="normal">  </span><span class="keyword">exit</span><span class="normal"> </span><span class="variable">$EXIT_SUCCESS</span>
<span class="keyword">fi</span>

<span class="variable">default_mode</span><span class="symbol">=</span>
<span class="keyword">help</span><span class="symbol">=</span><span class="string">"Try </span><span class="specialchar">\`</span><span class="string">$progname --help' for more information."</span>
<span class="variable">magic</span><span class="symbol">=</span><span class="string">"%%%MAGIC variable%%%"</span>
<span class="variable">mkdir</span><span class="symbol">=</span><span class="string">"mkdir"</span>
<span class="variable">mv</span><span class="symbol">=</span><span class="string">"mv -f"</span>
<span class="variable">rm</span><span class="symbol">=</span><span class="string">"rm -f"</span>

<span class="comment"># Sed substitution that helps us do robust quoting.  It backslashifies</span>
<span class="comment"># metacharacters that are still active within double-quoted strings.</span>
<span class="variable">Xsed</span><span class="symbol">=</span><span class="string">"${SED}"' -e 1s/^X//'</span>
<span class="variable">sed_quote_subst</span><span class="symbol">=</span><span class="string">'s/</span><span class="specialchar">\(</span><span class="string">[</span><span class="specialchar">\\</span><span class="string">`</span><span class="specialchar">\\</span><span class="string">"$</span><span class="specialchar">\\\\</span><span class="string">]</span><span class="specialchar">\)</span><span class="string">/</span><span class="specialchar">\\\1</span><span class="string">/g'</span>
<span class="comment"># test EBCDIC or ASCII</span>
<span class="keyword">case</span><span class="normal"> `echo X</span><span class="symbol">|</span><span class="normal">tr X </span><span class="string">'</span><span class="specialchar">\1</span><span class="string">01'</span><span class="normal">` </span><span class="keyword">in</span>
<span class="normal"> A</span><span class="symbol">)</span><span class="normal"> </span><span class="comment"># ASCII based system</span>
<span class="normal">    </span><span class="comment"># \n is not interpreted correctly by Solaris 8 /usr/ucb/tr</span>
<span class="normal">  </span><span class="variable">SP2NL</span><span class="symbol">=</span><span class="string">'tr </span><span class="specialchar">\0</span><span class="string">40 </span><span class="specialchar">\0</span><span class="string">12'</span>
<span class="normal">  </span><span class="variable">NL2SP</span><span class="symbol">=</span><span class="string">'tr </span><span class="specialchar">\0</span><span class="string">15</span><span class="specialchar">\0</span><span class="string">12 </span><span class="specialchar">\0</span><span class="string">40</span><span class="specialchar">\0</span><span class="string">40'</span>
<span class="normal">  </span><span class="symbol">;;</span>
<span class="normal"> </span><span class="symbol">*)</span><span class="normal"> </span><span class="comment"># EBCDIC based system</span>
<span class="normal">  </span><span class="variable">SP2NL</span><span class="symbol">=</span><span class="string">'tr </span><span class="specialchar">\1</span><span class="string">00 </span><span class="specialchar">\n</span><span class="string">'</span>
<span class="normal">  </span><span class="variable">NL2SP</span><span class="symbol">=</span><span class="string">'tr </span><span class="specialchar">\r\n</span><span class="string"> </span><span class="specialchar">\1</span><span class="string">00</span><span class="specialchar">\1</span><span class="string">00'</span>
<span class="normal">  </span><span class="symbol">;;</span>
<span class="keyword">esac</span>

<span class="comment"># NLS nuisances.</span>
<span class="comment"># Only set LANG and LC_ALL to C if already set.</span>
<span class="comment"># These must not be set unconditionally because not all systems understand</span>
<span class="comment"># e.g. LANG=C (notably SCO).</span>
<span class="comment"># We save the old values to restore during execute mode.</span>
<span class="keyword">for</span><span class="normal"> lt_var </span><span class="keyword">in</span><span class="normal"> LANG LC_ALL LC_CTYPE LC_COLLATE LC_MESSAGES</span>
<span class="keyword">do</span>
<span class="normal">  </span><span class="keyword">eval</span><span class="normal"> </span><span class="string">"if test </span><span class="specialchar">\"\$</span><span class="string">{$lt_var+set}</span><span class="specialchar">\"</span><span class="string"> = set; then</span>
<span class="string">	  save_$lt_var=</span><span class="specialchar">\$</span><span class="string">$lt_var</span>
<span class="string">	  $lt_var=C</span>
<span class="string">	  export $lt_var</span>
<span class="string">	fi"</span>
<span class="keyword">done</span>

<span class="comment"># Make sure IFS has a sensible default</span>
<span class="variable">lt_nl</span><span class="symbol">=</span><span class="string">'</span>
<span class="string">'</span>
<span class="variable">IFS</span><span class="symbol">=</span><span class="string">" 	$lt_nl"</span>

<span class="keyword">if</span><span class="normal"> </span><span class="keyword">test</span><span class="normal"> </span><span class="string">"$build_libtool_libs"</span><span class="normal"> </span><span class="symbol">!=</span><span class="normal"> yes </span><span class="symbol">&amp;&amp;</span><span class="normal"> </span><span class="keyword">test</span><span class="normal"> </span><span class="string">"$build_old_libs"</span><span class="normal"> </span><span class="symbol">!=</span><span class="normal"> yes</span><span class="symbol">;</span><span class="normal"> </span><span class="keyword">then</span>
<span class="normal">  </span><span class="variable">$echo</span><span class="normal"> </span><span class="string">"$modename: not configured to build any kind of library"</span><span class="normal"> </span><span class="number">1</span><span class="symbol">&gt;&amp;</span><span class="number">2</span>
<span class="normal">  </span><span class="variable">$echo</span><span class="normal"> </span><span class="string">"Fatal configuration error.  See the $PACKAGE docs for more information."</span><span class="normal"> </span><span class="number">1</span><span class="symbol">&gt;&amp;</span><span class="number">2</span>
<span class="normal">  </span><span class="keyword">exit</span><span class="normal"> </span><span class="variable">$EXIT_FAILURE</span>
<span class="keyword">fi</span>

<span class="comment"># Global variables.</span>
<span class="variable">mode</span><span class="symbol">=</span><span class="variable">$default_mode</span>
<span class="variable">nonopt</span><span class="symbol">=</span>
<span class="variable">prev</span><span class="symbol">=</span>
<span class="variable">prevopt</span><span class="symbol">=</span>
<span class="variable">run</span><span class="symbol">=</span>
<span class="variable">show</span><span class="symbol">=</span><span class="string">"$echo"</span>
<span class="variable">show_help</span><span class="symbol">=</span>
<span class="variable">execute_dlfiles</span><span class="symbol">=</span>
<span class="variable">duplicate_deps</span><span class="symbol">=</span><span class="normal">no</span>
<span class="variable">preserve_args</span><span class="symbol">=</span>
<span class="variable">lo2o</span><span class="symbol">=</span><span class="string">"s/</span><span class="specialchar">\\</span><span class="string">.lo</span><span class="specialchar">\$</span><span class="string">/.${objext}/"</span>
<span class="variable">o2lo</span><span class="symbol">=</span><span class="string">"s/</span><span class="specialchar">\\</span><span class="string">.${objext}</span><span class="specialchar">\$</span><span class="string">/.lo/"</span>
<span class="variable">extracted_archives</span><span class="symbol">=</span>
<span class="variable">extracted_serial</span><span class="symbol">=</span><span class="number">0</span>

<span class="comment">#####################################</span>
<span class="comment"># Shell function definitions:</span>
<span class="comment"># This seems to be the best place for them</span>

<span class="comment"># func_mktempdir [string]</span>
<span class="comment"># Make a temporary directory that won't clash with other running</span>
<span class="comment"># libtool processes, and avoids race conditions if possible.  If</span>
<span class="comment"># given, STRING is the basename for that directory.</span>
<span class="function">func_mktempdir ()</span>
<span class="normal">{</span>
<span class="normal">    </span><span class="variable">my_template</span><span class="symbol">=</span><span class="string">"${TMPDIR-/tmp}/${1-$progname}"</span>

<span class="normal">    </span><span class="keyword">if</span><span class="normal"> </span><span class="keyword">test</span><span class="normal"> </span><span class="string">"$run"</span><span class="normal"> </span><span class="symbol">=</span><span class="normal"> </span><span class="string">":"</span><span class="symbol">;</span><span class="normal"> </span><span class="keyword">then</span>
<span class="normal">      </span><span class="comment"># Return a directory name, but don't create it in dry-run mode</span>
<span class="normal">      </span><span class="variable">my_tmpdir</span><span class="symbol">=</span><span class="string">"${my_template}-$$"</span>
<span class="normal">    </span><span class="keyword">else</span>

<span class="normal">      </span><span class="comment"># If mktemp works, use that first and foremost</span>
<span class="normal">      </span><span class="variable">my_tmpdir</span><span class="symbol">=</span><span class="normal">`mktemp -d </span><span class="string">"${my_template}-XXXXXXXX"</span><span class="normal"> </span><span class="number">2</span><span class="symbol">&gt;</span><span class="normal">/dev/null`</span>

<span class="normal">      </span><span class="keyword">if</span><span class="normal"> </span><span class="keyword">test</span><span class="normal"> </span><span class="symbol">!</span><span class="normal"> -d </span><span class="string">"$my_tmpdir"</span><span class="symbol">;</span><span class="normal"> </span><span class="keyword">then</span>
<span class="normal">	</span><span class="comment"># Failing that, at least try and use $RANDOM to avoid a race</span>
<span class="normal">	</span><span class="variable">my_tmpdir</span><span class="symbol">=</span><span class="string">"${my_template}-${RANDOM-0}$$"</span>

<span class="normal">	</span><span class="variable">save_mktempdir_umask</span><span class="symbol">=</span><span class="normal">`</span><span class="keyword">umask</span><span class="normal">`</span>
<span class="normal">	</span><span class="keyword">umask</span><span class="normal"> </span><span class="number">0077</span>
<span class="normal">	</span><span class="variable">$mkdir</span><span class="normal"> </span><span class="string">"$my_tmpdir"</span>
<span class="normal">	</span><span class="keyword">umask</span><span class="normal"> </span><span class="variable">$save_mktempdir_umask</span>
<span class="normal">      </span><span class="keyword">fi</span>

<span class="normal">      </span><span class="comment"># If we're not in dry-run mode, bomb out on failure</span>
<span class="normal">      </span><span class="keyword">test</span><span class="normal"> -d </span><span class="string">"$my_tmpdir"</span><span class="normal"> </span><span class="symbol">||</span><span class="normal"> {</span>
<span class="normal">        </span><span class="variable">$echo</span><span class="normal"> </span><span class="string">"cannot create temporary directory </span><span class="specialchar">\`</span><span class="string">$my_tmpdir'"</span><span class="normal"> </span><span class="number">1</span><span class="symbol">&gt;&amp;</span><span class="number">2</span>
<span class="normal">	</span><span class="keyword">exit</span><span class="normal"> </span><span class="variable">$EXIT_FAILURE</span>
<span class="normal">      }</span>
<span class="normal">    </span><span class="keyword">fi</span>

<span class="normal">    </span><span class="variable">$echo</span><span class="normal"> </span><span class="string">"X$my_tmpdir"</span><span class="normal"> </span><span class="symbol">|</span><span class="normal"> </span><span class="variable">$Xsed</span>
<span class="normal">}</span>


<span class="comment"># func_win32_libid arg</span>
<span class="comment"># return the library type of file 'arg'</span>
<span class="comment">#</span>
<span class="comment"># Need a lot of goo to handle *both* DLLs and import libs</span>
<span class="comment"># Has to be a shell function in order to 'eat' the argument</span>
<span class="comment"># that is supplied when $file_magic_command is called.</span>
<span class="function">func_win32_libid ()</span>
<span class="normal">{</span>
<span class="normal">  </span><span class="variable">win32_libid_type</span><span class="symbol">=</span><span class="string">"unknown"</span>
<span class="normal">  </span><span class="variable">win32_fileres</span><span class="symbol">=</span><span class="normal">`file -L </span><span class="variable">$1</span><span class="normal"> </span><span class="number">2</span><span class="symbol">&gt;</span><span class="normal">/dev/null`</span>
<span class="normal">  </span><span class="keyword">case</span><span class="normal"> </span><span class="variable">$win32_fileres</span><span class="normal"> </span><span class="keyword">in</span>
<span class="normal">  </span><span class="symbol">*</span><span class="normal">ar</span><span class="symbol">\</span><span class="normal"> archive</span><span class="symbol">\</span><span class="normal"> </span><span class="preproc">import</span><span class="symbol">\</span><span class="normal"> library</span><span class="symbol">*)</span><span class="normal"> </span><span class="comment"># definitely import</span>
<span class="normal">    </span><span class="variable">win32_libid_type</span><span class="symbol">=</span><span class="string">"x86 archive import"</span>
<span class="normal">    </span><span class="symbol">;;</span>
<span class="normal">  </span><span class="symbol">*</span><span class="normal">ar</span><span class="symbol">\</span><span class="normal"> archive</span><span class="symbol">*)</span><span class="normal"> </span><span class="comment"># could be an import, or static</span>
<span class="normal">    </span><span class="keyword">if</span><span class="normal"> </span><span class="keyword">eval</span><span class="normal"> </span><span class="variable">$OBJDUMP</span><span class="normal"> -f </span><span class="variable">$1</span><span class="normal"> </span><span class="symbol">|</span><span class="normal"> </span><span class="variable">$SED</span><span class="normal"> -e </span><span class="string">'10q'</span><span class="normal"> </span><span class="number">2</span><span class="symbol">&gt;</span><span class="normal">/dev/null </span><span class="symbol">|</span><span class="normal"> </span><span class="symbol">\</span>
<span class="normal">      </span><span class="variable">$EGREP</span><span class="normal"> -e </span><span class="string">'file format pe-i386(.*architecture: i386)?'</span><span class="normal"> </span><span class="symbol">&gt;</span><span class="normal">/dev/null </span><span class="symbol">;</span><span class="normal"> </span><span class="keyword">then</span>
<span class="normal">      </span><span class="variable">win32_nmres</span><span class="symbol">=</span><span class="normal">`</span><span class="keyword">eval</span><span class="normal"> </span><span class="variable">$NM</span><span class="normal"> -f posix -A </span><span class="variable">$1</span><span class="normal"> </span><span class="symbol">|</span><span class="normal"> </span><span class="symbol">\</span>
<span class="normal">	</span><span class="variable">$SED</span><span class="normal"> -n -e </span><span class="string">'1,100{</span>
<span class="string">		/ I /{</span>
<span class="string">			s,.*,import,</span>
<span class="string">			p</span>
<span class="string">			q</span>
<span class="string">			}</span>
<span class="string">		}'</span><span class="normal">`</span>
<span class="normal">      </span><span class="keyword">case</span><span class="normal"> </span><span class="variable">$win32_nmres</span><span class="normal"> </span><span class="keyword">in</span>
<span class="normal">      </span><span class="preproc">import</span><span class="symbol">*)</span><span class="normal">  </span><span class="variable">win32_libid_type</span><span class="symbol">=</span><span class="string">"x86 archive import"</span><span class="symbol">;;</span>
<span class="normal">      </span><span class="symbol">*)</span><span class="normal">        </span><span class="variable">win32_libid_type</span><span class="symbol">=</span><span class="string">"x86 archive static"</span><span class="symbol">;;</span>
<span class="normal">      </span><span class="keyword">esac</span>
<span class="normal">    </span><span class="keyword">fi</span>
<span class="normal">    </span><span class="symbol">;;</span>
<span class="normal">  </span><span class="symbol">*</span><span class="normal">DLL</span><span class="symbol">*)</span>
<span class="normal">    </span><span class="variable">win32_libid_type</span><span class="symbol">=</span><span class="string">"x86 DLL"</span>
<span class="normal">    </span><span class="symbol">;;</span>
<span class="normal">  </span><span class="symbol">*</span><span class="normal">executable</span><span class="symbol">*)</span><span class="normal"> </span><span class="comment"># but shell scripts are "executable" too...</span>
<span class="normal">    </span><span class="keyword">case</span><span class="normal"> </span><span class="variable">$win32_fileres</span><span class="normal"> </span><span class="keyword">in</span>
<span class="normal">    </span><span class="symbol">*</span><span class="normal">MS</span><span class="symbol">\</span><span class="normal"> Windows</span><span class="symbol">\</span><span class="normal"> PE</span><span class="symbol">\</span><span class="normal"> Intel</span><span class="symbol">*)</span>
<span class="normal">      </span><span class="variable">win32_libid_type</span><span class="symbol">=</span><span class="string">"x86 DLL"</span>
<span class="normal">      </span><span class="symbol">;;</span>
<span class="normal">    </span><span class="keyword">esac</span>
<span class="normal">    </span><span class="symbol">;;</span>
<span class="normal">  </span><span class="keyword">esac</span>
<span class="normal">  </span><span class="variable">$echo</span><span class="normal"> </span><span class="variable">$win32_libid_type</span>
<span class="normal">}</span>


<span class="comment"># func_infer_tag arg</span>
<span class="comment"># Infer tagged configuration to use if any are available and</span>
<span class="comment"># if one wasn't chosen via the "--tag" command line option.</span>
<span class="comment"># Only attempt this if the compiler in the base compile</span>
<span class="comment"># command doesn't match the default compiler.</span>
<span class="comment"># arg is usually of the form 'gcc ...'</span>
<span class="function">func_infer_tag ()</span>
<span class="normal">{</span>
<span class="normal">    </span><span class="keyword">if</span><span class="normal"> </span><span class="keyword">test</span><span class="normal"> -n </span><span class="string">"$available_tags"</span><span class="normal"> </span><span class="symbol">&amp;&amp;</span><span class="normal"> </span><span class="keyword">test</span><span class="normal"> -z </span><span class="string">"$tagname"</span><span class="symbol">;</span><span class="normal"> </span><span class="keyword">then</span>
<span class="normal">      </span><span class="variable">CC_quoted</span><span class="symbol">=</span>
<span class="normal">      </span><span class="keyword">for</span><span class="normal"> arg </span><span class="keyword">in</span><span class="normal"> </span><span class="variable">$CC</span><span class="symbol">;</span><span class="normal"> </span><span class="keyword">do</span>
<span class="normal">	</span><span class="keyword">case</span><span class="normal"> </span><span class="variable">$arg</span><span class="normal"> </span><span class="keyword">in</span>
<span class="normal">	  </span><span class="symbol">*[\[\~\</span><span class="comment">#\^\&amp;\*\(\)\{\}\|\;\&lt;\&gt;\?\'\ \	]*|*]*|"")</span>
<span class="normal">	  </span><span class="variable">arg</span><span class="symbol">=</span><span class="string">"</span><span class="specialchar">\"</span><span class="string">$arg</span><span class="specialchar">\"</span><span class="string">"</span>
<span class="normal">	  </span><span class="symbol">;;</span>
<span class="normal">	</span><span class="keyword">esac</span>
<span class="normal">	</span><span class="variable">CC_quoted</span><span class="symbol">=</span><span class="string">"$CC_quoted $arg"</span>
<span class="normal">      </span><span class="keyword">done</span>
<span class="normal">      </span><span class="keyword">case</span><span class="normal"> </span><span class="variable">$@</span><span class="normal"> </span><span class="keyword">in</span>
<span class="normal">      </span><span class="comment"># Blanks in the command may have been stripped by the calling shell,</span>
<span class="normal">      </span><span class="comment"># but not from the CC environment variable when configure was run.</span>
<span class="normal">      </span><span class="string">" $CC "</span><span class="symbol">*</span><span class="normal"> </span><span class="symbol">|</span><span class="normal"> </span><span class="string">"$CC "</span><span class="symbol">*</span><span class="normal"> </span><span class="symbol">|</span><span class="normal"> </span><span class="string">" `$echo $CC` "</span><span class="symbol">*</span><span class="normal"> </span><span class="symbol">|</span><span class="normal"> </span><span class="string">"`$echo $CC` "</span><span class="symbol">*</span><span class="normal"> </span><span class="symbol">|</span><span class="normal"> </span><span class="string">" $CC_quoted"</span><span class="symbol">*</span><span class="normal"> </span><span class="symbol">|</span><span class="normal"> </span><span class="string">"$CC_quoted "</span><span class="symbol">*</span><span class="normal"> </span><span class="symbol">|</span><span class="normal"> </span><span class="string">" `$echo $CC_quoted` "</span><span class="symbol">*</span><span class="normal"> </span><span class="symbol">|</span><span class="normal"> </span><span class="string">"`$echo $CC_quoted` "</span><span class="symbol">*)</span><span class="normal"> </span><span class="symbol">;;</span>
<span class="normal">      </span><span class="comment"># Blanks at the start of $base_compile will cause this to fail</span>
<span class="normal">      </span><span class="comment"># if we don't check for them as well.</span>
<span class="normal">      </span><span class="symbol">*)</span>
<span class="normal">	</span><span class="keyword">for</span><span class="normal"> z </span><span class="keyword">in</span><span class="normal"> </span><span class="variable">$available_tags</span><span class="symbol">;</span><span class="normal"> </span><span class="keyword">do</span>
<span class="normal">	  </span><span class="keyword">if</span><span class="normal"> grep </span><span class="string">"^# ### BEGIN LIBTOOL TAG CONFIG: $z$"</span><span class="normal"> </span><span class="symbol">&lt;</span><span class="normal"> </span><span class="string">"$progpath"</span><span class="normal"> </span><span class="symbol">&gt;</span><span class="normal"> /dev/null</span><span class="symbol">;</span><span class="normal"> </span><span class="keyword">then</span>
<span class="normal">	    </span><span class="comment"># Evaluate the configuration.</span>
<span class="normal">	    </span><span class="keyword">eval</span><span class="normal"> </span><span class="string">"`${SED} -n -e '/^# ### BEGIN LIBTOOL TAG CONFIG: '$z'$/,/^# ### END LIBTOOL TAG CONFIG: '$z'$/p' &lt; $progpath`"</span>
<span class="normal">	    </span><span class="variable">CC_quoted</span><span class="symbol">=</span>
<span class="normal">	    </span><span class="keyword">for</span><span class="normal"> arg </span><span class="keyword">in</span><span class="normal"> </span><span class="variable">$CC</span><span class="symbol">;</span><span class="normal"> </span><span class="keyword">do</span>
<span class="normal">	    </span><span class="comment"># Double-quote args containing other shell metacharacters.</span>
<span class="normal">	    </span><span class="keyword">case</span><span class="normal"> </span><span class="variable">$arg</span><span class="normal"> </span><span class="keyword">in</span>
<span class="normal">	      </span><span class="symbol">*[\[\~\</span><span class="comment">#\^\&amp;\*\(\)\{\}\|\;\&lt;\&gt;\?\'\ \	]*|*]*|"")</span>
<span class="normal">	      </span><span class="variable">arg</span><span class="symbol">=</span><span class="string">"</span><span class="specialchar">\"</span><span class="string">$arg</span><span class="specialchar">\"</span><span class="string">"</span>
<span class="normal">	      </span><span class="symbol">;;</span>
<span class="normal">	    </span><span class="keyword">esac</span>
<span class="normal">	    </span><span class="variable">CC_quoted</span><span class="symbol">=</span><span class="string">"$CC_quoted $arg"</span>
<span class="normal">	  </span><span class="keyword">done</span>
<span class="normal">	    </span><span class="comment"># user sometimes does CC=&lt;HOST&gt;-gcc so we need to match that to 'gcc'</span>
<span class="normal">	    </span><span class="variable">trimedcc</span><span class="symbol">=</span><span class="normal">`echo </span><span class="variable">${CC}</span><span class="normal"> </span><span class="symbol">|</span><span class="normal"> </span><span class="variable">$SED</span><span class="normal"> -e </span><span class="string">"s/${host}-//g"</span><span class="normal">`</span>
<span class="normal">	    </span><span class="comment"># and sometimes libtool has CC=&lt;HOST&gt;-gcc but user does CC=gcc</span>
<span class="normal">	    </span><span class="variable">extendcc</span><span class="symbol">=</span><span class="variable">${host}-${CC}</span>
<span class="normal">	    </span><span class="comment"># and sometimes libtool has CC=&lt;OLDHOST&gt;-gcc but user has CC=&lt;NEWHOST&gt;-gcc  </span>
<span class="normal">	    </span><span class="comment"># (Gentoo-specific hack because we always export $CHOST)</span>
<span class="normal">	    </span><span class="variable">mungedcc</span><span class="symbol">=</span><span class="variable">${CHOST-${host}}-${trimedcc}</span>
<span class="normal">	    </span><span class="keyword">case</span><span class="normal"> </span><span class="string">"$@ "</span><span class="normal"> </span><span class="keyword">in</span>
<span class="normal">	      </span><span class="string">"cc "</span><span class="symbol">*</span><span class="normal"> </span><span class="symbol">|</span><span class="normal"> </span><span class="string">" cc "</span><span class="symbol">*</span><span class="normal"> </span><span class="symbol">|</span><span class="normal"> </span><span class="string">"${host}-cc "</span><span class="symbol">*</span><span class="normal"> </span><span class="symbol">|</span><span class="normal"> </span><span class="string">" ${host}-cc "</span><span class="symbol">*|\</span>
<span class="normal">	      </span><span class="string">"gcc "</span><span class="symbol">*</span><span class="normal"> </span><span class="symbol">|</span><span class="normal"> </span><span class="string">" gcc "</span><span class="symbol">*</span><span class="normal"> </span><span class="symbol">|</span><span class="normal"> </span><span class="string">"${host}-gcc "</span><span class="symbol">*</span><span class="normal"> </span><span class="symbol">|</span><span class="normal"> </span><span class="string">" ${host}-gcc "</span><span class="symbol">*)</span>
<span class="normal">	      </span><span class="variable">tagname</span><span class="symbol">=</span><span class="normal">CC</span>
<span class="normal">	      </span><span class="keyword">break</span><span class="normal"> </span><span class="symbol">;;</span>
<span class="normal">	      </span><span class="string">"$trimedcc "</span><span class="symbol">*</span><span class="normal"> </span><span class="symbol">|</span><span class="normal"> </span><span class="string">" $trimedcc "</span><span class="symbol">*</span><span class="normal"> </span><span class="symbol">|</span><span class="normal"> </span><span class="string">"`$echo $trimedcc` "</span><span class="symbol">*</span><span class="normal"> </span><span class="symbol">|</span><span class="normal"> </span><span class="string">" `$echo $trimedcc` "</span><span class="symbol">*|\</span>
<span class="normal">	      </span><span class="string">"$extendcc "</span><span class="symbol">*</span><span class="normal"> </span><span class="symbol">|</span><span class="normal"> </span><span class="string">" $extendcc "</span><span class="symbol">*</span><span class="normal"> </span><span class="symbol">|</span><span class="normal"> </span><span class="string">"`$echo $extendcc` "</span><span class="symbol">*</span><span class="normal"> </span><span class="symbol">|</span><span class="normal"> </span><span class="string">" `$echo $extendcc` "</span><span class="symbol">*|\</span>
<span class="normal">	      </span><span class="string">"$mungedcc "</span><span class="symbol">*</span><span class="normal"> </span><span class="symbol">|</span><span class="normal"> </span><span class="string">" $mungedcc "</span><span class="symbol">*</span><span class="normal"> </span><span class="symbol">|</span><span class="normal"> </span><span class="string">"`$echo $mungedcc` "</span><span class="symbol">*</span><span class="normal"> </span><span class="symbol">|</span><span class="normal"> </span><span class="string">" `$echo $mungedcc` "</span><span class="symbol">*|\</span>
<span class="normal">	      </span><span class="string">" $CC "</span><span class="symbol">*</span><span class="normal"> </span><span class="symbol">|</span><span class="normal"> </span><span class="string">"$CC "</span><span class="symbol">*</span><span class="normal"> </span><span class="symbol">|</span><span class="normal"> </span><span class="string">" `$echo $CC` "</span><span class="symbol">*</span><span class="normal"> </span><span class="symbol">|</span><span class="normal"> </span><span class="string">"`$echo $CC` "</span><span class="symbol">*</span><span class="normal"> </span><span class="symbol">|</span><span class="normal"> </span><span class="string">" $CC_quoted"</span><span class="symbol">*</span><span class="normal"> </span><span class="symbol">|</span><span class="normal"> </span><span class="string">"$CC_quoted "</span><span class="symbol">*</span><span class="normal"> </span><span class="symbol">|</span><span class="normal"> </span><span class="string">" `$echo $CC_quoted` "</span><span class="symbol">*</span><span class="normal"> </span><span class="symbol">|</span><span class="normal"> </span><span class="string">"`$echo $CC_quoted` "</span><span class="symbol">*)</span>
<span class="normal">	      </span><span class="comment"># The compiler in the base compile command matches</span>
<span class="normal">	      </span><span class="comment"># the one in the tagged configuration.</span>
<span class="normal">	      </span><span class="comment"># Assume this is the tagged configuration we want.</span>
<span class="normal">	      </span><span class="variable">tagname</span><span class="symbol">=</span><span class="variable">$z</span>
<span class="normal">	      </span><span class="keyword">break</span>
<span class="normal">	      </span><span class="symbol">;;</span>
<span class="normal">	    </span><span class="keyword">esac</span>
<span class="normal">	  </span><span class="keyword">fi</span>
<span class="normal">	</span><span class="keyword">done</span>
<span class="normal">	</span><span class="comment"># If $tagname still isn't set, then no tagged configuration</span>
<span class="normal">	</span><span class="comment"># was found and let the user know that the "--tag" command</span>
<span class="normal">	</span><span class="comment"># line option must be used.</span>
<span class="normal">	</span><span class="keyword">if</span><span class="normal"> </span><span class="keyword">test</span><span class="normal"> -z </span><span class="string">"$tagname"</span><span class="symbol">;</span><span class="normal"> </span><span class="keyword">then</span>
<span class="normal">	  </span><span class="variable">$echo</span><span class="normal"> </span><span class="string">"$modename: unable to infer tagged configuration"</span>
<span class="normal">	  </span><span class="variable">$echo</span><span class="normal"> </span><span class="string">"$modename: specify a tag with </span><span class="specialchar">\`</span><span class="string">--tag'"</span><span class="normal"> </span><span class="number">1</span><span class="symbol">&gt;&amp;</span><span class="number">2</span>
<span class="normal">	  </span><span class="keyword">exit</span><span class="normal"> </span><span class="variable">$EXIT_FAILURE</span>
<span class="comment">#        else</span>
<span class="comment">#          $echo "$modename: using $tagname tagged configuration"</span>
<span class="normal">	</span><span class="keyword">fi</span>
<span class="normal">	</span><span class="symbol">;;</span>
<span class="normal">      </span><span class="keyword">esac</span>
<span class="normal">    </span><span class="keyword">fi</span>
<span class="normal">}</span>


<span class="comment"># func_extract_an_archive dir oldlib</span>
<span class="function">func_extract_an_archive ()</span>
<span class="normal">{</span>
<span class="normal">    </span><span class="variable">f_ex_an_ar_dir</span><span class="symbol">=</span><span class="string">"$1"</span><span class="symbol">;</span><span class="normal"> </span><span class="keyword">shift</span>
<span class="normal">    </span><span class="variable">f_ex_an_ar_oldlib</span><span class="symbol">=</span><span class="string">"$1"</span>

<span class="normal">    </span><span class="variable">$show</span><span class="normal"> </span><span class="string">"(cd $f_ex_an_ar_dir &amp;&amp; $AR x $f_ex_an_ar_oldlib)"</span>
<span class="normal">    </span><span class="variable">$run</span><span class="normal"> </span><span class="keyword">eval</span><span class="normal"> </span><span class="string">"(cd </span><span class="specialchar">\$</span><span class="string">f_ex_an_ar_dir &amp;&amp; $AR x </span><span class="specialchar">\$</span><span class="string">f_ex_an_ar_oldlib)"</span><span class="normal"> </span><span class="symbol">||</span><span class="normal"> </span><span class="keyword">exit</span><span class="normal"> </span><span class="variable">$?</span>
<span class="normal">    </span><span class="keyword">if</span><span class="normal"> </span><span class="symbol">(</span><span class="variable">$AR</span><span class="normal"> t </span><span class="string">"$f_ex_an_ar_oldlib"</span><span class="normal"> </span><span class="symbol">|</span><span class="normal"> sort </span><span class="symbol">|</span><span class="normal"> sort -uc </span><span class="symbol">&gt;</span><span class="normal">/dev/null </span><span class="number">2</span><span class="symbol">&gt;&amp;</span><span class="number">1</span><span class="symbol">);</span><span class="normal"> </span><span class="keyword">then</span>
<span class="normal">     </span><span class="symbol">:</span>
<span class="normal">    </span><span class="keyword">else</span>
<span class="normal">      </span><span class="variable">$echo</span><span class="normal"> </span><span class="string">"$modename: ERROR: object name conflicts: $f_ex_an_ar_dir/$f_ex_an_ar_oldlib"</span><span class="normal"> </span><span class="number">1</span><span class="symbol">&gt;&amp;</span><span class="number">2</span>
<span class="normal">      </span><span class="keyword">exit</span><span class="normal"> </span><span class="variable">$EXIT_FAILURE</span>
<span class="normal">    </span><span class="keyword">fi</span>
<span class="normal">}</span>

<span class="comment"># func_extract_archives gentop oldlib ...</span>
<span class="function">func_extract_archives ()</span>
<span class="normal">{</span>
<span class="normal">    </span><span class="variable">my_gentop</span><span class="symbol">=</span><span class="string">"$1"</span><span class="symbol">;</span><span class="normal"> </span><span class="keyword">shift</span>
<span class="normal">    </span><span class="variable">my_oldlibs</span><span class="symbol">=</span><span class="variable">${1+"$@"}</span>
<span class="normal">    </span><span class="variable">my_oldobjs</span><span class="symbol">=</span><span class="string">""</span>
<span class="normal">    </span><span class="variable">my_xlib</span><span class="symbol">=</span><span class="string">""</span>
<span class="normal">    </span><span class="variable">my_xabs</span><span class="symbol">=</span><span class="string">""</span>
<span class="normal">    </span><span class="variable">my_xdir</span><span class="symbol">=</span><span class="string">""</span>
<span class="normal">    </span><span class="variable">my_status</span><span class="symbol">=</span><span class="string">""</span>

<span class="normal">    </span><span class="variable">$show</span><span class="normal"> </span><span class="string">"${rm}r $my_gentop"</span>
<span class="normal">    </span><span class="variable">$run</span><span class="normal"> </span><span class="variable">${rm}</span><span class="normal">r </span><span class="string">"$my_gentop"</span>
<span class="normal">    </span><span class="variable">$show</span><span class="normal"> </span><span class="string">"$mkdir $my_gentop"</span>
<span class="normal">    </span><span class="variable">$run</span><span class="normal"> </span><span class="variable">$mkdir</span><span class="normal"> </span><span class="string">"$my_gentop"</span>
<span class="normal">    </span><span class="variable">my_status</span><span class="symbol">=</span><span class="variable">$?</span>
<span class="normal">    </span><span class="keyword">if</span><span class="normal"> </span><span class="keyword">test</span><span class="normal"> </span><span class="string">"$my_status"</span><span class="normal"> -ne </span><span class="number">0</span><span class="normal"> </span><span class="symbol">&amp;&amp;</span><span class="normal"> </span><span class="keyword">test</span><span class="normal"> </span><span class="symbol">!</span><span class="normal"> -d </span><span class="string">"$my_gentop"</span><span class="symbol">;</span><span class="normal"> </span><span class="keyword">then</span>
<span class="normal">      </span><span class="keyword">exit</span><span class="normal"> </span><span class="variable">$my_status</span>
<span class="normal">    </span><span class="keyword">fi</span>

<span class="normal">    </span><span class="keyword">for</span><span class="normal"> my_xlib </span><span class="keyword">in</span><span class="normal"> </span><span class="variable">$my_oldlibs</span><span class="symbol">;</span><span class="normal"> </span><span class="keyword">do</span>
<span class="normal">      </span><span class="comment"># Extract the objects.</span>
<span class="normal">      </span><span class="keyword">case</span><span class="normal"> </span><span class="variable">$my_xlib</span><span class="normal"> </span><span class="keyword">in</span>
<span class="normal">	</span><span class="symbol">[\\/]*</span><span class="normal"> </span><span class="symbol">|</span><span class="normal"> </span><span class="symbol">[</span><span class="normal">A-Za-z</span><span class="symbol">]:[\\/]*)</span><span class="normal"> </span><span class="variable">my_xabs</span><span class="symbol">=</span><span class="string">"$my_xlib"</span><span class="normal"> </span><span class="symbol">;;</span>
<span class="normal">	</span><span class="symbol">*)</span><span class="normal"> </span><span class="variable">my_xabs</span><span class="symbol">=</span><span class="normal">`pwd`</span><span class="string">"/$my_xlib"</span><span class="normal"> </span><span class="symbol">;;</span>
<span class="normal">      </span><span class="keyword">esac</span>
<span class="normal">      </span><span class="variable">my_xlib</span><span class="symbol">=</span><span class="normal">`</span><span class="variable">$echo</span><span class="normal"> </span><span class="string">"X$my_xlib"</span><span class="normal"> </span><span class="symbol">|</span><span class="normal"> </span><span class="variable">$Xsed</span><span class="normal"> -e </span><span class="string">'s%^.*/%%'</span><span class="normal">`</span>
<span class="normal">      </span><span class="variable">my_xlib_u</span><span class="symbol">=</span><span class="variable">$my_xlib</span>
<span class="normal">      </span><span class="keyword">while</span><span class="normal"> </span><span class="symbol">:;</span><span class="normal"> </span><span class="keyword">do</span>
<span class="normal">        </span><span class="keyword">case</span><span class="normal"> </span><span class="string">" $extracted_archives "</span><span class="normal"> </span><span class="keyword">in</span>
<span class="normal">	</span><span class="symbol">*</span><span class="string">" $my_xlib_u "</span><span class="symbol">*)</span>
<span class="normal">	  </span><span class="variable">extracted_serial</span><span class="symbol">=</span><span class="normal">`expr </span><span class="variable">$extracted_serial</span><span class="normal"> </span><span class="symbol">+</span><span class="normal"> </span><span class="number">1</span><span class="normal">`</span>
<span class="normal">	  </span><span class="variable">my_xlib_u</span><span class="symbol">=</span><span class="normal">lt</span><span class="variable">$extracted_serial</span><span class="normal">-</span><span class="variable">$my_xlib</span><span class="normal"> </span><span class="symbol">;;</span>
<span class="normal">	</span><span class="symbol">*)</span><span class="normal"> </span><span class="keyword">break</span><span class="normal"> </span><span class="symbol">;;</span>
<span class="normal">	</span><span class="keyword">esac</span>
<span class="normal">      </span><span class="keyword">done</span>
<span class="normal">      </span><span class="variable">extracted_archives</span><span class="symbol">=</span><span class="string">"$extracted_archives $my_xlib_u"</span>
<span class="normal">      </span><span class="variable">my_xdir</span><span class="symbol">=</span><span class="string">"$my_gentop/$my_xlib_u"</span>

<span class="normal">      </span><span class="variable">$show</span><span class="normal"> </span><span class="string">"${rm}r $my_xdir"</span>
<span class="normal">      </span><span class="variable">$run</span><span class="normal"> </span><span class="variable">${rm}</span><span class="normal">r </span><span class="string">"$my_xdir"</span>
<span class="normal">      </span><span class="variable">$show</span><span class="normal"> </span><span class="string">"$mkdir $my_xdir"</span>
<span class="normal">      </span><span class="variable">$run</span><span class="normal"> </span><span class="variable">$mkdir</span><span class="normal"> </span><span class="string">"$my_xdir"</span>
<span class="normal">      </span><span class="variable">exit_status</span><span class="symbol">=</span><span class="variable">$?</span>
<span class="normal">      </span><span class="keyword">if</span><span class="normal"> </span><span class="keyword">test</span><span class="normal"> </span><span class="string">"$exit_status"</span><span class="normal"> -ne </span><span class="number">0</span><span class="normal"> </span><span class="symbol">&amp;&amp;</span><span class="normal"> </span><span class="keyword">test</span><span class="normal"> </span><span class="symbol">!</span><span class="normal"> -d </span><span class="string">"$my_xdir"</span><span class="symbol">;</span><span class="normal"> </span><span class="keyword">then</span>
<span class="normal">	</span><span class="keyword">exit</span><span class="normal"> </span><span class="variable">$exit_status</span>
<span class="normal">      </span><span class="keyword">fi</span>
<span class="normal">      </span><span class="keyword">case</span><span class="normal"> </span><span class="variable">$host</span><span class="normal"> </span><span class="keyword">in</span>
<span class="normal">      </span><span class="symbol">*</span><span class="normal">-darwin</span><span class="symbol">*)</span>
<span class="normal">	</span><span class="variable">$show</span><span class="normal"> </span><span class="string">"Extracting $my_xabs"</span>
<span class="normal">	</span><span class="comment"># Do not bother doing anything if just a dry run</span>
<span class="normal">	</span><span class="keyword">if</span><span class="normal"> </span><span class="keyword">test</span><span class="normal"> -z </span><span class="string">"$run"</span><span class="symbol">;</span><span class="normal"> </span><span class="keyword">then</span>
<span class="normal">	  </span><span class="variable">darwin_orig_dir</span><span class="symbol">=</span><span class="normal">`pwd`</span>
<span class="normal">	  cd </span><span class="variable">$my_xdir</span><span class="normal"> </span><span class="symbol">||</span><span class="normal"> </span><span class="keyword">exit</span><span class="normal"> </span><span class="variable">$?</span>
<span class="normal">	  </span><span class="variable">darwin_archive</span><span class="symbol">=</span><span class="variable">$my_xabs</span>
<span class="normal">	  </span><span class="variable">darwin_curdir</span><span class="symbol">=</span><span class="normal">`pwd`</span>
<span class="normal">	  </span><span class="variable">darwin_base_archive</span><span class="symbol">=</span><span class="normal">`</span><span class="variable">$echo</span><span class="normal"> </span><span class="string">"X$darwin_archive"</span><span class="normal"> </span><span class="symbol">|</span><span class="normal"> </span><span class="variable">$Xsed</span><span class="normal"> -e </span><span class="string">'s%^.*/%%'</span><span class="normal">`</span>
<span class="normal">	  </span><span class="variable">darwin_arches</span><span class="symbol">=</span><span class="normal">`lipo -info </span><span class="string">"$darwin_archive"</span><span class="normal"> </span><span class="number">2</span><span class="symbol">&gt;</span><span class="normal">/dev/null </span><span class="symbol">|</span><span class="normal"> </span><span class="variable">$EGREP</span><span class="normal"> Architectures </span><span class="number">2</span><span class="symbol">&gt;</span><span class="normal">/dev/null`</span>
<span class="normal">	  </span><span class="keyword">if</span><span class="normal"> </span><span class="keyword">test</span><span class="normal"> -n </span><span class="string">"$darwin_arches"</span><span class="symbol">;</span><span class="normal"> </span><span class="keyword">then</span><span class="normal"> </span>
<span class="normal">	    </span><span class="variable">darwin_arches</span><span class="symbol">=</span><span class="normal">`echo </span><span class="string">"$darwin_arches"</span><span class="normal"> </span><span class="symbol">|</span><span class="normal"> </span><span class="variable">$SED</span><span class="normal"> -e </span><span class="string">'s/.*are://'</span><span class="normal">`</span>
<span class="normal">	    </span><span class="variable">darwin_arch</span><span class="symbol">=</span>
<span class="normal">	    </span><span class="variable">$show</span><span class="normal"> </span><span class="string">"$darwin_base_archive has multiple architectures $darwin_arches"</span>
<span class="normal">	    </span><span class="keyword">for</span><span class="normal"> darwin_arch </span><span class="keyword">in</span><span class="normal">  </span><span class="variable">$darwin_arches</span><span class="normal"> </span><span class="symbol">;</span><span class="normal"> </span><span class="keyword">do</span>
<span class="normal">	      mkdir -p </span><span class="string">"unfat-$$/${darwin_base_archive}-${darwin_arch}"</span>
<span class="normal">	      lipo -thin </span><span class="variable">$darwin_arch</span><span class="normal"> -output </span><span class="string">"unfat-$$/${darwin_base_archive}-${darwin_arch}/${darwin_base_archive}"</span><span class="normal"> </span><span class="string">"${darwin_archive}"</span>
<span class="normal">	      cd </span><span class="string">"unfat-$$/${darwin_base_archive}-${darwin_arch}"</span>
<span class="normal">	      func_extract_an_archive </span><span class="string">"`pwd`"</span><span class="normal"> </span><span class="string">"${darwin_base_archive}"</span>
<span class="normal">	      cd </span><span class="string">"$darwin_curdir"</span>
<span class="normal">	      </span><span class="variable">$rm</span><span class="normal"> </span><span class="string">"unfat-$$/${darwin_base_archive}-${darwin_arch}/${darwin_base_archive}"</span>
<span class="normal">	    </span><span class="keyword">done</span><span class="normal"> </span><span class="comment"># $darwin_arches</span>
<span class="normal">      </span><span class="comment">## Okay now we have a bunch of thin objects, gotta fatten them up :)</span>
<span class="normal">	    </span><span class="variable">darwin_filelist</span><span class="symbol">=</span><span class="normal">`find unfat-</span><span class="variable">$$</span><span class="normal"> -type f -name </span><span class="symbol">\*.</span><span class="normal">o -print -o -name </span><span class="symbol">\*.</span><span class="normal">lo -print</span><span class="symbol">|</span><span class="normal"> xargs basename </span><span class="symbol">|</span><span class="normal"> sort -u </span><span class="symbol">|</span><span class="normal"> </span><span class="variable">$NL2SP</span><span class="normal">`</span>
<span class="normal">	    </span><span class="variable">darwin_file</span><span class="symbol">=</span>
<span class="normal">	    </span><span class="variable">darwin_files</span><span class="symbol">=</span>
<span class="normal">	    </span><span class="keyword">for</span><span class="normal"> darwin_file </span><span class="keyword">in</span><span class="normal"> </span><span class="variable">$darwin_filelist</span><span class="symbol">;</span><span class="normal"> </span><span class="keyword">do</span>
<span class="normal">	      </span><span class="variable">darwin_files</span><span class="symbol">=</span><span class="normal">`find unfat-</span><span class="variable">$$</span><span class="normal"> -name </span><span class="variable">$darwin_file</span><span class="normal"> -print </span><span class="symbol">|</span><span class="normal"> </span><span class="variable">$NL2SP</span><span class="normal">`</span>
<span class="normal">	      lipo -create -output </span><span class="string">"$darwin_file"</span><span class="normal"> </span><span class="variable">$darwin_files</span>
<span class="normal">	    </span><span class="keyword">done</span><span class="normal"> </span><span class="comment"># $darwin_filelist</span>
<span class="normal">	    </span><span class="variable">${rm}</span><span class="normal">r unfat-</span><span class="variable">$$</span>
<span class="normal">	    cd </span><span class="string">"$darwin_orig_dir"</span>
<span class="normal">	  </span><span class="keyword">else</span>
<span class="normal">	    cd </span><span class="string">"$darwin_orig_dir"</span>
<span class="normal"> 	    func_extract_an_archive </span><span class="string">"$my_xdir"</span><span class="normal"> </span><span class="string">"$my_xabs"</span>
<span class="normal">	  </span><span class="keyword">fi</span><span class="normal"> </span><span class="comment"># $darwin_arches</span>
<span class="normal">	</span><span class="keyword">fi</span><span class="normal"> </span><span class="comment"># $run</span>
<span class="normal">	</span><span class="symbol">;;</span>
<span class="normal">      </span><span class="symbol">*)</span>
<span class="normal">        func_extract_an_archive </span><span class="string">"$my_xdir"</span><span class="normal"> </span><span class="string">"$my_xabs"</span>
<span class="normal">        </span><span class="symbol">;;</span>
<span class="normal">      </span><span class="keyword">esac</span>
<span class="normal">      </span><span class="variable">my_oldobjs</span><span class="symbol">=</span><span class="string">"$my_oldobjs "</span><span class="normal">`find </span><span class="variable">$my_xdir</span><span class="normal"> -name </span><span class="symbol">\*.</span><span class="variable">$objext</span><span class="normal"> -print -o -name </span><span class="symbol">\*.</span><span class="normal">lo -print </span><span class="symbol">|</span><span class="normal"> </span><span class="variable">$NL2SP</span><span class="normal">`</span>
<span class="normal">    </span><span class="keyword">done</span>
<span class="normal">    </span><span class="variable">func_extract_archives_result</span><span class="symbol">=</span><span class="string">"$my_oldobjs"</span>
<span class="normal">}</span>
<span class="comment"># End of Shell function definitions</span>
<span class="comment">#####################################</span>

<span class="comment"># Darwin sucks</span>
<span class="keyword">eval</span><span class="normal"> </span><span class="variable">std_shrext</span><span class="symbol">=</span><span class="normal">\"</span><span class="variable">$shrext_cmds</span><span class="normal">\"</span>

<span class="variable">disable_libs</span><span class="symbol">=</span><span class="normal">no</span>

<span class="comment"># Parse our command line options once, thoroughly.</span>
<span class="keyword">while</span><span class="normal"> </span><span class="keyword">test</span><span class="normal"> </span><span class="string">"$#"</span><span class="normal"> -gt </span><span class="number">0</span>
<span class="keyword">do</span>
<span class="normal">  </span><span class="variable">arg</span><span class="symbol">=</span><span class="string">"$1"</span>
<span class="normal">  </span><span class="keyword">shift</span>

<span class="normal">  </span><span class="keyword">case</span><span class="normal"> </span><span class="variable">$arg</span><span class="normal"> </span><span class="keyword">in</span>
<span class="normal">  -</span><span class="symbol">*=*)</span><span class="normal"> </span><span class="variable">optarg</span><span class="symbol">=</span><span class="normal">`</span><span class="variable">$echo</span><span class="normal"> </span><span class="string">"X$arg"</span><span class="normal"> </span><span class="symbol">|</span><span class="normal"> </span><span class="variable">$Xsed</span><span class="normal"> -e </span><span class="string">'s/[-_a-zA-Z0-9]*=//'</span><span class="normal">` </span><span class="symbol">;;</span>
<span class="normal">  </span><span class="symbol">*)</span><span class="normal"> </span><span class="variable">optarg</span><span class="symbol">=</span><span class="normal"> </span><span class="symbol">;;</span>
<span class="normal">  </span><span class="keyword">esac</span>

<span class="normal">  </span><span class="comment"># If the previous option needs an argument, assign it.</span>
<span class="normal">  </span><span class="keyword">if</span><span class="normal"> </span><span class="keyword">test</span><span class="normal"> -n </span><span class="string">"$prev"</span><span class="symbol">;</span><span class="normal"> </span><span class="keyword">then</span>
<span class="normal">    </span><span class="keyword">case</span><span class="normal"> </span><span class="variable">$prev</span><span class="normal"> </span><span class="keyword">in</span>
<span class="normal">    execute_dlfiles</span><span class="symbol">)</span>
<span class="normal">      </span><span class="variable">execute_dlfiles</span><span class="symbol">=</span><span class="string">"$execute_dlfiles $arg"</span>
<span class="normal">      </span><span class="symbol">;;</span>
<span class="normal">    tag</span><span class="symbol">)</span>
<span class="normal">      </span><span class="variable">tagname</span><span class="symbol">=</span><span class="string">"$arg"</span>
<span class="normal">      </span><span class="variable">preserve_args</span><span class="symbol">=</span><span class="string">"${preserve_args}=$arg"</span>

<span class="normal">      </span><span class="comment"># Check whether tagname contains only valid characters</span>
<span class="normal">      </span><span class="keyword">case</span><span class="normal"> </span><span class="variable">$tagname</span><span class="normal"> </span><span class="keyword">in</span>
<span class="normal">      </span><span class="symbol">*[!</span><span class="normal">-_A-Za-z</span><span class="number">0</span><span class="normal">-</span><span class="number">9</span><span class="symbol">,/]*)</span>
<span class="normal">	</span><span class="variable">$echo</span><span class="normal"> </span><span class="string">"$progname: invalid tag name: $tagname"</span><span class="normal"> </span><span class="number">1</span><span class="symbol">&gt;&amp;</span><span class="number">2</span>
<span class="normal">	</span><span class="keyword">exit</span><span class="normal"> </span><span class="variable">$EXIT_FAILURE</span>
<span class="normal">	</span><span class="symbol">;;</span>
<span class="normal">      </span><span class="keyword">esac</span>

<span class="normal">      </span><span class="keyword">case</span><span class="normal"> </span><span class="variable">$tagname</span><span class="normal"> </span><span class="keyword">in</span>
<span class="normal">      CC</span><span class="symbol">)</span>
<span class="normal">	</span><span class="comment"># Don't test for the "default" C tag, as we know, it's there, but</span>
<span class="normal">	</span><span class="comment"># not specially marked.</span>
<span class="normal">	</span><span class="symbol">;;</span>
<span class="normal">      </span><span class="symbol">*)</span>
<span class="normal">	</span><span class="keyword">if</span><span class="normal"> grep </span><span class="string">"^# ### BEGIN LIBTOOL TAG CONFIG: $tagname$"</span><span class="normal"> </span><span class="symbol">&lt;</span><span class="normal"> </span><span class="string">"$progpath"</span><span class="normal"> </span><span class="symbol">&gt;</span><span class="normal"> /dev/null</span><span class="symbol">;</span><span class="normal"> </span><span class="keyword">then</span>
<span class="normal">	  </span><span class="variable">taglist</span><span class="symbol">=</span><span class="string">"$taglist $tagname"</span>
<span class="normal">	  </span><span class="comment"># Evaluate the configuration.</span>
<span class="normal">	  </span><span class="keyword">eval</span><span class="normal"> </span><span class="string">"`${SED} -n -e '/^# ### BEGIN LIBTOOL TAG CONFIG: '$tagname'$/,/^# ### END LIBTOOL TAG CONFIG: '$tagname'$/p' &lt; $progpath`"</span>
<span class="normal">	</span><span class="keyword">else</span>
<span class="normal">	  </span><span class="variable">$echo</span><span class="normal"> </span><span class="string">"$progname: ignoring unknown tag $tagname"</span><span class="normal"> </span><span class="number">1</span><span class="symbol">&gt;&amp;</span><span class="number">2</span>
<span class="normal">	</span><span class="keyword">fi</span>
<span class="normal">	</span><span class="symbol">;;</span>
<span class="normal">      </span><span class="keyword">esac</span>
<span class="normal">      </span><span class="symbol">;;</span>
<span class="normal">    </span><span class="symbol">*)</span>
<span class="normal">      </span><span class="keyword">eval</span><span class="normal"> </span><span class="string">"$prev=</span><span class="specialchar">\$</span><span class="string">arg"</span>
<span class="normal">      </span><span class="symbol">;;</span>
<span class="normal">    </span><span class="keyword">esac</span>

<span class="normal">    </span><span class="variable">prev</span><span class="symbol">=</span>
<span class="normal">    </span><span class="variable">prevopt</span><span class="symbol">=</span>
<span class="normal">    </span><span class="keyword">continue</span>
<span class="normal">  </span><span class="keyword">fi</span>

<span class="normal">  </span><span class="comment"># Have we seen a non-optional argument yet?</span>
<span class="normal">  </span><span class="keyword">case</span><span class="normal"> </span><span class="variable">$arg</span><span class="normal"> </span><span class="keyword">in</span>
<span class="normal">  --help</span><span class="symbol">)</span>
<span class="normal">    </span><span class="variable">show_help</span><span class="symbol">=</span><span class="normal">yes</span>
<span class="normal">    </span><span class="symbol">;;</span>

<span class="normal">  --version</span><span class="symbol">)</span>
<span class="normal">    echo </span><span class="string">"\</span>
<span class="string">$PROGRAM (GNU $PACKAGE) $VERSION$TIMESTAMP</span>

<span class="string">Copyright (C) 2007  Free Software Foundation, Inc.</span>
<span class="string">This is free software; see the source for copying conditions.  There is NO</span>
<span class="string">warranty; not even for MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE."</span>
<span class="normal">    </span><span class="keyword">exit</span><span class="normal"> </span><span class="variable">$?</span>
<span class="normal">    </span><span class="symbol">;;</span>

<span class="normal">  --config</span><span class="symbol">)</span>
<span class="normal">    </span><span class="variable">${SED}</span><span class="normal"> -e </span><span class="string">'1,/^# ### BEGIN LIBTOOL CONFIG/d'</span><span class="normal"> -e </span><span class="string">'/^# ### END LIBTOOL CONFIG/,$d'</span><span class="normal"> </span><span class="variable">$progpath</span>
<span class="normal">    </span><span class="comment"># Now print the configurations for the tags.</span>
<span class="normal">    </span><span class="keyword">for</span><span class="normal"> tagname </span><span class="keyword">in</span><span class="normal"> </span><span class="variable">$taglist</span><span class="symbol">;</span><span class="normal"> </span><span class="keyword">do</span>
<span class="normal">      </span><span class="variable">${SED}</span><span class="normal"> -n -e </span><span class="string">"/^# ### BEGIN LIBTOOL TAG CONFIG: $tagname$/,/^# ### END LIBTOOL TAG CONFIG: $tagname$/p"</span><span class="normal"> </span><span class="symbol">&lt;</span><span class="normal"> </span><span class="string">"$progpath"</span>
<span class="normal">    </span><span class="keyword">done</span>
<span class="normal">    </span><span class="keyword">exit</span><span class="normal"> </span><span class="variable">$?</span>
<span class="normal">    </span><span class="symbol">;;</span>

<span class="normal">  --debug</span><span class="symbol">)</span>
<span class="normal">    </span><span class="variable">$echo</span><span class="normal"> </span><span class="string">"$progname: enabling shell trace mode"</span>
<span class="normal">    </span><span class="keyword">set</span><span class="normal"> -x</span>
<span class="normal">    </span><span class="variable">preserve_args</span><span class="symbol">=</span><span class="string">"$preserve_args $arg"</span>
<span class="normal">    </span><span class="symbol">;;</span>

<span class="normal">  --dry-run </span><span class="symbol">|</span><span class="normal"> -n</span><span class="symbol">)</span>
<span class="normal">    </span><span class="variable">run</span><span class="symbol">=:</span>
<span class="normal">    </span><span class="symbol">;;</span>

<span class="normal">  --features</span><span class="symbol">)</span>
<span class="normal">    </span><span class="variable">$echo</span><span class="normal"> </span><span class="string">"host: $host"</span>
<span class="normal">    </span><span class="keyword">if</span><span class="normal"> </span><span class="keyword">test</span><span class="normal"> </span><span class="string">"$build_libtool_libs"</span><span class="normal"> </span><span class="symbol">=</span><span class="normal"> yes</span><span class="symbol">;</span><span class="normal"> </span><span class="keyword">then</span>
<span class="normal">      </span><span class="variable">$echo</span><span class="normal"> </span><span class="string">"enable shared libraries"</span>
<span class="normal">    </span><span class="keyword">else</span>
<span class="normal">      </span><span class="variable">$echo</span><span class="normal"> </span><span class="string">"disable shared libraries"</span>
<span class="normal">    </span><span class="keyword">fi</span>
<span class="normal">    </span><span class="keyword">if</span><span class="normal"> </span><span class="keyword">test</span><span class="normal"> </span><span class="string">"$build_old_libs"</span><span class="normal"> </span><span class="symbol">=</span><span class="normal"> yes</span><span class="symbol">;</span><span class="normal"> </span><span class="keyword">then</span>
<span class="normal">      </span><span class="variable">$echo</span><span class="normal"> </span><span class="string">"enable static libraries"</span>
<span class="normal">    </span><span class="keyword">else</span>
<span class="normal">      </span><span class="variable">$echo</span><span class="normal"> </span><span class="string">"disable static libraries"</span>
<span class="normal">    </span><span class="keyword">fi</span>
<span class="normal">    </span><span class="keyword">exit</span><span class="normal"> </span><span class="variable">$?</span>
<span class="normal">    </span><span class="symbol">;;</span>

<span class="normal">  --finish</span><span class="symbol">)</span><span class="normal"> </span><span class="variable">mode</span><span class="symbol">=</span><span class="string">"finish"</span><span class="normal"> </span><span class="symbol">;;</span>

<span class="normal">  --mode</span><span class="symbol">)</span><span class="normal"> </span><span class="variable">prevopt</span><span class="symbol">=</span><span class="string">"--mode"</span><span class="normal"> </span><span class="variable">prev</span><span class="symbol">=</span><span class="normal">mode </span><span class="symbol">;;</span>
<span class="normal">  --mode</span><span class="symbol">=*)</span><span class="normal"> </span><span class="variable">mode</span><span class="symbol">=</span><span class="string">"$optarg"</span><span class="normal"> </span><span class="symbol">;;</span>

<span class="normal">  --preserve-dup-deps</span><span class="symbol">)</span><span class="normal"> </span><span class="variable">duplicate_deps</span><span class="symbol">=</span><span class="string">"yes"</span><span class="normal"> </span><span class="symbol">;;</span>

<span class="normal">  --quiet </span><span class="symbol">|</span><span class="normal"> --silent</span><span class="symbol">)</span>
<span class="normal">    </span><span class="variable">show</span><span class="symbol">=:</span>
<span class="normal">    </span><span class="variable">preserve_args</span><span class="symbol">=</span><span class="string">"$preserve_args $arg"</span>
<span class="normal">    </span><span class="symbol">;;</span>

<span class="normal">  --tag</span><span class="symbol">)</span>
<span class="normal">    </span><span class="variable">prevopt</span><span class="symbol">=</span><span class="string">"--tag"</span>
<span class="normal">    </span><span class="variable">prev</span><span class="symbol">=</span><span class="normal">tag</span>
<span class="normal">    </span><span class="variable">preserve_args</span><span class="symbol">=</span><span class="string">"$preserve_args --tag"</span>
<span class="normal">    </span><span class="symbol">;;</span>
<span class="normal">  --tag</span><span class="symbol">=*)</span>
<span class="normal">    </span><span class="keyword">set</span><span class="normal"> tag </span><span class="string">"$optarg"</span><span class="normal"> </span><span class="variable">${1+"$@"}</span>
<span class="normal">    </span><span class="keyword">shift</span>
<span class="normal">    </span><span class="variable">prev</span><span class="symbol">=</span><span class="normal">tag</span>
<span class="normal">    </span><span class="variable">preserve_args</span><span class="symbol">=</span><span class="string">"$preserve_args --tag"</span>
<span class="normal">    </span><span class="symbol">;;</span>

<span class="normal">  -dlopen</span><span class="symbol">)</span>
<span class="normal">    </span><span class="variable">prevopt</span><span class="symbol">=</span><span class="string">"-dlopen"</span>
<span class="normal">    </span><span class="variable">prev</span><span class="symbol">=</span><span class="normal">execute_dlfiles</span>
<span class="normal">    </span><span class="symbol">;;</span>

<span class="normal">  -</span><span class="symbol">*)</span>
<span class="normal">    </span><span class="variable">$echo</span><span class="normal"> </span><span class="string">"$modename: unrecognized option </span><span class="specialchar">\`</span><span class="string">$arg'"</span><span class="normal"> </span><span class="number">1</span><span class="symbol">&gt;&amp;</span><span class="number">2</span>
<span class="normal">    </span><span class="variable">$echo</span><span class="normal"> </span><span class="string">"$help"</span><span class="normal"> </span><span class="number">1</span><span class="symbol">&gt;&amp;</span><span class="number">2</span>
<span class="normal">    </span><span class="keyword">exit</span><span class="normal"> </span><span class="variable">$EXIT_FAILURE</span>
<span class="normal">    </span><span class="symbol">;;</span>

<span class="normal">  </span><span class="symbol">*)</span>
<span class="normal">    </span><span class="variable">nonopt</span><span class="symbol">=</span><span class="string">"$arg"</span>
<span class="normal">    </span><span class="keyword">break</span>
<span class="normal">    </span><span class="symbol">;;</span>
<span class="normal">  </span><span class="keyword">esac</span>
<span class="keyword">done</span>

<span class="keyword">if</span><span class="normal"> </span><span class="keyword">test</span><span class="normal"> -n </span><span class="string">"$prevopt"</span><span class="symbol">;</span><span class="normal"> </span><span class="keyword">then</span>
<span class="normal">  </span><span class="variable">$echo</span><span class="normal"> </span><span class="string">"$modename: option </span><span class="specialchar">\`</span><span class="string">$prevopt' requires an argument"</span><span class="normal"> </span><span class="number">1</span><span class="symbol">&gt;&amp;</span><span class="number">2</span>
<span class="normal">  </span><span class="variable">$echo</span><span class="normal"> </span><span class="string">"$help"</span><span class="normal"> </span><span class="number">1</span><span class="symbol">&gt;&amp;</span><span class="number">2</span>
<span class="normal">  </span><span class="keyword">exit</span><span class="normal"> </span><span class="variable">$EXIT_FAILURE</span>
<span class="keyword">fi</span>

<span class="keyword">case</span><span class="normal"> </span><span class="variable">$disable_libs</span><span class="normal"> </span><span class="keyword">in</span>
<span class="normal">no</span><span class="symbol">)</span><span class="normal"> </span>
<span class="normal">  </span><span class="symbol">;;</span>
<span class="normal">shared</span><span class="symbol">)</span>
<span class="normal">  </span><span class="variable">build_libtool_libs</span><span class="symbol">=</span><span class="normal">no</span>
<span class="normal">  </span><span class="variable">build_old_libs</span><span class="symbol">=</span><span class="normal">yes</span>
<span class="normal">  </span><span class="symbol">;;</span>
<span class="normal">static</span><span class="symbol">)</span>
<span class="normal">  </span><span class="variable">build_old_libs</span><span class="symbol">=</span><span class="normal">`</span><span class="keyword">case</span><span class="normal"> </span><span class="variable">$build_libtool_libs</span><span class="normal"> </span><span class="keyword">in</span><span class="normal"> yes</span><span class="symbol">)</span><span class="normal"> echo no</span><span class="symbol">;;</span><span class="normal"> </span><span class="symbol">*)</span><span class="normal"> echo yes</span><span class="symbol">;;</span><span class="normal"> </span><span class="keyword">esac</span><span class="normal">`</span>
<span class="normal">  </span><span class="symbol">;;</span>
<span class="keyword">esac</span>

<span class="comment"># If this variable is set in any of the actions, the command in it</span>
<span class="comment"># will be execed at the end.  This prevents here-documents from being</span>
<span class="comment"># left over by shells.</span>
<span class="variable">exec_cmd</span><span class="symbol">=</span>

<span class="keyword">if</span><span class="normal"> </span><span class="keyword">test</span><span class="normal"> -z </span><span class="string">"$show_help"</span><span class="symbol">;</span><span class="normal"> </span><span class="keyword">then</span>

<span class="normal">  </span><span class="comment"># Infer the operation mode.</span>
<span class="normal">  </span><span class="keyword">if</span><span class="normal"> </span><span class="keyword">test</span><span class="normal"> -z </span><span class="string">"$mode"</span><span class="symbol">;</span><span class="normal"> </span><span class="keyword">then</span>
<span class="normal">    </span><span class="variable">$echo</span><span class="normal"> </span><span class="string">"*** Warning: inferring the mode of operation is deprecated."</span><span class="normal"> </span><span class="number">1</span><span class="symbol">&gt;&amp;</span><span class="number">2</span>
<span class="normal">    </span><span class="variable">$echo</span><span class="normal"> </span><span class="string">"*** Future versions of Libtool will require --mode=MODE be specified."</span><span class="normal"> </span><span class="number">1</span><span class="symbol">&gt;&amp;</span><span class="number">2</span>
<span class="normal">    </span><span class="keyword">case</span><span class="normal"> </span><span class="variable">$nonopt</span><span class="normal"> </span><span class="keyword">in</span>
<span class="normal">    </span><span class="symbol">*</span><span class="normal">cc </span><span class="symbol">|</span><span class="normal"> cc</span><span class="symbol">*</span><span class="normal"> </span><span class="symbol">|</span><span class="normal"> </span><span class="symbol">*++</span><span class="normal"> </span><span class="symbol">|</span><span class="normal"> gcc</span><span class="symbol">*</span><span class="normal"> </span><span class="symbol">|</span><span class="normal"> </span><span class="symbol">*</span><span class="normal">-gcc</span><span class="symbol">*</span><span class="normal"> </span><span class="symbol">|</span><span class="normal"> g</span><span class="symbol">++*</span><span class="normal"> </span><span class="symbol">|</span><span class="normal"> xlc</span><span class="symbol">*)</span>
<span class="normal">      </span><span class="variable">mode</span><span class="symbol">=</span><span class="normal">link</span>
<span class="normal">      </span><span class="keyword">for</span><span class="normal"> arg</span>
<span class="normal">      </span><span class="keyword">do</span>
<span class="normal">	</span><span class="keyword">case</span><span class="normal"> </span><span class="variable">$arg</span><span class="normal"> </span><span class="keyword">in</span>
<span class="normal">	-c</span><span class="symbol">)</span>
<span class="normal">	   </span><span class="variable">mode</span><span class="symbol">=</span><span class="normal">compile</span>
<span class="normal">	   </span><span class="keyword">break</span>
<span class="normal">	   </span><span class="symbol">;;</span>
<span class="normal">	</span><span class="keyword">esac</span>
<span class="normal">      </span><span class="keyword">done</span>
<span class="normal">      </span><span class="symbol">;;</span>
<span class="normal">    </span><span class="symbol">*</span><span class="normal">db </span><span class="symbol">|</span><span class="normal"> </span><span class="symbol">*</span><span class="normal">dbx </span><span class="symbol">|</span><span class="normal"> </span><span class="symbol">*</span><span class="normal">strace </span><span class="symbol">|</span><span class="normal"> </span><span class="symbol">*</span><span class="normal">truss</span><span class="symbol">)</span>
<span class="normal">      </span><span class="variable">mode</span><span class="symbol">=</span><span class="normal">execute</span>
<span class="normal">      </span><span class="symbol">;;</span>
<span class="normal">    </span><span class="symbol">*</span><span class="normal">install</span><span class="symbol">*|</span><span class="normal">cp</span><span class="symbol">|</span><span class="normal">mv</span><span class="symbol">)</span>
<span class="normal">      </span><span class="variable">mode</span><span class="symbol">=</span><span class="normal">install</span>
<span class="normal">      </span><span class="symbol">;;</span>
<span class="normal">    </span><span class="symbol">*</span><span class="normal">rm</span><span class="symbol">)</span>
<span class="normal">      </span><span class="variable">mode</span><span class="symbol">=</span><span class="normal">uninstall</span>
<span class="normal">      </span><span class="symbol">;;</span>
<span class="normal">    </span><span class="symbol">*)</span>
<span class="normal">      </span><span class="comment"># If we have no mode, but dlfiles were specified, then do execute mode.</span>
<span class="normal">      </span><span class="keyword">test</span><span class="normal"> -n </span><span class="string">"$execute_dlfiles"</span><span class="normal"> </span><span class="symbol">&amp;&amp;</span><span class="normal"> </span><span class="variable">mode</span><span class="symbol">=</span><span class="normal">execute</span>

<span class="normal">      </span><span class="comment"># Just use the default operation mode.</span>
<span class="normal">      </span><span class="keyword">if</span><span class="normal"> </span><span class="keyword">test</span><span class="normal"> -z </span><span class="string">"$mode"</span><span class="symbol">;</span><span class="normal"> </span><span class="keyword">then</span>
<span class="normal">	</span><span class="keyword">if</span><span class="normal"> </span><span class="keyword">test</span><span class="normal"> -n </span><span class="string">"$nonopt"</span><span class="symbol">;</span><span class="normal"> </span><span class="keyword">then</span>
<span class="normal">	  </span><span class="variable">$echo</span><span class="normal"> </span><span class="string">"$modename: warning: cannot infer operation mode from </span><span class="specialchar">\`</span><span class="string">$nonopt'"</span><span class="normal"> </span><span class="number">1</span><span class="symbol">&gt;&amp;</span><span class="number">2</span>
<span class="normal">	</span><span class="keyword">else</span>
<span class="normal">	  </span><span class="variable">$echo</span><span class="normal"> </span><span class="string">"$modename: warning: cannot infer operation mode without MODE-ARGS"</span><span class="normal"> </span><span class="number">1</span><span class="symbol">&gt;&amp;</span><span class="number">2</span>
<span class="normal">	</span><span class="keyword">fi</span>
<span class="normal">      </span><span class="keyword">fi</span>
<span class="normal">      </span><span class="symbol">;;</span>
<span class="normal">    </span><span class="keyword">esac</span>
<span class="normal">  </span><span class="keyword">fi</span>

<span class="normal">  </span><span class="comment"># Only execute mode is allowed to have -dlopen flags.</span>
<span class="normal">  </span><span class="keyword">if</span><span class="normal"> </span><span class="keyword">test</span><span class="normal"> -n </span><span class="string">"$execute_dlfiles"</span><span class="normal"> </span><span class="symbol">&amp;&amp;</span><span class="normal"> </span><span class="keyword">test</span><span class="normal"> </span><span class="string">"$mode"</span><span class="normal"> </span><span class="symbol">!=</span><span class="normal"> execute</span><span class="symbol">;</span><span class="normal"> </span><span class="keyword">then</span>
<span class="normal">    </span><span class="variable">$echo</span><span class="normal"> </span><span class="string">"$modename: unrecognized option </span><span class="specialchar">\`</span><span class="string">-dlopen'"</span><span class="normal"> </span><span class="number">1</span><span class="symbol">&gt;&amp;</span><span class="number">2</span>
<span class="normal">    </span><span class="variable">$echo</span><span class="normal"> </span><span class="string">"$help"</span><span class="normal"> </span><span class="number">1</span><span class="symbol">&gt;&amp;</span><span class="number">2</span>
<span class="normal">    </span><span class="keyword">exit</span><span class="normal"> </span><span class="variable">$EXIT_FAILURE</span>
<span class="normal">  </span><span class="keyword">fi</span>

<span class="normal">  </span><span class="comment"># Change the help message to a mode-specific one.</span>
<span class="normal">  </span><span class="variable">generic_help</span><span class="symbol">=</span><span class="string">"$help"</span>
<span class="normal">  </span><span class="keyword">help</span><span class="symbol">=</span><span class="string">"Try </span><span class="specialchar">\`</span><span class="string">$modename --help --mode=$mode' for more information."</span>

<span class="normal">  </span><span class="comment"># These modes are in order of execution frequency so that they run quickly.</span>
<span class="normal">  </span><span class="keyword">case</span><span class="normal"> </span><span class="variable">$mode</span><span class="normal"> </span><span class="keyword">in</span>
<span class="normal">  </span><span class="comment"># libtool compile mode</span>
<span class="normal">  compile</span><span class="symbol">)</span>
<span class="normal">    </span><span class="variable">modename</span><span class="symbol">=</span><span class="string">"$modename: compile"</span>
<span class="normal">    </span><span class="comment"># Get the compilation command and the source file.</span>
<span class="normal">    </span><span class="variable">base_compile</span><span class="symbol">=</span>
<span class="normal">    </span><span class="variable">srcfile</span><span class="symbol">=</span><span class="string">"$nonopt"</span><span class="normal">  </span><span class="comment">#  always keep a non-empty value in "srcfile"</span>
<span class="normal">    </span><span class="variable">suppress_opt</span><span class="symbol">=</span><span class="normal">yes</span>
<span class="normal">    </span><span class="variable">suppress_output</span><span class="symbol">=</span>
<span class="normal">    </span><span class="variable">arg_mode</span><span class="symbol">=</span><span class="normal">normal</span>
<span class="normal">    </span><span class="variable">libobj</span><span class="symbol">=</span>
<span class="normal">    </span><span class="variable">later</span><span class="symbol">=</span>

<span class="normal">    </span><span class="keyword">for</span><span class="normal"> arg</span>
<span class="normal">    </span><span class="keyword">do</span>
<span class="normal">      </span><span class="keyword">case</span><span class="normal"> </span><span class="variable">$arg_mode</span><span class="normal"> </span><span class="keyword">in</span>
<span class="normal">      arg  </span><span class="symbol">)</span>
<span class="normal">	</span><span class="comment"># do not "continue".  Instead, add this to base_compile</span>
<span class="normal">	</span><span class="variable">lastarg</span><span class="symbol">=</span><span class="string">"$arg"</span>
<span class="normal">	</span><span class="variable">arg_mode</span><span class="symbol">=</span><span class="normal">normal</span>
<span class="normal">	</span><span class="symbol">;;</span>

<span class="normal">      target </span><span class="symbol">)</span>
<span class="normal">	</span><span class="variable">libobj</span><span class="symbol">=</span><span class="string">"$arg"</span>
<span class="normal">	</span><span class="variable">arg_mode</span><span class="symbol">=</span><span class="normal">normal</span>
<span class="normal">	</span><span class="keyword">continue</span>
<span class="normal">	</span><span class="symbol">;;</span>

<span class="normal">      normal </span><span class="symbol">)</span>
<span class="normal">	</span><span class="comment"># Accept any command-line options.</span>
<span class="normal">	</span><span class="keyword">case</span><span class="normal"> </span><span class="variable">$arg</span><span class="normal"> </span><span class="keyword">in</span>
<span class="normal">	-o</span><span class="symbol">)</span>
<span class="normal">	  </span><span class="keyword">if</span><span class="normal"> </span><span class="keyword">test</span><span class="normal"> -n </span><span class="string">"$libobj"</span><span class="normal"> </span><span class="symbol">;</span><span class="normal"> </span><span class="keyword">then</span>
<span class="normal">	    </span><span class="variable">$echo</span><span class="normal"> </span><span class="string">"$modename: you cannot specify </span><span class="specialchar">\`</span><span class="string">-o' more than once"</span><span class="normal"> </span><span class="number">1</span><span class="symbol">&gt;&amp;</span><span class="number">2</span>
<span class="normal">	    </span><span class="keyword">exit</span><span class="normal"> </span><span class="variable">$EXIT_FAILURE</span>
<span class="normal">	  </span><span class="keyword">fi</span>
<span class="normal">	  </span><span class="variable">arg_mode</span><span class="symbol">=</span><span class="normal">target</span>
<span class="normal">	  </span><span class="keyword">continue</span>
<span class="normal">	  </span><span class="symbol">;;</span>

<span class="normal">	-static </span><span class="symbol">|</span><span class="normal"> -prefer-pic </span><span class="symbol">|</span><span class="normal"> -prefer-non-pic</span><span class="symbol">)</span>
<span class="normal">	  </span><span class="variable">later</span><span class="symbol">=</span><span class="string">"$later $arg"</span>
<span class="normal">	  </span><span class="keyword">continue</span>
<span class="normal">	  </span><span class="symbol">;;</span>

<span class="normal">	-no-suppress</span><span class="symbol">)</span>
<span class="normal">	  </span><span class="variable">suppress_opt</span><span class="symbol">=</span><span class="normal">no</span>
<span class="normal">	  </span><span class="keyword">continue</span>
<span class="normal">	  </span><span class="symbol">;;</span>

<span class="normal">	-Xcompiler</span><span class="symbol">)</span>
<span class="normal">	  </span><span class="variable">arg_mode</span><span class="symbol">=</span><span class="normal">arg  </span><span class="comment">#  the next one goes into the "base_compile" arg list</span>
<span class="normal">	  </span><span class="keyword">continue</span><span class="normal">      </span><span class="comment">#  The current "srcfile" will either be retained or</span>
<span class="normal">	  </span><span class="symbol">;;</span><span class="normal">            </span><span class="comment">#  replaced later.  I would guess that would be a bug.</span>

<span class="normal">	-Wc</span><span class="symbol">,*)</span>
<span class="normal">	  </span><span class="variable">args</span><span class="symbol">=</span><span class="normal">`</span><span class="variable">$echo</span><span class="normal"> </span><span class="string">"X$arg"</span><span class="normal"> </span><span class="symbol">|</span><span class="normal"> </span><span class="variable">$Xsed</span><span class="normal"> -e </span><span class="string">"s/^-Wc,//"</span><span class="normal">`</span>
<span class="normal">	  </span><span class="variable">lastarg</span><span class="symbol">=</span>
<span class="normal">	  </span><span class="variable">save_ifs</span><span class="symbol">=</span><span class="string">"$IFS"</span><span class="symbol">;</span><span class="normal"> </span><span class="variable">IFS</span><span class="symbol">=</span><span class="string">','</span>
<span class="normal"> 	  </span><span class="keyword">for</span><span class="normal"> arg </span><span class="keyword">in</span><span class="normal"> </span><span class="variable">$args</span><span class="symbol">;</span><span class="normal"> </span><span class="keyword">do</span>
<span class="normal">	    </span><span class="variable">IFS</span><span class="symbol">=</span><span class="string">"$save_ifs"</span>

<span class="normal">	    </span><span class="comment"># Double-quote args containing other shell metacharacters.</span>
<span class="normal">	    </span><span class="comment"># Many Bourne shells cannot handle close brackets correctly</span>
<span class="normal">	    </span><span class="comment"># in scan sets, so we specify it separately.</span>
<span class="normal">	    </span><span class="keyword">case</span><span class="normal"> </span><span class="variable">$arg</span><span class="normal"> </span><span class="keyword">in</span>
<span class="normal">	      </span><span class="symbol">*[\[\~\</span><span class="comment">#\^\&amp;\*\(\)\{\}\|\;\&lt;\&gt;\?\'\ \	]*|*]*|"")</span>
<span class="normal">	      </span><span class="variable">arg</span><span class="symbol">=</span><span class="string">"</span><span class="specialchar">\"</span><span class="string">$arg</span><span class="specialchar">\"</span><span class="string">"</span>
<span class="normal">	      </span><span class="symbol">;;</span>
<span class="normal">	    </span><span class="keyword">esac</span>
<span class="normal">	    </span><span class="variable">lastarg</span><span class="symbol">=</span><span class="string">"$lastarg $arg"</span>
<span class="normal">	  </span><span class="keyword">done</span>
<span class="normal">	  </span><span class="variable">IFS</span><span class="symbol">=</span><span class="string">"$save_ifs"</span>
<span class="normal">	  </span><span class="variable">lastarg</span><span class="symbol">=</span><span class="normal">`</span><span class="variable">$echo</span><span class="normal"> </span><span class="string">"X$lastarg"</span><span class="normal"> </span><span class="symbol">|</span><span class="normal"> </span><span class="variable">$Xsed</span><span class="normal"> -e </span><span class="string">"s/^ //"</span><span class="normal">`</span>

<span class="normal">	  </span><span class="comment"># Add the arguments to base_compile.</span>
<span class="normal">	  </span><span class="variable">base_compile</span><span class="symbol">=</span><span class="string">"$base_compile $lastarg"</span>
<span class="normal">	  </span><span class="keyword">continue</span>
<span class="normal">	  </span><span class="symbol">;;</span>

<span class="normal">	</span><span class="symbol">*</span><span class="normal"> </span><span class="symbol">)</span>
<span class="normal">	  </span><span class="comment"># Accept the current argument as the source file.</span>
<span class="normal">	  </span><span class="comment"># The previous "srcfile" becomes the current argument.</span>
<span class="normal">	  </span><span class="comment">#</span>
<span class="normal">	  </span><span class="variable">lastarg</span><span class="symbol">=</span><span class="string">"$srcfile"</span>
<span class="normal">	  </span><span class="variable">srcfile</span><span class="symbol">=</span><span class="string">"$arg"</span>
<span class="normal">	  </span><span class="symbol">;;</span>
<span class="normal">	</span><span class="keyword">esac</span><span class="normal">  </span><span class="comment">#  case $arg</span>
<span class="normal">	</span><span class="symbol">;;</span>
<span class="normal">      </span><span class="keyword">esac</span><span class="normal">    </span><span class="comment">#  case $arg_mode</span>

<span class="normal">      </span><span class="comment"># Aesthetically quote the previous argument.</span>
<span class="normal">      </span><span class="variable">lastarg</span><span class="symbol">=</span><span class="normal">`</span><span class="variable">$echo</span><span class="normal"> </span><span class="string">"X$lastarg"</span><span class="normal"> </span><span class="symbol">|</span><span class="normal"> </span><span class="variable">$Xsed</span><span class="normal"> -e </span><span class="string">"$sed_quote_subst"</span><span class="normal">`</span>

<span class="normal">      </span><span class="keyword">case</span><span class="normal"> </span><span class="variable">$lastarg</span><span class="normal"> </span><span class="keyword">in</span>
<span class="normal">      </span><span class="comment"># Double-quote args containing other shell metacharacters.</span>
<span class="normal">      </span><span class="comment"># Many Bourne shells cannot handle close brackets correctly</span>
<span class="normal">      </span><span class="comment"># in scan sets, and some SunOS ksh mistreat backslash-escaping</span>
<span class="normal">      </span><span class="comment"># in scan sets (worked around with variable expansion),</span>
<span class="normal">      </span><span class="comment"># and furthermore cannot handle '|' '&amp;' '(' ')' in scan sets </span>
<span class="normal">      </span><span class="comment"># at all, so we specify them separately.</span>
<span class="normal">      </span><span class="symbol">*[\[\~\</span><span class="comment">#\^\&amp;\*\(\)\{\}\|\;\&lt;\&gt;\?\'\ \	]*|*]*|"")</span>
<span class="normal">	</span><span class="variable">lastarg</span><span class="symbol">=</span><span class="string">"</span><span class="specialchar">\"</span><span class="string">$lastarg</span><span class="specialchar">\"</span><span class="string">"</span>
<span class="normal">	</span><span class="symbol">;;</span>
<span class="normal">      </span><span class="keyword">esac</span>

<span class="normal">      </span><span class="variable">base_compile</span><span class="symbol">=</span><span class="string">"$base_compile $lastarg"</span>
<span class="normal">    </span><span class="keyword">done</span><span class="normal"> </span><span class="comment"># for arg</span>

<span class="normal">    </span><span class="keyword">case</span><span class="normal"> </span><span class="variable">$arg_mode</span><span class="normal"> </span><span class="keyword">in</span>
<span class="normal">    arg</span><span class="symbol">)</span>
<span class="normal">      </span><span class="variable">$echo</span><span class="normal"> </span><span class="string">"$modename: you must specify an argument for -Xcompile"</span>
<span class="normal">      </span><span class="keyword">exit</span><span class="normal"> </span><span class="variable">$EXIT_FAILURE</span>
<span class="normal">      </span><span class="symbol">;;</span>
<span class="normal">    target</span><span class="symbol">)</span>
<span class="normal">      </span><span class="variable">$echo</span><span class="normal"> </span><span class="string">"$modename: you must specify a target with </span><span class="specialchar">\`</span><span class="string">-o'"</span><span class="normal"> </span><span class="number">1</span><span class="symbol">&gt;&amp;</span><span class="number">2</span>
<span class="normal">      </span><span class="keyword">exit</span><span class="normal"> </span><span class="variable">$EXIT_FAILURE</span>
<span class="normal">      </span><span class="symbol">;;</span>
<span class="normal">    </span><span class="symbol">*)</span>
<span class="normal">      </span><span class="comment"># Get the name of the library object.</span>
<span class="normal">      </span><span class="symbol">[</span><span class="normal"> -z </span><span class="string">"$libobj"</span><span class="normal"> </span><span class="symbol">]</span><span class="normal"> </span><span class="symbol">&amp;&amp;</span><span class="normal"> </span><span class="variable">libobj</span><span class="symbol">=</span><span class="normal">`</span><span class="variable">$echo</span><span class="normal"> </span><span class="string">"X$srcfile"</span><span class="normal"> </span><span class="symbol">|</span><span class="normal"> </span><span class="variable">$Xsed</span><span class="normal"> -e </span><span class="string">'s%^.*/%%'</span><span class="normal">`</span>
<span class="normal">      </span><span class="symbol">;;</span>
<span class="normal">    </span><span class="keyword">esac</span>

<span class="normal">    </span><span class="comment"># Recognize several different file suffixes.</span>
<span class="normal">    </span><span class="comment"># If the user specifies -o file.o, it is replaced with file.lo</span>
<span class="normal">    </span><span class="variable">xform</span><span class="symbol">=</span><span class="string">'[cCFSifmso]'</span>
<span class="normal">    </span><span class="keyword">case</span><span class="normal"> </span><span class="variable">$libobj</span><span class="normal"> </span><span class="keyword">in</span>
<span class="normal">    </span><span class="symbol">*.</span><span class="normal">ada</span><span class="symbol">)</span><span class="normal"> </span><span class="variable">xform</span><span class="symbol">=</span><span class="normal">ada </span><span class="symbol">;;</span>
<span class="normal">    </span><span class="symbol">*.</span><span class="normal">adb</span><span class="symbol">)</span><span class="normal"> </span><span class="variable">xform</span><span class="symbol">=</span><span class="normal">adb </span><span class="symbol">;;</span>
<span class="normal">    </span><span class="symbol">*.</span><span class="normal">ads</span><span class="symbol">)</span><span class="normal"> </span><span class="variable">xform</span><span class="symbol">=</span><span class="normal">ads </span><span class="symbol">;;</span>
<span class="normal">    </span><span class="symbol">*.</span><span class="normal">asm</span><span class="symbol">)</span><span class="normal"> </span><span class="variable">xform</span><span class="symbol">=</span><span class="normal">asm </span><span class="symbol">;;</span>
<span class="normal">    </span><span class="symbol">*.</span><span class="normal">c</span><span class="symbol">++)</span><span class="normal"> </span><span class="variable">xform</span><span class="symbol">=</span><span class="normal">c</span><span class="symbol">++</span><span class="normal"> </span><span class="symbol">;;</span>
<span class="normal">    </span><span class="symbol">*.</span><span class="normal">cc</span><span class="symbol">)</span><span class="normal"> </span><span class="variable">xform</span><span class="symbol">=</span><span class="normal">cc </span><span class="symbol">;;</span>
<span class="normal">    </span><span class="symbol">*.</span><span class="normal">ii</span><span class="symbol">)</span><span class="normal"> </span><span class="variable">xform</span><span class="symbol">=</span><span class="normal">ii </span><span class="symbol">;;</span>
<span class="normal">    </span><span class="symbol">*.</span><span class="normal">class</span><span class="symbol">)</span><span class="normal"> </span><span class="variable">xform</span><span class="symbol">=</span><span class="normal">class </span><span class="symbol">;;</span>
<span class="normal">    </span><span class="symbol">*.</span><span class="normal">cpp</span><span class="symbol">)</span><span class="normal"> </span><span class="variable">xform</span><span class="symbol">=</span><span class="normal">cpp </span><span class="symbol">;;</span>
<span class="normal">    </span><span class="symbol">*.</span><span class="normal">cxx</span><span class="symbol">)</span><span class="normal"> </span><span class="variable">xform</span><span class="symbol">=</span><span class="normal">cxx </span><span class="symbol">;;</span>
<span class="normal">    </span><span class="symbol">*.[</span><span class="normal">fF</span><span class="symbol">][</span><span class="number">09</span><span class="symbol">]?)</span><span class="normal"> </span><span class="variable">xform</span><span class="symbol">=[</span><span class="normal">fF</span><span class="symbol">][</span><span class="number">09</span><span class="symbol">].</span><span class="normal"> </span><span class="symbol">;;</span>
<span class="normal">    </span><span class="symbol">*.</span><span class="keyword">for</span><span class="symbol">)</span><span class="normal"> </span><span class="variable">xform</span><span class="symbol">=</span><span class="keyword">for</span><span class="normal"> </span><span class="symbol">;;</span>
<span class="normal">    </span><span class="symbol">*.</span><span class="normal">java</span><span class="symbol">)</span><span class="normal"> </span><span class="variable">xform</span><span class="symbol">=</span><span class="normal">java </span><span class="symbol">;;</span>
<span class="normal">    </span><span class="symbol">*.</span><span class="normal">obj</span><span class="symbol">)</span><span class="normal"> </span><span class="variable">xform</span><span class="symbol">=</span><span class="normal">obj </span><span class="symbol">;;</span>
<span class="normal">    </span><span class="keyword">esac</span>

<span class="normal">    </span><span class="variable">libobj</span><span class="symbol">=</span><span class="normal">`</span><span class="variable">$echo</span><span class="normal"> </span><span class="string">"X$libobj"</span><span class="normal"> </span><span class="symbol">|</span><span class="normal"> </span><span class="variable">$Xsed</span><span class="normal"> -e </span><span class="string">"s/</span><span class="specialchar">\.</span><span class="string">$xform$/.lo/"</span><span class="normal">`</span>

<span class="normal">    </span><span class="keyword">case</span><span class="normal"> </span><span class="variable">$libobj</span><span class="normal"> </span><span class="keyword">in</span>
<span class="normal">    </span><span class="symbol">*.</span><span class="normal">lo</span><span class="symbol">)</span><span class="normal"> </span><span class="variable">obj</span><span class="symbol">=</span><span class="normal">`</span><span class="variable">$echo</span><span class="normal"> </span><span class="string">"X$libobj"</span><span class="normal"> </span><span class="symbol">|</span><span class="normal"> </span><span class="variable">$Xsed</span><span class="normal"> -e </span><span class="string">"$lo2o"</span><span class="normal">` </span><span class="symbol">;;</span>
<span class="normal">    </span><span class="symbol">*)</span>
<span class="normal">      </span><span class="variable">$echo</span><span class="normal"> </span><span class="string">"$modename: cannot determine name of library object from </span><span class="specialchar">\`</span><span class="string">$libobj'"</span><span class="normal"> </span><span class="number">1</span><span class="symbol">&gt;&amp;</span><span class="number">2</span>
<span class="normal">      </span><span class="keyword">exit</span><span class="normal"> </span><span class="variable">$EXIT_FAILURE</span>
<span class="normal">      </span><span class="symbol">;;</span>
<span class="normal">    </span><span class="keyword">esac</span>

<span class="normal">    func_infer_tag </span><span class="variable">$base_compile</span>

<span class="normal">    </span><span class="keyword">for</span><span class="normal"> arg </span><span class="keyword">in</span><span class="normal"> </span><span class="variable">$later</span><span class="symbol">;</span><span class="normal"> </span><span class="keyword">do</span>
<span class="normal">      </span><span class="keyword">case</span><span class="normal"> </span><span class="variable">$arg</span><span class="normal"> </span><span class="keyword">in</span>
<span class="normal">      -static</span><span class="symbol">)</span>
<span class="normal">	</span><span class="variable">build_old_libs</span><span class="symbol">=</span><span class="normal">yes</span>
<span class="normal">	</span><span class="keyword">continue</span>
<span class="normal">	</span><span class="symbol">;;</span>

<span class="normal">      -prefer-pic</span><span class="symbol">)</span>
<span class="normal">	</span><span class="variable">pic_mode</span><span class="symbol">=</span><span class="normal">yes</span>
<span class="normal">	</span><span class="keyword">continue</span>
<span class="normal">	</span><span class="symbol">;;</span>

<span class="normal">      -prefer-non-pic</span><span class="symbol">)</span>
<span class="normal">	</span><span class="variable">pic_mode</span><span class="symbol">=</span><span class="normal">no</span>
<span class="normal">	</span><span class="keyword">continue</span>
<span class="normal">	</span><span class="symbol">;;</span>
<span class="normal">      </span><span class="keyword">esac</span>
<span class="normal">    </span><span class="keyword">done</span>

<span class="normal">    </span><span class="variable">qlibobj</span><span class="symbol">=</span><span class="normal">`</span><span class="variable">$echo</span><span class="normal"> </span><span class="string">"X$libobj"</span><span class="normal"> </span><span class="symbol">|</span><span class="normal"> </span><span class="variable">$Xsed</span><span class="normal"> -e </span><span class="string">"$sed_quote_subst"</span><span class="normal">`</span>
<span class="normal">    </span><span class="keyword">case</span><span class="normal"> </span><span class="variable">$qlibobj</span><span class="normal"> </span><span class="keyword">in</span>
<span class="normal">      </span><span class="symbol">*[\[\~\</span><span class="comment">#\^\&amp;\*\(\)\{\}\|\;\&lt;\&gt;\?\'\ \	]*|*]*|"")</span>
<span class="normal">	</span><span class="variable">qlibobj</span><span class="symbol">=</span><span class="string">"</span><span class="specialchar">\"</span><span class="string">$qlibobj</span><span class="specialchar">\"</span><span class="string">"</span><span class="normal"> </span><span class="symbol">;;</span>
<span class="normal">    </span><span class="keyword">esac</span>
<span class="normal">    </span><span class="keyword">test</span><span class="normal"> </span><span class="string">"X$libobj"</span><span class="normal"> </span><span class="symbol">!=</span><span class="normal"> </span><span class="string">"X$qlibobj"</span><span class="normal"> </span><span class="symbol">\</span>
<span class="normal">	</span><span class="symbol">&amp;&amp;</span><span class="normal"> </span><span class="variable">$echo</span><span class="normal"> </span><span class="string">"X$libobj"</span><span class="normal"> </span><span class="symbol">|</span><span class="normal"> grep </span><span class="string">'[]~#^*{};&lt;&gt;?"'"'"' 	&amp;()|`$[]'</span><span class="normal"> </span><span class="symbol">\</span>
<span class="normal">	</span><span class="symbol">&amp;&amp;</span><span class="normal"> </span><span class="variable">$echo</span><span class="normal"> </span><span class="string">"$modename: libobj name </span><span class="specialchar">\`</span><span class="string">$libobj' may not contain shell special characters."</span>
<span class="normal">    </span><span class="variable">objname</span><span class="symbol">=</span><span class="normal">`</span><span class="variable">$echo</span><span class="normal"> </span><span class="string">"X$obj"</span><span class="normal"> </span><span class="symbol">|</span><span class="normal"> </span><span class="variable">$Xsed</span><span class="normal"> -e </span><span class="string">'s%^.*/%%'</span><span class="normal">`</span>
<span class="normal">    </span><span class="variable">xdir</span><span class="symbol">=</span><span class="normal">`</span><span class="variable">$echo</span><span class="normal"> </span><span class="string">"X$obj"</span><span class="normal"> </span><span class="symbol">|</span><span class="normal"> </span><span class="variable">$Xsed</span><span class="normal"> -e </span><span class="string">'s%/[^/]*$%%'</span><span class="normal">`</span>
<span class="normal">    </span><span class="keyword">if</span><span class="normal"> </span><span class="keyword">test</span><span class="normal"> </span><span class="string">"X$xdir"</span><span class="normal"> </span><span class="symbol">=</span><span class="normal"> </span><span class="string">"X$obj"</span><span class="symbol">;</span><span class="normal"> </span><span class="keyword">then</span>
<span class="normal">      </span><span class="variable">xdir</span><span class="symbol">=</span>
<span class="normal">    </span><span class="keyword">else</span>
<span class="normal">      </span><span class="variable">xdir</span><span class="symbol">=</span><span class="variable">$xdir</span><span class="symbol">/</span>
<span class="normal">    </span><span class="keyword">fi</span>
<span class="normal">    </span><span class="variable">lobj</span><span class="symbol">=</span><span class="variable">${xdir}$objdir</span><span class="symbol">/</span><span class="variable">$objname</span>

<span class="normal">    </span><span class="keyword">if</span><span class="normal"> </span><span class="keyword">test</span><span class="normal"> -z </span><span class="string">"$base_compile"</span><span class="symbol">;</span><span class="normal"> </span><span class="keyword">then</span>
<span class="normal">      </span><span class="variable">$echo</span><span class="normal"> </span><span class="string">"$modename: you must specify a compilation command"</span><span class="normal"> </span><span class="number">1</span><span class="symbol">&gt;&amp;</span><span class="number">2</span>
<span class="normal">      </span><span class="variable">$echo</span><span class="normal"> </span><span class="string">"$help"</span><span class="normal"> </span><span class="number">1</span><span class="symbol">&gt;&amp;</span><span class="number">2</span>
<span class="normal">      </span><span class="keyword">exit</span><span class="normal"> </span><span class="variable">$EXIT_FAILURE</span>
<span class="normal">    </span><span class="keyword">fi</span>

<span class="normal">    </span><span class="comment"># Delete any leftover library objects.</span>
<span class="normal">    </span><span class="keyword">if</span><span class="normal"> </span><span class="keyword">test</span><span class="normal"> </span><span class="string">"$build_old_libs"</span><span class="normal"> </span><span class="symbol">=</span><span class="normal"> yes</span><span class="symbol">;</span><span class="normal"> </span><span class="keyword">then</span>
<span class="normal">      </span><span class="variable">removelist</span><span class="symbol">=</span><span class="string">"$obj $lobj $libobj ${libobj}T"</span>
<span class="normal">    </span><span class="keyword">else</span>
<span class="normal">      </span><span class="variable">removelist</span><span class="symbol">=</span><span class="string">"$lobj $libobj ${libobj}T"</span>
<span class="normal">    </span><span class="keyword">fi</span>

<span class="normal">    </span><span class="variable">$run</span><span class="normal"> </span><span class="variable">$rm</span><span class="normal"> </span><span class="variable">$removelist</span>
<span class="normal">    </span><span class="keyword">trap</span><span class="normal"> </span><span class="string">"$run $rm $removelist; exit $EXIT_FAILURE"</span><span class="normal"> </span><span class="number">1</span><span class="normal"> </span><span class="number">2</span><span class="normal"> </span><span class="number">15</span>

<span class="normal">    </span><span class="comment"># On Cygwin there's no "real" PIC flag so we must build both object types</span>
<span class="normal">    </span><span class="keyword">case</span><span class="normal"> </span><span class="variable">$host_os</span><span class="normal"> </span><span class="keyword">in</span>
<span class="normal">    cygwin</span><span class="symbol">*</span><span class="normal"> </span><span class="symbol">|</span><span class="normal"> mingw</span><span class="symbol">*</span><span class="normal"> </span><span class="symbol">|</span><span class="normal"> pw32</span><span class="symbol">*</span><span class="normal"> </span><span class="symbol">|</span><span class="normal"> os2</span><span class="symbol">*)</span>
<span class="normal">      </span><span class="variable">pic_mode</span><span class="symbol">=</span><span class="normal">default</span>
<span class="normal">      </span><span class="symbol">;;</span>
<span class="normal">    </span><span class="keyword">esac</span>
<span class="normal">    </span><span class="keyword">if</span><span class="normal"> </span><span class="keyword">test</span><span class="normal"> </span><span class="string">"$pic_mode"</span><span class="normal"> </span><span class="symbol">=</span><span class="normal"> no </span><span class="symbol">&amp;&amp;</span><span class="normal"> </span><span class="keyword">test</span><span class="normal"> </span><span class="string">"$deplibs_check_method"</span><span class="normal"> </span><span class="symbol">!=</span><span class="normal"> pass_all</span><span class="symbol">;</span><span class="normal"> </span><span class="keyword">then</span>
<span class="normal">      </span><span class="comment"># non-PIC code in shared libraries is not supported</span>
<span class="normal">      </span><span class="variable">pic_mode</span><span class="symbol">=</span><span class="normal">default</span>
<span class="normal">    </span><span class="keyword">fi</span>

<span class="normal">    </span><span class="comment"># Calculate the filename of the output object if compiler does</span>
<span class="normal">    </span><span class="comment"># not support -o with -c</span>
<span class="normal">    </span><span class="keyword">if</span><span class="normal"> </span><span class="keyword">test</span><span class="normal"> </span><span class="string">"$compiler_c_o"</span><span class="normal"> </span><span class="symbol">=</span><span class="normal"> no</span><span class="symbol">;</span><span class="normal"> </span><span class="keyword">then</span>
<span class="normal">      </span><span class="variable">output_obj</span><span class="symbol">=</span><span class="normal">`</span><span class="variable">$echo</span><span class="normal"> </span><span class="string">"X$srcfile"</span><span class="normal"> </span><span class="symbol">|</span><span class="normal"> </span><span class="variable">$Xsed</span><span class="normal"> -e </span><span class="string">'s%^.*/%%'</span><span class="normal"> -e </span><span class="string">'s%</span><span class="specialchar">\.</span><span class="string">[^.]*$%%'</span><span class="normal">`</span><span class="symbol">.</span><span class="variable">${objext}</span>
<span class="normal">      </span><span class="variable">lockfile</span><span class="symbol">=</span><span class="string">"$output_obj.lock"</span>
<span class="normal">      </span><span class="variable">removelist</span><span class="symbol">=</span><span class="string">"$removelist $output_obj $lockfile"</span>
<span class="normal">      </span><span class="keyword">trap</span><span class="normal"> </span><span class="string">"$run $rm $removelist; exit $EXIT_FAILURE"</span><span class="normal"> </span><span class="number">1</span><span class="normal"> </span><span class="number">2</span><span class="normal"> </span><span class="number">15</span>
<span class="normal">    </span><span class="keyword">else</span>
<span class="normal">      </span><span class="variable">output_obj</span><span class="symbol">=</span>
<span class="normal">      </span><span class="variable">need_locks</span><span class="symbol">=</span><span class="normal">no</span>
<span class="normal">      </span><span class="variable">lockfile</span><span class="symbol">=</span>
<span class="normal">    </span><span class="keyword">fi</span>

<span class="normal">    </span><span class="comment"># Lock this critical section if it is needed</span>
<span class="normal">    </span><span class="comment"># We use this script file to make the link, it avoids creating a new file</span>
<span class="normal">    </span><span class="keyword">if</span><span class="normal"> </span><span class="keyword">test</span><span class="normal"> </span><span class="string">"$need_locks"</span><span class="normal"> </span><span class="symbol">=</span><span class="normal"> yes</span><span class="symbol">;</span><span class="normal"> </span><span class="keyword">then</span>
<span class="normal">      </span><span class="keyword">until</span><span class="normal"> </span><span class="variable">$run</span><span class="normal"> ln </span><span class="string">"$srcfile"</span><span class="normal"> </span><span class="string">"$lockfile"</span><span class="normal"> </span><span class="number">2</span><span class="symbol">&gt;</span><span class="normal">/dev/null</span><span class="symbol">;</span><span class="normal"> </span><span class="keyword">do</span>
<span class="normal">	</span><span class="variable">$show</span><span class="normal"> </span><span class="string">"Waiting for $lockfile to be removed"</span>
<span class="normal">	sleep </span><span class="number">2</span>
<span class="normal">      </span><span class="keyword">done</span>
<span class="normal">    </span><span class="keyword">elif</span><span class="normal"> </span><span class="keyword">test</span><span class="normal"> </span><span class="string">"$need_locks"</span><span class="normal"> </span><span class="symbol">=</span><span class="normal"> warn</span><span class="symbol">;</span><span class="normal"> </span><span class="keyword">then</span>
<span class="normal">      </span><span class="keyword">if</span><span class="normal"> </span><span class="keyword">test</span><span class="normal"> -f </span><span class="string">"$lockfile"</span><span class="symbol">;</span><span class="normal"> </span><span class="keyword">then</span>
<span class="normal">	</span><span class="variable">$echo</span><span class="normal"> </span><span class="string">"\</span>
<span class="string">*** ERROR, $lockfile exists and contains:</span>
<span class="string">`cat $lockfile 2&gt;/dev/null`</span>

<span class="string">This indicates that another process is trying to use the same</span>
<span class="string">temporary object file, and libtool could not work around it because</span>
<span class="string">your compiler does not support </span><span class="specialchar">\`</span><span class="string">-c' and </span><span class="specialchar">\`</span><span class="string">-o' together.  If you</span>
<span class="string">repeat this compilation, it may succeed, by chance, but you had better</span>
<span class="string">avoid parallel builds (make -j) in this platform, or get a better</span>
<span class="string">compiler."</span>

<span class="normal">	</span><span class="variable">$run</span><span class="normal"> </span><span class="variable">$rm</span><span class="normal"> </span><span class="variable">$removelist</span>
<span class="normal">	</span><span class="keyword">exit</span><span class="normal"> </span><span class="variable">$EXIT_FAILURE</span>
<span class="normal">      </span><span class="keyword">fi</span>
<span class="normal">      </span><span class="variable">$echo</span><span class="normal"> </span><span class="string">"$srcfile"</span><span class="normal"> </span><span class="symbol">&gt;</span><span class="normal"> </span><span class="string">"$lockfile"</span>
<span class="normal">    </span><span class="keyword">fi</span>

<span class="normal">    </span><span class="keyword">if</span><span class="normal"> </span><span class="keyword">test</span><span class="normal"> -n </span><span class="string">"$fix_srcfile_path"</span><span class="symbol">;</span><span class="normal"> </span><span class="keyword">then</span>
<span class="normal">      </span><span class="keyword">eval</span><span class="normal"> </span><span class="variable">srcfile</span><span class="symbol">=</span><span class="normal">\"</span><span class="variable">$fix_srcfile_path</span><span class="normal">\"</span>
<span class="normal">    </span><span class="keyword">fi</span>
<span class="normal">    </span><span class="variable">qsrcfile</span><span class="symbol">=</span><span class="normal">`</span><span class="variable">$echo</span><span class="normal"> </span><span class="string">"X$srcfile"</span><span class="normal"> </span><span class="symbol">|</span><span class="normal"> </span><span class="variable">$Xsed</span><span class="normal"> -e </span><span class="string">"$sed_quote_subst"</span><span class="normal">`</span>
<span class="normal">    </span><span class="keyword">case</span><span class="normal"> </span><span class="variable">$qsrcfile</span><span class="normal"> </span><span class="keyword">in</span>
<span class="normal">      </span><span class="symbol">*[\[\~\</span><span class="comment">#\^\&amp;\*\(\)\{\}\|\;\&lt;\&gt;\?\'\ \	]*|*]*|"")</span>
<span class="normal">      </span><span class="variable">qsrcfile</span><span class="symbol">=</span><span class="string">"</span><span class="specialchar">\"</span><span class="string">$qsrcfile</span><span class="specialchar">\"</span><span class="string">"</span><span class="normal"> </span><span class="symbol">;;</span>
<span class="normal">    </span><span class="keyword">esac</span>

<span class="normal">    </span><span class="variable">$run</span><span class="normal"> </span><span class="variable">$rm</span><span class="normal"> </span><span class="string">"$libobj"</span><span class="normal"> </span><span class="string">"${libobj}T"</span>

<span class="normal">    </span><span class="comment"># Create a libtool object file (analogous to a ".la" file),</span>
<span class="normal">    </span><span class="comment"># but don't create it if we're doing a dry run.</span>
<span class="normal">    </span><span class="keyword">test</span><span class="normal"> -z </span><span class="string">"$run"</span><span class="normal"> </span><span class="symbol">&amp;&amp;</span><span class="normal"> cat </span><span class="symbol">&gt;</span><span class="normal"> </span><span class="variable">${libobj}</span><span class="normal">T </span><span class="symbol">&lt;&lt;</span><span class="normal">EOF</span>
<span class="comment"># $libobj - a libtool object file</span>
<span class="comment"># Generated by $PROGRAM - GNU $PACKAGE $VERSION$TIMESTAMP</span>
<span class="comment">#</span>
<span class="comment"># Please DO NOT delete this file!</span>
<span class="comment"># It is necessary for linking the library.</span>

<span class="comment"># Name of the PIC object.</span>
<span class="normal">EOF</span>

<span class="normal">    </span><span class="comment"># Only build a PIC object if we are building libtool libraries.</span>
<span class="normal">    </span><span class="keyword">if</span><span class="normal"> </span><span class="keyword">test</span><span class="normal"> </span><span class="string">"$build_libtool_libs"</span><span class="normal"> </span><span class="symbol">=</span><span class="normal"> yes</span><span class="symbol">;</span><span class="normal"> </span><span class="keyword">then</span>
<span class="normal">      </span><span class="comment"># Without this assignment, base_compile gets emptied.</span>
<span class="normal">      </span><span class="variable">fbsd_hideous_sh_bug</span><span class="symbol">=</span><span class="variable">$base_compile</span>

<span class="normal">      </span><span class="keyword">if</span><span class="normal"> </span><span class="keyword">test</span><span class="normal"> </span><span class="string">"$pic_mode"</span><span class="normal"> </span><span class="symbol">!=</span><span class="normal"> no</span><span class="symbol">;</span><span class="normal"> </span><span class="keyword">then</span>
<span class="normal">	</span><span class="keyword">command</span><span class="symbol">=</span><span class="string">"$base_compile $qsrcfile $pic_flag"</span>
<span class="normal">      </span><span class="keyword">else</span>
<span class="normal">	</span><span class="comment"># Don't build PIC code</span>
<span class="normal">	</span><span class="keyword">command</span><span class="symbol">=</span><span class="string">"$base_compile $qsrcfile"</span>
<span class="normal">      </span><span class="keyword">fi</span>

<span class="normal">      </span><span class="keyword">if</span><span class="normal"> </span><span class="keyword">test</span><span class="normal"> </span><span class="symbol">!</span><span class="normal"> -d </span><span class="string">"${xdir}$objdir"</span><span class="symbol">;</span><span class="normal"> </span><span class="keyword">then</span>
<span class="normal">	</span><span class="variable">$show</span><span class="normal"> </span><span class="string">"$mkdir ${xdir}$objdir"</span>
<span class="normal">	</span><span class="variable">$run</span><span class="normal"> </span><span class="variable">$mkdir</span><span class="normal"> </span><span class="variable">${xdir}$objdir</span>
<span class="normal">	</span><span class="variable">exit_status</span><span class="symbol">=</span><span class="variable">$?</span>
<span class="normal">	</span><span class="keyword">if</span><span class="normal"> </span><span class="keyword">test</span><span class="normal"> </span><span class="string">"$exit_status"</span><span class="normal"> -ne </span><span class="number">0</span><span class="normal"> </span><span class="symbol">&amp;&amp;</span><span class="normal"> </span><span class="keyword">test</span><span class="normal"> </span><span class="symbol">!</span><span class="normal"> -d </span><span class="string">"${xdir}$objdir"</span><span class="symbol">;</span><span class="normal"> </span><span class="keyword">then</span>
<span class="normal">	  </span><span class="keyword">exit</span><span class="normal"> </span><span class="variable">$exit_status</span>
<span class="normal">	</span><span class="keyword">fi</span>
<span class="normal">      </span><span class="keyword">fi</span>

<span class="normal">      </span><span class="keyword">if</span><span class="normal"> </span><span class="keyword">test</span><span class="normal"> -z </span><span class="string">"$output_obj"</span><span class="symbol">;</span><span class="normal"> </span><span class="keyword">then</span>
<span class="normal">	</span><span class="comment"># Place PIC objects in $objdir</span>
<span class="normal">	</span><span class="keyword">command</span><span class="symbol">=</span><span class="string">"$command -o $lobj"</span>
<span class="normal">      </span><span class="keyword">fi</span>

<span class="normal">      </span><span class="variable">$run</span><span class="normal"> </span><span class="variable">$rm</span><span class="normal"> </span><span class="string">"$lobj"</span><span class="normal"> </span><span class="string">"$output_obj"</span>

<span class="normal">      </span><span class="variable">$show</span><span class="normal"> </span><span class="string">"$command"</span>
<span class="normal">      </span><span class="keyword">if</span><span class="normal"> </span><span class="variable">$run</span><span class="normal"> </span><span class="keyword">eval</span><span class="normal"> </span><span class="string">"$command"</span><span class="symbol">;</span><span class="normal"> </span><span class="keyword">then</span><span class="normal"> </span><span class="symbol">:</span>
<span class="normal">      </span><span class="keyword">else</span>
<span class="normal">	</span><span class="keyword">test</span><span class="normal"> -n </span><span class="string">"$output_obj"</span><span class="normal"> </span><span class="symbol">&amp;&amp;</span><span class="normal"> </span><span class="variable">$run</span><span class="normal"> </span><span class="variable">$rm</span><span class="normal"> </span><span class="variable">$removelist</span>
<span class="normal">	</span><span class="keyword">exit</span><span class="normal"> </span><span class="variable">$EXIT_FAILURE</span>
<span class="normal">      </span><span class="keyword">fi</span>

<span class="normal">      </span><span class="keyword">if</span><span class="normal"> </span><span class="keyword">test</span><span class="normal"> </span><span class="string">"$need_locks"</span><span class="normal"> </span><span class="symbol">=</span><span class="normal"> warn </span><span class="symbol">&amp;&amp;</span>
<span class="normal">	 </span><span class="keyword">test</span><span class="normal"> </span><span class="string">"X`cat $lockfile 2&gt;/dev/null`"</span><span class="normal"> </span><span class="symbol">!=</span><span class="normal"> </span><span class="string">"X$srcfile"</span><span class="symbol">;</span><span class="normal"> </span><span class="keyword">then</span>
<span class="normal">	</span><span class="variable">$echo</span><span class="normal"> </span><span class="string">"\</span>
<span class="string">*** ERROR, $lockfile contains:</span>
<span class="string">`cat $lockfile 2&gt;/dev/null`</span>

<span class="string">but it should contain:</span>
<span class="string">$srcfile</span>

<span class="string">This indicates that another process is trying to use the same</span>
<span class="string">temporary object file, and libtool could not work around it because</span>
<span class="string">your compiler does not support </span><span class="specialchar">\`</span><span class="string">-c' and </span><span class="specialchar">\`</span><span class="string">-o' together.  If you</span>
<span class="string">repeat this compilation, it may succeed, by chance, but you had better</span>
<span class="string">avoid parallel builds (make -j) in this platform, or get a better</span>
<span class="string">compiler."</span>

<span class="normal">	</span><span class="variable">$run</span><span class="normal"> </span><span class="variable">$rm</span><span class="normal"> </span><span class="variable">$removelist</span>
<span class="normal">	</span><span class="keyword">exit</span><span class="normal"> </span><span class="variable">$EXIT_FAILURE</span>
<span class="normal">      </span><span class="keyword">fi</span>

<span class="normal">      </span><span class="comment"># Just move the object if needed, then go on to compile the next one</span>
<span class="normal">      </span><span class="keyword">if</span><span class="normal"> </span><span class="keyword">test</span><span class="normal"> -n </span><span class="string">"$output_obj"</span><span class="normal"> </span><span class="symbol">&amp;&amp;</span><span class="normal"> </span><span class="keyword">test</span><span class="normal"> </span><span class="string">"X$output_obj"</span><span class="normal"> </span><span class="symbol">!=</span><span class="normal"> </span><span class="string">"X$lobj"</span><span class="symbol">;</span><span class="normal"> </span><span class="keyword">then</span>
<span class="normal">	</span><span class="variable">$show</span><span class="normal"> </span><span class="string">"$mv $output_obj $lobj"</span>
<span class="normal">	</span><span class="keyword">if</span><span class="normal"> </span><span class="variable">$run</span><span class="normal"> </span><span class="variable">$mv</span><span class="normal"> </span><span class="variable">$output_obj</span><span class="normal"> </span><span class="variable">$lobj</span><span class="symbol">;</span><span class="normal"> </span><span class="keyword">then</span><span class="normal"> </span><span class="symbol">:</span>
<span class="normal">	</span><span class="keyword">else</span>
<span class="normal">	  </span><span class="variable">error</span><span class="symbol">=</span><span class="variable">$?</span>
<span class="normal">	  </span><span class="variable">$run</span><span class="normal"> </span><span class="variable">$rm</span><span class="normal"> </span><span class="variable">$removelist</span>
<span class="normal">	  </span><span class="keyword">exit</span><span class="normal"> </span><span class="variable">$error</span>
<span class="normal">	</span><span class="keyword">fi</span>
<span class="normal">      </span><span class="keyword">fi</span>

<span class="normal">      </span><span class="comment"># Append the name of the PIC object to the libtool object file.</span>
<span class="normal">      </span><span class="keyword">test</span><span class="normal"> -z </span><span class="string">"$run"</span><span class="normal"> </span><span class="symbol">&amp;&amp;</span><span class="normal"> cat </span><span class="symbol">&gt;&gt;</span><span class="normal"> </span><span class="variable">${libobj}</span><span class="normal">T </span><span class="symbol">&lt;&lt;</span><span class="normal">EOF</span>
<span class="variable">pic_object</span><span class="symbol">=</span><span class="string">'$objdir/$objname'</span>

<span class="normal">EOF</span>

<span class="normal">      </span><span class="comment"># Allow error messages only from the first compilation.</span>
<span class="normal">      </span><span class="keyword">if</span><span class="normal"> </span><span class="keyword">test</span><span class="normal"> </span><span class="string">"$suppress_opt"</span><span class="normal"> </span><span class="symbol">=</span><span class="normal"> yes</span><span class="symbol">;</span><span class="normal"> </span><span class="keyword">then</span>
<span class="normal">        </span><span class="variable">suppress_output</span><span class="symbol">=</span><span class="string">' &gt;/dev/null 2&gt;&amp;1'</span>
<span class="normal">      </span><span class="keyword">fi</span>
<span class="normal">    </span><span class="keyword">else</span>
<span class="normal">      </span><span class="comment"># No PIC object so indicate it doesn't exist in the libtool</span>
<span class="normal">      </span><span class="comment"># object file.</span>
<span class="normal">      </span><span class="keyword">test</span><span class="normal"> -z </span><span class="string">"$run"</span><span class="normal"> </span><span class="symbol">&amp;&amp;</span><span class="normal"> cat </span><span class="symbol">&gt;&gt;</span><span class="normal"> </span><span class="variable">${libobj}</span><span class="normal">T </span><span class="symbol">&lt;&lt;</span><span class="normal">EOF</span>
<span class="variable">pic_object</span><span class="symbol">=</span><span class="normal">none</span>

<span class="normal">EOF</span>
<span class="normal">    </span><span class="keyword">fi</span>

<span class="normal">    </span><span class="comment"># Only build a position-dependent object if we build old libraries.</span>
<span class="normal">    </span><span class="keyword">if</span><span class="normal"> </span><span class="keyword">test</span><span class="normal"> </span><span class="string">"$build_old_libs"</span><span class="normal"> </span><span class="symbol">=</span><span class="normal"> yes</span><span class="symbol">;</span><span class="normal"> </span><span class="keyword">then</span>
<span class="normal">      </span><span class="keyword">if</span><span class="normal"> </span><span class="keyword">test</span><span class="normal"> </span><span class="string">"$pic_mode"</span><span class="normal"> </span><span class="symbol">!=</span><span class="normal"> yes</span><span class="symbol">;</span><span class="normal"> </span><span class="keyword">then</span>
<span class="normal">	</span><span class="comment"># Don't build PIC code</span>
<span class="normal">	</span><span class="keyword">command</span><span class="symbol">=</span><span class="string">"$base_compile $qsrcfile"</span>
<span class="normal">      </span><span class="keyword">else</span>
<span class="normal">	</span><span class="keyword">command</span><span class="symbol">=</span><span class="string">"$base_compile $qsrcfile $pic_flag"</span>
<span class="normal">      </span><span class="keyword">fi</span>
<span class="normal">      </span><span class="keyword">if</span><span class="normal"> </span><span class="keyword">test</span><span class="normal"> </span><span class="string">"$compiler_c_o"</span><span class="normal"> </span><span class="symbol">=</span><span class="normal"> yes</span><span class="symbol">;</span><span class="normal"> </span><span class="keyword">then</span>
<span class="normal">	</span><span class="keyword">command</span><span class="symbol">=</span><span class="string">"$command -o $obj"</span>
<span class="normal">      </span><span class="keyword">fi</span>

<span class="normal">      </span><span class="comment"># Suppress compiler output if we already did a PIC compilation.</span>
<span class="normal">      </span><span class="keyword">command</span><span class="symbol">=</span><span class="string">"$command$suppress_output"</span>
<span class="normal">      </span><span class="variable">$run</span><span class="normal"> </span><span class="variable">$rm</span><span class="normal"> </span><span class="string">"$obj"</span><span class="normal"> </span><span class="string">"$output_obj"</span>
<span class="normal">      </span><span class="variable">$show</span><span class="normal"> </span><span class="string">"$command"</span>
<span class="normal">      </span><span class="keyword">if</span><span class="normal"> </span><span class="variable">$run</span><span class="normal"> </span><span class="keyword">eval</span><span class="normal"> </span><span class="string">"$command"</span><span class="symbol">;</span><span class="normal"> </span><span class="keyword">then</span><span class="normal"> </span><span class="symbol">:</span>
<span class="normal">      </span><span class="keyword">else</span>
<span class="normal">	</span><span class="variable">$run</span><span class="normal"> </span><span class="variable">$rm</span><span class="normal"> </span><span class="variable">$removelist</span>
<span class="normal">	</span><span class="keyword">exit</span><span class="normal"> </span><span class="variable">$EXIT_FAILURE</span>
<span class="normal">      </span><span class="keyword">fi</span>

<span class="normal">      </span><span class="keyword">if</span><span class="normal"> </span><span class="keyword">test</span><span class="normal"> </span><span class="string">"$need_locks"</span><span class="normal"> </span><span class="symbol">=</span><span class="normal"> warn </span><span class="symbol">&amp;&amp;</span>
<span class="normal">	 </span><span class="keyword">test</span><span class="normal"> </span><span class="string">"X`cat $lockfile 2&gt;/dev/null`"</span><span class="normal"> </span><span class="symbol">!=</span><span class="normal"> </span><span class="string">"X$srcfile"</span><span class="symbol">;</span><span class="normal"> </span><span class="keyword">then</span>
<span class="normal">	</span><span class="variable">$echo</span><span class="normal"> </span><span class="string">"\</span>
<span class="string">*** ERROR, $lockfile contains:</span>
<span class="string">`cat $lockfile 2&gt;/dev/null`</span>

<span class="string">but it should contain:</span>
<span class="string">$srcfile</span>

<span class="string">This indicates that another process is trying to use the same</span>
<span class="string">temporary object file, and libtool could not work around it because</span>
<span class="string">your compiler does not support </span><span class="specialchar">\`</span><span class="string">-c' and </span><span class="specialchar">\`</span><span class="string">-o' together.  If you</span>
<span class="string">repeat this compilation, it may succeed, by chance, but you had better</span>
<span class="string">avoid parallel builds (make -j) in this platform, or get a better</span>
<span class="string">compiler."</span>

<span class="normal">	</span><span class="variable">$run</span><span class="normal"> </span><span class="variable">$rm</span><span class="normal"> </span><span class="variable">$removelist</span>
<span class="normal">	</span><span class="keyword">exit</span><span class="normal"> </span><span class="variable">$EXIT_FAILURE</span>
<span class="normal">      </span><span class="keyword">fi</span>

<span class="normal">      </span><span class="comment"># Just move the object if needed</span>
<span class="normal">      </span><span class="keyword">if</span><span class="normal"> </span><span class="keyword">test</span><span class="normal"> -n </span><span class="string">"$output_obj"</span><span class="normal"> </span><span class="symbol">&amp;&amp;</span><span class="normal"> </span><span class="keyword">test</span><span class="normal"> </span><span class="string">"X$output_obj"</span><span class="normal"> </span><span class="symbol">!=</span><span class="normal"> </span><span class="string">"X$obj"</span><span class="symbol">;</span><span class="normal"> </span><span class="keyword">then</span>
<span class="normal">	</span><span class="variable">$show</span><span class="normal"> </span><span class="string">"$mv $output_obj $obj"</span>
<span class="normal">	</span><span class="keyword">if</span><span class="normal"> </span><span class="variable">$run</span><span class="normal"> </span><span class="variable">$mv</span><span class="normal"> </span><span class="variable">$output_obj</span><span class="normal"> </span><span class="variable">$obj</span><span class="symbol">;</span><span class="normal"> </span><span class="keyword">then</span><span class="normal"> </span><span class="symbol">:</span>
<span class="normal">	</span><span class="keyword">else</span>
<span class="normal">	  </span><span class="variable">error</span><span class="symbol">=</span><span class="variable">$?</span>
<span class="normal">	  </span><span class="variable">$run</span><span class="normal"> </span><span class="variable">$rm</span><span class="normal"> </span><span class="variable">$removelist</span>
<span class="normal">	  </span><span class="keyword">exit</span><span class="normal"> </span><span class="variable">$error</span>
<span class="normal">	</span><span class="keyword">fi</span>
<span class="normal">      </span><span class="keyword">fi</span>

<span class="normal">      </span><span class="comment"># Append the name of the non-PIC object the libtool object file.</span>
<span class="normal">      </span><span class="comment"># Only append if the libtool object file exists.</span>
<span class="normal">      </span><span class="keyword">test</span><span class="normal"> -z </span><span class="string">"$run"</span><span class="normal"> </span><span class="symbol">&amp;&amp;</span><span class="normal"> cat </span><span class="symbol">&gt;&gt;</span><span class="normal"> </span><span class="variable">${libobj}</span><span class="normal">T </span><span class="symbol">&lt;&lt;</span><span class="normal">EOF</span>
<span class="comment"># Name of the non-PIC object.</span>
<span class="variable">non_pic_object</span><span class="symbol">=</span><span class="string">'$objname'</span>

<span class="normal">EOF</span>
<span class="normal">    </span><span class="keyword">else</span>
<span class="normal">      </span><span class="comment"># Append the name of the non-PIC object the libtool object file.</span>
<span class="normal">      </span><span class="comment"># Only append if the libtool object file exists.</span>
<span class="normal">      </span><span class="keyword">test</span><span class="normal"> -z </span><span class="string">"$run"</span><span class="normal"> </span><span class="symbol">&amp;&amp;</span><span class="normal"> cat </span><span class="symbol">&gt;&gt;</span><span class="normal"> </span><span class="variable">${libobj}</span><span class="normal">T </span><span class="symbol">&lt;&lt;</span><span class="normal">EOF</span>
<span class="comment"># Name of the non-PIC object.</span>
<span class="variable">non_pic_object</span><span class="symbol">=</span><span class="normal">none</span>

<span class="normal">EOF</span>
<span class="normal">    </span><span class="keyword">fi</span>

<span class="normal">    </span><span class="variable">$run</span><span class="normal"> </span><span class="variable">$mv</span><span class="normal"> </span><span class="string">"${libobj}T"</span><span class="normal"> </span><span class="string">"${libobj}"</span>

<span class="normal">    </span><span class="comment"># Unlock the critical section if it was locked</span>
<span class="normal">    </span><span class="keyword">if</span><span class="normal"> </span><span class="keyword">test</span><span class="normal"> </span><span class="string">"$need_locks"</span><span class="normal"> </span><span class="symbol">!=</span><span class="normal"> no</span><span class="symbol">;</span><span class="normal"> </span><span class="keyword">then</span>
<span class="normal">      </span><span class="variable">$run</span><span class="normal"> </span><span class="variable">$rm</span><span class="normal"> </span><span class="string">"$lockfile"</span>
<span class="normal">    </span><span class="keyword">fi</span>

<span class="normal">    </span><span class="keyword">exit</span><span class="normal"> </span><span class="variable">$EXIT_SUCCESS</span>
<span class="normal">    </span><span class="symbol">;;</span>

<span class="normal">  </span><span class="comment"># libtool link mode</span>
<span class="normal">  link </span><span class="symbol">|</span><span class="normal"> relink</span><span class="symbol">)</span>
<span class="normal">    </span><span class="variable">modename</span><span class="symbol">=</span><span class="string">"$modename: link"</span>
<span class="normal">    </span><span class="keyword">case</span><span class="normal"> </span><span class="variable">$host</span><span class="normal"> </span><span class="keyword">in</span>
<span class="normal">    </span><span class="symbol">*</span><span class="normal">-</span><span class="symbol">*</span><span class="normal">-cygwin</span><span class="symbol">*</span><span class="normal"> </span><span class="symbol">|</span><span class="normal"> </span><span class="symbol">*</span><span class="normal">-</span><span class="symbol">*</span><span class="normal">-mingw</span><span class="symbol">*</span><span class="normal"> </span><span class="symbol">|</span><span class="normal"> </span><span class="symbol">*</span><span class="normal">-</span><span class="symbol">*</span><span class="normal">-pw</span><span class="number">32</span><span class="symbol">*</span><span class="normal"> </span><span class="symbol">|</span><span class="normal"> </span><span class="symbol">*</span><span class="normal">-</span><span class="symbol">*</span><span class="normal">-os</span><span class="number">2</span><span class="symbol">*)</span>
<span class="normal">      </span><span class="comment"># It is impossible to link a dll without this setting, and</span>
<span class="normal">      </span><span class="comment"># we shouldn't force the makefile maintainer to figure out</span>
<span class="normal">      </span><span class="comment"># which system we are compiling for in order to pass an extra</span>
<span class="normal">      </span><span class="comment"># flag for every libtool invocation.</span>
<span class="normal">      </span><span class="comment"># allow_undefined=no</span>

<span class="normal">      </span><span class="comment"># FIXME: Unfortunately, there are problems with the above when trying</span>
<span class="normal">      </span><span class="comment"># to make a dll which has undefined symbols, in which case not</span>
<span class="normal">      </span><span class="comment"># even a static library is built.  For now, we need to specify</span>
<span class="normal">      </span><span class="comment"># -no-undefined on the libtool link line when we can be certain</span>
<span class="normal">      </span><span class="comment"># that all symbols are satisfied, otherwise we get a static library.</span>
<span class="normal">      </span><span class="variable">allow_undefined</span><span class="symbol">=</span><span class="normal">yes</span>
<span class="normal">      </span><span class="symbol">;;</span>
<span class="normal">    </span><span class="symbol">*)</span>
<span class="normal">      </span><span class="variable">allow_undefined</span><span class="symbol">=</span><span class="normal">yes</span>
<span class="normal">      </span><span class="symbol">;;</span>
<span class="normal">    </span><span class="keyword">esac</span>
<span class="normal">    </span><span class="variable">libtool_args</span><span class="symbol">=</span><span class="string">"$nonopt"</span>
<span class="normal">    </span><span class="variable">base_compile</span><span class="symbol">=</span><span class="string">"$nonopt $@"</span>
<span class="normal">    </span><span class="variable">compile_command</span><span class="symbol">=</span><span class="string">"$nonopt"</span>
<span class="normal">    </span><span class="variable">finalize_command</span><span class="symbol">=</span><span class="string">"$nonopt"</span>

<span class="normal">    </span><span class="variable">compile_rpath</span><span class="symbol">=</span>
<span class="normal">    </span><span class="variable">finalize_rpath</span><span class="symbol">=</span>
<span class="normal">    </span><span class="variable">compile_shlibpath</span><span class="symbol">=</span>
<span class="normal">    </span><span class="variable">finalize_shlibpath</span><span class="symbol">=</span>
<span class="normal">    </span><span class="variable">convenience</span><span class="symbol">=</span>
<span class="normal">    </span><span class="variable">old_convenience</span><span class="symbol">=</span>
<span class="normal">    </span><span class="variable">deplibs</span><span class="symbol">=</span>
<span class="normal">    </span><span class="variable">old_deplibs</span><span class="symbol">=</span>
<span class="normal">    </span><span class="variable">compiler_flags</span><span class="symbol">=</span>
<span class="normal">    </span><span class="variable">linker_flags</span><span class="symbol">=</span>
<span class="normal">    </span><span class="variable">dllsearchpath</span><span class="symbol">=</span>
<span class="normal">    </span><span class="variable">lib_search_path</span><span class="symbol">=</span><span class="normal">`pwd`</span>
<span class="normal">    </span><span class="variable">inst_prefix_dir</span><span class="symbol">=</span>

<span class="normal">    </span><span class="variable">avoid_version</span><span class="symbol">=</span><span class="normal">no</span>
<span class="normal">    </span><span class="variable">dlfiles</span><span class="symbol">=</span>
<span class="normal">    </span><span class="variable">dlprefiles</span><span class="symbol">=</span>
<span class="normal">    </span><span class="variable">dlself</span><span class="symbol">=</span><span class="normal">no</span>
<span class="normal">    </span><span class="variable">export_dynamic</span><span class="symbol">=</span><span class="normal">no</span>
<span class="normal">    </span><span class="variable">export_symbols</span><span class="symbol">=</span>
<span class="normal">    </span><span class="variable">export_symbols_regex</span><span class="symbol">=</span>
<span class="normal">    </span><span class="variable">generated</span><span class="symbol">=</span>
<span class="normal">    </span><span class="variable">libobjs</span><span class="symbol">=</span>
<span class="normal">    </span><span class="variable">ltlibs</span><span class="symbol">=</span>
<span class="normal">    </span><span class="variable">module</span><span class="symbol">=</span><span class="normal">no</span>
<span class="normal">    </span><span class="variable">no_install</span><span class="symbol">=</span><span class="normal">no</span>
<span class="normal">    </span><span class="variable">objs</span><span class="symbol">=</span>
<span class="normal">    </span><span class="variable">non_pic_objects</span><span class="symbol">=</span>
<span class="normal">    </span><span class="variable">notinst_path</span><span class="symbol">=</span><span class="normal"> </span><span class="comment"># paths that contain not-installed libtool libraries</span>
<span class="normal">    </span><span class="variable">precious_files_regex</span><span class="symbol">=</span>
<span class="normal">    </span><span class="variable">prefer_static_libs</span><span class="symbol">=</span><span class="normal">no</span>
<span class="normal">    </span><span class="variable">preload</span><span class="symbol">=</span><span class="normal">no</span>
<span class="normal">    </span><span class="variable">prev</span><span class="symbol">=</span>
<span class="normal">    </span><span class="variable">prevarg</span><span class="symbol">=</span>
<span class="normal">    </span><span class="variable">release</span><span class="symbol">=</span>
<span class="normal">    </span><span class="variable">rpath</span><span class="symbol">=</span>
<span class="normal">    </span><span class="variable">xrpath</span><span class="symbol">=</span>
<span class="normal">    </span><span class="variable">perm_rpath</span><span class="symbol">=</span>
<span class="normal">    </span><span class="variable">temp_rpath</span><span class="symbol">=</span>
<span class="normal">    </span><span class="variable">thread_safe</span><span class="symbol">=</span><span class="normal">no</span>
<span class="normal">    </span><span class="variable">vinfo</span><span class="symbol">=</span>
<span class="normal">    </span><span class="variable">vinfo_number</span><span class="symbol">=</span><span class="normal">no</span>

<span class="normal">    func_infer_tag </span><span class="variable">$base_compile</span>

<span class="normal">    </span><span class="comment"># We need to know -static, to get the right output filenames.</span>
<span class="normal">    </span><span class="keyword">for</span><span class="normal"> arg</span>
<span class="normal">    </span><span class="keyword">do</span>
<span class="normal">      </span><span class="keyword">case</span><span class="normal"> </span><span class="variable">$arg</span><span class="normal"> </span><span class="keyword">in</span>
<span class="normal">      -all-static </span><span class="symbol">|</span><span class="normal"> -static </span><span class="symbol">|</span><span class="normal"> -static-libtool-libs</span><span class="symbol">)</span>
<span class="normal">	</span><span class="keyword">case</span><span class="normal"> </span><span class="variable">$arg</span><span class="normal"> </span><span class="keyword">in</span>
<span class="normal">	-all-static</span><span class="symbol">)</span>
<span class="normal">	  </span><span class="keyword">if</span><span class="normal"> </span><span class="keyword">test</span><span class="normal"> </span><span class="string">"$build_libtool_libs"</span><span class="normal"> </span><span class="symbol">=</span><span class="normal"> yes </span><span class="symbol">&amp;&amp;</span><span class="normal"> </span><span class="keyword">test</span><span class="normal"> -z </span><span class="string">"$link_static_flag"</span><span class="symbol">;</span><span class="normal"> </span><span class="keyword">then</span>
<span class="normal">	    </span><span class="variable">$echo</span><span class="normal"> </span><span class="string">"$modename: warning: complete static linking is impossible in this configuration"</span><span class="normal"> </span><span class="number">1</span><span class="symbol">&gt;&amp;</span><span class="number">2</span>
<span class="normal">	  </span><span class="keyword">fi</span>
<span class="normal">	  </span><span class="keyword">if</span><span class="normal"> </span><span class="keyword">test</span><span class="normal"> -n </span><span class="string">"$link_static_flag"</span><span class="symbol">;</span><span class="normal"> </span><span class="keyword">then</span>
<span class="normal">	    </span><span class="variable">dlopen_self</span><span class="symbol">=</span><span class="variable">$dlopen_self_static</span>
<span class="normal">	  </span><span class="keyword">fi</span>
<span class="normal">	  </span><span class="variable">prefer_static_libs</span><span class="symbol">=</span><span class="normal">yes</span>
<span class="normal">	  </span><span class="symbol">;;</span>
<span class="normal">	-static</span><span class="symbol">)</span>
<span class="normal">	  </span><span class="keyword">if</span><span class="normal"> </span><span class="keyword">test</span><span class="normal"> -z </span><span class="string">"$pic_flag"</span><span class="normal"> </span><span class="symbol">&amp;&amp;</span><span class="normal"> </span><span class="keyword">test</span><span class="normal"> -n </span><span class="string">"$link_static_flag"</span><span class="symbol">;</span><span class="normal"> </span><span class="keyword">then</span>
<span class="normal">	    </span><span class="variable">dlopen_self</span><span class="symbol">=</span><span class="variable">$dlopen_self_static</span>
<span class="normal">	  </span><span class="keyword">fi</span>
<span class="normal">	  </span><span class="variable">prefer_static_libs</span><span class="symbol">=</span><span class="normal">built</span>
<span class="normal">	  </span><span class="symbol">;;</span>
<span class="normal">	-static-libtool-libs</span><span class="symbol">)</span>
<span class="normal">	  </span><span class="keyword">if</span><span class="normal"> </span><span class="keyword">test</span><span class="normal"> -z </span><span class="string">"$pic_flag"</span><span class="normal"> </span><span class="symbol">&amp;&amp;</span><span class="normal"> </span><span class="keyword">test</span><span class="normal"> -n </span><span class="string">"$link_static_flag"</span><span class="symbol">;</span><span class="normal"> </span><span class="keyword">then</span>
<span class="normal">	    </span><span class="variable">dlopen_self</span><span class="symbol">=</span><span class="variable">$dlopen_self_static</span>
<span class="normal">	  </span><span class="keyword">fi</span>
<span class="normal">	  </span><span class="variable">prefer_static_libs</span><span class="symbol">=</span><span class="normal">yes</span>
<span class="normal">	  </span><span class="symbol">;;</span>
<span class="normal">	</span><span class="keyword">esac</span>
<span class="normal">	</span><span class="variable">build_libtool_libs</span><span class="symbol">=</span><span class="normal">no</span>
<span class="normal">	</span><span class="variable">build_old_libs</span><span class="symbol">=</span><span class="normal">yes</span>
<span class="normal">	</span><span class="keyword">break</span>
<span class="normal">	</span><span class="symbol">;;</span>
<span class="normal">      </span><span class="keyword">esac</span>
<span class="normal">    </span><span class="keyword">done</span>

<span class="normal">    </span><span class="comment"># See if our shared archives depend on static archives.</span>
<span class="normal">    </span><span class="keyword">test</span><span class="normal"> -n </span><span class="string">"$old_archive_from_new_cmds"</span><span class="normal"> </span><span class="symbol">&amp;&amp;</span><span class="normal"> </span><span class="variable">build_old_libs</span><span class="symbol">=</span><span class="normal">yes</span>

<span class="normal">    </span><span class="comment"># Go through the arguments, transforming them on the way.</span>
<span class="normal">    </span><span class="keyword">while</span><span class="normal"> </span><span class="keyword">test</span><span class="normal"> </span><span class="string">"$#"</span><span class="normal"> -gt </span><span class="number">0</span><span class="symbol">;</span><span class="normal"> </span><span class="keyword">do</span>
<span class="normal">      </span><span class="variable">arg</span><span class="symbol">=</span><span class="string">"$1"</span>
<span class="normal">      </span><span class="keyword">shift</span>
<span class="normal">      </span><span class="keyword">case</span><span class="normal"> </span><span class="variable">$arg</span><span class="normal"> </span><span class="keyword">in</span>
<span class="normal">      </span><span class="symbol">*[\[\~\</span><span class="comment">#\^\&amp;\*\(\)\{\}\|\;\&lt;\&gt;\?\'\ \	]*|*]*|"")</span>
<span class="normal">	</span><span class="variable">qarg</span><span class="symbol">=</span><span class="normal">\"`</span><span class="variable">$echo</span><span class="normal"> </span><span class="string">"X$arg"</span><span class="normal"> </span><span class="symbol">|</span><span class="normal"> </span><span class="variable">$Xsed</span><span class="normal"> -e </span><span class="string">"$sed_quote_subst"</span><span class="normal">`\" </span><span class="comment">### testsuite: skip nested quoting test</span>
<span class="normal">	</span><span class="symbol">;;</span>
<span class="normal">      </span><span class="symbol">*)</span><span class="normal"> </span><span class="variable">qarg</span><span class="symbol">=</span><span class="variable">$arg</span><span class="normal"> </span><span class="symbol">;;</span>
<span class="normal">      </span><span class="keyword">esac</span>
<span class="normal">      </span><span class="variable">libtool_args</span><span class="symbol">=</span><span class="string">"$libtool_args $qarg"</span>

<span class="normal">      </span><span class="comment"># If the previous option needs an argument, assign it.</span>
<span class="normal">      </span><span class="keyword">if</span><span class="normal"> </span><span class="keyword">test</span><span class="normal"> -n </span><span class="string">"$prev"</span><span class="symbol">;</span><span class="normal"> </span><span class="keyword">then</span>
<span class="normal">	</span><span class="keyword">case</span><span class="normal"> </span><span class="variable">$prev</span><span class="normal"> </span><span class="keyword">in</span>
<span class="normal">	output</span><span class="symbol">)</span>
<span class="normal">	  </span><span class="variable">compile_command</span><span class="symbol">=</span><span class="string">"$compile_command @OUTPUT@"</span>
<span class="normal">	  </span><span class="variable">finalize_command</span><span class="symbol">=</span><span class="string">"$finalize_command @OUTPUT@"</span>
<span class="normal">	  </span><span class="symbol">;;</span>
<span class="normal">	</span><span class="keyword">esac</span>

<span class="normal">	</span><span class="keyword">case</span><span class="normal"> </span><span class="variable">$prev</span><span class="normal"> </span><span class="keyword">in</span>
<span class="normal">	dlfiles</span><span class="symbol">|</span><span class="normal">dlprefiles</span><span class="symbol">)</span>
<span class="normal">	  </span><span class="keyword">if</span><span class="normal"> </span><span class="keyword">test</span><span class="normal"> </span><span class="string">"$preload"</span><span class="normal"> </span><span class="symbol">=</span><span class="normal"> no</span><span class="symbol">;</span><span class="normal"> </span><span class="keyword">then</span>
<span class="normal">	    </span><span class="comment"># Add the symbol object into the linking commands.</span>
<span class="normal">	    </span><span class="variable">compile_command</span><span class="symbol">=</span><span class="string">"$compile_command @SYMFILE@"</span>
<span class="normal">	    </span><span class="variable">finalize_command</span><span class="symbol">=</span><span class="string">"$finalize_command @SYMFILE@"</span>
<span class="normal">	    </span><span class="variable">preload</span><span class="symbol">=</span><span class="normal">yes</span>
<span class="normal">	  </span><span class="keyword">fi</span>
<span class="normal">	  </span><span class="keyword">case</span><span class="normal"> </span><span class="variable">$arg</span><span class="normal"> </span><span class="keyword">in</span>
<span class="normal">	  </span><span class="symbol">*.</span><span class="normal">la </span><span class="symbol">|</span><span class="normal"> </span><span class="symbol">*.</span><span class="normal">lo</span><span class="symbol">)</span><span class="normal"> </span><span class="symbol">;;</span><span class="normal">  </span><span class="comment"># We handle these cases below.</span>
<span class="normal">	  force</span><span class="symbol">)</span>
<span class="normal">	    </span><span class="keyword">if</span><span class="normal"> </span><span class="keyword">test</span><span class="normal"> </span><span class="string">"$dlself"</span><span class="normal"> </span><span class="symbol">=</span><span class="normal"> no</span><span class="symbol">;</span><span class="normal"> </span><span class="keyword">then</span>
<span class="normal">	      </span><span class="variable">dlself</span><span class="symbol">=</span><span class="normal">needless</span>
<span class="normal">	      </span><span class="variable">export_dynamic</span><span class="symbol">=</span><span class="normal">yes</span>
<span class="normal">	    </span><span class="keyword">fi</span>
<span class="normal">	    </span><span class="variable">prev</span><span class="symbol">=</span>
<span class="normal">	    </span><span class="keyword">continue</span>
<span class="normal">	    </span><span class="symbol">;;</span>
<span class="normal">	  self</span><span class="symbol">)</span>
<span class="normal">	    </span><span class="keyword">if</span><span class="normal"> </span><span class="keyword">test</span><span class="normal"> </span><span class="string">"$prev"</span><span class="normal"> </span><span class="symbol">=</span><span class="normal"> dlprefiles</span><span class="symbol">;</span><span class="normal"> </span><span class="keyword">then</span>
<span class="normal">	      </span><span class="variable">dlself</span><span class="symbol">=</span><span class="normal">yes</span>
<span class="normal">	    </span><span class="keyword">elif</span><span class="normal"> </span><span class="keyword">test</span><span class="normal"> </span><span class="string">"$prev"</span><span class="normal"> </span><span class="symbol">=</span><span class="normal"> dlfiles </span><span class="symbol">&amp;&amp;</span><span class="normal"> </span><span class="keyword">test</span><span class="normal"> </span><span class="string">"$dlopen_self"</span><span class="normal"> </span><span class="symbol">!=</span><span class="normal"> yes</span><span class="symbol">;</span><span class="normal"> </span><span class="keyword">then</span>
<span class="normal">	      </span><span class="variable">dlself</span><span class="symbol">=</span><span class="normal">yes</span>
<span class="normal">	    </span><span class="keyword">else</span>
<span class="normal">	      </span><span class="variable">dlself</span><span class="symbol">=</span><span class="normal">needless</span>
<span class="normal">	      </span><span class="variable">export_dynamic</span><span class="symbol">=</span><span class="normal">yes</span>
<span class="normal">	    </span><span class="keyword">fi</span>
<span class="normal">	    </span><span class="variable">prev</span><span class="symbol">=</span>
<span class="normal">	    </span><span class="keyword">continue</span>
<span class="normal">	    </span><span class="symbol">;;</span>
<span class="normal">	  </span><span class="symbol">*)</span>
<span class="normal">	    </span><span class="keyword">if</span><span class="normal"> </span><span class="keyword">test</span><span class="normal"> </span><span class="string">"$prev"</span><span class="normal"> </span><span class="symbol">=</span><span class="normal"> dlfiles</span><span class="symbol">;</span><span class="normal"> </span><span class="keyword">then</span>
<span class="normal">	      </span><span class="variable">dlfiles</span><span class="symbol">=</span><span class="string">"$dlfiles $arg"</span>
<span class="normal">	    </span><span class="keyword">else</span>
<span class="normal">	      </span><span class="variable">dlprefiles</span><span class="symbol">=</span><span class="string">"$dlprefiles $arg"</span>
<span class="normal">	    </span><span class="keyword">fi</span>
<span class="normal">	    </span><span class="variable">prev</span><span class="symbol">=</span>
<span class="normal">	    </span><span class="keyword">continue</span>
<span class="normal">	    </span><span class="symbol">;;</span>
<span class="normal">	  </span><span class="keyword">esac</span>
<span class="normal">	  </span><span class="symbol">;;</span>
<span class="normal">	expsyms</span><span class="symbol">)</span>
<span class="normal">	  </span><span class="variable">export_symbols</span><span class="symbol">=</span><span class="string">"$arg"</span>
<span class="normal">	  </span><span class="keyword">if</span><span class="normal"> </span><span class="keyword">test</span><span class="normal"> </span><span class="symbol">!</span><span class="normal"> -f </span><span class="string">"$arg"</span><span class="symbol">;</span><span class="normal"> </span><span class="keyword">then</span>
<span class="normal">	    </span><span class="variable">$echo</span><span class="normal"> </span><span class="string">"$modename: symbol file </span><span class="specialchar">\`</span><span class="string">$arg' does not exist"</span>
<span class="normal">	    </span><span class="keyword">exit</span><span class="normal"> </span><span class="variable">$EXIT_FAILURE</span>
<span class="normal">	  </span><span class="keyword">fi</span>
<span class="normal">	  </span><span class="variable">prev</span><span class="symbol">=</span>
<span class="normal">	  </span><span class="keyword">continue</span>
<span class="normal">	  </span><span class="symbol">;;</span>
<span class="normal">	expsyms_regex</span><span class="symbol">)</span>
<span class="normal">	  </span><span class="variable">export_symbols_regex</span><span class="symbol">=</span><span class="string">"$arg"</span>
<span class="normal">	  </span><span class="variable">prev</span><span class="symbol">=</span>
<span class="normal">	  </span><span class="keyword">continue</span>
<span class="normal">	  </span><span class="symbol">;;</span>
<span class="normal">	inst_prefix</span><span class="symbol">)</span>
<span class="normal">	  </span><span class="variable">inst_prefix_dir</span><span class="symbol">=</span><span class="string">"$arg"</span>
<span class="normal">	  </span><span class="variable">prev</span><span class="symbol">=</span>
<span class="normal">	  </span><span class="keyword">continue</span>
<span class="normal">	  </span><span class="symbol">;;</span>
<span class="normal">	precious_regex</span><span class="symbol">)</span>
<span class="normal">	  </span><span class="variable">precious_files_regex</span><span class="symbol">=</span><span class="string">"$arg"</span>
<span class="normal">	  </span><span class="variable">prev</span><span class="symbol">=</span>
<span class="normal">	  </span><span class="keyword">continue</span>
<span class="normal">	  </span><span class="symbol">;;</span>
<span class="normal">	release</span><span class="symbol">)</span>
<span class="normal">	  </span><span class="variable">release</span><span class="symbol">=</span><span class="string">"-$arg"</span>
<span class="normal">	  </span><span class="variable">prev</span><span class="symbol">=</span>
<span class="normal">	  </span><span class="keyword">continue</span>
<span class="normal">	  </span><span class="symbol">;;</span>
<span class="normal">	objectlist</span><span class="symbol">)</span>
<span class="normal">	  </span><span class="keyword">if</span><span class="normal"> </span><span class="keyword">test</span><span class="normal"> -f </span><span class="string">"$arg"</span><span class="symbol">;</span><span class="normal"> </span><span class="keyword">then</span>
<span class="normal">	    </span><span class="variable">save_arg</span><span class="symbol">=</span><span class="variable">$arg</span>
<span class="normal">	    </span><span class="variable">moreargs</span><span class="symbol">=</span>
<span class="normal">	    </span><span class="keyword">for</span><span class="normal"> fil </span><span class="keyword">in</span><span class="normal"> `cat </span><span class="variable">$save_arg</span><span class="normal">`</span>
<span class="normal">	    </span><span class="keyword">do</span>
<span class="comment">#	      moreargs="$moreargs $fil"</span>
<span class="normal">	      </span><span class="variable">arg</span><span class="symbol">=</span><span class="variable">$fil</span>
<span class="normal">	      </span><span class="comment"># A libtool-controlled object.</span>

<span class="normal">	      </span><span class="comment"># Check to see that this really is a libtool object.</span>
<span class="normal">	      </span><span class="keyword">if</span><span class="normal"> </span><span class="symbol">(</span><span class="variable">${SED}</span><span class="normal"> -e </span><span class="string">'2q'</span><span class="normal"> </span><span class="variable">$arg</span><span class="normal"> </span><span class="symbol">|</span><span class="normal"> grep </span><span class="string">"^# Generated by .*$PACKAGE"</span><span class="symbol">)</span><span class="normal"> </span><span class="symbol">&gt;</span><span class="normal">/dev/null </span><span class="number">2</span><span class="symbol">&gt;&amp;</span><span class="number">1</span><span class="symbol">;</span><span class="normal"> </span><span class="keyword">then</span>
<span class="normal">		</span><span class="variable">pic_object</span><span class="symbol">=</span>
<span class="normal">		</span><span class="variable">non_pic_object</span><span class="symbol">=</span>

<span class="normal">		</span><span class="comment"># Read the .lo file</span>
<span class="normal">		</span><span class="comment"># If there is no directory component, then add one.</span>
<span class="normal">		</span><span class="keyword">case</span><span class="normal"> </span><span class="variable">$arg</span><span class="normal"> </span><span class="keyword">in</span>
<span class="normal">		</span><span class="symbol">*/*</span><span class="normal"> </span><span class="symbol">|</span><span class="normal"> </span><span class="symbol">*\\*)</span><span class="normal"> </span><span class="symbol">.</span><span class="normal"> </span><span class="variable">$arg</span><span class="normal"> </span><span class="symbol">;;</span>
<span class="normal">		</span><span class="symbol">*)</span><span class="normal"> </span><span class="symbol">.</span><span class="normal"> </span><span class="symbol">./</span><span class="variable">$arg</span><span class="normal"> </span><span class="symbol">;;</span>
<span class="normal">		</span><span class="keyword">esac</span>

<span class="normal">		</span><span class="keyword">if</span><span class="normal"> </span><span class="keyword">test</span><span class="normal"> -z </span><span class="string">"$pic_object"</span><span class="normal"> </span><span class="symbol">||</span><span class="normal"> </span><span class="symbol">\</span>
<span class="normal">		   </span><span class="keyword">test</span><span class="normal"> -z </span><span class="string">"$non_pic_object"</span><span class="normal"> </span><span class="symbol">||</span>
<span class="normal">		   </span><span class="keyword">test</span><span class="normal"> </span><span class="string">"$pic_object"</span><span class="normal"> </span><span class="symbol">=</span><span class="normal"> none </span><span class="symbol">&amp;&amp;</span><span class="normal"> </span><span class="symbol">\</span>
<span class="normal">		   </span><span class="keyword">test</span><span class="normal"> </span><span class="string">"$non_pic_object"</span><span class="normal"> </span><span class="symbol">=</span><span class="normal"> none</span><span class="symbol">;</span><span class="normal"> </span><span class="keyword">then</span>
<span class="normal">		  </span><span class="variable">$echo</span><span class="normal"> </span><span class="string">"$modename: cannot find name of object for </span><span class="specialchar">\`</span><span class="string">$arg'"</span><span class="normal"> </span><span class="number">1</span><span class="symbol">&gt;&amp;</span><span class="number">2</span>
<span class="normal">		  </span><span class="keyword">exit</span><span class="normal"> </span><span class="variable">$EXIT_FAILURE</span>
<span class="normal">		</span><span class="keyword">fi</span>

<span class="normal">		</span><span class="comment"># Extract subdirectory from the argument.</span>
<span class="normal">		</span><span class="variable">xdir</span><span class="symbol">=</span><span class="normal">`</span><span class="variable">$echo</span><span class="normal"> </span><span class="string">"X$arg"</span><span class="normal"> </span><span class="symbol">|</span><span class="normal"> </span><span class="variable">$Xsed</span><span class="normal"> -e </span><span class="string">'s%/[^/]*$%%'</span><span class="normal">`</span>
<span class="normal">		</span><span class="keyword">if</span><span class="normal"> </span><span class="keyword">test</span><span class="normal"> </span><span class="string">"X$xdir"</span><span class="normal"> </span><span class="symbol">=</span><span class="normal"> </span><span class="string">"X$arg"</span><span class="symbol">;</span><span class="normal"> </span><span class="keyword">then</span>
<span class="normal">		  </span><span class="variable">xdir</span><span class="symbol">=</span>
<span class="normal">		</span><span class="keyword">else</span>
<span class="normal">		  </span><span class="variable">xdir</span><span class="symbol">=</span><span class="string">"$xdir/"</span>
<span class="normal">		</span><span class="keyword">fi</span>

<span class="normal">		</span><span class="keyword">if</span><span class="normal"> </span><span class="keyword">test</span><span class="normal"> </span><span class="string">"$pic_object"</span><span class="normal"> </span><span class="symbol">!=</span><span class="normal"> none</span><span class="symbol">;</span><span class="normal"> </span><span class="keyword">then</span>
<span class="normal">		  </span><span class="comment"># Prepend the subdirectory the object is found in.</span>
<span class="normal">		  </span><span class="variable">pic_object</span><span class="symbol">=</span><span class="string">"$xdir$pic_object"</span>

<span class="normal">		  </span><span class="keyword">if</span><span class="normal"> </span><span class="keyword">test</span><span class="normal"> </span><span class="string">"$prev"</span><span class="normal"> </span><span class="symbol">=</span><span class="normal"> dlfiles</span><span class="symbol">;</span><span class="normal"> </span><span class="keyword">then</span>
<span class="normal">		    </span><span class="keyword">if</span><span class="normal"> </span><span class="keyword">test</span><span class="normal"> </span><span class="string">"$build_libtool_libs"</span><span class="normal"> </span><span class="symbol">=</span><span class="normal"> yes </span><span class="symbol">&amp;&amp;</span><span class="normal"> </span><span class="keyword">test</span><span class="normal"> </span><span class="string">"$dlopen_support"</span><span class="normal"> </span><span class="symbol">=</span><span class="normal"> yes</span><span class="symbol">;</span><span class="normal"> </span><span class="keyword">then</span>
<span class="normal">		      </span><span class="variable">dlfiles</span><span class="symbol">=</span><span class="string">"$dlfiles $pic_object"</span>
<span class="normal">		      </span><span class="variable">prev</span><span class="symbol">=</span>
<span class="normal">		      </span><span class="keyword">continue</span>
<span class="normal">		    </span><span class="keyword">else</span>
<span class="normal">		      </span><span class="comment"># If libtool objects are unsupported, then we need to preload.</span>
<span class="normal">		      </span><span class="variable">prev</span><span class="symbol">=</span><span class="normal">dlprefiles</span>
<span class="normal">		    </span><span class="keyword">fi</span>
<span class="normal">		  </span><span class="keyword">fi</span>

<span class="normal">		  </span><span class="comment"># CHECK ME:  I think I busted this.  -Ossama</span>
<span class="normal">		  </span><span class="keyword">if</span><span class="normal"> </span><span class="keyword">test</span><span class="normal"> </span><span class="string">"$prev"</span><span class="normal"> </span><span class="symbol">=</span><span class="normal"> dlprefiles</span><span class="symbol">;</span><span class="normal"> </span><span class="keyword">then</span>
<span class="normal">		    </span><span class="comment"># Preload the old-style object.</span>
<span class="normal">		    </span><span class="variable">dlprefiles</span><span class="symbol">=</span><span class="string">"$dlprefiles $pic_object"</span>
<span class="normal">		    </span><span class="variable">prev</span><span class="symbol">=</span>
<span class="normal">		  </span><span class="keyword">fi</span>

<span class="normal">		  </span><span class="comment"># A PIC object.</span>
<span class="normal">		  </span><span class="variable">libobjs</span><span class="symbol">=</span><span class="string">"$libobjs $pic_object"</span>
<span class="normal">		  </span><span class="variable">arg</span><span class="symbol">=</span><span class="string">"$pic_object"</span>
<span class="normal">		</span><span class="keyword">fi</span>

<span class="normal">		</span><span class="comment"># Non-PIC object.</span>
<span class="normal">		</span><span class="keyword">if</span><span class="normal"> </span><span class="keyword">test</span><span class="normal"> </span><span class="string">"$non_pic_object"</span><span class="normal"> </span><span class="symbol">!=</span><span class="normal"> none</span><span class="symbol">;</span><span class="normal"> </span><span class="keyword">then</span>
<span class="normal">		  </span><span class="comment"># Prepend the subdirectory the object is found in.</span>
<span class="normal">		  </span><span class="variable">non_pic_object</span><span class="symbol">=</span><span class="string">"$xdir$non_pic_object"</span>

<span class="normal">		  </span><span class="comment"># A standard non-PIC object</span>
<span class="normal">		  </span><span class="variable">non_pic_objects</span><span class="symbol">=</span><span class="string">"$non_pic_objects $non_pic_object"</span>
<span class="normal">		  </span><span class="keyword">if</span><span class="normal"> </span><span class="keyword">test</span><span class="normal"> -z </span><span class="string">"$pic_object"</span><span class="normal"> </span><span class="symbol">||</span><span class="normal"> </span><span class="keyword">test</span><span class="normal"> </span><span class="string">"$pic_object"</span><span class="normal"> </span><span class="symbol">=</span><span class="normal"> none </span><span class="symbol">;</span><span class="normal"> </span><span class="keyword">then</span>
<span class="normal">		    </span><span class="variable">arg</span><span class="symbol">=</span><span class="string">"$non_pic_object"</span>
<span class="normal">		  </span><span class="keyword">fi</span>
<span class="normal">		</span><span class="keyword">else</span>
<span class="normal">		  </span><span class="comment"># If the PIC object exists, use it instead.</span>
<span class="normal">		  </span><span class="comment"># $xdir was prepended to $pic_object above.</span>
<span class="normal">		  </span><span class="variable">non_pic_object</span><span class="symbol">=</span><span class="string">"$pic_object"</span>
<span class="normal">		  </span><span class="variable">non_pic_objects</span><span class="symbol">=</span><span class="string">"$non_pic_objects $non_pic_object"</span>
<span class="normal">		</span><span class="keyword">fi</span>
<span class="normal">	      </span><span class="keyword">else</span>
<span class="normal">		</span><span class="comment"># Only an error if not doing a dry-run.</span>
<span class="normal">		</span><span class="keyword">if</span><span class="normal"> </span><span class="keyword">test</span><span class="normal"> -z </span><span class="string">"$run"</span><span class="symbol">;</span><span class="normal"> </span><span class="keyword">then</span>
<span class="normal">		  </span><span class="variable">$echo</span><span class="normal"> </span><span class="string">"$modename: </span><span class="specialchar">\`</span><span class="string">$arg' is not a valid libtool object"</span><span class="normal"> </span><span class="number">1</span><span class="symbol">&gt;&amp;</span><span class="number">2</span>
<span class="normal">		  </span><span class="keyword">exit</span><span class="normal"> </span><span class="variable">$EXIT_FAILURE</span>
<span class="normal">		</span><span class="keyword">else</span>
<span class="normal">		  </span><span class="comment"># Dry-run case.</span>

<span class="normal">		  </span><span class="comment"># Extract subdirectory from the argument.</span>
<span class="normal">		  </span><span class="variable">xdir</span><span class="symbol">=</span><span class="normal">`</span><span class="variable">$echo</span><span class="normal"> </span><span class="string">"X$arg"</span><span class="normal"> </span><span class="symbol">|</span><span class="normal"> </span><span class="variable">$Xsed</span><span class="normal"> -e </span><span class="string">'s%/[^/]*$%%'</span><span class="normal">`</span>
<span class="normal">		  </span><span class="keyword">if</span><span class="normal"> </span><span class="keyword">test</span><span class="normal"> </span><span class="string">"X$xdir"</span><span class="normal"> </span><span class="symbol">=</span><span class="normal"> </span><span class="string">"X$arg"</span><span class="symbol">;</span><span class="normal"> </span><span class="keyword">then</span>
<span class="normal">		    </span><span class="variable">xdir</span><span class="symbol">=</span>
<span class="normal">		  </span><span class="keyword">else</span>
<span class="normal">		    </span><span class="variable">xdir</span><span class="symbol">=</span><span class="string">"$xdir/"</span>
<span class="normal">		  </span><span class="keyword">fi</span>

<span class="normal">		  </span><span class="variable">pic_object</span><span class="symbol">=</span><span class="normal">`</span><span class="variable">$echo</span><span class="normal"> </span><span class="string">"X${xdir}${objdir}/${arg}"</span><span class="normal"> </span><span class="symbol">|</span><span class="normal"> </span><span class="variable">$Xsed</span><span class="normal"> -e </span><span class="string">"$lo2o"</span><span class="normal">`</span>
<span class="normal">		  </span><span class="variable">non_pic_object</span><span class="symbol">=</span><span class="normal">`</span><span class="variable">$echo</span><span class="normal"> </span><span class="string">"X${xdir}${arg}"</span><span class="normal"> </span><span class="symbol">|</span><span class="normal"> </span><span class="variable">$Xsed</span><span class="normal"> -e </span><span class="string">"$lo2o"</span><span class="normal">`</span>
<span class="normal">		  </span><span class="variable">libobjs</span><span class="symbol">=</span><span class="string">"$libobjs $pic_object"</span>
<span class="normal">		  </span><span class="variable">non_pic_objects</span><span class="symbol">=</span><span class="string">"$non_pic_objects $non_pic_object"</span>
<span class="normal">		</span><span class="keyword">fi</span>
<span class="normal">	      </span><span class="keyword">fi</span>
<span class="normal">	    </span><span class="keyword">done</span>
<span class="normal">	  </span><span class="keyword">else</span>
<span class="normal">	    </span><span class="variable">$echo</span><span class="normal"> </span><span class="string">"$modename: link input file </span><span class="specialchar">\`</span><span class="string">$save_arg' does not exist"</span>
<span class="normal">	    </span><span class="keyword">exit</span><span class="normal"> </span><span class="variable">$EXIT_FAILURE</span>
<span class="normal">	  </span><span class="keyword">fi</span>
<span class="normal">	  </span><span class="variable">arg</span><span class="symbol">=</span><span class="variable">$save_arg</span>
<span class="normal">	  </span><span class="variable">prev</span><span class="symbol">=</span>
<span class="normal">	  </span><span class="keyword">continue</span>
<span class="normal">	  </span><span class="symbol">;;</span>
<span class="normal">	rpath </span><span class="symbol">|</span><span class="normal"> xrpath</span><span class="symbol">)</span>
<span class="normal">	  </span><span class="comment"># We need an absolute path.</span>
<span class="normal">	  </span><span class="keyword">case</span><span class="normal"> </span><span class="variable">$arg</span><span class="normal"> </span><span class="keyword">in</span>
<span class="normal">	  </span><span class="symbol">[\\/]*</span><span class="normal"> </span><span class="symbol">|</span><span class="normal"> </span><span class="symbol">[</span><span class="normal">A-Za-z</span><span class="symbol">]:[\\/]*)</span><span class="normal"> </span><span class="symbol">;;</span>
<span class="normal">	  </span><span class="symbol">*)</span>
<span class="normal">	    </span><span class="variable">$echo</span><span class="normal"> </span><span class="string">"$modename: only absolute run-paths are allowed"</span><span class="normal"> </span><span class="number">1</span><span class="symbol">&gt;&amp;</span><span class="number">2</span>
<span class="normal">	    </span><span class="keyword">exit</span><span class="normal"> </span><span class="variable">$EXIT_FAILURE</span>
<span class="normal">	    </span><span class="symbol">;;</span>
<span class="normal">	  </span><span class="keyword">esac</span>
<span class="normal">	  </span><span class="keyword">if</span><span class="normal"> </span><span class="keyword">test</span><span class="normal"> </span><span class="string">"$prev"</span><span class="normal"> </span><span class="symbol">=</span><span class="normal"> rpath</span><span class="symbol">;</span><span class="normal"> </span><span class="keyword">then</span>
<span class="normal">	    </span><span class="keyword">case</span><span class="normal"> </span><span class="string">"$rpath "</span><span class="normal"> </span><span class="keyword">in</span>
<span class="normal">	    </span><span class="symbol">*</span><span class="string">" $arg "</span><span class="symbol">*)</span><span class="normal"> </span><span class="symbol">;;</span>
<span class="normal">	    </span><span class="symbol">*)</span><span class="normal"> </span><span class="variable">rpath</span><span class="symbol">=</span><span class="string">"$rpath $arg"</span><span class="normal"> </span><span class="symbol">;;</span>
<span class="normal">	    </span><span class="keyword">esac</span>
<span class="normal">	  </span><span class="keyword">else</span>
<span class="normal">	    </span><span class="keyword">case</span><span class="normal"> </span><span class="string">"$xrpath "</span><span class="normal"> </span><span class="keyword">in</span>
<span class="normal">	    </span><span class="symbol">*</span><span class="string">" $arg "</span><span class="symbol">*)</span><span class="normal"> </span><span class="symbol">;;</span>
<span class="normal">	    </span><span class="symbol">*)</span><span class="normal"> </span><span class="variable">xrpath</span><span class="symbol">=</span><span class="string">"$xrpath $arg"</span><span class="normal"> </span><span class="symbol">;;</span>
<span class="normal">	    </span><span class="keyword">esac</span>
<span class="normal">	  </span><span class="keyword">fi</span>
<span class="normal">	  </span><span class="variable">prev</span><span class="symbol">=</span>
<span class="normal">	  </span><span class="keyword">continue</span>
<span class="normal">	  </span><span class="symbol">;;</span>
<span class="normal">	xcompiler</span><span class="symbol">)</span>
<span class="normal">	  </span><span class="variable">compiler_flags</span><span class="symbol">=</span><span class="string">"$compiler_flags $qarg"</span>
<span class="normal">	  </span><span class="variable">prev</span><span class="symbol">=</span>
<span class="normal">	  </span><span class="variable">compile_command</span><span class="symbol">=</span><span class="string">"$compile_command $qarg"</span>
<span class="normal">	  </span><span class="variable">finalize_command</span><span class="symbol">=</span><span class="string">"$finalize_command $qarg"</span>
<span class="normal">	  </span><span class="keyword">continue</span>
<span class="normal">	  </span><span class="symbol">;;</span>
<span class="normal">	xlinker</span><span class="symbol">)</span>
<span class="normal">	  </span><span class="variable">linker_flags</span><span class="symbol">=</span><span class="string">"$linker_flags $qarg"</span>
<span class="normal">	  </span><span class="variable">compiler_flags</span><span class="symbol">=</span><span class="string">"$compiler_flags $wl$qarg"</span>
<span class="normal">	  </span><span class="variable">prev</span><span class="symbol">=</span>
<span class="normal">	  </span><span class="variable">compile_command</span><span class="symbol">=</span><span class="string">"$compile_command $wl$qarg"</span>
<span class="normal">	  </span><span class="variable">finalize_command</span><span class="symbol">=</span><span class="string">"$finalize_command $wl$qarg"</span>
<span class="normal">	  </span><span class="keyword">continue</span>
<span class="normal">	  </span><span class="symbol">;;</span>
<span class="normal">	xcclinker</span><span class="symbol">)</span>
<span class="normal">	  </span><span class="variable">linker_flags</span><span class="symbol">=</span><span class="string">"$linker_flags $qarg"</span>
<span class="normal">	  </span><span class="variable">compiler_flags</span><span class="symbol">=</span><span class="string">"$compiler_flags $qarg"</span>
<span class="normal">	  </span><span class="variable">prev</span><span class="symbol">=</span>
<span class="normal">	  </span><span class="variable">compile_command</span><span class="symbol">=</span><span class="string">"$compile_command $qarg"</span>
<span class="normal">	  </span><span class="variable">finalize_command</span><span class="symbol">=</span><span class="string">"$finalize_command $qarg"</span>
<span class="normal">	  </span><span class="keyword">continue</span>
<span class="normal">	  </span><span class="symbol">;;</span>
<span class="normal">	shrext</span><span class="symbol">)</span>
<span class="normal">  	  </span><span class="variable">shrext_cmds</span><span class="symbol">=</span><span class="string">"$arg"</span>
<span class="normal">	  </span><span class="variable">prev</span><span class="symbol">=</span>
<span class="normal">	  </span><span class="keyword">continue</span>
<span class="normal">	  </span><span class="symbol">;;</span>
<span class="normal">	darwin_framework</span><span class="symbol">|</span><span class="normal">darwin_framework_skip</span><span class="symbol">)</span>
<span class="normal">	  </span><span class="keyword">test</span><span class="normal"> </span><span class="string">"$prev"</span><span class="normal"> </span><span class="symbol">=</span><span class="normal"> </span><span class="string">"darwin_framework"</span><span class="normal"> </span><span class="symbol">&amp;&amp;</span><span class="normal"> </span><span class="variable">compiler_flags</span><span class="symbol">=</span><span class="string">"$compiler_flags $arg"</span>
<span class="normal">	  </span><span class="variable">compile_command</span><span class="symbol">=</span><span class="string">"$compile_command $arg"</span>
<span class="normal">	  </span><span class="variable">finalize_command</span><span class="symbol">=</span><span class="string">"$finalize_command $arg"</span>
<span class="normal">	  </span><span class="variable">prev</span><span class="symbol">=</span>
<span class="normal">	  </span><span class="keyword">continue</span>
<span class="normal">	  </span><span class="symbol">;;</span>
<span class="normal">	</span><span class="symbol">*)</span>
<span class="normal">	  </span><span class="keyword">eval</span><span class="normal"> </span><span class="string">"$prev=</span><span class="specialchar">\"\$</span><span class="string">arg</span><span class="specialchar">\"</span><span class="string">"</span>
<span class="normal">	  </span><span class="variable">prev</span><span class="symbol">=</span>
<span class="normal">	  </span><span class="keyword">continue</span>
<span class="normal">	  </span><span class="symbol">;;</span>
<span class="normal">	</span><span class="keyword">esac</span>
<span class="normal">      </span><span class="keyword">fi</span><span class="normal"> </span><span class="comment"># test -n "$prev"</span>

<span class="normal">      </span><span class="variable">prevarg</span><span class="symbol">=</span><span class="string">"$arg"</span>

<span class="normal">      </span><span class="keyword">case</span><span class="normal"> </span><span class="variable">$arg</span><span class="normal"> </span><span class="keyword">in</span>
<span class="normal">      -all-static</span><span class="symbol">)</span>
<span class="normal">	</span><span class="keyword">if</span><span class="normal"> </span><span class="keyword">test</span><span class="normal"> -n </span><span class="string">"$link_static_flag"</span><span class="symbol">;</span><span class="normal"> </span><span class="keyword">then</span>
<span class="normal">	  </span><span class="variable">compile_command</span><span class="symbol">=</span><span class="string">"$compile_command $link_static_flag"</span>
<span class="normal">	  </span><span class="variable">finalize_command</span><span class="symbol">=</span><span class="string">"$finalize_command $link_static_flag"</span>
<span class="normal">	</span><span class="keyword">fi</span>
<span class="normal">	</span><span class="keyword">continue</span>
<span class="normal">	</span><span class="symbol">;;</span>

<span class="normal">      -allow-undefined</span><span class="symbol">)</span>
<span class="normal">	</span><span class="comment"># FIXME: remove this flag sometime in the future.</span>
<span class="normal">	</span><span class="variable">$echo</span><span class="normal"> </span><span class="string">"$modename: </span><span class="specialchar">\`</span><span class="string">-allow-undefined' is deprecated because it is the default"</span><span class="normal"> </span><span class="number">1</span><span class="symbol">&gt;&amp;</span><span class="number">2</span>
<span class="normal">	</span><span class="keyword">continue</span>
<span class="normal">	</span><span class="symbol">;;</span>

<span class="normal">      -avoid-version</span><span class="symbol">)</span>
<span class="normal">	</span><span class="variable">avoid_version</span><span class="symbol">=</span><span class="normal">yes</span>
<span class="normal">	</span><span class="keyword">continue</span>
<span class="normal">	</span><span class="symbol">;;</span>

<span class="normal">      -dlopen</span><span class="symbol">)</span>
<span class="normal">	</span><span class="variable">prev</span><span class="symbol">=</span><span class="normal">dlfiles</span>
<span class="normal">	</span><span class="keyword">continue</span>
<span class="normal">	</span><span class="symbol">;;</span>

<span class="normal">      -dlpreopen</span><span class="symbol">)</span>
<span class="normal">	</span><span class="variable">prev</span><span class="symbol">=</span><span class="normal">dlprefiles</span>
<span class="normal">	</span><span class="keyword">continue</span>
<span class="normal">	</span><span class="symbol">;;</span>

<span class="normal">      -export-dynamic</span><span class="symbol">)</span>
<span class="normal">	</span><span class="variable">export_dynamic</span><span class="symbol">=</span><span class="normal">yes</span>
<span class="normal">	</span><span class="keyword">continue</span>
<span class="normal">	</span><span class="symbol">;;</span>

<span class="normal">      -export-symbols </span><span class="symbol">|</span><span class="normal"> -export-symbols-regex</span><span class="symbol">)</span>
<span class="normal">	</span><span class="keyword">if</span><span class="normal"> </span><span class="keyword">test</span><span class="normal"> -n </span><span class="string">"$export_symbols"</span><span class="normal"> </span><span class="symbol">||</span><span class="normal"> </span><span class="keyword">test</span><span class="normal"> -n </span><span class="string">"$export_symbols_regex"</span><span class="symbol">;</span><span class="normal"> </span><span class="keyword">then</span>
<span class="normal">	  </span><span class="variable">$echo</span><span class="normal"> </span><span class="string">"$modename: more than one -exported-symbols argument is not allowed"</span>
<span class="normal">	  </span><span class="keyword">exit</span><span class="normal"> </span><span class="variable">$EXIT_FAILURE</span>
<span class="normal">	</span><span class="keyword">fi</span>
<span class="normal">	</span><span class="keyword">if</span><span class="normal"> </span><span class="keyword">test</span><span class="normal"> </span><span class="string">"X$arg"</span><span class="normal"> </span><span class="symbol">=</span><span class="normal"> </span><span class="string">"X-export-symbols"</span><span class="symbol">;</span><span class="normal"> </span><span class="keyword">then</span>
<span class="normal">	  </span><span class="variable">prev</span><span class="symbol">=</span><span class="normal">expsyms</span>
<span class="normal">	</span><span class="keyword">else</span>
<span class="normal">	  </span><span class="variable">prev</span><span class="symbol">=</span><span class="normal">expsyms_regex</span>
<span class="normal">	</span><span class="keyword">fi</span>
<span class="normal">	</span><span class="keyword">continue</span>
<span class="normal">	</span><span class="symbol">;;</span>

<span class="normal">      -framework</span><span class="symbol">|</span><span class="normal">-arch</span><span class="symbol">|</span><span class="normal">-isysroot</span><span class="symbol">)</span>
<span class="normal">	</span><span class="keyword">case</span><span class="normal"> </span><span class="string">" $CC "</span><span class="normal"> </span><span class="keyword">in</span>
<span class="normal">	  </span><span class="symbol">*</span><span class="string">" ${arg} ${1} "</span><span class="symbol">*</span><span class="normal"> </span><span class="symbol">|</span><span class="normal"> </span><span class="symbol">*</span><span class="string">" ${arg}	${1} "</span><span class="symbol">*)</span><span class="normal"> </span>
<span class="normal">		</span><span class="variable">prev</span><span class="symbol">=</span><span class="normal">darwin_framework_skip </span><span class="symbol">;;</span>
<span class="normal">	  </span><span class="symbol">*)</span><span class="normal"> </span><span class="variable">compiler_flags</span><span class="symbol">=</span><span class="string">"$compiler_flags $arg"</span>
<span class="normal">	     </span><span class="variable">prev</span><span class="symbol">=</span><span class="normal">darwin_framework </span><span class="symbol">;;</span>
<span class="normal">	</span><span class="keyword">esac</span>
<span class="normal">	</span><span class="variable">compile_command</span><span class="symbol">=</span><span class="string">"$compile_command $arg"</span>
<span class="normal">	</span><span class="variable">finalize_command</span><span class="symbol">=</span><span class="string">"$finalize_command $arg"</span>
<span class="normal">	</span><span class="keyword">continue</span>
<span class="normal">	</span><span class="symbol">;;</span>

<span class="normal">      -inst-prefix-dir</span><span class="symbol">)</span>
<span class="normal">	</span><span class="variable">prev</span><span class="symbol">=</span><span class="normal">inst_prefix</span>
<span class="normal">	</span><span class="keyword">continue</span>
<span class="normal">	</span><span class="symbol">;;</span>

<span class="normal">      </span><span class="comment"># The native IRIX linker understands -LANG:*, -LIST:* and -LNO:*</span>
<span class="normal">      </span><span class="comment"># so, if we see these flags be careful not to treat them like -L</span>
<span class="normal">      -L</span><span class="symbol">[</span><span class="normal">A-Z</span><span class="symbol">][</span><span class="normal">A-Z</span><span class="symbol">]*:*)</span>
<span class="normal">	</span><span class="keyword">case</span><span class="normal"> </span><span class="variable">$with_gcc</span><span class="symbol">/</span><span class="variable">$host</span><span class="normal"> </span><span class="keyword">in</span>
<span class="normal">	no</span><span class="symbol">/*</span><span class="normal">-</span><span class="symbol">*</span><span class="normal">-irix</span><span class="symbol">*</span><span class="normal"> </span><span class="symbol">|</span><span class="normal"> </span><span class="symbol">/*</span><span class="normal">-</span><span class="symbol">*</span><span class="normal">-irix</span><span class="symbol">*)</span>
<span class="normal">	  </span><span class="variable">compile_command</span><span class="symbol">=</span><span class="string">"$compile_command $arg"</span>
<span class="normal">	  </span><span class="variable">finalize_command</span><span class="symbol">=</span><span class="string">"$finalize_command $arg"</span>
<span class="normal">	  </span><span class="symbol">;;</span>
<span class="normal">	</span><span class="keyword">esac</span>
<span class="normal">	</span><span class="keyword">continue</span>
<span class="normal">	</span><span class="symbol">;;</span>

<span class="normal">      -L</span><span class="symbol">*)</span>
<span class="normal">	</span><span class="variable">dir</span><span class="symbol">=</span><span class="normal">`</span><span class="variable">$echo</span><span class="normal"> </span><span class="string">"X$arg"</span><span class="normal"> </span><span class="symbol">|</span><span class="normal"> </span><span class="variable">$Xsed</span><span class="normal"> -e </span><span class="string">'s/^-L//'</span><span class="normal">`</span>
<span class="normal">	</span><span class="comment"># We need an absolute path.</span>
<span class="normal">	</span><span class="keyword">case</span><span class="normal"> </span><span class="variable">$dir</span><span class="normal"> </span><span class="keyword">in</span>
<span class="normal">	</span><span class="symbol">[\\/]*</span><span class="normal"> </span><span class="symbol">|</span><span class="normal"> </span><span class="symbol">[</span><span class="normal">A-Za-z</span><span class="symbol">]:[\\/]*)</span><span class="normal"> </span><span class="symbol">;;</span>
<span class="normal">	</span><span class="symbol">*)</span>
<span class="normal">	  </span><span class="variable">absdir</span><span class="symbol">=</span><span class="normal">`cd </span><span class="string">"$dir"</span><span class="normal"> </span><span class="symbol">&amp;&amp;</span><span class="normal"> pwd`</span>
<span class="normal">	  </span><span class="keyword">if</span><span class="normal"> </span><span class="keyword">test</span><span class="normal"> -z </span><span class="string">"$absdir"</span><span class="symbol">;</span><span class="normal"> </span><span class="keyword">then</span>
<span class="normal">	    </span><span class="variable">$echo</span><span class="normal"> </span><span class="string">"$modename: cannot determine absolute directory name of </span><span class="specialchar">\`</span><span class="string">$dir'"</span><span class="normal"> </span><span class="number">1</span><span class="symbol">&gt;&amp;</span><span class="number">2</span>
<span class="normal">	    </span><span class="variable">absdir</span><span class="symbol">=</span><span class="string">"$dir"</span>
<span class="normal">	    </span><span class="variable">notinst_path</span><span class="symbol">=</span><span class="string">"$notinst_path $dir"</span>
<span class="normal">	  </span><span class="keyword">fi</span>
<span class="normal">	  </span><span class="variable">dir</span><span class="symbol">=</span><span class="string">"$absdir"</span>
<span class="normal">	  </span><span class="symbol">;;</span>
<span class="normal">	</span><span class="keyword">esac</span>
<span class="normal">	</span><span class="keyword">case</span><span class="normal"> </span><span class="string">"$deplibs "</span><span class="normal"> </span><span class="keyword">in</span>
<span class="normal">	</span><span class="symbol">*</span><span class="string">" -L$dir "</span><span class="symbol">*)</span><span class="normal"> </span><span class="symbol">;;</span>
<span class="normal">	</span><span class="symbol">*)</span>
<span class="normal">	  </span><span class="variable">deplibs</span><span class="symbol">=</span><span class="string">"$deplibs -L$dir"</span>
<span class="normal">	  </span><span class="variable">lib_search_path</span><span class="symbol">=</span><span class="string">"$lib_search_path $dir"</span>
<span class="normal">	  </span><span class="symbol">;;</span>
<span class="normal">	</span><span class="keyword">esac</span>
<span class="normal">	</span><span class="keyword">case</span><span class="normal"> </span><span class="variable">$host</span><span class="normal"> </span><span class="keyword">in</span>
<span class="normal">	</span><span class="symbol">*</span><span class="normal">-</span><span class="symbol">*</span><span class="normal">-cygwin</span><span class="symbol">*</span><span class="normal"> </span><span class="symbol">|</span><span class="normal"> </span><span class="symbol">*</span><span class="normal">-</span><span class="symbol">*</span><span class="normal">-mingw</span><span class="symbol">*</span><span class="normal"> </span><span class="symbol">|</span><span class="normal"> </span><span class="symbol">*</span><span class="normal">-</span><span class="symbol">*</span><span class="normal">-pw</span><span class="number">32</span><span class="symbol">*</span><span class="normal"> </span><span class="symbol">|</span><span class="normal"> </span><span class="symbol">*</span><span class="normal">-</span><span class="symbol">*</span><span class="normal">-os</span><span class="number">2</span><span class="symbol">*)</span>
<span class="normal">	  </span><span class="variable">testbindir</span><span class="symbol">=</span><span class="normal">`</span><span class="variable">$echo</span><span class="normal"> </span><span class="string">"X$dir"</span><span class="normal"> </span><span class="symbol">|</span><span class="normal"> </span><span class="variable">$Xsed</span><span class="normal"> -e </span><span class="string">'s*/lib$*/bin*'</span><span class="normal">`</span>
<span class="normal">	  </span><span class="keyword">case</span><span class="normal"> </span><span class="symbol">:</span><span class="variable">$dllsearchpath</span><span class="symbol">:</span><span class="normal"> </span><span class="keyword">in</span>
<span class="normal">	  </span><span class="symbol">*</span><span class="string">":$dir:"</span><span class="symbol">*)</span><span class="normal"> </span><span class="symbol">;;</span>
<span class="normal">	  </span><span class="symbol">*)</span><span class="normal"> </span><span class="variable">dllsearchpath</span><span class="symbol">=</span><span class="string">"$dllsearchpath:$dir"</span><span class="symbol">;;</span>
<span class="normal">	  </span><span class="keyword">esac</span>
<span class="normal">	  </span><span class="keyword">case</span><span class="normal"> </span><span class="symbol">:</span><span class="variable">$dllsearchpath</span><span class="symbol">:</span><span class="normal"> </span><span class="keyword">in</span>
<span class="normal">	  </span><span class="symbol">*</span><span class="string">":$testbindir:"</span><span class="symbol">*)</span><span class="normal"> </span><span class="symbol">;;</span>
<span class="normal">	  </span><span class="symbol">*)</span><span class="normal"> </span><span class="variable">dllsearchpath</span><span class="symbol">=</span><span class="string">"$dllsearchpath:$testbindir"</span><span class="symbol">;;</span>
<span class="normal">	  </span><span class="keyword">esac</span>
<span class="normal">	  </span><span class="symbol">;;</span>
<span class="normal">	</span><span class="keyword">esac</span>
<span class="normal">	</span><span class="keyword">continue</span>
<span class="normal">	</span><span class="symbol">;;</span>

<span class="normal">      -l</span><span class="symbol">*)</span>
<span class="normal">	</span><span class="keyword">if</span><span class="normal"> </span><span class="keyword">test</span><span class="normal"> </span><span class="string">"X$arg"</span><span class="normal"> </span><span class="symbol">=</span><span class="normal"> </span><span class="string">"X-lc"</span><span class="normal"> </span><span class="symbol">||</span><span class="normal"> </span><span class="keyword">test</span><span class="normal"> </span><span class="string">"X$arg"</span><span class="normal"> </span><span class="symbol">=</span><span class="normal"> </span><span class="string">"X-lm"</span><span class="symbol">;</span><span class="normal"> </span><span class="keyword">then</span>
<span class="normal">	  </span><span class="keyword">case</span><span class="normal"> </span><span class="variable">$host</span><span class="normal"> </span><span class="keyword">in</span>
<span class="normal">	  </span><span class="symbol">*</span><span class="normal">-</span><span class="symbol">*</span><span class="normal">-cygwin</span><span class="symbol">*</span><span class="normal"> </span><span class="symbol">|</span><span class="normal"> </span><span class="symbol">*</span><span class="normal">-</span><span class="symbol">*</span><span class="normal">-mingw</span><span class="symbol">*</span><span class="normal"> </span><span class="symbol">|</span><span class="normal"> </span><span class="symbol">*</span><span class="normal">-</span><span class="symbol">*</span><span class="normal">-pw</span><span class="number">32</span><span class="symbol">*</span><span class="normal"> </span><span class="symbol">|</span><span class="normal"> </span><span class="symbol">*</span><span class="normal">-</span><span class="symbol">*</span><span class="normal">-beos</span><span class="symbol">*)</span>
<span class="normal">	    </span><span class="comment"># These systems don't actually have a C or math library (as such)</span>
<span class="normal">	    </span><span class="keyword">continue</span>
<span class="normal">	    </span><span class="symbol">;;</span>
<span class="normal">	  </span><span class="symbol">*</span><span class="normal">-</span><span class="symbol">*</span><span class="normal">-os</span><span class="number">2</span><span class="symbol">*)</span>
<span class="normal">	    </span><span class="comment"># These systems don't actually have a C library (as such)</span>
<span class="normal">	    </span><span class="keyword">test</span><span class="normal"> </span><span class="string">"X$arg"</span><span class="normal"> </span><span class="symbol">=</span><span class="normal"> </span><span class="string">"X-lc"</span><span class="normal"> </span><span class="symbol">&amp;&amp;</span><span class="normal"> </span><span class="keyword">continue</span>
<span class="normal">	    </span><span class="symbol">;;</span>
<span class="normal">	  </span><span class="symbol">*</span><span class="normal">-</span><span class="symbol">*</span><span class="normal">-openbsd</span><span class="symbol">*</span><span class="normal"> </span><span class="symbol">|</span><span class="normal"> </span><span class="symbol">*</span><span class="normal">-</span><span class="symbol">*</span><span class="normal">-freebsd</span><span class="symbol">*</span><span class="normal"> </span><span class="symbol">|</span><span class="normal"> </span><span class="symbol">*</span><span class="normal">-</span><span class="symbol">*</span><span class="normal">-dragonfly</span><span class="symbol">*)</span>
<span class="normal">	    </span><span class="comment"># Do not include libc due to us having libc/libc_r.</span>
<span class="normal">	    </span><span class="keyword">test</span><span class="normal"> </span><span class="string">"X$arg"</span><span class="normal"> </span><span class="symbol">=</span><span class="normal"> </span><span class="string">"X-lc"</span><span class="normal"> </span><span class="symbol">&amp;&amp;</span><span class="normal"> </span><span class="keyword">continue</span>
<span class="normal">	    </span><span class="symbol">;;</span>
<span class="normal">	  </span><span class="symbol">*</span><span class="normal">-</span><span class="symbol">*</span><span class="normal">-rhapsody</span><span class="symbol">*</span><span class="normal"> </span><span class="symbol">|</span><span class="normal"> </span><span class="symbol">*</span><span class="normal">-</span><span class="symbol">*</span><span class="normal">-darwin</span><span class="number">1</span><span class="symbol">.[</span><span class="number">012</span><span class="symbol">])</span>
<span class="normal">	    </span><span class="comment"># Rhapsody C and math libraries are in the System framework</span>
<span class="normal">	    </span><span class="variable">deplibs</span><span class="symbol">=</span><span class="string">"$deplibs -framework System"</span>
<span class="normal">	    </span><span class="keyword">continue</span>
<span class="normal">	    </span><span class="symbol">;;</span>
<span class="normal">	  </span><span class="symbol">*</span><span class="normal">-</span><span class="symbol">*</span><span class="normal">-sco</span><span class="number">3</span><span class="symbol">.</span><span class="normal">2v5</span><span class="symbol">*</span><span class="normal"> </span><span class="symbol">|</span><span class="normal"> </span><span class="symbol">*</span><span class="normal">-</span><span class="symbol">*</span><span class="normal">-sco5v6</span><span class="symbol">*)</span>
<span class="normal">	    </span><span class="comment"># Causes problems with __ctype</span>
<span class="normal">	    </span><span class="keyword">test</span><span class="normal"> </span><span class="string">"X$arg"</span><span class="normal"> </span><span class="symbol">=</span><span class="normal"> </span><span class="string">"X-lc"</span><span class="normal"> </span><span class="symbol">&amp;&amp;</span><span class="normal"> </span><span class="keyword">continue</span>
<span class="normal">	    </span><span class="symbol">;;</span>
<span class="normal">	  </span><span class="symbol">*</span><span class="normal">-</span><span class="symbol">*</span><span class="normal">-sysv</span><span class="number">4</span><span class="symbol">.</span><span class="normal">2uw2</span><span class="symbol">*</span><span class="normal"> </span><span class="symbol">|</span><span class="normal"> </span><span class="symbol">*</span><span class="normal">-</span><span class="symbol">*</span><span class="normal">-sysv</span><span class="number">5</span><span class="symbol">*</span><span class="normal"> </span><span class="symbol">|</span><span class="normal"> </span><span class="symbol">*</span><span class="normal">-</span><span class="symbol">*</span><span class="normal">-unixware</span><span class="symbol">*</span><span class="normal"> </span><span class="symbol">|</span><span class="normal"> </span><span class="symbol">*</span><span class="normal">-</span><span class="symbol">*</span><span class="normal">-OpenUNIX</span><span class="symbol">*)</span>
<span class="normal">	    </span><span class="comment"># Compiler inserts libc in the correct place for threads to work</span>
<span class="normal">	    </span><span class="keyword">test</span><span class="normal"> </span><span class="string">"X$arg"</span><span class="normal"> </span><span class="symbol">=</span><span class="normal"> </span><span class="string">"X-lc"</span><span class="normal"> </span><span class="symbol">&amp;&amp;</span><span class="normal"> </span><span class="keyword">continue</span>
<span class="normal">	    </span><span class="symbol">;;</span>
<span class="normal">	  </span><span class="keyword">esac</span>
<span class="normal">	</span><span class="keyword">elif</span><span class="normal"> </span><span class="keyword">test</span><span class="normal"> </span><span class="string">"X$arg"</span><span class="normal"> </span><span class="symbol">=</span><span class="normal"> </span><span class="string">"X-lc_r"</span><span class="symbol">;</span><span class="normal"> </span><span class="keyword">then</span>
<span class="normal">	 </span><span class="keyword">case</span><span class="normal"> </span><span class="variable">$host</span><span class="normal"> </span><span class="keyword">in</span>
<span class="normal">	 </span><span class="symbol">*</span><span class="normal">-</span><span class="symbol">*</span><span class="normal">-openbsd</span><span class="symbol">*</span><span class="normal"> </span><span class="symbol">|</span><span class="normal"> </span><span class="symbol">*</span><span class="normal">-</span><span class="symbol">*</span><span class="normal">-freebsd</span><span class="symbol">*</span><span class="normal"> </span><span class="symbol">|</span><span class="normal"> </span><span class="symbol">*</span><span class="normal">-</span><span class="symbol">*</span><span class="normal">-dragonfly</span><span class="symbol">*)</span>
<span class="normal">	   </span><span class="comment"># Do not include libc_r directly, use -pthread flag.</span>
<span class="normal">	   </span><span class="keyword">continue</span>
<span class="normal">	   </span><span class="symbol">;;</span>
<span class="normal">	 </span><span class="keyword">esac</span>
<span class="normal">	</span><span class="keyword">fi</span>
<span class="normal">	</span><span class="variable">deplibs</span><span class="symbol">=</span><span class="string">"$deplibs $arg"</span>
<span class="normal">	</span><span class="keyword">continue</span>
<span class="normal">	</span><span class="symbol">;;</span>

<span class="normal">      </span><span class="comment"># Tru64 UNIX uses -model [arg] to determine the layout of C++</span>
<span class="normal">      </span><span class="comment"># classes, name mangling, and exception handling.</span>
<span class="normal">      -model</span><span class="symbol">)</span>
<span class="normal">	</span><span class="variable">compile_command</span><span class="symbol">=</span><span class="string">"$compile_command $arg"</span>
<span class="normal">	</span><span class="variable">compiler_flags</span><span class="symbol">=</span><span class="string">"$compiler_flags $arg"</span>
<span class="normal">	</span><span class="variable">finalize_command</span><span class="symbol">=</span><span class="string">"$finalize_command $arg"</span>
<span class="normal">	</span><span class="variable">prev</span><span class="symbol">=</span><span class="normal">xcompiler</span>
<span class="normal">	</span><span class="keyword">continue</span>
<span class="normal">	</span><span class="symbol">;;</span>

<span class="normal">     -mt</span><span class="symbol">|</span><span class="normal">-mthreads</span><span class="symbol">|</span><span class="normal">-kthread</span><span class="symbol">|</span><span class="normal">-Kthread</span><span class="symbol">|</span><span class="normal">-pthread</span><span class="symbol">|</span><span class="normal">-pthreads</span><span class="symbol">|</span><span class="normal">--thread-safe</span><span class="symbol">|</span><span class="normal">-threads</span><span class="symbol">)</span>
<span class="normal">	</span><span class="variable">compiler_flags</span><span class="symbol">=</span><span class="string">"$compiler_flags $arg"</span>
<span class="normal">	</span><span class="variable">compile_command</span><span class="symbol">=</span><span class="string">"$compile_command $arg"</span>
<span class="normal">	</span><span class="variable">finalize_command</span><span class="symbol">=</span><span class="string">"$finalize_command $arg"</span>
<span class="normal">	</span><span class="keyword">continue</span>
<span class="normal">	</span><span class="symbol">;;</span>

<span class="normal">      -module</span><span class="symbol">)</span>
<span class="normal">	</span><span class="variable">module</span><span class="symbol">=</span><span class="normal">yes</span>
<span class="normal">	</span><span class="keyword">continue</span>
<span class="normal">	</span><span class="symbol">;;</span>

<span class="normal">      </span><span class="comment"># -64, -mips[0-9] enable 64-bit mode on the SGI compiler</span>
<span class="normal">      </span><span class="comment"># -r[0-9][0-9]* specifies the processor on the SGI compiler</span>
<span class="normal">      </span><span class="comment"># -xarch=*, -xtarget=* enable 64-bit mode on the Sun compiler</span>
<span class="normal">      </span><span class="comment"># +DA*, +DD* enable 64-bit mode on the HP compiler</span>
<span class="normal">      </span><span class="comment"># -q* pass through compiler args for the IBM compiler</span>
<span class="normal">      </span><span class="comment"># -m* pass through architecture-specific compiler args for GCC</span>
<span class="normal">      </span><span class="comment"># -m*, -t[45]*, -txscale* pass through architecture-specific</span>
<span class="normal">      </span><span class="comment"># compiler args for GCC</span>
<span class="normal">      </span><span class="comment"># -p, -pg, --coverage, -fprofile-* pass through profiling flag for GCC</span>
<span class="normal">      </span><span class="comment"># -F/path gives path to uninstalled frameworks, gcc on darwin</span>
<span class="normal">      </span><span class="comment"># @file GCC response files</span>
<span class="normal">      -</span><span class="number">64</span><span class="symbol">|</span><span class="normal">-mips</span><span class="symbol">[</span><span class="number">0</span><span class="normal">-</span><span class="number">9</span><span class="symbol">]|</span><span class="normal">-r</span><span class="symbol">[</span><span class="number">0</span><span class="normal">-</span><span class="number">9</span><span class="symbol">][</span><span class="number">0</span><span class="normal">-</span><span class="number">9</span><span class="symbol">]*|</span><span class="normal">-xarch</span><span class="symbol">=*|</span><span class="normal">-xtarget</span><span class="symbol">=*|+</span><span class="normal">DA</span><span class="symbol">*|+</span><span class="normal">DD</span><span class="symbol">*|</span><span class="normal">-q</span><span class="symbol">*|</span><span class="normal">-m</span><span class="symbol">*|</span><span class="normal"> </span><span class="symbol">\</span>
<span class="normal">      -t</span><span class="symbol">[</span><span class="number">45</span><span class="symbol">]*|</span><span class="normal">-txscale</span><span class="symbol">*|</span><span class="normal">-p</span><span class="symbol">|</span><span class="normal">-pg</span><span class="symbol">|</span><span class="normal">--coverage</span><span class="symbol">|</span><span class="normal">-fprofile-</span><span class="symbol">*|</span><span class="normal">-F</span><span class="symbol">*|</span><span class="normal">@</span><span class="symbol">*)</span>

<span class="normal">	</span><span class="comment"># Unknown arguments in both finalize_command and compile_command need</span>
<span class="normal">	</span><span class="comment"># to be aesthetically quoted because they are evaled later.</span>
<span class="normal">	</span><span class="variable">arg</span><span class="symbol">=</span><span class="normal">`</span><span class="variable">$echo</span><span class="normal"> </span><span class="string">"X$arg"</span><span class="normal"> </span><span class="symbol">|</span><span class="normal"> </span><span class="variable">$Xsed</span><span class="normal"> -e </span><span class="string">"$sed_quote_subst"</span><span class="normal">`</span>
<span class="normal">	</span><span class="keyword">case</span><span class="normal"> </span><span class="variable">$arg</span><span class="normal"> </span><span class="keyword">in</span>
<span class="normal">	</span><span class="symbol">*[\[\~\</span><span class="comment">#\^\&amp;\*\(\)\{\}\|\;\&lt;\&gt;\?\'\ \	]*|*]*|"")</span>
<span class="normal">	  </span><span class="variable">arg</span><span class="symbol">=</span><span class="string">"</span><span class="specialchar">\"</span><span class="string">$arg</span><span class="specialchar">\"</span><span class="string">"</span>
<span class="normal">	  </span><span class="symbol">;;</span>
<span class="normal">	</span><span class="keyword">esac</span>
<span class="normal">        </span><span class="variable">compile_command</span><span class="symbol">=</span><span class="string">"$compile_command $arg"</span>
<span class="normal">        </span><span class="variable">finalize_command</span><span class="symbol">=</span><span class="string">"$finalize_command $arg"</span>
<span class="normal">        </span><span class="variable">compiler_flags</span><span class="symbol">=</span><span class="string">"$compiler_flags $arg"</span>
<span class="normal">        </span><span class="keyword">continue</span>
<span class="normal">        </span><span class="symbol">;;</span>

<span class="normal">      -shrext</span><span class="symbol">)</span>
<span class="normal">	</span><span class="variable">prev</span><span class="symbol">=</span><span class="normal">shrext</span>
<span class="normal">	</span><span class="keyword">continue</span>
<span class="normal">	</span><span class="symbol">;;</span>

<span class="normal">      -no-fast-install</span><span class="symbol">)</span>
<span class="normal">	</span><span class="variable">fast_install</span><span class="symbol">=</span><span class="normal">no</span>
<span class="normal">	</span><span class="keyword">continue</span>
<span class="normal">	</span><span class="symbol">;;</span>

<span class="normal">      -no-install</span><span class="symbol">)</span>
<span class="normal">	</span><span class="keyword">case</span><span class="normal"> </span><span class="variable">$host</span><span class="normal"> </span><span class="keyword">in</span>
<span class="normal">	</span><span class="symbol">*</span><span class="normal">-</span><span class="symbol">*</span><span class="normal">-cygwin</span><span class="symbol">*</span><span class="normal"> </span><span class="symbol">|</span><span class="normal"> </span><span class="symbol">*</span><span class="normal">-</span><span class="symbol">*</span><span class="normal">-mingw</span><span class="symbol">*</span><span class="normal"> </span><span class="symbol">|</span><span class="normal"> </span><span class="symbol">*</span><span class="normal">-</span><span class="symbol">*</span><span class="normal">-pw</span><span class="number">32</span><span class="symbol">*</span><span class="normal"> </span><span class="symbol">|</span><span class="normal"> </span><span class="symbol">*</span><span class="normal">-</span><span class="symbol">*</span><span class="normal">-os</span><span class="number">2</span><span class="symbol">*)</span>
<span class="normal">	  </span><span class="comment"># The PATH hackery in wrapper scripts is required on Windows</span>
<span class="normal">	  </span><span class="comment"># in order for the loader to find any dlls it needs.</span>
<span class="normal">	  </span><span class="variable">$echo</span><span class="normal"> </span><span class="string">"$modename: warning: </span><span class="specialchar">\`</span><span class="string">-no-install' is ignored for $host"</span><span class="normal"> </span><span class="number">1</span><span class="symbol">&gt;&amp;</span><span class="number">2</span>
<span class="normal">	  </span><span class="variable">$echo</span><span class="normal"> </span><span class="string">"$modename: warning: assuming </span><span class="specialchar">\`</span><span class="string">-no-fast-install' instead"</span><span class="normal"> </span><span class="number">1</span><span class="symbol">&gt;&amp;</span><span class="number">2</span>
<span class="normal">	  </span><span class="variable">fast_install</span><span class="symbol">=</span><span class="normal">no</span>
<span class="normal">	  </span><span class="symbol">;;</span>
<span class="normal">	</span><span class="symbol">*)</span><span class="normal"> </span><span class="variable">no_install</span><span class="symbol">=</span><span class="normal">yes </span><span class="symbol">;;</span>
<span class="normal">	</span><span class="keyword">esac</span>
<span class="normal">	</span><span class="keyword">continue</span>
<span class="normal">	</span><span class="symbol">;;</span>

<span class="normal">      -no-undefined</span><span class="symbol">)</span>
<span class="normal">	</span><span class="variable">allow_undefined</span><span class="symbol">=</span><span class="normal">no</span>
<span class="normal">	</span><span class="keyword">continue</span>
<span class="normal">	</span><span class="symbol">;;</span>

<span class="normal">      -objectlist</span><span class="symbol">)</span>
<span class="normal">	</span><span class="variable">prev</span><span class="symbol">=</span><span class="normal">objectlist</span>
<span class="normal">	</span><span class="keyword">continue</span>
<span class="normal">	</span><span class="symbol">;;</span>

<span class="normal">      -o</span><span class="symbol">)</span><span class="normal"> </span><span class="variable">prev</span><span class="symbol">=</span><span class="normal">output </span><span class="symbol">;;</span>

<span class="normal">      -precious-files-regex</span><span class="symbol">)</span>
<span class="normal">	</span><span class="variable">prev</span><span class="symbol">=</span><span class="normal">precious_regex</span>
<span class="normal">	</span><span class="keyword">continue</span>
<span class="normal">	</span><span class="symbol">;;</span>

<span class="normal">      -release</span><span class="symbol">)</span>
<span class="normal">	</span><span class="variable">prev</span><span class="symbol">=</span><span class="normal">release</span>
<span class="normal">	</span><span class="keyword">continue</span>
<span class="normal">	</span><span class="symbol">;;</span>

<span class="normal">      -rpath</span><span class="symbol">)</span>
<span class="normal">	</span><span class="variable">prev</span><span class="symbol">=</span><span class="normal">rpath</span>
<span class="normal">	</span><span class="keyword">continue</span>
<span class="normal">	</span><span class="symbol">;;</span>

<span class="normal">      -R</span><span class="symbol">)</span>
<span class="normal">	</span><span class="variable">prev</span><span class="symbol">=</span><span class="normal">xrpath</span>
<span class="normal">	</span><span class="keyword">continue</span>
<span class="normal">	</span><span class="symbol">;;</span>

<span class="normal">      -R</span><span class="symbol">*)</span>
<span class="normal">	</span><span class="variable">dir</span><span class="symbol">=</span><span class="normal">`</span><span class="variable">$echo</span><span class="normal"> </span><span class="string">"X$arg"</span><span class="normal"> </span><span class="symbol">|</span><span class="normal"> </span><span class="variable">$Xsed</span><span class="normal"> -e </span><span class="string">'s/^-R//'</span><span class="normal">`</span>
<span class="normal">	</span><span class="comment"># We need an absolute path.</span>
<span class="normal">	</span><span class="keyword">case</span><span class="normal"> </span><span class="variable">$dir</span><span class="normal"> </span><span class="keyword">in</span>
<span class="normal">	</span><span class="symbol">[\\/]*</span><span class="normal"> </span><span class="symbol">|</span><span class="normal"> </span><span class="symbol">[</span><span class="normal">A-Za-z</span><span class="symbol">]:[\\/]*)</span><span class="normal"> </span><span class="symbol">;;</span>
<span class="normal">	</span><span class="symbol">*)</span>
<span class="normal">	  </span><span class="variable">$echo</span><span class="normal"> </span><span class="string">"$modename: only absolute run-paths are allowed"</span><span class="normal"> </span><span class="number">1</span><span class="symbol">&gt;&amp;</span><span class="number">2</span>
<span class="normal">	  </span><span class="keyword">exit</span><span class="normal"> </span><span class="variable">$EXIT_FAILURE</span>
<span class="normal">	  </span><span class="symbol">;;</span>
<span class="normal">	</span><span class="keyword">esac</span>
<span class="normal">	</span><span class="keyword">case</span><span class="normal"> </span><span class="string">"$xrpath "</span><span class="normal"> </span><span class="keyword">in</span>
<span class="normal">	</span><span class="symbol">*</span><span class="string">" $dir "</span><span class="symbol">*)</span><span class="normal"> </span><span class="symbol">;;</span>
<span class="normal">	</span><span class="symbol">*)</span><span class="normal"> </span><span class="variable">xrpath</span><span class="symbol">=</span><span class="string">"$xrpath $dir"</span><span class="normal"> </span><span class="symbol">;;</span>
<span class="normal">	</span><span class="keyword">esac</span>
<span class="normal">	</span><span class="keyword">continue</span>
<span class="normal">	</span><span class="symbol">;;</span>

<span class="normal">      -static </span><span class="symbol">|</span><span class="normal"> -static-libtool-libs</span><span class="symbol">)</span>
<span class="normal">	</span><span class="comment"># The effects of -static are defined in a previous loop.</span>
<span class="normal">	</span><span class="comment"># We used to do the same as -all-static on platforms that</span>
<span class="normal">	</span><span class="comment"># didn't have a PIC flag, but the assumption that the effects</span>
<span class="normal">	</span><span class="comment"># would be equivalent was wrong.  It would break on at least</span>
<span class="normal">	</span><span class="comment"># Digital Unix and AIX.</span>
<span class="normal">	</span><span class="keyword">continue</span>
<span class="normal">	</span><span class="symbol">;;</span>

<span class="normal">      -thread-safe</span><span class="symbol">)</span>
<span class="normal">	</span><span class="variable">thread_safe</span><span class="symbol">=</span><span class="normal">yes</span>
<span class="normal">	</span><span class="keyword">continue</span>
<span class="normal">	</span><span class="symbol">;;</span>

<span class="normal">      -version-info</span><span class="symbol">)</span>
<span class="normal">	</span><span class="variable">prev</span><span class="symbol">=</span><span class="normal">vinfo</span>
<span class="normal">	</span><span class="keyword">continue</span>
<span class="normal">	</span><span class="symbol">;;</span>
<span class="normal">      -version-number</span><span class="symbol">)</span>
<span class="normal">	</span><span class="variable">prev</span><span class="symbol">=</span><span class="normal">vinfo</span>
<span class="normal">	</span><span class="variable">vinfo_number</span><span class="symbol">=</span><span class="normal">yes</span>
<span class="normal">	</span><span class="keyword">continue</span>
<span class="normal">	</span><span class="symbol">;;</span>

<span class="normal">      -Wc</span><span class="symbol">,*)</span>
<span class="normal">	</span><span class="variable">args</span><span class="symbol">=</span><span class="normal">`</span><span class="variable">$echo</span><span class="normal"> </span><span class="string">"X$arg"</span><span class="normal"> </span><span class="symbol">|</span><span class="normal"> </span><span class="variable">$Xsed</span><span class="normal"> -e </span><span class="string">"$sed_quote_subst"</span><span class="normal"> -e </span><span class="string">'s/^-Wc,//'</span><span class="normal">`</span>
<span class="normal">	</span><span class="variable">arg</span><span class="symbol">=</span>
<span class="normal">	</span><span class="variable">save_ifs</span><span class="symbol">=</span><span class="string">"$IFS"</span><span class="symbol">;</span><span class="normal"> </span><span class="variable">IFS</span><span class="symbol">=</span><span class="string">','</span>
<span class="normal">	</span><span class="keyword">for</span><span class="normal"> flag </span><span class="keyword">in</span><span class="normal"> </span><span class="variable">$args</span><span class="symbol">;</span><span class="normal"> </span><span class="keyword">do</span>
<span class="normal">	  </span><span class="variable">IFS</span><span class="symbol">=</span><span class="string">"$save_ifs"</span>
<span class="normal">	  </span><span class="keyword">case</span><span class="normal"> </span><span class="variable">$flag</span><span class="normal"> </span><span class="keyword">in</span>
<span class="normal">	    </span><span class="symbol">*[\[\~\</span><span class="comment">#\^\&amp;\*\(\)\{\}\|\;\&lt;\&gt;\?\'\ \	]*|*]*|"")</span>
<span class="normal">	    </span><span class="variable">flag</span><span class="symbol">=</span><span class="string">"</span><span class="specialchar">\"</span><span class="string">$flag</span><span class="specialchar">\"</span><span class="string">"</span>
<span class="normal">	    </span><span class="symbol">;;</span>
<span class="normal">	  </span><span class="keyword">esac</span>
<span class="normal">	  </span><span class="variable">arg</span><span class="symbol">=</span><span class="string">"$arg $wl$flag"</span>
<span class="normal">	  </span><span class="variable">compiler_flags</span><span class="symbol">=</span><span class="string">"$compiler_flags $flag"</span>
<span class="normal">	</span><span class="keyword">done</span>
<span class="normal">	</span><span class="variable">IFS</span><span class="symbol">=</span><span class="string">"$save_ifs"</span>
<span class="normal">	</span><span class="variable">arg</span><span class="symbol">=</span><span class="normal">`</span><span class="variable">$echo</span><span class="normal"> </span><span class="string">"X$arg"</span><span class="normal"> </span><span class="symbol">|</span><span class="normal"> </span><span class="variable">$Xsed</span><span class="normal"> -e </span><span class="string">"s/^ //"</span><span class="normal">`</span>
<span class="normal">	</span><span class="symbol">;;</span>

<span class="normal">      -Wl</span><span class="symbol">,*)</span>
<span class="normal">	</span><span class="variable">args</span><span class="symbol">=</span><span class="normal">`</span><span class="variable">$echo</span><span class="normal"> </span><span class="string">"X$arg"</span><span class="normal"> </span><span class="symbol">|</span><span class="normal"> </span><span class="variable">$Xsed</span><span class="normal"> -e </span><span class="string">"$sed_quote_subst"</span><span class="normal"> -e </span><span class="string">'s/^-Wl,//'</span><span class="normal">`</span>
<span class="normal">	</span><span class="variable">arg</span><span class="symbol">=</span>
<span class="normal">	</span><span class="variable">save_ifs</span><span class="symbol">=</span><span class="string">"$IFS"</span><span class="symbol">;</span><span class="normal"> </span><span class="variable">IFS</span><span class="symbol">=</span><span class="string">','</span>
<span class="normal">	</span><span class="keyword">for</span><span class="normal"> flag </span><span class="keyword">in</span><span class="normal"> </span><span class="variable">$args</span><span class="symbol">;</span><span class="normal"> </span><span class="keyword">do</span>
<span class="normal">	  </span><span class="variable">IFS</span><span class="symbol">=</span><span class="string">"$save_ifs"</span>
<span class="normal">	  </span><span class="keyword">case</span><span class="normal"> </span><span class="variable">$flag</span><span class="normal"> </span><span class="keyword">in</span>
<span class="normal">	    </span><span class="symbol">*[\[\~\</span><span class="comment">#\^\&amp;\*\(\)\{\}\|\;\&lt;\&gt;\?\'\ \	]*|*]*|"")</span>
<span class="normal">	    </span><span class="variable">flag</span><span class="symbol">=</span><span class="string">"</span><span class="specialchar">\"</span><span class="string">$flag</span><span class="specialchar">\"</span><span class="string">"</span>
<span class="normal">	    </span><span class="symbol">;;</span>
<span class="normal">	  </span><span class="keyword">esac</span>
<span class="normal">	  </span><span class="variable">arg</span><span class="symbol">=</span><span class="string">"$arg $wl$flag"</span>
<span class="normal">	  </span><span class="variable">compiler_flags</span><span class="symbol">=</span><span class="string">"$compiler_flags $wl$flag"</span>
<span class="normal">	  </span><span class="variable">linker_flags</span><span class="symbol">=</span><span class="string">"$linker_flags $flag"</span>
<span class="normal">	</span><span class="keyword">done</span>
<span class="normal">	</span><span class="variable">IFS</span><span class="symbol">=</span><span class="string">"$save_ifs"</span>
<span class="normal">	</span><span class="variable">arg</span><span class="symbol">=</span><span class="normal">`</span><span class="variable">$echo</span><span class="normal"> </span><span class="string">"X$arg"</span><span class="normal"> </span><span class="symbol">|</span><span class="normal"> </span><span class="variable">$Xsed</span><span class="normal"> -e </span><span class="string">"s/^ //"</span><span class="normal">`</span>
<span class="normal">	</span><span class="symbol">;;</span>

<span class="normal">      -Xcompiler</span><span class="symbol">)</span>
<span class="normal">	</span><span class="variable">prev</span><span class="symbol">=</span><span class="normal">xcompiler</span>
<span class="normal">	</span><span class="keyword">continue</span>
<span class="normal">	</span><span class="symbol">;;</span>

<span class="normal">      -Xlinker</span><span class="symbol">)</span>
<span class="normal">	</span><span class="variable">prev</span><span class="symbol">=</span><span class="normal">xlinker</span>
<span class="normal">	</span><span class="keyword">continue</span>
<span class="normal">	</span><span class="symbol">;;</span>

<span class="normal">      -XCClinker</span><span class="symbol">)</span>
<span class="normal">	</span><span class="variable">prev</span><span class="symbol">=</span><span class="normal">xcclinker</span>
<span class="normal">	</span><span class="keyword">continue</span>
<span class="normal">	</span><span class="symbol">;;</span>

<span class="normal">      </span><span class="comment"># Some other compiler flag.</span>
<span class="normal">      -</span><span class="symbol">*</span><span class="normal"> </span><span class="symbol">|</span><span class="normal"> </span><span class="symbol">+*)</span>
<span class="normal">	</span><span class="comment"># Unknown arguments in both finalize_command and compile_command need</span>
<span class="normal">	</span><span class="comment"># to be aesthetically quoted because they are evaled later.</span>
<span class="normal">	</span><span class="variable">arg</span><span class="symbol">=</span><span class="normal">`</span><span class="variable">$echo</span><span class="normal"> </span><span class="string">"X$arg"</span><span class="normal"> </span><span class="symbol">|</span><span class="normal"> </span><span class="variable">$Xsed</span><span class="normal"> -e </span><span class="string">"$sed_quote_subst"</span><span class="normal">`</span>
<span class="normal">	</span><span class="keyword">case</span><span class="normal"> </span><span class="variable">$arg</span><span class="normal"> </span><span class="keyword">in</span>
<span class="normal">	</span><span class="symbol">*[\[\~\</span><span class="comment">#\^\&amp;\*\(\)\{\}\|\;\&lt;\&gt;\?\'\ \	]*|*]*|"")</span>
<span class="normal">	  </span><span class="variable">arg</span><span class="symbol">=</span><span class="string">"</span><span class="specialchar">\"</span><span class="string">$arg</span><span class="specialchar">\"</span><span class="string">"</span>
<span class="normal">	  </span><span class="symbol">;;</span>
<span class="normal">	</span><span class="keyword">esac</span>
<span class="normal">	</span><span class="symbol">;;</span>

<span class="normal">      </span><span class="symbol">*.</span><span class="variable">$objext</span><span class="symbol">)</span>
<span class="normal">	</span><span class="comment"># A standard object.</span>
<span class="normal">	</span><span class="variable">objs</span><span class="symbol">=</span><span class="string">"$objs $arg"</span>
<span class="normal">	</span><span class="symbol">;;</span>

<span class="normal">      </span><span class="symbol">*.</span><span class="normal">lo</span><span class="symbol">)</span>
<span class="normal">	</span><span class="comment"># A libtool-controlled object.</span>

<span class="normal">	</span><span class="comment"># Check to see that this really is a libtool object.</span>
<span class="normal">	</span><span class="keyword">if</span><span class="normal"> </span><span class="symbol">(</span><span class="variable">${SED}</span><span class="normal"> -e </span><span class="string">'2q'</span><span class="normal"> </span><span class="variable">$arg</span><span class="normal"> </span><span class="symbol">|</span><span class="normal"> grep </span><span class="string">"^# Generated by .*$PACKAGE"</span><span class="symbol">)</span><span class="normal"> </span><span class="symbol">&gt;</span><span class="normal">/dev/null </span><span class="number">2</span><span class="symbol">&gt;&amp;</span><span class="number">1</span><span class="symbol">;</span><span class="normal"> </span><span class="keyword">then</span>
<span class="normal">	  </span><span class="variable">pic_object</span><span class="symbol">=</span>
<span class="normal">	  </span><span class="variable">non_pic_object</span><span class="symbol">=</span>

<span class="normal">	  </span><span class="comment"># Read the .lo file</span>
<span class="normal">	  </span><span class="comment"># If there is no directory component, then add one.</span>
<span class="normal">	  </span><span class="keyword">case</span><span class="normal"> </span><span class="variable">$arg</span><span class="normal"> </span><span class="keyword">in</span>
<span class="normal">	  </span><span class="symbol">*/*</span><span class="normal"> </span><span class="symbol">|</span><span class="normal"> </span><span class="symbol">*\\*)</span><span class="normal"> </span><span class="symbol">.</span><span class="normal"> </span><span class="variable">$arg</span><span class="normal"> </span><span class="symbol">;;</span>
<span class="normal">	  </span><span class="symbol">*)</span><span class="normal"> </span><span class="symbol">.</span><span class="normal"> </span><span class="symbol">./</span><span class="variable">$arg</span><span class="normal"> </span><span class="symbol">;;</span>
<span class="normal">	  </span><span class="keyword">esac</span>

<span class="normal">	  </span><span class="keyword">if</span><span class="normal"> </span><span class="keyword">test</span><span class="normal"> -z </span><span class="string">"$pic_object"</span><span class="normal"> </span><span class="symbol">||</span><span class="normal"> </span><span class="symbol">\</span>
<span class="normal">	     </span><span class="keyword">test</span><span class="normal"> -z </span><span class="string">"$non_pic_object"</span><span class="normal"> </span><span class="symbol">||</span>
<span class="normal">	     </span><span class="keyword">test</span><span class="normal"> </span><span class="string">"$pic_object"</span><span class="normal"> </span><span class="symbol">=</span><span class="normal"> none </span><span class="symbol">&amp;&amp;</span><span class="normal"> </span><span class="symbol">\</span>
<span class="normal">	     </span><span class="keyword">test</span><span class="normal"> </span><span class="string">"$non_pic_object"</span><span class="normal"> </span><span class="symbol">=</span><span class="normal"> none</span><span class="symbol">;</span><span class="normal"> </span><span class="keyword">then</span>
<span class="normal">	    </span><span class="variable">$echo</span><span class="normal"> </span><span class="string">"$modename: cannot find name of object for </span><span class="specialchar">\`</span><span class="string">$arg'"</span><span class="normal"> </span><span class="number">1</span><span class="symbol">&gt;&amp;</span><span class="number">2</span>
<span class="normal">	    </span><span class="keyword">exit</span><span class="normal"> </span><span class="variable">$EXIT_FAILURE</span>
<span class="normal">	  </span><span class="keyword">fi</span>

<span class="normal">	  </span><span class="comment"># Extract subdirectory from the argument.</span>
<span class="normal">	  </span><span class="variable">xdir</span><span class="symbol">=</span><span class="normal">`</span><span class="variable">$echo</span><span class="normal"> </span><span class="string">"X$arg"</span><span class="normal"> </span><span class="symbol">|</span><span class="normal"> </span><span class="variable">$Xsed</span><span class="normal"> -e </span><span class="string">'s%/[^/]*$%%'</span><span class="normal">`</span>
<span class="normal">	  </span><span class="keyword">if</span><span class="normal"> </span><span class="keyword">test</span><span class="normal"> </span><span class="string">"X$xdir"</span><span class="normal"> </span><span class="symbol">=</span><span class="normal"> </span><span class="string">"X$arg"</span><span class="symbol">;</span><span class="normal"> </span><span class="keyword">then</span>
<span class="normal">	    </span><span class="variable">xdir</span><span class="symbol">=</span>
<span class="normal"> 	  </span><span class="keyword">else</span>
<span class="normal">	    </span><span class="variable">xdir</span><span class="symbol">=</span><span class="string">"$xdir/"</span>
<span class="normal">	  </span><span class="keyword">fi</span>

<span class="normal">	  </span><span class="keyword">if</span><span class="normal"> </span><span class="keyword">test</span><span class="normal"> </span><span class="string">"$pic_object"</span><span class="normal"> </span><span class="symbol">!=</span><span class="normal"> none</span><span class="symbol">;</span><span class="normal"> </span><span class="keyword">then</span>
<span class="normal">	    </span><span class="comment"># Prepend the subdirectory the object is found in.</span>
<span class="normal">	    </span><span class="variable">pic_object</span><span class="symbol">=</span><span class="string">"$xdir$pic_object"</span>

<span class="normal">	    </span><span class="keyword">if</span><span class="normal"> </span><span class="keyword">test</span><span class="normal"> </span><span class="string">"$prev"</span><span class="normal"> </span><span class="symbol">=</span><span class="normal"> dlfiles</span><span class="symbol">;</span><span class="normal"> </span><span class="keyword">then</span>
<span class="normal">	      </span><span class="keyword">if</span><span class="normal"> </span><span class="keyword">test</span><span class="normal"> </span><span class="string">"$build_libtool_libs"</span><span class="normal"> </span><span class="symbol">=</span><span class="normal"> yes </span><span class="symbol">&amp;&amp;</span><span class="normal"> </span><span class="keyword">test</span><span class="normal"> </span><span class="string">"$dlopen_support"</span><span class="normal"> </span><span class="symbol">=</span><span class="normal"> yes</span><span class="symbol">;</span><span class="normal"> </span><span class="keyword">then</span>
<span class="normal">		</span><span class="variable">dlfiles</span><span class="symbol">=</span><span class="string">"$dlfiles $pic_object"</span>
<span class="normal">		</span><span class="variable">prev</span><span class="symbol">=</span>
<span class="normal">		</span><span class="keyword">continue</span>
<span class="normal">	      </span><span class="keyword">else</span>
<span class="normal">		</span><span class="comment"># If libtool objects are unsupported, then we need to preload.</span>
<span class="normal">		</span><span class="variable">prev</span><span class="symbol">=</span><span class="normal">dlprefiles</span>
<span class="normal">	      </span><span class="keyword">fi</span>
<span class="normal">	    </span><span class="keyword">fi</span>

<span class="normal">	    </span><span class="comment"># CHECK ME:  I think I busted this.  -Ossama</span>
<span class="normal">	    </span><span class="keyword">if</span><span class="normal"> </span><span class="keyword">test</span><span class="normal"> </span><span class="string">"$prev"</span><span class="normal"> </span><span class="symbol">=</span><span class="normal"> dlprefiles</span><span class="symbol">;</span><span class="normal"> </span><span class="keyword">then</span>
<span class="normal">	      </span><span class="comment"># Preload the old-style object.</span>
<span class="normal">	      </span><span class="variable">dlprefiles</span><span class="symbol">=</span><span class="string">"$dlprefiles $pic_object"</span>
<span class="normal">	      </span><span class="variable">prev</span><span class="symbol">=</span>
<span class="normal">	    </span><span class="keyword">fi</span>

<span class="normal">	    </span><span class="comment"># A PIC object.</span>
<span class="normal">	    </span><span class="variable">libobjs</span><span class="symbol">=</span><span class="string">"$libobjs $pic_object"</span>
<span class="normal">	    </span><span class="variable">arg</span><span class="symbol">=</span><span class="string">"$pic_object"</span>
<span class="normal">	  </span><span class="keyword">fi</span>

<span class="normal">	  </span><span class="comment"># Non-PIC object.</span>
<span class="normal">	  </span><span class="keyword">if</span><span class="normal"> </span><span class="keyword">test</span><span class="normal"> </span><span class="string">"$non_pic_object"</span><span class="normal"> </span><span class="symbol">!=</span><span class="normal"> none</span><span class="symbol">;</span><span class="normal"> </span><span class="keyword">then</span>
<span class="normal">	    </span><span class="comment"># Prepend the subdirectory the object is found in.</span>
<span class="normal">	    </span><span class="variable">non_pic_object</span><span class="symbol">=</span><span class="string">"$xdir$non_pic_object"</span>

<span class="normal">	    </span><span class="comment"># A standard non-PIC object</span>
<span class="normal">	    </span><span class="variable">non_pic_objects</span><span class="symbol">=</span><span class="string">"$non_pic_objects $non_pic_object"</span>
<span class="normal">	    </span><span class="keyword">if</span><span class="normal"> </span><span class="keyword">test</span><span class="normal"> -z </span><span class="string">"$pic_object"</span><span class="normal"> </span><span class="symbol">||</span><span class="normal"> </span><span class="keyword">test</span><span class="normal"> </span><span class="string">"$pic_object"</span><span class="normal"> </span><span class="symbol">=</span><span class="normal"> none </span><span class="symbol">;</span><span class="normal"> </span><span class="keyword">then</span>
<span class="normal">	      </span><span class="variable">arg</span><span class="symbol">=</span><span class="string">"$non_pic_object"</span>
<span class="normal">	    </span><span class="keyword">fi</span>
<span class="normal">	  </span><span class="keyword">else</span>
<span class="normal">	    </span><span class="comment"># If the PIC object exists, use it instead.</span>
<span class="normal">	    </span><span class="comment"># $xdir was prepended to $pic_object above.</span>
<span class="normal">	    </span><span class="variable">non_pic_object</span><span class="symbol">=</span><span class="string">"$pic_object"</span>
<span class="normal">	    </span><span class="variable">non_pic_objects</span><span class="symbol">=</span><span class="string">"$non_pic_objects $non_pic_object"</span>
<span class="normal">	  </span><span class="keyword">fi</span>
<span class="normal">	</span><span class="keyword">else</span>
<span class="normal">	  </span><span class="comment"># Only an error if not doing a dry-run.</span>
<span class="normal">	  </span><span class="keyword">if</span><span class="normal"> </span><span class="keyword">test</span><span class="normal"> -z </span><span class="string">"$run"</span><span class="symbol">;</span><span class="normal"> </span><span class="keyword">then</span>
<span class="normal">	    </span><span class="variable">$echo</span><span class="normal"> </span><span class="string">"$modename: </span><span class="specialchar">\`</span><span class="string">$arg' is not a valid libtool object"</span><span class="normal"> </span><span class="number">1</span><span class="symbol">&gt;&amp;</span><span class="number">2</span>
<span class="normal">	    </span><span class="keyword">exit</span><span class="normal"> </span><span class="variable">$EXIT_FAILURE</span>
<span class="normal">	  </span><span class="keyword">else</span>
<span class="normal">	    </span><span class="comment"># Dry-run case.</span>

<span class="normal">	    </span><span class="comment"># Extract subdirectory from the argument.</span>
<span class="normal">	    </span><span class="variable">xdir</span><span class="symbol">=</span><span class="normal">`</span><span class="variable">$echo</span><span class="normal"> </span><span class="string">"X$arg"</span><span class="normal"> </span><span class="symbol">|</span><span class="normal"> </span><span class="variable">$Xsed</span><span class="normal"> -e </span><span class="string">'s%/[^/]*$%%'</span><span class="normal">`</span>
<span class="normal">	    </span><span class="keyword">if</span><span class="normal"> </span><span class="keyword">test</span><span class="normal"> </span><span class="string">"X$xdir"</span><span class="normal"> </span><span class="symbol">=</span><span class="normal"> </span><span class="string">"X$arg"</span><span class="symbol">;</span><span class="normal"> </span><span class="keyword">then</span>
<span class="normal">	      </span><span class="variable">xdir</span><span class="symbol">=</span>
<span class="normal">	    </span><span class="keyword">else</span>
<span class="normal">	      </span><span class="variable">xdir</span><span class="symbol">=</span><span class="string">"$xdir/"</span>
<span class="normal">	    </span><span class="keyword">fi</span>

<span class="normal">	    </span><span class="variable">pic_object</span><span class="symbol">=</span><span class="normal">`</span><span class="variable">$echo</span><span class="normal"> </span><span class="string">"X${xdir}${objdir}/${arg}"</span><span class="normal"> </span><span class="symbol">|</span><span class="normal"> </span><span class="variable">$Xsed</span><span class="normal"> -e </span><span class="string">"$lo2o"</span><span class="normal">`</span>
<span class="normal">	    </span><span class="variable">non_pic_object</span><span class="symbol">=</span><span class="normal">`</span><span class="variable">$echo</span><span class="normal"> </span><span class="string">"X${xdir}${arg}"</span><span class="normal"> </span><span class="symbol">|</span><span class="normal"> </span><span class="variable">$Xsed</span><span class="normal"> -e </span><span class="string">"$lo2o"</span><span class="normal">`</span>
<span class="normal">	    </span><span class="variable">libobjs</span><span class="symbol">=</span><span class="string">"$libobjs $pic_object"</span>
<span class="normal">	    </span><span class="variable">non_pic_objects</span><span class="symbol">=</span><span class="string">"$non_pic_objects $non_pic_object"</span>
<span class="normal">	  </span><span class="keyword">fi</span>
<span class="normal">	</span><span class="keyword">fi</span>
<span class="normal">	</span><span class="symbol">;;</span>

<span class="normal">      </span><span class="symbol">*.</span><span class="variable">$libext</span><span class="symbol">)</span>
<span class="normal">	</span><span class="comment"># An archive.</span>
<span class="normal">	</span><span class="variable">deplibs</span><span class="symbol">=</span><span class="string">"$deplibs $arg"</span>
<span class="normal">	</span><span class="variable">old_deplibs</span><span class="symbol">=</span><span class="string">"$old_deplibs $arg"</span>
<span class="normal">	</span><span class="keyword">continue</span>
<span class="normal">	</span><span class="symbol">;;</span>

<span class="normal">      </span><span class="symbol">*.</span><span class="normal">la</span><span class="symbol">)</span>
<span class="normal">	</span><span class="comment"># A libtool-controlled library.</span>

<span class="normal">	</span><span class="keyword">if</span><span class="normal"> </span><span class="keyword">test</span><span class="normal"> </span><span class="string">"$prev"</span><span class="normal"> </span><span class="symbol">=</span><span class="normal"> dlfiles</span><span class="symbol">;</span><span class="normal"> </span><span class="keyword">then</span>
<span class="normal">	  </span><span class="comment"># This library was specified with -dlopen.</span>
<span class="normal">	  </span><span class="variable">dlfiles</span><span class="symbol">=</span><span class="string">"$dlfiles $arg"</span>
<span class="normal">	  </span><span class="variable">prev</span><span class="symbol">=</span>
<span class="normal">	</span><span class="keyword">elif</span><span class="normal"> </span><span class="keyword">test</span><span class="normal"> </span><span class="string">"$prev"</span><span class="normal"> </span><span class="symbol">=</span><span class="normal"> dlprefiles</span><span class="symbol">;</span><span class="normal"> </span><span class="keyword">then</span>
<span class="normal">	  </span><span class="comment"># The library was specified with -dlpreopen.</span>
<span class="normal">	  </span><span class="variable">dlprefiles</span><span class="symbol">=</span><span class="string">"$dlprefiles $arg"</span>
<span class="normal">	  </span><span class="variable">prev</span><span class="symbol">=</span>
<span class="normal">	</span><span class="keyword">else</span>
<span class="normal">	  </span><span class="variable">deplibs</span><span class="symbol">=</span><span class="string">"$deplibs $arg"</span>
<span class="normal">	</span><span class="keyword">fi</span>
<span class="normal">	</span><span class="keyword">continue</span>
<span class="normal">	</span><span class="symbol">;;</span>

<span class="normal">      </span><span class="comment"># Some other compiler argument.</span>
<span class="normal">      </span><span class="symbol">*)</span>
<span class="normal">	</span><span class="comment"># Unknown arguments in both finalize_command and compile_command need</span>
<span class="normal">	</span><span class="comment"># to be aesthetically quoted because they are evaled later.</span>
<span class="normal">	</span><span class="variable">arg</span><span class="symbol">=</span><span class="normal">`</span><span class="variable">$echo</span><span class="normal"> </span><span class="string">"X$arg"</span><span class="normal"> </span><span class="symbol">|</span><span class="normal"> </span><span class="variable">$Xsed</span><span class="normal"> -e </span><span class="string">"$sed_quote_subst"</span><span class="normal">`</span>
<span class="normal">	</span><span class="keyword">case</span><span class="normal"> </span><span class="variable">$arg</span><span class="normal"> </span><span class="keyword">in</span>
<span class="normal">	</span><span class="symbol">*[\[\~\</span><span class="comment">#\^\&amp;\*\(\)\{\}\|\;\&lt;\&gt;\?\'\ \	]*|*]*|"")</span>
<span class="normal">	  </span><span class="variable">arg</span><span class="symbol">=</span><span class="string">"</span><span class="specialchar">\"</span><span class="string">$arg</span><span class="specialchar">\"</span><span class="string">"</span>
<span class="normal">	  </span><span class="symbol">;;</span>
<span class="normal">	</span><span class="keyword">esac</span>
<span class="normal">	</span><span class="symbol">;;</span>
<span class="normal">      </span><span class="keyword">esac</span><span class="normal"> </span><span class="comment"># arg</span>

<span class="normal">      </span><span class="comment"># Now actually substitute the argument into the commands.</span>
<span class="normal">      </span><span class="keyword">if</span><span class="normal"> </span><span class="keyword">test</span><span class="normal"> -n </span><span class="string">"$arg"</span><span class="symbol">;</span><span class="normal"> </span><span class="keyword">then</span>
<span class="normal">	</span><span class="variable">compile_command</span><span class="symbol">=</span><span class="string">"$compile_command $arg"</span>
<span class="normal">	</span><span class="variable">finalize_command</span><span class="symbol">=</span><span class="string">"$finalize_command $arg"</span>
<span class="normal">      </span><span class="keyword">fi</span>
<span class="normal">    </span><span class="keyword">done</span><span class="normal"> </span><span class="comment"># argument parsing loop</span>

<span class="normal">    </span><span class="keyword">if</span><span class="normal"> </span><span class="keyword">test</span><span class="normal"> -n </span><span class="string">"$prev"</span><span class="symbol">;</span><span class="normal"> </span><span class="keyword">then</span>
<span class="normal">      </span><span class="variable">$echo</span><span class="normal"> </span><span class="string">"$modename: the </span><span class="specialchar">\`</span><span class="string">$prevarg' option requires an argument"</span><span class="normal"> </span><span class="number">1</span><span class="symbol">&gt;&amp;</span><span class="number">2</span>
<span class="normal">      </span><span class="variable">$echo</span><span class="normal"> </span><span class="string">"$help"</span><span class="normal"> </span><span class="number">1</span><span class="symbol">&gt;&amp;</span><span class="number">2</span>
<span class="normal">      </span><span class="keyword">exit</span><span class="normal"> </span><span class="variable">$EXIT_FAILURE</span>
<span class="normal">    </span><span class="keyword">fi</span>

<span class="normal">    </span><span class="keyword">if</span><span class="normal"> </span><span class="keyword">test</span><span class="normal"> </span><span class="string">"$export_dynamic"</span><span class="normal"> </span><span class="symbol">=</span><span class="normal"> yes </span><span class="symbol">&amp;&amp;</span><span class="normal"> </span><span class="keyword">test</span><span class="normal"> -n </span><span class="string">"$export_dynamic_flag_spec"</span><span class="symbol">;</span><span class="normal"> </span><span class="keyword">then</span>
<span class="normal">      </span><span class="keyword">eval</span><span class="normal"> </span><span class="variable">arg</span><span class="symbol">=</span><span class="normal">\"</span><span class="variable">$export_dynamic_flag_spec</span><span class="normal">\"</span>
<span class="normal">      </span><span class="variable">compile_command</span><span class="symbol">=</span><span class="string">"$compile_command $arg"</span>
<span class="normal">      </span><span class="variable">finalize_command</span><span class="symbol">=</span><span class="string">"$finalize_command $arg"</span>
<span class="normal">    </span><span class="keyword">fi</span>

<span class="normal">    </span><span class="variable">oldlibs</span><span class="symbol">=</span>
<span class="normal">    </span><span class="comment"># calculate the name of the file, without its directory</span>
<span class="normal">    </span><span class="variable">outputname</span><span class="symbol">=</span><span class="normal">`</span><span class="variable">$echo</span><span class="normal"> </span><span class="string">"X$output"</span><span class="normal"> </span><span class="symbol">|</span><span class="normal"> </span><span class="variable">$Xsed</span><span class="normal"> -e </span><span class="string">'s%^.*/%%'</span><span class="normal">`</span>
<span class="normal">    </span><span class="variable">libobjs_save</span><span class="symbol">=</span><span class="string">"$libobjs"</span>

<span class="normal">    </span><span class="keyword">if</span><span class="normal"> </span><span class="keyword">test</span><span class="normal"> -n </span><span class="string">"$shlibpath_var"</span><span class="symbol">;</span><span class="normal"> </span><span class="keyword">then</span>
<span class="normal">      </span><span class="comment"># get the directories listed in $shlibpath_var</span>
<span class="normal">      </span><span class="keyword">eval</span><span class="normal"> </span><span class="variable">shlib_search_path</span><span class="symbol">=\</span><span class="normal">`</span><span class="symbol">\</span><span class="variable">$echo</span><span class="normal"> \"X</span><span class="symbol">\</span><span class="variable">${$shlibpath_var}</span><span class="normal">\" </span><span class="symbol">\|</span><span class="normal"> </span><span class="symbol">\</span><span class="variable">$Xsed</span><span class="normal"> -e \'s</span><span class="symbol">/:/</span><span class="normal"> /g\'</span><span class="symbol">\</span><span class="normal">`</span>
<span class="normal">    </span><span class="keyword">else</span>
<span class="normal">      </span><span class="variable">shlib_search_path</span><span class="symbol">=</span>
<span class="normal">    </span><span class="keyword">fi</span>
<span class="normal">    </span><span class="keyword">eval</span><span class="normal"> </span><span class="variable">sys_lib_search_path</span><span class="symbol">=</span><span class="normal">\"</span><span class="variable">$sys_lib_search_path_spec</span><span class="normal">\"</span>
<span class="normal">    </span><span class="keyword">eval</span><span class="normal"> </span><span class="variable">sys_lib_dlsearch_path</span><span class="symbol">=</span><span class="normal">\"</span><span class="variable">$sys_lib_dlsearch_path_spec</span><span class="normal">\"</span>

<span class="normal">    </span><span class="variable">output_objdir</span><span class="symbol">=</span><span class="normal">`</span><span class="variable">$echo</span><span class="normal"> </span><span class="string">"X$output"</span><span class="normal"> </span><span class="symbol">|</span><span class="normal"> </span><span class="variable">$Xsed</span><span class="normal"> -e </span><span class="string">'s%/[^/]*$%%'</span><span class="normal">`</span>
<span class="normal">    </span><span class="keyword">if</span><span class="normal"> </span><span class="keyword">test</span><span class="normal"> </span><span class="string">"X$output_objdir"</span><span class="normal"> </span><span class="symbol">=</span><span class="normal"> </span><span class="string">"X$output"</span><span class="symbol">;</span><span class="normal"> </span><span class="keyword">then</span>
<span class="normal">      </span><span class="variable">output_objdir</span><span class="symbol">=</span><span class="string">"$objdir"</span>
<span class="normal">    </span><span class="keyword">else</span>
<span class="normal">      </span><span class="variable">output_objdir</span><span class="symbol">=</span><span class="string">"$output_objdir/$objdir"</span>
<span class="normal">    </span><span class="keyword">fi</span>
<span class="normal">    </span><span class="comment"># Create the object directory.</span>
<span class="normal">    </span><span class="keyword">if</span><span class="normal"> </span><span class="keyword">test</span><span class="normal"> </span><span class="symbol">!</span><span class="normal"> -d </span><span class="string">"$output_objdir"</span><span class="symbol">;</span><span class="normal"> </span><span class="keyword">then</span>
<span class="normal">      </span><span class="variable">$show</span><span class="normal"> </span><span class="string">"$mkdir $output_objdir"</span>
<span class="normal">      </span><span class="variable">$run</span><span class="normal"> </span><span class="variable">$mkdir</span><span class="normal"> </span><span class="variable">$output_objdir</span>
<span class="normal">      </span><span class="variable">exit_status</span><span class="symbol">=</span><span class="variable">$?</span>
<span class="normal">      </span><span class="keyword">if</span><span class="normal"> </span><span class="keyword">test</span><span class="normal"> </span><span class="string">"$exit_status"</span><span class="normal"> -ne </span><span class="number">0</span><span class="normal"> </span><span class="symbol">&amp;&amp;</span><span class="normal"> </span><span class="keyword">test</span><span class="normal"> </span><span class="symbol">!</span><span class="normal"> -d </span><span class="string">"$output_objdir"</span><span class="symbol">;</span><span class="normal"> </span><span class="keyword">then</span>
<span class="normal">	</span><span class="keyword">exit</span><span class="normal"> </span><span class="variable">$exit_status</span>
<span class="normal">      </span><span class="keyword">fi</span>
<span class="normal">    </span><span class="keyword">fi</span>

<span class="normal">    </span><span class="comment"># Determine the type of output</span>
<span class="normal">    </span><span class="keyword">case</span><span class="normal"> </span><span class="variable">$output</span><span class="normal"> </span><span class="keyword">in</span>
<span class="normal">    </span><span class="string">""</span><span class="symbol">)</span>
<span class="normal">      </span><span class="variable">$echo</span><span class="normal"> </span><span class="string">"$modename: you must specify an output file"</span><span class="normal"> </span><span class="number">1</span><span class="symbol">&gt;&amp;</span><span class="number">2</span>
<span class="normal">      </span><span class="variable">$echo</span><span class="normal"> </span><span class="string">"$help"</span><span class="normal"> </span><span class="number">1</span><span class="symbol">&gt;&amp;</span><span class="number">2</span>
<span class="normal">      </span><span class="keyword">exit</span><span class="normal"> </span><span class="variable">$EXIT_FAILURE</span>
<span class="normal">      </span><span class="symbol">;;</span>
<span class="normal">    </span><span class="symbol">*.</span><span class="variable">$libext</span><span class="symbol">)</span><span class="normal"> </span><span class="variable">linkmode</span><span class="symbol">=</span><span class="normal">oldlib </span><span class="symbol">;;</span>
<span class="normal">    </span><span class="symbol">*.</span><span class="normal">lo </span><span class="symbol">|</span><span class="normal"> </span><span class="symbol">*.</span><span class="variable">$objext</span><span class="symbol">)</span><span class="normal"> </span><span class="variable">linkmode</span><span class="symbol">=</span><span class="normal">obj </span><span class="symbol">;;</span>
<span class="normal">    </span><span class="symbol">*.</span><span class="normal">la</span><span class="symbol">)</span><span class="normal"> </span><span class="variable">linkmode</span><span class="symbol">=</span><span class="normal">lib </span><span class="symbol">;;</span>
<span class="normal">    </span><span class="symbol">*)</span><span class="normal"> </span><span class="variable">linkmode</span><span class="symbol">=</span><span class="normal">prog </span><span class="symbol">;;</span><span class="normal"> </span><span class="comment"># Anything else should be a program.</span>
<span class="normal">    </span><span class="keyword">esac</span>

<span class="normal">    </span><span class="keyword">case</span><span class="normal"> </span><span class="variable">$host</span><span class="normal"> </span><span class="keyword">in</span>
<span class="normal">    </span><span class="symbol">*</span><span class="normal">cygwin</span><span class="symbol">*</span><span class="normal"> </span><span class="symbol">|</span><span class="normal"> </span><span class="symbol">*</span><span class="normal">mingw</span><span class="symbol">*</span><span class="normal"> </span><span class="symbol">|</span><span class="normal"> </span><span class="symbol">*</span><span class="normal">pw32</span><span class="symbol">*)</span>
<span class="normal">      </span><span class="comment"># don't eliminate duplications in $postdeps and $predeps</span>
<span class="normal">      </span><span class="variable">duplicate_compiler_generated_deps</span><span class="symbol">=</span><span class="normal">yes</span>
<span class="normal">      </span><span class="symbol">;;</span>
<span class="normal">    </span><span class="symbol">*)</span>
<span class="normal">      </span><span class="variable">duplicate_compiler_generated_deps</span><span class="symbol">=</span><span class="variable">$duplicate_deps</span>
<span class="normal">      </span><span class="symbol">;;</span>
<span class="normal">    </span><span class="keyword">esac</span>
<span class="normal">    </span><span class="variable">specialdeplibs</span><span class="symbol">=</span>

<span class="normal">    </span><span class="variable">libs</span><span class="symbol">=</span>
<span class="normal">    </span><span class="comment"># Find all interdependent deplibs by searching for libraries</span>
<span class="normal">    </span><span class="comment"># that are linked more than once (e.g. -la -lb -la)</span>
<span class="normal">    </span><span class="keyword">for</span><span class="normal"> deplib </span><span class="keyword">in</span><span class="normal"> </span><span class="variable">$deplibs</span><span class="symbol">;</span><span class="normal"> </span><span class="keyword">do</span>
<span class="normal">      </span><span class="keyword">if</span><span class="normal"> </span><span class="keyword">test</span><span class="normal"> </span><span class="string">"X$duplicate_deps"</span><span class="normal"> </span><span class="symbol">=</span><span class="normal"> </span><span class="string">"Xyes"</span><span class="normal"> </span><span class="symbol">;</span><span class="normal"> </span><span class="keyword">then</span>
<span class="normal">	</span><span class="keyword">case</span><span class="normal"> </span><span class="string">"$libs "</span><span class="normal"> </span><span class="keyword">in</span>
<span class="normal">	</span><span class="symbol">*</span><span class="string">" $deplib "</span><span class="symbol">*)</span><span class="normal"> </span><span class="variable">specialdeplibs</span><span class="symbol">=</span><span class="string">"$specialdeplibs $deplib"</span><span class="normal"> </span><span class="symbol">;;</span>
<span class="normal">	</span><span class="keyword">esac</span>
<span class="normal">      </span><span class="keyword">fi</span>
<span class="normal">      </span><span class="variable">libs</span><span class="symbol">=</span><span class="string">"$libs $deplib"</span>
<span class="normal">    </span><span class="keyword">done</span>

<span class="normal">    </span><span class="keyword">if</span><span class="normal"> </span><span class="keyword">test</span><span class="normal"> </span><span class="string">"$linkmode"</span><span class="normal"> </span><span class="symbol">=</span><span class="normal"> lib</span><span class="symbol">;</span><span class="normal"> </span><span class="keyword">then</span>
<span class="normal">      </span><span class="variable">libs</span><span class="symbol">=</span><span class="string">"$predeps $libs $compiler_lib_search_path $postdeps"</span>

<span class="normal">      </span><span class="comment"># Compute libraries that are listed more than once in $predeps</span>
<span class="normal">      </span><span class="comment"># $postdeps and mark them as special (i.e., whose duplicates are</span>
<span class="normal">      </span><span class="comment"># not to be eliminated).</span>
<span class="normal">      </span><span class="variable">pre_post_deps</span><span class="symbol">=</span>
<span class="normal">      </span><span class="keyword">if</span><span class="normal"> </span><span class="keyword">test</span><span class="normal"> </span><span class="string">"X$duplicate_compiler_generated_deps"</span><span class="normal"> </span><span class="symbol">=</span><span class="normal"> </span><span class="string">"Xyes"</span><span class="normal"> </span><span class="symbol">;</span><span class="normal"> </span><span class="keyword">then</span>
<span class="normal">	</span><span class="keyword">for</span><span class="normal"> pre_post_dep </span><span class="keyword">in</span><span class="normal"> </span><span class="variable">$predeps</span><span class="normal"> </span><span class="variable">$postdeps</span><span class="symbol">;</span><span class="normal"> </span><span class="keyword">do</span>
<span class="normal">	  </span><span class="keyword">case</span><span class="normal"> </span><span class="string">"$pre_post_deps "</span><span class="normal"> </span><span class="keyword">in</span>
<span class="normal">	  </span><span class="symbol">*</span><span class="string">" $pre_post_dep "</span><span class="symbol">*)</span><span class="normal"> </span><span class="variable">specialdeplibs</span><span class="symbol">=</span><span class="string">"$specialdeplibs $pre_post_deps"</span><span class="normal"> </span><span class="symbol">;;</span>
<span class="normal">	  </span><span class="keyword">esac</span>
<span class="normal">	  </span><span class="variable">pre_post_deps</span><span class="symbol">=</span><span class="string">"$pre_post_deps $pre_post_dep"</span>
<span class="normal">	</span><span class="keyword">done</span>
<span class="normal">      </span><span class="keyword">fi</span>
<span class="normal">      </span><span class="variable">pre_post_deps</span><span class="symbol">=</span>
<span class="normal">    </span><span class="keyword">fi</span>

<span class="normal">    </span><span class="variable">deplibs</span><span class="symbol">=</span>
<span class="normal">    </span><span class="variable">newdependency_libs</span><span class="symbol">=</span>
<span class="normal">    </span><span class="variable">newlib_search_path</span><span class="symbol">=</span>
<span class="normal">    </span><span class="variable">need_relink</span><span class="symbol">=</span><span class="normal">no </span><span class="comment"># whether we're linking any uninstalled libtool libraries</span>
<span class="normal">    </span><span class="variable">notinst_deplibs</span><span class="symbol">=</span><span class="normal"> </span><span class="comment"># not-installed libtool libraries</span>
<span class="normal">    </span><span class="keyword">case</span><span class="normal"> </span><span class="variable">$linkmode</span><span class="normal"> </span><span class="keyword">in</span>
<span class="normal">    lib</span><span class="symbol">)</span>
<span class="normal">	</span><span class="variable">passes</span><span class="symbol">=</span><span class="string">"conv link"</span>
<span class="normal">	</span><span class="keyword">for</span><span class="normal"> file </span><span class="keyword">in</span><span class="normal"> </span><span class="variable">$dlfiles</span><span class="normal"> </span><span class="variable">$dlprefiles</span><span class="symbol">;</span><span class="normal"> </span><span class="keyword">do</span>
<span class="normal">	  </span><span class="keyword">case</span><span class="normal"> </span><span class="variable">$file</span><span class="normal"> </span><span class="keyword">in</span>
<span class="normal">	  </span><span class="symbol">*.</span><span class="normal">la</span><span class="symbol">)</span><span class="normal"> </span><span class="symbol">;;</span>
<span class="normal">	  </span><span class="symbol">*)</span>
<span class="normal">	    </span><span class="variable">$echo</span><span class="normal"> </span><span class="string">"$modename: libraries can </span><span class="specialchar">\`</span><span class="string">-dlopen' only libtool libraries: $file"</span><span class="normal"> </span><span class="number">1</span><span class="symbol">&gt;&amp;</span><span class="number">2</span>
<span class="normal">	    </span><span class="keyword">exit</span><span class="normal"> </span><span class="variable">$EXIT_FAILURE</span>
<span class="normal">	    </span><span class="symbol">;;</span>
<span class="normal">	  </span><span class="keyword">esac</span>
<span class="normal">	</span><span class="keyword">done</span>
<span class="normal">	</span><span class="symbol">;;</span>
<span class="normal">    prog</span><span class="symbol">)</span>
<span class="normal">	</span><span class="variable">compile_deplibs</span><span class="symbol">=</span>
<span class="normal">	</span><span class="variable">finalize_deplibs</span><span class="symbol">=</span>
<span class="normal">	</span><span class="variable">alldeplibs</span><span class="symbol">=</span><span class="normal">no</span>
<span class="normal">	</span><span class="variable">newdlfiles</span><span class="symbol">=</span>
<span class="normal">	</span><span class="variable">newdlprefiles</span><span class="symbol">=</span>
<span class="normal">	</span><span class="variable">passes</span><span class="symbol">=</span><span class="string">"conv scan dlopen dlpreopen link"</span>
<span class="normal">	</span><span class="symbol">;;</span>
<span class="normal">    </span><span class="symbol">*)</span><span class="normal">  </span><span class="variable">passes</span><span class="symbol">=</span><span class="string">"conv"</span>
<span class="normal">	</span><span class="symbol">;;</span>
<span class="normal">    </span><span class="keyword">esac</span>
<span class="normal">    </span><span class="keyword">for</span><span class="normal"> pass </span><span class="keyword">in</span><span class="normal"> </span><span class="variable">$passes</span><span class="symbol">;</span><span class="normal"> </span><span class="keyword">do</span>
<span class="normal">      </span><span class="keyword">if</span><span class="normal"> </span><span class="keyword">test</span><span class="normal"> </span><span class="string">"$linkmode,$pass"</span><span class="normal"> </span><span class="symbol">=</span><span class="normal"> </span><span class="string">"lib,link"</span><span class="normal"> </span><span class="symbol">||</span>
<span class="normal">	 </span><span class="keyword">test</span><span class="normal"> </span><span class="string">"$linkmode,$pass"</span><span class="normal"> </span><span class="symbol">=</span><span class="normal"> </span><span class="string">"prog,scan"</span><span class="symbol">;</span><span class="normal"> </span><span class="keyword">then</span>
<span class="normal">	</span><span class="variable">libs</span><span class="symbol">=</span><span class="string">"$deplibs"</span>
<span class="normal">	</span><span class="variable">deplibs</span><span class="symbol">=</span>
<span class="normal">      </span><span class="keyword">fi</span>
<span class="normal">      </span><span class="keyword">if</span><span class="normal"> </span><span class="keyword">test</span><span class="normal"> </span><span class="string">"$linkmode"</span><span class="normal"> </span><span class="symbol">=</span><span class="normal"> prog</span><span class="symbol">;</span><span class="normal"> </span><span class="keyword">then</span>
<span class="normal">	</span><span class="keyword">case</span><span class="normal"> </span><span class="variable">$pass</span><span class="normal"> </span><span class="keyword">in</span>
<span class="normal">	dlopen</span><span class="symbol">)</span><span class="normal"> </span><span class="variable">libs</span><span class="symbol">=</span><span class="string">"$dlfiles"</span><span class="normal"> </span><span class="symbol">;;</span>
<span class="normal">	dlpreopen</span><span class="symbol">)</span><span class="normal"> </span><span class="variable">libs</span><span class="symbol">=</span><span class="string">"$dlprefiles"</span><span class="normal"> </span><span class="symbol">;;</span>
<span class="normal">	link</span><span class="symbol">)</span><span class="normal"> </span><span class="variable">libs</span><span class="symbol">=</span><span class="string">"$deplibs %DEPLIBS% $dependency_libs"</span><span class="normal"> </span><span class="symbol">;;</span>
<span class="normal">	</span><span class="keyword">esac</span>
<span class="normal">      </span><span class="keyword">fi</span>
<span class="normal">      </span><span class="keyword">if</span><span class="normal"> </span><span class="keyword">test</span><span class="normal"> </span><span class="string">"$pass"</span><span class="normal"> </span><span class="symbol">=</span><span class="normal"> dlopen</span><span class="symbol">;</span><span class="normal"> </span><span class="keyword">then</span>
<span class="normal">	</span><span class="comment"># Collect dlpreopened libraries</span>
<span class="normal">	</span><span class="variable">save_deplibs</span><span class="symbol">=</span><span class="string">"$deplibs"</span>
<span class="normal">	</span><span class="variable">deplibs</span><span class="symbol">=</span>
<span class="normal">      </span><span class="keyword">fi</span>
<span class="normal">      </span><span class="keyword">for</span><span class="normal"> deplib </span><span class="keyword">in</span><span class="normal"> </span><span class="variable">$libs</span><span class="symbol">;</span><span class="normal"> </span><span class="keyword">do</span>
<span class="normal">	</span><span class="variable">lib</span><span class="symbol">=</span>
<span class="normal">	</span><span class="variable">found</span><span class="symbol">=</span><span class="normal">no</span>
<span class="normal">	</span><span class="keyword">case</span><span class="normal"> </span><span class="variable">$deplib</span><span class="normal"> </span><span class="keyword">in</span>
<span class="normal">	-mt</span><span class="symbol">|</span><span class="normal">-mthreads</span><span class="symbol">|</span><span class="normal">-kthread</span><span class="symbol">|</span><span class="normal">-Kthread</span><span class="symbol">|</span><span class="normal">-pthread</span><span class="symbol">|</span><span class="normal">-pthreads</span><span class="symbol">|</span><span class="normal">--thread-safe</span><span class="symbol">|</span><span class="normal">-threads</span><span class="symbol">)</span>
<span class="normal">	  </span><span class="keyword">if</span><span class="normal"> </span><span class="keyword">test</span><span class="normal"> </span><span class="string">"$linkmode,$pass"</span><span class="normal"> </span><span class="symbol">=</span><span class="normal"> </span><span class="string">"prog,link"</span><span class="symbol">;</span><span class="normal"> </span><span class="keyword">then</span>
<span class="normal">	    </span><span class="variable">compile_deplibs</span><span class="symbol">=</span><span class="string">"$deplib $compile_deplibs"</span>
<span class="normal">	    </span><span class="variable">finalize_deplibs</span><span class="symbol">=</span><span class="string">"$deplib $finalize_deplibs"</span>
<span class="normal">	  </span><span class="keyword">else</span>
<span class="normal">	    </span><span class="variable">compiler_flags</span><span class="symbol">=</span><span class="string">"$compiler_flags $deplib"</span>
<span class="normal">	  </span><span class="keyword">fi</span>
<span class="normal">	  </span><span class="keyword">continue</span>
<span class="normal">	  </span><span class="symbol">;;</span>
<span class="normal">	-l</span><span class="symbol">*)</span>
<span class="normal">	  </span><span class="keyword">if</span><span class="normal"> </span><span class="keyword">test</span><span class="normal"> </span><span class="string">"$linkmode"</span><span class="normal"> </span><span class="symbol">!=</span><span class="normal"> lib </span><span class="symbol">&amp;&amp;</span><span class="normal"> </span><span class="keyword">test</span><span class="normal"> </span><span class="string">"$linkmode"</span><span class="normal"> </span><span class="symbol">!=</span><span class="normal"> prog</span><span class="symbol">;</span><span class="normal"> </span><span class="keyword">then</span>
<span class="normal">	    </span><span class="variable">$echo</span><span class="normal"> </span><span class="string">"$modename: warning: </span><span class="specialchar">\`</span><span class="string">-l' is ignored for archives/objects"</span><span class="normal"> </span><span class="number">1</span><span class="symbol">&gt;&amp;</span><span class="number">2</span>
<span class="normal">	    </span><span class="keyword">continue</span>
<span class="normal">	  </span><span class="keyword">fi</span>
<span class="normal">	  </span><span class="variable">name</span><span class="symbol">=</span><span class="normal">`</span><span class="variable">$echo</span><span class="normal"> </span><span class="string">"X$deplib"</span><span class="normal"> </span><span class="symbol">|</span><span class="normal"> </span><span class="variable">$Xsed</span><span class="normal"> -e </span><span class="string">'s/^-l//'</span><span class="normal">`</span>
<span class="normal">	  </span><span class="keyword">for</span><span class="normal"> searchdir </span><span class="keyword">in</span><span class="normal"> </span><span class="variable">$newlib_search_path</span><span class="normal"> </span><span class="variable">$lib_search_path</span><span class="normal"> </span><span class="variable">$sys_lib_search_path</span><span class="normal"> </span><span class="variable">$shlib_search_path</span><span class="symbol">;</span><span class="normal"> </span><span class="keyword">do</span>
<span class="normal">	    </span><span class="keyword">for</span><span class="normal"> search_ext </span><span class="keyword">in</span><span class="normal"> </span><span class="symbol">.</span><span class="normal">la </span><span class="variable">$std_shrext</span><span class="normal"> </span><span class="symbol">.</span><span class="normal">so </span><span class="symbol">.</span><span class="normal">a</span><span class="symbol">;</span><span class="normal"> </span><span class="keyword">do</span>
<span class="normal">	      </span><span class="comment"># Search the libtool library</span>
<span class="normal">	      </span><span class="variable">lib</span><span class="symbol">=</span><span class="string">"$searchdir/lib${name}${search_ext}"</span>
<span class="normal">	      </span><span class="keyword">if</span><span class="normal"> </span><span class="keyword">test</span><span class="normal"> -f </span><span class="string">"$lib"</span><span class="symbol">;</span><span class="normal"> </span><span class="keyword">then</span>
<span class="normal">		</span><span class="keyword">if</span><span class="normal"> </span><span class="keyword">test</span><span class="normal"> </span><span class="string">"$search_ext"</span><span class="normal"> </span><span class="symbol">=</span><span class="normal"> </span><span class="string">".la"</span><span class="symbol">;</span><span class="normal"> </span><span class="keyword">then</span>
<span class="normal">		  </span><span class="variable">found</span><span class="symbol">=</span><span class="normal">yes</span>
<span class="normal">		</span><span class="keyword">else</span>
<span class="normal">		  </span><span class="variable">found</span><span class="symbol">=</span><span class="normal">no</span>
<span class="normal">		</span><span class="keyword">fi</span>
<span class="normal">		</span><span class="keyword">break</span><span class="normal"> </span><span class="number">2</span>
<span class="normal">	      </span><span class="keyword">fi</span>
<span class="normal">	    </span><span class="keyword">done</span>
<span class="normal">	  </span><span class="keyword">done</span>
<span class="normal">	  </span><span class="keyword">if</span><span class="normal"> </span><span class="keyword">test</span><span class="normal"> </span><span class="string">"$found"</span><span class="normal"> </span><span class="symbol">!=</span><span class="normal"> yes</span><span class="symbol">;</span><span class="normal"> </span><span class="keyword">then</span>
<span class="normal">	    </span><span class="comment"># deplib doesn't seem to be a libtool library</span>
<span class="normal">	    </span><span class="keyword">if</span><span class="normal"> </span><span class="keyword">test</span><span class="normal"> </span><span class="string">"$linkmode,$pass"</span><span class="normal"> </span><span class="symbol">=</span><span class="normal"> </span><span class="string">"prog,link"</span><span class="symbol">;</span><span class="normal"> </span><span class="keyword">then</span>
<span class="normal">	      </span><span class="variable">compile_deplibs</span><span class="symbol">=</span><span class="string">"$deplib $compile_deplibs"</span>
<span class="normal">	      </span><span class="variable">finalize_deplibs</span><span class="symbol">=</span><span class="string">"$deplib $finalize_deplibs"</span>
<span class="normal">	    </span><span class="keyword">else</span>
<span class="normal">	      </span><span class="variable">deplibs</span><span class="symbol">=</span><span class="string">"$deplib $deplibs"</span>
<span class="normal">	      </span><span class="keyword">test</span><span class="normal"> </span><span class="string">"$linkmode"</span><span class="normal"> </span><span class="symbol">=</span><span class="normal"> lib </span><span class="symbol">&amp;&amp;</span><span class="normal"> </span><span class="variable">newdependency_libs</span><span class="symbol">=</span><span class="string">"$deplib $newdependency_libs"</span>
<span class="normal">	    </span><span class="keyword">fi</span>
<span class="normal">	    </span><span class="keyword">continue</span>
<span class="normal">	  </span><span class="keyword">else</span><span class="normal"> </span><span class="comment"># deplib is a libtool library</span>
<span class="normal">	    </span><span class="comment"># If $allow_libtool_libs_with_static_runtimes &amp;&amp; $deplib is a stdlib,</span>
<span class="normal">	    </span><span class="comment"># We need to do some special things here, and not later.</span>
<span class="normal">	    </span><span class="keyword">if</span><span class="normal"> </span><span class="keyword">test</span><span class="normal"> </span><span class="string">"X$allow_libtool_libs_with_static_runtimes"</span><span class="normal"> </span><span class="symbol">=</span><span class="normal"> </span><span class="string">"Xyes"</span><span class="normal"> </span><span class="symbol">;</span><span class="normal"> </span><span class="keyword">then</span>
<span class="normal">	      </span><span class="keyword">case</span><span class="normal"> </span><span class="string">" $predeps $postdeps "</span><span class="normal"> </span><span class="keyword">in</span>
<span class="normal">	      </span><span class="symbol">*</span><span class="string">" $deplib "</span><span class="symbol">*)</span>
<span class="normal">		</span><span class="keyword">if</span><span class="normal"> </span><span class="symbol">(</span><span class="variable">${SED}</span><span class="normal"> -e </span><span class="string">'2q'</span><span class="normal"> </span><span class="variable">$lib</span><span class="normal"> </span><span class="symbol">|</span>
<span class="normal">                    grep </span><span class="string">"^# Generated by .*$PACKAGE"</span><span class="symbol">)</span><span class="normal"> </span><span class="symbol">&gt;</span><span class="normal">/dev/null </span><span class="number">2</span><span class="symbol">&gt;&amp;</span><span class="number">1</span><span class="symbol">;</span><span class="normal"> </span><span class="keyword">then</span>
<span class="normal">		  </span><span class="variable">library_names</span><span class="symbol">=</span>
<span class="normal">		  </span><span class="variable">old_library</span><span class="symbol">=</span>
<span class="normal">		  </span><span class="keyword">case</span><span class="normal"> </span><span class="variable">$lib</span><span class="normal"> </span><span class="keyword">in</span>
<span class="normal">		  </span><span class="symbol">*/*</span><span class="normal"> </span><span class="symbol">|</span><span class="normal"> </span><span class="symbol">*\\*)</span><span class="normal"> </span><span class="symbol">.</span><span class="normal"> </span><span class="variable">$lib</span><span class="normal"> </span><span class="symbol">;;</span>
<span class="normal">		  </span><span class="symbol">*)</span><span class="normal"> </span><span class="symbol">.</span><span class="normal"> </span><span class="symbol">./</span><span class="variable">$lib</span><span class="normal"> </span><span class="symbol">;;</span>
<span class="normal">		  </span><span class="keyword">esac</span>
<span class="normal">		  </span><span class="keyword">for</span><span class="normal"> l </span><span class="keyword">in</span><span class="normal"> </span><span class="variable">$old_library</span><span class="normal"> </span><span class="variable">$library_names</span><span class="symbol">;</span><span class="normal"> </span><span class="keyword">do</span>
<span class="normal">		    </span><span class="variable">ll</span><span class="symbol">=</span><span class="string">"$l"</span>
<span class="normal">		  </span><span class="keyword">done</span>
<span class="normal">		  </span><span class="keyword">if</span><span class="normal"> </span><span class="keyword">test</span><span class="normal"> </span><span class="string">"X$ll"</span><span class="normal"> </span><span class="symbol">=</span><span class="normal"> </span><span class="string">"X$old_library"</span><span class="normal"> </span><span class="symbol">;</span><span class="normal"> </span><span class="keyword">then</span><span class="normal"> </span><span class="comment"># only static version available</span>
<span class="normal">		    </span><span class="variable">found</span><span class="symbol">=</span><span class="normal">no</span>
<span class="normal">		    </span><span class="variable">ladir</span><span class="symbol">=</span><span class="normal">`</span><span class="variable">$echo</span><span class="normal"> </span><span class="string">"X$lib"</span><span class="normal"> </span><span class="symbol">|</span><span class="normal"> </span><span class="variable">$Xsed</span><span class="normal"> -e </span><span class="string">'s%/[^/]*$%%'</span><span class="normal">`</span>
<span class="normal">		    </span><span class="keyword">test</span><span class="normal"> </span><span class="string">"X$ladir"</span><span class="normal"> </span><span class="symbol">=</span><span class="normal"> </span><span class="string">"X$lib"</span><span class="normal"> </span><span class="symbol">&amp;&amp;</span><span class="normal"> </span><span class="variable">ladir</span><span class="symbol">=</span><span class="string">"."</span>
<span class="normal">		    </span><span class="variable">lib</span><span class="symbol">=</span><span class="variable">$ladir</span><span class="symbol">/</span><span class="variable">$old_library</span>
<span class="normal">		    </span><span class="keyword">if</span><span class="normal"> </span><span class="keyword">test</span><span class="normal"> </span><span class="string">"$linkmode,$pass"</span><span class="normal"> </span><span class="symbol">=</span><span class="normal"> </span><span class="string">"prog,link"</span><span class="symbol">;</span><span class="normal"> </span><span class="keyword">then</span>
<span class="normal">		      </span><span class="variable">compile_deplibs</span><span class="symbol">=</span><span class="string">"$deplib $compile_deplibs"</span>
<span class="normal">		      </span><span class="variable">finalize_deplibs</span><span class="symbol">=</span><span class="string">"$deplib $finalize_deplibs"</span>
<span class="normal">		    </span><span class="keyword">else</span>
<span class="normal">		      </span><span class="variable">deplibs</span><span class="symbol">=</span><span class="string">"$deplib $deplibs"</span>
<span class="normal">		      </span><span class="keyword">test</span><span class="normal"> </span><span class="string">"$linkmode"</span><span class="normal"> </span><span class="symbol">=</span><span class="normal"> lib </span><span class="symbol">&amp;&amp;</span><span class="normal"> </span><span class="variable">newdependency_libs</span><span class="symbol">=</span><span class="string">"$deplib $newdependency_libs"</span>
<span class="normal">		    </span><span class="keyword">fi</span>
<span class="normal">		    </span><span class="keyword">continue</span>
<span class="normal">		  </span><span class="keyword">fi</span>
<span class="normal">		</span><span class="keyword">fi</span>
<span class="normal">	        </span><span class="symbol">;;</span>
<span class="normal">	      </span><span class="symbol">*)</span><span class="normal"> </span><span class="symbol">;;</span>
<span class="normal">	      </span><span class="keyword">esac</span>
<span class="normal">	    </span><span class="keyword">fi</span>
<span class="normal">	  </span><span class="keyword">fi</span>
<span class="normal">	  </span><span class="symbol">;;</span><span class="normal"> </span><span class="comment"># -l</span>
<span class="normal">	-L</span><span class="symbol">*)</span>
<span class="normal">	  </span><span class="keyword">case</span><span class="normal"> </span><span class="variable">$linkmode</span><span class="normal"> </span><span class="keyword">in</span>
<span class="normal">	  lib</span><span class="symbol">)</span>
<span class="normal">	    </span><span class="variable">deplibs</span><span class="symbol">=</span><span class="string">"$deplib $deplibs"</span>
<span class="normal">	    </span><span class="keyword">test</span><span class="normal"> </span><span class="string">"$pass"</span><span class="normal"> </span><span class="symbol">=</span><span class="normal"> conv </span><span class="symbol">&amp;&amp;</span><span class="normal"> </span><span class="keyword">continue</span>
<span class="normal">	    </span><span class="variable">newdependency_libs</span><span class="symbol">=</span><span class="string">"$deplib $newdependency_libs"</span>
<span class="normal">	    </span><span class="variable">newlib_search_path</span><span class="symbol">=</span><span class="string">"$newlib_search_path "</span><span class="normal">`</span><span class="variable">$echo</span><span class="normal"> </span><span class="string">"X$deplib"</span><span class="normal"> </span><span class="symbol">|</span><span class="normal"> </span><span class="variable">$Xsed</span><span class="normal"> -e </span><span class="string">'s/^-L//'</span><span class="normal">`</span>
<span class="normal">	    </span><span class="symbol">;;</span>
<span class="normal">	  prog</span><span class="symbol">)</span>
<span class="normal">	    </span><span class="keyword">if</span><span class="normal"> </span><span class="keyword">test</span><span class="normal"> </span><span class="string">"$pass"</span><span class="normal"> </span><span class="symbol">=</span><span class="normal"> conv</span><span class="symbol">;</span><span class="normal"> </span><span class="keyword">then</span>
<span class="normal">	      </span><span class="variable">deplibs</span><span class="symbol">=</span><span class="string">"$deplib $deplibs"</span>
<span class="normal">	      </span><span class="keyword">continue</span>
<span class="normal">	    </span><span class="keyword">fi</span>
<span class="normal">	    </span><span class="keyword">if</span><span class="normal"> </span><span class="keyword">test</span><span class="normal"> </span><span class="string">"$pass"</span><span class="normal"> </span><span class="symbol">=</span><span class="normal"> scan</span><span class="symbol">;</span><span class="normal"> </span><span class="keyword">then</span>
<span class="normal">	      </span><span class="variable">deplibs</span><span class="symbol">=</span><span class="string">"$deplib $deplibs"</span>
<span class="normal">	    </span><span class="keyword">else</span>
<span class="normal">	      </span><span class="variable">compile_deplibs</span><span class="symbol">=</span><span class="string">"$deplib $compile_deplibs"</span>
<span class="normal">	      </span><span class="variable">finalize_deplibs</span><span class="symbol">=</span><span class="string">"$deplib $finalize_deplibs"</span>
<span class="normal">	    </span><span class="keyword">fi</span>
<span class="normal">	    </span><span class="variable">newlib_search_path</span><span class="symbol">=</span><span class="string">"$newlib_search_path "</span><span class="normal">`</span><span class="variable">$echo</span><span class="normal"> </span><span class="string">"X$deplib"</span><span class="normal"> </span><span class="symbol">|</span><span class="normal"> </span><span class="variable">$Xsed</span><span class="normal"> -e </span><span class="string">'s/^-L//'</span><span class="normal">`</span>
<span class="normal">	    </span><span class="symbol">;;</span>
<span class="normal">	  </span><span class="symbol">*)</span>
<span class="normal">	    </span><span class="variable">$echo</span><span class="normal"> </span><span class="string">"$modename: warning: </span><span class="specialchar">\`</span><span class="string">-L' is ignored for archives/objects"</span><span class="normal"> </span><span class="number">1</span><span class="symbol">&gt;&amp;</span><span class="number">2</span>
<span class="normal">	    </span><span class="symbol">;;</span>
<span class="normal">	  </span><span class="keyword">esac</span><span class="normal"> </span><span class="comment"># linkmode</span>
<span class="normal">	  </span><span class="keyword">continue</span>
<span class="normal">	  </span><span class="symbol">;;</span><span class="normal"> </span><span class="comment"># -L</span>
<span class="normal">	-R</span><span class="symbol">*)</span>
<span class="normal">	  </span><span class="keyword">if</span><span class="normal"> </span><span class="keyword">test</span><span class="normal"> </span><span class="string">"$pass"</span><span class="normal"> </span><span class="symbol">=</span><span class="normal"> link</span><span class="symbol">;</span><span class="normal"> </span><span class="keyword">then</span>
<span class="normal">	    </span><span class="variable">dir</span><span class="symbol">=</span><span class="normal">`</span><span class="variable">$echo</span><span class="normal"> </span><span class="string">"X$deplib"</span><span class="normal"> </span><span class="symbol">|</span><span class="normal"> </span><span class="variable">$Xsed</span><span class="normal"> -e </span><span class="string">'s/^-R//'</span><span class="normal">`</span>
<span class="normal">	    </span><span class="comment"># Make sure the xrpath contains only unique directories.</span>
<span class="normal">	    </span><span class="keyword">case</span><span class="normal"> </span><span class="string">"$xrpath "</span><span class="normal"> </span><span class="keyword">in</span>
<span class="normal">	    </span><span class="symbol">*</span><span class="string">" $dir "</span><span class="symbol">*)</span><span class="normal"> </span><span class="symbol">;;</span>
<span class="normal">	    </span><span class="symbol">*)</span><span class="normal"> </span><span class="variable">xrpath</span><span class="symbol">=</span><span class="string">"$xrpath $dir"</span><span class="normal"> </span><span class="symbol">;;</span>
<span class="normal">	    </span><span class="keyword">esac</span>
<span class="normal">	  </span><span class="keyword">fi</span>
<span class="normal">	  </span><span class="variable">deplibs</span><span class="symbol">=</span><span class="string">"$deplib $deplibs"</span>
<span class="normal">	  </span><span class="keyword">continue</span>
<span class="normal">	  </span><span class="symbol">;;</span>
<span class="normal">	</span><span class="symbol">*.</span><span class="normal">la</span><span class="symbol">)</span><span class="normal"> </span><span class="variable">lib</span><span class="symbol">=</span><span class="string">"$deplib"</span><span class="normal"> </span><span class="symbol">;;</span>
<span class="normal">	</span><span class="symbol">*.</span><span class="variable">$libext</span><span class="symbol">)</span>
<span class="normal">	  </span><span class="keyword">if</span><span class="normal"> </span><span class="keyword">test</span><span class="normal"> </span><span class="string">"$pass"</span><span class="normal"> </span><span class="symbol">=</span><span class="normal"> conv</span><span class="symbol">;</span><span class="normal"> </span><span class="keyword">then</span>
<span class="normal">	    </span><span class="variable">deplibs</span><span class="symbol">=</span><span class="string">"$deplib $deplibs"</span>
<span class="normal">	    </span><span class="keyword">continue</span>
<span class="normal">	  </span><span class="keyword">fi</span>
<span class="normal">	  </span><span class="keyword">case</span><span class="normal"> </span><span class="variable">$linkmode</span><span class="normal"> </span><span class="keyword">in</span>
<span class="normal">	  lib</span><span class="symbol">)</span>
<span class="normal">	    </span><span class="variable">valid_a_lib</span><span class="symbol">=</span><span class="normal">no</span>
<span class="normal">	    </span><span class="keyword">case</span><span class="normal"> </span><span class="variable">$deplibs_check_method</span><span class="normal"> </span><span class="keyword">in</span>
<span class="normal">	      match_pattern</span><span class="symbol">*)</span>
<span class="normal">		</span><span class="keyword">set</span><span class="normal"> dummy </span><span class="variable">$deplibs_check_method</span>
<span class="normal">	        </span><span class="variable">match_pattern_regex</span><span class="symbol">=</span><span class="normal">`expr </span><span class="string">"$deplibs_check_method"</span><span class="normal"> </span><span class="symbol">:</span><span class="normal"> </span><span class="string">"$2 </span><span class="specialchar">\(</span><span class="string">.*</span><span class="specialchar">\)</span><span class="string">"</span><span class="normal">`</span>
<span class="normal">		</span><span class="keyword">if</span><span class="normal"> </span><span class="keyword">eval</span><span class="normal"> </span><span class="variable">$echo</span><span class="normal"> \"</span><span class="variable">$deplib</span><span class="normal">\" </span><span class="number">2</span><span class="symbol">&gt;</span><span class="normal">/dev/null </span><span class="symbol">\</span>
<span class="normal">		    </span><span class="symbol">|</span><span class="normal"> </span><span class="variable">$SED</span><span class="normal"> 10q </span><span class="symbol">\</span>
<span class="normal">		    </span><span class="symbol">|</span><span class="normal"> </span><span class="variable">$EGREP</span><span class="normal"> </span><span class="string">"$match_pattern_regex"</span><span class="normal"> </span><span class="symbol">&gt;</span><span class="normal"> /dev/null</span><span class="symbol">;</span><span class="normal"> </span><span class="keyword">then</span>
<span class="normal">		  </span><span class="variable">valid_a_lib</span><span class="symbol">=</span><span class="normal">yes</span>
<span class="normal">		</span><span class="keyword">fi</span>
<span class="normal">		</span><span class="symbol">;;</span>
<span class="normal">	      pass_all</span><span class="symbol">)</span>
<span class="normal">		</span><span class="variable">valid_a_lib</span><span class="symbol">=</span><span class="normal">yes</span>
<span class="normal">		</span><span class="symbol">;;</span>
<span class="normal">            </span><span class="keyword">esac</span>
<span class="normal">	    </span><span class="keyword">if</span><span class="normal"> </span><span class="keyword">test</span><span class="normal"> </span><span class="string">"$valid_a_lib"</span><span class="normal"> </span><span class="symbol">!=</span><span class="normal"> yes</span><span class="symbol">;</span><span class="normal"> </span><span class="keyword">then</span>
<span class="normal">	      </span><span class="variable">$echo</span>
<span class="normal">	      </span><span class="variable">$echo</span><span class="normal"> </span><span class="string">"*** Warning: Trying to link with static lib archive $deplib."</span>
<span class="normal">	      </span><span class="variable">$echo</span><span class="normal"> </span><span class="string">"*** I have the capability to make that library automatically link in when"</span>
<span class="normal">	      </span><span class="variable">$echo</span><span class="normal"> </span><span class="string">"*** you link to this library.  But I can only do this if you have a"</span>
<span class="normal">	      </span><span class="variable">$echo</span><span class="normal"> </span><span class="string">"*** shared version of the library, which you do not appear to have"</span>
<span class="normal">	      </span><span class="variable">$echo</span><span class="normal"> </span><span class="string">"*** because the file extensions .$libext of this argument makes me believe"</span>
<span class="normal">	      </span><span class="variable">$echo</span><span class="normal"> </span><span class="string">"*** that it is just a static archive that I should not used here."</span>
<span class="normal">	    </span><span class="keyword">else</span>
<span class="normal">	      </span><span class="variable">$echo</span>
<span class="normal">	      </span><span class="variable">$echo</span><span class="normal"> </span><span class="string">"*** Warning: Linking the shared library $output against the"</span>
<span class="normal">	      </span><span class="variable">$echo</span><span class="normal"> </span><span class="string">"*** static library $deplib is not portable!"</span>
<span class="normal">	      </span><span class="variable">deplibs</span><span class="symbol">=</span><span class="string">"$deplib $deplibs"</span>
<span class="normal">	    </span><span class="keyword">fi</span>
<span class="normal">	    </span><span class="keyword">continue</span>
<span class="normal">	    </span><span class="symbol">;;</span>
<span class="normal">	  prog</span><span class="symbol">)</span>
<span class="normal">	    </span><span class="keyword">if</span><span class="normal"> </span><span class="keyword">test</span><span class="normal"> </span><span class="string">"$pass"</span><span class="normal"> </span><span class="symbol">!=</span><span class="normal"> link</span><span class="symbol">;</span><span class="normal"> </span><span class="keyword">then</span>
<span class="normal">	      </span><span class="variable">deplibs</span><span class="symbol">=</span><span class="string">"$deplib $deplibs"</span>
<span class="normal">	    </span><span class="keyword">else</span>
<span class="normal">	      </span><span class="variable">compile_deplibs</span><span class="symbol">=</span><span class="string">"$deplib $compile_deplibs"</span>
<span class="normal">	      </span><span class="variable">finalize_deplibs</span><span class="symbol">=</span><span class="string">"$deplib $finalize_deplibs"</span>
<span class="normal">	    </span><span class="keyword">fi</span>
<span class="normal">	    </span><span class="keyword">continue</span>
<span class="normal">	    </span><span class="symbol">;;</span>
<span class="normal">	  </span><span class="keyword">esac</span><span class="normal"> </span><span class="comment"># linkmode</span>
<span class="normal">	  </span><span class="symbol">;;</span><span class="normal"> </span><span class="comment"># *.$libext</span>
<span class="normal">	</span><span class="symbol">*.</span><span class="normal">lo </span><span class="symbol">|</span><span class="normal"> </span><span class="symbol">*.</span><span class="variable">$objext</span><span class="symbol">)</span>
<span class="normal">	  </span><span class="keyword">if</span><span class="normal"> </span><span class="keyword">test</span><span class="normal"> </span><span class="string">"$pass"</span><span class="normal"> </span><span class="symbol">=</span><span class="normal"> conv</span><span class="symbol">;</span><span class="normal"> </span><span class="keyword">then</span>
<span class="normal">	    </span><span class="variable">deplibs</span><span class="symbol">=</span><span class="string">"$deplib $deplibs"</span>
<span class="normal">	  </span><span class="keyword">elif</span><span class="normal"> </span><span class="keyword">test</span><span class="normal"> </span><span class="string">"$linkmode"</span><span class="normal"> </span><span class="symbol">=</span><span class="normal"> prog</span><span class="symbol">;</span><span class="normal"> </span><span class="keyword">then</span>
<span class="normal">	    </span><span class="keyword">if</span><span class="normal"> </span><span class="keyword">test</span><span class="normal"> </span><span class="string">"$pass"</span><span class="normal"> </span><span class="symbol">=</span><span class="normal"> dlpreopen </span><span class="symbol">||</span><span class="normal"> </span><span class="keyword">test</span><span class="normal"> </span><span class="string">"$dlopen_support"</span><span class="normal"> </span><span class="symbol">!=</span><span class="normal"> yes </span><span class="symbol">||</span><span class="normal"> </span><span class="keyword">test</span><span class="normal"> </span><span class="string">"$build_libtool_libs"</span><span class="normal"> </span><span class="symbol">=</span><span class="normal"> no</span><span class="symbol">;</span><span class="normal"> </span><span class="keyword">then</span>
<span class="normal">	      </span><span class="comment"># If there is no dlopen support or we're linking statically,</span>
<span class="normal">	      </span><span class="comment"># we need to preload.</span>
<span class="normal">	      </span><span class="variable">newdlprefiles</span><span class="symbol">=</span><span class="string">"$newdlprefiles $deplib"</span>
<span class="normal">	      </span><span class="variable">compile_deplibs</span><span class="symbol">=</span><span class="string">"$deplib $compile_deplibs"</span>
<span class="normal">	      </span><span class="variable">finalize_deplibs</span><span class="symbol">=</span><span class="string">"$deplib $finalize_deplibs"</span>
<span class="normal">	    </span><span class="keyword">else</span>
<span class="normal">	      </span><span class="variable">newdlfiles</span><span class="symbol">=</span><span class="string">"$newdlfiles $deplib"</span>
<span class="normal">	    </span><span class="keyword">fi</span>
<span class="normal">	  </span><span class="keyword">fi</span>
<span class="normal">	  </span><span class="keyword">continue</span>
<span class="normal">	  </span><span class="symbol">;;</span>
<span class="normal">	</span><span class="symbol">%</span><span class="normal">DEPLIBS</span><span class="symbol">%)</span>
<span class="normal">	  </span><span class="variable">alldeplibs</span><span class="symbol">=</span><span class="normal">yes</span>
<span class="normal">	  </span><span class="keyword">continue</span>
<span class="normal">	  </span><span class="symbol">;;</span>
<span class="normal">	</span><span class="keyword">esac</span><span class="normal"> </span><span class="comment"># case $deplib</span>
<span class="normal">	</span><span class="keyword">if</span><span class="normal"> </span><span class="keyword">test</span><span class="normal"> </span><span class="string">"$found"</span><span class="normal"> </span><span class="symbol">=</span><span class="normal"> yes </span><span class="symbol">||</span><span class="normal"> </span><span class="keyword">test</span><span class="normal"> -f </span><span class="string">"$lib"</span><span class="symbol">;</span><span class="normal"> </span><span class="keyword">then</span><span class="normal"> </span><span class="symbol">:</span>
<span class="normal">	</span><span class="keyword">else</span>
<span class="normal">	  </span><span class="variable">$echo</span><span class="normal"> </span><span class="string">"$modename: cannot find the library </span><span class="specialchar">\`</span><span class="string">$lib' or unhandled argument </span><span class="specialchar">\`</span><span class="string">$deplib'"</span><span class="normal"> </span><span class="number">1</span><span class="symbol">&gt;&amp;</span><span class="number">2</span>
<span class="normal">	  </span><span class="keyword">exit</span><span class="normal"> </span><span class="variable">$EXIT_FAILURE</span>
<span class="normal">	</span><span class="keyword">fi</span>

<span class="normal">	</span><span class="comment"># Check to see that this really is a libtool archive.</span>
<span class="normal">	</span><span class="keyword">if</span><span class="normal"> </span><span class="symbol">(</span><span class="variable">${SED}</span><span class="normal"> -e </span><span class="string">'2q'</span><span class="normal"> </span><span class="variable">$lib</span><span class="normal"> </span><span class="symbol">|</span><span class="normal"> grep </span><span class="string">"^# Generated by .*$PACKAGE"</span><span class="symbol">)</span><span class="normal"> </span><span class="symbol">&gt;</span><span class="normal">/dev/null </span><span class="number">2</span><span class="symbol">&gt;&amp;</span><span class="number">1</span><span class="symbol">;</span><span class="normal"> </span><span class="keyword">then</span><span class="normal"> </span><span class="symbol">:</span>
<span class="normal">	</span><span class="keyword">else</span>
<span class="normal">	  </span><span class="variable">$echo</span><span class="normal"> </span><span class="string">"$modename: </span><span class="specialchar">\`</span><span class="string">$lib' is not a valid libtool archive"</span><span class="normal"> </span><span class="number">1</span><span class="symbol">&gt;&amp;</span><span class="number">2</span>
<span class="normal">	  </span><span class="keyword">exit</span><span class="normal"> </span><span class="variable">$EXIT_FAILURE</span>
<span class="normal">	</span><span class="keyword">fi</span>

<span class="normal">	</span><span class="variable">ladir</span><span class="symbol">=</span><span class="normal">`</span><span class="variable">$echo</span><span class="normal"> </span><span class="string">"X$lib"</span><span class="normal"> </span><span class="symbol">|</span><span class="normal"> </span><span class="variable">$Xsed</span><span class="normal"> -e </span><span class="string">'s%/[^/]*$%%'</span><span class="normal">`</span>
<span class="normal">	</span><span class="keyword">test</span><span class="normal"> </span><span class="string">"X$ladir"</span><span class="normal"> </span><span class="symbol">=</span><span class="normal"> </span><span class="string">"X$lib"</span><span class="normal"> </span><span class="symbol">&amp;&amp;</span><span class="normal"> </span><span class="variable">ladir</span><span class="symbol">=</span><span class="string">"."</span>

<span class="normal">	</span><span class="variable">dlname</span><span class="symbol">=</span>
<span class="normal">	</span><span class="variable">dlopen</span><span class="symbol">=</span>
<span class="normal">	</span><span class="variable">dlpreopen</span><span class="symbol">=</span>
<span class="normal">	</span><span class="variable">libdir</span><span class="symbol">=</span>
<span class="normal">	</span><span class="variable">library_names</span><span class="symbol">=</span>
<span class="normal">	</span><span class="variable">old_library</span><span class="symbol">=</span>
<span class="normal">	</span><span class="comment"># If the library was installed with an old release of libtool,</span>
<span class="normal">	</span><span class="comment"># it will not redefine variables installed, or shouldnotlink</span>
<span class="normal">	</span><span class="variable">installed</span><span class="symbol">=</span><span class="normal">yes</span>
<span class="normal">	</span><span class="variable">shouldnotlink</span><span class="symbol">=</span><span class="normal">no</span>
<span class="normal">	</span><span class="variable">avoidtemprpath</span><span class="symbol">=</span>


<span class="normal">	</span><span class="comment"># Read the .la file</span>
<span class="normal">	</span><span class="keyword">case</span><span class="normal"> </span><span class="variable">$lib</span><span class="normal"> </span><span class="keyword">in</span>
<span class="normal">	</span><span class="symbol">*/*</span><span class="normal"> </span><span class="symbol">|</span><span class="normal"> </span><span class="symbol">*\\*)</span><span class="normal"> </span><span class="symbol">.</span><span class="normal"> </span><span class="variable">$lib</span><span class="normal"> </span><span class="symbol">;;</span>
<span class="normal">	</span><span class="symbol">*)</span><span class="normal"> </span><span class="symbol">.</span><span class="normal"> </span><span class="symbol">./</span><span class="variable">$lib</span><span class="normal"> </span><span class="symbol">;;</span>
<span class="normal">	</span><span class="keyword">esac</span>

<span class="normal">	</span><span class="keyword">if</span><span class="normal"> </span><span class="keyword">test</span><span class="normal"> </span><span class="string">"$linkmode,$pass"</span><span class="normal"> </span><span class="symbol">=</span><span class="normal"> </span><span class="string">"lib,link"</span><span class="normal"> </span><span class="symbol">||</span>
<span class="normal">	   </span><span class="keyword">test</span><span class="normal"> </span><span class="string">"$linkmode,$pass"</span><span class="normal"> </span><span class="symbol">=</span><span class="normal"> </span><span class="string">"prog,scan"</span><span class="normal"> </span><span class="symbol">||</span>
<span class="normal">	   { </span><span class="keyword">test</span><span class="normal"> </span><span class="string">"$linkmode"</span><span class="normal"> </span><span class="symbol">!=</span><span class="normal"> prog </span><span class="symbol">&amp;&amp;</span><span class="normal"> </span><span class="keyword">test</span><span class="normal"> </span><span class="string">"$linkmode"</span><span class="normal"> </span><span class="symbol">!=</span><span class="normal"> lib</span><span class="symbol">;</span><span class="normal"> }</span><span class="symbol">;</span><span class="normal"> </span><span class="keyword">then</span>
<span class="normal">	  </span><span class="keyword">test</span><span class="normal"> -n </span><span class="string">"$dlopen"</span><span class="normal"> </span><span class="symbol">&amp;&amp;</span><span class="normal"> </span><span class="variable">dlfiles</span><span class="symbol">=</span><span class="string">"$dlfiles $dlopen"</span>
<span class="normal">	  </span><span class="keyword">test</span><span class="normal"> -n </span><span class="string">"$dlpreopen"</span><span class="normal"> </span><span class="symbol">&amp;&amp;</span><span class="normal"> </span><span class="variable">dlprefiles</span><span class="symbol">=</span><span class="string">"$dlprefiles $dlpreopen"</span>
<span class="normal">	</span><span class="keyword">fi</span>

<span class="normal">	</span><span class="keyword">if</span><span class="normal"> </span><span class="keyword">test</span><span class="normal"> </span><span class="string">"$pass"</span><span class="normal"> </span><span class="symbol">=</span><span class="normal"> conv</span><span class="symbol">;</span><span class="normal"> </span><span class="keyword">then</span>
<span class="normal">	  </span><span class="comment"># Only check for convenience libraries</span>
<span class="normal">	  </span><span class="variable">deplibs</span><span class="symbol">=</span><span class="string">"$lib $deplibs"</span>
<span class="normal">	  </span><span class="keyword">if</span><span class="normal"> </span><span class="keyword">test</span><span class="normal"> -z </span><span class="string">"$libdir"</span><span class="symbol">;</span><span class="normal"> </span><span class="keyword">then</span>
<span class="normal">	    </span><span class="keyword">if</span><span class="normal"> </span><span class="keyword">test</span><span class="normal"> -z </span><span class="string">"$old_library"</span><span class="symbol">;</span><span class="normal"> </span><span class="keyword">then</span>
<span class="normal">	      </span><span class="variable">$echo</span><span class="normal"> </span><span class="string">"$modename: cannot find name of link library for </span><span class="specialchar">\`</span><span class="string">$lib'"</span><span class="normal"> </span><span class="number">1</span><span class="symbol">&gt;&amp;</span><span class="number">2</span>
<span class="normal">	      </span><span class="keyword">exit</span><span class="normal"> </span><span class="variable">$EXIT_FAILURE</span>
<span class="normal">	    </span><span class="keyword">fi</span>
<span class="normal">	    </span><span class="comment"># It is a libtool convenience library, so add in its objects.</span>
<span class="normal">	    </span><span class="variable">convenience</span><span class="symbol">=</span><span class="string">"$convenience $ladir/$objdir/$old_library"</span>
<span class="normal">	    </span><span class="variable">old_convenience</span><span class="symbol">=</span><span class="string">"$old_convenience $ladir/$objdir/$old_library"</span>
<span class="normal">	    </span><span class="variable">tmp_libs</span><span class="symbol">=</span>
<span class="normal">	    </span><span class="keyword">for</span><span class="normal"> deplib </span><span class="keyword">in</span><span class="normal"> </span><span class="variable">$dependency_libs</span><span class="symbol">;</span><span class="normal"> </span><span class="keyword">do</span>
<span class="normal">	      </span><span class="variable">deplibs</span><span class="symbol">=</span><span class="string">"$deplib $deplibs"</span>
<span class="normal">              </span><span class="keyword">if</span><span class="normal"> </span><span class="keyword">test</span><span class="normal"> </span><span class="string">"X$duplicate_deps"</span><span class="normal"> </span><span class="symbol">=</span><span class="normal"> </span><span class="string">"Xyes"</span><span class="normal"> </span><span class="symbol">;</span><span class="normal"> </span><span class="keyword">then</span>
<span class="normal">	        </span><span class="keyword">case</span><span class="normal"> </span><span class="string">"$tmp_libs "</span><span class="normal"> </span><span class="keyword">in</span>
<span class="normal">	        </span><span class="symbol">*</span><span class="string">" $deplib "</span><span class="symbol">*)</span><span class="normal"> </span><span class="variable">specialdeplibs</span><span class="symbol">=</span><span class="string">"$specialdeplibs $deplib"</span><span class="normal"> </span><span class="symbol">;;</span>
<span class="normal">	        </span><span class="keyword">esac</span>
<span class="normal">              </span><span class="keyword">fi</span>
<span class="normal">	      </span><span class="variable">tmp_libs</span><span class="symbol">=</span><span class="string">"$tmp_libs $deplib"</span>
<span class="normal">	    </span><span class="keyword">done</span>
<span class="normal">	  </span><span class="keyword">elif</span><span class="normal"> </span><span class="keyword">test</span><span class="normal"> </span><span class="string">"$linkmode"</span><span class="normal"> </span><span class="symbol">!=</span><span class="normal"> prog </span><span class="symbol">&amp;&amp;</span><span class="normal"> </span><span class="keyword">test</span><span class="normal"> </span><span class="string">"$linkmode"</span><span class="normal"> </span><span class="symbol">!=</span><span class="normal"> lib</span><span class="symbol">;</span><span class="normal"> </span><span class="keyword">then</span>
<span class="normal">	    </span><span class="variable">$echo</span><span class="normal"> </span><span class="string">"$modename: </span><span class="specialchar">\`</span><span class="string">$lib' is not a convenience library"</span><span class="normal"> </span><span class="number">1</span><span class="symbol">&gt;&amp;</span><span class="number">2</span>
<span class="normal">	    </span><span class="keyword">exit</span><span class="normal"> </span><span class="variable">$EXIT_FAILURE</span>
<span class="normal">	  </span><span class="keyword">fi</span>
<span class="normal">	  </span><span class="keyword">continue</span>
<span class="normal">	</span><span class="keyword">fi</span><span class="normal"> </span><span class="comment"># $pass = conv</span>


<span class="normal">	</span><span class="comment"># Get the name of the library we link against.</span>
<span class="normal">	</span><span class="variable">linklib</span><span class="symbol">=</span>
<span class="normal">	</span><span class="keyword">for</span><span class="normal"> l </span><span class="keyword">in</span><span class="normal"> </span><span class="variable">$old_library</span><span class="normal"> </span><span class="variable">$library_names</span><span class="symbol">;</span><span class="normal"> </span><span class="keyword">do</span>
<span class="normal">	  </span><span class="variable">linklib</span><span class="symbol">=</span><span class="string">"$l"</span>
<span class="normal">	</span><span class="keyword">done</span>
<span class="normal">	</span><span class="keyword">if</span><span class="normal"> </span><span class="keyword">test</span><span class="normal"> -z </span><span class="string">"$linklib"</span><span class="symbol">;</span><span class="normal"> </span><span class="keyword">then</span>
<span class="normal">	  </span><span class="variable">$echo</span><span class="normal"> </span><span class="string">"$modename: cannot find name of link library for </span><span class="specialchar">\`</span><span class="string">$lib'"</span><span class="normal"> </span><span class="number">1</span><span class="symbol">&gt;&amp;</span><span class="number">2</span>
<span class="normal">	  </span><span class="keyword">exit</span><span class="normal"> </span><span class="variable">$EXIT_FAILURE</span>
<span class="normal">	</span><span class="keyword">fi</span>

<span class="normal">	</span><span class="comment"># This library was specified with -dlopen.</span>
<span class="normal">	</span><span class="keyword">if</span><span class="normal"> </span><span class="keyword">test</span><span class="normal"> </span><span class="string">"$pass"</span><span class="normal"> </span><span class="symbol">=</span><span class="normal"> dlopen</span><span class="symbol">;</span><span class="normal"> </span><span class="keyword">then</span>
<span class="normal">	  </span><span class="keyword">if</span><span class="normal"> </span><span class="keyword">test</span><span class="normal"> -z </span><span class="string">"$libdir"</span><span class="symbol">;</span><span class="normal"> </span><span class="keyword">then</span>
<span class="normal">	    </span><span class="variable">$echo</span><span class="normal"> </span><span class="string">"$modename: cannot -dlopen a convenience library: </span><span class="specialchar">\`</span><span class="string">$lib'"</span><span class="normal"> </span><span class="number">1</span><span class="symbol">&gt;&amp;</span><span class="number">2</span>
<span class="normal">	    </span><span class="keyword">exit</span><span class="normal"> </span><span class="variable">$EXIT_FAILURE</span>
<span class="normal">	  </span><span class="keyword">fi</span>
<span class="normal">	  </span><span class="keyword">if</span><span class="normal"> </span><span class="keyword">test</span><span class="normal"> -z </span><span class="string">"$dlname"</span><span class="normal"> </span><span class="symbol">||</span>
<span class="normal">	     </span><span class="keyword">test</span><span class="normal"> </span><span class="string">"$dlopen_support"</span><span class="normal"> </span><span class="symbol">!=</span><span class="normal"> yes </span><span class="symbol">||</span>
<span class="normal">	     </span><span class="keyword">test</span><span class="normal"> </span><span class="string">"$build_libtool_libs"</span><span class="normal"> </span><span class="symbol">=</span><span class="normal"> no</span><span class="symbol">;</span><span class="normal"> </span><span class="keyword">then</span>
<span class="normal">	    </span><span class="comment"># If there is no dlname, no dlopen support or we're linking</span>
<span class="normal">	    </span><span class="comment"># statically, we need to preload.  We also need to preload any</span>
<span class="normal">	    </span><span class="comment"># dependent libraries so libltdl's deplib preloader doesn't</span>
<span class="normal">	    </span><span class="comment"># bomb out in the load deplibs phase.</span>
<span class="normal">	    </span><span class="variable">dlprefiles</span><span class="symbol">=</span><span class="string">"$dlprefiles $lib $dependency_libs"</span>
<span class="normal">	  </span><span class="keyword">else</span>
<span class="normal">	    </span><span class="variable">newdlfiles</span><span class="symbol">=</span><span class="string">"$newdlfiles $lib"</span>
<span class="normal">	  </span><span class="keyword">fi</span>
<span class="normal">	  </span><span class="keyword">continue</span>
<span class="normal">	</span><span class="keyword">fi</span><span class="normal"> </span><span class="comment"># $pass = dlopen</span>

<span class="normal">	</span><span class="comment"># We need an absolute path.</span>
<span class="normal">	</span><span class="keyword">case</span><span class="normal"> </span><span class="variable">$ladir</span><span class="normal"> </span><span class="keyword">in</span>
<span class="normal">	</span><span class="symbol">[\\/]*</span><span class="normal"> </span><span class="symbol">|</span><span class="normal"> </span><span class="symbol">[</span><span class="normal">A-Za-z</span><span class="symbol">]:[\\/]*)</span><span class="normal"> </span><span class="variable">abs_ladir</span><span class="symbol">=</span><span class="string">"$ladir"</span><span class="normal"> </span><span class="symbol">;;</span>
<span class="normal">	</span><span class="symbol">*)</span>
<span class="normal">	  </span><span class="variable">abs_ladir</span><span class="symbol">=</span><span class="normal">`cd </span><span class="string">"$ladir"</span><span class="normal"> </span><span class="symbol">&amp;&amp;</span><span class="normal"> pwd`</span>
<span class="normal">	  </span><span class="keyword">if</span><span class="normal"> </span><span class="keyword">test</span><span class="normal"> -z </span><span class="string">"$abs_ladir"</span><span class="symbol">;</span><span class="normal"> </span><span class="keyword">then</span>
<span class="normal">	    </span><span class="variable">$echo</span><span class="normal"> </span><span class="string">"$modename: warning: cannot determine absolute directory name of </span><span class="specialchar">\`</span><span class="string">$ladir'"</span><span class="normal"> </span><span class="number">1</span><span class="symbol">&gt;&amp;</span><span class="number">2</span>
<span class="normal">	    </span><span class="variable">$echo</span><span class="normal"> </span><span class="string">"$modename: passing it literally to the linker, although it might fail"</span><span class="normal"> </span><span class="number">1</span><span class="symbol">&gt;&amp;</span><span class="number">2</span>
<span class="normal">	    </span><span class="variable">abs_ladir</span><span class="symbol">=</span><span class="string">"$ladir"</span>
<span class="normal">	  </span><span class="keyword">fi</span>
<span class="normal">	  </span><span class="symbol">;;</span>
<span class="normal">	</span><span class="keyword">esac</span>
<span class="normal">	</span><span class="variable">laname</span><span class="symbol">=</span><span class="normal">`</span><span class="variable">$echo</span><span class="normal"> </span><span class="string">"X$lib"</span><span class="normal"> </span><span class="symbol">|</span><span class="normal"> </span><span class="variable">$Xsed</span><span class="normal"> -e </span><span class="string">'s%^.*/%%'</span><span class="normal">`</span>

<span class="normal">	</span><span class="comment"># Find the relevant object directory and library name.</span>
<span class="normal">	</span><span class="keyword">if</span><span class="normal"> </span><span class="keyword">test</span><span class="normal"> </span><span class="string">"X$installed"</span><span class="normal"> </span><span class="symbol">=</span><span class="normal"> Xyes</span><span class="symbol">;</span><span class="normal"> </span><span class="keyword">then</span>
<span class="normal">	  </span><span class="keyword">if</span><span class="normal"> </span><span class="keyword">test</span><span class="normal"> </span><span class="symbol">!</span><span class="normal"> -f </span><span class="string">"$libdir/$linklib"</span><span class="normal"> </span><span class="symbol">&amp;&amp;</span><span class="normal"> </span><span class="keyword">test</span><span class="normal"> -f </span><span class="string">"$abs_ladir/$linklib"</span><span class="symbol">;</span><span class="normal"> </span><span class="keyword">then</span>
<span class="normal">	    </span><span class="variable">$echo</span><span class="normal"> </span><span class="string">"$modename: warning: library </span><span class="specialchar">\`</span><span class="string">$lib' was moved."</span><span class="normal"> </span><span class="number">1</span><span class="symbol">&gt;&amp;</span><span class="number">2</span>
<span class="normal">	    </span><span class="variable">dir</span><span class="symbol">=</span><span class="string">"$ladir"</span>
<span class="normal">	    </span><span class="variable">absdir</span><span class="symbol">=</span><span class="string">"$abs_ladir"</span>
<span class="normal">	    </span><span class="variable">libdir</span><span class="symbol">=</span><span class="string">"$abs_ladir"</span>
<span class="normal">	  </span><span class="keyword">else</span>
<span class="normal">	    </span><span class="variable">dir</span><span class="symbol">=</span><span class="string">"$libdir"</span>
<span class="normal">	    </span><span class="variable">absdir</span><span class="symbol">=</span><span class="string">"$libdir"</span>
<span class="normal">	  </span><span class="keyword">fi</span>
<span class="normal">	  </span><span class="keyword">test</span><span class="normal"> </span><span class="string">"X$hardcode_automatic"</span><span class="normal"> </span><span class="symbol">=</span><span class="normal"> Xyes </span><span class="symbol">&amp;&amp;</span><span class="normal"> </span><span class="variable">avoidtemprpath</span><span class="symbol">=</span><span class="normal">yes</span>
<span class="normal">	</span><span class="keyword">else</span>
<span class="normal">	  </span><span class="keyword">if</span><span class="normal"> </span><span class="keyword">test</span><span class="normal"> </span><span class="symbol">!</span><span class="normal"> -f </span><span class="string">"$ladir/$objdir/$linklib"</span><span class="normal"> </span><span class="symbol">&amp;&amp;</span><span class="normal"> </span><span class="keyword">test</span><span class="normal"> -f </span><span class="string">"$abs_ladir/$linklib"</span><span class="symbol">;</span><span class="normal"> </span><span class="keyword">then</span>
<span class="normal">	    </span><span class="variable">dir</span><span class="symbol">=</span><span class="string">"$ladir"</span>
<span class="normal">	    </span><span class="variable">absdir</span><span class="symbol">=</span><span class="string">"$abs_ladir"</span>
<span class="normal">	    </span><span class="comment"># Remove this search path later</span>
<span class="normal">	    </span><span class="variable">notinst_path</span><span class="symbol">=</span><span class="string">"$notinst_path $abs_ladir"</span>
<span class="normal">	  </span><span class="keyword">else</span>
<span class="normal">	    </span><span class="variable">dir</span><span class="symbol">=</span><span class="string">"$ladir/$objdir"</span>
<span class="normal">	    </span><span class="variable">absdir</span><span class="symbol">=</span><span class="string">"$abs_ladir/$objdir"</span>
<span class="normal">	    </span><span class="comment"># Remove this search path later</span>
<span class="normal">	    </span><span class="variable">notinst_path</span><span class="symbol">=</span><span class="string">"$notinst_path $abs_ladir"</span>
<span class="normal">	  </span><span class="keyword">fi</span>
<span class="normal">	</span><span class="keyword">fi</span><span class="normal"> </span><span class="comment"># $installed = yes</span>
<span class="normal">	</span><span class="variable">name</span><span class="symbol">=</span><span class="normal">`</span><span class="variable">$echo</span><span class="normal"> </span><span class="string">"X$laname"</span><span class="normal"> </span><span class="symbol">|</span><span class="normal"> </span><span class="variable">$Xsed</span><span class="normal"> -e </span><span class="string">'s/</span><span class="specialchar">\.</span><span class="string">la$//'</span><span class="normal"> -e </span><span class="string">'s/^lib//'</span><span class="normal">`</span>

<span class="normal">	</span><span class="comment"># This library was specified with -dlpreopen.</span>
<span class="normal">	</span><span class="keyword">if</span><span class="normal"> </span><span class="keyword">test</span><span class="normal"> </span><span class="string">"$pass"</span><span class="normal"> </span><span class="symbol">=</span><span class="normal"> dlpreopen</span><span class="symbol">;</span><span class="normal"> </span><span class="keyword">then</span>
<span class="normal">	  </span><span class="keyword">if</span><span class="normal"> </span><span class="keyword">test</span><span class="normal"> -z </span><span class="string">"$libdir"</span><span class="symbol">;</span><span class="normal"> </span><span class="keyword">then</span>
<span class="normal">	    </span><span class="variable">$echo</span><span class="normal"> </span><span class="string">"$modename: cannot -dlpreopen a convenience library: </span><span class="specialchar">\`</span><span class="string">$lib'"</span><span class="normal"> </span><span class="number">1</span><span class="symbol">&gt;&amp;</span><span class="number">2</span>
<span class="normal">	    </span><span class="keyword">exit</span><span class="normal"> </span><span class="variable">$EXIT_FAILURE</span>
<span class="normal">	  </span><span class="keyword">fi</span>
<span class="normal">	  </span><span class="comment"># Prefer using a static library (so that no silly _DYNAMIC symbols</span>
<span class="normal">	  </span><span class="comment"># are required to link).</span>
<span class="normal">	  </span><span class="keyword">if</span><span class="normal"> </span><span class="keyword">test</span><span class="normal"> -n </span><span class="string">"$old_library"</span><span class="symbol">;</span><span class="normal"> </span><span class="keyword">then</span>
<span class="normal">	    </span><span class="variable">newdlprefiles</span><span class="symbol">=</span><span class="string">"$newdlprefiles $dir/$old_library"</span>
<span class="normal">	  </span><span class="comment"># Otherwise, use the dlname, so that lt_dlopen finds it.</span>
<span class="normal">	  </span><span class="keyword">elif</span><span class="normal"> </span><span class="keyword">test</span><span class="normal"> -n </span><span class="string">"$dlname"</span><span class="symbol">;</span><span class="normal"> </span><span class="keyword">then</span>
<span class="normal">	    </span><span class="variable">newdlprefiles</span><span class="symbol">=</span><span class="string">"$newdlprefiles $dir/$dlname"</span>
<span class="normal">	  </span><span class="keyword">else</span>
<span class="normal">	    </span><span class="variable">newdlprefiles</span><span class="symbol">=</span><span class="string">"$newdlprefiles $dir/$linklib"</span>
<span class="normal">	  </span><span class="keyword">fi</span>
<span class="normal">	</span><span class="keyword">fi</span><span class="normal"> </span><span class="comment"># $pass = dlpreopen</span>

<span class="normal">	</span><span class="keyword">if</span><span class="normal"> </span><span class="keyword">test</span><span class="normal"> -z </span><span class="string">"$libdir"</span><span class="symbol">;</span><span class="normal"> </span><span class="keyword">then</span>
<span class="normal">	  </span><span class="comment"># Link the convenience library</span>
<span class="normal">	  </span><span class="keyword">if</span><span class="normal"> </span><span class="keyword">test</span><span class="normal"> </span><span class="string">"$linkmode"</span><span class="normal"> </span><span class="symbol">=</span><span class="normal"> lib</span><span class="symbol">;</span><span class="normal"> </span><span class="keyword">then</span>
<span class="normal">	    </span><span class="variable">deplibs</span><span class="symbol">=</span><span class="string">"$dir/$old_library $deplibs"</span>
<span class="normal">	  </span><span class="keyword">elif</span><span class="normal"> </span><span class="keyword">test</span><span class="normal"> </span><span class="string">"$linkmode,$pass"</span><span class="normal"> </span><span class="symbol">=</span><span class="normal"> </span><span class="string">"prog,link"</span><span class="symbol">;</span><span class="normal"> </span><span class="keyword">then</span>
<span class="normal">	    </span><span class="variable">compile_deplibs</span><span class="symbol">=</span><span class="string">"$dir/$old_library $compile_deplibs"</span>
<span class="normal">	    </span><span class="variable">finalize_deplibs</span><span class="symbol">=</span><span class="string">"$dir/$old_library $finalize_deplibs"</span>
<span class="normal">	  </span><span class="keyword">else</span>
<span class="normal">	    </span><span class="variable">deplibs</span><span class="symbol">=</span><span class="string">"$lib $deplibs"</span><span class="normal"> </span><span class="comment"># used for prog,scan pass</span>
<span class="normal">	  </span><span class="keyword">fi</span>
<span class="normal">	  </span><span class="keyword">continue</span>
<span class="normal">	</span><span class="keyword">fi</span>


<span class="normal">	</span><span class="keyword">if</span><span class="normal"> </span><span class="keyword">test</span><span class="normal"> </span><span class="string">"$linkmode"</span><span class="normal"> </span><span class="symbol">=</span><span class="normal"> prog </span><span class="symbol">&amp;&amp;</span><span class="normal"> </span><span class="keyword">test</span><span class="normal"> </span><span class="string">"$pass"</span><span class="normal"> </span><span class="symbol">!=</span><span class="normal"> link</span><span class="symbol">;</span><span class="normal"> </span><span class="keyword">then</span>
<span class="normal">	  </span><span class="variable">newlib_search_path</span><span class="symbol">=</span><span class="string">"$newlib_search_path $ladir"</span>
<span class="normal">	  </span><span class="variable">deplibs</span><span class="symbol">=</span><span class="string">"$lib $deplibs"</span>

<span class="normal">	  </span><span class="variable">linkalldeplibs</span><span class="symbol">=</span><span class="normal">no</span>
<span class="normal">	  </span><span class="keyword">if</span><span class="normal"> </span><span class="keyword">test</span><span class="normal"> </span><span class="string">"$link_all_deplibs"</span><span class="normal"> </span><span class="symbol">!=</span><span class="normal"> no </span><span class="symbol">||</span><span class="normal"> </span><span class="keyword">test</span><span class="normal"> -z </span><span class="string">"$library_names"</span><span class="normal"> </span><span class="symbol">||</span>
<span class="normal">	     </span><span class="keyword">test</span><span class="normal"> </span><span class="string">"$build_libtool_libs"</span><span class="normal"> </span><span class="symbol">=</span><span class="normal"> no</span><span class="symbol">;</span><span class="normal"> </span><span class="keyword">then</span>
<span class="normal">	    </span><span class="variable">linkalldeplibs</span><span class="symbol">=</span><span class="normal">yes</span>
<span class="normal">	  </span><span class="keyword">fi</span>

<span class="normal">	  </span><span class="variable">tmp_libs</span><span class="symbol">=</span>
<span class="normal">	  </span><span class="keyword">for</span><span class="normal"> deplib </span><span class="keyword">in</span><span class="normal"> </span><span class="variable">$dependency_libs</span><span class="symbol">;</span><span class="normal"> </span><span class="keyword">do</span>
<span class="normal">	    </span><span class="keyword">case</span><span class="normal"> </span><span class="variable">$deplib</span><span class="normal"> </span><span class="keyword">in</span>
<span class="normal">	    -L</span><span class="symbol">*)</span><span class="normal"> </span><span class="variable">newlib_search_path</span><span class="symbol">=</span><span class="string">"$newlib_search_path "</span><span class="normal">`</span><span class="variable">$echo</span><span class="normal"> </span><span class="string">"X$deplib"</span><span class="normal"> </span><span class="symbol">|</span><span class="normal"> </span><span class="variable">$Xsed</span><span class="normal"> -e </span><span class="string">'s/^-L//'</span><span class="normal">`</span><span class="symbol">;;</span><span class="normal"> </span><span class="comment">### testsuite: skip nested quoting test</span>
<span class="normal">	    </span><span class="keyword">esac</span>
<span class="normal">	    </span><span class="comment"># Need to link against all dependency_libs?</span>
<span class="normal">	    </span><span class="keyword">if</span><span class="normal"> </span><span class="keyword">test</span><span class="normal"> </span><span class="string">"$linkalldeplibs"</span><span class="normal"> </span><span class="symbol">=</span><span class="normal"> yes</span><span class="symbol">;</span><span class="normal"> </span><span class="keyword">then</span>
<span class="normal">	      </span><span class="variable">deplibs</span><span class="symbol">=</span><span class="string">"$deplib $deplibs"</span>
<span class="normal">	    </span><span class="keyword">else</span>
<span class="normal">	      </span><span class="comment"># Need to hardcode shared library paths</span>
<span class="normal">	      </span><span class="comment"># or/and link against static libraries</span>
<span class="normal">	      </span><span class="variable">newdependency_libs</span><span class="symbol">=</span><span class="string">"$deplib $newdependency_libs"</span>
<span class="normal">	    </span><span class="keyword">fi</span>
<span class="normal">	    </span><span class="keyword">if</span><span class="normal"> </span><span class="keyword">test</span><span class="normal"> </span><span class="string">"X$duplicate_deps"</span><span class="normal"> </span><span class="symbol">=</span><span class="normal"> </span><span class="string">"Xyes"</span><span class="normal"> </span><span class="symbol">;</span><span class="normal"> </span><span class="keyword">then</span>
<span class="normal">	      </span><span class="keyword">case</span><span class="normal"> </span><span class="string">"$tmp_libs "</span><span class="normal"> </span><span class="keyword">in</span>
<span class="normal">	      </span><span class="symbol">*</span><span class="string">" $deplib "</span><span class="symbol">*)</span><span class="normal"> </span><span class="variable">specialdeplibs</span><span class="symbol">=</span><span class="string">"$specialdeplibs $deplib"</span><span class="normal"> </span><span class="symbol">;;</span>
<span class="normal">	      </span><span class="keyword">esac</span>
<span class="normal">	    </span><span class="keyword">fi</span>
<span class="normal">	    </span><span class="variable">tmp_libs</span><span class="symbol">=</span><span class="string">"$tmp_libs $deplib"</span>
<span class="normal">	  </span><span class="keyword">done</span><span class="normal"> </span><span class="comment"># for deplib</span>
<span class="normal">	  </span><span class="keyword">continue</span>
<span class="normal">	</span><span class="keyword">fi</span><span class="normal"> </span><span class="comment"># $linkmode = prog...</span>

<span class="normal">	</span><span class="keyword">if</span><span class="normal"> </span><span class="keyword">test</span><span class="normal"> </span><span class="string">"$linkmode,$pass"</span><span class="normal"> </span><span class="symbol">=</span><span class="normal"> </span><span class="string">"prog,link"</span><span class="symbol">;</span><span class="normal"> </span><span class="keyword">then</span>
<span class="normal">	  </span><span class="keyword">if</span><span class="normal"> </span><span class="keyword">test</span><span class="normal"> -n </span><span class="string">"$library_names"</span><span class="normal"> </span><span class="symbol">&amp;&amp;</span>
<span class="normal">	     { { </span><span class="keyword">test</span><span class="normal"> </span><span class="string">"$prefer_static_libs"</span><span class="normal"> </span><span class="symbol">=</span><span class="normal"> no </span><span class="symbol">||</span>
<span class="normal">		 </span><span class="keyword">test</span><span class="normal"> </span><span class="string">"$prefer_static_libs,$installed"</span><span class="normal"> </span><span class="symbol">=</span><span class="normal"> </span><span class="string">"built,yes"</span><span class="symbol">;</span><span class="normal"> } </span><span class="symbol">||</span>
<span class="normal">	       </span><span class="keyword">test</span><span class="normal"> -z </span><span class="string">"$old_library"</span><span class="symbol">;</span><span class="normal"> }</span><span class="symbol">;</span><span class="normal"> </span><span class="keyword">then</span>
<span class="normal">	    </span><span class="comment"># We need to hardcode the library path</span>
<span class="normal">	    </span><span class="keyword">if</span><span class="normal"> </span><span class="keyword">test</span><span class="normal"> -n </span><span class="string">"$shlibpath_var"</span><span class="normal"> </span><span class="symbol">&amp;&amp;</span><span class="normal"> </span><span class="keyword">test</span><span class="normal"> -z </span><span class="string">"$avoidtemprpath"</span><span class="normal"> </span><span class="symbol">;</span><span class="normal"> </span><span class="keyword">then</span>
<span class="normal">	      </span><span class="comment"># Make sure the rpath contains only unique directories.</span>
<span class="normal">	      </span><span class="keyword">case</span><span class="normal"> </span><span class="string">"$temp_rpath "</span><span class="normal"> </span><span class="keyword">in</span>
<span class="normal">	      </span><span class="symbol">*</span><span class="string">" $dir "</span><span class="symbol">*)</span><span class="normal"> </span><span class="symbol">;;</span>
<span class="normal">	      </span><span class="symbol">*</span><span class="string">" $absdir "</span><span class="symbol">*)</span><span class="normal"> </span><span class="symbol">;;</span>
<span class="normal">	      </span><span class="symbol">*)</span><span class="normal"> </span><span class="variable">temp_rpath</span><span class="symbol">=</span><span class="string">"$temp_rpath $absdir"</span><span class="normal"> </span><span class="symbol">;;</span>
<span class="normal">	      </span><span class="keyword">esac</span>
<span class="normal">	    </span><span class="keyword">fi</span>

<span class="normal">	    </span><span class="comment"># Hardcode the library path.</span>
<span class="normal">	    </span><span class="comment"># Skip directories that are in the system default run-time</span>
<span class="normal">	    </span><span class="comment"># search path.</span>
<span class="normal">	    </span><span class="keyword">case</span><span class="normal"> </span><span class="string">" $sys_lib_dlsearch_path "</span><span class="normal"> </span><span class="keyword">in</span>
<span class="normal">	    </span><span class="symbol">*</span><span class="string">" $absdir "</span><span class="symbol">*)</span><span class="normal"> </span><span class="symbol">;;</span>
<span class="normal">	    </span><span class="symbol">*)</span>
<span class="normal">	      </span><span class="keyword">case</span><span class="normal"> </span><span class="string">"$compile_rpath "</span><span class="normal"> </span><span class="keyword">in</span>
<span class="normal">	      </span><span class="symbol">*</span><span class="string">" $absdir "</span><span class="symbol">*)</span><span class="normal"> </span><span class="symbol">;;</span>
<span class="normal">	      </span><span class="symbol">*)</span><span class="normal"> </span><span class="variable">compile_rpath</span><span class="symbol">=</span><span class="string">"$compile_rpath $absdir"</span>
<span class="normal">	      </span><span class="keyword">esac</span>
<span class="normal">	      </span><span class="symbol">;;</span>
<span class="normal">	    </span><span class="keyword">esac</span>
<span class="normal">	    </span><span class="keyword">case</span><span class="normal"> </span><span class="string">" $sys_lib_dlsearch_path "</span><span class="normal"> </span><span class="keyword">in</span>
<span class="normal">	    </span><span class="symbol">*</span><span class="string">" $libdir "</span><span class="symbol">*)</span><span class="normal"> </span><span class="symbol">;;</span>
<span class="normal">	    </span><span class="symbol">*)</span>
<span class="normal">	      </span><span class="keyword">case</span><span class="normal"> </span><span class="string">"$finalize_rpath "</span><span class="normal"> </span><span class="keyword">in</span>
<span class="normal">	      </span><span class="symbol">*</span><span class="string">" $libdir "</span><span class="symbol">*)</span><span class="normal"> </span><span class="symbol">;;</span>
<span class="normal">	      </span><span class="symbol">*)</span><span class="normal"> </span><span class="variable">finalize_rpath</span><span class="symbol">=</span><span class="string">"$finalize_rpath $libdir"</span>
<span class="normal">	      </span><span class="keyword">esac</span>
<span class="normal">	      </span><span class="symbol">;;</span>
<span class="normal">	    </span><span class="keyword">esac</span>
<span class="normal">	  </span><span class="keyword">fi</span><span class="normal"> </span><span class="comment"># $linkmode,$pass = prog,link...</span>

<span class="normal">	  </span><span class="keyword">if</span><span class="normal"> </span><span class="keyword">test</span><span class="normal"> </span><span class="string">"$alldeplibs"</span><span class="normal"> </span><span class="symbol">=</span><span class="normal"> yes </span><span class="symbol">&amp;&amp;</span>
<span class="normal">	     { </span><span class="keyword">test</span><span class="normal"> </span><span class="string">"$deplibs_check_method"</span><span class="normal"> </span><span class="symbol">=</span><span class="normal"> pass_all </span><span class="symbol">||</span>
<span class="normal">	       { </span><span class="keyword">test</span><span class="normal"> </span><span class="string">"$build_libtool_libs"</span><span class="normal"> </span><span class="symbol">=</span><span class="normal"> yes </span><span class="symbol">&amp;&amp;</span>
<span class="normal">		 </span><span class="keyword">test</span><span class="normal"> -n </span><span class="string">"$library_names"</span><span class="symbol">;</span><span class="normal"> }</span><span class="symbol">;</span><span class="normal"> }</span><span class="symbol">;</span><span class="normal"> </span><span class="keyword">then</span>
<span class="normal">	    </span><span class="comment"># We only need to search for static libraries</span>
<span class="normal">	    </span><span class="keyword">continue</span>
<span class="normal">	  </span><span class="keyword">fi</span>
<span class="normal">	</span><span class="keyword">fi</span>

<span class="normal">	</span><span class="variable">link_static</span><span class="symbol">=</span><span class="normal">no </span><span class="comment"># Whether the deplib will be linked statically</span>
<span class="normal">	</span><span class="variable">use_static_libs</span><span class="symbol">=</span><span class="variable">$prefer_static_libs</span>
<span class="normal">	</span><span class="keyword">if</span><span class="normal"> </span><span class="keyword">test</span><span class="normal"> </span><span class="string">"$use_static_libs"</span><span class="normal"> </span><span class="symbol">=</span><span class="normal"> built </span><span class="symbol">&amp;&amp;</span><span class="normal"> </span><span class="keyword">test</span><span class="normal"> </span><span class="string">"$installed"</span><span class="normal"> </span><span class="symbol">=</span><span class="normal"> yes </span><span class="symbol">;</span><span class="normal"> </span><span class="keyword">then</span>
<span class="normal">	  </span><span class="variable">use_static_libs</span><span class="symbol">=</span><span class="normal">no</span>
<span class="normal">	</span><span class="keyword">fi</span>
<span class="normal">	</span><span class="keyword">if</span><span class="normal"> </span><span class="keyword">test</span><span class="normal"> -n </span><span class="string">"$library_names"</span><span class="normal"> </span><span class="symbol">&amp;&amp;</span>
<span class="normal">	   { </span><span class="keyword">test</span><span class="normal"> </span><span class="string">"$use_static_libs"</span><span class="normal"> </span><span class="symbol">=</span><span class="normal"> no </span><span class="symbol">||</span><span class="normal"> </span><span class="keyword">test</span><span class="normal"> -z </span><span class="string">"$old_library"</span><span class="symbol">;</span><span class="normal"> }</span><span class="symbol">;</span><span class="normal"> </span><span class="keyword">then</span>
<span class="normal">	  </span><span class="keyword">if</span><span class="normal"> </span><span class="keyword">test</span><span class="normal"> </span><span class="string">"$installed"</span><span class="normal"> </span><span class="symbol">=</span><span class="normal"> no</span><span class="symbol">;</span><span class="normal"> </span><span class="keyword">then</span>
<span class="normal">	    </span><span class="variable">notinst_deplibs</span><span class="symbol">=</span><span class="string">"$notinst_deplibs $lib"</span>
<span class="normal">	    </span><span class="variable">need_relink</span><span class="symbol">=</span><span class="normal">yes</span>
<span class="normal">	  </span><span class="keyword">fi</span>
<span class="normal">	  </span><span class="comment"># This is a shared library</span>

<span class="normal">	  </span><span class="comment"># Warn about portability, can't link against -module's on</span>
<span class="normal">	  </span><span class="comment"># some systems (darwin)</span>
<span class="normal">	  </span><span class="keyword">if</span><span class="normal"> </span><span class="keyword">test</span><span class="normal"> </span><span class="string">"$shouldnotlink"</span><span class="normal"> </span><span class="symbol">=</span><span class="normal"> yes </span><span class="symbol">&amp;&amp;</span><span class="normal"> </span><span class="keyword">test</span><span class="normal"> </span><span class="string">"$pass"</span><span class="normal"> </span><span class="symbol">=</span><span class="normal"> link </span><span class="symbol">;</span><span class="normal"> </span><span class="keyword">then</span>
<span class="normal">	    </span><span class="variable">$echo</span>
<span class="normal">	    </span><span class="keyword">if</span><span class="normal"> </span><span class="keyword">test</span><span class="normal"> </span><span class="string">"$linkmode"</span><span class="normal"> </span><span class="symbol">=</span><span class="normal"> prog</span><span class="symbol">;</span><span class="normal"> </span><span class="keyword">then</span>
<span class="normal">	      </span><span class="variable">$echo</span><span class="normal"> </span><span class="string">"*** Warning: Linking the executable $output against the loadable module"</span>
<span class="normal">	    </span><span class="keyword">else</span>
<span class="normal">	      </span><span class="variable">$echo</span><span class="normal"> </span><span class="string">"*** Warning: Linking the shared library $output against the loadable module"</span>
<span class="normal">	    </span><span class="keyword">fi</span>
<span class="normal">	    </span><span class="variable">$echo</span><span class="normal"> </span><span class="string">"*** $linklib is not portable!"</span>
<span class="normal">	  </span><span class="keyword">fi</span>
<span class="normal">	  </span><span class="keyword">if</span><span class="normal"> </span><span class="keyword">test</span><span class="normal"> </span><span class="string">"$linkmode"</span><span class="normal"> </span><span class="symbol">=</span><span class="normal"> lib </span><span class="symbol">&amp;&amp;</span>
<span class="normal">	     </span><span class="keyword">test</span><span class="normal"> </span><span class="string">"$hardcode_into_libs"</span><span class="normal"> </span><span class="symbol">=</span><span class="normal"> yes</span><span class="symbol">;</span><span class="normal"> </span><span class="keyword">then</span>
<span class="normal">	    </span><span class="comment"># Hardcode the library path.</span>
<span class="normal">	    </span><span class="comment"># Skip directories that are in the system default run-time</span>
<span class="normal">	    </span><span class="comment"># search path.</span>
<span class="normal">	    </span><span class="keyword">case</span><span class="normal"> </span><span class="string">" $sys_lib_dlsearch_path "</span><span class="normal"> </span><span class="keyword">in</span>
<span class="normal">	    </span><span class="symbol">*</span><span class="string">" $absdir "</span><span class="symbol">*)</span><span class="normal"> </span><span class="symbol">;;</span>
<span class="normal">	    </span><span class="symbol">*)</span>
<span class="normal">	      </span><span class="keyword">case</span><span class="normal"> </span><span class="string">"$compile_rpath "</span><span class="normal"> </span><span class="keyword">in</span>
<span class="normal">	      </span><span class="symbol">*</span><span class="string">" $absdir "</span><span class="symbol">*)</span><span class="normal"> </span><span class="symbol">;;</span>
<span class="normal">	      </span><span class="symbol">*)</span><span class="normal"> </span><span class="variable">compile_rpath</span><span class="symbol">=</span><span class="string">"$compile_rpath $absdir"</span>
<span class="normal">	      </span><span class="keyword">esac</span>
<span class="normal">	      </span><span class="symbol">;;</span>
<span class="normal">	    </span><span class="keyword">esac</span>
<span class="normal">	    </span><span class="keyword">case</span><span class="normal"> </span><span class="string">" $sys_lib_dlsearch_path "</span><span class="normal"> </span><span class="keyword">in</span>
<span class="normal">	    </span><span class="symbol">*</span><span class="string">" $libdir "</span><span class="symbol">*)</span><span class="normal"> </span><span class="symbol">;;</span>
<span class="normal">	    </span><span class="symbol">*)</span>
<span class="normal">	      </span><span class="keyword">case</span><span class="normal"> </span><span class="string">"$finalize_rpath "</span><span class="normal"> </span><span class="keyword">in</span>
<span class="normal">	      </span><span class="symbol">*</span><span class="string">" $libdir "</span><span class="symbol">*)</span><span class="normal"> </span><span class="symbol">;;</span>
<span class="normal">	      </span><span class="symbol">*)</span><span class="normal"> </span><span class="variable">finalize_rpath</span><span class="symbol">=</span><span class="string">"$finalize_rpath $libdir"</span>
<span class="normal">	      </span><span class="keyword">esac</span>
<span class="normal">	      </span><span class="symbol">;;</span>
<span class="normal">	    </span><span class="keyword">esac</span>
<span class="normal">	  </span><span class="keyword">fi</span>

<span class="normal">	  </span><span class="keyword">if</span><span class="normal"> </span><span class="keyword">test</span><span class="normal"> -n </span><span class="string">"$old_archive_from_expsyms_cmds"</span><span class="symbol">;</span><span class="normal"> </span><span class="keyword">then</span>
<span class="normal">	    </span><span class="comment"># figure out the soname</span>
<span class="normal">	    </span><span class="keyword">set</span><span class="normal"> dummy </span><span class="variable">$library_names</span>
<span class="normal">	    </span><span class="variable">realname</span><span class="symbol">=</span><span class="string">"$2"</span>
<span class="normal">	    </span><span class="keyword">shift</span><span class="symbol">;</span><span class="normal"> </span><span class="keyword">shift</span>
<span class="normal">	    </span><span class="variable">libname</span><span class="symbol">=</span><span class="normal">`</span><span class="keyword">eval</span><span class="normal"> </span><span class="symbol">\\</span><span class="variable">$echo</span><span class="normal"> \"</span><span class="variable">$libname_spec</span><span class="normal">\"`</span>
<span class="normal">	    </span><span class="comment"># use dlname if we got it. it's perfectly good, no?</span>
<span class="normal">	    </span><span class="keyword">if</span><span class="normal"> </span><span class="keyword">test</span><span class="normal"> -n </span><span class="string">"$dlname"</span><span class="symbol">;</span><span class="normal"> </span><span class="keyword">then</span>
<span class="normal">	      </span><span class="variable">soname</span><span class="symbol">=</span><span class="string">"$dlname"</span>
<span class="normal">	    </span><span class="keyword">elif</span><span class="normal"> </span><span class="keyword">test</span><span class="normal"> -n </span><span class="string">"$soname_spec"</span><span class="symbol">;</span><span class="normal"> </span><span class="keyword">then</span>
<span class="normal">	      </span><span class="comment"># bleh windows</span>
<span class="normal">	      </span><span class="keyword">case</span><span class="normal"> </span><span class="variable">$host</span><span class="normal"> </span><span class="keyword">in</span>
<span class="normal">	      </span><span class="symbol">*</span><span class="normal">cygwin</span><span class="symbol">*</span><span class="normal"> </span><span class="symbol">|</span><span class="normal"> mingw</span><span class="symbol">*)</span>
<span class="normal">		</span><span class="variable">major</span><span class="symbol">=</span><span class="normal">`expr </span><span class="variable">$current</span><span class="normal"> - </span><span class="variable">$age</span><span class="normal">`</span>
<span class="normal">		</span><span class="variable">versuffix</span><span class="symbol">=</span><span class="string">"-$major"</span>
<span class="normal">		</span><span class="symbol">;;</span>
<span class="normal">	      </span><span class="keyword">esac</span>
<span class="normal">	      </span><span class="keyword">eval</span><span class="normal"> </span><span class="variable">soname</span><span class="symbol">=</span><span class="normal">\"</span><span class="variable">$soname_spec</span><span class="normal">\"</span>
<span class="normal">	    </span><span class="keyword">else</span>
<span class="normal">	      </span><span class="variable">soname</span><span class="symbol">=</span><span class="string">"$realname"</span>
<span class="normal">	    </span><span class="keyword">fi</span>

<span class="normal">	    </span><span class="comment"># Make a new name for the extract_expsyms_cmds to use</span>
<span class="normal">	    </span><span class="variable">soroot</span><span class="symbol">=</span><span class="string">"$soname"</span>
<span class="normal">	    </span><span class="variable">soname</span><span class="symbol">=</span><span class="normal">`</span><span class="variable">$echo</span><span class="normal"> </span><span class="variable">$soroot</span><span class="normal"> </span><span class="symbol">|</span><span class="normal"> </span><span class="variable">${SED}</span><span class="normal"> -e </span><span class="string">'s/^.*</span><span class="specialchar">\/</span><span class="string">//'</span><span class="normal">`</span>
<span class="normal">	    </span><span class="variable">newlib</span><span class="symbol">=</span><span class="string">"libimp-`$echo $soname | ${SED} 's/^lib//;s/</span><span class="specialchar">\.</span><span class="string">dll$//'`.a"</span>

<span class="normal">	    </span><span class="comment"># If the library has no export list, then create one now</span>
<span class="normal">	    </span><span class="keyword">if</span><span class="normal"> </span><span class="keyword">test</span><span class="normal"> -f </span><span class="string">"$output_objdir/$soname-def"</span><span class="symbol">;</span><span class="normal"> </span><span class="keyword">then</span><span class="normal"> </span><span class="symbol">:</span>
<span class="normal">	    </span><span class="keyword">else</span>
<span class="normal">	      </span><span class="variable">$show</span><span class="normal"> </span><span class="string">"extracting exported symbol list from </span><span class="specialchar">\`</span><span class="string">$soname'"</span>
<span class="normal">	      </span><span class="variable">save_ifs</span><span class="symbol">=</span><span class="string">"$IFS"</span><span class="symbol">;</span><span class="normal"> </span><span class="variable">IFS</span><span class="symbol">=</span><span class="string">'~'</span>
<span class="normal">	      </span><span class="variable">cmds</span><span class="symbol">=</span><span class="variable">$extract_expsyms_cmds</span>
<span class="normal">	      </span><span class="keyword">for</span><span class="normal"> cmd </span><span class="keyword">in</span><span class="normal"> </span><span class="variable">$cmds</span><span class="symbol">;</span><span class="normal"> </span><span class="keyword">do</span>
<span class="normal">		</span><span class="variable">IFS</span><span class="symbol">=</span><span class="string">"$save_ifs"</span>
<span class="normal">		</span><span class="keyword">eval</span><span class="normal"> </span><span class="variable">cmd</span><span class="symbol">=</span><span class="normal">\"</span><span class="variable">$cmd</span><span class="normal">\"</span>
<span class="normal">		</span><span class="variable">$show</span><span class="normal"> </span><span class="string">"$cmd"</span>
<span class="normal">		</span><span class="variable">$run</span><span class="normal"> </span><span class="keyword">eval</span><span class="normal"> </span><span class="string">"$cmd"</span><span class="normal"> </span><span class="symbol">||</span><span class="normal"> </span><span class="keyword">exit</span><span class="normal"> </span><span class="variable">$?</span>
<span class="normal">	      </span><span class="keyword">done</span>
<span class="normal">	      </span><span class="variable">IFS</span><span class="symbol">=</span><span class="string">"$save_ifs"</span>
<span class="normal">	    </span><span class="keyword">fi</span>

<span class="normal">	    </span><span class="comment"># Create $newlib</span>
<span class="normal">	    </span><span class="keyword">if</span><span class="normal"> </span><span class="keyword">test</span><span class="normal"> -f </span><span class="string">"$output_objdir/$newlib"</span><span class="symbol">;</span><span class="normal"> </span><span class="keyword">then</span><span class="normal"> </span><span class="symbol">:;</span><span class="normal"> </span><span class="keyword">else</span>
<span class="normal">	      </span><span class="variable">$show</span><span class="normal"> </span><span class="string">"generating import library for </span><span class="specialchar">\`</span><span class="string">$soname'"</span>
<span class="normal">	      </span><span class="variable">save_ifs</span><span class="symbol">=</span><span class="string">"$IFS"</span><span class="symbol">;</span><span class="normal"> </span><span class="variable">IFS</span><span class="symbol">=</span><span class="string">'~'</span>
<span class="normal">	      </span><span class="variable">cmds</span><span class="symbol">=</span><span class="variable">$old_archive_from_expsyms_cmds</span>
<span class="normal">	      </span><span class="keyword">for</span><span class="normal"> cmd </span><span class="keyword">in</span><span class="normal"> </span><span class="variable">$cmds</span><span class="symbol">;</span><span class="normal"> </span><span class="keyword">do</span>
<span class="normal">		</span><span class="variable">IFS</span><span class="symbol">=</span><span class="string">"$save_ifs"</span>
<span class="normal">		</span><span class="keyword">eval</span><span class="normal"> </span><span class="variable">cmd</span><span class="symbol">=</span><span class="normal">\"</span><span class="variable">$cmd</span><span class="normal">\"</span>
<span class="normal">		</span><span class="variable">$show</span><span class="normal"> </span><span class="string">"$cmd"</span>
<span class="normal">		</span><span class="variable">$run</span><span class="normal"> </span><span class="keyword">eval</span><span class="normal"> </span><span class="string">"$cmd"</span><span class="normal"> </span><span class="symbol">||</span><span class="normal"> </span><span class="keyword">exit</span><span class="normal"> </span><span class="variable">$?</span>
<span class="normal">	      </span><span class="keyword">done</span>
<span class="normal">	      </span><span class="variable">IFS</span><span class="symbol">=</span><span class="string">"$save_ifs"</span>
<span class="normal">	    </span><span class="keyword">fi</span>
<span class="normal">	    </span><span class="comment"># make sure the library variables are pointing to the new library</span>
<span class="normal">	    </span><span class="variable">dir</span><span class="symbol">=</span><span class="variable">$output_objdir</span>
<span class="normal">	    </span><span class="variable">linklib</span><span class="symbol">=</span><span class="variable">$newlib</span>
<span class="normal">	  </span><span class="keyword">fi</span><span class="normal"> </span><span class="comment"># test -n "$old_archive_from_expsyms_cmds"</span>

<span class="normal">	  </span><span class="keyword">if</span><span class="normal"> </span><span class="keyword">test</span><span class="normal"> </span><span class="string">"$linkmode"</span><span class="normal"> </span><span class="symbol">=</span><span class="normal"> prog </span><span class="symbol">||</span><span class="normal"> </span><span class="keyword">test</span><span class="normal"> </span><span class="string">"$mode"</span><span class="normal"> </span><span class="symbol">!=</span><span class="normal"> relink</span><span class="symbol">;</span><span class="normal"> </span><span class="keyword">then</span>
<span class="normal">	    </span><span class="variable">add_shlibpath</span><span class="symbol">=</span>
<span class="normal">	    </span><span class="variable">add_dir</span><span class="symbol">=</span>
<span class="normal">	    </span><span class="variable">add</span><span class="symbol">=</span>
<span class="normal">	    </span><span class="variable">lib_linked</span><span class="symbol">=</span><span class="normal">yes</span>
<span class="normal">	    </span><span class="keyword">case</span><span class="normal"> </span><span class="variable">$hardcode_action</span><span class="normal"> </span><span class="keyword">in</span>
<span class="normal">	    immediate </span><span class="symbol">|</span><span class="normal"> unsupported</span><span class="symbol">)</span>
<span class="normal">	      </span><span class="keyword">if</span><span class="normal"> </span><span class="keyword">test</span><span class="normal"> </span><span class="string">"$hardcode_direct"</span><span class="normal"> </span><span class="symbol">=</span><span class="normal"> no</span><span class="symbol">;</span><span class="normal"> </span><span class="keyword">then</span>
<span class="normal">		</span><span class="variable">add</span><span class="symbol">=</span><span class="string">"$dir/$linklib"</span>
<span class="normal">		</span><span class="keyword">case</span><span class="normal"> </span><span class="variable">$host</span><span class="normal"> </span><span class="keyword">in</span>
<span class="normal">		  </span><span class="symbol">*</span><span class="normal">-</span><span class="symbol">*</span><span class="normal">-sco</span><span class="number">3</span><span class="symbol">.</span><span class="normal">2v5</span><span class="symbol">.</span><span class="number">0</span><span class="symbol">.[</span><span class="number">024</span><span class="symbol">]*)</span><span class="normal"> </span><span class="variable">add_dir</span><span class="symbol">=</span><span class="string">"-L$dir"</span><span class="normal"> </span><span class="symbol">;;</span>
<span class="normal">		  </span><span class="symbol">*</span><span class="normal">-</span><span class="symbol">*</span><span class="normal">-sysv</span><span class="number">4</span><span class="symbol">*</span><span class="normal">uw2</span><span class="symbol">*)</span><span class="normal"> </span><span class="variable">add_dir</span><span class="symbol">=</span><span class="string">"-L$dir"</span><span class="normal"> </span><span class="symbol">;;</span>
<span class="normal">		  </span><span class="symbol">*</span><span class="normal">-</span><span class="symbol">*</span><span class="normal">-sysv5OpenUNIX</span><span class="symbol">*</span><span class="normal"> </span><span class="symbol">|</span><span class="normal"> </span><span class="symbol">*</span><span class="normal">-</span><span class="symbol">*</span><span class="normal">-sysv5UnixWare7</span><span class="symbol">.[</span><span class="number">01</span><span class="symbol">].[</span><span class="number">10</span><span class="symbol">]*</span><span class="normal"> </span><span class="symbol">|</span><span class="normal"> </span><span class="symbol">\</span>
<span class="normal">		    </span><span class="symbol">*</span><span class="normal">-</span><span class="symbol">*</span><span class="normal">-unixware</span><span class="number">7</span><span class="symbol">*)</span><span class="normal"> </span><span class="variable">add_dir</span><span class="symbol">=</span><span class="string">"-L$dir"</span><span class="normal"> </span><span class="symbol">;;</span>
<span class="normal">		  </span><span class="symbol">*</span><span class="normal">-</span><span class="symbol">*</span><span class="normal">-darwin</span><span class="symbol">*</span><span class="normal"> </span><span class="symbol">)</span>
<span class="normal">		    </span><span class="comment"># if the lib is a module then we can not link against</span>
<span class="normal">		    </span><span class="comment"># it, someone is ignoring the new warnings I added</span>
<span class="normal">		    </span><span class="keyword">if</span><span class="normal"> /usr/bin/file -L </span><span class="variable">$add</span><span class="normal"> </span><span class="number">2</span><span class="symbol">&gt;</span><span class="normal"> /dev/null </span><span class="symbol">|</span>
<span class="normal">                      </span><span class="variable">$EGREP</span><span class="normal"> </span><span class="string">": [^:]* bundle"</span><span class="normal"> </span><span class="symbol">&gt;</span><span class="normal">/dev/null </span><span class="symbol">;</span><span class="normal"> </span><span class="keyword">then</span>
<span class="normal">		      </span><span class="variable">$echo</span><span class="normal"> </span><span class="string">"** Warning, lib $linklib is a module, not a shared library"</span>
<span class="normal">		      </span><span class="keyword">if</span><span class="normal"> </span><span class="keyword">test</span><span class="normal"> -z </span><span class="string">"$old_library"</span><span class="normal"> </span><span class="symbol">;</span><span class="normal"> </span><span class="keyword">then</span>
<span class="normal">		        </span><span class="variable">$echo</span>
<span class="normal">		        </span><span class="variable">$echo</span><span class="normal"> </span><span class="string">"** And there doesn't seem to be a static archive available"</span>
<span class="normal">		        </span><span class="variable">$echo</span><span class="normal"> </span><span class="string">"** The link will probably fail, sorry"</span>
<span class="normal">		      </span><span class="keyword">else</span>
<span class="normal">		        </span><span class="variable">add</span><span class="symbol">=</span><span class="string">"$dir/$old_library"</span>
<span class="normal">		      </span><span class="keyword">fi</span>
<span class="normal">		    </span><span class="keyword">fi</span>
<span class="normal">		</span><span class="keyword">esac</span>
<span class="normal">	      </span><span class="keyword">elif</span><span class="normal"> </span><span class="keyword">test</span><span class="normal"> </span><span class="string">"$hardcode_minus_L"</span><span class="normal"> </span><span class="symbol">=</span><span class="normal"> no</span><span class="symbol">;</span><span class="normal"> </span><span class="keyword">then</span>
<span class="normal">		</span><span class="keyword">case</span><span class="normal"> </span><span class="variable">$host</span><span class="normal"> </span><span class="keyword">in</span>
<span class="normal">		</span><span class="symbol">*</span><span class="normal">-</span><span class="symbol">*</span><span class="normal">-sunos</span><span class="symbol">*)</span><span class="normal"> </span><span class="variable">add_shlibpath</span><span class="symbol">=</span><span class="string">"$dir"</span><span class="normal"> </span><span class="symbol">;;</span>
<span class="normal">		</span><span class="keyword">esac</span>
<span class="normal">		</span><span class="variable">add_dir</span><span class="symbol">=</span><span class="string">"-L$dir"</span>
<span class="normal">		</span><span class="variable">add</span><span class="symbol">=</span><span class="string">"-l$name"</span>
<span class="normal">	      </span><span class="keyword">elif</span><span class="normal"> </span><span class="keyword">test</span><span class="normal"> </span><span class="string">"$hardcode_shlibpath_var"</span><span class="normal"> </span><span class="symbol">=</span><span class="normal"> no</span><span class="symbol">;</span><span class="normal"> </span><span class="keyword">then</span>
<span class="normal">		</span><span class="variable">add_shlibpath</span><span class="symbol">=</span><span class="string">"$dir"</span>
<span class="normal">		</span><span class="variable">add</span><span class="symbol">=</span><span class="string">"-l$name"</span>
<span class="normal">	      </span><span class="keyword">else</span>
<span class="normal">		</span><span class="variable">lib_linked</span><span class="symbol">=</span><span class="normal">no</span>
<span class="normal">	      </span><span class="keyword">fi</span>
<span class="normal">	      </span><span class="symbol">;;</span>
<span class="normal">	    relink</span><span class="symbol">)</span>
<span class="normal">	      </span><span class="keyword">if</span><span class="normal"> </span><span class="keyword">test</span><span class="normal"> </span><span class="string">"$hardcode_direct"</span><span class="normal"> </span><span class="symbol">=</span><span class="normal"> yes</span><span class="symbol">;</span><span class="normal"> </span><span class="keyword">then</span>
<span class="normal">		</span><span class="variable">add</span><span class="symbol">=</span><span class="string">"$dir/$linklib"</span>
<span class="normal">	      </span><span class="keyword">elif</span><span class="normal"> </span><span class="keyword">test</span><span class="normal"> </span><span class="string">"$hardcode_minus_L"</span><span class="normal"> </span><span class="symbol">=</span><span class="normal"> yes</span><span class="symbol">;</span><span class="normal"> </span><span class="keyword">then</span>
<span class="normal">		</span><span class="variable">add_dir</span><span class="symbol">=</span><span class="string">"-L$dir"</span>
<span class="normal">		</span><span class="comment"># Try looking first in the location we're being installed to.</span>
<span class="normal">		</span><span class="keyword">if</span><span class="normal"> </span><span class="keyword">test</span><span class="normal"> -n </span><span class="string">"$inst_prefix_dir"</span><span class="symbol">;</span><span class="normal"> </span><span class="keyword">then</span>
<span class="normal">		  </span><span class="keyword">case</span><span class="normal"> </span><span class="variable">$libdir</span><span class="normal"> </span><span class="keyword">in</span>
<span class="normal">		    </span><span class="symbol">[\\/]*)</span>
<span class="normal">		      </span><span class="variable">add_dir</span><span class="symbol">=</span><span class="string">"$add_dir -L$inst_prefix_dir$libdir"</span>
<span class="normal">		      </span><span class="symbol">;;</span>
<span class="normal">		  </span><span class="keyword">esac</span>
<span class="normal">		</span><span class="keyword">fi</span>
<span class="normal">		</span><span class="variable">add</span><span class="symbol">=</span><span class="string">"-l$name"</span>
<span class="normal">	      </span><span class="keyword">elif</span><span class="normal"> </span><span class="keyword">test</span><span class="normal"> </span><span class="string">"$hardcode_shlibpath_var"</span><span class="normal"> </span><span class="symbol">=</span><span class="normal"> yes</span><span class="symbol">;</span><span class="normal"> </span><span class="keyword">then</span>
<span class="normal">		</span><span class="variable">add_shlibpath</span><span class="symbol">=</span><span class="string">"$dir"</span>
<span class="normal">		</span><span class="variable">add</span><span class="symbol">=</span><span class="string">"-l$name"</span>
<span class="normal">	      </span><span class="keyword">else</span>
<span class="normal">		</span><span class="variable">lib_linked</span><span class="symbol">=</span><span class="normal">no</span>
<span class="normal">	      </span><span class="keyword">fi</span>
<span class="normal">	      </span><span class="symbol">;;</span>
<span class="normal">	    </span><span class="symbol">*)</span><span class="normal"> </span><span class="variable">lib_linked</span><span class="symbol">=</span><span class="normal">no </span><span class="symbol">;;</span>
<span class="normal">	    </span><span class="keyword">esac</span>

<span class="normal">	    </span><span class="keyword">if</span><span class="normal"> </span><span class="keyword">test</span><span class="normal"> </span><span class="string">"$lib_linked"</span><span class="normal"> </span><span class="symbol">!=</span><span class="normal"> yes</span><span class="symbol">;</span><span class="normal"> </span><span class="keyword">then</span>
<span class="normal">	      </span><span class="variable">$echo</span><span class="normal"> </span><span class="string">"$modename: configuration error: unsupported hardcode properties"</span>
<span class="normal">	      </span><span class="keyword">exit</span><span class="normal"> </span><span class="variable">$EXIT_FAILURE</span>
<span class="normal">	    </span><span class="keyword">fi</span>

<span class="normal">	    </span><span class="keyword">if</span><span class="normal"> </span><span class="keyword">test</span><span class="normal"> -n </span><span class="string">"$add_shlibpath"</span><span class="symbol">;</span><span class="normal"> </span><span class="keyword">then</span>
<span class="normal">	      </span><span class="keyword">case</span><span class="normal"> </span><span class="symbol">:</span><span class="variable">$compile_shlibpath</span><span class="symbol">:</span><span class="normal"> </span><span class="keyword">in</span>
<span class="normal">	      </span><span class="symbol">*</span><span class="string">":$add_shlibpath:"</span><span class="symbol">*)</span><span class="normal"> </span><span class="symbol">;;</span>
<span class="normal">	      </span><span class="symbol">*)</span><span class="normal"> </span><span class="variable">compile_shlibpath</span><span class="symbol">=</span><span class="string">"$compile_shlibpath$add_shlibpath:"</span><span class="normal"> </span><span class="symbol">;;</span>
<span class="normal">	      </span><span class="keyword">esac</span>
<span class="normal">	    </span><span class="keyword">fi</span>
<span class="normal">	    </span><span class="keyword">if</span><span class="normal"> </span><span class="keyword">test</span><span class="normal"> </span><span class="string">"$linkmode"</span><span class="normal"> </span><span class="symbol">=</span><span class="normal"> prog</span><span class="symbol">;</span><span class="normal"> </span><span class="keyword">then</span>
<span class="normal">	      </span><span class="keyword">test</span><span class="normal"> -n </span><span class="string">"$add_dir"</span><span class="normal"> </span><span class="symbol">&amp;&amp;</span><span class="normal"> </span><span class="variable">compile_deplibs</span><span class="symbol">=</span><span class="string">"$add_dir $compile_deplibs"</span>
<span class="normal">	      </span><span class="keyword">test</span><span class="normal"> -n </span><span class="string">"$add"</span><span class="normal"> </span><span class="symbol">&amp;&amp;</span><span class="normal"> </span><span class="variable">compile_deplibs</span><span class="symbol">=</span><span class="string">"$add $compile_deplibs"</span>
<span class="normal">	    </span><span class="keyword">else</span>
<span class="normal">	      </span><span class="keyword">test</span><span class="normal"> -n </span><span class="string">"$add_dir"</span><span class="normal"> </span><span class="symbol">&amp;&amp;</span><span class="normal"> </span><span class="variable">deplibs</span><span class="symbol">=</span><span class="string">"$add_dir $deplibs"</span>
<span class="normal">	      </span><span class="keyword">test</span><span class="normal"> -n </span><span class="string">"$add"</span><span class="normal"> </span><span class="symbol">&amp;&amp;</span><span class="normal"> </span><span class="variable">deplibs</span><span class="symbol">=</span><span class="string">"$add $deplibs"</span>
<span class="normal">	      </span><span class="keyword">if</span><span class="normal"> </span><span class="keyword">test</span><span class="normal"> </span><span class="string">"$hardcode_direct"</span><span class="normal"> </span><span class="symbol">!=</span><span class="normal"> yes </span><span class="symbol">&amp;&amp;</span><span class="normal"> </span><span class="symbol">\</span>
<span class="normal">		 </span><span class="keyword">test</span><span class="normal"> </span><span class="string">"$hardcode_minus_L"</span><span class="normal"> </span><span class="symbol">!=</span><span class="normal"> yes </span><span class="symbol">&amp;&amp;</span><span class="normal"> </span><span class="symbol">\</span>
<span class="normal">		 </span><span class="keyword">test</span><span class="normal"> </span><span class="string">"$hardcode_shlibpath_var"</span><span class="normal"> </span><span class="symbol">=</span><span class="normal"> yes</span><span class="symbol">;</span><span class="normal"> </span><span class="keyword">then</span>
<span class="normal">		</span><span class="keyword">case</span><span class="normal"> </span><span class="symbol">:</span><span class="variable">$finalize_shlibpath</span><span class="symbol">:</span><span class="normal"> </span><span class="keyword">in</span>
<span class="normal">		</span><span class="symbol">*</span><span class="string">":$libdir:"</span><span class="symbol">*)</span><span class="normal"> </span><span class="symbol">;;</span>
<span class="normal">		</span><span class="symbol">*)</span><span class="normal"> </span><span class="variable">finalize_shlibpath</span><span class="symbol">=</span><span class="string">"$finalize_shlibpath$libdir:"</span><span class="normal"> </span><span class="symbol">;;</span>
<span class="normal">		</span><span class="keyword">esac</span>
<span class="normal">	      </span><span class="keyword">fi</span>
<span class="normal">	    </span><span class="keyword">fi</span>
<span class="normal">	  </span><span class="keyword">fi</span>

<span class="normal">	  </span><span class="keyword">if</span><span class="normal"> </span><span class="keyword">test</span><span class="normal"> </span><span class="string">"$linkmode"</span><span class="normal"> </span><span class="symbol">=</span><span class="normal"> prog </span><span class="symbol">||</span><span class="normal"> </span><span class="keyword">test</span><span class="normal"> </span><span class="string">"$mode"</span><span class="normal"> </span><span class="symbol">=</span><span class="normal"> relink</span><span class="symbol">;</span><span class="normal"> </span><span class="keyword">then</span>
<span class="normal">	    </span><span class="variable">add_shlibpath</span><span class="symbol">=</span>
<span class="normal">	    </span><span class="variable">add_dir</span><span class="symbol">=</span>
<span class="normal">	    </span><span class="variable">add</span><span class="symbol">=</span>
<span class="normal">	    </span><span class="comment"># Finalize command for both is simple: just hardcode it.</span>
<span class="normal">	    </span><span class="keyword">if</span><span class="normal"> </span><span class="keyword">test</span><span class="normal"> </span><span class="string">"$hardcode_direct"</span><span class="normal"> </span><span class="symbol">=</span><span class="normal"> yes</span><span class="symbol">;</span><span class="normal"> </span><span class="keyword">then</span>
<span class="normal">	      </span><span class="variable">add</span><span class="symbol">=</span><span class="string">"$libdir/$linklib"</span>
<span class="normal">	    </span><span class="keyword">elif</span><span class="normal"> </span><span class="keyword">test</span><span class="normal"> </span><span class="string">"$hardcode_minus_L"</span><span class="normal"> </span><span class="symbol">=</span><span class="normal"> yes</span><span class="symbol">;</span><span class="normal"> </span><span class="keyword">then</span>
<span class="normal">	      </span><span class="variable">add_dir</span><span class="symbol">=</span><span class="string">"-L$libdir"</span>
<span class="normal">	      </span><span class="variable">add</span><span class="symbol">=</span><span class="string">"-l$name"</span>
<span class="normal">	    </span><span class="keyword">elif</span><span class="normal"> </span><span class="keyword">test</span><span class="normal"> </span><span class="string">"$hardcode_shlibpath_var"</span><span class="normal"> </span><span class="symbol">=</span><span class="normal"> yes</span><span class="symbol">;</span><span class="normal"> </span><span class="keyword">then</span>
<span class="normal">	      </span><span class="keyword">case</span><span class="normal"> </span><span class="symbol">:</span><span class="variable">$finalize_shlibpath</span><span class="symbol">:</span><span class="normal"> </span><span class="keyword">in</span>
<span class="normal">	      </span><span class="symbol">*</span><span class="string">":$libdir:"</span><span class="symbol">*)</span><span class="normal"> </span><span class="symbol">;;</span>
<span class="normal">	      </span><span class="symbol">*)</span><span class="normal"> </span><span class="variable">finalize_shlibpath</span><span class="symbol">=</span><span class="string">"$finalize_shlibpath$libdir:"</span><span class="normal"> </span><span class="symbol">;;</span>
<span class="normal">	      </span><span class="keyword">esac</span>
<span class="normal">	      </span><span class="variable">add</span><span class="symbol">=</span><span class="string">"-l$name"</span>
<span class="normal">	    </span><span class="keyword">elif</span><span class="normal"> </span><span class="keyword">test</span><span class="normal"> </span><span class="string">"$hardcode_automatic"</span><span class="normal"> </span><span class="symbol">=</span><span class="normal"> yes</span><span class="symbol">;</span><span class="normal"> </span><span class="keyword">then</span>
<span class="normal">	      </span><span class="keyword">if</span><span class="normal"> </span><span class="keyword">test</span><span class="normal"> -n </span><span class="string">"$inst_prefix_dir"</span><span class="normal"> </span><span class="symbol">&amp;&amp;</span>
<span class="normal">		 </span><span class="keyword">test</span><span class="normal"> -f </span><span class="string">"$inst_prefix_dir$libdir/$linklib"</span><span class="normal"> </span><span class="symbol">;</span><span class="normal"> </span><span class="keyword">then</span>
<span class="normal">	        </span><span class="variable">add</span><span class="symbol">=</span><span class="string">"$inst_prefix_dir$libdir/$linklib"</span>
<span class="normal">	      </span><span class="keyword">else</span>
<span class="normal">	        </span><span class="variable">add</span><span class="symbol">=</span><span class="string">"$libdir/$linklib"</span>
<span class="normal">	      </span><span class="keyword">fi</span>
<span class="normal">	    </span><span class="keyword">else</span>
<span class="normal">	      </span><span class="comment"># We cannot seem to hardcode it, guess we'll fake it.</span>
<span class="normal">	      </span><span class="variable">add_dir</span><span class="symbol">=</span><span class="string">"-L$libdir"</span>
<span class="normal">	      </span><span class="comment"># Try looking first in the location we're being installed to.</span>
<span class="normal">	      </span><span class="keyword">if</span><span class="normal"> </span><span class="keyword">test</span><span class="normal"> -n </span><span class="string">"$inst_prefix_dir"</span><span class="symbol">;</span><span class="normal"> </span><span class="keyword">then</span>
<span class="normal">		</span><span class="keyword">case</span><span class="normal"> </span><span class="variable">$libdir</span><span class="normal"> </span><span class="keyword">in</span>
<span class="normal">		  </span><span class="symbol">[\\/]*)</span>
<span class="normal">		    </span><span class="variable">add_dir</span><span class="symbol">=</span><span class="string">"$add_dir -L$inst_prefix_dir$libdir"</span>
<span class="normal">		    </span><span class="symbol">;;</span>
<span class="normal">		</span><span class="keyword">esac</span>
<span class="normal">	      </span><span class="keyword">fi</span>
<span class="normal">	      </span><span class="variable">add</span><span class="symbol">=</span><span class="string">"-l$name"</span>
<span class="normal">	    </span><span class="keyword">fi</span>

<span class="normal">	    </span><span class="keyword">if</span><span class="normal"> </span><span class="keyword">test</span><span class="normal"> </span><span class="string">"$linkmode"</span><span class="normal"> </span><span class="symbol">=</span><span class="normal"> prog</span><span class="symbol">;</span><span class="normal"> </span><span class="keyword">then</span>
<span class="normal">	      </span><span class="keyword">test</span><span class="normal"> -n </span><span class="string">"$add_dir"</span><span class="normal"> </span><span class="symbol">&amp;&amp;</span><span class="normal"> </span><span class="variable">finalize_deplibs</span><span class="symbol">=</span><span class="string">"$add_dir $finalize_deplibs"</span>
<span class="normal">	      </span><span class="keyword">test</span><span class="normal"> -n </span><span class="string">"$add"</span><span class="normal"> </span><span class="symbol">&amp;&amp;</span><span class="normal"> </span><span class="variable">finalize_deplibs</span><span class="symbol">=</span><span class="string">"$add $finalize_deplibs"</span>
<span class="normal">	    </span><span class="keyword">else</span>
<span class="normal">	      </span><span class="keyword">test</span><span class="normal"> -n </span><span class="string">"$add_dir"</span><span class="normal"> </span><span class="symbol">&amp;&amp;</span><span class="normal"> </span><span class="variable">deplibs</span><span class="symbol">=</span><span class="string">"$add_dir $deplibs"</span>
<span class="normal">	      </span><span class="keyword">test</span><span class="normal"> -n </span><span class="string">"$add"</span><span class="normal"> </span><span class="symbol">&amp;&amp;</span><span class="normal"> </span><span class="variable">deplibs</span><span class="symbol">=</span><span class="string">"$add $deplibs"</span>
<span class="normal">	    </span><span class="keyword">fi</span>
<span class="normal">	  </span><span class="keyword">fi</span>
<span class="normal">	</span><span class="keyword">elif</span><span class="normal"> </span><span class="keyword">test</span><span class="normal"> </span><span class="string">"$linkmode"</span><span class="normal"> </span><span class="symbol">=</span><span class="normal"> prog</span><span class="symbol">;</span><span class="normal"> </span><span class="keyword">then</span>
<span class="normal">	  </span><span class="comment"># Here we assume that one of hardcode_direct or hardcode_minus_L</span>
<span class="normal">	  </span><span class="comment"># is not unsupported.  This is valid on all known static and</span>
<span class="normal">	  </span><span class="comment"># shared platforms.</span>
<span class="normal">	  </span><span class="keyword">if</span><span class="normal"> </span><span class="keyword">test</span><span class="normal"> </span><span class="string">"$hardcode_direct"</span><span class="normal"> </span><span class="symbol">!=</span><span class="normal"> unsupported</span><span class="symbol">;</span><span class="normal"> </span><span class="keyword">then</span>
<span class="normal">	    </span><span class="keyword">test</span><span class="normal"> -n </span><span class="string">"$old_library"</span><span class="normal"> </span><span class="symbol">&amp;&amp;</span><span class="normal"> </span><span class="variable">linklib</span><span class="symbol">=</span><span class="string">"$old_library"</span>
<span class="normal">	    </span><span class="variable">compile_deplibs</span><span class="symbol">=</span><span class="string">"$dir/$linklib $compile_deplibs"</span>
<span class="normal">	    </span><span class="variable">finalize_deplibs</span><span class="symbol">=</span><span class="string">"$dir/$linklib $finalize_deplibs"</span>
<span class="normal">	  </span><span class="keyword">else</span>
<span class="normal">	    </span><span class="variable">compile_deplibs</span><span class="symbol">=</span><span class="string">"-l$name -L$dir $compile_deplibs"</span>
<span class="normal">	    </span><span class="variable">finalize_deplibs</span><span class="symbol">=</span><span class="string">"-l$name -L$dir $finalize_deplibs"</span>
<span class="normal">	  </span><span class="keyword">fi</span>
<span class="normal">	</span><span class="keyword">elif</span><span class="normal"> </span><span class="keyword">test</span><span class="normal"> </span><span class="string">"$build_libtool_libs"</span><span class="normal"> </span><span class="symbol">=</span><span class="normal"> yes</span><span class="symbol">;</span><span class="normal"> </span><span class="keyword">then</span>
<span class="normal">	  </span><span class="comment"># Not a shared library</span>
<span class="normal">	  </span><span class="keyword">if</span><span class="normal"> </span><span class="keyword">test</span><span class="normal"> </span><span class="string">"$deplibs_check_method"</span><span class="normal"> </span><span class="symbol">!=</span><span class="normal"> pass_all</span><span class="symbol">;</span><span class="normal"> </span><span class="keyword">then</span>
<span class="normal">	    </span><span class="comment"># We're trying link a shared library against a static one</span>
<span class="normal">	    </span><span class="comment"># but the system doesn't support it.</span>

<span class="normal">	    </span><span class="comment"># Just print a warning and add the library to dependency_libs so</span>
<span class="normal">	    </span><span class="comment"># that the program can be linked against the static library.</span>
<span class="normal">	    </span><span class="variable">$echo</span>
<span class="normal">	    </span><span class="variable">$echo</span><span class="normal"> </span><span class="string">"*** Warning: This system can not link to static lib archive $lib."</span>
<span class="normal">	    </span><span class="variable">$echo</span><span class="normal"> </span><span class="string">"*** I have the capability to make that library automatically link in when"</span>
<span class="normal">	    </span><span class="variable">$echo</span><span class="normal"> </span><span class="string">"*** you link to this library.  But I can only do this if you have a"</span>
<span class="normal">	    </span><span class="variable">$echo</span><span class="normal"> </span><span class="string">"*** shared version of the library, which you do not appear to have."</span>
<span class="normal">	    </span><span class="keyword">if</span><span class="normal"> </span><span class="keyword">test</span><span class="normal"> </span><span class="string">"$module"</span><span class="normal"> </span><span class="symbol">=</span><span class="normal"> yes</span><span class="symbol">;</span><span class="normal"> </span><span class="keyword">then</span>
<span class="normal">	      </span><span class="variable">$echo</span><span class="normal"> </span><span class="string">"*** But as you try to build a module library, libtool will still create "</span>
<span class="normal">	      </span><span class="variable">$echo</span><span class="normal"> </span><span class="string">"*** a static module, that should work as long as the dlopening application"</span>
<span class="normal">	      </span><span class="variable">$echo</span><span class="normal"> </span><span class="string">"*** is linked with the -dlopen flag to resolve symbols at runtime."</span>
<span class="normal">	      </span><span class="keyword">if</span><span class="normal"> </span><span class="keyword">test</span><span class="normal"> -z </span><span class="string">"$global_symbol_pipe"</span><span class="symbol">;</span><span class="normal"> </span><span class="keyword">then</span>
<span class="normal">		</span><span class="variable">$echo</span>
<span class="normal">		</span><span class="variable">$echo</span><span class="normal"> </span><span class="string">"*** However, this would only work if libtool was able to extract symbol"</span>
<span class="normal">		</span><span class="variable">$echo</span><span class="normal"> </span><span class="string">"*** lists from a program, using </span><span class="specialchar">\`</span><span class="string">nm' or equivalent, but libtool could"</span>
<span class="normal">		</span><span class="variable">$echo</span><span class="normal"> </span><span class="string">"*** not find such a program.  So, this module is probably useless."</span>
<span class="normal">		</span><span class="variable">$echo</span><span class="normal"> </span><span class="string">"*** </span><span class="specialchar">\`</span><span class="string">nm' from GNU binutils and a full rebuild may help."</span>
<span class="normal">	      </span><span class="keyword">fi</span>
<span class="normal">	      </span><span class="keyword">if</span><span class="normal"> </span><span class="keyword">test</span><span class="normal"> </span><span class="string">"$build_old_libs"</span><span class="normal"> </span><span class="symbol">=</span><span class="normal"> no</span><span class="symbol">;</span><span class="normal"> </span><span class="keyword">then</span>
<span class="normal">		</span><span class="variable">build_libtool_libs</span><span class="symbol">=</span><span class="normal">module</span>
<span class="normal">		</span><span class="variable">build_old_libs</span><span class="symbol">=</span><span class="normal">yes</span>
<span class="normal">	      </span><span class="keyword">else</span>
<span class="normal">		</span><span class="variable">build_libtool_libs</span><span class="symbol">=</span><span class="normal">no</span>
<span class="normal">	      </span><span class="keyword">fi</span>
<span class="normal">	    </span><span class="keyword">fi</span>
<span class="normal">	  </span><span class="keyword">else</span>
<span class="normal">	    </span><span class="variable">deplibs</span><span class="symbol">=</span><span class="string">"$dir/$old_library $deplibs"</span>
<span class="normal">	    </span><span class="variable">link_static</span><span class="symbol">=</span><span class="normal">yes</span>
<span class="normal">	  </span><span class="keyword">fi</span>
<span class="normal">	</span><span class="keyword">fi</span><span class="normal"> </span><span class="comment"># link shared/static library?</span>

<span class="normal">	</span><span class="keyword">if</span><span class="normal"> </span><span class="keyword">test</span><span class="normal"> </span><span class="string">"$linkmode"</span><span class="normal"> </span><span class="symbol">=</span><span class="normal"> lib</span><span class="symbol">;</span><span class="normal"> </span><span class="keyword">then</span>
<span class="normal">	  </span><span class="keyword">if</span><span class="normal"> </span><span class="keyword">test</span><span class="normal"> -n </span><span class="string">"$dependency_libs"</span><span class="normal"> </span><span class="symbol">&amp;&amp;</span>
<span class="normal">	     { </span><span class="keyword">test</span><span class="normal"> </span><span class="string">"$hardcode_into_libs"</span><span class="normal"> </span><span class="symbol">!=</span><span class="normal"> yes </span><span class="symbol">||</span>
<span class="normal">	       </span><span class="keyword">test</span><span class="normal"> </span><span class="string">"$build_old_libs"</span><span class="normal"> </span><span class="symbol">=</span><span class="normal"> yes </span><span class="symbol">||</span>
<span class="normal">	       </span><span class="keyword">test</span><span class="normal"> </span><span class="string">"$link_static"</span><span class="normal"> </span><span class="symbol">=</span><span class="normal"> yes</span><span class="symbol">;</span><span class="normal"> }</span><span class="symbol">;</span><span class="normal"> </span><span class="keyword">then</span>
<span class="normal">	    </span><span class="comment"># Extract -R from dependency_libs</span>
<span class="normal">	    </span><span class="variable">temp_deplibs</span><span class="symbol">=</span>
<span class="normal">	    </span><span class="keyword">for</span><span class="normal"> libdir </span><span class="keyword">in</span><span class="normal"> </span><span class="variable">$dependency_libs</span><span class="symbol">;</span><span class="normal"> </span><span class="keyword">do</span>
<span class="normal">	      </span><span class="keyword">case</span><span class="normal"> </span><span class="variable">$libdir</span><span class="normal"> </span><span class="keyword">in</span>
<span class="normal">	      -R</span><span class="symbol">*)</span><span class="normal"> </span><span class="variable">temp_xrpath</span><span class="symbol">=</span><span class="normal">`</span><span class="variable">$echo</span><span class="normal"> </span><span class="string">"X$libdir"</span><span class="normal"> </span><span class="symbol">|</span><span class="normal"> </span><span class="variable">$Xsed</span><span class="normal"> -e </span><span class="string">'s/^-R//'</span><span class="normal">`</span>
<span class="normal">		   </span><span class="keyword">case</span><span class="normal"> </span><span class="string">" $xrpath "</span><span class="normal"> </span><span class="keyword">in</span>
<span class="normal">		   </span><span class="symbol">*</span><span class="string">" $temp_xrpath "</span><span class="symbol">*)</span><span class="normal"> </span><span class="symbol">;;</span>
<span class="normal">		   </span><span class="symbol">*)</span><span class="normal"> </span><span class="variable">xrpath</span><span class="symbol">=</span><span class="string">"$xrpath $temp_xrpath"</span><span class="symbol">;;</span>
<span class="normal">		   </span><span class="keyword">esac</span><span class="symbol">;;</span>
<span class="normal">	      </span><span class="symbol">*)</span><span class="normal"> </span><span class="variable">temp_deplibs</span><span class="symbol">=</span><span class="string">"$temp_deplibs $libdir"</span><span class="symbol">;;</span>
<span class="normal">	      </span><span class="keyword">esac</span>
<span class="normal">	    </span><span class="keyword">done</span>
<span class="normal">	    </span><span class="variable">dependency_libs</span><span class="symbol">=</span><span class="string">"$temp_deplibs"</span>
<span class="normal">	  </span><span class="keyword">fi</span>

<span class="normal">	  </span><span class="variable">newlib_search_path</span><span class="symbol">=</span><span class="string">"$newlib_search_path $absdir"</span>
<span class="normal">	  </span><span class="comment"># Link against this library</span>
<span class="normal">	  </span><span class="keyword">test</span><span class="normal"> </span><span class="string">"$link_static"</span><span class="normal"> </span><span class="symbol">=</span><span class="normal"> no </span><span class="symbol">&amp;&amp;</span><span class="normal"> </span><span class="variable">newdependency_libs</span><span class="symbol">=</span><span class="string">"$abs_ladir/$laname $newdependency_libs"</span>
<span class="normal">	  </span><span class="comment"># ... and its dependency_libs</span>
<span class="normal">	  </span><span class="variable">tmp_libs</span><span class="symbol">=</span>
<span class="normal">	  </span><span class="keyword">for</span><span class="normal"> deplib </span><span class="keyword">in</span><span class="normal"> </span><span class="variable">$dependency_libs</span><span class="symbol">;</span><span class="normal"> </span><span class="keyword">do</span>
<span class="normal">	    </span><span class="variable">newdependency_libs</span><span class="symbol">=</span><span class="string">"$deplib $newdependency_libs"</span>
<span class="normal">	    </span><span class="keyword">if</span><span class="normal"> </span><span class="keyword">test</span><span class="normal"> </span><span class="string">"X$duplicate_deps"</span><span class="normal"> </span><span class="symbol">=</span><span class="normal"> </span><span class="string">"Xyes"</span><span class="normal"> </span><span class="symbol">;</span><span class="normal"> </span><span class="keyword">then</span>
<span class="normal">	      </span><span class="keyword">case</span><span class="normal"> </span><span class="string">"$tmp_libs "</span><span class="normal"> </span><span class="keyword">in</span>
<span class="normal">	      </span><span class="symbol">*</span><span class="string">" $deplib "</span><span class="symbol">*)</span><span class="normal"> </span><span class="variable">specialdeplibs</span><span class="symbol">=</span><span class="string">"$specialdeplibs $deplib"</span><span class="normal"> </span><span class="symbol">;;</span>
<span class="normal">	      </span><span class="keyword">esac</span>
<span class="normal">	    </span><span class="keyword">fi</span>
<span class="normal">	    </span><span class="variable">tmp_libs</span><span class="symbol">=</span><span class="string">"$tmp_libs $deplib"</span>
<span class="normal">	  </span><span class="keyword">done</span>

<span class="normal">	  </span><span class="keyword">if</span><span class="normal"> </span><span class="keyword">test</span><span class="normal"> </span><span class="string">"$link_all_deplibs"</span><span class="normal"> </span><span class="symbol">!=</span><span class="normal"> no</span><span class="symbol">;</span><span class="normal"> </span><span class="keyword">then</span>
<span class="normal">	    </span><span class="comment"># Add the search paths of all dependency libraries</span>
<span class="normal">	    </span><span class="keyword">for</span><span class="normal"> deplib </span><span class="keyword">in</span><span class="normal"> </span><span class="variable">$dependency_libs</span><span class="symbol">;</span><span class="normal"> </span><span class="keyword">do</span>
<span class="normal">	      </span><span class="keyword">case</span><span class="normal"> </span><span class="variable">$deplib</span><span class="normal"> </span><span class="keyword">in</span>
<span class="normal">	      -L</span><span class="symbol">*)</span><span class="normal"> </span><span class="variable">path</span><span class="symbol">=</span><span class="string">"$deplib"</span><span class="normal"> </span><span class="symbol">;;</span>
<span class="normal">	      </span><span class="symbol">*.</span><span class="normal">la</span><span class="symbol">)</span>
<span class="normal">		</span><span class="variable">dir</span><span class="symbol">=</span><span class="normal">`</span><span class="variable">$echo</span><span class="normal"> </span><span class="string">"X$deplib"</span><span class="normal"> </span><span class="symbol">|</span><span class="normal"> </span><span class="variable">$Xsed</span><span class="normal"> -e </span><span class="string">'s%/[^/]*$%%'</span><span class="normal">`</span>
<span class="normal">		</span><span class="keyword">test</span><span class="normal"> </span><span class="string">"X$dir"</span><span class="normal"> </span><span class="symbol">=</span><span class="normal"> </span><span class="string">"X$deplib"</span><span class="normal"> </span><span class="symbol">&amp;&amp;</span><span class="normal"> </span><span class="variable">dir</span><span class="symbol">=</span><span class="string">"."</span>
<span class="normal">		</span><span class="comment"># We need an absolute path.</span>
<span class="normal">		</span><span class="keyword">case</span><span class="normal"> </span><span class="variable">$dir</span><span class="normal"> </span><span class="keyword">in</span>
<span class="normal">		</span><span class="symbol">[\\/]*</span><span class="normal"> </span><span class="symbol">|</span><span class="normal"> </span><span class="symbol">[</span><span class="normal">A-Za-z</span><span class="symbol">]:[\\/]*)</span><span class="normal"> </span><span class="variable">absdir</span><span class="symbol">=</span><span class="string">"$dir"</span><span class="normal"> </span><span class="symbol">;;</span>
<span class="normal">		</span><span class="symbol">*)</span>
<span class="normal">		  </span><span class="variable">absdir</span><span class="symbol">=</span><span class="normal">`cd </span><span class="string">"$dir"</span><span class="normal"> </span><span class="symbol">&amp;&amp;</span><span class="normal"> pwd`</span>
<span class="normal">		  </span><span class="keyword">if</span><span class="normal"> </span><span class="keyword">test</span><span class="normal"> -z </span><span class="string">"$absdir"</span><span class="symbol">;</span><span class="normal"> </span><span class="keyword">then</span>
<span class="normal">		    </span><span class="variable">$echo</span><span class="normal"> </span><span class="string">"$modename: warning: cannot determine absolute directory name of </span><span class="specialchar">\`</span><span class="string">$dir'"</span><span class="normal"> </span><span class="number">1</span><span class="symbol">&gt;&amp;</span><span class="number">2</span>
<span class="normal">		    </span><span class="variable">absdir</span><span class="symbol">=</span><span class="string">"$dir"</span>
<span class="normal">		  </span><span class="keyword">fi</span>
<span class="normal">		  </span><span class="symbol">;;</span>
<span class="normal">		</span><span class="keyword">esac</span>
<span class="normal">		</span><span class="keyword">if</span><span class="normal"> grep </span><span class="string">"^installed=no"</span><span class="normal"> </span><span class="variable">$deplib</span><span class="normal"> </span><span class="symbol">&gt;</span><span class="normal"> /dev/null</span><span class="symbol">;</span><span class="normal"> </span><span class="keyword">then</span>
<span class="normal">		  </span><span class="variable">path</span><span class="symbol">=</span><span class="string">"$absdir/$objdir"</span>
<span class="normal">		</span><span class="keyword">else</span>
<span class="normal">		  </span><span class="keyword">eval</span><span class="normal"> </span><span class="variable">libdir</span><span class="symbol">=</span><span class="normal">`</span><span class="variable">${SED}</span><span class="normal"> -n -e </span><span class="string">'s/^libdir=</span><span class="specialchar">\(</span><span class="string">.*</span><span class="specialchar">\)</span><span class="string">$/</span><span class="specialchar">\1</span><span class="string">/p'</span><span class="normal"> </span><span class="variable">$deplib</span><span class="normal">`</span>
<span class="normal">		  </span><span class="keyword">if</span><span class="normal"> </span><span class="keyword">test</span><span class="normal"> -z </span><span class="string">"$libdir"</span><span class="symbol">;</span><span class="normal"> </span><span class="keyword">then</span>
<span class="normal">		    </span><span class="variable">$echo</span><span class="normal"> </span><span class="string">"$modename: </span><span class="specialchar">\`</span><span class="string">$deplib' is not a valid libtool archive"</span><span class="normal"> </span><span class="number">1</span><span class="symbol">&gt;&amp;</span><span class="number">2</span>
<span class="normal">		    </span><span class="keyword">exit</span><span class="normal"> </span><span class="variable">$EXIT_FAILURE</span>
<span class="normal">		  </span><span class="keyword">fi</span>
<span class="normal">		  </span><span class="keyword">if</span><span class="normal"> </span><span class="keyword">test</span><span class="normal"> </span><span class="string">"$absdir"</span><span class="normal"> </span><span class="symbol">!=</span><span class="normal"> </span><span class="string">"$libdir"</span><span class="symbol">;</span><span class="normal"> </span><span class="keyword">then</span>
<span class="normal">		    </span><span class="variable">$echo</span><span class="normal"> </span><span class="string">"$modename: warning: </span><span class="specialchar">\`</span><span class="string">$deplib' seems to be moved"</span><span class="normal"> </span><span class="number">1</span><span class="symbol">&gt;&amp;</span><span class="number">2</span>
<span class="normal">		  </span><span class="keyword">fi</span>
<span class="normal">		  </span><span class="variable">path</span><span class="symbol">=</span><span class="string">"$absdir"</span>
<span class="normal">		</span><span class="keyword">fi</span>
<span class="normal">		</span><span class="variable">depdepl</span><span class="symbol">=</span>
<span class="normal">		</span><span class="keyword">case</span><span class="normal"> </span><span class="variable">$host</span><span class="normal"> </span><span class="keyword">in</span>
<span class="normal">		</span><span class="symbol">*</span><span class="normal">-</span><span class="symbol">*</span><span class="normal">-darwin</span><span class="symbol">*)</span>
<span class="normal">		  </span><span class="comment"># we do not want to link against static libs,</span>
<span class="normal">		  </span><span class="comment"># but need to link against shared</span>
<span class="normal">		  </span><span class="keyword">eval</span><span class="normal"> </span><span class="variable">deplibrary_names</span><span class="symbol">=</span><span class="normal">`</span><span class="variable">${SED}</span><span class="normal"> -n -e </span><span class="string">'s/^library_names=</span><span class="specialchar">\(</span><span class="string">.*</span><span class="specialchar">\)</span><span class="string">$/</span><span class="specialchar">\1</span><span class="string">/p'</span><span class="normal"> </span><span class="variable">$deplib</span><span class="normal">`</span>
<span class="normal">		  </span><span class="keyword">if</span><span class="normal"> </span><span class="keyword">test</span><span class="normal"> -n </span><span class="string">"$deplibrary_names"</span><span class="normal"> </span><span class="symbol">;</span><span class="normal"> </span><span class="keyword">then</span>
<span class="normal">		    </span><span class="keyword">for</span><span class="normal"> tmp </span><span class="keyword">in</span><span class="normal"> </span><span class="variable">$deplibrary_names</span><span class="normal"> </span><span class="symbol">;</span><span class="normal"> </span><span class="keyword">do</span>
<span class="normal">		      </span><span class="variable">depdepl</span><span class="symbol">=</span><span class="variable">$tmp</span>
<span class="normal">		    </span><span class="keyword">done</span>
<span class="normal">		    </span><span class="keyword">if</span><span class="normal"> </span><span class="keyword">test</span><span class="normal"> -f </span><span class="string">"$path/$depdepl"</span><span class="normal"> </span><span class="symbol">;</span><span class="normal"> </span><span class="keyword">then</span>
<span class="normal">		      </span><span class="variable">depdepl</span><span class="symbol">=</span><span class="string">"$path/$depdepl"</span>
<span class="normal">		    </span><span class="keyword">fi</span>
<span class="normal">		    </span><span class="comment"># do not add paths which are already there</span>
<span class="normal">		    </span><span class="keyword">case</span><span class="normal"> </span><span class="string">" $newlib_search_path "</span><span class="normal"> </span><span class="keyword">in</span>
<span class="normal">		    </span><span class="symbol">*</span><span class="string">" $path "</span><span class="symbol">*)</span><span class="normal"> </span><span class="symbol">;;</span>
<span class="normal">		    </span><span class="symbol">*)</span><span class="normal"> </span><span class="variable">newlib_search_path</span><span class="symbol">=</span><span class="string">"$newlib_search_path $path"</span><span class="symbol">;;</span>
<span class="normal">		    </span><span class="keyword">esac</span>
<span class="normal">		  </span><span class="keyword">fi</span>
<span class="normal">		  </span><span class="variable">path</span><span class="symbol">=</span><span class="string">""</span>
<span class="normal">		  </span><span class="symbol">;;</span>
<span class="normal">		</span><span class="symbol">*)</span>
<span class="normal">		  </span><span class="variable">path</span><span class="symbol">=</span><span class="string">"-L$path"</span>
<span class="normal">		  </span><span class="symbol">;;</span>
<span class="normal">		</span><span class="keyword">esac</span>
<span class="normal">		</span><span class="symbol">;;</span>
<span class="normal">	      -l</span><span class="symbol">*)</span>
<span class="normal">		</span><span class="keyword">case</span><span class="normal"> </span><span class="variable">$host</span><span class="normal"> </span><span class="keyword">in</span>
<span class="normal">		</span><span class="symbol">*</span><span class="normal">-</span><span class="symbol">*</span><span class="normal">-darwin</span><span class="symbol">*)</span>
<span class="normal">		  </span><span class="comment"># Again, we only want to link against shared libraries</span>
<span class="normal">		  </span><span class="keyword">eval</span><span class="normal"> </span><span class="variable">tmp_libs</span><span class="symbol">=</span><span class="normal">`</span><span class="variable">$echo</span><span class="normal"> </span><span class="string">"X$deplib"</span><span class="normal"> </span><span class="symbol">|</span><span class="normal"> </span><span class="variable">$Xsed</span><span class="normal"> -e </span><span class="string">"s,^</span><span class="specialchar">\-</span><span class="string">l,,"</span><span class="normal">`</span>
<span class="normal">		  </span><span class="keyword">for</span><span class="normal"> tmp </span><span class="keyword">in</span><span class="normal"> </span><span class="variable">$newlib_search_path</span><span class="normal"> </span><span class="symbol">;</span><span class="normal"> </span><span class="keyword">do</span>
<span class="normal">		    </span><span class="keyword">if</span><span class="normal"> </span><span class="keyword">test</span><span class="normal"> -f </span><span class="string">"$tmp/lib$tmp_libs.dylib"</span><span class="normal"> </span><span class="symbol">;</span><span class="normal"> </span><span class="keyword">then</span>
<span class="normal">		      </span><span class="keyword">eval</span><span class="normal"> </span><span class="variable">depdepl</span><span class="symbol">=</span><span class="string">"$tmp/lib$tmp_libs.dylib"</span>
<span class="normal">		      </span><span class="keyword">break</span>
<span class="normal">		    </span><span class="keyword">fi</span>
<span class="normal">		  </span><span class="keyword">done</span>
<span class="normal">		  </span><span class="variable">path</span><span class="symbol">=</span><span class="string">""</span>
<span class="normal">		  </span><span class="symbol">;;</span>
<span class="normal">		</span><span class="symbol">*)</span><span class="normal"> </span><span class="keyword">continue</span><span class="normal"> </span><span class="symbol">;;</span>
<span class="normal">		</span><span class="keyword">esac</span>
<span class="normal">		</span><span class="symbol">;;</span>
<span class="normal">	      </span><span class="symbol">*)</span><span class="normal"> </span><span class="keyword">continue</span><span class="normal"> </span><span class="symbol">;;</span>
<span class="normal">	      </span><span class="keyword">esac</span>
<span class="normal">	      </span><span class="keyword">case</span><span class="normal"> </span><span class="string">" $deplibs "</span><span class="normal"> </span><span class="keyword">in</span>
<span class="normal">	      </span><span class="symbol">*</span><span class="string">" $path "</span><span class="symbol">*)</span><span class="normal"> </span><span class="symbol">;;</span>
<span class="normal">	      </span><span class="symbol">*)</span><span class="normal"> </span><span class="variable">deplibs</span><span class="symbol">=</span><span class="string">"$path $deplibs"</span><span class="normal"> </span><span class="symbol">;;</span>
<span class="normal">	      </span><span class="keyword">esac</span>
<span class="normal">	      </span><span class="keyword">case</span><span class="normal"> </span><span class="string">" $deplibs "</span><span class="normal"> </span><span class="keyword">in</span>
<span class="normal">	      </span><span class="symbol">*</span><span class="string">" $depdepl "</span><span class="symbol">*)</span><span class="normal"> </span><span class="symbol">;;</span>
<span class="normal">	      </span><span class="symbol">*)</span><span class="normal"> </span><span class="variable">deplibs</span><span class="symbol">=</span><span class="string">"$depdepl $deplibs"</span><span class="normal"> </span><span class="symbol">;;</span>
<span class="normal">	      </span><span class="keyword">esac</span>
<span class="normal">	    </span><span class="keyword">done</span>
<span class="normal">	  </span><span class="keyword">fi</span><span class="normal"> </span><span class="comment"># link_all_deplibs != no</span>
<span class="normal">	</span><span class="keyword">fi</span><span class="normal"> </span><span class="comment"># linkmode = lib</span>
<span class="normal">      </span><span class="keyword">done</span><span class="normal"> </span><span class="comment"># for deplib in $libs</span>
<span class="normal">      </span><span class="variable">dependency_libs</span><span class="symbol">=</span><span class="string">"$newdependency_libs"</span>
<span class="normal">      </span><span class="keyword">if</span><span class="normal"> </span><span class="keyword">test</span><span class="normal"> </span><span class="string">"$pass"</span><span class="normal"> </span><span class="symbol">=</span><span class="normal"> dlpreopen</span><span class="symbol">;</span><span class="normal"> </span><span class="keyword">then</span>
<span class="normal">	</span><span class="comment"># Link the dlpreopened libraries before other libraries</span>
<span class="normal">	</span><span class="keyword">for</span><span class="normal"> deplib </span><span class="keyword">in</span><span class="normal"> </span><span class="variable">$save_deplibs</span><span class="symbol">;</span><span class="normal"> </span><span class="keyword">do</span>
<span class="normal">	  </span><span class="variable">deplibs</span><span class="symbol">=</span><span class="string">"$deplib $deplibs"</span>
<span class="normal">	</span><span class="keyword">done</span>
<span class="normal">      </span><span class="keyword">fi</span>
<span class="normal">      </span><span class="keyword">if</span><span class="normal"> </span><span class="keyword">test</span><span class="normal"> </span><span class="string">"$pass"</span><span class="normal"> </span><span class="symbol">!=</span><span class="normal"> dlopen</span><span class="symbol">;</span><span class="normal"> </span><span class="keyword">then</span>
<span class="normal">	</span><span class="keyword">if</span><span class="normal"> </span><span class="keyword">test</span><span class="normal"> </span><span class="string">"$pass"</span><span class="normal"> </span><span class="symbol">!=</span><span class="normal"> conv</span><span class="symbol">;</span><span class="normal"> </span><span class="keyword">then</span>
<span class="normal">	  </span><span class="comment"># Make sure lib_search_path contains only unique directories.</span>
<span class="normal">	  </span><span class="variable">lib_search_path</span><span class="symbol">=</span>
<span class="normal">	  </span><span class="keyword">for</span><span class="normal"> dir </span><span class="keyword">in</span><span class="normal"> </span><span class="variable">$newlib_search_path</span><span class="symbol">;</span><span class="normal"> </span><span class="keyword">do</span>
<span class="normal">	    </span><span class="keyword">case</span><span class="normal"> </span><span class="string">"$lib_search_path "</span><span class="normal"> </span><span class="keyword">in</span>
<span class="normal">	    </span><span class="symbol">*</span><span class="string">" $dir "</span><span class="symbol">*)</span><span class="normal"> </span><span class="symbol">;;</span>
<span class="normal">	    </span><span class="symbol">*)</span><span class="normal"> </span><span class="variable">lib_search_path</span><span class="symbol">=</span><span class="string">"$lib_search_path $dir"</span><span class="normal"> </span><span class="symbol">;;</span>
<span class="normal">	    </span><span class="keyword">esac</span>
<span class="normal">	  </span><span class="keyword">done</span>
<span class="normal">	  </span><span class="variable">newlib_search_path</span><span class="symbol">=</span>
<span class="normal">	</span><span class="keyword">fi</span>

<span class="normal">	</span><span class="keyword">if</span><span class="normal"> </span><span class="keyword">test</span><span class="normal"> </span><span class="string">"$linkmode,$pass"</span><span class="normal"> </span><span class="symbol">!=</span><span class="normal"> </span><span class="string">"prog,link"</span><span class="symbol">;</span><span class="normal"> </span><span class="keyword">then</span>
<span class="normal">	  </span><span class="variable">vars</span><span class="symbol">=</span><span class="string">"deplibs"</span>
<span class="normal">	</span><span class="keyword">else</span>
<span class="normal">	  </span><span class="variable">vars</span><span class="symbol">=</span><span class="string">"compile_deplibs finalize_deplibs"</span>
<span class="normal">	</span><span class="keyword">fi</span>
<span class="normal">	</span><span class="keyword">for</span><span class="normal"> var </span><span class="keyword">in</span><span class="normal"> </span><span class="variable">$vars</span><span class="normal"> dependency_libs</span><span class="symbol">;</span><span class="normal"> </span><span class="keyword">do</span>
<span class="normal">	  </span><span class="comment"># Add libraries to $var in reverse order</span>
<span class="normal">	  </span><span class="keyword">eval</span><span class="normal"> </span><span class="variable">tmp_libs</span><span class="symbol">=</span><span class="normal">\"</span><span class="symbol">\</span><span class="variable">$$</span><span class="normal">var\"</span>
<span class="normal">	  </span><span class="variable">new_libs</span><span class="symbol">=</span>
<span class="normal">	  </span><span class="keyword">for</span><span class="normal"> deplib </span><span class="keyword">in</span><span class="normal"> </span><span class="variable">$tmp_libs</span><span class="symbol">;</span><span class="normal"> </span><span class="keyword">do</span>
<span class="normal">	    </span><span class="comment"># FIXME: Pedantically, this is the right thing to do, so</span>
<span class="normal">	    </span><span class="comment">#        that some nasty dependency loop isn't accidentally</span>
<span class="normal">	    </span><span class="comment">#        broken:</span>
<span class="normal">	    </span><span class="comment">#new_libs="$deplib $new_libs"</span>
<span class="normal">	    </span><span class="comment"># Pragmatically, this seems to cause very few problems in</span>
<span class="normal">	    </span><span class="comment"># practice:</span>
<span class="normal">	    </span><span class="keyword">case</span><span class="normal"> </span><span class="variable">$deplib</span><span class="normal"> </span><span class="keyword">in</span>
<span class="normal">	    -L</span><span class="symbol">*)</span><span class="normal"> </span><span class="variable">new_libs</span><span class="symbol">=</span><span class="string">"$deplib $new_libs"</span><span class="normal"> </span><span class="symbol">;;</span>
<span class="normal">	    -R</span><span class="symbol">*)</span><span class="normal"> </span><span class="symbol">;;</span>
<span class="normal">	    </span><span class="symbol">*)</span>
<span class="normal">	      </span><span class="comment"># And here is the reason: when a library appears more</span>
<span class="normal">	      </span><span class="comment"># than once as an explicit dependence of a library, or</span>
<span class="normal">	      </span><span class="comment"># is implicitly linked in more than once by the</span>
<span class="normal">	      </span><span class="comment"># compiler, it is considered special, and multiple</span>
<span class="normal">	      </span><span class="comment"># occurrences thereof are not removed.  Compare this</span>
<span class="normal">	      </span><span class="comment"># with having the same library being listed as a</span>
<span class="normal">	      </span><span class="comment"># dependency of multiple other libraries: in this case,</span>
<span class="normal">	      </span><span class="comment"># we know (pedantically, we assume) the library does not</span>
<span class="normal">	      </span><span class="comment"># need to be listed more than once, so we keep only the</span>
<span class="normal">	      </span><span class="comment"># last copy.  This is not always right, but it is rare</span>
<span class="normal">	      </span><span class="comment"># enough that we require users that really mean to play</span>
<span class="normal">	      </span><span class="comment"># such unportable linking tricks to link the library</span>
<span class="normal">	      </span><span class="comment"># using -Wl,-lname, so that libtool does not consider it</span>
<span class="normal">	      </span><span class="comment"># for duplicate removal.</span>
<span class="normal">	      </span><span class="keyword">case</span><span class="normal"> </span><span class="string">" $specialdeplibs "</span><span class="normal"> </span><span class="keyword">in</span>
<span class="normal">	      </span><span class="symbol">*</span><span class="string">" $deplib "</span><span class="symbol">*)</span><span class="normal"> </span><span class="variable">new_libs</span><span class="symbol">=</span><span class="string">"$deplib $new_libs"</span><span class="normal"> </span><span class="symbol">;;</span>
<span class="normal">	      </span><span class="symbol">*)</span>
<span class="normal">		</span><span class="keyword">case</span><span class="normal"> </span><span class="string">" $new_libs "</span><span class="normal"> </span><span class="keyword">in</span>
<span class="normal">		</span><span class="symbol">*</span><span class="string">" $deplib "</span><span class="symbol">*)</span><span class="normal"> </span><span class="symbol">;;</span>
<span class="normal">		</span><span class="symbol">*)</span><span class="normal"> </span><span class="variable">new_libs</span><span class="symbol">=</span><span class="string">"$deplib $new_libs"</span><span class="normal"> </span><span class="symbol">;;</span>
<span class="normal">		</span><span class="keyword">esac</span>
<span class="normal">		</span><span class="symbol">;;</span>
<span class="normal">	      </span><span class="keyword">esac</span>
<span class="normal">	      </span><span class="symbol">;;</span>
<span class="normal">	    </span><span class="keyword">esac</span>
<span class="normal">	  </span><span class="keyword">done</span>
<span class="normal">	  </span><span class="variable">tmp_libs</span><span class="symbol">=</span>
<span class="normal">	  </span><span class="keyword">for</span><span class="normal"> deplib </span><span class="keyword">in</span><span class="normal"> </span><span class="variable">$new_libs</span><span class="symbol">;</span><span class="normal"> </span><span class="keyword">do</span>
<span class="normal">	    </span><span class="keyword">case</span><span class="normal"> </span><span class="variable">$deplib</span><span class="normal"> </span><span class="keyword">in</span>
<span class="normal">	    -L</span><span class="symbol">*)</span>
<span class="normal">	      </span><span class="keyword">case</span><span class="normal"> </span><span class="string">" $tmp_libs "</span><span class="normal"> </span><span class="keyword">in</span>
<span class="normal">	      </span><span class="symbol">*</span><span class="string">" $deplib "</span><span class="symbol">*)</span><span class="normal"> </span><span class="symbol">;;</span>
<span class="normal">	      </span><span class="symbol">*)</span><span class="normal"> </span><span class="variable">tmp_libs</span><span class="symbol">=</span><span class="string">"$tmp_libs $deplib"</span><span class="normal"> </span><span class="symbol">;;</span>
<span class="normal">	      </span><span class="keyword">esac</span>
<span class="normal">	      </span><span class="symbol">;;</span>
<span class="normal">	    </span><span class="symbol">*)</span><span class="normal"> </span><span class="variable">tmp_libs</span><span class="symbol">=</span><span class="string">"$tmp_libs $deplib"</span><span class="normal"> </span><span class="symbol">;;</span>
<span class="normal">	    </span><span class="keyword">esac</span>
<span class="normal">	  </span><span class="keyword">done</span>
<span class="normal">	  </span><span class="keyword">eval</span><span class="normal"> </span><span class="variable">$var</span><span class="symbol">=</span><span class="normal">\"</span><span class="variable">$tmp_libs</span><span class="normal">\"</span>
<span class="normal">	</span><span class="keyword">done</span><span class="normal"> </span><span class="comment"># for var</span>
<span class="normal">      </span><span class="keyword">fi</span>
<span class="normal">      </span><span class="comment"># Last step: remove runtime libs from dependency_libs</span>
<span class="normal">      </span><span class="comment"># (they stay in deplibs)</span>
<span class="normal">      </span><span class="variable">tmp_libs</span><span class="symbol">=</span>
<span class="normal">      </span><span class="keyword">for</span><span class="normal"> i </span><span class="keyword">in</span><span class="normal"> </span><span class="variable">$dependency_libs</span><span class="normal"> </span><span class="symbol">;</span><span class="normal"> </span><span class="keyword">do</span>
<span class="normal">	</span><span class="keyword">case</span><span class="normal"> </span><span class="string">" $predeps $postdeps $compiler_lib_search_path "</span><span class="normal"> </span><span class="keyword">in</span>
<span class="normal">	</span><span class="symbol">*</span><span class="string">" $i "</span><span class="symbol">*)</span>
<span class="normal">	  </span><span class="variable">i</span><span class="symbol">=</span><span class="string">""</span>
<span class="normal">	  </span><span class="symbol">;;</span>
<span class="normal">	</span><span class="keyword">esac</span>
<span class="normal">	</span><span class="keyword">if</span><span class="normal"> </span><span class="keyword">test</span><span class="normal"> -n </span><span class="string">"$i"</span><span class="normal"> </span><span class="symbol">;</span><span class="normal"> </span><span class="keyword">then</span>
<span class="normal">	  </span><span class="variable">tmp_libs</span><span class="symbol">=</span><span class="string">"$tmp_libs $i"</span>
<span class="normal">	</span><span class="keyword">fi</span>
<span class="normal">      </span><span class="keyword">done</span>
<span class="normal">      </span><span class="variable">dependency_libs</span><span class="symbol">=</span><span class="variable">$tmp_libs</span>
<span class="normal">    </span><span class="keyword">done</span><span class="normal"> </span><span class="comment"># for pass</span>
<span class="normal">    </span><span class="keyword">if</span><span class="normal"> </span><span class="keyword">test</span><span class="normal"> </span><span class="string">"$linkmode"</span><span class="normal"> </span><span class="symbol">=</span><span class="normal"> prog</span><span class="symbol">;</span><span class="normal"> </span><span class="keyword">then</span>
<span class="normal">      </span><span class="variable">dlfiles</span><span class="symbol">=</span><span class="string">"$newdlfiles"</span>
<span class="normal">      </span><span class="variable">dlprefiles</span><span class="symbol">=</span><span class="string">"$newdlprefiles"</span>
<span class="normal">    </span><span class="keyword">fi</span>

<span class="normal">    </span><span class="keyword">case</span><span class="normal"> </span><span class="variable">$linkmode</span><span class="normal"> </span><span class="keyword">in</span>
<span class="normal">    oldlib</span><span class="symbol">)</span>
<span class="normal">      </span><span class="keyword">if</span><span class="normal"> </span><span class="keyword">test</span><span class="normal"> -n </span><span class="string">"$deplibs"</span><span class="symbol">;</span><span class="normal"> </span><span class="keyword">then</span>
<span class="normal">	</span><span class="variable">$echo</span><span class="normal"> </span><span class="string">"$modename: warning: </span><span class="specialchar">\`</span><span class="string">-l' and </span><span class="specialchar">\`</span><span class="string">-L' are ignored for archives"</span><span class="normal"> </span><span class="number">1</span><span class="symbol">&gt;&amp;</span><span class="number">2</span>
<span class="normal">      </span><span class="keyword">fi</span>

<span class="normal">      </span><span class="keyword">if</span><span class="normal"> </span><span class="keyword">test</span><span class="normal"> -n </span><span class="string">"$dlfiles$dlprefiles"</span><span class="normal"> </span><span class="symbol">||</span><span class="normal"> </span><span class="keyword">test</span><span class="normal"> </span><span class="string">"$dlself"</span><span class="normal"> </span><span class="symbol">!=</span><span class="normal"> no</span><span class="symbol">;</span><span class="normal"> </span><span class="keyword">then</span>
<span class="normal">	</span><span class="variable">$echo</span><span class="normal"> </span><span class="string">"$modename: warning: </span><span class="specialchar">\`</span><span class="string">-dlopen' is ignored for archives"</span><span class="normal"> </span><span class="number">1</span><span class="symbol">&gt;&amp;</span><span class="number">2</span>
<span class="normal">      </span><span class="keyword">fi</span>

<span class="normal">      </span><span class="keyword">if</span><span class="normal"> </span><span class="keyword">test</span><span class="normal"> -n </span><span class="string">"$rpath"</span><span class="symbol">;</span><span class="normal"> </span><span class="keyword">then</span>
<span class="normal">	</span><span class="variable">$echo</span><span class="normal"> </span><span class="string">"$modename: warning: </span><span class="specialchar">\`</span><span class="string">-rpath' is ignored for archives"</span><span class="normal"> </span><span class="number">1</span><span class="symbol">&gt;&amp;</span><span class="number">2</span>
<span class="normal">      </span><span class="keyword">fi</span>

<span class="normal">      </span><span class="keyword">if</span><span class="normal"> </span><span class="keyword">test</span><span class="normal"> -n </span><span class="string">"$xrpath"</span><span class="symbol">;</span><span class="normal"> </span><span class="keyword">then</span>
<span class="normal">	</span><span class="variable">$echo</span><span class="normal"> </span><span class="string">"$modename: warning: </span><span class="specialchar">\`</span><span class="string">-R' is ignored for archives"</span><span class="normal"> </span><span class="number">1</span><span class="symbol">&gt;&amp;</span><span class="number">2</span>
<span class="normal">      </span><span class="keyword">fi</span>

<span class="normal">      </span><span class="keyword">if</span><span class="normal"> </span><span class="keyword">test</span><span class="normal"> -n </span><span class="string">"$vinfo"</span><span class="symbol">;</span><span class="normal"> </span><span class="keyword">then</span>
<span class="normal">	</span><span class="variable">$echo</span><span class="normal"> </span><span class="string">"$modename: warning: </span><span class="specialchar">\`</span><span class="string">-version-info/-version-number' is ignored for archives"</span><span class="normal"> </span><span class="number">1</span><span class="symbol">&gt;&amp;</span><span class="number">2</span>
<span class="normal">      </span><span class="keyword">fi</span>

<span class="normal">      </span><span class="keyword">if</span><span class="normal"> </span><span class="keyword">test</span><span class="normal"> -n </span><span class="string">"$release"</span><span class="symbol">;</span><span class="normal"> </span><span class="keyword">then</span>
<span class="normal">	</span><span class="variable">$echo</span><span class="normal"> </span><span class="string">"$modename: warning: </span><span class="specialchar">\`</span><span class="string">-release' is ignored for archives"</span><span class="normal"> </span><span class="number">1</span><span class="symbol">&gt;&amp;</span><span class="number">2</span>
<span class="normal">      </span><span class="keyword">fi</span>

<span class="normal">      </span><span class="keyword">if</span><span class="normal"> </span><span class="keyword">test</span><span class="normal"> -n </span><span class="string">"$export_symbols"</span><span class="normal"> </span><span class="symbol">||</span><span class="normal"> </span><span class="keyword">test</span><span class="normal"> -n </span><span class="string">"$export_symbols_regex"</span><span class="symbol">;</span><span class="normal"> </span><span class="keyword">then</span>
<span class="normal">	</span><span class="variable">$echo</span><span class="normal"> </span><span class="string">"$modename: warning: </span><span class="specialchar">\`</span><span class="string">-export-symbols' is ignored for archives"</span><span class="normal"> </span><span class="number">1</span><span class="symbol">&gt;&amp;</span><span class="number">2</span>
<span class="normal">      </span><span class="keyword">fi</span>

<span class="normal">      </span><span class="comment"># Now set the variables for building old libraries.</span>
<span class="normal">      </span><span class="variable">build_libtool_libs</span><span class="symbol">=</span><span class="normal">no</span>
<span class="normal">      </span><span class="variable">oldlibs</span><span class="symbol">=</span><span class="string">"$output"</span>
<span class="normal">      </span><span class="variable">objs</span><span class="symbol">=</span><span class="string">"$objs$old_deplibs"</span>
<span class="normal">      </span><span class="symbol">;;</span>

<span class="normal">    lib</span><span class="symbol">)</span>
<span class="normal">      </span><span class="comment"># Make sure we only generate libraries of the form `libNAME.la'.</span>
<span class="normal">      </span><span class="keyword">case</span><span class="normal"> </span><span class="variable">$outputname</span><span class="normal"> </span><span class="keyword">in</span>
<span class="normal">      lib</span><span class="symbol">*)</span>
<span class="normal">	</span><span class="variable">name</span><span class="symbol">=</span><span class="normal">`</span><span class="variable">$echo</span><span class="normal"> </span><span class="string">"X$outputname"</span><span class="normal"> </span><span class="symbol">|</span><span class="normal"> </span><span class="variable">$Xsed</span><span class="normal"> -e </span><span class="string">'s/</span><span class="specialchar">\.</span><span class="string">la$//'</span><span class="normal"> -e </span><span class="string">'s/^lib//'</span><span class="normal">`</span>
<span class="normal">	</span><span class="keyword">eval</span><span class="normal"> </span><span class="variable">shared_ext</span><span class="symbol">=</span><span class="normal">\"</span><span class="variable">$shrext_cmds</span><span class="normal">\"</span>
<span class="normal">	</span><span class="keyword">eval</span><span class="normal"> </span><span class="variable">libname</span><span class="symbol">=</span><span class="normal">\"</span><span class="variable">$libname_spec</span><span class="normal">\"</span>
<span class="normal">	</span><span class="symbol">;;</span>
<span class="normal">      </span><span class="symbol">*)</span>
<span class="normal">	</span><span class="keyword">if</span><span class="normal"> </span><span class="keyword">test</span><span class="normal"> </span><span class="string">"$module"</span><span class="normal"> </span><span class="symbol">=</span><span class="normal"> no</span><span class="symbol">;</span><span class="normal"> </span><span class="keyword">then</span>
<span class="normal">	  </span><span class="variable">$echo</span><span class="normal"> </span><span class="string">"$modename: libtool library </span><span class="specialchar">\`</span><span class="string">$output' must begin with </span><span class="specialchar">\`</span><span class="string">lib'"</span><span class="normal"> </span><span class="number">1</span><span class="symbol">&gt;&amp;</span><span class="number">2</span>
<span class="normal">	  </span><span class="variable">$echo</span><span class="normal"> </span><span class="string">"$help"</span><span class="normal"> </span><span class="number">1</span><span class="symbol">&gt;&amp;</span><span class="number">2</span>
<span class="normal">	  </span><span class="keyword">exit</span><span class="normal"> </span><span class="variable">$EXIT_FAILURE</span>
<span class="normal">	</span><span class="keyword">fi</span>
<span class="normal">	</span><span class="keyword">if</span><span class="normal"> </span><span class="keyword">test</span><span class="normal"> </span><span class="string">"$need_lib_prefix"</span><span class="normal"> </span><span class="symbol">!=</span><span class="normal"> no</span><span class="symbol">;</span><span class="normal"> </span><span class="keyword">then</span>
<span class="normal">	  </span><span class="comment"># Add the "lib" prefix for modules if required</span>
<span class="normal">	  </span><span class="variable">name</span><span class="symbol">=</span><span class="normal">`</span><span class="variable">$echo</span><span class="normal"> </span><span class="string">"X$outputname"</span><span class="normal"> </span><span class="symbol">|</span><span class="normal"> </span><span class="variable">$Xsed</span><span class="normal"> -e </span><span class="string">'s/</span><span class="specialchar">\.</span><span class="string">la$//'</span><span class="normal">`</span>
<span class="normal">	  </span><span class="keyword">eval</span><span class="normal"> </span><span class="variable">shared_ext</span><span class="symbol">=</span><span class="normal">\"</span><span class="variable">$shrext_cmds</span><span class="normal">\"</span>
<span class="normal">	  </span><span class="keyword">eval</span><span class="normal"> </span><span class="variable">libname</span><span class="symbol">=</span><span class="normal">\"</span><span class="variable">$libname_spec</span><span class="normal">\"</span>
<span class="normal">	</span><span class="keyword">else</span>
<span class="normal">	  </span><span class="variable">libname</span><span class="symbol">=</span><span class="normal">`</span><span class="variable">$echo</span><span class="normal"> </span><span class="string">"X$outputname"</span><span class="normal"> </span><span class="symbol">|</span><span class="normal"> </span><span class="variable">$Xsed</span><span class="normal"> -e </span><span class="string">'s/</span><span class="specialchar">\.</span><span class="string">la$//'</span><span class="normal">`</span>
<span class="normal">	</span><span class="keyword">fi</span>
<span class="normal">	</span><span class="symbol">;;</span>
<span class="normal">      </span><span class="keyword">esac</span>

<span class="normal">      </span><span class="keyword">if</span><span class="normal"> </span><span class="keyword">test</span><span class="normal"> -n </span><span class="string">"$objs"</span><span class="symbol">;</span><span class="normal"> </span><span class="keyword">then</span>
<span class="normal">	</span><span class="keyword">if</span><span class="normal"> </span><span class="keyword">test</span><span class="normal"> </span><span class="string">"$deplibs_check_method"</span><span class="normal"> </span><span class="symbol">!=</span><span class="normal"> pass_all</span><span class="symbol">;</span><span class="normal"> </span><span class="keyword">then</span>
<span class="normal">	  </span><span class="variable">$echo</span><span class="normal"> </span><span class="string">"$modename: cannot build libtool library </span><span class="specialchar">\`</span><span class="string">$output' from non-libtool objects on this host:$objs"</span><span class="normal"> </span><span class="number">2</span><span class="symbol">&gt;&amp;</span><span class="number">1</span>
<span class="normal">	  </span><span class="keyword">exit</span><span class="normal"> </span><span class="variable">$EXIT_FAILURE</span>
<span class="normal">	</span><span class="keyword">else</span>
<span class="normal">	  </span><span class="variable">$echo</span>
<span class="normal">	  </span><span class="variable">$echo</span><span class="normal"> </span><span class="string">"*** Warning: Linking the shared library $output against the non-libtool"</span>
<span class="normal">	  </span><span class="variable">$echo</span><span class="normal"> </span><span class="string">"*** objects $objs is not portable!"</span>
<span class="normal">	  </span><span class="variable">libobjs</span><span class="symbol">=</span><span class="string">"$libobjs $objs"</span>
<span class="normal">	</span><span class="keyword">fi</span>
<span class="normal">      </span><span class="keyword">fi</span>

<span class="normal">      </span><span class="keyword">if</span><span class="normal"> </span><span class="keyword">test</span><span class="normal"> </span><span class="string">"$dlself"</span><span class="normal"> </span><span class="symbol">!=</span><span class="normal"> no</span><span class="symbol">;</span><span class="normal"> </span><span class="keyword">then</span>
<span class="normal">	</span><span class="variable">$echo</span><span class="normal"> </span><span class="string">"$modename: warning: </span><span class="specialchar">\`</span><span class="string">-dlopen self' is ignored for libtool libraries"</span><span class="normal"> </span><span class="number">1</span><span class="symbol">&gt;&amp;</span><span class="number">2</span>
<span class="normal">      </span><span class="keyword">fi</span>

<span class="normal">      </span><span class="keyword">set</span><span class="normal"> dummy </span><span class="variable">$rpath</span>
<span class="normal">      </span><span class="keyword">if</span><span class="normal"> </span><span class="keyword">test</span><span class="normal"> </span><span class="string">"$#"</span><span class="normal"> -gt </span><span class="number">2</span><span class="symbol">;</span><span class="normal"> </span><span class="keyword">then</span>
<span class="normal">	</span><span class="variable">$echo</span><span class="normal"> </span><span class="string">"$modename: warning: ignoring multiple </span><span class="specialchar">\`</span><span class="string">-rpath's for a libtool library"</span><span class="normal"> </span><span class="number">1</span><span class="symbol">&gt;&amp;</span><span class="number">2</span>
<span class="normal">      </span><span class="keyword">fi</span>
<span class="normal">      </span><span class="variable">install_libdir</span><span class="symbol">=</span><span class="string">"$2"</span>

<span class="normal">      </span><span class="variable">oldlibs</span><span class="symbol">=</span>
<span class="normal">      </span><span class="keyword">if</span><span class="normal"> </span><span class="keyword">test</span><span class="normal"> -z </span><span class="string">"$rpath"</span><span class="symbol">;</span><span class="normal"> </span><span class="keyword">then</span>
<span class="normal">	</span><span class="keyword">if</span><span class="normal"> </span><span class="keyword">test</span><span class="normal"> </span><span class="string">"$build_libtool_libs"</span><span class="normal"> </span><span class="symbol">=</span><span class="normal"> yes</span><span class="symbol">;</span><span class="normal"> </span><span class="keyword">then</span>
<span class="normal">	  </span><span class="comment"># Building a libtool convenience library.</span>
<span class="normal">	  </span><span class="comment"># Some compilers have problems with a `.al' extension so</span>
<span class="normal">	  </span><span class="comment"># convenience libraries should have the same extension an</span>
<span class="normal">	  </span><span class="comment"># archive normally would.</span>
<span class="normal">	  </span><span class="variable">oldlibs</span><span class="symbol">=</span><span class="string">"$output_objdir/$libname.$libext $oldlibs"</span>
<span class="normal">	  </span><span class="variable">build_libtool_libs</span><span class="symbol">=</span><span class="normal">convenience</span>
<span class="normal">	  </span><span class="variable">build_old_libs</span><span class="symbol">=</span><span class="normal">yes</span>
<span class="normal">	</span><span class="keyword">fi</span>

<span class="normal">	</span><span class="keyword">if</span><span class="normal"> </span><span class="keyword">test</span><span class="normal"> -n </span><span class="string">"$vinfo"</span><span class="symbol">;</span><span class="normal"> </span><span class="keyword">then</span>
<span class="normal">	  </span><span class="variable">$echo</span><span class="normal"> </span><span class="string">"$modename: warning: </span><span class="specialchar">\`</span><span class="string">-version-info/-version-number' is ignored for convenience libraries"</span><span class="normal"> </span><span class="number">1</span><span class="symbol">&gt;&amp;</span><span class="number">2</span>
<span class="normal">	</span><span class="keyword">fi</span>

<span class="normal">	</span><span class="keyword">if</span><span class="normal"> </span><span class="keyword">test</span><span class="normal"> -n </span><span class="string">"$release"</span><span class="symbol">;</span><span class="normal"> </span><span class="keyword">then</span>
<span class="normal">	  </span><span class="variable">$echo</span><span class="normal"> </span><span class="string">"$modename: warning: </span><span class="specialchar">\`</span><span class="string">-release' is ignored for convenience libraries"</span><span class="normal"> </span><span class="number">1</span><span class="symbol">&gt;&amp;</span><span class="number">2</span>
<span class="normal">	</span><span class="keyword">fi</span>
<span class="normal">      </span><span class="keyword">else</span>

<span class="normal">	</span><span class="comment"># Parse the version information argument.</span>
<span class="normal">	</span><span class="variable">save_ifs</span><span class="symbol">=</span><span class="string">"$IFS"</span><span class="symbol">;</span><span class="normal"> </span><span class="variable">IFS</span><span class="symbol">=</span><span class="string">':'</span>
<span class="normal">	</span><span class="keyword">set</span><span class="normal"> dummy </span><span class="variable">$vinfo</span><span class="normal"> </span><span class="number">0</span><span class="normal"> </span><span class="number">0</span><span class="normal"> </span><span class="number">0</span>
<span class="normal">	</span><span class="variable">IFS</span><span class="symbol">=</span><span class="string">"$save_ifs"</span>

<span class="normal">	</span><span class="keyword">if</span><span class="normal"> </span><span class="keyword">test</span><span class="normal"> -n </span><span class="string">"$8"</span><span class="symbol">;</span><span class="normal"> </span><span class="keyword">then</span>
<span class="normal">	  </span><span class="variable">$echo</span><span class="normal"> </span><span class="string">"$modename: too many parameters to </span><span class="specialchar">\`</span><span class="string">-version-info'"</span><span class="normal"> </span><span class="number">1</span><span class="symbol">&gt;&amp;</span><span class="number">2</span>
<span class="normal">	  </span><span class="variable">$echo</span><span class="normal"> </span><span class="string">"$help"</span><span class="normal"> </span><span class="number">1</span><span class="symbol">&gt;&amp;</span><span class="number">2</span>
<span class="normal">	  </span><span class="keyword">exit</span><span class="normal"> </span><span class="variable">$EXIT_FAILURE</span>
<span class="normal">	</span><span class="keyword">fi</span>

<span class="normal">	</span><span class="comment"># convert absolute version numbers to libtool ages</span>
<span class="normal">	</span><span class="comment"># this retains compatibility with .la files and attempts</span>
<span class="normal">	</span><span class="comment"># to make the code below a bit more comprehensible</span>

<span class="normal">	</span><span class="keyword">case</span><span class="normal"> </span><span class="variable">$vinfo_number</span><span class="normal"> </span><span class="keyword">in</span>
<span class="normal">	yes</span><span class="symbol">)</span>
<span class="normal">	  </span><span class="variable">number_major</span><span class="symbol">=</span><span class="string">"$2"</span>
<span class="normal">	  </span><span class="variable">number_minor</span><span class="symbol">=</span><span class="string">"$3"</span>
<span class="normal">	  </span><span class="variable">number_revision</span><span class="symbol">=</span><span class="string">"$4"</span>
<span class="normal">	  </span><span class="comment">#</span>
<span class="normal">	  </span><span class="comment"># There are really only two kinds -- those that</span>
<span class="normal">	  </span><span class="comment"># use the current revision as the major version</span>
<span class="normal">	  </span><span class="comment"># and those that subtract age and use age as</span>
<span class="normal">	  </span><span class="comment"># a minor version.  But, then there is irix</span>
<span class="normal">	  </span><span class="comment"># which has an extra 1 added just for fun</span>
<span class="normal">	  </span><span class="comment">#</span>
<span class="normal">	  </span><span class="keyword">case</span><span class="normal"> </span><span class="variable">$version_type</span><span class="normal"> </span><span class="keyword">in</span>
<span class="normal">	  darwin</span><span class="symbol">|</span><span class="normal">linux</span><span class="symbol">|</span><span class="normal">osf</span><span class="symbol">|</span><span class="normal">windows</span><span class="symbol">|</span><span class="normal">none</span><span class="symbol">)</span>
<span class="normal">	    </span><span class="variable">current</span><span class="symbol">=</span><span class="normal">`expr </span><span class="variable">$number_major</span><span class="normal"> </span><span class="symbol">+</span><span class="normal"> </span><span class="variable">$number_minor</span><span class="normal">`</span>
<span class="normal">	    </span><span class="variable">age</span><span class="symbol">=</span><span class="string">"$number_minor"</span>
<span class="normal">	    </span><span class="variable">revision</span><span class="symbol">=</span><span class="string">"$number_revision"</span>
<span class="normal">	    </span><span class="symbol">;;</span>
<span class="normal">	  freebsd-aout</span><span class="symbol">|</span><span class="normal">freebsd-elf</span><span class="symbol">|</span><span class="normal">sunos</span><span class="symbol">)</span>
<span class="normal">	    </span><span class="variable">current</span><span class="symbol">=</span><span class="string">"$number_major"</span>
<span class="normal">	    </span><span class="variable">revision</span><span class="symbol">=</span><span class="string">"$number_minor"</span>
<span class="normal">	    </span><span class="variable">age</span><span class="symbol">=</span><span class="string">"0"</span>
<span class="normal">	    </span><span class="symbol">;;</span>
<span class="normal">	  irix</span><span class="symbol">|</span><span class="normal">nonstopux</span><span class="symbol">)</span>
<span class="normal">	    </span><span class="variable">current</span><span class="symbol">=</span><span class="normal">`expr </span><span class="variable">$number_major</span><span class="normal"> </span><span class="symbol">+</span><span class="normal"> </span><span class="variable">$number_minor</span><span class="normal"> - </span><span class="number">1</span><span class="normal">`</span>
<span class="normal">	    </span><span class="variable">age</span><span class="symbol">=</span><span class="string">"$number_minor"</span>
<span class="normal">	    </span><span class="variable">revision</span><span class="symbol">=</span><span class="string">"$number_minor"</span>
<span class="normal">	    </span><span class="symbol">;;</span>
<span class="normal">	  </span><span class="keyword">esac</span>
<span class="normal">	  </span><span class="symbol">;;</span>
<span class="normal">	no</span><span class="symbol">)</span>
<span class="normal">	  </span><span class="variable">current</span><span class="symbol">=</span><span class="string">"$2"</span>
<span class="normal">	  </span><span class="variable">revision</span><span class="symbol">=</span><span class="string">"$3"</span>
<span class="normal">	  </span><span class="variable">age</span><span class="symbol">=</span><span class="string">"$4"</span>
<span class="normal">	  </span><span class="symbol">;;</span>
<span class="normal">	</span><span class="keyword">esac</span>

<span class="normal">	</span><span class="comment"># Check that each of the things are valid numbers.</span>
<span class="normal">	</span><span class="keyword">case</span><span class="normal"> </span><span class="variable">$current</span><span class="normal"> </span><span class="keyword">in</span>
<span class="normal">	</span><span class="number">0</span><span class="symbol">|[</span><span class="number">1</span><span class="normal">-</span><span class="number">9</span><span class="symbol">]|[</span><span class="number">1</span><span class="normal">-</span><span class="number">9</span><span class="symbol">][</span><span class="number">0</span><span class="normal">-</span><span class="number">9</span><span class="symbol">]|[</span><span class="number">1</span><span class="normal">-</span><span class="number">9</span><span class="symbol">][</span><span class="number">0</span><span class="normal">-</span><span class="number">9</span><span class="symbol">][</span><span class="number">0</span><span class="normal">-</span><span class="number">9</span><span class="symbol">]|[</span><span class="number">1</span><span class="normal">-</span><span class="number">9</span><span class="symbol">][</span><span class="number">0</span><span class="normal">-</span><span class="number">9</span><span class="symbol">][</span><span class="number">0</span><span class="normal">-</span><span class="number">9</span><span class="symbol">][</span><span class="number">0</span><span class="normal">-</span><span class="number">9</span><span class="symbol">]|[</span><span class="number">1</span><span class="normal">-</span><span class="number">9</span><span class="symbol">][</span><span class="number">0</span><span class="normal">-</span><span class="number">9</span><span class="symbol">][</span><span class="number">0</span><span class="normal">-</span><span class="number">9</span><span class="symbol">][</span><span class="number">0</span><span class="normal">-</span><span class="number">9</span><span class="symbol">][</span><span class="number">0</span><span class="normal">-</span><span class="number">9</span><span class="symbol">])</span><span class="normal"> </span><span class="symbol">;;</span>
<span class="normal">	</span><span class="symbol">*)</span>
<span class="normal">	  </span><span class="variable">$echo</span><span class="normal"> </span><span class="string">"$modename: CURRENT </span><span class="specialchar">\`</span><span class="string">$current' must be a nonnegative integer"</span><span class="normal"> </span><span class="number">1</span><span class="symbol">&gt;&amp;</span><span class="number">2</span>
<span class="normal">	  </span><span class="variable">$echo</span><span class="normal"> </span><span class="string">"$modename: </span><span class="specialchar">\`</span><span class="string">$vinfo' is not valid version information"</span><span class="normal"> </span><span class="number">1</span><span class="symbol">&gt;&amp;</span><span class="number">2</span>
<span class="normal">	  </span><span class="keyword">exit</span><span class="normal"> </span><span class="variable">$EXIT_FAILURE</span>
<span class="normal">	  </span><span class="symbol">;;</span>
<span class="normal">	</span><span class="keyword">esac</span>

<span class="normal">	</span><span class="keyword">case</span><span class="normal"> </span><span class="variable">$revision</span><span class="normal"> </span><span class="keyword">in</span>
<span class="normal">	</span><span class="number">0</span><span class="symbol">|[</span><span class="number">1</span><span class="normal">-</span><span class="number">9</span><span class="symbol">]|[</span><span class="number">1</span><span class="normal">-</span><span class="number">9</span><span class="symbol">][</span><span class="number">0</span><span class="normal">-</span><span class="number">9</span><span class="symbol">]|[</span><span class="number">1</span><span class="normal">-</span><span class="number">9</span><span class="symbol">][</span><span class="number">0</span><span class="normal">-</span><span class="number">9</span><span class="symbol">][</span><span class="number">0</span><span class="normal">-</span><span class="number">9</span><span class="symbol">]|[</span><span class="number">1</span><span class="normal">-</span><span class="number">9</span><span class="symbol">][</span><span class="number">0</span><span class="normal">-</span><span class="number">9</span><span class="symbol">][</span><span class="number">0</span><span class="normal">-</span><span class="number">9</span><span class="symbol">][</span><span class="number">0</span><span class="normal">-</span><span class="number">9</span><span class="symbol">]|[</span><span class="number">1</span><span class="normal">-</span><span class="number">9</span><span class="symbol">][</span><span class="number">0</span><span class="normal">-</span><span class="number">9</span><span class="symbol">][</span><span class="number">0</span><span class="normal">-</span><span class="number">9</span><span class="symbol">][</span><span class="number">0</span><span class="normal">-</span><span class="number">9</span><span class="symbol">][</span><span class="number">0</span><span class="normal">-</span><span class="number">9</span><span class="symbol">])</span><span class="normal"> </span><span class="symbol">;;</span>
<span class="normal">	</span><span class="symbol">*)</span>
<span class="normal">	  </span><span class="variable">$echo</span><span class="normal"> </span><span class="string">"$modename: REVISION </span><span class="specialchar">\`</span><span class="string">$revision' must be a nonnegative integer"</span><span class="normal"> </span><span class="number">1</span><span class="symbol">&gt;&amp;</span><span class="number">2</span>
<span class="normal">	  </span><span class="variable">$echo</span><span class="normal"> </span><span class="string">"$modename: </span><span class="specialchar">\`</span><span class="string">$vinfo' is not valid version information"</span><span class="normal"> </span><span class="number">1</span><span class="symbol">&gt;&amp;</span><span class="number">2</span>
<span class="normal">	  </span><span class="keyword">exit</span><span class="normal"> </span><span class="variable">$EXIT_FAILURE</span>
<span class="normal">	  </span><span class="symbol">;;</span>
<span class="normal">	</span><span class="keyword">esac</span>

<span class="normal">	</span><span class="keyword">case</span><span class="normal"> </span><span class="variable">$age</span><span class="normal"> </span><span class="keyword">in</span>
<span class="normal">	</span><span class="number">0</span><span class="symbol">|[</span><span class="number">1</span><span class="normal">-</span><span class="number">9</span><span class="symbol">]|[</span><span class="number">1</span><span class="normal">-</span><span class="number">9</span><span class="symbol">][</span><span class="number">0</span><span class="normal">-</span><span class="number">9</span><span class="symbol">]|[</span><span class="number">1</span><span class="normal">-</span><span class="number">9</span><span class="symbol">][</span><span class="number">0</span><span class="normal">-</span><span class="number">9</span><span class="symbol">][</span><span class="number">0</span><span class="normal">-</span><span class="number">9</span><span class="symbol">]|[</span><span class="number">1</span><span class="normal">-</span><span class="number">9</span><span class="symbol">][</span><span class="number">0</span><span class="normal">-</span><span class="number">9</span><span class="symbol">][</span><span class="number">0</span><span class="normal">-</span><span class="number">9</span><span class="symbol">][</span><span class="number">0</span><span class="normal">-</span><span class="number">9</span><span class="symbol">]|[</span><span class="number">1</span><span class="normal">-</span><span class="number">9</span><span class="symbol">][</span><span class="number">0</span><span class="normal">-</span><span class="number">9</span><span class="symbol">][</span><span class="number">0</span><span class="normal">-</span><span class="number">9</span><span class="symbol">][</span><span class="number">0</span><span class="normal">-</span><span class="number">9</span><span class="symbol">][</span><span class="number">0</span><span class="normal">-</span><span class="number">9</span><span class="symbol">])</span><span class="normal"> </span><span class="symbol">;;</span>
<span class="normal">	</span><span class="symbol">*)</span>
<span class="normal">	  </span><span class="variable">$echo</span><span class="normal"> </span><span class="string">"$modename: AGE </span><span class="specialchar">\`</span><span class="string">$age' must be a nonnegative integer"</span><span class="normal"> </span><span class="number">1</span><span class="symbol">&gt;&amp;</span><span class="number">2</span>
<span class="normal">	  </span><span class="variable">$echo</span><span class="normal"> </span><span class="string">"$modename: </span><span class="specialchar">\`</span><span class="string">$vinfo' is not valid version information"</span><span class="normal"> </span><span class="number">1</span><span class="symbol">&gt;&amp;</span><span class="number">2</span>
<span class="normal">	  </span><span class="keyword">exit</span><span class="normal"> </span><span class="variable">$EXIT_FAILURE</span>
<span class="normal">	  </span><span class="symbol">;;</span>
<span class="normal">	</span><span class="keyword">esac</span>

<span class="normal">	</span><span class="keyword">if</span><span class="normal"> </span><span class="keyword">test</span><span class="normal"> </span><span class="string">"$age"</span><span class="normal"> -gt </span><span class="string">"$current"</span><span class="symbol">;</span><span class="normal"> </span><span class="keyword">then</span>
<span class="normal">	  </span><span class="variable">$echo</span><span class="normal"> </span><span class="string">"$modename: AGE </span><span class="specialchar">\`</span><span class="string">$age' is greater than the current interface number </span><span class="specialchar">\`</span><span class="string">$current'"</span><span class="normal"> </span><span class="number">1</span><span class="symbol">&gt;&amp;</span><span class="number">2</span>
<span class="normal">	  </span><span class="variable">$echo</span><span class="normal"> </span><span class="string">"$modename: </span><span class="specialchar">\`</span><span class="string">$vinfo' is not valid version information"</span><span class="normal"> </span><span class="number">1</span><span class="symbol">&gt;&amp;</span><span class="number">2</span>
<span class="normal">	  </span><span class="keyword">exit</span><span class="normal"> </span><span class="variable">$EXIT_FAILURE</span>
<span class="normal">	</span><span class="keyword">fi</span>

<span class="normal">	</span><span class="comment"># Calculate the version variables.</span>
<span class="normal">	</span><span class="variable">major</span><span class="symbol">=</span>
<span class="normal">	</span><span class="variable">versuffix</span><span class="symbol">=</span>
<span class="normal">	</span><span class="variable">verstring</span><span class="symbol">=</span>
<span class="normal">	</span><span class="keyword">case</span><span class="normal"> </span><span class="variable">$version_type</span><span class="normal"> </span><span class="keyword">in</span>
<span class="normal">	none</span><span class="symbol">)</span><span class="normal"> </span><span class="symbol">;;</span>

<span class="normal">	darwin</span><span class="symbol">)</span>
<span class="normal">	  </span><span class="comment"># Like Linux, but with the current version available in</span>
<span class="normal">	  </span><span class="comment"># verstring for coding it into the library header</span>
<span class="normal">	  </span><span class="variable">major</span><span class="symbol">=.</span><span class="normal">`expr </span><span class="variable">$current</span><span class="normal"> - </span><span class="variable">$age</span><span class="normal">`</span>
<span class="normal">	  </span><span class="variable">versuffix</span><span class="symbol">=</span><span class="string">"$major.$age.$revision"</span>
<span class="normal">	  </span><span class="comment"># Darwin ld doesn't like 0 for these options...</span>
<span class="normal">	  </span><span class="variable">minor_current</span><span class="symbol">=</span><span class="normal">`expr </span><span class="variable">$current</span><span class="normal"> </span><span class="symbol">+</span><span class="normal"> </span><span class="number">1</span><span class="normal">`</span>
<span class="normal">	  </span><span class="variable">verstring</span><span class="symbol">=</span><span class="string">"${wl}-compatibility_version ${wl}$minor_current ${wl}-current_version ${wl}$minor_current.$revision"</span>
<span class="normal">	  </span><span class="symbol">;;</span>

<span class="normal">	freebsd-aout</span><span class="symbol">)</span>
<span class="normal">	  </span><span class="variable">major</span><span class="symbol">=</span><span class="string">".$current"</span>
<span class="normal">	  </span><span class="variable">versuffix</span><span class="symbol">=</span><span class="string">".$current.$revision"</span><span class="symbol">;</span>
<span class="normal">	  </span><span class="symbol">;;</span>

<span class="normal">	freebsd-elf</span><span class="symbol">)</span>
<span class="normal">	  </span><span class="variable">major</span><span class="symbol">=</span><span class="string">".$current"</span>
<span class="normal">	  </span><span class="variable">versuffix</span><span class="symbol">=</span><span class="string">".$current"</span><span class="symbol">;</span>
<span class="normal">	  </span><span class="symbol">;;</span>

<span class="normal">	irix </span><span class="symbol">|</span><span class="normal"> nonstopux</span><span class="symbol">)</span>
<span class="normal">	  </span><span class="variable">major</span><span class="symbol">=</span><span class="normal">`expr </span><span class="variable">$current</span><span class="normal"> - </span><span class="variable">$age</span><span class="normal"> </span><span class="symbol">+</span><span class="normal"> </span><span class="number">1</span><span class="normal">`</span>

<span class="normal">	  </span><span class="keyword">case</span><span class="normal"> </span><span class="variable">$version_type</span><span class="normal"> </span><span class="keyword">in</span>
<span class="normal">	    nonstopux</span><span class="symbol">)</span><span class="normal"> </span><span class="variable">verstring_prefix</span><span class="symbol">=</span><span class="normal">nonstopux </span><span class="symbol">;;</span>
<span class="normal">	    </span><span class="symbol">*)</span><span class="normal">         </span><span class="variable">verstring_prefix</span><span class="symbol">=</span><span class="normal">sgi </span><span class="symbol">;;</span>
<span class="normal">	  </span><span class="keyword">esac</span>
<span class="normal">	  </span><span class="variable">verstring</span><span class="symbol">=</span><span class="string">"$verstring_prefix$major.$revision"</span>

<span class="normal">	  </span><span class="comment"># Add in all the interfaces that we are compatible with.</span>
<span class="normal">	  </span><span class="variable">loop</span><span class="symbol">=</span><span class="variable">$revision</span>
<span class="normal">	  </span><span class="keyword">while</span><span class="normal"> </span><span class="keyword">test</span><span class="normal"> </span><span class="string">"$loop"</span><span class="normal"> -ne </span><span class="number">0</span><span class="symbol">;</span><span class="normal"> </span><span class="keyword">do</span>
<span class="normal">	    </span><span class="variable">iface</span><span class="symbol">=</span><span class="normal">`expr </span><span class="variable">$revision</span><span class="normal"> - </span><span class="variable">$loop</span><span class="normal">`</span>
<span class="normal">	    </span><span class="variable">loop</span><span class="symbol">=</span><span class="normal">`expr </span><span class="variable">$loop</span><span class="normal"> - </span><span class="number">1</span><span class="normal">`</span>
<span class="normal">	    </span><span class="variable">verstring</span><span class="symbol">=</span><span class="string">"$verstring_prefix$major.$iface:$verstring"</span>
<span class="normal">	  </span><span class="keyword">done</span>

<span class="normal">	  </span><span class="comment"># Before this point, $major must not contain `.'.</span>
<span class="normal">	  </span><span class="variable">major</span><span class="symbol">=.</span><span class="variable">$major</span>
<span class="normal">	  </span><span class="variable">versuffix</span><span class="symbol">=</span><span class="string">"$major.$revision"</span>
<span class="normal">	  </span><span class="symbol">;;</span>

<span class="normal">	linux</span><span class="symbol">)</span>
<span class="normal">	  </span><span class="variable">major</span><span class="symbol">=.</span><span class="normal">`expr </span><span class="variable">$current</span><span class="normal"> - </span><span class="variable">$age</span><span class="normal">`</span>
<span class="normal">	  </span><span class="variable">versuffix</span><span class="symbol">=</span><span class="string">"$major.$age.$revision"</span>
<span class="normal">	  </span><span class="symbol">;;</span>

<span class="normal">	osf</span><span class="symbol">)</span>
<span class="normal">	  </span><span class="variable">major</span><span class="symbol">=.</span><span class="normal">`expr </span><span class="variable">$current</span><span class="normal"> - </span><span class="variable">$age</span><span class="normal">`</span>
<span class="normal">	  </span><span class="variable">versuffix</span><span class="symbol">=</span><span class="string">".$current.$age.$revision"</span>
<span class="normal">	  </span><span class="variable">verstring</span><span class="symbol">=</span><span class="string">"$current.$age.$revision"</span>

<span class="normal">	  </span><span class="comment"># Add in all the interfaces that we are compatible with.</span>
<span class="normal">	  </span><span class="variable">loop</span><span class="symbol">=</span><span class="variable">$age</span>
<span class="normal">	  </span><span class="keyword">while</span><span class="normal"> </span><span class="keyword">test</span><span class="normal"> </span><span class="string">"$loop"</span><span class="normal"> -ne </span><span class="number">0</span><span class="symbol">;</span><span class="normal"> </span><span class="keyword">do</span>
<span class="normal">	    </span><span class="variable">iface</span><span class="symbol">=</span><span class="normal">`expr </span><span class="variable">$current</span><span class="normal"> - </span><span class="variable">$loop</span><span class="normal">`</span>
<span class="normal">	    </span><span class="variable">loop</span><span class="symbol">=</span><span class="normal">`expr </span><span class="variable">$loop</span><span class="normal"> - </span><span class="number">1</span><span class="normal">`</span>
<span class="normal">	    </span><span class="variable">verstring</span><span class="symbol">=</span><span class="string">"$verstring:${iface}.0"</span>
<span class="normal">	  </span><span class="keyword">done</span>

<span class="normal">	  </span><span class="comment"># Make executables depend on our current version.</span>
<span class="normal">	  </span><span class="variable">verstring</span><span class="symbol">=</span><span class="string">"$verstring:${current}.0"</span>
<span class="normal">	  </span><span class="symbol">;;</span>

<span class="normal">	sunos</span><span class="symbol">)</span>
<span class="normal">	  </span><span class="variable">major</span><span class="symbol">=</span><span class="string">".$current"</span>
<span class="normal">	  </span><span class="variable">versuffix</span><span class="symbol">=</span><span class="string">".$current.$revision"</span>
<span class="normal">	  </span><span class="symbol">;;</span>

<span class="normal">	windows</span><span class="symbol">)</span>
<span class="normal">	  </span><span class="comment"># Use '-' rather than '.', since we only want one</span>
<span class="normal">	  </span><span class="comment"># extension on DOS 8.3 filesystems.</span>
<span class="normal">	  </span><span class="variable">major</span><span class="symbol">=</span><span class="normal">`expr </span><span class="variable">$current</span><span class="normal"> - </span><span class="variable">$age</span><span class="normal">`</span>
<span class="normal">	  </span><span class="variable">versuffix</span><span class="symbol">=</span><span class="string">"-$major"</span>
<span class="normal">	  </span><span class="symbol">;;</span>

<span class="normal">	</span><span class="symbol">*)</span>
<span class="normal">	  </span><span class="variable">$echo</span><span class="normal"> </span><span class="string">"$modename: unknown library version type </span><span class="specialchar">\`</span><span class="string">$version_type'"</span><span class="normal"> </span><span class="number">1</span><span class="symbol">&gt;&amp;</span><span class="number">2</span>
<span class="normal">	  </span><span class="variable">$echo</span><span class="normal"> </span><span class="string">"Fatal configuration error.  See the $PACKAGE docs for more information."</span><span class="normal"> </span><span class="number">1</span><span class="symbol">&gt;&amp;</span><span class="number">2</span>
<span class="normal">	  </span><span class="keyword">exit</span><span class="normal"> </span><span class="variable">$EXIT_FAILURE</span>
<span class="normal">	  </span><span class="symbol">;;</span>
<span class="normal">	</span><span class="keyword">esac</span>

<span class="normal">	</span><span class="comment"># Clear the version info if we defaulted, and they specified a release.</span>
<span class="normal">	</span><span class="keyword">if</span><span class="normal"> </span><span class="keyword">test</span><span class="normal"> -z </span><span class="string">"$vinfo"</span><span class="normal"> </span><span class="symbol">&amp;&amp;</span><span class="normal"> </span><span class="keyword">test</span><span class="normal"> -n </span><span class="string">"$release"</span><span class="symbol">;</span><span class="normal"> </span><span class="keyword">then</span>
<span class="normal">	  </span><span class="variable">major</span><span class="symbol">=</span>
<span class="normal">	  </span><span class="keyword">case</span><span class="normal"> </span><span class="variable">$version_type</span><span class="normal"> </span><span class="keyword">in</span>
<span class="normal">	  darwin</span><span class="symbol">)</span>
<span class="normal">	    </span><span class="comment"># we can't check for "0.0" in archive_cmds due to quoting</span>
<span class="normal">	    </span><span class="comment"># problems, so we reset it completely</span>
<span class="normal">	    </span><span class="variable">verstring</span><span class="symbol">=</span>
<span class="normal">	    </span><span class="symbol">;;</span>
<span class="normal">	  </span><span class="symbol">*)</span>
<span class="normal">	    </span><span class="variable">verstring</span><span class="symbol">=</span><span class="string">"0.0"</span>
<span class="normal">	    </span><span class="symbol">;;</span>
<span class="normal">	  </span><span class="keyword">esac</span>
<span class="normal">	  </span><span class="keyword">if</span><span class="normal"> </span><span class="keyword">test</span><span class="normal"> </span><span class="string">"$need_version"</span><span class="normal"> </span><span class="symbol">=</span><span class="normal"> no</span><span class="symbol">;</span><span class="normal"> </span><span class="keyword">then</span>
<span class="normal">	    </span><span class="variable">versuffix</span><span class="symbol">=</span>
<span class="normal">	  </span><span class="keyword">else</span>
<span class="normal">	    </span><span class="variable">versuffix</span><span class="symbol">=</span><span class="string">".0.0"</span>
<span class="normal">	  </span><span class="keyword">fi</span>
<span class="normal">	</span><span class="keyword">fi</span>

<span class="normal">	</span><span class="comment"># Remove version info from name if versioning should be avoided</span>
<span class="normal">	</span><span class="keyword">if</span><span class="normal"> </span><span class="keyword">test</span><span class="normal"> </span><span class="string">"$avoid_version"</span><span class="normal"> </span><span class="symbol">=</span><span class="normal"> yes </span><span class="symbol">&amp;&amp;</span><span class="normal"> </span><span class="keyword">test</span><span class="normal"> </span><span class="string">"$need_version"</span><span class="normal"> </span><span class="symbol">=</span><span class="normal"> no</span><span class="symbol">;</span><span class="normal"> </span><span class="keyword">then</span>
<span class="normal">	  </span><span class="variable">major</span><span class="symbol">=</span>
<span class="normal">	  </span><span class="variable">versuffix</span><span class="symbol">=</span>
<span class="normal">	  </span><span class="variable">verstring</span><span class="symbol">=</span><span class="string">""</span>
<span class="normal">	</span><span class="keyword">fi</span>

<span class="normal">	</span><span class="comment"># Check to see if the archive will have undefined symbols.</span>
<span class="normal">	</span><span class="keyword">if</span><span class="normal"> </span><span class="keyword">test</span><span class="normal"> </span><span class="string">"$allow_undefined"</span><span class="normal"> </span><span class="symbol">=</span><span class="normal"> yes</span><span class="symbol">;</span><span class="normal"> </span><span class="keyword">then</span>
<span class="normal">	  </span><span class="keyword">if</span><span class="normal"> </span><span class="keyword">test</span><span class="normal"> </span><span class="string">"$allow_undefined_flag"</span><span class="normal"> </span><span class="symbol">=</span><span class="normal"> unsupported</span><span class="symbol">;</span><span class="normal"> </span><span class="keyword">then</span>
<span class="normal">	    </span><span class="variable">$echo</span><span class="normal"> </span><span class="string">"$modename: warning: undefined symbols not allowed in $host shared libraries"</span><span class="normal"> </span><span class="number">1</span><span class="symbol">&gt;&amp;</span><span class="number">2</span>
<span class="normal">	    </span><span class="variable">build_libtool_libs</span><span class="symbol">=</span><span class="normal">no</span>
<span class="normal">	    </span><span class="variable">build_old_libs</span><span class="symbol">=</span><span class="normal">yes</span>
<span class="normal">	  </span><span class="keyword">fi</span>
<span class="normal">	</span><span class="keyword">else</span>
<span class="normal">	  </span><span class="comment"># Don't allow undefined symbols.</span>
<span class="normal">	  </span><span class="variable">allow_undefined_flag</span><span class="symbol">=</span><span class="string">"$no_undefined_flag"</span>
<span class="normal">	</span><span class="keyword">fi</span>
<span class="normal">      </span><span class="keyword">fi</span>

<span class="normal">      </span><span class="keyword">if</span><span class="normal"> </span><span class="keyword">test</span><span class="normal"> </span><span class="string">"$mode"</span><span class="normal"> </span><span class="symbol">!=</span><span class="normal"> relink</span><span class="symbol">;</span><span class="normal"> </span><span class="keyword">then</span>
<span class="normal">	</span><span class="comment"># Remove our outputs, but don't remove object files since they</span>
<span class="normal">	</span><span class="comment"># may have been created when compiling PIC objects.</span>
<span class="normal">	</span><span class="variable">removelist</span><span class="symbol">=</span>
<span class="normal">	</span><span class="variable">tempremovelist</span><span class="symbol">=</span><span class="normal">`</span><span class="variable">$echo</span><span class="normal"> </span><span class="string">"$output_objdir/*"</span><span class="normal">`</span>
<span class="normal">	</span><span class="keyword">for</span><span class="normal"> p </span><span class="keyword">in</span><span class="normal"> </span><span class="variable">$tempremovelist</span><span class="symbol">;</span><span class="normal"> </span><span class="keyword">do</span>
<span class="normal">	  </span><span class="keyword">case</span><span class="normal"> </span><span class="variable">$p</span><span class="normal"> </span><span class="keyword">in</span>
<span class="normal">	    </span><span class="symbol">*.</span><span class="variable">$objext</span><span class="symbol">)</span>
<span class="normal">	       </span><span class="symbol">;;</span>
<span class="normal">	    </span><span class="variable">$output_objdir</span><span class="symbol">/</span><span class="variable">$outputname</span><span class="normal"> </span><span class="symbol">|</span><span class="normal"> </span><span class="variable">$output_objdir</span><span class="symbol">/</span><span class="variable">$libname</span><span class="symbol">.*</span><span class="normal"> </span><span class="symbol">|</span><span class="normal"> </span><span class="variable">$output_objdir</span><span class="symbol">/</span><span class="variable">${libname}${release}</span><span class="symbol">.*)</span>
<span class="normal">	       </span><span class="keyword">if</span><span class="normal"> </span><span class="keyword">test</span><span class="normal"> </span><span class="string">"X$precious_files_regex"</span><span class="normal"> </span><span class="symbol">!=</span><span class="normal"> </span><span class="string">"X"</span><span class="symbol">;</span><span class="normal"> </span><span class="keyword">then</span>
<span class="normal">	         </span><span class="keyword">if</span><span class="normal"> echo </span><span class="variable">$p</span><span class="normal"> </span><span class="symbol">|</span><span class="normal"> </span><span class="variable">$EGREP</span><span class="normal"> -e </span><span class="string">"$precious_files_regex"</span><span class="normal"> </span><span class="symbol">&gt;</span><span class="normal">/dev/null </span><span class="number">2</span><span class="symbol">&gt;&amp;</span><span class="number">1</span>
<span class="normal">	         </span><span class="keyword">then</span>
<span class="normal">		   </span><span class="keyword">continue</span>
<span class="normal">		 </span><span class="keyword">fi</span>
<span class="normal">	       </span><span class="keyword">fi</span>
<span class="normal">	       </span><span class="variable">removelist</span><span class="symbol">=</span><span class="string">"$removelist $p"</span>
<span class="normal">	       </span><span class="symbol">;;</span>
<span class="normal">	    </span><span class="symbol">*)</span><span class="normal"> </span><span class="symbol">;;</span>
<span class="normal">	  </span><span class="keyword">esac</span>
<span class="normal">	</span><span class="keyword">done</span>
<span class="normal">	</span><span class="keyword">if</span><span class="normal"> </span><span class="keyword">test</span><span class="normal"> -n </span><span class="string">"$removelist"</span><span class="symbol">;</span><span class="normal"> </span><span class="keyword">then</span>
<span class="normal">	  </span><span class="variable">$show</span><span class="normal"> </span><span class="string">"${rm}r $removelist"</span>
<span class="normal">	  </span><span class="variable">$run</span><span class="normal"> </span><span class="variable">${rm}</span><span class="normal">r </span><span class="variable">$removelist</span>
<span class="normal">	</span><span class="keyword">fi</span>
<span class="normal">      </span><span class="keyword">fi</span>

<span class="normal">      </span><span class="comment"># Now set the variables for building old libraries.</span>
<span class="normal">      </span><span class="keyword">if</span><span class="normal"> </span><span class="keyword">test</span><span class="normal"> </span><span class="string">"$build_old_libs"</span><span class="normal"> </span><span class="symbol">=</span><span class="normal"> yes </span><span class="symbol">&amp;&amp;</span><span class="normal"> </span><span class="keyword">test</span><span class="normal"> </span><span class="string">"$build_libtool_libs"</span><span class="normal"> </span><span class="symbol">!=</span><span class="normal"> convenience </span><span class="symbol">;</span><span class="normal"> </span><span class="keyword">then</span>
<span class="normal">	</span><span class="variable">oldlibs</span><span class="symbol">=</span><span class="string">"$oldlibs $output_objdir/$libname.$libext"</span>

<span class="normal">	</span><span class="comment"># Transform .lo files to .o files.</span>
<span class="normal">	</span><span class="variable">oldobjs</span><span class="symbol">=</span><span class="string">"$objs "</span><span class="normal">`</span><span class="variable">$echo</span><span class="normal"> </span><span class="string">"X$libobjs"</span><span class="normal"> </span><span class="symbol">|</span><span class="normal"> </span><span class="variable">$SP2NL</span><span class="normal"> </span><span class="symbol">|</span><span class="normal"> </span><span class="variable">$Xsed</span><span class="normal"> -e </span><span class="string">'/</span><span class="specialchar">\.</span><span class="string">'</span><span class="variable">${libext}</span><span class="string">'$/d'</span><span class="normal"> -e </span><span class="string">"$lo2o"</span><span class="normal"> </span><span class="symbol">|</span><span class="normal"> </span><span class="variable">$NL2SP</span><span class="normal">`</span>
<span class="normal">      </span><span class="keyword">fi</span>

<span class="normal">      </span><span class="comment"># Eliminate all temporary directories.</span>
<span class="normal">      </span><span class="comment">#for path in $notinst_path; do</span>
<span class="normal">      </span><span class="comment">#	lib_search_path=`$echo "$lib_search_path " | ${SED} -e "s% $path % %g"`</span>
<span class="normal">      </span><span class="comment">#	deplibs=`$echo "$deplibs " | ${SED} -e "s% -L$path % %g"`</span>
<span class="normal">      </span><span class="comment">#	dependency_libs=`$echo "$dependency_libs " | ${SED} -e "s% -L$path % %g"`</span>
<span class="normal">      </span><span class="comment">#done</span>

<span class="normal">      </span><span class="keyword">if</span><span class="normal"> </span><span class="keyword">test</span><span class="normal"> -n </span><span class="string">"$xrpath"</span><span class="symbol">;</span><span class="normal"> </span><span class="keyword">then</span>
<span class="normal">	</span><span class="comment"># If the user specified any rpath flags, then add them.</span>
<span class="normal">	</span><span class="variable">temp_xrpath</span><span class="symbol">=</span>
<span class="normal">	</span><span class="keyword">for</span><span class="normal"> libdir </span><span class="keyword">in</span><span class="normal"> </span><span class="variable">$xrpath</span><span class="symbol">;</span><span class="normal"> </span><span class="keyword">do</span>
<span class="normal">	  </span><span class="variable">temp_xrpath</span><span class="symbol">=</span><span class="string">"$temp_xrpath -R$libdir"</span>
<span class="normal">	  </span><span class="keyword">case</span><span class="normal"> </span><span class="string">"$finalize_rpath "</span><span class="normal"> </span><span class="keyword">in</span>
<span class="normal">	  </span><span class="symbol">*</span><span class="string">" $libdir "</span><span class="symbol">*)</span><span class="normal"> </span><span class="symbol">;;</span>
<span class="normal">	  </span><span class="symbol">*)</span><span class="normal"> </span><span class="variable">finalize_rpath</span><span class="symbol">=</span><span class="string">"$finalize_rpath $libdir"</span><span class="normal"> </span><span class="symbol">;;</span>
<span class="normal">	  </span><span class="keyword">esac</span>
<span class="normal">	</span><span class="keyword">done</span>
<span class="normal">	</span><span class="keyword">if</span><span class="normal"> </span><span class="keyword">test</span><span class="normal"> </span><span class="string">"$hardcode_into_libs"</span><span class="normal"> </span><span class="symbol">!=</span><span class="normal"> yes </span><span class="symbol">||</span><span class="normal"> </span><span class="keyword">test</span><span class="normal"> </span><span class="string">"$build_old_libs"</span><span class="normal"> </span><span class="symbol">=</span><span class="normal"> yes</span><span class="symbol">;</span><span class="normal"> </span><span class="keyword">then</span>
<span class="normal">	  </span><span class="variable">dependency_libs</span><span class="symbol">=</span><span class="string">"$temp_xrpath $dependency_libs"</span>
<span class="normal">	</span><span class="keyword">fi</span>
<span class="normal">      </span><span class="keyword">fi</span>

<span class="normal">      </span><span class="comment"># Make sure dlfiles contains only unique files that won't be dlpreopened</span>
<span class="normal">      </span><span class="variable">old_dlfiles</span><span class="symbol">=</span><span class="string">"$dlfiles"</span>
<span class="normal">      </span><span class="variable">dlfiles</span><span class="symbol">=</span>
<span class="normal">      </span><span class="keyword">for</span><span class="normal"> lib </span><span class="keyword">in</span><span class="normal"> </span><span class="variable">$old_dlfiles</span><span class="symbol">;</span><span class="normal"> </span><span class="keyword">do</span>
<span class="normal">	</span><span class="keyword">case</span><span class="normal"> </span><span class="string">" $dlprefiles $dlfiles "</span><span class="normal"> </span><span class="keyword">in</span>
<span class="normal">	</span><span class="symbol">*</span><span class="string">" $lib "</span><span class="symbol">*)</span><span class="normal"> </span><span class="symbol">;;</span>
<span class="normal">	</span><span class="symbol">*)</span><span class="normal"> </span><span class="variable">dlfiles</span><span class="symbol">=</span><span class="string">"$dlfiles $lib"</span><span class="normal"> </span><span class="symbol">;;</span>
<span class="normal">	</span><span class="keyword">esac</span>
<span class="normal">      </span><span class="keyword">done</span>

<span class="normal">      </span><span class="comment"># Make sure dlprefiles contains only unique files</span>
<span class="normal">      </span><span class="variable">old_dlprefiles</span><span class="symbol">=</span><span class="string">"$dlprefiles"</span>
<span class="normal">      </span><span class="variable">dlprefiles</span><span class="symbol">=</span>
<span class="normal">      </span><span class="keyword">for</span><span class="normal"> lib </span><span class="keyword">in</span><span class="normal"> </span><span class="variable">$old_dlprefiles</span><span class="symbol">;</span><span class="normal"> </span><span class="keyword">do</span>
<span class="normal">	</span><span class="keyword">case</span><span class="normal"> </span><span class="string">"$dlprefiles "</span><span class="normal"> </span><span class="keyword">in</span>
<span class="normal">	</span><span class="symbol">*</span><span class="string">" $lib "</span><span class="symbol">*)</span><span class="normal"> </span><span class="symbol">;;</span>
<span class="normal">	</span><span class="symbol">*)</span><span class="normal"> </span><span class="variable">dlprefiles</span><span class="symbol">=</span><span class="string">"$dlprefiles $lib"</span><span class="normal"> </span><span class="symbol">;;</span>
<span class="normal">	</span><span class="keyword">esac</span>
<span class="normal">      </span><span class="keyword">done</span>

<span class="normal">      </span><span class="keyword">if</span><span class="normal"> </span><span class="keyword">test</span><span class="normal"> </span><span class="string">"$build_libtool_libs"</span><span class="normal"> </span><span class="symbol">=</span><span class="normal"> yes</span><span class="symbol">;</span><span class="normal"> </span><span class="keyword">then</span>
<span class="normal">	</span><span class="keyword">if</span><span class="normal"> </span><span class="keyword">test</span><span class="normal"> -n </span><span class="string">"$rpath"</span><span class="symbol">;</span><span class="normal"> </span><span class="keyword">then</span>
<span class="normal">	  </span><span class="keyword">case</span><span class="normal"> </span><span class="variable">$host</span><span class="normal"> </span><span class="keyword">in</span>
<span class="normal">	  </span><span class="symbol">*</span><span class="normal">-</span><span class="symbol">*</span><span class="normal">-cygwin</span><span class="symbol">*</span><span class="normal"> </span><span class="symbol">|</span><span class="normal"> </span><span class="symbol">*</span><span class="normal">-</span><span class="symbol">*</span><span class="normal">-mingw</span><span class="symbol">*</span><span class="normal"> </span><span class="symbol">|</span><span class="normal"> </span><span class="symbol">*</span><span class="normal">-</span><span class="symbol">*</span><span class="normal">-pw</span><span class="number">32</span><span class="symbol">*</span><span class="normal"> </span><span class="symbol">|</span><span class="normal"> </span><span class="symbol">*</span><span class="normal">-</span><span class="symbol">*</span><span class="normal">-os</span><span class="number">2</span><span class="symbol">*</span><span class="normal"> </span><span class="symbol">|</span><span class="normal"> </span><span class="symbol">*</span><span class="normal">-</span><span class="symbol">*</span><span class="normal">-beos</span><span class="symbol">*)</span>
<span class="normal">	    </span><span class="comment"># these systems don't actually have a c library (as such)!</span>
<span class="normal">	    </span><span class="symbol">;;</span>
<span class="normal">	  </span><span class="symbol">*</span><span class="normal">-</span><span class="symbol">*</span><span class="normal">-rhapsody</span><span class="symbol">*</span><span class="normal"> </span><span class="symbol">|</span><span class="normal"> </span><span class="symbol">*</span><span class="normal">-</span><span class="symbol">*</span><span class="normal">-darwin</span><span class="number">1</span><span class="symbol">.[</span><span class="number">012</span><span class="symbol">])</span>
<span class="normal">	    </span><span class="comment"># Rhapsody C library is in the System framework</span>
<span class="normal">	    </span><span class="variable">deplibs</span><span class="symbol">=</span><span class="string">"$deplibs -framework System"</span>
<span class="normal">	    </span><span class="symbol">;;</span>
<span class="normal">	  </span><span class="symbol">*</span><span class="normal">-</span><span class="symbol">*</span><span class="normal">-netbsd</span><span class="symbol">*)</span>
<span class="normal">	    </span><span class="comment"># Don't link with libc until the a.out ld.so is fixed.</span>
<span class="normal">	    </span><span class="symbol">;;</span>
<span class="normal">	  </span><span class="symbol">*</span><span class="normal">-</span><span class="symbol">*</span><span class="normal">-openbsd</span><span class="symbol">*</span><span class="normal"> </span><span class="symbol">|</span><span class="normal"> </span><span class="symbol">*</span><span class="normal">-</span><span class="symbol">*</span><span class="normal">-freebsd</span><span class="symbol">*</span><span class="normal"> </span><span class="symbol">|</span><span class="normal"> </span><span class="symbol">*</span><span class="normal">-</span><span class="symbol">*</span><span class="normal">-dragonfly</span><span class="symbol">*)</span>
<span class="normal">	    </span><span class="comment"># Do not include libc due to us having libc/libc_r.</span>
<span class="normal">	    </span><span class="symbol">;;</span>
<span class="normal">	  </span><span class="symbol">*</span><span class="normal">-</span><span class="symbol">*</span><span class="normal">-sco</span><span class="number">3</span><span class="symbol">.</span><span class="normal">2v5</span><span class="symbol">*</span><span class="normal"> </span><span class="symbol">|</span><span class="normal"> </span><span class="symbol">*</span><span class="normal">-</span><span class="symbol">*</span><span class="normal">-sco5v6</span><span class="symbol">*)</span>
<span class="normal">	    </span><span class="comment"># Causes problems with __ctype</span>
<span class="normal">	    </span><span class="symbol">;;</span>
<span class="normal">	  </span><span class="symbol">*</span><span class="normal">-</span><span class="symbol">*</span><span class="normal">-sysv</span><span class="number">4</span><span class="symbol">.</span><span class="normal">2uw2</span><span class="symbol">*</span><span class="normal"> </span><span class="symbol">|</span><span class="normal"> </span><span class="symbol">*</span><span class="normal">-</span><span class="symbol">*</span><span class="normal">-sysv</span><span class="number">5</span><span class="symbol">*</span><span class="normal"> </span><span class="symbol">|</span><span class="normal"> </span><span class="symbol">*</span><span class="normal">-</span><span class="symbol">*</span><span class="normal">-unixware</span><span class="symbol">*</span><span class="normal"> </span><span class="symbol">|</span><span class="normal"> </span><span class="symbol">*</span><span class="normal">-</span><span class="symbol">*</span><span class="normal">-OpenUNIX</span><span class="symbol">*)</span>
<span class="normal">	    </span><span class="comment"># Compiler inserts libc in the correct place for threads to work</span>
<span class="normal">	    </span><span class="symbol">;;</span>
<span class="normal"> 	  </span><span class="symbol">*)</span>
<span class="normal">	    </span><span class="comment"># Add libc to deplibs on all other systems if necessary.</span>
<span class="normal">	    </span><span class="keyword">if</span><span class="normal"> </span><span class="keyword">test</span><span class="normal"> </span><span class="string">"$build_libtool_need_lc"</span><span class="normal"> </span><span class="symbol">=</span><span class="normal"> </span><span class="string">"yes"</span><span class="symbol">;</span><span class="normal"> </span><span class="keyword">then</span>
<span class="normal">	      </span><span class="variable">deplibs</span><span class="symbol">=</span><span class="string">"$deplibs -lc"</span>
<span class="normal">	    </span><span class="keyword">fi</span>
<span class="normal">	    </span><span class="symbol">;;</span>
<span class="normal">	  </span><span class="keyword">esac</span>
<span class="normal">	</span><span class="keyword">fi</span>

<span class="normal">	</span><span class="comment"># Transform deplibs into only deplibs that can be linked in shared.</span>
<span class="normal">	</span><span class="variable">name_save</span><span class="symbol">=</span><span class="variable">$name</span>
<span class="normal">	</span><span class="variable">libname_save</span><span class="symbol">=</span><span class="variable">$libname</span>
<span class="normal">	</span><span class="variable">release_save</span><span class="symbol">=</span><span class="variable">$release</span>
<span class="normal">	</span><span class="variable">versuffix_save</span><span class="symbol">=</span><span class="variable">$versuffix</span>
<span class="normal">	</span><span class="variable">major_save</span><span class="symbol">=</span><span class="variable">$major</span>
<span class="normal">	</span><span class="comment"># I'm not sure if I'm treating the release correctly.  I think</span>
<span class="normal">	</span><span class="comment"># release should show up in the -l (ie -lgmp5) so we don't want to</span>
<span class="normal">	</span><span class="comment"># add it in twice.  Is that correct?</span>
<span class="normal">	</span><span class="variable">release</span><span class="symbol">=</span><span class="string">""</span>
<span class="normal">	</span><span class="variable">versuffix</span><span class="symbol">=</span><span class="string">""</span>
<span class="normal">	</span><span class="variable">major</span><span class="symbol">=</span><span class="string">""</span>
<span class="normal">	</span><span class="variable">newdeplibs</span><span class="symbol">=</span>
<span class="normal">	</span><span class="variable">droppeddeps</span><span class="symbol">=</span><span class="normal">no</span>
<span class="normal">	</span><span class="keyword">case</span><span class="normal"> </span><span class="variable">$deplibs_check_method</span><span class="normal"> </span><span class="keyword">in</span>
<span class="normal">	pass_all</span><span class="symbol">)</span>
<span class="normal">	  </span><span class="comment"># Don't check for shared/static.  Everything works.</span>
<span class="normal">	  </span><span class="comment"># This might be a little naive.  We might want to check</span>
<span class="normal">	  </span><span class="comment"># whether the library exists or not.  But this is on</span>
<span class="normal">	  </span><span class="comment"># osf3 &amp; osf4 and I'm not really sure... Just</span>
<span class="normal">	  </span><span class="comment"># implementing what was already the behavior.</span>
<span class="normal">	  </span><span class="variable">newdeplibs</span><span class="symbol">=</span><span class="variable">$deplibs</span>
<span class="normal">	  </span><span class="symbol">;;</span>
<span class="normal">	test_compile</span><span class="symbol">)</span>
<span class="normal">	  </span><span class="comment"># This code stresses the "libraries are programs" paradigm to its</span>
<span class="normal">	  </span><span class="comment"># limits. Maybe even breaks it.  We compile a program, linking it</span>
<span class="normal">	  </span><span class="comment"># against the deplibs as a proxy for the library.  Then we can check</span>
<span class="normal">	  </span><span class="comment"># whether they linked in statically or dynamically with ldd.</span>
<span class="normal">	  </span><span class="variable">$rm</span><span class="normal"> conftest</span><span class="symbol">.</span><span class="normal">c</span>
<span class="normal">	  cat </span><span class="symbol">&gt;</span><span class="normal"> conftest</span><span class="symbol">.</span><span class="normal">c </span><span class="symbol">&lt;&lt;</span><span class="normal">EOF</span>
<span class="normal">	  int </span><span class="function">main()</span><span class="normal"> { </span><span class="keyword">return</span><span class="normal"> </span><span class="number">0</span><span class="symbol">;</span><span class="normal"> }</span>
<span class="normal">EOF</span>
<span class="normal">	  </span><span class="variable">$rm</span><span class="normal"> conftest</span>
<span class="normal">	  </span><span class="keyword">if</span><span class="normal"> </span><span class="variable">$LTCC</span><span class="normal"> </span><span class="variable">$LTCFLAGS</span><span class="normal"> -o conftest conftest</span><span class="symbol">.</span><span class="normal">c </span><span class="variable">$deplibs</span><span class="symbol">;</span><span class="normal"> </span><span class="keyword">then</span>
<span class="normal">	    </span><span class="variable">ldd_output</span><span class="symbol">=</span><span class="normal">`ldd conftest`</span>
<span class="normal">	    </span><span class="keyword">for</span><span class="normal"> i </span><span class="keyword">in</span><span class="normal"> </span><span class="variable">$deplibs</span><span class="symbol">;</span><span class="normal"> </span><span class="keyword">do</span>
<span class="normal">	      </span><span class="variable">name</span><span class="symbol">=</span><span class="normal">`expr </span><span class="variable">$i</span><span class="normal"> </span><span class="symbol">:</span><span class="normal"> </span><span class="string">'-l</span><span class="specialchar">\(</span><span class="string">.*</span><span class="specialchar">\)</span><span class="string">'</span><span class="normal">`</span>
<span class="normal">	      </span><span class="comment"># If $name is empty we are operating on a -L argument.</span>
<span class="normal">              </span><span class="keyword">if</span><span class="normal"> </span><span class="keyword">test</span><span class="normal"> </span><span class="string">"$name"</span><span class="normal"> </span><span class="symbol">!=</span><span class="normal"> </span><span class="string">""</span><span class="normal"> </span><span class="symbol">&amp;&amp;</span><span class="normal"> </span><span class="keyword">test</span><span class="normal"> </span><span class="string">"$name"</span><span class="normal"> </span><span class="symbol">!=</span><span class="normal"> </span><span class="string">"0"</span><span class="symbol">;</span><span class="normal"> </span><span class="keyword">then</span>
<span class="normal">		</span><span class="keyword">if</span><span class="normal"> </span><span class="keyword">test</span><span class="normal"> </span><span class="string">"X$allow_libtool_libs_with_static_runtimes"</span><span class="normal"> </span><span class="symbol">=</span><span class="normal"> </span><span class="string">"Xyes"</span><span class="normal"> </span><span class="symbol">;</span><span class="normal"> </span><span class="keyword">then</span>
<span class="normal">		  </span><span class="keyword">case</span><span class="normal"> </span><span class="string">" $predeps $postdeps "</span><span class="normal"> </span><span class="keyword">in</span>
<span class="normal">		  </span><span class="symbol">*</span><span class="string">" $i "</span><span class="symbol">*)</span>
<span class="normal">		    </span><span class="variable">newdeplibs</span><span class="symbol">=</span><span class="string">"$newdeplibs $i"</span>
<span class="normal">		    </span><span class="variable">i</span><span class="symbol">=</span><span class="string">""</span>
<span class="normal">		    </span><span class="symbol">;;</span>
<span class="normal">		  </span><span class="keyword">esac</span>
<span class="normal">	        </span><span class="keyword">fi</span>
<span class="normal">		</span><span class="keyword">if</span><span class="normal"> </span><span class="keyword">test</span><span class="normal"> -n </span><span class="string">"$i"</span><span class="normal"> </span><span class="symbol">;</span><span class="normal"> </span><span class="keyword">then</span>
<span class="normal">		  </span><span class="variable">libname</span><span class="symbol">=</span><span class="normal">`</span><span class="keyword">eval</span><span class="normal"> </span><span class="symbol">\\</span><span class="variable">$echo</span><span class="normal"> \"</span><span class="variable">$libname_spec</span><span class="normal">\"`</span>
<span class="normal">		  </span><span class="variable">deplib_matches</span><span class="symbol">=</span><span class="normal">`</span><span class="keyword">eval</span><span class="normal"> </span><span class="symbol">\\</span><span class="variable">$echo</span><span class="normal"> \"</span><span class="variable">$library_names_spec</span><span class="normal">\"`</span>
<span class="normal">		  </span><span class="keyword">set</span><span class="normal"> dummy </span><span class="variable">$deplib_matches</span>
<span class="normal">		  </span><span class="variable">deplib_match</span><span class="symbol">=</span><span class="variable">$2</span>
<span class="normal">		  </span><span class="keyword">if</span><span class="normal"> </span><span class="keyword">test</span><span class="normal"> `expr </span><span class="string">"$ldd_output"</span><span class="normal"> </span><span class="symbol">:</span><span class="normal"> </span><span class="string">".*$deplib_match"</span><span class="normal">` -ne </span><span class="number">0</span><span class="normal"> </span><span class="symbol">;</span><span class="normal"> </span><span class="keyword">then</span>
<span class="normal">		    </span><span class="variable">newdeplibs</span><span class="symbol">=</span><span class="string">"$newdeplibs $i"</span>
<span class="normal">		  </span><span class="keyword">else</span>
<span class="normal">		    </span><span class="variable">droppeddeps</span><span class="symbol">=</span><span class="normal">yes</span>
<span class="normal">		    </span><span class="variable">$echo</span>
<span class="normal">		    </span><span class="variable">$echo</span><span class="normal"> </span><span class="string">"*** Warning: dynamic linker does not accept needed library $i."</span>
<span class="normal">		    </span><span class="variable">$echo</span><span class="normal"> </span><span class="string">"*** I have the capability to make that library automatically link in when"</span>
<span class="normal">		    </span><span class="variable">$echo</span><span class="normal"> </span><span class="string">"*** you link to this library.  But I can only do this if you have a"</span>
<span class="normal">		    </span><span class="variable">$echo</span><span class="normal"> </span><span class="string">"*** shared version of the library, which I believe you do not have"</span>
<span class="normal">		    </span><span class="variable">$echo</span><span class="normal"> </span><span class="string">"*** because a test_compile did reveal that the linker did not use it for"</span>
<span class="normal">		    </span><span class="variable">$echo</span><span class="normal"> </span><span class="string">"*** its dynamic dependency list that programs get resolved with at runtime."</span>
<span class="normal">		  </span><span class="keyword">fi</span>
<span class="normal">		</span><span class="keyword">fi</span>
<span class="normal">	      </span><span class="keyword">else</span>
<span class="normal">		</span><span class="variable">newdeplibs</span><span class="symbol">=</span><span class="string">"$newdeplibs $i"</span>
<span class="normal">	      </span><span class="keyword">fi</span>
<span class="normal">	    </span><span class="keyword">done</span>
<span class="normal">	  </span><span class="keyword">else</span>
<span class="normal">	    </span><span class="comment"># Error occurred in the first compile.  Let's try to salvage</span>
<span class="normal">	    </span><span class="comment"># the situation: Compile a separate program for each library.</span>
<span class="normal">	    </span><span class="keyword">for</span><span class="normal"> i </span><span class="keyword">in</span><span class="normal"> </span><span class="variable">$deplibs</span><span class="symbol">;</span><span class="normal"> </span><span class="keyword">do</span>
<span class="normal">	      </span><span class="variable">name</span><span class="symbol">=</span><span class="normal">`expr </span><span class="variable">$i</span><span class="normal"> </span><span class="symbol">:</span><span class="normal"> </span><span class="string">'-l</span><span class="specialchar">\(</span><span class="string">.*</span><span class="specialchar">\)</span><span class="string">'</span><span class="normal">`</span>
<span class="normal">	      </span><span class="comment"># If $name is empty we are operating on a -L argument.</span>
<span class="normal">              </span><span class="keyword">if</span><span class="normal"> </span><span class="keyword">test</span><span class="normal"> </span><span class="string">"$name"</span><span class="normal"> </span><span class="symbol">!=</span><span class="normal"> </span><span class="string">""</span><span class="normal"> </span><span class="symbol">&amp;&amp;</span><span class="normal"> </span><span class="keyword">test</span><span class="normal"> </span><span class="string">"$name"</span><span class="normal"> </span><span class="symbol">!=</span><span class="normal"> </span><span class="string">"0"</span><span class="symbol">;</span><span class="normal"> </span><span class="keyword">then</span>
<span class="normal">		</span><span class="variable">$rm</span><span class="normal"> conftest</span>
<span class="normal">		</span><span class="keyword">if</span><span class="normal"> </span><span class="variable">$LTCC</span><span class="normal"> </span><span class="variable">$LTCFLAGS</span><span class="normal"> -o conftest conftest</span><span class="symbol">.</span><span class="normal">c </span><span class="variable">$i</span><span class="symbol">;</span><span class="normal"> </span><span class="keyword">then</span>
<span class="normal">		  </span><span class="variable">ldd_output</span><span class="symbol">=</span><span class="normal">`ldd conftest`</span>
<span class="normal">		  </span><span class="keyword">if</span><span class="normal"> </span><span class="keyword">test</span><span class="normal"> </span><span class="string">"X$allow_libtool_libs_with_static_runtimes"</span><span class="normal"> </span><span class="symbol">=</span><span class="normal"> </span><span class="string">"Xyes"</span><span class="normal"> </span><span class="symbol">;</span><span class="normal"> </span><span class="keyword">then</span>
<span class="normal">		    </span><span class="keyword">case</span><span class="normal"> </span><span class="string">" $predeps $postdeps "</span><span class="normal"> </span><span class="keyword">in</span>
<span class="normal">		    </span><span class="symbol">*</span><span class="string">" $i "</span><span class="symbol">*)</span>
<span class="normal">		      </span><span class="variable">newdeplibs</span><span class="symbol">=</span><span class="string">"$newdeplibs $i"</span>
<span class="normal">		      </span><span class="variable">i</span><span class="symbol">=</span><span class="string">""</span>
<span class="normal">		      </span><span class="symbol">;;</span>
<span class="normal">		    </span><span class="keyword">esac</span>
<span class="normal">		  </span><span class="keyword">fi</span>
<span class="normal">		  </span><span class="keyword">if</span><span class="normal"> </span><span class="keyword">test</span><span class="normal"> -n </span><span class="string">"$i"</span><span class="normal"> </span><span class="symbol">;</span><span class="normal"> </span><span class="keyword">then</span>
<span class="normal">		    </span><span class="variable">libname</span><span class="symbol">=</span><span class="normal">`</span><span class="keyword">eval</span><span class="normal"> </span><span class="symbol">\\</span><span class="variable">$echo</span><span class="normal"> \"</span><span class="variable">$libname_spec</span><span class="normal">\"`</span>
<span class="normal">		    </span><span class="variable">deplib_matches</span><span class="symbol">=</span><span class="normal">`</span><span class="keyword">eval</span><span class="normal"> </span><span class="symbol">\\</span><span class="variable">$echo</span><span class="normal"> \"</span><span class="variable">$library_names_spec</span><span class="normal">\"`</span>
<span class="normal">		    </span><span class="keyword">set</span><span class="normal"> dummy </span><span class="variable">$deplib_matches</span>
<span class="normal">		    </span><span class="variable">deplib_match</span><span class="symbol">=</span><span class="variable">$2</span>
<span class="normal">		    </span><span class="keyword">if</span><span class="normal"> </span><span class="keyword">test</span><span class="normal"> `expr </span><span class="string">"$ldd_output"</span><span class="normal"> </span><span class="symbol">:</span><span class="normal"> </span><span class="string">".*$deplib_match"</span><span class="normal">` -ne </span><span class="number">0</span><span class="normal"> </span><span class="symbol">;</span><span class="normal"> </span><span class="keyword">then</span>
<span class="normal">		      </span><span class="variable">newdeplibs</span><span class="symbol">=</span><span class="string">"$newdeplibs $i"</span>
<span class="normal">		    </span><span class="keyword">else</span>
<span class="normal">		      </span><span class="variable">droppeddeps</span><span class="symbol">=</span><span class="normal">yes</span>
<span class="normal">		      </span><span class="variable">$echo</span>
<span class="normal">		      </span><span class="variable">$echo</span><span class="normal"> </span><span class="string">"*** Warning: dynamic linker does not accept needed library $i."</span>
<span class="normal">		      </span><span class="variable">$echo</span><span class="normal"> </span><span class="string">"*** I have the capability to make that library automatically link in when"</span>
<span class="normal">		      </span><span class="variable">$echo</span><span class="normal"> </span><span class="string">"*** you link to this library.  But I can only do this if you have a"</span>
<span class="normal">		      </span><span class="variable">$echo</span><span class="normal"> </span><span class="string">"*** shared version of the library, which you do not appear to have"</span>
<span class="normal">		      </span><span class="variable">$echo</span><span class="normal"> </span><span class="string">"*** because a test_compile did reveal that the linker did not use this one"</span>
<span class="normal">		      </span><span class="variable">$echo</span><span class="normal"> </span><span class="string">"*** as a dynamic dependency that programs can get resolved with at runtime."</span>
<span class="normal">		    </span><span class="keyword">fi</span>
<span class="normal">		  </span><span class="keyword">fi</span>
<span class="normal">		</span><span class="keyword">else</span>
<span class="normal">		  </span><span class="variable">droppeddeps</span><span class="symbol">=</span><span class="normal">yes</span>
<span class="normal">		  </span><span class="variable">$echo</span>
<span class="normal">		  </span><span class="variable">$echo</span><span class="normal"> </span><span class="string">"*** Warning!  Library $i is needed by this library but I was not able to"</span>
<span class="normal">		  </span><span class="variable">$echo</span><span class="normal"> </span><span class="string">"*** make it link in!  You will probably need to install it or some"</span>
<span class="normal">		  </span><span class="variable">$echo</span><span class="normal"> </span><span class="string">"*** library that it depends on before this library will be fully"</span>
<span class="normal">		  </span><span class="variable">$echo</span><span class="normal"> </span><span class="string">"*** functional.  Installing it before continuing would be even better."</span>
<span class="normal">		</span><span class="keyword">fi</span>
<span class="normal">	      </span><span class="keyword">else</span>
<span class="normal">		</span><span class="variable">newdeplibs</span><span class="symbol">=</span><span class="string">"$newdeplibs $i"</span>
<span class="normal">	      </span><span class="keyword">fi</span>
<span class="normal">	    </span><span class="keyword">done</span>
<span class="normal">	  </span><span class="keyword">fi</span>
<span class="normal">	  </span><span class="symbol">;;</span>
<span class="normal">	file_magic</span><span class="symbol">*)</span>
<span class="normal">	  </span><span class="keyword">set</span><span class="normal"> dummy </span><span class="variable">$deplibs_check_method</span>
<span class="normal">	  </span><span class="variable">file_magic_regex</span><span class="symbol">=</span><span class="normal">`expr </span><span class="string">"$deplibs_check_method"</span><span class="normal"> </span><span class="symbol">:</span><span class="normal"> </span><span class="string">"$2 </span><span class="specialchar">\(</span><span class="string">.*</span><span class="specialchar">\)</span><span class="string">"</span><span class="normal">`</span>
<span class="normal">	  </span><span class="keyword">for</span><span class="normal"> a_deplib </span><span class="keyword">in</span><span class="normal"> </span><span class="variable">$deplibs</span><span class="symbol">;</span><span class="normal"> </span><span class="keyword">do</span>
<span class="normal">	    </span><span class="variable">name</span><span class="symbol">=</span><span class="normal">`expr </span><span class="variable">$a_deplib</span><span class="normal"> </span><span class="symbol">:</span><span class="normal"> </span><span class="string">'-l</span><span class="specialchar">\(</span><span class="string">.*</span><span class="specialchar">\)</span><span class="string">'</span><span class="normal">`</span>
<span class="normal">	    </span><span class="comment"># If $name is empty we are operating on a -L argument.</span>
<span class="normal">            </span><span class="keyword">if</span><span class="normal"> </span><span class="keyword">test</span><span class="normal"> </span><span class="string">"$name"</span><span class="normal"> </span><span class="symbol">!=</span><span class="normal"> </span><span class="string">""</span><span class="normal"> </span><span class="symbol">&amp;&amp;</span><span class="normal"> </span><span class="keyword">test</span><span class="normal">  </span><span class="string">"$name"</span><span class="normal"> </span><span class="symbol">!=</span><span class="normal"> </span><span class="string">"0"</span><span class="symbol">;</span><span class="normal"> </span><span class="keyword">then</span>
<span class="normal">	      </span><span class="keyword">if</span><span class="normal"> </span><span class="keyword">test</span><span class="normal"> </span><span class="string">"X$allow_libtool_libs_with_static_runtimes"</span><span class="normal"> </span><span class="symbol">=</span><span class="normal"> </span><span class="string">"Xyes"</span><span class="normal"> </span><span class="symbol">;</span><span class="normal"> </span><span class="keyword">then</span>
<span class="normal">		</span><span class="keyword">case</span><span class="normal"> </span><span class="string">" $predeps $postdeps "</span><span class="normal"> </span><span class="keyword">in</span>
<span class="normal">		</span><span class="symbol">*</span><span class="string">" $a_deplib "</span><span class="symbol">*)</span>
<span class="normal">		  </span><span class="variable">newdeplibs</span><span class="symbol">=</span><span class="string">"$newdeplibs $a_deplib"</span>
<span class="normal">		  </span><span class="variable">a_deplib</span><span class="symbol">=</span><span class="string">""</span>
<span class="normal">		  </span><span class="symbol">;;</span>
<span class="normal">		</span><span class="keyword">esac</span>
<span class="normal">	      </span><span class="keyword">fi</span>
<span class="normal">	      </span><span class="keyword">if</span><span class="normal"> </span><span class="keyword">test</span><span class="normal"> -n </span><span class="string">"$a_deplib"</span><span class="normal"> </span><span class="symbol">;</span><span class="normal"> </span><span class="keyword">then</span>
<span class="normal">		</span><span class="variable">libname</span><span class="symbol">=</span><span class="normal">`</span><span class="keyword">eval</span><span class="normal"> </span><span class="symbol">\\</span><span class="variable">$echo</span><span class="normal"> \"</span><span class="variable">$libname_spec</span><span class="normal">\"`</span>
<span class="normal">		</span><span class="keyword">for</span><span class="normal"> i </span><span class="keyword">in</span><span class="normal"> </span><span class="variable">$lib_search_path</span><span class="normal"> </span><span class="variable">$sys_lib_search_path</span><span class="normal"> </span><span class="variable">$shlib_search_path</span><span class="symbol">;</span><span class="normal"> </span><span class="keyword">do</span>
<span class="normal">		  </span><span class="variable">potential_libs</span><span class="symbol">=</span><span class="normal">`ls </span><span class="variable">$i</span><span class="symbol">/</span><span class="variable">$libname</span><span class="symbol">[.</span><span class="normal">-</span><span class="symbol">]*</span><span class="normal"> </span><span class="number">2</span><span class="symbol">&gt;</span><span class="normal">/dev/null`</span>
<span class="normal">		  </span><span class="keyword">for</span><span class="normal"> potent_lib </span><span class="keyword">in</span><span class="normal"> </span><span class="variable">$potential_libs</span><span class="symbol">;</span><span class="normal"> </span><span class="keyword">do</span>
<span class="normal">		      </span><span class="comment"># Follow soft links.</span>
<span class="normal">		      </span><span class="keyword">if</span><span class="normal"> ls -lLd </span><span class="string">"$potent_lib"</span><span class="normal"> </span><span class="number">2</span><span class="symbol">&gt;</span><span class="normal">/dev/null </span><span class="symbol">\</span>
<span class="normal">			 </span><span class="symbol">|</span><span class="normal"> grep </span><span class="string">" -&gt; "</span><span class="normal"> </span><span class="symbol">&gt;</span><span class="normal">/dev/null</span><span class="symbol">;</span><span class="normal"> </span><span class="keyword">then</span>
<span class="normal">			</span><span class="keyword">continue</span>
<span class="normal">		      </span><span class="keyword">fi</span>
<span class="normal">		      </span><span class="comment"># The statement above tries to avoid entering an</span>
<span class="normal">		      </span><span class="comment"># endless loop below, in case of cyclic links.</span>
<span class="normal">		      </span><span class="comment"># We might still enter an endless loop, since a link</span>
<span class="normal">		      </span><span class="comment"># loop can be closed while we follow links,</span>
<span class="normal">		      </span><span class="comment"># but so what?</span>
<span class="normal">		      </span><span class="variable">potlib</span><span class="symbol">=</span><span class="string">"$potent_lib"</span>
<span class="normal">		      </span><span class="keyword">while</span><span class="normal"> </span><span class="keyword">test</span><span class="normal"> -h </span><span class="string">"$potlib"</span><span class="normal"> </span><span class="number">2</span><span class="symbol">&gt;</span><span class="normal">/dev/null</span><span class="symbol">;</span><span class="normal"> </span><span class="keyword">do</span>
<span class="normal">			</span><span class="variable">potliblink</span><span class="symbol">=</span><span class="normal">`ls -ld </span><span class="variable">$potlib</span><span class="normal"> </span><span class="symbol">|</span><span class="normal"> </span><span class="variable">${SED}</span><span class="normal"> </span><span class="string">'s/.* -&gt; //'</span><span class="normal">`</span>
<span class="normal">			</span><span class="keyword">case</span><span class="normal"> </span><span class="variable">$potliblink</span><span class="normal"> </span><span class="keyword">in</span>
<span class="normal">			</span><span class="symbol">[\\/]*</span><span class="normal"> </span><span class="symbol">|</span><span class="normal"> </span><span class="symbol">[</span><span class="normal">A-Za-z</span><span class="symbol">]:[\\/]*)</span><span class="normal"> </span><span class="variable">potlib</span><span class="symbol">=</span><span class="string">"$potliblink"</span><span class="symbol">;;</span>
<span class="normal">			</span><span class="symbol">*)</span><span class="normal"> </span><span class="variable">potlib</span><span class="symbol">=</span><span class="normal">`</span><span class="variable">$echo</span><span class="normal"> </span><span class="string">"X$potlib"</span><span class="normal"> </span><span class="symbol">|</span><span class="normal"> </span><span class="variable">$Xsed</span><span class="normal"> -e </span><span class="string">'s,[^/]*$,,'</span><span class="normal">`</span><span class="string">"$potliblink"</span><span class="symbol">;;</span>
<span class="normal">			</span><span class="keyword">esac</span>
<span class="normal">		      </span><span class="keyword">done</span>
<span class="normal">		      </span><span class="keyword">if</span><span class="normal"> </span><span class="keyword">eval</span><span class="normal"> </span><span class="variable">$file_magic_cmd</span><span class="normal"> \"</span><span class="symbol">\</span><span class="variable">$potlib</span><span class="normal">\" </span><span class="number">2</span><span class="symbol">&gt;</span><span class="normal">/dev/null </span><span class="symbol">\</span>
<span class="normal">			 </span><span class="symbol">|</span><span class="normal"> </span><span class="variable">${SED}</span><span class="normal"> 10q </span><span class="symbol">\</span>
<span class="normal">			 </span><span class="symbol">|</span><span class="normal"> </span><span class="variable">$EGREP</span><span class="normal"> </span><span class="string">"$file_magic_regex"</span><span class="normal"> </span><span class="symbol">&gt;</span><span class="normal"> /dev/null</span><span class="symbol">;</span><span class="normal"> </span><span class="keyword">then</span>
<span class="normal">			</span><span class="variable">newdeplibs</span><span class="symbol">=</span><span class="string">"$newdeplibs $a_deplib"</span>
<span class="normal">			</span><span class="variable">a_deplib</span><span class="symbol">=</span><span class="string">""</span>
<span class="normal">			</span><span class="keyword">break</span><span class="normal"> </span><span class="number">2</span>
<span class="normal">		      </span><span class="keyword">fi</span>
<span class="normal">		  </span><span class="keyword">done</span>
<span class="normal">		</span><span class="keyword">done</span>
<span class="normal">	      </span><span class="keyword">fi</span>
<span class="normal">	      </span><span class="keyword">if</span><span class="normal"> </span><span class="keyword">test</span><span class="normal"> -n </span><span class="string">"$a_deplib"</span><span class="normal"> </span><span class="symbol">;</span><span class="normal"> </span><span class="keyword">then</span>
<span class="normal">		</span><span class="variable">droppeddeps</span><span class="symbol">=</span><span class="normal">yes</span>
<span class="normal">		</span><span class="variable">$echo</span>
<span class="normal">		</span><span class="variable">$echo</span><span class="normal"> </span><span class="string">"*** Warning: linker path does not have real file for library $a_deplib."</span>
<span class="normal">		</span><span class="variable">$echo</span><span class="normal"> </span><span class="string">"*** I have the capability to make that library automatically link in when"</span>
<span class="normal">		</span><span class="variable">$echo</span><span class="normal"> </span><span class="string">"*** you link to this library.  But I can only do this if you have a"</span>
<span class="normal">		</span><span class="variable">$echo</span><span class="normal"> </span><span class="string">"*** shared version of the library, which you do not appear to have"</span>
<span class="normal">		</span><span class="variable">$echo</span><span class="normal"> </span><span class="string">"*** because I did check the linker path looking for a file starting"</span>
<span class="normal">		</span><span class="keyword">if</span><span class="normal"> </span><span class="keyword">test</span><span class="normal"> -z </span><span class="string">"$potlib"</span><span class="normal"> </span><span class="symbol">;</span><span class="normal"> </span><span class="keyword">then</span>
<span class="normal">		  </span><span class="variable">$echo</span><span class="normal"> </span><span class="string">"*** with $libname but no candidates were found. (...for file magic test)"</span>
<span class="normal">		</span><span class="keyword">else</span>
<span class="normal">		  </span><span class="variable">$echo</span><span class="normal"> </span><span class="string">"*** with $libname and none of the candidates passed a file format test"</span>
<span class="normal">		  </span><span class="variable">$echo</span><span class="normal"> </span><span class="string">"*** using a file magic. Last file checked: $potlib"</span>
<span class="normal">		</span><span class="keyword">fi</span>
<span class="normal">	      </span><span class="keyword">fi</span>
<span class="normal">	    </span><span class="keyword">else</span>
<span class="normal">	      </span><span class="comment"># Add a -L argument.</span>
<span class="normal">	      </span><span class="variable">newdeplibs</span><span class="symbol">=</span><span class="string">"$newdeplibs $a_deplib"</span>
<span class="normal">	    </span><span class="keyword">fi</span>
<span class="normal">	  </span><span class="keyword">done</span><span class="normal"> </span><span class="comment"># Gone through all deplibs.</span>
<span class="normal">	  </span><span class="symbol">;;</span>
<span class="normal">	match_pattern</span><span class="symbol">*)</span>
<span class="normal">	  </span><span class="keyword">set</span><span class="normal"> dummy </span><span class="variable">$deplibs_check_method</span>
<span class="normal">	  </span><span class="variable">match_pattern_regex</span><span class="symbol">=</span><span class="normal">`expr </span><span class="string">"$deplibs_check_method"</span><span class="normal"> </span><span class="symbol">:</span><span class="normal"> </span><span class="string">"$2 </span><span class="specialchar">\(</span><span class="string">.*</span><span class="specialchar">\)</span><span class="string">"</span><span class="normal">`</span>
<span class="normal">	  </span><span class="keyword">for</span><span class="normal"> a_deplib </span><span class="keyword">in</span><span class="normal"> </span><span class="variable">$deplibs</span><span class="symbol">;</span><span class="normal"> </span><span class="keyword">do</span>
<span class="normal">	    </span><span class="variable">name</span><span class="symbol">=</span><span class="normal">`expr </span><span class="variable">$a_deplib</span><span class="normal"> </span><span class="symbol">:</span><span class="normal"> </span><span class="string">'-l</span><span class="specialchar">\(</span><span class="string">.*</span><span class="specialchar">\)</span><span class="string">'</span><span class="normal">`</span>
<span class="normal">	    </span><span class="comment"># If $name is empty we are operating on a -L argument.</span>
<span class="normal">	    </span><span class="keyword">if</span><span class="normal"> </span><span class="keyword">test</span><span class="normal"> -n </span><span class="string">"$name"</span><span class="normal"> </span><span class="symbol">&amp;&amp;</span><span class="normal"> </span><span class="keyword">test</span><span class="normal"> </span><span class="string">"$name"</span><span class="normal"> </span><span class="symbol">!=</span><span class="normal"> </span><span class="string">"0"</span><span class="symbol">;</span><span class="normal"> </span><span class="keyword">then</span>
<span class="normal">	      </span><span class="keyword">if</span><span class="normal"> </span><span class="keyword">test</span><span class="normal"> </span><span class="string">"X$allow_libtool_libs_with_static_runtimes"</span><span class="normal"> </span><span class="symbol">=</span><span class="normal"> </span><span class="string">"Xyes"</span><span class="normal"> </span><span class="symbol">;</span><span class="normal"> </span><span class="keyword">then</span>
<span class="normal">		</span><span class="keyword">case</span><span class="normal"> </span><span class="string">" $predeps $postdeps "</span><span class="normal"> </span><span class="keyword">in</span>
<span class="normal">		</span><span class="symbol">*</span><span class="string">" $a_deplib "</span><span class="symbol">*)</span>
<span class="normal">		  </span><span class="variable">newdeplibs</span><span class="symbol">=</span><span class="string">"$newdeplibs $a_deplib"</span>
<span class="normal">		  </span><span class="variable">a_deplib</span><span class="symbol">=</span><span class="string">""</span>
<span class="normal">		  </span><span class="symbol">;;</span>
<span class="normal">		</span><span class="keyword">esac</span>
<span class="normal">	      </span><span class="keyword">fi</span>
<span class="normal">	      </span><span class="keyword">if</span><span class="normal"> </span><span class="keyword">test</span><span class="normal"> -n </span><span class="string">"$a_deplib"</span><span class="normal"> </span><span class="symbol">;</span><span class="normal"> </span><span class="keyword">then</span>
<span class="normal">		</span><span class="variable">libname</span><span class="symbol">=</span><span class="normal">`</span><span class="keyword">eval</span><span class="normal"> </span><span class="symbol">\\</span><span class="variable">$echo</span><span class="normal"> \"</span><span class="variable">$libname_spec</span><span class="normal">\"`</span>
<span class="normal">		</span><span class="keyword">for</span><span class="normal"> i </span><span class="keyword">in</span><span class="normal"> </span><span class="variable">$lib_search_path</span><span class="normal"> </span><span class="variable">$sys_lib_search_path</span><span class="normal"> </span><span class="variable">$shlib_search_path</span><span class="symbol">;</span><span class="normal"> </span><span class="keyword">do</span>
<span class="normal">		  </span><span class="variable">potential_libs</span><span class="symbol">=</span><span class="normal">`ls </span><span class="variable">$i</span><span class="symbol">/</span><span class="variable">$libname</span><span class="symbol">[.</span><span class="normal">-</span><span class="symbol">]*</span><span class="normal"> </span><span class="number">2</span><span class="symbol">&gt;</span><span class="normal">/dev/null`</span>
<span class="normal">		  </span><span class="keyword">for</span><span class="normal"> potent_lib </span><span class="keyword">in</span><span class="normal"> </span><span class="variable">$potential_libs</span><span class="symbol">;</span><span class="normal"> </span><span class="keyword">do</span>
<span class="normal">		    </span><span class="variable">potlib</span><span class="symbol">=</span><span class="string">"$potent_lib"</span><span class="normal"> </span><span class="comment"># see symlink-check above in file_magic test</span>
<span class="normal">		    </span><span class="keyword">if</span><span class="normal"> </span><span class="keyword">eval</span><span class="normal"> </span><span class="variable">$echo</span><span class="normal"> \"</span><span class="variable">$potent_lib</span><span class="normal">\" </span><span class="number">2</span><span class="symbol">&gt;</span><span class="normal">/dev/null </span><span class="symbol">\</span>
<span class="normal">		        </span><span class="symbol">|</span><span class="normal"> </span><span class="variable">${SED}</span><span class="normal"> 10q </span><span class="symbol">\</span>
<span class="normal">		        </span><span class="symbol">|</span><span class="normal"> </span><span class="variable">$EGREP</span><span class="normal"> </span><span class="string">"$match_pattern_regex"</span><span class="normal"> </span><span class="symbol">&gt;</span><span class="normal"> /dev/null</span><span class="symbol">;</span><span class="normal"> </span><span class="keyword">then</span>
<span class="normal">		      </span><span class="variable">newdeplibs</span><span class="symbol">=</span><span class="string">"$newdeplibs $a_deplib"</span>
<span class="normal">		      </span><span class="variable">a_deplib</span><span class="symbol">=</span><span class="string">""</span>
<span class="normal">		      </span><span class="keyword">break</span><span class="normal"> </span><span class="number">2</span>
<span class="normal">		    </span><span class="keyword">fi</span>
<span class="normal">		  </span><span class="keyword">done</span>
<span class="normal">		</span><span class="keyword">done</span>
<span class="normal">	      </span><span class="keyword">fi</span>
<span class="normal">	      </span><span class="keyword">if</span><span class="normal"> </span><span class="keyword">test</span><span class="normal"> -n </span><span class="string">"$a_deplib"</span><span class="normal"> </span><span class="symbol">;</span><span class="normal"> </span><span class="keyword">then</span>
<span class="normal">		</span><span class="variable">droppeddeps</span><span class="symbol">=</span><span class="normal">yes</span>
<span class="normal">		</span><span class="variable">$echo</span>
<span class="normal">		</span><span class="variable">$echo</span><span class="normal"> </span><span class="string">"*** Warning: linker path does not have real file for library $a_deplib."</span>
<span class="normal">		</span><span class="variable">$echo</span><span class="normal"> </span><span class="string">"*** I have the capability to make that library automatically link in when"</span>
<span class="normal">		</span><span class="variable">$echo</span><span class="normal"> </span><span class="string">"*** you link to this library.  But I can only do this if you have a"</span>
<span class="normal">		</span><span class="variable">$echo</span><span class="normal"> </span><span class="string">"*** shared version of the library, which you do not appear to have"</span>
<span class="normal">		</span><span class="variable">$echo</span><span class="normal"> </span><span class="string">"*** because I did check the linker path looking for a file starting"</span>
<span class="normal">		</span><span class="keyword">if</span><span class="normal"> </span><span class="keyword">test</span><span class="normal"> -z </span><span class="string">"$potlib"</span><span class="normal"> </span><span class="symbol">;</span><span class="normal"> </span><span class="keyword">then</span>
<span class="normal">		  </span><span class="variable">$echo</span><span class="normal"> </span><span class="string">"*** with $libname but no candidates were found. (...for regex pattern test)"</span>
<span class="normal">		</span><span class="keyword">else</span>
<span class="normal">		  </span><span class="variable">$echo</span><span class="normal"> </span><span class="string">"*** with $libname and none of the candidates passed a file format test"</span>
<span class="normal">		  </span><span class="variable">$echo</span><span class="normal"> </span><span class="string">"*** using a regex pattern. Last file checked: $potlib"</span>
<span class="normal">		</span><span class="keyword">fi</span>
<span class="normal">	      </span><span class="keyword">fi</span>
<span class="normal">	    </span><span class="keyword">else</span>
<span class="normal">	      </span><span class="comment"># Add a -L argument.</span>
<span class="normal">	      </span><span class="variable">newdeplibs</span><span class="symbol">=</span><span class="string">"$newdeplibs $a_deplib"</span>
<span class="normal">	    </span><span class="keyword">fi</span>
<span class="normal">	  </span><span class="keyword">done</span><span class="normal"> </span><span class="comment"># Gone through all deplibs.</span>
<span class="normal">	  </span><span class="symbol">;;</span>
<span class="normal">	none </span><span class="symbol">|</span><span class="normal"> unknown </span><span class="symbol">|</span><span class="normal"> </span><span class="symbol">*)</span>
<span class="normal">	  </span><span class="variable">newdeplibs</span><span class="symbol">=</span><span class="string">""</span>
<span class="normal">	  </span><span class="variable">tmp_deplibs</span><span class="symbol">=</span><span class="normal">`</span><span class="variable">$echo</span><span class="normal"> </span><span class="string">"X $deplibs"</span><span class="normal"> </span><span class="symbol">|</span><span class="normal"> </span><span class="variable">$Xsed</span><span class="normal"> -e </span><span class="string">'s/ -lc$//'</span><span class="normal"> </span><span class="symbol">\</span>
<span class="normal">	    -e </span><span class="string">'s/ -[LR][^ ]*//g'</span><span class="normal">`</span>
<span class="normal">	  </span><span class="keyword">if</span><span class="normal"> </span><span class="keyword">test</span><span class="normal"> </span><span class="string">"X$allow_libtool_libs_with_static_runtimes"</span><span class="normal"> </span><span class="symbol">=</span><span class="normal"> </span><span class="string">"Xyes"</span><span class="normal"> </span><span class="symbol">;</span><span class="normal"> </span><span class="keyword">then</span>
<span class="normal">	    </span><span class="keyword">for</span><span class="normal"> i </span><span class="keyword">in</span><span class="normal"> </span><span class="variable">$predeps</span><span class="normal"> </span><span class="variable">$postdeps</span><span class="normal"> </span><span class="symbol">;</span><span class="normal"> </span><span class="keyword">do</span>
<span class="normal">	      </span><span class="comment"># can't use Xsed below, because $i might contain '/'</span>
<span class="normal">	      </span><span class="variable">tmp_deplibs</span><span class="symbol">=</span><span class="normal">`</span><span class="variable">$echo</span><span class="normal"> </span><span class="string">"X $tmp_deplibs"</span><span class="normal"> </span><span class="symbol">|</span><span class="normal"> </span><span class="variable">${SED}</span><span class="normal"> -e </span><span class="string">"1s,^X,,"</span><span class="normal"> -e </span><span class="string">"s,$i,,"</span><span class="normal">`</span>
<span class="normal">	    </span><span class="keyword">done</span>
<span class="normal">	  </span><span class="keyword">fi</span>
<span class="normal">	  </span><span class="keyword">if</span><span class="normal"> </span><span class="variable">$echo</span><span class="normal"> </span><span class="string">"X $tmp_deplibs"</span><span class="normal"> </span><span class="symbol">|</span><span class="normal"> </span><span class="variable">$Xsed</span><span class="normal"> -e </span><span class="string">'s/[ 	]//g'</span><span class="normal"> </span><span class="symbol">\</span>
<span class="normal">	    </span><span class="symbol">|</span><span class="normal"> grep </span><span class="symbol">.</span><span class="normal"> </span><span class="symbol">&gt;</span><span class="normal">/dev/null</span><span class="symbol">;</span><span class="normal"> </span><span class="keyword">then</span>
<span class="normal">	    </span><span class="variable">$echo</span>
<span class="normal">	    </span><span class="keyword">if</span><span class="normal"> </span><span class="keyword">test</span><span class="normal"> </span><span class="string">"X$deplibs_check_method"</span><span class="normal"> </span><span class="symbol">=</span><span class="normal"> </span><span class="string">"Xnone"</span><span class="symbol">;</span><span class="normal"> </span><span class="keyword">then</span>
<span class="normal">	      </span><span class="variable">$echo</span><span class="normal"> </span><span class="string">"*** Warning: inter-library dependencies are not supported in this platform."</span>
<span class="normal">	    </span><span class="keyword">else</span>
<span class="normal">	      </span><span class="variable">$echo</span><span class="normal"> </span><span class="string">"*** Warning: inter-library dependencies are not known to be supported."</span>
<span class="normal">	    </span><span class="keyword">fi</span>
<span class="normal">	    </span><span class="variable">$echo</span><span class="normal"> </span><span class="string">"*** All declared inter-library dependencies are being dropped."</span>
<span class="normal">	    </span><span class="variable">droppeddeps</span><span class="symbol">=</span><span class="normal">yes</span>
<span class="normal">	  </span><span class="keyword">fi</span>
<span class="normal">	  </span><span class="symbol">;;</span>
<span class="normal">	</span><span class="keyword">esac</span>
<span class="normal">	</span><span class="variable">versuffix</span><span class="symbol">=</span><span class="variable">$versuffix_save</span>
<span class="normal">	</span><span class="variable">major</span><span class="symbol">=</span><span class="variable">$major_save</span>
<span class="normal">	</span><span class="variable">release</span><span class="symbol">=</span><span class="variable">$release_save</span>
<span class="normal">	</span><span class="variable">libname</span><span class="symbol">=</span><span class="variable">$libname_save</span>
<span class="normal">	</span><span class="variable">name</span><span class="symbol">=</span><span class="variable">$name_save</span>

<span class="normal">	</span><span class="keyword">case</span><span class="normal"> </span><span class="variable">$host</span><span class="normal"> </span><span class="keyword">in</span>
<span class="normal">	</span><span class="symbol">*</span><span class="normal">-</span><span class="symbol">*</span><span class="normal">-rhapsody</span><span class="symbol">*</span><span class="normal"> </span><span class="symbol">|</span><span class="normal"> </span><span class="symbol">*</span><span class="normal">-</span><span class="symbol">*</span><span class="normal">-darwin</span><span class="number">1</span><span class="symbol">.[</span><span class="number">012</span><span class="symbol">])</span>
<span class="normal">	  </span><span class="comment"># On Rhapsody replace the C library is the System framework</span>
<span class="normal">	  </span><span class="variable">newdeplibs</span><span class="symbol">=</span><span class="normal">`</span><span class="variable">$echo</span><span class="normal"> </span><span class="string">"X $newdeplibs"</span><span class="normal"> </span><span class="symbol">|</span><span class="normal"> </span><span class="variable">$Xsed</span><span class="normal"> -e </span><span class="string">'s/ -lc / -framework System /'</span><span class="normal">`</span>
<span class="normal">	  </span><span class="symbol">;;</span>
<span class="normal">	</span><span class="keyword">esac</span>

<span class="normal">	</span><span class="keyword">if</span><span class="normal"> </span><span class="keyword">test</span><span class="normal"> </span><span class="string">"$droppeddeps"</span><span class="normal"> </span><span class="symbol">=</span><span class="normal"> yes</span><span class="symbol">;</span><span class="normal"> </span><span class="keyword">then</span>
<span class="normal">	  </span><span class="keyword">if</span><span class="normal"> </span><span class="keyword">test</span><span class="normal"> </span><span class="string">"$module"</span><span class="normal"> </span><span class="symbol">=</span><span class="normal"> yes</span><span class="symbol">;</span><span class="normal"> </span><span class="keyword">then</span>
<span class="normal">	    </span><span class="variable">$echo</span>
<span class="normal">	    </span><span class="variable">$echo</span><span class="normal"> </span><span class="string">"*** Warning: libtool could not satisfy all declared inter-library"</span>
<span class="normal">	    </span><span class="variable">$echo</span><span class="normal"> </span><span class="string">"*** dependencies of module $libname.  Therefore, libtool will create"</span>
<span class="normal">	    </span><span class="variable">$echo</span><span class="normal"> </span><span class="string">"*** a static module, that should work as long as the dlopening"</span>
<span class="normal">	    </span><span class="variable">$echo</span><span class="normal"> </span><span class="string">"*** application is linked with the -dlopen flag."</span>
<span class="normal">	    </span><span class="keyword">if</span><span class="normal"> </span><span class="keyword">test</span><span class="normal"> -z </span><span class="string">"$global_symbol_pipe"</span><span class="symbol">;</span><span class="normal"> </span><span class="keyword">then</span>
<span class="normal">	      </span><span class="variable">$echo</span>
<span class="normal">	      </span><span class="variable">$echo</span><span class="normal"> </span><span class="string">"*** However, this would only work if libtool was able to extract symbol"</span>
<span class="normal">	      </span><span class="variable">$echo</span><span class="normal"> </span><span class="string">"*** lists from a program, using </span><span class="specialchar">\`</span><span class="string">nm' or equivalent, but libtool could"</span>
<span class="normal">	      </span><span class="variable">$echo</span><span class="normal"> </span><span class="string">"*** not find such a program.  So, this module is probably useless."</span>
<span class="normal">	      </span><span class="variable">$echo</span><span class="normal"> </span><span class="string">"*** </span><span class="specialchar">\`</span><span class="string">nm' from GNU binutils and a full rebuild may help."</span>
<span class="normal">	    </span><span class="keyword">fi</span>
<span class="normal">	    </span><span class="keyword">if</span><span class="normal"> </span><span class="keyword">test</span><span class="normal"> </span><span class="string">"$build_old_libs"</span><span class="normal"> </span><span class="symbol">=</span><span class="normal"> no</span><span class="symbol">;</span><span class="normal"> </span><span class="keyword">then</span>
<span class="normal">	      </span><span class="variable">oldlibs</span><span class="symbol">=</span><span class="string">"$output_objdir/$libname.$libext"</span>
<span class="normal">	      </span><span class="variable">build_libtool_libs</span><span class="symbol">=</span><span class="normal">module</span>
<span class="normal">	      </span><span class="variable">build_old_libs</span><span class="symbol">=</span><span class="normal">yes</span>
<span class="normal">	    </span><span class="keyword">else</span>
<span class="normal">	      </span><span class="variable">build_libtool_libs</span><span class="symbol">=</span><span class="normal">no</span>
<span class="normal">	    </span><span class="keyword">fi</span>
<span class="normal">	  </span><span class="keyword">else</span>
<span class="normal">	    </span><span class="variable">$echo</span><span class="normal"> </span><span class="string">"*** The inter-library dependencies that have been dropped here will be"</span>
<span class="normal">	    </span><span class="variable">$echo</span><span class="normal"> </span><span class="string">"*** automatically added whenever a program is linked with this library"</span>
<span class="normal">	    </span><span class="variable">$echo</span><span class="normal"> </span><span class="string">"*** or is declared to -dlopen it."</span>

<span class="normal">	    </span><span class="keyword">if</span><span class="normal"> </span><span class="keyword">test</span><span class="normal"> </span><span class="string">"$allow_undefined"</span><span class="normal"> </span><span class="symbol">=</span><span class="normal"> no</span><span class="symbol">;</span><span class="normal"> </span><span class="keyword">then</span>
<span class="normal">	      </span><span class="variable">$echo</span>
<span class="normal">	      </span><span class="variable">$echo</span><span class="normal"> </span><span class="string">"*** Since this library must not contain undefined symbols,"</span>
<span class="normal">	      </span><span class="variable">$echo</span><span class="normal"> </span><span class="string">"*** because either the platform does not support them or"</span>
<span class="normal">	      </span><span class="variable">$echo</span><span class="normal"> </span><span class="string">"*** it was explicitly requested with -no-undefined,"</span>
<span class="normal">	      </span><span class="variable">$echo</span><span class="normal"> </span><span class="string">"*** libtool will only create a static version of it."</span>
<span class="normal">	      </span><span class="keyword">if</span><span class="normal"> </span><span class="keyword">test</span><span class="normal"> </span><span class="string">"$build_old_libs"</span><span class="normal"> </span><span class="symbol">=</span><span class="normal"> no</span><span class="symbol">;</span><span class="normal"> </span><span class="keyword">then</span>
<span class="normal">		</span><span class="variable">oldlibs</span><span class="symbol">=</span><span class="string">"$output_objdir/$libname.$libext"</span>
<span class="normal">		</span><span class="variable">build_libtool_libs</span><span class="symbol">=</span><span class="normal">module</span>
<span class="normal">		</span><span class="variable">build_old_libs</span><span class="symbol">=</span><span class="normal">yes</span>
<span class="normal">	      </span><span class="keyword">else</span>
<span class="normal">		</span><span class="variable">build_libtool_libs</span><span class="symbol">=</span><span class="normal">no</span>
<span class="normal">	      </span><span class="keyword">fi</span>
<span class="normal">	    </span><span class="keyword">fi</span>
<span class="normal">	  </span><span class="keyword">fi</span>
<span class="normal">	</span><span class="keyword">fi</span>
<span class="normal">	</span><span class="comment"># Done checking deplibs!</span>
<span class="normal">	</span><span class="variable">deplibs</span><span class="symbol">=</span><span class="variable">$newdeplibs</span>
<span class="normal">      </span><span class="keyword">fi</span>


<span class="normal">      </span><span class="comment"># move library search paths that coincide with paths to not yet</span>
<span class="normal">      </span><span class="comment"># installed libraries to the beginning of the library search list</span>
<span class="normal">      </span><span class="variable">new_libs</span><span class="symbol">=</span>
<span class="normal">      </span><span class="keyword">for</span><span class="normal"> path </span><span class="keyword">in</span><span class="normal"> </span><span class="variable">$notinst_path</span><span class="symbol">;</span><span class="normal"> </span><span class="keyword">do</span>
<span class="normal">	</span><span class="keyword">case</span><span class="normal"> </span><span class="string">" $new_libs "</span><span class="normal"> </span><span class="keyword">in</span>
<span class="normal">	</span><span class="symbol">*</span><span class="string">" -L$path/$objdir "</span><span class="symbol">*)</span><span class="normal"> </span><span class="symbol">;;</span>
<span class="normal">	</span><span class="symbol">*)</span>
<span class="normal">	  </span><span class="keyword">case</span><span class="normal"> </span><span class="string">" $deplibs "</span><span class="normal"> </span><span class="keyword">in</span>
<span class="normal">	  </span><span class="symbol">*</span><span class="string">" -L$path/$objdir "</span><span class="symbol">*)</span>
<span class="normal">	    </span><span class="variable">new_libs</span><span class="symbol">=</span><span class="string">"$new_libs -L$path/$objdir"</span><span class="normal"> </span><span class="symbol">;;</span>
<span class="normal">	  </span><span class="keyword">esac</span>
<span class="normal">	  </span><span class="symbol">;;</span>
<span class="normal">	</span><span class="keyword">esac</span>
<span class="normal">      </span><span class="keyword">done</span>
<span class="normal">      </span><span class="keyword">for</span><span class="normal"> deplib </span><span class="keyword">in</span><span class="normal"> </span><span class="variable">$deplibs</span><span class="symbol">;</span><span class="normal"> </span><span class="keyword">do</span>
<span class="normal">	</span><span class="keyword">case</span><span class="normal"> </span><span class="variable">$deplib</span><span class="normal"> </span><span class="keyword">in</span>
<span class="normal">	-L</span><span class="symbol">*)</span>
<span class="normal">	  </span><span class="keyword">case</span><span class="normal"> </span><span class="string">" $new_libs "</span><span class="normal"> </span><span class="keyword">in</span>
<span class="normal">	  </span><span class="symbol">*</span><span class="string">" $deplib "</span><span class="symbol">*)</span><span class="normal"> </span><span class="symbol">;;</span>
<span class="normal">	  </span><span class="symbol">*)</span><span class="normal"> </span><span class="variable">new_libs</span><span class="symbol">=</span><span class="string">"$new_libs $deplib"</span><span class="normal"> </span><span class="symbol">;;</span>
<span class="normal">	  </span><span class="keyword">esac</span>
<span class="normal">	  </span><span class="symbol">;;</span>
<span class="normal">	</span><span class="symbol">*)</span><span class="normal"> </span><span class="variable">new_libs</span><span class="symbol">=</span><span class="string">"$new_libs $deplib"</span><span class="normal"> </span><span class="symbol">;;</span>
<span class="normal">	</span><span class="keyword">esac</span>
<span class="normal">      </span><span class="keyword">done</span>
<span class="normal">      </span><span class="variable">deplibs</span><span class="symbol">=</span><span class="string">"$new_libs"</span>


<span class="normal">      </span><span class="comment"># All the library-specific variables (install_libdir is set above).</span>
<span class="normal">      </span><span class="variable">library_names</span><span class="symbol">=</span>
<span class="normal">      </span><span class="variable">old_library</span><span class="symbol">=</span>
<span class="normal">      </span><span class="variable">dlname</span><span class="symbol">=</span>

<span class="normal">      </span><span class="comment"># Test again, we may have decided not to build it any more</span>
<span class="normal">      </span><span class="keyword">if</span><span class="normal"> </span><span class="keyword">test</span><span class="normal"> </span><span class="string">"$build_libtool_libs"</span><span class="normal"> </span><span class="symbol">=</span><span class="normal"> yes</span><span class="symbol">;</span><span class="normal"> </span><span class="keyword">then</span>
<span class="normal">	</span><span class="keyword">if</span><span class="normal"> </span><span class="keyword">test</span><span class="normal"> </span><span class="string">"$hardcode_into_libs"</span><span class="normal"> </span><span class="symbol">=</span><span class="normal"> yes</span><span class="symbol">;</span><span class="normal"> </span><span class="keyword">then</span>
<span class="normal">	  </span><span class="comment"># Hardcode the library paths</span>
<span class="normal">	  </span><span class="variable">hardcode_libdirs</span><span class="symbol">=</span>
<span class="normal">	  </span><span class="variable">dep_rpath</span><span class="symbol">=</span>
<span class="normal">	  </span><span class="variable">rpath</span><span class="symbol">=</span><span class="string">"$finalize_rpath"</span>
<span class="normal">	  </span><span class="keyword">test</span><span class="normal"> </span><span class="string">"$mode"</span><span class="normal"> </span><span class="symbol">!=</span><span class="normal"> relink </span><span class="symbol">&amp;&amp;</span><span class="normal"> </span><span class="variable">rpath</span><span class="symbol">=</span><span class="string">"$compile_rpath$rpath"</span>
<span class="normal">	  </span><span class="keyword">for</span><span class="normal"> libdir </span><span class="keyword">in</span><span class="normal"> </span><span class="variable">$rpath</span><span class="symbol">;</span><span class="normal"> </span><span class="keyword">do</span>
<span class="normal">	    </span><span class="keyword">if</span><span class="normal"> </span><span class="keyword">test</span><span class="normal"> -n </span><span class="string">"$hardcode_libdir_flag_spec"</span><span class="symbol">;</span><span class="normal"> </span><span class="keyword">then</span>
<span class="normal">	      </span><span class="keyword">if</span><span class="normal"> </span><span class="keyword">test</span><span class="normal"> -n </span><span class="string">"$hardcode_libdir_separator"</span><span class="symbol">;</span><span class="normal"> </span><span class="keyword">then</span>
<span class="normal">		</span><span class="keyword">if</span><span class="normal"> </span><span class="keyword">test</span><span class="normal"> -z </span><span class="string">"$hardcode_libdirs"</span><span class="symbol">;</span><span class="normal"> </span><span class="keyword">then</span>
<span class="normal">		  </span><span class="variable">hardcode_libdirs</span><span class="symbol">=</span><span class="string">"$libdir"</span>
<span class="normal">		</span><span class="keyword">else</span>
<span class="normal">		  </span><span class="comment"># Just accumulate the unique libdirs.</span>
<span class="normal">		  </span><span class="keyword">case</span><span class="normal"> </span><span class="variable">$hardcode_libdir_separator$hardcode_libdirs$hardcode_libdir_separator</span><span class="normal"> </span><span class="keyword">in</span>
<span class="normal">		  </span><span class="symbol">*</span><span class="string">"$hardcode_libdir_separator$libdir$hardcode_libdir_separator"</span><span class="symbol">*)</span>
<span class="normal">		    </span><span class="symbol">;;</span>
<span class="normal">		  </span><span class="symbol">*)</span>
<span class="normal">		    </span><span class="variable">hardcode_libdirs</span><span class="symbol">=</span><span class="string">"$hardcode_libdirs$hardcode_libdir_separator$libdir"</span>
<span class="normal">		    </span><span class="symbol">;;</span>
<span class="normal">		  </span><span class="keyword">esac</span>
<span class="normal">		</span><span class="keyword">fi</span>
<span class="normal">	      </span><span class="keyword">else</span>
<span class="normal">		</span><span class="keyword">eval</span><span class="normal"> </span><span class="variable">flag</span><span class="symbol">=</span><span class="normal">\"</span><span class="variable">$hardcode_libdir_flag_spec</span><span class="normal">\"</span>
<span class="normal">		</span><span class="variable">dep_rpath</span><span class="symbol">=</span><span class="string">"$dep_rpath $flag"</span>
<span class="normal">	      </span><span class="keyword">fi</span>
<span class="normal">	    </span><span class="keyword">elif</span><span class="normal"> </span><span class="keyword">test</span><span class="normal"> -n </span><span class="string">"$runpath_var"</span><span class="symbol">;</span><span class="normal"> </span><span class="keyword">then</span>
<span class="normal">	      </span><span class="keyword">case</span><span class="normal"> </span><span class="string">"$perm_rpath "</span><span class="normal"> </span><span class="keyword">in</span>
<span class="normal">	      </span><span class="symbol">*</span><span class="string">" $libdir "</span><span class="symbol">*)</span><span class="normal"> </span><span class="symbol">;;</span>
<span class="normal">	      </span><span class="symbol">*)</span><span class="normal"> </span><span class="variable">perm_rpath</span><span class="symbol">=</span><span class="string">"$perm_rpath $libdir"</span><span class="normal"> </span><span class="symbol">;;</span>
<span class="normal">	      </span><span class="keyword">esac</span>
<span class="normal">	    </span><span class="keyword">fi</span>
<span class="normal">	  </span><span class="keyword">done</span>
<span class="normal">	  </span><span class="comment"># Substitute the hardcoded libdirs into the rpath.</span>
<span class="normal">	  </span><span class="keyword">if</span><span class="normal"> </span><span class="keyword">test</span><span class="normal"> -n </span><span class="string">"$hardcode_libdir_separator"</span><span class="normal"> </span><span class="symbol">&amp;&amp;</span>
<span class="normal">	     </span><span class="keyword">test</span><span class="normal"> -n </span><span class="string">"$hardcode_libdirs"</span><span class="symbol">;</span><span class="normal"> </span><span class="keyword">then</span>
<span class="normal">	    </span><span class="variable">libdir</span><span class="symbol">=</span><span class="string">"$hardcode_libdirs"</span>
<span class="normal">	    </span><span class="keyword">if</span><span class="normal"> </span><span class="keyword">test</span><span class="normal"> -n </span><span class="string">"$hardcode_libdir_flag_spec_ld"</span><span class="symbol">;</span><span class="normal"> </span><span class="keyword">then</span>
<span class="normal">	      </span><span class="keyword">case</span><span class="normal"> </span><span class="variable">$archive_cmds</span><span class="normal"> </span><span class="keyword">in</span>
<span class="normal">	      </span><span class="symbol">*\</span><span class="variable">$LD</span><span class="symbol">*)</span><span class="normal"> </span><span class="keyword">eval</span><span class="normal"> </span><span class="variable">dep_rpath</span><span class="symbol">=</span><span class="normal">\"</span><span class="variable">$hardcode_libdir_flag_spec_ld</span><span class="normal">\" </span><span class="symbol">;;</span>
<span class="normal">	      </span><span class="symbol">*)</span><span class="normal">      </span><span class="keyword">eval</span><span class="normal"> </span><span class="variable">dep_rpath</span><span class="symbol">=</span><span class="normal">\"</span><span class="variable">$hardcode_libdir_flag_spec</span><span class="normal">\" </span><span class="symbol">;;</span>
<span class="normal">	      </span><span class="keyword">esac</span>
<span class="normal">	    </span><span class="keyword">else</span>
<span class="normal">	      </span><span class="keyword">eval</span><span class="normal"> </span><span class="variable">dep_rpath</span><span class="symbol">=</span><span class="normal">\"</span><span class="variable">$hardcode_libdir_flag_spec</span><span class="normal">\"</span>
<span class="normal">	    </span><span class="keyword">fi</span>
<span class="normal">	  </span><span class="keyword">fi</span>
<span class="normal">	  </span><span class="keyword">if</span><span class="normal"> </span><span class="keyword">test</span><span class="normal"> -n </span><span class="string">"$runpath_var"</span><span class="normal"> </span><span class="symbol">&amp;&amp;</span><span class="normal"> </span><span class="keyword">test</span><span class="normal"> -n </span><span class="string">"$perm_rpath"</span><span class="symbol">;</span><span class="normal"> </span><span class="keyword">then</span>
<span class="normal">	    </span><span class="comment"># We should set the runpath_var.</span>
<span class="normal">	    </span><span class="variable">rpath</span><span class="symbol">=</span>
<span class="normal">	    </span><span class="keyword">for</span><span class="normal"> dir </span><span class="keyword">in</span><span class="normal"> </span><span class="variable">$perm_rpath</span><span class="symbol">;</span><span class="normal"> </span><span class="keyword">do</span>
<span class="normal">	      </span><span class="variable">rpath</span><span class="symbol">=</span><span class="string">"$rpath$dir:"</span>
<span class="normal">	    </span><span class="keyword">done</span>
<span class="normal">	    </span><span class="keyword">eval</span><span class="normal"> </span><span class="string">"$runpath_var='$rpath</span><span class="specialchar">\$</span><span class="string">$runpath_var'; export $runpath_var"</span>
<span class="normal">	  </span><span class="keyword">fi</span>
<span class="normal">	  </span><span class="keyword">test</span><span class="normal"> -n </span><span class="string">"$dep_rpath"</span><span class="normal"> </span><span class="symbol">&amp;&amp;</span><span class="normal"> </span><span class="variable">deplibs</span><span class="symbol">=</span><span class="string">"$dep_rpath $deplibs"</span>
<span class="normal">	</span><span class="keyword">fi</span>

<span class="normal">	</span><span class="variable">shlibpath</span><span class="symbol">=</span><span class="string">"$finalize_shlibpath"</span>
<span class="normal">	</span><span class="keyword">test</span><span class="normal"> </span><span class="string">"$mode"</span><span class="normal"> </span><span class="symbol">!=</span><span class="normal"> relink </span><span class="symbol">&amp;&amp;</span><span class="normal"> </span><span class="variable">shlibpath</span><span class="symbol">=</span><span class="string">"$compile_shlibpath$shlibpath"</span>
<span class="normal">	</span><span class="keyword">if</span><span class="normal"> </span><span class="keyword">test</span><span class="normal"> -n </span><span class="string">"$shlibpath"</span><span class="symbol">;</span><span class="normal"> </span><span class="keyword">then</span>
<span class="normal">	  </span><span class="keyword">eval</span><span class="normal"> </span><span class="string">"$shlibpath_var='$shlibpath</span><span class="specialchar">\$</span><span class="string">$shlibpath_var'; export $shlibpath_var"</span>
<span class="normal">	</span><span class="keyword">fi</span>

<span class="normal">	</span><span class="comment"># Get the real and link names of the library.</span>
<span class="normal">	</span><span class="keyword">eval</span><span class="normal"> </span><span class="variable">shared_ext</span><span class="symbol">=</span><span class="normal">\"</span><span class="variable">$shrext_cmds</span><span class="normal">\"</span>
<span class="normal">	</span><span class="keyword">eval</span><span class="normal"> </span><span class="variable">library_names</span><span class="symbol">=</span><span class="normal">\"</span><span class="variable">$library_names_spec</span><span class="normal">\"</span>
<span class="normal">	</span><span class="keyword">set</span><span class="normal"> dummy </span><span class="variable">$library_names</span>
<span class="normal">	</span><span class="variable">realname</span><span class="symbol">=</span><span class="string">"$2"</span>
<span class="normal">	</span><span class="keyword">shift</span><span class="symbol">;</span><span class="normal"> </span><span class="keyword">shift</span>

<span class="normal">	</span><span class="keyword">if</span><span class="normal"> </span><span class="keyword">test</span><span class="normal"> -n </span><span class="string">"$soname_spec"</span><span class="symbol">;</span><span class="normal"> </span><span class="keyword">then</span>
<span class="normal">	  </span><span class="keyword">eval</span><span class="normal"> </span><span class="variable">soname</span><span class="symbol">=</span><span class="normal">\"</span><span class="variable">$soname_spec</span><span class="normal">\"</span>
<span class="normal">	</span><span class="keyword">else</span>
<span class="normal">	  </span><span class="variable">soname</span><span class="symbol">=</span><span class="string">"$realname"</span>
<span class="normal">	</span><span class="keyword">fi</span>
<span class="normal">	</span><span class="keyword">if</span><span class="normal"> </span><span class="keyword">test</span><span class="normal"> -z </span><span class="string">"$dlname"</span><span class="symbol">;</span><span class="normal"> </span><span class="keyword">then</span>
<span class="normal">	  </span><span class="variable">dlname</span><span class="symbol">=</span><span class="variable">$soname</span>
<span class="normal">	</span><span class="keyword">fi</span>

<span class="normal">	</span><span class="variable">lib</span><span class="symbol">=</span><span class="string">"$output_objdir/$realname"</span>
<span class="normal">	</span><span class="variable">linknames</span><span class="symbol">=</span>
<span class="normal">	</span><span class="keyword">for</span><span class="normal"> link</span>
<span class="normal">	</span><span class="keyword">do</span>
<span class="normal">	  </span><span class="variable">linknames</span><span class="symbol">=</span><span class="string">"$linknames $link"</span>
<span class="normal">	</span><span class="keyword">done</span>

<span class="normal">	</span><span class="comment"># Use standard objects if they are pic</span>
<span class="normal">	</span><span class="keyword">test</span><span class="normal"> -z </span><span class="string">"$pic_flag"</span><span class="normal"> </span><span class="symbol">&amp;&amp;</span><span class="normal"> </span><span class="variable">libobjs</span><span class="symbol">=</span><span class="normal">`</span><span class="variable">$echo</span><span class="normal"> </span><span class="string">"X$libobjs"</span><span class="normal"> </span><span class="symbol">|</span><span class="normal"> </span><span class="variable">$SP2NL</span><span class="normal"> </span><span class="symbol">|</span><span class="normal"> </span><span class="variable">$Xsed</span><span class="normal"> -e </span><span class="string">"$lo2o"</span><span class="normal"> </span><span class="symbol">|</span><span class="normal"> </span><span class="variable">$NL2SP</span><span class="normal">`</span>

<span class="normal">	</span><span class="comment"># Prepare the list of exported symbols</span>
<span class="normal">	</span><span class="keyword">if</span><span class="normal"> </span><span class="keyword">test</span><span class="normal"> -z </span><span class="string">"$export_symbols"</span><span class="symbol">;</span><span class="normal"> </span><span class="keyword">then</span>
<span class="normal">	  </span><span class="keyword">if</span><span class="normal"> </span><span class="keyword">test</span><span class="normal"> </span><span class="string">"$always_export_symbols"</span><span class="normal"> </span><span class="symbol">=</span><span class="normal"> yes </span><span class="symbol">||</span><span class="normal"> </span><span class="keyword">test</span><span class="normal"> -n </span><span class="string">"$export_symbols_regex"</span><span class="symbol">;</span><span class="normal"> </span><span class="keyword">then</span>
<span class="normal">	    </span><span class="variable">$show</span><span class="normal"> </span><span class="string">"generating symbol list for </span><span class="specialchar">\`</span><span class="string">$libname.la'"</span>
<span class="normal">	    </span><span class="variable">export_symbols</span><span class="symbol">=</span><span class="string">"$output_objdir/$libname.exp"</span>
<span class="normal">	    </span><span class="variable">$run</span><span class="normal"> </span><span class="variable">$rm</span><span class="normal"> </span><span class="variable">$export_symbols</span>
<span class="normal">	    </span><span class="variable">cmds</span><span class="symbol">=</span><span class="variable">$export_symbols_cmds</span>
<span class="normal">	    </span><span class="variable">save_ifs</span><span class="symbol">=</span><span class="string">"$IFS"</span><span class="symbol">;</span><span class="normal"> </span><span class="variable">IFS</span><span class="symbol">=</span><span class="string">'~'</span>
<span class="normal">	    </span><span class="keyword">for</span><span class="normal"> cmd </span><span class="keyword">in</span><span class="normal"> </span><span class="variable">$cmds</span><span class="symbol">;</span><span class="normal"> </span><span class="keyword">do</span>
<span class="normal">	      </span><span class="variable">IFS</span><span class="symbol">=</span><span class="string">"$save_ifs"</span>
<span class="normal">	      </span><span class="keyword">eval</span><span class="normal"> </span><span class="variable">cmd</span><span class="symbol">=</span><span class="normal">\"</span><span class="variable">$cmd</span><span class="normal">\"</span>
<span class="normal">	      </span><span class="keyword">if</span><span class="normal"> </span><span class="variable">len</span><span class="symbol">=</span><span class="normal">`expr </span><span class="string">"X$cmd"</span><span class="normal"> </span><span class="symbol">:</span><span class="normal"> </span><span class="string">".*"</span><span class="normal">` </span><span class="symbol">&amp;&amp;</span>
<span class="normal">	       </span><span class="keyword">test</span><span class="normal"> </span><span class="string">"$len"</span><span class="normal"> -le </span><span class="string">"$max_cmd_len"</span><span class="normal"> </span><span class="symbol">||</span><span class="normal"> </span><span class="keyword">test</span><span class="normal"> </span><span class="string">"$max_cmd_len"</span><span class="normal"> -le -</span><span class="number">1</span><span class="symbol">;</span><span class="normal"> </span><span class="keyword">then</span>
<span class="normal">	        </span><span class="variable">$show</span><span class="normal"> </span><span class="string">"$cmd"</span>
<span class="normal">	        </span><span class="variable">$run</span><span class="normal"> </span><span class="keyword">eval</span><span class="normal"> </span><span class="string">"$cmd"</span><span class="normal"> </span><span class="symbol">||</span><span class="normal"> </span><span class="keyword">exit</span><span class="normal"> </span><span class="variable">$?</span>
<span class="normal">	        </span><span class="variable">skipped_export</span><span class="symbol">=</span><span class="keyword">false</span>
<span class="normal">	      </span><span class="keyword">else</span>
<span class="normal">	        </span><span class="comment"># The command line is too long to execute in one step.</span>
<span class="normal">	        </span><span class="variable">$show</span><span class="normal"> </span><span class="string">"using reloadable object file for export list..."</span>
<span class="normal">	        </span><span class="variable">skipped_export</span><span class="symbol">=:</span>
<span class="normal">		</span><span class="comment"># Break out early, otherwise skipped_export may be</span>
<span class="normal">		</span><span class="comment"># set to false by a later but shorter cmd.</span>
<span class="normal">		</span><span class="keyword">break</span>
<span class="normal">	      </span><span class="keyword">fi</span>
<span class="normal">	    </span><span class="keyword">done</span>
<span class="normal">	    </span><span class="variable">IFS</span><span class="symbol">=</span><span class="string">"$save_ifs"</span>
<span class="normal">	    </span><span class="keyword">if</span><span class="normal"> </span><span class="keyword">test</span><span class="normal"> -n </span><span class="string">"$export_symbols_regex"</span><span class="symbol">;</span><span class="normal"> </span><span class="keyword">then</span>
<span class="normal">	      </span><span class="variable">$show</span><span class="normal"> </span><span class="string">"$EGREP -e </span><span class="specialchar">\"</span><span class="string">$export_symbols_regex</span><span class="specialchar">\"</span><span class="string"> </span><span class="specialchar">\"</span><span class="string">$export_symbols</span><span class="specialchar">\"</span><span class="string"> &gt; </span><span class="specialchar">\"</span><span class="string">${export_symbols}T</span><span class="specialchar">\"</span><span class="string">"</span>
<span class="normal">	      </span><span class="variable">$run</span><span class="normal"> </span><span class="keyword">eval</span><span class="normal"> </span><span class="string">'$EGREP -e "$export_symbols_regex" "$export_symbols" &gt; "${export_symbols}T"'</span>
<span class="normal">	      </span><span class="variable">$show</span><span class="normal"> </span><span class="string">"$mv </span><span class="specialchar">\"</span><span class="string">${export_symbols}T</span><span class="specialchar">\"</span><span class="string"> </span><span class="specialchar">\"</span><span class="string">$export_symbols</span><span class="specialchar">\"</span><span class="string">"</span>
<span class="normal">	      </span><span class="variable">$run</span><span class="normal"> </span><span class="keyword">eval</span><span class="normal"> </span><span class="string">'$mv "${export_symbols}T" "$export_symbols"'</span>
<span class="normal">	    </span><span class="keyword">fi</span>
<span class="normal">	  </span><span class="keyword">fi</span>
<span class="normal">	</span><span class="keyword">fi</span>

<span class="normal">	</span><span class="keyword">if</span><span class="normal"> </span><span class="keyword">test</span><span class="normal"> -n </span><span class="string">"$export_symbols"</span><span class="normal"> </span><span class="symbol">&amp;&amp;</span><span class="normal"> </span><span class="keyword">test</span><span class="normal"> -n </span><span class="string">"$include_expsyms"</span><span class="symbol">;</span><span class="normal"> </span><span class="keyword">then</span>
<span class="normal">	  </span><span class="variable">$run</span><span class="normal"> </span><span class="keyword">eval</span><span class="normal"> </span><span class="string">'$echo "X$include_expsyms" | $SP2NL &gt;&gt; "$export_symbols"'</span>
<span class="normal">	</span><span class="keyword">fi</span>

<span class="normal">	</span><span class="variable">tmp_deplibs</span><span class="symbol">=</span>
<span class="normal">	</span><span class="keyword">for</span><span class="normal"> test_deplib </span><span class="keyword">in</span><span class="normal"> </span><span class="variable">$deplibs</span><span class="symbol">;</span><span class="normal"> </span><span class="keyword">do</span>
<span class="normal">		</span><span class="keyword">case</span><span class="normal"> </span><span class="string">" $convenience "</span><span class="normal"> </span><span class="keyword">in</span>
<span class="normal">		</span><span class="symbol">*</span><span class="string">" $test_deplib "</span><span class="symbol">*)</span><span class="normal"> </span><span class="symbol">;;</span>
<span class="normal">		</span><span class="symbol">*)</span>
<span class="normal">			</span><span class="variable">tmp_deplibs</span><span class="symbol">=</span><span class="string">"$tmp_deplibs $test_deplib"</span>
<span class="normal">			</span><span class="symbol">;;</span>
<span class="normal">		</span><span class="keyword">esac</span>
<span class="normal">	</span><span class="keyword">done</span>
<span class="normal">	</span><span class="variable">deplibs</span><span class="symbol">=</span><span class="string">"$tmp_deplibs"</span>

<span class="normal">	</span><span class="keyword">if</span><span class="normal"> </span><span class="keyword">test</span><span class="normal"> -n </span><span class="string">"$convenience"</span><span class="symbol">;</span><span class="normal"> </span><span class="keyword">then</span>
<span class="normal">	  </span><span class="keyword">if</span><span class="normal"> </span><span class="keyword">test</span><span class="normal"> -n </span><span class="string">"$whole_archive_flag_spec"</span><span class="symbol">;</span><span class="normal"> </span><span class="keyword">then</span>
<span class="normal">	    </span><span class="variable">save_libobjs</span><span class="symbol">=</span><span class="variable">$libobjs</span>
<span class="normal">	    </span><span class="keyword">eval</span><span class="normal"> </span><span class="variable">libobjs</span><span class="symbol">=</span><span class="normal">\"</span><span class="symbol">\</span><span class="variable">$libobjs</span><span class="normal"> </span><span class="variable">$whole_archive_flag_spec</span><span class="normal">\"</span>
<span class="normal">	  </span><span class="keyword">else</span>
<span class="normal">	    </span><span class="variable">gentop</span><span class="symbol">=</span><span class="string">"$output_objdir/${outputname}x"</span>
<span class="normal">	    </span><span class="variable">generated</span><span class="symbol">=</span><span class="string">"$generated $gentop"</span>

<span class="normal">	    func_extract_archives </span><span class="variable">$gentop</span><span class="normal"> </span><span class="variable">$convenience</span>
<span class="normal">	    </span><span class="variable">libobjs</span><span class="symbol">=</span><span class="string">"$libobjs $func_extract_archives_result"</span>
<span class="normal">	  </span><span class="keyword">fi</span>
<span class="normal">	</span><span class="keyword">fi</span>
<span class="normal">	</span>
<span class="normal">	</span><span class="keyword">if</span><span class="normal"> </span><span class="keyword">test</span><span class="normal"> </span><span class="string">"$thread_safe"</span><span class="normal"> </span><span class="symbol">=</span><span class="normal"> yes </span><span class="symbol">&amp;&amp;</span><span class="normal"> </span><span class="keyword">test</span><span class="normal"> -n </span><span class="string">"$thread_safe_flag_spec"</span><span class="symbol">;</span><span class="normal"> </span><span class="keyword">then</span>
<span class="normal">	  </span><span class="keyword">eval</span><span class="normal"> </span><span class="variable">flag</span><span class="symbol">=</span><span class="normal">\"</span><span class="variable">$thread_safe_flag_spec</span><span class="normal">\"</span>
<span class="normal">	  </span><span class="variable">linker_flags</span><span class="symbol">=</span><span class="string">"$linker_flags $flag"</span>
<span class="normal">	</span><span class="keyword">fi</span>

<span class="normal">	</span><span class="comment"># Make a backup of the uninstalled library when relinking</span>
<span class="normal">	</span><span class="keyword">if</span><span class="normal"> </span><span class="keyword">test</span><span class="normal"> </span><span class="string">"$mode"</span><span class="normal"> </span><span class="symbol">=</span><span class="normal"> relink</span><span class="symbol">;</span><span class="normal"> </span><span class="keyword">then</span>
<span class="normal">	  </span><span class="variable">$run</span><span class="normal"> </span><span class="keyword">eval</span><span class="normal"> </span><span class="string">'(cd $output_objdir &amp;&amp; $rm ${realname}U &amp;&amp; $mv $realname ${realname}U)'</span><span class="normal"> </span><span class="symbol">||</span><span class="normal"> </span><span class="keyword">exit</span><span class="normal"> </span><span class="variable">$?</span>
<span class="normal">	</span><span class="keyword">fi</span>

<span class="normal">	</span><span class="comment"># Do each of the archive commands.</span>
<span class="normal">	</span><span class="keyword">if</span><span class="normal"> </span><span class="keyword">test</span><span class="normal"> </span><span class="string">"$module"</span><span class="normal"> </span><span class="symbol">=</span><span class="normal"> yes </span><span class="symbol">&amp;&amp;</span><span class="normal"> </span><span class="keyword">test</span><span class="normal"> -n </span><span class="string">"$module_cmds"</span><span class="normal"> </span><span class="symbol">;</span><span class="normal"> </span><span class="keyword">then</span>
<span class="normal">	  </span><span class="keyword">if</span><span class="normal"> </span><span class="keyword">test</span><span class="normal"> -n </span><span class="string">"$export_symbols"</span><span class="normal"> </span><span class="symbol">&amp;&amp;</span><span class="normal"> </span><span class="keyword">test</span><span class="normal"> -n </span><span class="string">"$module_expsym_cmds"</span><span class="symbol">;</span><span class="normal"> </span><span class="keyword">then</span>
<span class="normal">	    </span><span class="keyword">eval</span><span class="normal"> </span><span class="variable">test_cmds</span><span class="symbol">=</span><span class="normal">\"</span><span class="variable">$module_expsym_cmds</span><span class="normal">\"</span>
<span class="normal">	    </span><span class="variable">cmds</span><span class="symbol">=</span><span class="variable">$module_expsym_cmds</span>
<span class="normal">	  </span><span class="keyword">else</span>
<span class="normal">	    </span><span class="keyword">eval</span><span class="normal"> </span><span class="variable">test_cmds</span><span class="symbol">=</span><span class="normal">\"</span><span class="variable">$module_cmds</span><span class="normal">\"</span>
<span class="normal">	    </span><span class="variable">cmds</span><span class="symbol">=</span><span class="variable">$module_cmds</span>
<span class="normal">	  </span><span class="keyword">fi</span>
<span class="normal">	</span><span class="keyword">else</span>
<span class="normal">	</span><span class="keyword">if</span><span class="normal"> </span><span class="keyword">test</span><span class="normal"> -n </span><span class="string">"$export_symbols"</span><span class="normal"> </span><span class="symbol">&amp;&amp;</span><span class="normal"> </span><span class="keyword">test</span><span class="normal"> -n </span><span class="string">"$archive_expsym_cmds"</span><span class="symbol">;</span><span class="normal"> </span><span class="keyword">then</span>
<span class="normal">	  </span><span class="keyword">eval</span><span class="normal"> </span><span class="variable">test_cmds</span><span class="symbol">=</span><span class="normal">\"</span><span class="variable">$archive_expsym_cmds</span><span class="normal">\"</span>
<span class="normal">	  </span><span class="variable">cmds</span><span class="symbol">=</span><span class="variable">$archive_expsym_cmds</span>
<span class="normal">	</span><span class="keyword">else</span>
<span class="normal">	  </span><span class="keyword">eval</span><span class="normal"> </span><span class="variable">test_cmds</span><span class="symbol">=</span><span class="normal">\"</span><span class="variable">$archive_cmds</span><span class="normal">\"</span>
<span class="normal">	  </span><span class="variable">cmds</span><span class="symbol">=</span><span class="variable">$archive_cmds</span>
<span class="normal">	  </span><span class="keyword">fi</span>
<span class="normal">	</span><span class="keyword">fi</span>

<span class="normal">	</span><span class="keyword">if</span><span class="normal"> </span><span class="keyword">test</span><span class="normal"> </span><span class="string">"X$skipped_export"</span><span class="normal"> </span><span class="symbol">!=</span><span class="normal"> </span><span class="string">"X:"</span><span class="normal"> </span><span class="symbol">&amp;&amp;</span>
<span class="normal">	   </span><span class="variable">len</span><span class="symbol">=</span><span class="normal">`expr </span><span class="string">"X$test_cmds"</span><span class="normal"> </span><span class="symbol">:</span><span class="normal"> </span><span class="string">".*"</span><span class="normal"> </span><span class="number">2</span><span class="symbol">&gt;</span><span class="normal">/dev/null` </span><span class="symbol">&amp;&amp;</span>
<span class="normal">	   </span><span class="keyword">test</span><span class="normal"> </span><span class="string">"$len"</span><span class="normal"> -le </span><span class="string">"$max_cmd_len"</span><span class="normal"> </span><span class="symbol">||</span><span class="normal"> </span><span class="keyword">test</span><span class="normal"> </span><span class="string">"$max_cmd_len"</span><span class="normal"> -le -</span><span class="number">1</span><span class="symbol">;</span><span class="normal"> </span><span class="keyword">then</span>
<span class="normal">	  </span><span class="symbol">:</span>
<span class="normal">	</span><span class="keyword">else</span>
<span class="normal">	  </span><span class="comment"># The command line is too long to link in one step, link piecewise.</span>
<span class="normal">	  </span><span class="variable">$echo</span><span class="normal"> </span><span class="string">"creating reloadable object files..."</span>

<span class="normal">	  </span><span class="comment"># Save the value of $output and $libobjs because we want to</span>
<span class="normal">	  </span><span class="comment"># use them later.  If we have whole_archive_flag_spec, we</span>
<span class="normal">	  </span><span class="comment"># want to use save_libobjs as it was before</span>
<span class="normal">	  </span><span class="comment"># whole_archive_flag_spec was expanded, because we can't</span>
<span class="normal">	  </span><span class="comment"># assume the linker understands whole_archive_flag_spec.</span>
<span class="normal">	  </span><span class="comment"># This may have to be revisited, in case too many</span>
<span class="normal">	  </span><span class="comment"># convenience libraries get linked in and end up exceeding</span>
<span class="normal">	  </span><span class="comment"># the spec.</span>
<span class="normal">	  </span><span class="keyword">if</span><span class="normal"> </span><span class="keyword">test</span><span class="normal"> -z </span><span class="string">"$convenience"</span><span class="normal"> </span><span class="symbol">||</span><span class="normal"> </span><span class="keyword">test</span><span class="normal"> -z </span><span class="string">"$whole_archive_flag_spec"</span><span class="symbol">;</span><span class="normal"> </span><span class="keyword">then</span>
<span class="normal">	    </span><span class="variable">save_libobjs</span><span class="symbol">=</span><span class="variable">$libobjs</span>
<span class="normal">	  </span><span class="keyword">fi</span>
<span class="normal">	  </span><span class="variable">save_output</span><span class="symbol">=</span><span class="variable">$output</span>
<span class="normal">	  </span><span class="variable">output_la</span><span class="symbol">=</span><span class="normal">`</span><span class="variable">$echo</span><span class="normal"> </span><span class="string">"X$output"</span><span class="normal"> </span><span class="symbol">|</span><span class="normal"> </span><span class="variable">$Xsed</span><span class="normal"> -e </span><span class="string">"$basename"</span><span class="normal">`</span>

<span class="normal">	  </span><span class="comment"># Clear the reloadable object creation command queue and</span>
<span class="normal">	  </span><span class="comment"># initialize k to one.</span>
<span class="normal">	  </span><span class="variable">test_cmds</span><span class="symbol">=</span>
<span class="normal">	  </span><span class="variable">concat_cmds</span><span class="symbol">=</span>
<span class="normal">	  </span><span class="variable">objlist</span><span class="symbol">=</span>
<span class="normal">	  </span><span class="variable">delfiles</span><span class="symbol">=</span>
<span class="normal">	  </span><span class="variable">last_robj</span><span class="symbol">=</span>
<span class="normal">	  </span><span class="variable">k</span><span class="symbol">=</span><span class="number">1</span>
<span class="normal">	  </span><span class="variable">output</span><span class="symbol">=</span><span class="variable">$output_objdir</span><span class="symbol">/</span><span class="variable">$output_la</span><span class="normal">-</span><span class="variable">${k}</span><span class="symbol">.</span><span class="variable">$objext</span>
<span class="normal">	  </span><span class="comment"># Loop over the list of objects to be linked.</span>
<span class="normal">	  </span><span class="keyword">for</span><span class="normal"> obj </span><span class="keyword">in</span><span class="normal"> </span><span class="variable">$save_libobjs</span>
<span class="normal">	  </span><span class="keyword">do</span>
<span class="normal">	    </span><span class="keyword">eval</span><span class="normal"> </span><span class="variable">test_cmds</span><span class="symbol">=</span><span class="normal">\"</span><span class="variable">$reload_cmds</span><span class="normal"> </span><span class="variable">$objlist</span><span class="normal"> </span><span class="variable">$last_robj</span><span class="normal">\"</span>
<span class="normal">	    </span><span class="keyword">if</span><span class="normal"> </span><span class="keyword">test</span><span class="normal"> </span><span class="string">"X$objlist"</span><span class="normal"> </span><span class="symbol">=</span><span class="normal"> X </span><span class="symbol">||</span>
<span class="normal">	       { </span><span class="variable">len</span><span class="symbol">=</span><span class="normal">`expr </span><span class="string">"X$test_cmds"</span><span class="normal"> </span><span class="symbol">:</span><span class="normal"> </span><span class="string">".*"</span><span class="normal"> </span><span class="number">2</span><span class="symbol">&gt;</span><span class="normal">/dev/null` </span><span class="symbol">&amp;&amp;</span>
<span class="normal">		 </span><span class="keyword">test</span><span class="normal"> </span><span class="string">"$len"</span><span class="normal"> -le </span><span class="string">"$max_cmd_len"</span><span class="symbol">;</span><span class="normal"> }</span><span class="symbol">;</span><span class="normal"> </span><span class="keyword">then</span>
<span class="normal">	      </span><span class="variable">objlist</span><span class="symbol">=</span><span class="string">"$objlist $obj"</span>
<span class="normal">	    </span><span class="keyword">else</span>
<span class="normal">	      </span><span class="comment"># The command $test_cmds is almost too long, add a</span>
<span class="normal">	      </span><span class="comment"># command to the queue.</span>
<span class="normal">	      </span><span class="keyword">if</span><span class="normal"> </span><span class="keyword">test</span><span class="normal"> </span><span class="string">"$k"</span><span class="normal"> -eq </span><span class="number">1</span><span class="normal"> </span><span class="symbol">;</span><span class="normal"> </span><span class="keyword">then</span>
<span class="normal">		</span><span class="comment"># The first file doesn't have a previous command to add.</span>
<span class="normal">		</span><span class="keyword">eval</span><span class="normal"> </span><span class="variable">concat_cmds</span><span class="symbol">=</span><span class="normal">\"</span><span class="variable">$reload_cmds</span><span class="normal"> </span><span class="variable">$objlist</span><span class="normal"> </span><span class="variable">$last_robj</span><span class="normal">\"</span>
<span class="normal">	      </span><span class="keyword">else</span>
<span class="normal">		</span><span class="comment"># All subsequent reloadable object files will link in</span>
<span class="normal">		</span><span class="comment"># the last one created.</span>
<span class="normal">		</span><span class="keyword">eval</span><span class="normal"> </span><span class="variable">concat_cmds</span><span class="symbol">=</span><span class="normal">\"</span><span class="symbol">\</span><span class="variable">$concat_cmds</span><span class="symbol">~</span><span class="variable">$reload_cmds</span><span class="normal"> </span><span class="variable">$objlist</span><span class="normal"> </span><span class="variable">$last_robj</span><span class="normal">\"</span>
<span class="normal">	      </span><span class="keyword">fi</span>
<span class="normal">	      </span><span class="variable">last_robj</span><span class="symbol">=</span><span class="variable">$output_objdir</span><span class="symbol">/</span><span class="variable">$output_la</span><span class="normal">-</span><span class="variable">${k}</span><span class="symbol">.</span><span class="variable">$objext</span>
<span class="normal">	      </span><span class="variable">k</span><span class="symbol">=</span><span class="normal">`expr </span><span class="variable">$k</span><span class="normal"> </span><span class="symbol">+</span><span class="normal"> </span><span class="number">1</span><span class="normal">`</span>
<span class="normal">	      </span><span class="variable">output</span><span class="symbol">=</span><span class="variable">$output_objdir</span><span class="symbol">/</span><span class="variable">$output_la</span><span class="normal">-</span><span class="variable">${k}</span><span class="symbol">.</span><span class="variable">$objext</span>
<span class="normal">	      </span><span class="variable">objlist</span><span class="symbol">=</span><span class="variable">$obj</span>
<span class="normal">	      </span><span class="variable">len</span><span class="symbol">=</span><span class="number">1</span>
<span class="normal">	    </span><span class="keyword">fi</span>
<span class="normal">	  </span><span class="keyword">done</span>
<span class="normal">	  </span><span class="comment"># Handle the remaining objects by creating one last</span>
<span class="normal">	  </span><span class="comment"># reloadable object file.  All subsequent reloadable object</span>
<span class="normal">	  </span><span class="comment"># files will link in the last one created.</span>
<span class="normal">	  </span><span class="keyword">test</span><span class="normal"> -z </span><span class="string">"$concat_cmds"</span><span class="normal"> </span><span class="symbol">||</span><span class="normal"> </span><span class="variable">concat_cmds</span><span class="symbol">=</span><span class="variable">$concat_cmds</span><span class="symbol">~</span>
<span class="normal">	  </span><span class="keyword">eval</span><span class="normal"> </span><span class="variable">concat_cmds</span><span class="symbol">=</span><span class="normal">\"</span><span class="symbol">\</span><span class="variable">${concat_cmds}$reload_cmds</span><span class="normal"> </span><span class="variable">$objlist</span><span class="normal"> </span><span class="variable">$last_robj</span><span class="normal">\"</span>

<span class="normal">	  </span><span class="keyword">if</span><span class="normal"> </span><span class="variable">${skipped_export-false}</span><span class="symbol">;</span><span class="normal"> </span><span class="keyword">then</span>
<span class="normal">	    </span><span class="variable">$show</span><span class="normal"> </span><span class="string">"generating symbol list for </span><span class="specialchar">\`</span><span class="string">$libname.la'"</span>
<span class="normal">	    </span><span class="variable">export_symbols</span><span class="symbol">=</span><span class="string">"$output_objdir/$libname.exp"</span>
<span class="normal">	    </span><span class="variable">$run</span><span class="normal"> </span><span class="variable">$rm</span><span class="normal"> </span><span class="variable">$export_symbols</span>
<span class="normal">	    </span><span class="variable">libobjs</span><span class="symbol">=</span><span class="variable">$output</span>
<span class="normal">	    </span><span class="comment"># Append the command to create the export file.</span>
<span class="normal">	    </span><span class="keyword">eval</span><span class="normal"> </span><span class="variable">concat_cmds</span><span class="symbol">=</span><span class="normal">\"</span><span class="symbol">\</span><span class="variable">$concat_cmds</span><span class="symbol">~</span><span class="variable">$export_symbols_cmds</span><span class="normal">\"</span>
<span class="normal">          </span><span class="keyword">fi</span>

<span class="normal">	  </span><span class="comment"># Set up a command to remove the reloadable object files</span>
<span class="normal">	  </span><span class="comment"># after they are used.</span>
<span class="normal">	  </span><span class="variable">i</span><span class="symbol">=</span><span class="number">0</span>
<span class="normal">	  </span><span class="keyword">while</span><span class="normal"> </span><span class="keyword">test</span><span class="normal"> </span><span class="string">"$i"</span><span class="normal"> -lt </span><span class="string">"$k"</span>
<span class="normal">	  </span><span class="keyword">do</span>
<span class="normal">	    </span><span class="variable">i</span><span class="symbol">=</span><span class="normal">`expr </span><span class="variable">$i</span><span class="normal"> </span><span class="symbol">+</span><span class="normal"> </span><span class="number">1</span><span class="normal">`</span>
<span class="normal">	    </span><span class="variable">delfiles</span><span class="symbol">=</span><span class="string">"$delfiles $output_objdir/$output_la-${i}.$objext"</span>
<span class="normal">	  </span><span class="keyword">done</span>

<span class="normal">	  </span><span class="variable">$echo</span><span class="normal"> </span><span class="string">"creating a temporary reloadable object file: $output"</span>

<span class="normal">	  </span><span class="comment"># Loop through the commands generated above and execute them.</span>
<span class="normal">	  </span><span class="variable">save_ifs</span><span class="symbol">=</span><span class="string">"$IFS"</span><span class="symbol">;</span><span class="normal"> </span><span class="variable">IFS</span><span class="symbol">=</span><span class="string">'~'</span>
<span class="normal">	  </span><span class="keyword">for</span><span class="normal"> cmd </span><span class="keyword">in</span><span class="normal"> </span><span class="variable">$concat_cmds</span><span class="symbol">;</span><span class="normal"> </span><span class="keyword">do</span>
<span class="normal">	    </span><span class="variable">IFS</span><span class="symbol">=</span><span class="string">"$save_ifs"</span>
<span class="normal">	    </span><span class="variable">$show</span><span class="normal"> </span><span class="string">"$cmd"</span>
<span class="normal">	    </span><span class="variable">$run</span><span class="normal"> </span><span class="keyword">eval</span><span class="normal"> </span><span class="string">"$cmd"</span><span class="normal"> </span><span class="symbol">||</span><span class="normal"> </span><span class="keyword">exit</span><span class="normal"> </span><span class="variable">$?</span>
<span class="normal">	  </span><span class="keyword">done</span>
<span class="normal">	  </span><span class="variable">IFS</span><span class="symbol">=</span><span class="string">"$save_ifs"</span>

<span class="normal">	  </span><span class="variable">libobjs</span><span class="symbol">=</span><span class="variable">$output</span>
<span class="normal">	  </span><span class="comment"># Restore the value of output.</span>
<span class="normal">	  </span><span class="variable">output</span><span class="symbol">=</span><span class="variable">$save_output</span>

<span class="normal">	  </span><span class="keyword">if</span><span class="normal"> </span><span class="keyword">test</span><span class="normal"> -n </span><span class="string">"$convenience"</span><span class="normal"> </span><span class="symbol">&amp;&amp;</span><span class="normal"> </span><span class="keyword">test</span><span class="normal"> -n </span><span class="string">"$whole_archive_flag_spec"</span><span class="symbol">;</span><span class="normal"> </span><span class="keyword">then</span>
<span class="normal">	    </span><span class="keyword">eval</span><span class="normal"> </span><span class="variable">libobjs</span><span class="symbol">=</span><span class="normal">\"</span><span class="symbol">\</span><span class="variable">$libobjs</span><span class="normal"> </span><span class="variable">$whole_archive_flag_spec</span><span class="normal">\"</span>
<span class="normal">	  </span><span class="keyword">fi</span>
<span class="normal">	  </span><span class="comment"># Expand the library linking commands again to reset the</span>
<span class="normal">	  </span><span class="comment"># value of $libobjs for piecewise linking.</span>

<span class="normal">	  </span><span class="comment"># Do each of the archive commands.</span>
<span class="normal">	  </span><span class="keyword">if</span><span class="normal"> </span><span class="keyword">test</span><span class="normal"> </span><span class="string">"$module"</span><span class="normal"> </span><span class="symbol">=</span><span class="normal"> yes </span><span class="symbol">&amp;&amp;</span><span class="normal"> </span><span class="keyword">test</span><span class="normal"> -n </span><span class="string">"$module_cmds"</span><span class="normal"> </span><span class="symbol">;</span><span class="normal"> </span><span class="keyword">then</span>
<span class="normal">	    </span><span class="keyword">if</span><span class="normal"> </span><span class="keyword">test</span><span class="normal"> -n </span><span class="string">"$export_symbols"</span><span class="normal"> </span><span class="symbol">&amp;&amp;</span><span class="normal"> </span><span class="keyword">test</span><span class="normal"> -n </span><span class="string">"$module_expsym_cmds"</span><span class="symbol">;</span><span class="normal"> </span><span class="keyword">then</span>
<span class="normal">	      </span><span class="variable">cmds</span><span class="symbol">=</span><span class="variable">$module_expsym_cmds</span>
<span class="normal">	    </span><span class="keyword">else</span>
<span class="normal">	      </span><span class="variable">cmds</span><span class="symbol">=</span><span class="variable">$module_cmds</span>
<span class="normal">	    </span><span class="keyword">fi</span>
<span class="normal">	  </span><span class="keyword">else</span>
<span class="normal">	  </span><span class="keyword">if</span><span class="normal"> </span><span class="keyword">test</span><span class="normal"> -n </span><span class="string">"$export_symbols"</span><span class="normal"> </span><span class="symbol">&amp;&amp;</span><span class="normal"> </span><span class="keyword">test</span><span class="normal"> -n </span><span class="string">"$archive_expsym_cmds"</span><span class="symbol">;</span><span class="normal"> </span><span class="keyword">then</span>
<span class="normal">	    </span><span class="variable">cmds</span><span class="symbol">=</span><span class="variable">$archive_expsym_cmds</span>
<span class="normal">	  </span><span class="keyword">else</span>
<span class="normal">	    </span><span class="variable">cmds</span><span class="symbol">=</span><span class="variable">$archive_cmds</span>
<span class="normal">	    </span><span class="keyword">fi</span>
<span class="normal">	  </span><span class="keyword">fi</span>

<span class="normal">	  </span><span class="comment"># Append the command to remove the reloadable object files</span>
<span class="normal">	  </span><span class="comment"># to the just-reset $cmds.</span>
<span class="normal">	  </span><span class="keyword">eval</span><span class="normal"> </span><span class="variable">cmds</span><span class="symbol">=</span><span class="normal">\"</span><span class="symbol">\</span><span class="variable">$cmds</span><span class="symbol">~\</span><span class="variable">$rm</span><span class="normal"> </span><span class="variable">$delfiles</span><span class="normal">\"</span>
<span class="normal">	</span><span class="keyword">fi</span>
<span class="normal">	</span><span class="variable">save_ifs</span><span class="symbol">=</span><span class="string">"$IFS"</span><span class="symbol">;</span><span class="normal"> </span><span class="variable">IFS</span><span class="symbol">=</span><span class="string">'~'</span>
<span class="normal">	</span><span class="keyword">for</span><span class="normal"> cmd </span><span class="keyword">in</span><span class="normal"> </span><span class="variable">$cmds</span><span class="symbol">;</span><span class="normal"> </span><span class="keyword">do</span>
<span class="normal">	  </span><span class="variable">IFS</span><span class="symbol">=</span><span class="string">"$save_ifs"</span>
<span class="normal">	  </span><span class="keyword">eval</span><span class="normal"> </span><span class="variable">cmd</span><span class="symbol">=</span><span class="normal">\"</span><span class="variable">$cmd</span><span class="normal">\"</span>
<span class="normal">	  </span><span class="variable">$show</span><span class="normal"> </span><span class="string">"$cmd"</span>
<span class="normal">	  </span><span class="variable">$run</span><span class="normal"> </span><span class="keyword">eval</span><span class="normal"> </span><span class="string">"$cmd"</span><span class="normal"> </span><span class="symbol">||</span><span class="normal"> {</span>
<span class="normal">	    </span><span class="variable">lt_exit</span><span class="symbol">=</span><span class="variable">$?</span>

<span class="normal">	    </span><span class="comment"># Restore the uninstalled library and exit</span>
<span class="normal">	    </span><span class="keyword">if</span><span class="normal"> </span><span class="keyword">test</span><span class="normal"> </span><span class="string">"$mode"</span><span class="normal"> </span><span class="symbol">=</span><span class="normal"> relink</span><span class="symbol">;</span><span class="normal"> </span><span class="keyword">then</span>
<span class="normal">	      </span><span class="variable">$run</span><span class="normal"> </span><span class="keyword">eval</span><span class="normal"> </span><span class="string">'(cd $output_objdir &amp;&amp; $rm ${realname}T &amp;&amp; $mv ${realname}U $realname)'</span>
<span class="normal">	    </span><span class="keyword">fi</span>

<span class="normal">	    </span><span class="keyword">exit</span><span class="normal"> </span><span class="variable">$lt_exit</span>
<span class="normal">	  }</span>
<span class="normal">	</span><span class="keyword">done</span>
<span class="normal">	</span><span class="variable">IFS</span><span class="symbol">=</span><span class="string">"$save_ifs"</span>

<span class="normal">	</span><span class="comment"># Restore the uninstalled library and exit</span>
<span class="normal">	</span><span class="keyword">if</span><span class="normal"> </span><span class="keyword">test</span><span class="normal"> </span><span class="string">"$mode"</span><span class="normal"> </span><span class="symbol">=</span><span class="normal"> relink</span><span class="symbol">;</span><span class="normal"> </span><span class="keyword">then</span>
<span class="normal">	  </span><span class="variable">$run</span><span class="normal"> </span><span class="keyword">eval</span><span class="normal"> </span><span class="string">'(cd $output_objdir &amp;&amp; $rm ${realname}T &amp;&amp; $mv $realname ${realname}T &amp;&amp; $mv "$realname"U $realname)'</span><span class="normal"> </span><span class="symbol">||</span><span class="normal"> </span><span class="keyword">exit</span><span class="normal"> </span><span class="variable">$?</span>

<span class="normal">	  </span><span class="keyword">if</span><span class="normal"> </span><span class="keyword">test</span><span class="normal"> -n </span><span class="string">"$convenience"</span><span class="symbol">;</span><span class="normal"> </span><span class="keyword">then</span>
<span class="normal">	    </span><span class="keyword">if</span><span class="normal"> </span><span class="keyword">test</span><span class="normal"> -z </span><span class="string">"$whole_archive_flag_spec"</span><span class="symbol">;</span><span class="normal"> </span><span class="keyword">then</span>
<span class="normal">	      </span><span class="variable">$show</span><span class="normal"> </span><span class="string">"${rm}r $gentop"</span>
<span class="normal">	      </span><span class="variable">$run</span><span class="normal"> </span><span class="variable">${rm}</span><span class="normal">r </span><span class="string">"$gentop"</span>
<span class="normal">	    </span><span class="keyword">fi</span>
<span class="normal">	  </span><span class="keyword">fi</span>

<span class="normal">	  </span><span class="keyword">exit</span><span class="normal"> </span><span class="variable">$EXIT_SUCCESS</span>
<span class="normal">	</span><span class="keyword">fi</span>

<span class="normal">	</span><span class="comment"># Create links to the real library.</span>
<span class="normal">	</span><span class="keyword">for</span><span class="normal"> linkname </span><span class="keyword">in</span><span class="normal"> </span><span class="variable">$linknames</span><span class="symbol">;</span><span class="normal"> </span><span class="keyword">do</span>
<span class="normal">	  </span><span class="keyword">if</span><span class="normal"> </span><span class="keyword">test</span><span class="normal"> </span><span class="string">"$realname"</span><span class="normal"> </span><span class="symbol">!=</span><span class="normal"> </span><span class="string">"$linkname"</span><span class="symbol">;</span><span class="normal"> </span><span class="keyword">then</span>
<span class="normal">	    </span><span class="variable">$show</span><span class="normal"> </span><span class="string">"(cd $output_objdir &amp;&amp; $rm $linkname &amp;&amp; $LN_S $realname $linkname)"</span>
<span class="normal">	    </span><span class="variable">$run</span><span class="normal"> </span><span class="keyword">eval</span><span class="normal"> </span><span class="string">'(cd $output_objdir &amp;&amp; $rm $linkname &amp;&amp; $LN_S $realname $linkname)'</span><span class="normal"> </span><span class="symbol">||</span><span class="normal"> </span><span class="keyword">exit</span><span class="normal"> </span><span class="variable">$?</span>
<span class="normal">	  </span><span class="keyword">fi</span>
<span class="normal">	</span><span class="keyword">done</span>

<span class="normal">	</span><span class="comment"># If -module or -export-dynamic was specified, set the dlname.</span>
<span class="normal">	</span><span class="keyword">if</span><span class="normal"> </span><span class="keyword">test</span><span class="normal"> </span><span class="string">"$module"</span><span class="normal"> </span><span class="symbol">=</span><span class="normal"> yes </span><span class="symbol">||</span><span class="normal"> </span><span class="keyword">test</span><span class="normal"> </span><span class="string">"$export_dynamic"</span><span class="normal"> </span><span class="symbol">=</span><span class="normal"> yes</span><span class="symbol">;</span><span class="normal"> </span><span class="keyword">then</span>
<span class="normal">	  </span><span class="comment"># On all known operating systems, these are identical.</span>
<span class="normal">	  </span><span class="variable">dlname</span><span class="symbol">=</span><span class="string">"$soname"</span>
<span class="normal">	</span><span class="keyword">fi</span>
<span class="normal">      </span><span class="keyword">fi</span>
<span class="normal">      </span><span class="symbol">;;</span>

<span class="normal">    obj</span><span class="symbol">)</span>
<span class="normal">      </span><span class="keyword">if</span><span class="normal"> </span><span class="keyword">test</span><span class="normal"> -n </span><span class="string">"$deplibs"</span><span class="symbol">;</span><span class="normal"> </span><span class="keyword">then</span>
<span class="normal">	</span><span class="variable">$echo</span><span class="normal"> </span><span class="string">"$modename: warning: </span><span class="specialchar">\`</span><span class="string">-l' and </span><span class="specialchar">\`</span><span class="string">-L' are ignored for objects"</span><span class="normal"> </span><span class="number">1</span><span class="symbol">&gt;&amp;</span><span class="number">2</span>
<span class="normal">      </span><span class="keyword">fi</span>

<span class="normal">      </span><span class="keyword">if</span><span class="normal"> </span><span class="keyword">test</span><span class="normal"> -n </span><span class="string">"$dlfiles$dlprefiles"</span><span class="normal"> </span><span class="symbol">||</span><span class="normal"> </span><span class="keyword">test</span><span class="normal"> </span><span class="string">"$dlself"</span><span class="normal"> </span><span class="symbol">!=</span><span class="normal"> no</span><span class="symbol">;</span><span class="normal"> </span><span class="keyword">then</span>
<span class="normal">	</span><span class="variable">$echo</span><span class="normal"> </span><span class="string">"$modename: warning: </span><span class="specialchar">\`</span><span class="string">-dlopen' is ignored for objects"</span><span class="normal"> </span><span class="number">1</span><span class="symbol">&gt;&amp;</span><span class="number">2</span>
<span class="normal">      </span><span class="keyword">fi</span>

<span class="normal">      </span><span class="keyword">if</span><span class="normal"> </span><span class="keyword">test</span><span class="normal"> -n </span><span class="string">"$rpath"</span><span class="symbol">;</span><span class="normal"> </span><span class="keyword">then</span>
<span class="normal">	</span><span class="variable">$echo</span><span class="normal"> </span><span class="string">"$modename: warning: </span><span class="specialchar">\`</span><span class="string">-rpath' is ignored for objects"</span><span class="normal"> </span><span class="number">1</span><span class="symbol">&gt;&amp;</span><span class="number">2</span>
<span class="normal">      </span><span class="keyword">fi</span>

<span class="normal">      </span><span class="keyword">if</span><span class="normal"> </span><span class="keyword">test</span><span class="normal"> -n </span><span class="string">"$xrpath"</span><span class="symbol">;</span><span class="normal"> </span><span class="keyword">then</span>
<span class="normal">	</span><span class="variable">$echo</span><span class="normal"> </span><span class="string">"$modename: warning: </span><span class="specialchar">\`</span><span class="string">-R' is ignored for objects"</span><span class="normal"> </span><span class="number">1</span><span class="symbol">&gt;&amp;</span><span class="number">2</span>
<span class="normal">      </span><span class="keyword">fi</span>

<span class="normal">      </span><span class="keyword">if</span><span class="normal"> </span><span class="keyword">test</span><span class="normal"> -n </span><span class="string">"$vinfo"</span><span class="symbol">;</span><span class="normal"> </span><span class="keyword">then</span>
<span class="normal">	</span><span class="variable">$echo</span><span class="normal"> </span><span class="string">"$modename: warning: </span><span class="specialchar">\`</span><span class="string">-version-info' is ignored for objects"</span><span class="normal"> </span><span class="number">1</span><span class="symbol">&gt;&amp;</span><span class="number">2</span>
<span class="normal">      </span><span class="keyword">fi</span>

<span class="normal">      </span><span class="keyword">if</span><span class="normal"> </span><span class="keyword">test</span><span class="normal"> -n </span><span class="string">"$release"</span><span class="symbol">;</span><span class="normal"> </span><span class="keyword">then</span>
<span class="normal">	</span><span class="variable">$echo</span><span class="normal"> </span><span class="string">"$modename: warning: </span><span class="specialchar">\`</span><span class="string">-release' is ignored for objects"</span><span class="normal"> </span><span class="number">1</span><span class="symbol">&gt;&amp;</span><span class="number">2</span>
<span class="normal">      </span><span class="keyword">fi</span>

<span class="normal">      </span><span class="keyword">case</span><span class="normal"> </span><span class="variable">$output</span><span class="normal"> </span><span class="keyword">in</span>
<span class="normal">      </span><span class="symbol">*.</span><span class="normal">lo</span><span class="symbol">)</span>
<span class="normal">	</span><span class="keyword">if</span><span class="normal"> </span><span class="keyword">test</span><span class="normal"> -n </span><span class="string">"$objs$old_deplibs"</span><span class="symbol">;</span><span class="normal"> </span><span class="keyword">then</span>
<span class="normal">	  </span><span class="variable">$echo</span><span class="normal"> </span><span class="string">"$modename: cannot build library object </span><span class="specialchar">\`</span><span class="string">$output' from non-libtool objects"</span><span class="normal"> </span><span class="number">1</span><span class="symbol">&gt;&amp;</span><span class="number">2</span>
<span class="normal">	  </span><span class="keyword">exit</span><span class="normal"> </span><span class="variable">$EXIT_FAILURE</span>
<span class="normal">	</span><span class="keyword">fi</span>
<span class="normal">	</span><span class="variable">libobj</span><span class="symbol">=</span><span class="string">"$output"</span>
<span class="normal">	</span><span class="variable">obj</span><span class="symbol">=</span><span class="normal">`</span><span class="variable">$echo</span><span class="normal"> </span><span class="string">"X$output"</span><span class="normal"> </span><span class="symbol">|</span><span class="normal"> </span><span class="variable">$Xsed</span><span class="normal"> -e </span><span class="string">"$lo2o"</span><span class="normal">`</span>
<span class="normal">	</span><span class="symbol">;;</span>
<span class="normal">      </span><span class="symbol">*)</span>
<span class="normal">	</span><span class="variable">libobj</span><span class="symbol">=</span>
<span class="normal">	</span><span class="variable">obj</span><span class="symbol">=</span><span class="string">"$output"</span>
<span class="normal">	</span><span class="symbol">;;</span>
<span class="normal">      </span><span class="keyword">esac</span>

<span class="normal">      </span><span class="comment"># Delete the old objects.</span>
<span class="normal">      </span><span class="variable">$run</span><span class="normal"> </span><span class="variable">$rm</span><span class="normal"> </span><span class="variable">$obj</span><span class="normal"> </span><span class="variable">$libobj</span>

<span class="normal">      </span><span class="comment"># Objects from convenience libraries.  This assumes</span>
<span class="normal">      </span><span class="comment"># single-version convenience libraries.  Whenever we create</span>
<span class="normal">      </span><span class="comment"># different ones for PIC/non-PIC, this we'll have to duplicate</span>
<span class="normal">      </span><span class="comment"># the extraction.</span>
<span class="normal">      </span><span class="variable">reload_conv_objs</span><span class="symbol">=</span>
<span class="normal">      </span><span class="variable">gentop</span><span class="symbol">=</span>
<span class="normal">      </span><span class="comment"># reload_cmds runs $LD directly, so let us get rid of</span>
<span class="normal">      </span><span class="comment"># -Wl from whole_archive_flag_spec and hope we can get by with</span>
<span class="normal">      </span><span class="comment"># turning comma into space..</span>
<span class="normal">      </span><span class="variable">wl</span><span class="symbol">=</span>

<span class="normal">      </span><span class="keyword">if</span><span class="normal"> </span><span class="keyword">test</span><span class="normal"> -n </span><span class="string">"$convenience"</span><span class="symbol">;</span><span class="normal"> </span><span class="keyword">then</span>
<span class="normal">	</span><span class="keyword">if</span><span class="normal"> </span><span class="keyword">test</span><span class="normal"> -n </span><span class="string">"$whole_archive_flag_spec"</span><span class="symbol">;</span><span class="normal"> </span><span class="keyword">then</span>
<span class="normal">	  </span><span class="keyword">eval</span><span class="normal"> </span><span class="variable">tmp_whole_archive_flags</span><span class="symbol">=</span><span class="normal">\"</span><span class="variable">$whole_archive_flag_spec</span><span class="normal">\"</span>
<span class="normal">	  </span><span class="variable">reload_conv_objs</span><span class="symbol">=</span><span class="variable">$reload_objs</span><span class="symbol">\</span><span class="normal"> `</span><span class="variable">$echo</span><span class="normal"> </span><span class="string">"X$tmp_whole_archive_flags"</span><span class="normal"> </span><span class="symbol">|</span><span class="normal"> </span><span class="variable">$Xsed</span><span class="normal"> -e </span><span class="string">'s|,| |g'</span><span class="normal">`</span>
<span class="normal">	</span><span class="keyword">else</span>
<span class="normal">	  </span><span class="variable">gentop</span><span class="symbol">=</span><span class="string">"$output_objdir/${obj}x"</span>
<span class="normal">	  </span><span class="variable">generated</span><span class="symbol">=</span><span class="string">"$generated $gentop"</span>

<span class="normal">	  func_extract_archives </span><span class="variable">$gentop</span><span class="normal"> </span><span class="variable">$convenience</span>
<span class="normal">	  </span><span class="variable">reload_conv_objs</span><span class="symbol">=</span><span class="string">"$reload_objs $func_extract_archives_result"</span>
<span class="normal">	</span><span class="keyword">fi</span>
<span class="normal">      </span><span class="keyword">fi</span>

<span class="normal">      </span><span class="comment"># Create the old-style object.</span>
<span class="normal">      </span><span class="variable">reload_objs</span><span class="symbol">=</span><span class="string">"$objs$old_deplibs "</span><span class="normal">`</span><span class="variable">$echo</span><span class="normal"> </span><span class="string">"X$libobjs"</span><span class="normal"> </span><span class="symbol">|</span><span class="normal"> </span><span class="variable">$SP2NL</span><span class="normal"> </span><span class="symbol">|</span><span class="normal"> </span><span class="variable">$Xsed</span><span class="normal"> -e </span><span class="string">'/</span><span class="specialchar">\.</span><span class="string">'</span><span class="variable">${libext}$'</span><span class="normal">/d</span><span class="string">' -e '</span><span class="symbol">/\.</span><span class="normal">lib</span><span class="variable">$/</span><span class="normal">d</span><span class="string">' -e "$lo2o" | $NL2SP`" $reload_conv_objs" ### testsuite: skip nested quoting test</span>

<span class="string">      output="$obj"</span>
<span class="string">      cmds=$reload_cmds</span>
<span class="string">      save_ifs="$IFS"; IFS='</span><span class="symbol">~</span><span class="string">'</span>
<span class="string">      for cmd in $cmds; do</span>
<span class="string">	IFS="$save_ifs"</span>
<span class="string">	eval cmd=</span><span class="specialchar">\"</span><span class="string">$cmd</span><span class="specialchar">\"</span>
<span class="string">	$show "$cmd"</span>
<span class="string">	$run eval "$cmd" || exit $?</span>
<span class="string">      done</span>
<span class="string">      IFS="$save_ifs"</span>

<span class="string">      # Exit if we aren'</span><span class="normal">t doing a library object file</span><span class="symbol">.</span>
<span class="normal">      </span><span class="keyword">if</span><span class="normal"> </span><span class="keyword">test</span><span class="normal"> -z </span><span class="string">"$libobj"</span><span class="symbol">;</span><span class="normal"> </span><span class="keyword">then</span>
<span class="normal">	</span><span class="keyword">if</span><span class="normal"> </span><span class="keyword">test</span><span class="normal"> -n </span><span class="string">"$gentop"</span><span class="symbol">;</span><span class="normal"> </span><span class="keyword">then</span>
<span class="normal">	  </span><span class="variable">$show</span><span class="normal"> </span><span class="string">"${rm}r $gentop"</span>
<span class="normal">	  </span><span class="variable">$run</span><span class="normal"> </span><span class="variable">${rm}</span><span class="normal">r </span><span class="variable">$gentop</span>
<span class="normal">	</span><span class="keyword">fi</span>

<span class="normal">	</span><span class="keyword">exit</span><span class="normal"> </span><span class="variable">$EXIT_SUCCESS</span>
<span class="normal">      </span><span class="keyword">fi</span>

<span class="normal">      </span><span class="keyword">if</span><span class="normal"> </span><span class="keyword">test</span><span class="normal"> </span><span class="string">"$build_libtool_libs"</span><span class="normal"> </span><span class="symbol">!=</span><span class="normal"> yes</span><span class="symbol">;</span><span class="normal"> </span><span class="keyword">then</span>
<span class="normal">	</span><span class="keyword">if</span><span class="normal"> </span><span class="keyword">test</span><span class="normal"> -n </span><span class="string">"$gentop"</span><span class="symbol">;</span><span class="normal"> </span><span class="keyword">then</span>
<span class="normal">	  </span><span class="variable">$show</span><span class="normal"> </span><span class="string">"${rm}r $gentop"</span>
<span class="normal">	  </span><span class="variable">$run</span><span class="normal"> </span><span class="variable">${rm}</span><span class="normal">r </span><span class="variable">$gentop</span>
<span class="normal">	</span><span class="keyword">fi</span>

<span class="normal">	</span><span class="comment"># Create an invalid libtool object if no PIC, so that we don't</span>
<span class="normal">	</span><span class="comment"># accidentally link it into a program.</span>
<span class="normal">	</span><span class="comment"># $show "echo timestamp &gt; $libobj"</span>
<span class="normal">	</span><span class="comment"># $run eval "echo timestamp &gt; $libobj" || exit $?</span>
<span class="normal">	</span><span class="keyword">exit</span><span class="normal"> </span><span class="variable">$EXIT_SUCCESS</span>
<span class="normal">      </span><span class="keyword">fi</span>

<span class="normal">      </span><span class="keyword">if</span><span class="normal"> </span><span class="keyword">test</span><span class="normal"> -n </span><span class="string">"$pic_flag"</span><span class="normal"> </span><span class="symbol">||</span><span class="normal"> </span><span class="keyword">test</span><span class="normal"> </span><span class="string">"$pic_mode"</span><span class="normal"> </span><span class="symbol">!=</span><span class="normal"> default</span><span class="symbol">;</span><span class="normal"> </span><span class="keyword">then</span>
<span class="normal">	</span><span class="comment"># Only do commands if we really have different PIC objects.</span>
<span class="normal">	</span><span class="variable">reload_objs</span><span class="symbol">=</span><span class="string">"$libobjs $reload_conv_objs"</span>
<span class="normal">	</span><span class="variable">output</span><span class="symbol">=</span><span class="string">"$libobj"</span>
<span class="normal">	</span><span class="variable">cmds</span><span class="symbol">=</span><span class="variable">$reload_cmds</span>
<span class="normal">	</span><span class="variable">save_ifs</span><span class="symbol">=</span><span class="string">"$IFS"</span><span class="symbol">;</span><span class="normal"> </span><span class="variable">IFS</span><span class="symbol">=</span><span class="string">'~'</span>
<span class="normal">	</span><span class="keyword">for</span><span class="normal"> cmd </span><span class="keyword">in</span><span class="normal"> </span><span class="variable">$cmds</span><span class="symbol">;</span><span class="normal"> </span><span class="keyword">do</span>
<span class="normal">	  </span><span class="variable">IFS</span><span class="symbol">=</span><span class="string">"$save_ifs"</span>
<span class="normal">	  </span><span class="keyword">eval</span><span class="normal"> </span><span class="variable">cmd</span><span class="symbol">=</span><span class="normal">\"</span><span class="variable">$cmd</span><span class="normal">\"</span>
<span class="normal">	  </span><span class="variable">$show</span><span class="normal"> </span><span class="string">"$cmd"</span>
<span class="normal">	  </span><span class="variable">$run</span><span class="normal"> </span><span class="keyword">eval</span><span class="normal"> </span><span class="string">"$cmd"</span><span class="normal"> </span><span class="symbol">||</span><span class="normal"> </span><span class="keyword">exit</span><span class="normal"> </span><span class="variable">$?</span>
<span class="normal">	</span><span class="keyword">done</span>
<span class="normal">	</span><span class="variable">IFS</span><span class="symbol">=</span><span class="string">"$save_ifs"</span>
<span class="normal">      </span><span class="keyword">fi</span>

<span class="normal">      </span><span class="keyword">if</span><span class="normal"> </span><span class="keyword">test</span><span class="normal"> -n </span><span class="string">"$gentop"</span><span class="symbol">;</span><span class="normal"> </span><span class="keyword">then</span>
<span class="normal">	</span><span class="variable">$show</span><span class="normal"> </span><span class="string">"${rm}r $gentop"</span>
<span class="normal">	</span><span class="variable">$run</span><span class="normal"> </span><span class="variable">${rm}</span><span class="normal">r </span><span class="variable">$gentop</span>
<span class="normal">      </span><span class="keyword">fi</span>

<span class="normal">      </span><span class="keyword">exit</span><span class="normal"> </span><span class="variable">$EXIT_SUCCESS</span>
<span class="normal">      </span><span class="symbol">;;</span>

<span class="normal">    prog</span><span class="symbol">)</span>
<span class="normal">      </span><span class="keyword">case</span><span class="normal"> </span><span class="variable">$host</span><span class="normal"> </span><span class="keyword">in</span>
<span class="normal">	</span><span class="symbol">*</span><span class="normal">cygwin</span><span class="symbol">*)</span><span class="normal"> </span><span class="variable">output</span><span class="symbol">=</span><span class="normal">`</span><span class="variable">$echo</span><span class="normal"> </span><span class="variable">$output</span><span class="normal"> </span><span class="symbol">|</span><span class="normal"> </span><span class="variable">${SED}</span><span class="normal"> -e </span><span class="string">'s,.exe$,,;s,$,.exe,'</span><span class="normal">` </span><span class="symbol">;;</span>
<span class="normal">      </span><span class="keyword">esac</span>
<span class="normal">      </span><span class="keyword">if</span><span class="normal"> </span><span class="keyword">test</span><span class="normal"> -n </span><span class="string">"$vinfo"</span><span class="symbol">;</span><span class="normal"> </span><span class="keyword">then</span>
<span class="normal">	</span><span class="variable">$echo</span><span class="normal"> </span><span class="string">"$modename: warning: </span><span class="specialchar">\`</span><span class="string">-version-info' is ignored for programs"</span><span class="normal"> </span><span class="number">1</span><span class="symbol">&gt;&amp;</span><span class="number">2</span>
<span class="normal">      </span><span class="keyword">fi</span>

<span class="normal">      </span><span class="keyword">if</span><span class="normal"> </span><span class="keyword">test</span><span class="normal"> -n </span><span class="string">"$release"</span><span class="symbol">;</span><span class="normal"> </span><span class="keyword">then</span>
<span class="normal">	</span><span class="variable">$echo</span><span class="normal"> </span><span class="string">"$modename: warning: </span><span class="specialchar">\`</span><span class="string">-release' is ignored for programs"</span><span class="normal"> </span><span class="number">1</span><span class="symbol">&gt;&amp;</span><span class="number">2</span>
<span class="normal">      </span><span class="keyword">fi</span>

<span class="normal">      </span><span class="keyword">if</span><span class="normal"> </span><span class="keyword">test</span><span class="normal"> </span><span class="string">"$preload"</span><span class="normal"> </span><span class="symbol">=</span><span class="normal"> yes</span><span class="symbol">;</span><span class="normal"> </span><span class="keyword">then</span>
<span class="normal">	</span><span class="keyword">if</span><span class="normal"> </span><span class="keyword">test</span><span class="normal"> </span><span class="string">"$dlopen_support"</span><span class="normal"> </span><span class="symbol">=</span><span class="normal"> unknown </span><span class="symbol">&amp;&amp;</span><span class="normal"> </span><span class="keyword">test</span><span class="normal"> </span><span class="string">"$dlopen_self"</span><span class="normal"> </span><span class="symbol">=</span><span class="normal"> unknown </span><span class="symbol">&amp;&amp;</span>
<span class="normal">	   </span><span class="keyword">test</span><span class="normal"> </span><span class="string">"$dlopen_self_static"</span><span class="normal"> </span><span class="symbol">=</span><span class="normal"> unknown</span><span class="symbol">;</span><span class="normal"> </span><span class="keyword">then</span>
<span class="normal">	  </span><span class="variable">$echo</span><span class="normal"> </span><span class="string">"$modename: warning: </span><span class="specialchar">\`</span><span class="string">AC_LIBTOOL_DLOPEN' not used. Assuming no dlopen support."</span>
<span class="normal">	</span><span class="keyword">fi</span>
<span class="normal">      </span><span class="keyword">fi</span>

<span class="normal">      </span><span class="keyword">case</span><span class="normal"> </span><span class="variable">$host</span><span class="normal"> </span><span class="keyword">in</span>
<span class="normal">      </span><span class="symbol">*</span><span class="normal">-</span><span class="symbol">*</span><span class="normal">-rhapsody</span><span class="symbol">*</span><span class="normal"> </span><span class="symbol">|</span><span class="normal"> </span><span class="symbol">*</span><span class="normal">-</span><span class="symbol">*</span><span class="normal">-darwin</span><span class="number">1</span><span class="symbol">.[</span><span class="number">012</span><span class="symbol">])</span>
<span class="normal">	</span><span class="comment"># On Rhapsody replace the C library is the System framework</span>
<span class="normal">	</span><span class="variable">compile_deplibs</span><span class="symbol">=</span><span class="normal">`</span><span class="variable">$echo</span><span class="normal"> </span><span class="string">"X $compile_deplibs"</span><span class="normal"> </span><span class="symbol">|</span><span class="normal"> </span><span class="variable">$Xsed</span><span class="normal"> -e </span><span class="string">'s/ -lc / -framework System /'</span><span class="normal">`</span>
<span class="normal">	</span><span class="variable">finalize_deplibs</span><span class="symbol">=</span><span class="normal">`</span><span class="variable">$echo</span><span class="normal"> </span><span class="string">"X $finalize_deplibs"</span><span class="normal"> </span><span class="symbol">|</span><span class="normal"> </span><span class="variable">$Xsed</span><span class="normal"> -e </span><span class="string">'s/ -lc / -framework System /'</span><span class="normal">`</span>
<span class="normal">	</span><span class="symbol">;;</span>
<span class="normal">      </span><span class="keyword">esac</span>

<span class="normal">      </span><span class="keyword">case</span><span class="normal"> </span><span class="variable">$host</span><span class="normal"> </span><span class="keyword">in</span>
<span class="normal">      </span><span class="symbol">*</span><span class="normal">darwin</span><span class="symbol">*)</span>
<span class="normal">        </span><span class="comment"># Don't allow lazy linking, it breaks C++ global constructors</span>
<span class="normal">        </span><span class="keyword">if</span><span class="normal"> </span><span class="keyword">test</span><span class="normal"> </span><span class="string">"$tagname"</span><span class="normal"> </span><span class="symbol">=</span><span class="normal"> CXX </span><span class="symbol">;</span><span class="normal"> </span><span class="keyword">then</span>
<span class="normal">        </span><span class="variable">compile_command</span><span class="symbol">=</span><span class="string">"$compile_command ${wl}-bind_at_load"</span>
<span class="normal">        </span><span class="variable">finalize_command</span><span class="symbol">=</span><span class="string">"$finalize_command ${wl}-bind_at_load"</span>
<span class="normal">        </span><span class="keyword">fi</span>
<span class="normal">        </span><span class="symbol">;;</span>
<span class="normal">      </span><span class="keyword">esac</span>


<span class="normal">      </span><span class="comment"># move library search paths that coincide with paths to not yet</span>
<span class="normal">      </span><span class="comment"># installed libraries to the beginning of the library search list</span>
<span class="normal">      </span><span class="variable">new_libs</span><span class="symbol">=</span>
<span class="normal">      </span><span class="keyword">for</span><span class="normal"> path </span><span class="keyword">in</span><span class="normal"> </span><span class="variable">$notinst_path</span><span class="symbol">;</span><span class="normal"> </span><span class="keyword">do</span>
<span class="normal">	</span><span class="keyword">case</span><span class="normal"> </span><span class="string">" $new_libs "</span><span class="normal"> </span><span class="keyword">in</span>
<span class="normal">	</span><span class="symbol">*</span><span class="string">" -L$path/$objdir "</span><span class="symbol">*)</span><span class="normal"> </span><span class="symbol">;;</span>
<span class="normal">	</span><span class="symbol">*)</span>
<span class="normal">	  </span><span class="keyword">case</span><span class="normal"> </span><span class="string">" $compile_deplibs "</span><span class="normal"> </span><span class="keyword">in</span>
<span class="normal">	  </span><span class="symbol">*</span><span class="string">" -L$path/$objdir "</span><span class="symbol">*)</span>
<span class="normal">	    </span><span class="variable">new_libs</span><span class="symbol">=</span><span class="string">"$new_libs -L$path/$objdir"</span><span class="normal"> </span><span class="symbol">;;</span>
<span class="normal">	  </span><span class="keyword">esac</span>
<span class="normal">	  </span><span class="symbol">;;</span>
<span class="normal">	</span><span class="keyword">esac</span>
<span class="normal">      </span><span class="keyword">done</span>
<span class="normal">      </span><span class="keyword">for</span><span class="normal"> deplib </span><span class="keyword">in</span><span class="normal"> </span><span class="variable">$compile_deplibs</span><span class="symbol">;</span><span class="normal"> </span><span class="keyword">do</span>
<span class="normal">	</span><span class="keyword">case</span><span class="normal"> </span><span class="variable">$deplib</span><span class="normal"> </span><span class="keyword">in</span>
<span class="normal">	-L</span><span class="symbol">*)</span>
<span class="normal">	  </span><span class="keyword">case</span><span class="normal"> </span><span class="string">" $new_libs "</span><span class="normal"> </span><span class="keyword">in</span>
<span class="normal">	  </span><span class="symbol">*</span><span class="string">" $deplib "</span><span class="symbol">*)</span><span class="normal"> </span><span class="symbol">;;</span>
<span class="normal">	  </span><span class="symbol">*)</span><span class="normal"> </span><span class="variable">new_libs</span><span class="symbol">=</span><span class="string">"$new_libs $deplib"</span><span class="normal"> </span><span class="symbol">;;</span>
<span class="normal">	  </span><span class="keyword">esac</span>
<span class="normal">	  </span><span class="symbol">;;</span>
<span class="normal">	</span><span class="symbol">*)</span><span class="normal"> </span><span class="variable">new_libs</span><span class="symbol">=</span><span class="string">"$new_libs $deplib"</span><span class="normal"> </span><span class="symbol">;;</span>
<span class="normal">	</span><span class="keyword">esac</span>
<span class="normal">      </span><span class="keyword">done</span>
<span class="normal">      </span><span class="variable">compile_deplibs</span><span class="symbol">=</span><span class="string">"$new_libs"</span>


<span class="normal">      </span><span class="variable">compile_command</span><span class="symbol">=</span><span class="string">"$compile_command $compile_deplibs"</span>
<span class="normal">      </span><span class="variable">finalize_command</span><span class="symbol">=</span><span class="string">"$finalize_command $finalize_deplibs"</span>

<span class="normal">      </span><span class="keyword">if</span><span class="normal"> </span><span class="keyword">test</span><span class="normal"> -n </span><span class="string">"$rpath$xrpath"</span><span class="symbol">;</span><span class="normal"> </span><span class="keyword">then</span>
<span class="normal">	</span><span class="comment"># If the user specified any rpath flags, then add them.</span>
<span class="normal">	</span><span class="keyword">for</span><span class="normal"> libdir </span><span class="keyword">in</span><span class="normal"> </span><span class="variable">$rpath</span><span class="normal"> </span><span class="variable">$xrpath</span><span class="symbol">;</span><span class="normal"> </span><span class="keyword">do</span>
<span class="normal">	  </span><span class="comment"># This is the magic to use -rpath.</span>
<span class="normal">	  </span><span class="keyword">case</span><span class="normal"> </span><span class="string">"$finalize_rpath "</span><span class="normal"> </span><span class="keyword">in</span>
<span class="normal">	  </span><span class="symbol">*</span><span class="string">" $libdir "</span><span class="symbol">*)</span><span class="normal"> </span><span class="symbol">;;</span>
<span class="normal">	  </span><span class="symbol">*)</span><span class="normal"> </span><span class="variable">finalize_rpath</span><span class="symbol">=</span><span class="string">"$finalize_rpath $libdir"</span><span class="normal"> </span><span class="symbol">;;</span>
<span class="normal">	  </span><span class="keyword">esac</span>
<span class="normal">	</span><span class="keyword">done</span>
<span class="normal">      </span><span class="keyword">fi</span>

<span class="normal">      </span><span class="comment"># Now hardcode the library paths</span>
<span class="normal">      </span><span class="variable">rpath</span><span class="symbol">=</span>
<span class="normal">      </span><span class="variable">hardcode_libdirs</span><span class="symbol">=</span>
<span class="normal">      </span><span class="keyword">for</span><span class="normal"> libdir </span><span class="keyword">in</span><span class="normal"> </span><span class="variable">$compile_rpath</span><span class="normal"> </span><span class="variable">$finalize_rpath</span><span class="symbol">;</span><span class="normal"> </span><span class="keyword">do</span>
<span class="normal">	</span><span class="keyword">if</span><span class="normal"> </span><span class="keyword">test</span><span class="normal"> -n </span><span class="string">"$hardcode_libdir_flag_spec"</span><span class="symbol">;</span><span class="normal"> </span><span class="keyword">then</span>
<span class="normal">	  </span><span class="keyword">if</span><span class="normal"> </span><span class="keyword">test</span><span class="normal"> -n </span><span class="string">"$hardcode_libdir_separator"</span><span class="symbol">;</span><span class="normal"> </span><span class="keyword">then</span>
<span class="normal">	    </span><span class="keyword">if</span><span class="normal"> </span><span class="keyword">test</span><span class="normal"> -z </span><span class="string">"$hardcode_libdirs"</span><span class="symbol">;</span><span class="normal"> </span><span class="keyword">then</span>
<span class="normal">	      </span><span class="variable">hardcode_libdirs</span><span class="symbol">=</span><span class="string">"$libdir"</span>
<span class="normal">	    </span><span class="keyword">else</span>
<span class="normal">	      </span><span class="comment"># Just accumulate the unique libdirs.</span>
<span class="normal">	      </span><span class="keyword">case</span><span class="normal"> </span><span class="variable">$hardcode_libdir_separator$hardcode_libdirs$hardcode_libdir_separator</span><span class="normal"> </span><span class="keyword">in</span>
<span class="normal">	      </span><span class="symbol">*</span><span class="string">"$hardcode_libdir_separator$libdir$hardcode_libdir_separator"</span><span class="symbol">*)</span>
<span class="normal">		</span><span class="symbol">;;</span>
<span class="normal">	      </span><span class="symbol">*)</span>
<span class="normal">		</span><span class="variable">hardcode_libdirs</span><span class="symbol">=</span><span class="string">"$hardcode_libdirs$hardcode_libdir_separator$libdir"</span>
<span class="normal">		</span><span class="symbol">;;</span>
<span class="normal">	      </span><span class="keyword">esac</span>
<span class="normal">	    </span><span class="keyword">fi</span>
<span class="normal">	  </span><span class="keyword">else</span>
<span class="normal">	    </span><span class="keyword">eval</span><span class="normal"> </span><span class="variable">flag</span><span class="symbol">=</span><span class="normal">\"</span><span class="variable">$hardcode_libdir_flag_spec</span><span class="normal">\"</span>
<span class="normal">	    </span><span class="variable">rpath</span><span class="symbol">=</span><span class="string">"$rpath $flag"</span>
<span class="normal">	  </span><span class="keyword">fi</span>
<span class="normal">	</span><span class="keyword">elif</span><span class="normal"> </span><span class="keyword">test</span><span class="normal"> -n </span><span class="string">"$runpath_var"</span><span class="symbol">;</span><span class="normal"> </span><span class="keyword">then</span>
<span class="normal">	  </span><span class="keyword">case</span><span class="normal"> </span><span class="string">"$perm_rpath "</span><span class="normal"> </span><span class="keyword">in</span>
<span class="normal">	  </span><span class="symbol">*</span><span class="string">" $libdir "</span><span class="symbol">*)</span><span class="normal"> </span><span class="symbol">;;</span>
<span class="normal">	  </span><span class="symbol">*)</span><span class="normal"> </span><span class="variable">perm_rpath</span><span class="symbol">=</span><span class="string">"$perm_rpath $libdir"</span><span class="normal"> </span><span class="symbol">;;</span>
<span class="normal">	  </span><span class="keyword">esac</span>
<span class="normal">	</span><span class="keyword">fi</span>
<span class="normal">	</span><span class="keyword">case</span><span class="normal"> </span><span class="variable">$host</span><span class="normal"> </span><span class="keyword">in</span>
<span class="normal">	</span><span class="symbol">*</span><span class="normal">-</span><span class="symbol">*</span><span class="normal">-cygwin</span><span class="symbol">*</span><span class="normal"> </span><span class="symbol">|</span><span class="normal"> </span><span class="symbol">*</span><span class="normal">-</span><span class="symbol">*</span><span class="normal">-mingw</span><span class="symbol">*</span><span class="normal"> </span><span class="symbol">|</span><span class="normal"> </span><span class="symbol">*</span><span class="normal">-</span><span class="symbol">*</span><span class="normal">-pw</span><span class="number">32</span><span class="symbol">*</span><span class="normal"> </span><span class="symbol">|</span><span class="normal"> </span><span class="symbol">*</span><span class="normal">-</span><span class="symbol">*</span><span class="normal">-os</span><span class="number">2</span><span class="symbol">*)</span>
<span class="normal">	  </span><span class="variable">testbindir</span><span class="symbol">=</span><span class="normal">`</span><span class="variable">$echo</span><span class="normal"> </span><span class="string">"X$libdir"</span><span class="normal"> </span><span class="symbol">|</span><span class="normal"> </span><span class="variable">$Xsed</span><span class="normal"> -e </span><span class="string">'s*/lib$*/bin*'</span><span class="normal">`</span>
<span class="normal">	  </span><span class="keyword">case</span><span class="normal"> </span><span class="symbol">:</span><span class="variable">$dllsearchpath</span><span class="symbol">:</span><span class="normal"> </span><span class="keyword">in</span>
<span class="normal">	  </span><span class="symbol">*</span><span class="string">":$libdir:"</span><span class="symbol">*)</span><span class="normal"> </span><span class="symbol">;;</span>
<span class="normal">	  </span><span class="symbol">*)</span><span class="normal"> </span><span class="variable">dllsearchpath</span><span class="symbol">=</span><span class="string">"$dllsearchpath:$libdir"</span><span class="symbol">;;</span>
<span class="normal">	  </span><span class="keyword">esac</span>
<span class="normal">	  </span><span class="keyword">case</span><span class="normal"> </span><span class="symbol">:</span><span class="variable">$dllsearchpath</span><span class="symbol">:</span><span class="normal"> </span><span class="keyword">in</span>
<span class="normal">	  </span><span class="symbol">*</span><span class="string">":$testbindir:"</span><span class="symbol">*)</span><span class="normal"> </span><span class="symbol">;;</span>
<span class="normal">	  </span><span class="symbol">*)</span><span class="normal"> </span><span class="variable">dllsearchpath</span><span class="symbol">=</span><span class="string">"$dllsearchpath:$testbindir"</span><span class="symbol">;;</span>
<span class="normal">	  </span><span class="keyword">esac</span>
<span class="normal">	  </span><span class="symbol">;;</span>
<span class="normal">	</span><span class="keyword">esac</span>
<span class="normal">      </span><span class="keyword">done</span>
<span class="normal">      </span><span class="comment"># Substitute the hardcoded libdirs into the rpath.</span>
<span class="normal">      </span><span class="keyword">if</span><span class="normal"> </span><span class="keyword">test</span><span class="normal"> -n </span><span class="string">"$hardcode_libdir_separator"</span><span class="normal"> </span><span class="symbol">&amp;&amp;</span>
<span class="normal">	 </span><span class="keyword">test</span><span class="normal"> -n </span><span class="string">"$hardcode_libdirs"</span><span class="symbol">;</span><span class="normal"> </span><span class="keyword">then</span>
<span class="normal">	</span><span class="variable">libdir</span><span class="symbol">=</span><span class="string">"$hardcode_libdirs"</span>
<span class="normal">	</span><span class="keyword">eval</span><span class="normal"> </span><span class="variable">rpath</span><span class="symbol">=</span><span class="normal">\" </span><span class="variable">$hardcode_libdir_flag_spec</span><span class="normal">\"</span>
<span class="normal">      </span><span class="keyword">fi</span>
<span class="normal">      </span><span class="variable">compile_rpath</span><span class="symbol">=</span><span class="string">"$rpath"</span>

<span class="normal">      </span><span class="variable">rpath</span><span class="symbol">=</span>
<span class="normal">      </span><span class="variable">hardcode_libdirs</span><span class="symbol">=</span>
<span class="normal">      </span><span class="keyword">for</span><span class="normal"> libdir </span><span class="keyword">in</span><span class="normal"> </span><span class="variable">$finalize_rpath</span><span class="symbol">;</span><span class="normal"> </span><span class="keyword">do</span>
<span class="normal">	</span><span class="keyword">if</span><span class="normal"> </span><span class="keyword">test</span><span class="normal"> -n </span><span class="string">"$hardcode_libdir_flag_spec"</span><span class="symbol">;</span><span class="normal"> </span><span class="keyword">then</span>
<span class="normal">	  </span><span class="keyword">if</span><span class="normal"> </span><span class="keyword">test</span><span class="normal"> -n </span><span class="string">"$hardcode_libdir_separator"</span><span class="symbol">;</span><span class="normal"> </span><span class="keyword">then</span>
<span class="normal">	    </span><span class="keyword">if</span><span class="normal"> </span><span class="keyword">test</span><span class="normal"> -z </span><span class="string">"$hardcode_libdirs"</span><span class="symbol">;</span><span class="normal"> </span><span class="keyword">then</span>
<span class="normal">	      </span><span class="variable">hardcode_libdirs</span><span class="symbol">=</span><span class="string">"$libdir"</span>
<span class="normal">	    </span><span class="keyword">else</span>
<span class="normal">	      </span><span class="comment"># Just accumulate the unique libdirs.</span>
<span class="normal">	      </span><span class="keyword">case</span><span class="normal"> </span><span class="variable">$hardcode_libdir_separator$hardcode_libdirs$hardcode_libdir_separator</span><span class="normal"> </span><span class="keyword">in</span>
<span class="normal">	      </span><span class="symbol">*</span><span class="string">"$hardcode_libdir_separator$libdir$hardcode_libdir_separator"</span><span class="symbol">*)</span>
<span class="normal">		</span><span class="symbol">;;</span>
<span class="normal">	      </span><span class="symbol">*)</span>
<span class="normal">		</span><span class="variable">hardcode_libdirs</span><span class="symbol">=</span><span class="string">"$hardcode_libdirs$hardcode_libdir_separator$libdir"</span>
<span class="normal">		</span><span class="symbol">;;</span>
<span class="normal">	      </span><span class="keyword">esac</span>
<span class="normal">	    </span><span class="keyword">fi</span>
<span class="normal">	  </span><span class="keyword">else</span>
<span class="normal">	    </span><span class="keyword">eval</span><span class="normal"> </span><span class="variable">flag</span><span class="symbol">=</span><span class="normal">\"</span><span class="variable">$hardcode_libdir_flag_spec</span><span class="normal">\"</span>
<span class="normal">	    </span><span class="variable">rpath</span><span class="symbol">=</span><span class="string">"$rpath $flag"</span>
<span class="normal">	  </span><span class="keyword">fi</span>
<span class="normal">	</span><span class="keyword">elif</span><span class="normal"> </span><span class="keyword">test</span><span class="normal"> -n </span><span class="string">"$runpath_var"</span><span class="symbol">;</span><span class="normal"> </span><span class="keyword">then</span>
<span class="normal">	  </span><span class="keyword">case</span><span class="normal"> </span><span class="string">"$finalize_perm_rpath "</span><span class="normal"> </span><span class="keyword">in</span>
<span class="normal">	  </span><span class="symbol">*</span><span class="string">" $libdir "</span><span class="symbol">*)</span><span class="normal"> </span><span class="symbol">;;</span>
<span class="normal">	  </span><span class="symbol">*)</span><span class="normal"> </span><span class="variable">finalize_perm_rpath</span><span class="symbol">=</span><span class="string">"$finalize_perm_rpath $libdir"</span><span class="normal"> </span><span class="symbol">;;</span>
<span class="normal">	  </span><span class="keyword">esac</span>
<span class="normal">	</span><span class="keyword">fi</span>
<span class="normal">      </span><span class="keyword">done</span>
<span class="normal">      </span><span class="comment"># Substitute the hardcoded libdirs into the rpath.</span>
<span class="normal">      </span><span class="keyword">if</span><span class="normal"> </span><span class="keyword">test</span><span class="normal"> -n </span><span class="string">"$hardcode_libdir_separator"</span><span class="normal"> </span><span class="symbol">&amp;&amp;</span>
<span class="normal">	 </span><span class="keyword">test</span><span class="normal"> -n </span><span class="string">"$hardcode_libdirs"</span><span class="symbol">;</span><span class="normal"> </span><span class="keyword">then</span>
<span class="normal">	</span><span class="variable">libdir</span><span class="symbol">=</span><span class="string">"$hardcode_libdirs"</span>
<span class="normal">	</span><span class="keyword">eval</span><span class="normal"> </span><span class="variable">rpath</span><span class="symbol">=</span><span class="normal">\" </span><span class="variable">$hardcode_libdir_flag_spec</span><span class="normal">\"</span>
<span class="normal">      </span><span class="keyword">fi</span>
<span class="normal">      </span><span class="variable">finalize_rpath</span><span class="symbol">=</span><span class="string">"$rpath"</span>

<span class="normal">      </span><span class="keyword">if</span><span class="normal"> </span><span class="keyword">test</span><span class="normal"> -n </span><span class="string">"$libobjs"</span><span class="normal"> </span><span class="symbol">&amp;&amp;</span><span class="normal"> </span><span class="keyword">test</span><span class="normal"> </span><span class="string">"$build_old_libs"</span><span class="normal"> </span><span class="symbol">=</span><span class="normal"> yes</span><span class="symbol">;</span><span class="normal"> </span><span class="keyword">then</span>
<span class="normal">	</span><span class="comment"># Transform all the library objects into standard objects.</span>
<span class="normal">	</span><span class="variable">compile_command</span><span class="symbol">=</span><span class="normal">`</span><span class="variable">$echo</span><span class="normal"> </span><span class="string">"X$compile_command"</span><span class="normal"> </span><span class="symbol">|</span><span class="normal"> </span><span class="variable">$SP2NL</span><span class="normal"> </span><span class="symbol">|</span><span class="normal"> </span><span class="variable">$Xsed</span><span class="normal"> -e </span><span class="string">"$lo2o"</span><span class="normal"> </span><span class="symbol">|</span><span class="normal"> </span><span class="variable">$NL2SP</span><span class="normal">`</span>
<span class="normal">	</span><span class="variable">finalize_command</span><span class="symbol">=</span><span class="normal">`</span><span class="variable">$echo</span><span class="normal"> </span><span class="string">"X$finalize_command"</span><span class="normal"> </span><span class="symbol">|</span><span class="normal"> </span><span class="variable">$SP2NL</span><span class="normal"> </span><span class="symbol">|</span><span class="normal"> </span><span class="variable">$Xsed</span><span class="normal"> -e </span><span class="string">"$lo2o"</span><span class="normal"> </span><span class="symbol">|</span><span class="normal"> </span><span class="variable">$NL2SP</span><span class="normal">`</span>
<span class="normal">      </span><span class="keyword">fi</span>

<span class="normal">      </span><span class="variable">dlsyms</span><span class="symbol">=</span>
<span class="normal">      </span><span class="keyword">if</span><span class="normal"> </span><span class="keyword">test</span><span class="normal"> -n </span><span class="string">"$dlfiles$dlprefiles"</span><span class="normal"> </span><span class="symbol">||</span><span class="normal"> </span><span class="keyword">test</span><span class="normal"> </span><span class="string">"$dlself"</span><span class="normal"> </span><span class="symbol">!=</span><span class="normal"> no</span><span class="symbol">;</span><span class="normal"> </span><span class="keyword">then</span>
<span class="normal">	</span><span class="keyword">if</span><span class="normal"> </span><span class="keyword">test</span><span class="normal"> -n </span><span class="string">"$NM"</span><span class="normal"> </span><span class="symbol">&amp;&amp;</span><span class="normal"> </span><span class="keyword">test</span><span class="normal"> -n </span><span class="string">"$global_symbol_pipe"</span><span class="symbol">;</span><span class="normal"> </span><span class="keyword">then</span>
<span class="normal">	  </span><span class="variable">dlsyms</span><span class="symbol">=</span><span class="string">"${outputname}S.c"</span>
<span class="normal">	</span><span class="keyword">else</span>
<span class="normal">	  </span><span class="variable">$echo</span><span class="normal"> </span><span class="string">"$modename: not configured to extract global symbols from dlpreopened files"</span><span class="normal"> </span><span class="number">1</span><span class="symbol">&gt;&amp;</span><span class="number">2</span>
<span class="normal">	</span><span class="keyword">fi</span>
<span class="normal">      </span><span class="keyword">fi</span>

<span class="normal">      </span><span class="keyword">if</span><span class="normal"> </span><span class="keyword">test</span><span class="normal"> -n </span><span class="string">"$dlsyms"</span><span class="symbol">;</span><span class="normal"> </span><span class="keyword">then</span>
<span class="normal">	</span><span class="keyword">case</span><span class="normal"> </span><span class="variable">$dlsyms</span><span class="normal"> </span><span class="keyword">in</span>
<span class="normal">	</span><span class="string">""</span><span class="symbol">)</span><span class="normal"> </span><span class="symbol">;;</span>
<span class="normal">	</span><span class="symbol">*.</span><span class="normal">c</span><span class="symbol">)</span>
<span class="normal">	  </span><span class="comment"># Discover the nlist of each of the dlfiles.</span>
<span class="normal">	  </span><span class="variable">nlist</span><span class="symbol">=</span><span class="string">"$output_objdir/${outputname}.nm"</span>

<span class="normal">	  </span><span class="variable">$show</span><span class="normal"> </span><span class="string">"$rm $nlist ${nlist}S ${nlist}T"</span>
<span class="normal">	  </span><span class="variable">$run</span><span class="normal"> </span><span class="variable">$rm</span><span class="normal"> </span><span class="string">"$nlist"</span><span class="normal"> </span><span class="string">"${nlist}S"</span><span class="normal"> </span><span class="string">"${nlist}T"</span>

<span class="normal">	  </span><span class="comment"># Parse the name list into a source file.</span>
<span class="normal">	  </span><span class="variable">$show</span><span class="normal"> </span><span class="string">"creating $output_objdir/$dlsyms"</span>

<span class="normal">	  </span><span class="keyword">test</span><span class="normal"> -z </span><span class="string">"$run"</span><span class="normal"> </span><span class="symbol">&amp;&amp;</span><span class="normal"> </span><span class="variable">$echo</span><span class="normal"> </span><span class="symbol">&gt;</span><span class="normal"> </span><span class="string">"$output_objdir/$dlsyms"</span><span class="normal"> </span><span class="string">"\</span>
<span class="string">/* $dlsyms - symbol resolution table for </span><span class="specialchar">\`</span><span class="string">$outputname' dlsym emulation. */</span>
<span class="string">/* Generated by $PROGRAM - GNU $PACKAGE $VERSION$TIMESTAMP */</span>

<span class="string">#ifdef __cplusplus</span>
<span class="string">extern </span><span class="specialchar">\"</span><span class="string">C</span><span class="specialchar">\"</span><span class="string"> {</span>
<span class="string">#endif</span>

<span class="string">/* Prevent the only kind of declaration conflicts we can make. */</span>
<span class="string">#define lt_preloaded_symbols some_other_symbol</span>

<span class="string">/* External symbol declarations for the compiler. */\</span>
<span class="string">"</span>

<span class="normal">	  </span><span class="keyword">if</span><span class="normal"> </span><span class="keyword">test</span><span class="normal"> </span><span class="string">"$dlself"</span><span class="normal"> </span><span class="symbol">=</span><span class="normal"> yes</span><span class="symbol">;</span><span class="normal"> </span><span class="keyword">then</span>
<span class="normal">	    </span><span class="variable">$show</span><span class="normal"> </span><span class="string">"generating symbol list for </span><span class="specialchar">\`</span><span class="string">$output'"</span>

<span class="normal">	    </span><span class="keyword">test</span><span class="normal"> -z </span><span class="string">"$run"</span><span class="normal"> </span><span class="symbol">&amp;&amp;</span><span class="normal"> </span><span class="variable">$echo</span><span class="normal"> </span><span class="string">': @PROGRAM@ '</span><span class="normal"> </span><span class="symbol">&gt;</span><span class="normal"> </span><span class="string">"$nlist"</span>

<span class="normal">	    </span><span class="comment"># Add our own program objects to the symbol list.</span>
<span class="normal">	    </span><span class="variable">progfiles</span><span class="symbol">=</span><span class="normal">`</span><span class="variable">$echo</span><span class="normal"> </span><span class="string">"X$objs$old_deplibs"</span><span class="normal"> </span><span class="symbol">|</span><span class="normal"> </span><span class="variable">$SP2NL</span><span class="normal"> </span><span class="symbol">|</span><span class="normal"> </span><span class="variable">$Xsed</span><span class="normal"> -e </span><span class="string">"$lo2o"</span><span class="normal"> </span><span class="symbol">|</span><span class="normal"> </span><span class="variable">$NL2SP</span><span class="normal">`</span>
<span class="normal">	    </span><span class="keyword">for</span><span class="normal"> arg </span><span class="keyword">in</span><span class="normal"> </span><span class="variable">$progfiles</span><span class="symbol">;</span><span class="normal"> </span><span class="keyword">do</span>
<span class="normal">	      </span><span class="variable">$show</span><span class="normal"> </span><span class="string">"extracting global C symbols from </span><span class="specialchar">\`</span><span class="string">$arg'"</span>
<span class="normal">	      </span><span class="variable">$run</span><span class="normal"> </span><span class="keyword">eval</span><span class="normal"> </span><span class="string">"$NM $arg | $global_symbol_pipe &gt;&gt; '$nlist'"</span>
<span class="normal">	    </span><span class="keyword">done</span>

<span class="normal">	    </span><span class="keyword">if</span><span class="normal"> </span><span class="keyword">test</span><span class="normal"> -n </span><span class="string">"$exclude_expsyms"</span><span class="symbol">;</span><span class="normal"> </span><span class="keyword">then</span>
<span class="normal">	      </span><span class="variable">$run</span><span class="normal"> </span><span class="keyword">eval</span><span class="normal"> </span><span class="string">'$EGREP -v " ($exclude_expsyms)$" "$nlist" &gt; "$nlist"T'</span>
<span class="normal">	      </span><span class="variable">$run</span><span class="normal"> </span><span class="keyword">eval</span><span class="normal"> </span><span class="string">'$mv "$nlist"T "$nlist"'</span>
<span class="normal">	    </span><span class="keyword">fi</span>

<span class="normal">	    </span><span class="keyword">if</span><span class="normal"> </span><span class="keyword">test</span><span class="normal"> -n </span><span class="string">"$export_symbols_regex"</span><span class="symbol">;</span><span class="normal"> </span><span class="keyword">then</span>
<span class="normal">	      </span><span class="variable">$run</span><span class="normal"> </span><span class="keyword">eval</span><span class="normal"> </span><span class="string">'$EGREP -e "$export_symbols_regex" "$nlist" &gt; "$nlist"T'</span>
<span class="normal">	      </span><span class="variable">$run</span><span class="normal"> </span><span class="keyword">eval</span><span class="normal"> </span><span class="string">'$mv "$nlist"T "$nlist"'</span>
<span class="normal">	    </span><span class="keyword">fi</span>

<span class="normal">	    </span><span class="comment"># Prepare the list of exported symbols</span>
<span class="normal">	    </span><span class="keyword">if</span><span class="normal"> </span><span class="keyword">test</span><span class="normal"> -z </span><span class="string">"$export_symbols"</span><span class="symbol">;</span><span class="normal"> </span><span class="keyword">then</span>
<span class="normal">	      </span><span class="variable">export_symbols</span><span class="symbol">=</span><span class="string">"$output_objdir/$outputname.exp"</span>
<span class="normal">	      </span><span class="variable">$run</span><span class="normal"> </span><span class="variable">$rm</span><span class="normal"> </span><span class="variable">$export_symbols</span>
<span class="normal">	      </span><span class="variable">$run</span><span class="normal"> </span><span class="keyword">eval</span><span class="normal"> </span><span class="string">"${SED} -n -e '/^: @PROGRAM@ $/d' -e 's/^.* </span><span class="specialchar">\(</span><span class="string">.*</span><span class="specialchar">\)</span><span class="string">$/</span><span class="specialchar">\1</span><span class="string">/p' "'&lt; "$nlist" &gt; "$export_symbols"'</span>
<span class="normal">              </span><span class="keyword">case</span><span class="normal"> </span><span class="variable">$host</span><span class="normal"> </span><span class="keyword">in</span>
<span class="normal">              </span><span class="symbol">*</span><span class="normal">cygwin</span><span class="symbol">*</span><span class="normal"> </span><span class="symbol">|</span><span class="normal"> </span><span class="symbol">*</span><span class="normal">mingw</span><span class="symbol">*</span><span class="normal"> </span><span class="symbol">)</span>
<span class="normal">	        </span><span class="variable">$run</span><span class="normal"> </span><span class="keyword">eval</span><span class="normal"> </span><span class="string">"echo EXPORTS "'&gt; "$output_objdir/$outputname.def"'</span>
<span class="normal">		</span><span class="variable">$run</span><span class="normal"> </span><span class="keyword">eval</span><span class="normal"> </span><span class="string">'cat "$export_symbols" &gt;&gt; "$output_objdir/$outputname.def"'</span>
<span class="normal">                </span><span class="symbol">;;</span>
<span class="normal">              </span><span class="keyword">esac</span>
<span class="normal">	    </span><span class="keyword">else</span>
<span class="normal">	      </span><span class="variable">$run</span><span class="normal"> </span><span class="keyword">eval</span><span class="normal"> </span><span class="string">"${SED} -e 's/</span><span class="specialchar">\(</span><span class="string">[].[*^$]</span><span class="specialchar">\)</span><span class="string">/</span><span class="specialchar">\\\\\1</span><span class="string">/g' -e 's/^/ /' -e 's/$/$/'"' &lt; "$export_symbols" &gt; "$output_objdir/$outputname.exp"'</span>
<span class="normal">	      </span><span class="variable">$run</span><span class="normal"> </span><span class="keyword">eval</span><span class="normal"> </span><span class="string">'grep -f "$output_objdir/$outputname.exp" &lt; "$nlist" &gt; "$nlist"T'</span>
<span class="normal">	      </span><span class="variable">$run</span><span class="normal"> </span><span class="keyword">eval</span><span class="normal"> </span><span class="string">'mv "$nlist"T "$nlist"'</span>
<span class="normal">              </span><span class="keyword">case</span><span class="normal"> </span><span class="variable">$host</span><span class="normal"> </span><span class="keyword">in</span>
<span class="normal">              </span><span class="symbol">*</span><span class="normal">cygwin</span><span class="symbol">*</span><span class="normal"> </span><span class="symbol">|</span><span class="normal"> </span><span class="symbol">*</span><span class="normal">mingw</span><span class="symbol">*</span><span class="normal"> </span><span class="symbol">)</span>
<span class="normal">	        </span><span class="variable">$run</span><span class="normal"> </span><span class="keyword">eval</span><span class="normal"> </span><span class="string">"echo EXPORTS "'&gt; "$output_objdir/$outputname.def"'</span>
<span class="normal">		</span><span class="variable">$run</span><span class="normal"> </span><span class="keyword">eval</span><span class="normal"> </span><span class="string">'cat "$nlist" &gt;&gt; "$output_objdir/$outputname.def"'</span>
<span class="normal">                </span><span class="symbol">;;</span>
<span class="normal">              </span><span class="keyword">esac</span>
<span class="normal">	    </span><span class="keyword">fi</span>
<span class="normal">	  </span><span class="keyword">fi</span>

<span class="normal">	  </span><span class="keyword">for</span><span class="normal"> arg </span><span class="keyword">in</span><span class="normal"> </span><span class="variable">$dlprefiles</span><span class="symbol">;</span><span class="normal"> </span><span class="keyword">do</span>
<span class="normal">	    </span><span class="variable">$show</span><span class="normal"> </span><span class="string">"extracting global C symbols from </span><span class="specialchar">\`</span><span class="string">$arg'"</span>
<span class="normal">	    </span><span class="variable">name</span><span class="symbol">=</span><span class="normal">`</span><span class="variable">$echo</span><span class="normal"> </span><span class="string">"$arg"</span><span class="normal"> </span><span class="symbol">|</span><span class="normal"> </span><span class="variable">${SED}</span><span class="normal"> -e </span><span class="string">'s%^.*/%%'</span><span class="normal">`</span>
<span class="normal">	    </span><span class="variable">$run</span><span class="normal"> </span><span class="keyword">eval</span><span class="normal"> </span><span class="string">'$echo ": $name " &gt;&gt; "$nlist"'</span>
<span class="normal">	    </span><span class="variable">$run</span><span class="normal"> </span><span class="keyword">eval</span><span class="normal"> </span><span class="string">"$NM $arg | $global_symbol_pipe &gt;&gt; '$nlist'"</span>
<span class="normal">	  </span><span class="keyword">done</span>

<span class="normal">	  </span><span class="keyword">if</span><span class="normal"> </span><span class="keyword">test</span><span class="normal"> -z </span><span class="string">"$run"</span><span class="symbol">;</span><span class="normal"> </span><span class="keyword">then</span>
<span class="normal">	    </span><span class="comment"># Make sure we have at least an empty file.</span>
<span class="normal">	    </span><span class="keyword">test</span><span class="normal"> -f </span><span class="string">"$nlist"</span><span class="normal"> </span><span class="symbol">||</span><span class="normal"> </span><span class="symbol">:</span><span class="normal"> </span><span class="symbol">&gt;</span><span class="normal"> </span><span class="string">"$nlist"</span>

<span class="normal">	    </span><span class="keyword">if</span><span class="normal"> </span><span class="keyword">test</span><span class="normal"> -n </span><span class="string">"$exclude_expsyms"</span><span class="symbol">;</span><span class="normal"> </span><span class="keyword">then</span>
<span class="normal">	      </span><span class="variable">$EGREP</span><span class="normal"> -v </span><span class="string">" ($exclude_expsyms)$"</span><span class="normal"> </span><span class="string">"$nlist"</span><span class="normal"> </span><span class="symbol">&gt;</span><span class="normal"> </span><span class="string">"$nlist"</span><span class="normal">T</span>
<span class="normal">	      </span><span class="variable">$mv</span><span class="normal"> </span><span class="string">"$nlist"</span><span class="normal">T </span><span class="string">"$nlist"</span>
<span class="normal">	    </span><span class="keyword">fi</span>

<span class="normal">	    </span><span class="comment"># Try sorting and uniquifying the output.</span>
<span class="normal">	    </span><span class="keyword">if</span><span class="normal"> grep -v </span><span class="string">"^: "</span><span class="normal"> </span><span class="symbol">&lt;</span><span class="normal"> </span><span class="string">"$nlist"</span><span class="normal"> </span><span class="symbol">|</span>
<span class="normal">		</span><span class="keyword">if</span><span class="normal"> sort -k </span><span class="number">3</span><span class="normal"> </span><span class="symbol">&lt;</span><span class="normal">/dev/null </span><span class="symbol">&gt;</span><span class="normal">/dev/null </span><span class="number">2</span><span class="symbol">&gt;&amp;</span><span class="number">1</span><span class="symbol">;</span><span class="normal"> </span><span class="keyword">then</span>
<span class="normal">		  sort -k </span><span class="number">3</span>
<span class="normal">		</span><span class="keyword">else</span>
<span class="normal">		  sort </span><span class="symbol">+</span><span class="number">2</span>
<span class="normal">		</span><span class="keyword">fi</span><span class="normal"> </span><span class="symbol">|</span>
<span class="normal">		uniq </span><span class="symbol">&gt;</span><span class="normal"> </span><span class="string">"$nlist"</span><span class="normal">S</span><span class="symbol">;</span><span class="normal"> </span><span class="keyword">then</span>
<span class="normal">	      </span><span class="symbol">:</span>
<span class="normal">	    </span><span class="keyword">else</span>
<span class="normal">	      grep -v </span><span class="string">"^: "</span><span class="normal"> </span><span class="symbol">&lt;</span><span class="normal"> </span><span class="string">"$nlist"</span><span class="normal"> </span><span class="symbol">&gt;</span><span class="normal"> </span><span class="string">"$nlist"</span><span class="normal">S</span>
<span class="normal">	    </span><span class="keyword">fi</span>

<span class="normal">	    </span><span class="keyword">if</span><span class="normal"> </span><span class="keyword">test</span><span class="normal"> -f </span><span class="string">"$nlist"</span><span class="normal">S</span><span class="symbol">;</span><span class="normal"> </span><span class="keyword">then</span>
<span class="normal">	      </span><span class="keyword">eval</span><span class="normal"> </span><span class="string">"$global_symbol_to_cdecl"' &lt; "$nlist"S &gt;&gt; "$output_objdir/$dlsyms"'</span>
<span class="normal">	    </span><span class="keyword">else</span>
<span class="normal">	      </span><span class="variable">$echo</span><span class="normal"> </span><span class="string">'/* NONE */'</span><span class="normal"> </span><span class="symbol">&gt;&gt;</span><span class="normal"> </span><span class="string">"$output_objdir/$dlsyms"</span>
<span class="normal">	    </span><span class="keyword">fi</span>

<span class="normal">	    </span><span class="variable">$echo</span><span class="normal"> </span><span class="symbol">&gt;&gt;</span><span class="normal"> </span><span class="string">"$output_objdir/$dlsyms"</span><span class="normal"> </span><span class="string">"\</span>

<span class="string">#undef lt_preloaded_symbols</span>

<span class="string">#if defined (__STDC__) &amp;&amp; __STDC__</span>
<span class="string"># define lt_ptr void *</span>
<span class="string">#else</span>
<span class="string"># define lt_ptr char *</span>
<span class="string"># define const</span>
<span class="string">#endif</span>

<span class="string">/* The mapping between symbol names and symbols. */</span>
<span class="string">"</span>

<span class="normal">	    </span><span class="keyword">case</span><span class="normal"> </span><span class="variable">$host</span><span class="normal"> </span><span class="keyword">in</span>
<span class="normal">	    </span><span class="symbol">*</span><span class="normal">cygwin</span><span class="symbol">*</span><span class="normal"> </span><span class="symbol">|</span><span class="normal"> </span><span class="symbol">*</span><span class="normal">mingw</span><span class="symbol">*</span><span class="normal"> </span><span class="symbol">)</span>
<span class="normal">	  </span><span class="variable">$echo</span><span class="normal"> </span><span class="symbol">&gt;&gt;</span><span class="normal"> </span><span class="string">"$output_objdir/$dlsyms"</span><span class="normal"> </span><span class="string">"\</span>
<span class="string">/* DATA imports from DLLs on WIN32 can't be const, because</span>
<span class="string">   runtime relocations are performed -- see ld's documentation</span>
<span class="string">   on pseudo-relocs */</span>
<span class="string">struct {</span>
<span class="string">"</span>
<span class="normal">	      </span><span class="symbol">;;</span>
<span class="normal">	    </span><span class="symbol">*</span><span class="normal"> </span><span class="symbol">)</span>
<span class="normal">	  </span><span class="variable">$echo</span><span class="normal"> </span><span class="symbol">&gt;&gt;</span><span class="normal"> </span><span class="string">"$output_objdir/$dlsyms"</span><span class="normal"> </span><span class="string">"\</span>
<span class="string">const struct {</span>
<span class="string">"</span>
<span class="normal">	      </span><span class="symbol">;;</span>
<span class="normal">	    </span><span class="keyword">esac</span>


<span class="normal">	  </span><span class="variable">$echo</span><span class="normal"> </span><span class="symbol">&gt;&gt;</span><span class="normal"> </span><span class="string">"$output_objdir/$dlsyms"</span><span class="normal"> </span><span class="string">"\</span>
<span class="string">  const char *name;</span>
<span class="string">  lt_ptr address;</span>
<span class="string">}</span>
<span class="string">lt_preloaded_symbols[] =</span>
<span class="string">{\</span>
<span class="string">"</span>

<span class="normal">	    </span><span class="keyword">eval</span><span class="normal"> </span><span class="string">"$global_symbol_to_c_name_address"</span><span class="normal"> </span><span class="symbol">&lt;</span><span class="normal"> </span><span class="string">"$nlist"</span><span class="normal"> </span><span class="symbol">&gt;&gt;</span><span class="normal"> </span><span class="string">"$output_objdir/$dlsyms"</span>

<span class="normal">	    </span><span class="variable">$echo</span><span class="normal"> </span><span class="symbol">&gt;&gt;</span><span class="normal"> </span><span class="string">"$output_objdir/$dlsyms"</span><span class="normal"> </span><span class="string">"\</span>
<span class="string">  {0, (lt_ptr) 0}</span>
<span class="string">};</span>

<span class="string">/* This works around a problem in FreeBSD linker */</span>
<span class="string">#ifdef FREEBSD_WORKAROUND</span>
<span class="string">static const void *lt_preloaded_setup() {</span>
<span class="string">  return lt_preloaded_symbols;</span>
<span class="string">}</span>
<span class="string">#endif</span>

<span class="string">#ifdef __cplusplus</span>
<span class="string">}</span>
<span class="string">#endif\</span>
<span class="string">"</span>
<span class="normal">	  </span><span class="keyword">fi</span>

<span class="normal">	  </span><span class="variable">pic_flag_for_symtable</span><span class="symbol">=</span>
<span class="normal">	  </span><span class="keyword">case</span><span class="normal"> </span><span class="variable">$host</span><span class="normal"> </span><span class="keyword">in</span>
<span class="normal">	  </span><span class="comment"># compiling the symbol table file with pic_flag works around</span>
<span class="normal">	  </span><span class="comment"># a FreeBSD bug that causes programs to crash when -lm is</span>
<span class="normal">	  </span><span class="comment"># linked before any other PIC object.  But we must not use</span>
<span class="normal">	  </span><span class="comment"># pic_flag when linking with -static.  The problem exists in</span>
<span class="normal">	  </span><span class="comment"># FreeBSD 2.2.6 and is fixed in FreeBSD 3.1.</span>
<span class="normal">	  </span><span class="symbol">*</span><span class="normal">-</span><span class="symbol">*</span><span class="normal">-freebsd</span><span class="number">2</span><span class="symbol">*|*</span><span class="normal">-</span><span class="symbol">*</span><span class="normal">-freebsd</span><span class="number">3.0</span><span class="symbol">*|*</span><span class="normal">-</span><span class="symbol">*</span><span class="normal">-freebsdelf</span><span class="number">3.0</span><span class="symbol">*)</span>
<span class="normal">	    </span><span class="keyword">case</span><span class="normal"> </span><span class="string">"$compile_command "</span><span class="normal"> </span><span class="keyword">in</span>
<span class="normal">	    </span><span class="symbol">*</span><span class="string">" -static "</span><span class="symbol">*)</span><span class="normal"> </span><span class="symbol">;;</span>
<span class="normal">	    </span><span class="symbol">*)</span><span class="normal"> </span><span class="variable">pic_flag_for_symtable</span><span class="symbol">=</span><span class="string">" $pic_flag -DFREEBSD_WORKAROUND"</span><span class="symbol">;;</span>
<span class="normal">	    </span><span class="keyword">esac</span><span class="symbol">;;</span>
<span class="normal">	  </span><span class="symbol">*</span><span class="normal">-</span><span class="symbol">*</span><span class="normal">-hpux</span><span class="symbol">*)</span>
<span class="normal">	    </span><span class="keyword">case</span><span class="normal"> </span><span class="string">"$compile_command "</span><span class="normal"> </span><span class="keyword">in</span>
<span class="normal">	    </span><span class="symbol">*</span><span class="string">" -static "</span><span class="symbol">*)</span><span class="normal"> </span><span class="symbol">;;</span>
<span class="normal">	    </span><span class="symbol">*)</span><span class="normal"> </span><span class="variable">pic_flag_for_symtable</span><span class="symbol">=</span><span class="string">" $pic_flag"</span><span class="symbol">;;</span>
<span class="normal">	    </span><span class="keyword">esac</span>
<span class="normal">	  </span><span class="keyword">esac</span>

<span class="normal">	  </span><span class="comment"># Now compile the dynamic symbol file.</span>
<span class="normal">	  </span><span class="variable">$show</span><span class="normal"> </span><span class="string">"(cd $output_objdir &amp;&amp; $LTCC  $LTCFLAGS -c$no_builtin_flag$pic_flag_for_symtable </span><span class="specialchar">\"</span><span class="string">$dlsyms</span><span class="specialchar">\"</span><span class="string">)"</span>
<span class="normal">	  </span><span class="variable">$run</span><span class="normal"> </span><span class="keyword">eval</span><span class="normal"> </span><span class="string">'(cd $output_objdir &amp;&amp; $LTCC  $LTCFLAGS -c$no_builtin_flag$pic_flag_for_symtable "$dlsyms")'</span><span class="normal"> </span><span class="symbol">||</span><span class="normal"> </span><span class="keyword">exit</span><span class="normal"> </span><span class="variable">$?</span>

<span class="normal">	  </span><span class="comment"># Clean up the generated files.</span>
<span class="normal">	  </span><span class="variable">$show</span><span class="normal"> </span><span class="string">"$rm $output_objdir/$dlsyms $nlist ${nlist}S ${nlist}T"</span>
<span class="normal">	  </span><span class="variable">$run</span><span class="normal"> </span><span class="variable">$rm</span><span class="normal"> </span><span class="string">"$output_objdir/$dlsyms"</span><span class="normal"> </span><span class="string">"$nlist"</span><span class="normal"> </span><span class="string">"${nlist}S"</span><span class="normal"> </span><span class="string">"${nlist}T"</span>

<span class="normal">	  </span><span class="comment"># Transform the symbol file into the correct name.</span>
<span class="normal">          </span><span class="keyword">case</span><span class="normal"> </span><span class="variable">$host</span><span class="normal"> </span><span class="keyword">in</span>
<span class="normal">          </span><span class="symbol">*</span><span class="normal">cygwin</span><span class="symbol">*</span><span class="normal"> </span><span class="symbol">|</span><span class="normal"> </span><span class="symbol">*</span><span class="normal">mingw</span><span class="symbol">*</span><span class="normal"> </span><span class="symbol">)</span>
<span class="normal">            </span><span class="keyword">if</span><span class="normal"> </span><span class="keyword">test</span><span class="normal"> -f </span><span class="string">"$output_objdir/${outputname}.def"</span><span class="normal"> </span><span class="symbol">;</span><span class="normal"> </span><span class="keyword">then</span>
<span class="normal">              </span><span class="variable">compile_command</span><span class="symbol">=</span><span class="normal">`</span><span class="variable">$echo</span><span class="normal"> </span><span class="string">"X$compile_command"</span><span class="normal"> </span><span class="symbol">|</span><span class="normal"> </span><span class="variable">$SP2NL</span><span class="normal"> </span><span class="symbol">|</span><span class="normal"> </span><span class="variable">$Xsed</span><span class="normal"> -e </span><span class="string">"s%@SYMFILE@%$output_objdir/${outputname}.def $output_objdir/${outputname}S.${objext}%"</span><span class="normal"> </span><span class="symbol">|</span><span class="normal"> </span><span class="variable">$NL2SP</span><span class="normal">`</span>
<span class="normal">              </span><span class="variable">finalize_command</span><span class="symbol">=</span><span class="normal">`</span><span class="variable">$echo</span><span class="normal"> </span><span class="string">"X$finalize_command"</span><span class="normal"> </span><span class="symbol">|</span><span class="normal"> </span><span class="variable">$SP2NL</span><span class="normal"> </span><span class="symbol">|</span><span class="normal"> </span><span class="variable">$Xsed</span><span class="normal"> -e </span><span class="string">"s%@SYMFILE@%$output_objdir/${outputname}.def $output_objdir/${outputname}S.${objext}%"</span><span class="normal"> </span><span class="symbol">|</span><span class="normal"> </span><span class="variable">$NL2SP</span><span class="normal">`</span>
<span class="normal">            </span><span class="keyword">else</span>
<span class="normal">              </span><span class="variable">compile_command</span><span class="symbol">=</span><span class="normal">`</span><span class="variable">$echo</span><span class="normal"> </span><span class="string">"X$compile_command"</span><span class="normal"> </span><span class="symbol">|</span><span class="normal"> </span><span class="variable">$SP2NL</span><span class="normal"> </span><span class="symbol">|</span><span class="normal"> </span><span class="variable">$Xsed</span><span class="normal"> -e </span><span class="string">"s%@SYMFILE@%$output_objdir/${outputname}S.${objext}%"</span><span class="normal"> </span><span class="symbol">|</span><span class="normal"> </span><span class="variable">$NL2SP</span><span class="normal">`</span>
<span class="normal">              </span><span class="variable">finalize_command</span><span class="symbol">=</span><span class="normal">`</span><span class="variable">$echo</span><span class="normal"> </span><span class="string">"X$finalize_command"</span><span class="normal"> </span><span class="symbol">|</span><span class="normal"> </span><span class="variable">$SP2NL</span><span class="normal"> </span><span class="symbol">|</span><span class="normal"> </span><span class="variable">$Xsed</span><span class="normal"> -e </span><span class="string">"s%@SYMFILE@%$output_objdir/${outputname}S.${objext}%"</span><span class="normal"> </span><span class="symbol">|</span><span class="normal"> </span><span class="variable">$NL2SP</span><span class="normal">`</span>
<span class="normal">             </span><span class="keyword">fi</span>
<span class="normal">            </span><span class="symbol">;;</span>
<span class="normal">          </span><span class="symbol">*</span><span class="normal"> </span><span class="symbol">)</span>
<span class="normal">            </span><span class="variable">compile_command</span><span class="symbol">=</span><span class="normal">`</span><span class="variable">$echo</span><span class="normal"> </span><span class="string">"X$compile_command"</span><span class="normal"> </span><span class="symbol">|</span><span class="normal"> </span><span class="variable">$SP2NL</span><span class="normal"> </span><span class="symbol">|</span><span class="normal"> </span><span class="variable">$Xsed</span><span class="normal"> -e </span><span class="string">"s%@SYMFILE@%$output_objdir/${outputname}S.${objext}%"</span><span class="normal"> </span><span class="symbol">|</span><span class="normal"> </span><span class="variable">$NL2SP</span><span class="normal">`</span>
<span class="normal">            </span><span class="variable">finalize_command</span><span class="symbol">=</span><span class="normal">`</span><span class="variable">$echo</span><span class="normal"> </span><span class="string">"X$finalize_command"</span><span class="normal"> </span><span class="symbol">|</span><span class="normal"> </span><span class="variable">$SP2NL</span><span class="normal"> </span><span class="symbol">|</span><span class="normal"> </span><span class="variable">$Xsed</span><span class="normal"> -e </span><span class="string">"s%@SYMFILE@%$output_objdir/${outputname}S.${objext}%"</span><span class="normal"> </span><span class="symbol">|</span><span class="normal"> </span><span class="variable">$NL2SP</span><span class="normal">`</span>
<span class="normal">            </span><span class="symbol">;;</span>
<span class="normal">          </span><span class="keyword">esac</span>
<span class="normal">	  </span><span class="symbol">;;</span>
<span class="normal">	</span><span class="symbol">*)</span>
<span class="normal">	  </span><span class="variable">$echo</span><span class="normal"> </span><span class="string">"$modename: unknown suffix for </span><span class="specialchar">\`</span><span class="string">$dlsyms'"</span><span class="normal"> </span><span class="number">1</span><span class="symbol">&gt;&amp;</span><span class="number">2</span>
<span class="normal">	  </span><span class="keyword">exit</span><span class="normal"> </span><span class="variable">$EXIT_FAILURE</span>
<span class="normal">	  </span><span class="symbol">;;</span>
<span class="normal">	</span><span class="keyword">esac</span>
<span class="normal">      </span><span class="keyword">else</span>
<span class="normal">	</span><span class="comment"># We keep going just in case the user didn't refer to</span>
<span class="normal">	</span><span class="comment"># lt_preloaded_symbols.  The linker will fail if global_symbol_pipe</span>
<span class="normal">	</span><span class="comment"># really was required.</span>

<span class="normal">	</span><span class="comment"># Nullify the symbol file.</span>
<span class="normal">	</span><span class="variable">compile_command</span><span class="symbol">=</span><span class="normal">`</span><span class="variable">$echo</span><span class="normal"> </span><span class="string">"X$compile_command"</span><span class="normal"> </span><span class="symbol">|</span><span class="normal"> </span><span class="variable">$SP2NL</span><span class="normal"> </span><span class="symbol">|</span><span class="normal"> </span><span class="variable">$Xsed</span><span class="normal"> -e </span><span class="string">"s% @SYMFILE@%%"</span><span class="normal"> </span><span class="symbol">|</span><span class="normal"> </span><span class="variable">$NL2SP</span><span class="normal">`</span>
<span class="normal">	</span><span class="variable">finalize_command</span><span class="symbol">=</span><span class="normal">`</span><span class="variable">$echo</span><span class="normal"> </span><span class="string">"X$finalize_command"</span><span class="normal"> </span><span class="symbol">|</span><span class="normal"> </span><span class="variable">$SP2NL</span><span class="normal"> </span><span class="symbol">|</span><span class="normal"> </span><span class="variable">$Xsed</span><span class="normal"> -e </span><span class="string">"s% @SYMFILE@%%"</span><span class="normal"> </span><span class="symbol">|</span><span class="normal"> </span><span class="variable">$NL2SP</span><span class="normal">`</span>
<span class="normal">      </span><span class="keyword">fi</span>

<span class="normal">      </span><span class="keyword">if</span><span class="normal"> </span><span class="keyword">test</span><span class="normal"> </span><span class="string">"$need_relink"</span><span class="normal"> </span><span class="symbol">=</span><span class="normal"> no </span><span class="symbol">||</span><span class="normal"> </span><span class="keyword">test</span><span class="normal"> </span><span class="string">"$build_libtool_libs"</span><span class="normal"> </span><span class="symbol">!=</span><span class="normal"> yes</span><span class="symbol">;</span><span class="normal"> </span><span class="keyword">then</span>
<span class="normal">	</span><span class="comment"># Replace the output file specification.</span>
<span class="normal">	</span><span class="variable">compile_command</span><span class="symbol">=</span><span class="normal">`</span><span class="variable">$echo</span><span class="normal"> </span><span class="string">"X$compile_command"</span><span class="normal"> </span><span class="symbol">|</span><span class="normal"> </span><span class="variable">$SP2NL</span><span class="normal"> </span><span class="symbol">|</span><span class="normal"> </span><span class="variable">$Xsed</span><span class="normal"> -e </span><span class="string">'s%@OUTPUT@%'"$output"'%g'</span><span class="normal"> </span><span class="symbol">|</span><span class="normal"> </span><span class="variable">$NL2SP</span><span class="normal">`</span>
<span class="normal">	</span><span class="variable">link_command</span><span class="symbol">=</span><span class="string">"$compile_command$compile_rpath"</span>

<span class="normal">	</span><span class="comment"># We have no uninstalled library dependencies, so finalize right now.</span>
<span class="normal">	</span><span class="variable">$show</span><span class="normal"> </span><span class="string">"$link_command"</span>
<span class="normal">	</span><span class="variable">$run</span><span class="normal"> </span><span class="keyword">eval</span><span class="normal"> </span><span class="string">"$link_command"</span>
<span class="normal">	</span><span class="variable">exit_status</span><span class="symbol">=</span><span class="variable">$?</span>

<span class="normal">	</span><span class="comment"># Delete the generated files.</span>
<span class="normal">	</span><span class="keyword">if</span><span class="normal"> </span><span class="keyword">test</span><span class="normal"> -n </span><span class="string">"$dlsyms"</span><span class="symbol">;</span><span class="normal"> </span><span class="keyword">then</span>
<span class="normal">	  </span><span class="variable">$show</span><span class="normal"> </span><span class="string">"$rm $output_objdir/${outputname}S.${objext}"</span>
<span class="normal">	  </span><span class="variable">$run</span><span class="normal"> </span><span class="variable">$rm</span><span class="normal"> </span><span class="string">"$output_objdir/${outputname}S.${objext}"</span>
<span class="normal">	</span><span class="keyword">fi</span>

<span class="normal">	</span><span class="keyword">exit</span><span class="normal"> </span><span class="variable">$exit_status</span>
<span class="normal">      </span><span class="keyword">fi</span>

<span class="normal">      </span><span class="keyword">if</span><span class="normal"> </span><span class="keyword">test</span><span class="normal"> -n </span><span class="string">"$shlibpath_var"</span><span class="symbol">;</span><span class="normal"> </span><span class="keyword">then</span>
<span class="normal">	</span><span class="comment"># We should set the shlibpath_var</span>
<span class="normal">	</span><span class="variable">rpath</span><span class="symbol">=</span>
<span class="normal">	</span><span class="keyword">for</span><span class="normal"> dir </span><span class="keyword">in</span><span class="normal"> </span><span class="variable">$temp_rpath</span><span class="symbol">;</span><span class="normal"> </span><span class="keyword">do</span>
<span class="normal">	  </span><span class="keyword">case</span><span class="normal"> </span><span class="variable">$dir</span><span class="normal"> </span><span class="keyword">in</span>
<span class="normal">	  </span><span class="symbol">[\\/]*</span><span class="normal"> </span><span class="symbol">|</span><span class="normal"> </span><span class="symbol">[</span><span class="normal">A-Za-z</span><span class="symbol">]:[\\/]*)</span>
<span class="normal">	    </span><span class="comment"># Absolute path.</span>
<span class="normal">	    </span><span class="variable">rpath</span><span class="symbol">=</span><span class="string">"$rpath$dir:"</span>
<span class="normal">	    </span><span class="symbol">;;</span>
<span class="normal">	  </span><span class="symbol">*)</span>
<span class="normal">	    </span><span class="comment"># Relative path: add a thisdir entry.</span>
<span class="normal">	    </span><span class="variable">rpath</span><span class="symbol">=</span><span class="string">"$rpath</span><span class="specialchar">\$</span><span class="string">thisdir/$dir:"</span>
<span class="normal">	    </span><span class="symbol">;;</span>
<span class="normal">	  </span><span class="keyword">esac</span>
<span class="normal">	</span><span class="keyword">done</span>
<span class="normal">	</span><span class="variable">temp_rpath</span><span class="symbol">=</span><span class="string">"$rpath"</span>
<span class="normal">      </span><span class="keyword">fi</span>

<span class="normal">      </span><span class="keyword">if</span><span class="normal"> </span><span class="keyword">test</span><span class="normal"> -n </span><span class="string">"$compile_shlibpath$finalize_shlibpath"</span><span class="symbol">;</span><span class="normal"> </span><span class="keyword">then</span>
<span class="normal">	</span><span class="variable">compile_command</span><span class="symbol">=</span><span class="string">"$shlibpath_var=</span><span class="specialchar">\"</span><span class="string">$compile_shlibpath$finalize_shlibpath</span><span class="specialchar">\$</span><span class="string">$shlibpath_var</span><span class="specialchar">\"</span><span class="string"> $compile_command"</span>
<span class="normal">      </span><span class="keyword">fi</span>
<span class="normal">      </span><span class="keyword">if</span><span class="normal"> </span><span class="keyword">test</span><span class="normal"> -n </span><span class="string">"$finalize_shlibpath"</span><span class="symbol">;</span><span class="normal"> </span><span class="keyword">then</span>
<span class="normal">	</span><span class="variable">finalize_command</span><span class="symbol">=</span><span class="string">"$shlibpath_var=</span><span class="specialchar">\"</span><span class="string">$finalize_shlibpath</span><span class="specialchar">\$</span><span class="string">$shlibpath_var</span><span class="specialchar">\"</span><span class="string"> $finalize_command"</span>
<span class="normal">      </span><span class="keyword">fi</span>

<span class="normal">      </span><span class="variable">compile_var</span><span class="symbol">=</span>
<span class="normal">      </span><span class="variable">finalize_var</span><span class="symbol">=</span>
<span class="normal">      </span><span class="keyword">if</span><span class="normal"> </span><span class="keyword">test</span><span class="normal"> -n </span><span class="string">"$runpath_var"</span><span class="symbol">;</span><span class="normal"> </span><span class="keyword">then</span>
<span class="normal">	</span><span class="keyword">if</span><span class="normal"> </span><span class="keyword">test</span><span class="normal"> -n </span><span class="string">"$perm_rpath"</span><span class="symbol">;</span><span class="normal"> </span><span class="keyword">then</span>
<span class="normal">	  </span><span class="comment"># We should set the runpath_var.</span>
<span class="normal">	  </span><span class="variable">rpath</span><span class="symbol">=</span>
<span class="normal">	  </span><span class="keyword">for</span><span class="normal"> dir </span><span class="keyword">in</span><span class="normal"> </span><span class="variable">$perm_rpath</span><span class="symbol">;</span><span class="normal"> </span><span class="keyword">do</span>
<span class="normal">	    </span><span class="variable">rpath</span><span class="symbol">=</span><span class="string">"$rpath$dir:"</span>
<span class="normal">	  </span><span class="keyword">done</span>
<span class="normal">	  </span><span class="variable">compile_var</span><span class="symbol">=</span><span class="string">"$runpath_var=</span><span class="specialchar">\"</span><span class="string">$rpath</span><span class="specialchar">\$</span><span class="string">$runpath_var</span><span class="specialchar">\"</span><span class="string"> "</span>
<span class="normal">	</span><span class="keyword">fi</span>
<span class="normal">	</span><span class="keyword">if</span><span class="normal"> </span><span class="keyword">test</span><span class="normal"> -n </span><span class="string">"$finalize_perm_rpath"</span><span class="symbol">;</span><span class="normal"> </span><span class="keyword">then</span>
<span class="normal">	  </span><span class="comment"># We should set the runpath_var.</span>
<span class="normal">	  </span><span class="variable">rpath</span><span class="symbol">=</span>
<span class="normal">	  </span><span class="keyword">for</span><span class="normal"> dir </span><span class="keyword">in</span><span class="normal"> </span><span class="variable">$finalize_perm_rpath</span><span class="symbol">;</span><span class="normal"> </span><span class="keyword">do</span>
<span class="normal">	    </span><span class="variable">rpath</span><span class="symbol">=</span><span class="string">"$rpath$dir:"</span>
<span class="normal">	  </span><span class="keyword">done</span>
<span class="normal">	  </span><span class="variable">finalize_var</span><span class="symbol">=</span><span class="string">"$runpath_var=</span><span class="specialchar">\"</span><span class="string">$rpath</span><span class="specialchar">\$</span><span class="string">$runpath_var</span><span class="specialchar">\"</span><span class="string"> "</span>
<span class="normal">	</span><span class="keyword">fi</span>
<span class="normal">      </span><span class="keyword">fi</span>

<span class="normal">      </span><span class="keyword">if</span><span class="normal"> </span><span class="keyword">test</span><span class="normal"> </span><span class="string">"$no_install"</span><span class="normal"> </span><span class="symbol">=</span><span class="normal"> yes</span><span class="symbol">;</span><span class="normal"> </span><span class="keyword">then</span>
<span class="normal">	</span><span class="comment"># We don't need to create a wrapper script.</span>
<span class="normal">	</span><span class="variable">link_command</span><span class="symbol">=</span><span class="string">"$compile_var$compile_command$compile_rpath"</span>
<span class="normal">	</span><span class="comment"># Replace the output file specification.</span>
<span class="normal">	</span><span class="variable">link_command</span><span class="symbol">=</span><span class="normal">`</span><span class="variable">$echo</span><span class="normal"> </span><span class="string">"X$link_command"</span><span class="normal"> </span><span class="symbol">|</span><span class="normal"> </span><span class="variable">$Xsed</span><span class="normal"> -e </span><span class="string">'s%@OUTPUT@%'"$output"'%g'</span><span class="normal">`</span>
<span class="normal">	</span><span class="comment"># Delete the old output file.</span>
<span class="normal">	</span><span class="variable">$run</span><span class="normal"> </span><span class="variable">$rm</span><span class="normal"> </span><span class="variable">$output</span>
<span class="normal">	</span><span class="comment"># Link the executable and exit</span>
<span class="normal">	</span><span class="variable">$show</span><span class="normal"> </span><span class="string">"$link_command"</span>
<span class="normal">	</span><span class="variable">$run</span><span class="normal"> </span><span class="keyword">eval</span><span class="normal"> </span><span class="string">"$link_command"</span><span class="normal"> </span><span class="symbol">||</span><span class="normal"> </span><span class="keyword">exit</span><span class="normal"> </span><span class="variable">$?</span>
<span class="normal">	</span><span class="keyword">exit</span><span class="normal"> </span><span class="variable">$EXIT_SUCCESS</span>
<span class="normal">      </span><span class="keyword">fi</span>

<span class="normal">      </span><span class="keyword">if</span><span class="normal"> </span><span class="keyword">test</span><span class="normal"> </span><span class="string">"$hardcode_action"</span><span class="normal"> </span><span class="symbol">=</span><span class="normal"> relink</span><span class="symbol">;</span><span class="normal"> </span><span class="keyword">then</span>
<span class="normal">	</span><span class="comment"># Fast installation is not supported</span>
<span class="normal">	</span><span class="variable">link_command</span><span class="symbol">=</span><span class="string">"$compile_var$compile_command$compile_rpath"</span>
<span class="normal">	</span><span class="variable">relink_command</span><span class="symbol">=</span><span class="string">"$finalize_var$finalize_command$finalize_rpath"</span>

<span class="normal">	</span><span class="variable">$echo</span><span class="normal"> </span><span class="string">"$modename: warning: this platform does not like uninstalled shared libraries"</span><span class="normal"> </span><span class="number">1</span><span class="symbol">&gt;&amp;</span><span class="number">2</span>
<span class="normal">	</span><span class="variable">$echo</span><span class="normal"> </span><span class="string">"$modename: </span><span class="specialchar">\`</span><span class="string">$output' will be relinked during installation"</span><span class="normal"> </span><span class="number">1</span><span class="symbol">&gt;&amp;</span><span class="number">2</span>
<span class="normal">      </span><span class="keyword">else</span>
<span class="normal">	</span><span class="keyword">if</span><span class="normal"> </span><span class="keyword">test</span><span class="normal"> </span><span class="string">"$fast_install"</span><span class="normal"> </span><span class="symbol">!=</span><span class="normal"> no</span><span class="symbol">;</span><span class="normal"> </span><span class="keyword">then</span>
<span class="normal">	  </span><span class="variable">link_command</span><span class="symbol">=</span><span class="string">"$finalize_var$compile_command$finalize_rpath"</span>
<span class="normal">	  </span><span class="keyword">if</span><span class="normal"> </span><span class="keyword">test</span><span class="normal"> </span><span class="string">"$fast_install"</span><span class="normal"> </span><span class="symbol">=</span><span class="normal"> yes</span><span class="symbol">;</span><span class="normal"> </span><span class="keyword">then</span>
<span class="normal">	    </span><span class="variable">relink_command</span><span class="symbol">=</span><span class="normal">`</span><span class="variable">$echo</span><span class="normal"> </span><span class="string">"X$compile_var$compile_command$compile_rpath"</span><span class="normal"> </span><span class="symbol">|</span><span class="normal"> </span><span class="variable">$SP2NL</span><span class="normal"> </span><span class="symbol">|</span><span class="normal"> </span><span class="variable">$Xsed</span><span class="normal"> -e </span><span class="string">'s%@OUTPUT@%</span><span class="specialchar">\$</span><span class="string">progdir/</span><span class="specialchar">\$</span><span class="string">file%g'</span><span class="normal"> </span><span class="symbol">|</span><span class="normal"> </span><span class="variable">$NL2SP</span><span class="normal">`</span>
<span class="normal">	  </span><span class="keyword">else</span>
<span class="normal">	    </span><span class="comment"># fast_install is set to needless</span>
<span class="normal">	    </span><span class="variable">relink_command</span><span class="symbol">=</span>
<span class="normal">	  </span><span class="keyword">fi</span>
<span class="normal">	</span><span class="keyword">else</span>
<span class="normal">	  </span><span class="variable">link_command</span><span class="symbol">=</span><span class="string">"$compile_var$compile_command$compile_rpath"</span>
<span class="normal">	  </span><span class="variable">relink_command</span><span class="symbol">=</span><span class="string">"$finalize_var$finalize_command$finalize_rpath"</span>
<span class="normal">	</span><span class="keyword">fi</span>
<span class="normal">      </span><span class="keyword">fi</span>

<span class="normal">      </span><span class="comment"># Replace the output file specification.</span>
<span class="normal">      </span><span class="variable">link_command</span><span class="symbol">=</span><span class="normal">`</span><span class="variable">$echo</span><span class="normal"> </span><span class="string">"X$link_command"</span><span class="normal"> </span><span class="symbol">|</span><span class="normal"> </span><span class="variable">$Xsed</span><span class="normal"> -e </span><span class="string">'s%@OUTPUT@%'"$output_objdir/$outputname"'%g'</span><span class="normal">`</span>

<span class="normal">      </span><span class="comment"># Delete the old output files.</span>
<span class="normal">      </span><span class="variable">$run</span><span class="normal"> </span><span class="variable">$rm</span><span class="normal"> </span><span class="variable">$output</span><span class="normal"> </span><span class="variable">$output_objdir</span><span class="symbol">/</span><span class="variable">$outputname</span><span class="normal"> </span><span class="variable">$output_objdir</span><span class="normal">/lt-</span><span class="variable">$outputname</span>

<span class="normal">      </span><span class="variable">$show</span><span class="normal"> </span><span class="string">"$link_command"</span>
<span class="normal">      </span><span class="variable">$run</span><span class="normal"> </span><span class="keyword">eval</span><span class="normal"> </span><span class="string">"$link_command"</span><span class="normal"> </span><span class="symbol">||</span><span class="normal"> </span><span class="keyword">exit</span><span class="normal"> </span><span class="variable">$?</span>

<span class="normal">      </span><span class="comment"># Now create the wrapper script.</span>
<span class="normal">      </span><span class="variable">$show</span><span class="normal"> </span><span class="string">"creating $output"</span>

<span class="normal">      </span><span class="comment"># Quote the relink command for shipping.</span>
<span class="normal">      </span><span class="keyword">if</span><span class="normal"> </span><span class="keyword">test</span><span class="normal"> -n </span><span class="string">"$relink_command"</span><span class="symbol">;</span><span class="normal"> </span><span class="keyword">then</span>
<span class="normal">	</span><span class="comment"># Preserve any variables that may affect compiler behavior</span>
<span class="normal">	</span><span class="keyword">for</span><span class="normal"> var </span><span class="keyword">in</span><span class="normal"> </span><span class="variable">$variables_saved_for_relink</span><span class="symbol">;</span><span class="normal"> </span><span class="keyword">do</span>
<span class="normal">	  </span><span class="keyword">if</span><span class="normal"> </span><span class="keyword">eval</span><span class="normal"> </span><span class="keyword">test</span><span class="normal"> -z \"</span><span class="symbol">\</span><span class="variable">${$var+set}</span><span class="normal">\"</span><span class="symbol">;</span><span class="normal"> </span><span class="keyword">then</span>
<span class="normal">	    </span><span class="variable">relink_command</span><span class="symbol">=</span><span class="string">"{ test -z </span><span class="specialchar">\"\$</span><span class="string">{$var+set}</span><span class="specialchar">\"</span><span class="string"> || unset $var || { $var=; export $var; }; }; $relink_command"</span>
<span class="normal">	  </span><span class="keyword">elif</span><span class="normal"> </span><span class="keyword">eval</span><span class="normal"> </span><span class="variable">var_value</span><span class="symbol">=\</span><span class="variable">$$</span><span class="normal">var</span><span class="symbol">;</span><span class="normal"> </span><span class="keyword">test</span><span class="normal"> -z </span><span class="string">"$var_value"</span><span class="symbol">;</span><span class="normal"> </span><span class="keyword">then</span>
<span class="normal">	    </span><span class="variable">relink_command</span><span class="symbol">=</span><span class="string">"$var=; export $var; $relink_command"</span>
<span class="normal">	  </span><span class="keyword">else</span>
<span class="normal">	    </span><span class="variable">var_value</span><span class="symbol">=</span><span class="normal">`</span><span class="variable">$echo</span><span class="normal"> </span><span class="string">"X$var_value"</span><span class="normal"> </span><span class="symbol">|</span><span class="normal"> </span><span class="variable">$Xsed</span><span class="normal"> -e </span><span class="string">"$sed_quote_subst"</span><span class="normal">`</span>
<span class="normal">	    </span><span class="variable">relink_command</span><span class="symbol">=</span><span class="string">"$var=</span><span class="specialchar">\"</span><span class="string">$var_value</span><span class="specialchar">\"</span><span class="string">; export $var; $relink_command"</span>
<span class="normal">	  </span><span class="keyword">fi</span>
<span class="normal">	</span><span class="keyword">done</span>
<span class="normal">	</span><span class="variable">relink_command</span><span class="symbol">=</span><span class="string">"(cd `pwd`; $relink_command)"</span>
<span class="normal">	</span><span class="variable">relink_command</span><span class="symbol">=</span><span class="normal">`</span><span class="variable">$echo</span><span class="normal"> </span><span class="string">"X$relink_command"</span><span class="normal"> </span><span class="symbol">|</span><span class="normal"> </span><span class="variable">$SP2NL</span><span class="normal"> </span><span class="symbol">|</span><span class="normal"> </span><span class="variable">$Xsed</span><span class="normal"> -e </span><span class="string">"$sed_quote_subst"</span><span class="normal"> </span><span class="symbol">|</span><span class="normal"> </span><span class="variable">$NL2SP</span><span class="normal">`</span>
<span class="normal">      </span><span class="keyword">fi</span>

<span class="normal">      </span><span class="comment"># Quote $echo for shipping.</span>
<span class="normal">      </span><span class="keyword">if</span><span class="normal"> </span><span class="keyword">test</span><span class="normal"> </span><span class="string">"X$echo"</span><span class="normal"> </span><span class="symbol">=</span><span class="normal"> </span><span class="string">"X$SHELL $progpath --fallback-echo"</span><span class="symbol">;</span><span class="normal"> </span><span class="keyword">then</span>
<span class="normal">	</span><span class="keyword">case</span><span class="normal"> </span><span class="variable">$progpath</span><span class="normal"> </span><span class="keyword">in</span>
<span class="normal">	</span><span class="symbol">[\\/]*</span><span class="normal"> </span><span class="symbol">|</span><span class="normal"> </span><span class="symbol">[</span><span class="normal">A-Za-z</span><span class="symbol">]:[\\/]*)</span><span class="normal"> </span><span class="variable">qecho</span><span class="symbol">=</span><span class="string">"$SHELL $progpath --fallback-echo"</span><span class="symbol">;;</span>
<span class="normal">	</span><span class="symbol">*)</span><span class="normal"> </span><span class="variable">qecho</span><span class="symbol">=</span><span class="string">"$SHELL `pwd`/$progpath --fallback-echo"</span><span class="symbol">;;</span>
<span class="normal">	</span><span class="keyword">esac</span>
<span class="normal">	</span><span class="variable">qecho</span><span class="symbol">=</span><span class="normal">`</span><span class="variable">$echo</span><span class="normal"> </span><span class="string">"X$qecho"</span><span class="normal"> </span><span class="symbol">|</span><span class="normal"> </span><span class="variable">$Xsed</span><span class="normal"> -e </span><span class="string">"$sed_quote_subst"</span><span class="normal">`</span>
<span class="normal">      </span><span class="keyword">else</span>
<span class="normal">	</span><span class="variable">qecho</span><span class="symbol">=</span><span class="normal">`</span><span class="variable">$echo</span><span class="normal"> </span><span class="string">"X$echo"</span><span class="normal"> </span><span class="symbol">|</span><span class="normal"> </span><span class="variable">$Xsed</span><span class="normal"> -e </span><span class="string">"$sed_quote_subst"</span><span class="normal">`</span>
<span class="normal">      </span><span class="keyword">fi</span>

<span class="normal">      </span><span class="comment"># Only actually do things if our run command is non-null.</span>
<span class="normal">      </span><span class="keyword">if</span><span class="normal"> </span><span class="keyword">test</span><span class="normal"> -z </span><span class="string">"$run"</span><span class="symbol">;</span><span class="normal"> </span><span class="keyword">then</span>
<span class="normal">	</span><span class="comment"># win32 will think the script is a binary if it has</span>
<span class="normal">	</span><span class="comment"># a .exe suffix, so we strip it off here.</span>
<span class="normal">	</span><span class="keyword">case</span><span class="normal"> </span><span class="variable">$output</span><span class="normal"> </span><span class="keyword">in</span>
<span class="normal">	  </span><span class="symbol">*.</span><span class="normal">exe</span><span class="symbol">)</span><span class="normal"> </span><span class="variable">output</span><span class="symbol">=</span><span class="normal">`</span><span class="variable">$echo</span><span class="normal"> </span><span class="variable">$output</span><span class="symbol">|</span><span class="variable">${SED}</span><span class="normal"> </span><span class="string">'s,.exe$,,'</span><span class="normal">` </span><span class="symbol">;;</span>
<span class="normal">	</span><span class="keyword">esac</span>
<span class="normal">	</span><span class="comment"># test for cygwin because mv fails w/o .exe extensions</span>
<span class="normal">	</span><span class="keyword">case</span><span class="normal"> </span><span class="variable">$host</span><span class="normal"> </span><span class="keyword">in</span>
<span class="normal">	  </span><span class="symbol">*</span><span class="normal">cygwin</span><span class="symbol">*)</span>
<span class="normal">	    </span><span class="variable">exeext</span><span class="symbol">=.</span><span class="normal">exe</span>
<span class="normal">	    </span><span class="variable">outputname</span><span class="symbol">=</span><span class="normal">`</span><span class="variable">$echo</span><span class="normal"> </span><span class="variable">$outputname</span><span class="symbol">|</span><span class="variable">${SED}</span><span class="normal"> </span><span class="string">'s,.exe$,,'</span><span class="normal">` </span><span class="symbol">;;</span>
<span class="normal">	  </span><span class="symbol">*)</span><span class="normal"> </span><span class="variable">exeext</span><span class="symbol">=</span><span class="normal"> </span><span class="symbol">;;</span>
<span class="normal">	</span><span class="keyword">esac</span>
<span class="normal">	</span><span class="keyword">case</span><span class="normal"> </span><span class="variable">$host</span><span class="normal"> </span><span class="keyword">in</span>
<span class="normal">	  </span><span class="symbol">*</span><span class="normal">cygwin</span><span class="symbol">*</span><span class="normal"> </span><span class="symbol">|</span><span class="normal"> </span><span class="symbol">*</span><span class="normal">mingw</span><span class="symbol">*</span><span class="normal"> </span><span class="symbol">)</span>
<span class="normal">            </span><span class="variable">output_name</span><span class="symbol">=</span><span class="normal">`basename </span><span class="variable">$output</span><span class="normal">`</span>
<span class="normal">            </span><span class="variable">output_path</span><span class="symbol">=</span><span class="normal">`dirname </span><span class="variable">$output</span><span class="normal">`</span>
<span class="normal">            </span><span class="variable">cwrappersource</span><span class="symbol">=</span><span class="string">"$output_path/$objdir/lt-$output_name.c"</span>
<span class="normal">            </span><span class="variable">cwrapper</span><span class="symbol">=</span><span class="string">"$output_path/$output_name.exe"</span>
<span class="normal">            </span><span class="variable">$rm</span><span class="normal"> </span><span class="variable">$cwrappersource</span><span class="normal"> </span><span class="variable">$cwrapper</span>
<span class="normal">            </span><span class="keyword">trap</span><span class="normal"> </span><span class="string">"$rm $cwrappersource $cwrapper; exit $EXIT_FAILURE"</span><span class="normal"> </span><span class="number">1</span><span class="normal"> </span><span class="number">2</span><span class="normal"> </span><span class="number">15</span>

<span class="normal">	    cat </span><span class="symbol">&gt;</span><span class="normal"> </span><span class="variable">$cwrappersource</span><span class="normal"> </span><span class="symbol">&lt;&lt;</span><span class="normal">EOF</span>

<span class="symbol">/*</span><span class="normal"> </span><span class="variable">$cwrappersource</span><span class="normal"> - temporary wrapper executable </span><span class="keyword">for</span><span class="normal"> </span><span class="variable">$objdir</span><span class="symbol">/</span><span class="variable">$outputname</span>
<span class="normal">   Generated by </span><span class="variable">$PROGRAM</span><span class="normal"> - GNU </span><span class="variable">$PACKAGE</span><span class="normal"> </span><span class="variable">$VERSION$TIMESTAMP</span>

<span class="normal">   The </span><span class="variable">$output</span><span class="normal"> program cannot be directly executed </span><span class="keyword">until</span><span class="normal"> all the libtool</span>
<span class="normal">   libraries that it depends on are installed</span><span class="symbol">.</span>

<span class="normal">   This wrapper executable should never be moved out of the build directory</span><span class="symbol">.</span>
<span class="normal">   If it is</span><span class="symbol">,</span><span class="normal"> it will not operate correctly</span><span class="symbol">.</span>

<span class="normal">   Currently</span><span class="symbol">,</span><span class="normal"> it simply execs the wrapper </span><span class="symbol">*</span><span class="normal">script</span><span class="symbol">*</span><span class="normal"> </span><span class="string">"/bin/sh $output"</span><span class="symbol">,</span>
<span class="normal">   but could eventually absorb all of the scripts functionality and</span>
<span class="normal">   </span><span class="keyword">exec</span><span class="normal"> </span><span class="variable">$objdir</span><span class="symbol">/</span><span class="variable">$outputname</span><span class="normal"> directly</span><span class="symbol">.</span>
<span class="symbol">*/</span>
<span class="normal">EOF</span>
<span class="normal">	    cat </span><span class="symbol">&gt;&gt;</span><span class="normal"> </span><span class="variable">$cwrappersource</span><span class="symbol">&lt;&lt;</span><span class="string">"EOF"</span>
<span class="comment">#include &lt;stdio.h&gt;</span>
<span class="comment">#include &lt;stdlib.h&gt;</span>
<span class="comment">#include &lt;unistd.h&gt;</span>
<span class="comment">#include &lt;malloc.h&gt;</span>
<span class="comment">#include &lt;stdarg.h&gt;</span>
<span class="comment">#include &lt;assert.h&gt;</span>
<span class="comment">#include &lt;string.h&gt;</span>
<span class="comment">#include &lt;ctype.h&gt;</span>
<span class="comment">#include &lt;sys/stat.h&gt;</span>

<span class="comment">#if defined(PATH_MAX)</span>
<span class="comment"># define LT_PATHMAX PATH_MAX</span>
<span class="comment">#elif defined(MAXPATHLEN)</span>
<span class="comment"># define LT_PATHMAX MAXPATHLEN</span>
<span class="comment">#else</span>
<span class="comment"># define LT_PATHMAX 1024</span>
<span class="comment">#endif</span>

<span class="comment">#ifndef DIR_SEPARATOR</span>
<span class="comment"># define DIR_SEPARATOR '/'</span>
<span class="comment"># define PATH_SEPARATOR ':'</span>
<span class="comment">#endif</span>

<span class="comment">#if defined (_WIN32) || defined (__MSDOS__) || defined (__DJGPP__) || \</span>
<span class="normal">  defined </span><span class="symbol">(</span><span class="normal">__OS2__</span><span class="symbol">)</span>
<span class="comment"># define HAVE_DOS_BASED_FILE_SYSTEM</span>
<span class="comment"># ifndef DIR_SEPARATOR_2</span>
<span class="comment">#  define DIR_SEPARATOR_2 '\\'</span>
<span class="comment"># endif</span>
<span class="comment"># ifndef PATH_SEPARATOR_2</span>
<span class="comment">#  define PATH_SEPARATOR_2 ';'</span>
<span class="comment"># endif</span>
<span class="comment">#endif</span>

<span class="comment">#ifndef DIR_SEPARATOR_2</span>
<span class="comment"># define IS_DIR_SEPARATOR(ch) ((ch) == DIR_SEPARATOR)</span>
<span class="comment">#else /* DIR_SEPARATOR_2 */</span>
<span class="comment"># define IS_DIR_SEPARATOR(ch) \</span>
<span class="normal">        </span><span class="symbol">(((</span><span class="normal">ch</span><span class="symbol">)</span><span class="normal"> </span><span class="symbol">==</span><span class="normal"> DIR_SEPARATOR</span><span class="symbol">)</span><span class="normal"> </span><span class="symbol">||</span><span class="normal"> </span><span class="symbol">((</span><span class="normal">ch</span><span class="symbol">)</span><span class="normal"> </span><span class="symbol">==</span><span class="normal"> DIR_SEPARATOR_2</span><span class="symbol">))</span>
<span class="comment">#endif /* DIR_SEPARATOR_2 */</span>

<span class="comment">#ifndef PATH_SEPARATOR_2</span>
<span class="comment"># define IS_PATH_SEPARATOR(ch) ((ch) == PATH_SEPARATOR)</span>
<span class="comment">#else /* PATH_SEPARATOR_2 */</span>
<span class="comment"># define IS_PATH_SEPARATOR(ch) ((ch) == PATH_SEPARATOR_2)</span>
<span class="comment">#endif /* PATH_SEPARATOR_2 */</span>

<span class="comment">#define XMALLOC(type, num)      ((type *) xmalloc ((num) * sizeof(type)))</span>
<span class="comment">#define XFREE(stale) do { \</span>
<span class="normal">  </span><span class="keyword">if</span><span class="normal"> </span><span class="symbol">(</span><span class="normal">stale</span><span class="symbol">)</span><span class="normal"> { free </span><span class="symbol">((</span><span class="normal">void </span><span class="symbol">*)</span><span class="normal"> stale</span><span class="symbol">);</span><span class="normal"> stale </span><span class="symbol">=</span><span class="normal"> </span><span class="number">0</span><span class="symbol">;</span><span class="normal"> } </span><span class="symbol">\</span>
<span class="normal">} </span><span class="keyword">while</span><span class="normal"> </span><span class="symbol">(</span><span class="number">0</span><span class="symbol">)</span>

<span class="symbol">/*</span><span class="normal"> -DDEBUG is fairly common </span><span class="keyword">in</span><span class="normal"> CFLAGS</span><span class="symbol">.</span><span class="normal">  </span><span class="symbol">*/</span>
<span class="comment">#undef DEBUG</span>
<span class="comment">#if defined DEBUGWRAPPER</span>
<span class="comment"># define DEBUG(format, ...) fprintf(stderr, format, __VA_ARGS__)</span>
<span class="comment">#else</span>
<span class="comment"># define DEBUG(format, ...)</span>
<span class="comment">#endif</span>

<span class="normal">const char </span><span class="symbol">*</span><span class="normal">program_name </span><span class="symbol">=</span><span class="normal"> NULL</span><span class="symbol">;</span>

<span class="normal">void </span><span class="symbol">*</span><span class="normal"> xmalloc </span><span class="symbol">(</span><span class="normal">size_t num</span><span class="symbol">);</span>
<span class="normal">char </span><span class="symbol">*</span><span class="normal"> xstrdup </span><span class="symbol">(</span><span class="normal">const char </span><span class="symbol">*</span><span class="normal">string</span><span class="symbol">);</span>
<span class="normal">const char </span><span class="symbol">*</span><span class="normal"> base_name </span><span class="symbol">(</span><span class="normal">const char </span><span class="symbol">*</span><span class="normal">name</span><span class="symbol">);</span>
<span class="normal">char </span><span class="symbol">*</span><span class="normal"> find_executable</span><span class="symbol">(</span><span class="normal">const char </span><span class="symbol">*</span><span class="normal">wrapper</span><span class="symbol">);</span>
<span class="normal">int    check_executable</span><span class="symbol">(</span><span class="normal">const char </span><span class="symbol">*</span><span class="normal">path</span><span class="symbol">);</span>
<span class="normal">char </span><span class="symbol">*</span><span class="normal"> strendzap</span><span class="symbol">(</span><span class="normal">char </span><span class="symbol">*</span><span class="normal">str</span><span class="symbol">,</span><span class="normal"> const char </span><span class="symbol">*</span><span class="normal">pat</span><span class="symbol">);</span>
<span class="normal">void lt_fatal </span><span class="symbol">(</span><span class="normal">const char </span><span class="symbol">*</span><span class="normal">message</span><span class="symbol">,</span><span class="normal"> </span><span class="symbol">...);</span>

<span class="normal">int</span>
<span class="normal">main </span><span class="symbol">(</span><span class="normal">int argc</span><span class="symbol">,</span><span class="normal"> char </span><span class="symbol">*</span><span class="normal">argv</span><span class="symbol">[])</span>
<span class="normal">{</span>
<span class="normal">  char </span><span class="symbol">**</span><span class="normal">newargz</span><span class="symbol">;</span>
<span class="normal">  int i</span><span class="symbol">;</span>

<span class="normal">  program_name </span><span class="symbol">=</span><span class="normal"> </span><span class="symbol">(</span><span class="normal">char </span><span class="symbol">*)</span><span class="normal"> xstrdup </span><span class="symbol">(</span><span class="normal">base_name </span><span class="symbol">(</span><span class="normal">argv</span><span class="symbol">[</span><span class="number">0</span><span class="symbol">]));</span>
<span class="normal">  DEBUG</span><span class="symbol">(</span><span class="string">"(main) argv[0]      : %s</span><span class="specialchar">\n</span><span class="string">"</span><span class="symbol">,</span><span class="normal">argv</span><span class="symbol">[</span><span class="number">0</span><span class="symbol">]);</span>
<span class="normal">  DEBUG</span><span class="symbol">(</span><span class="string">"(main) program_name : %s</span><span class="specialchar">\n</span><span class="string">"</span><span class="symbol">,</span><span class="normal">program_name</span><span class="symbol">);</span>
<span class="normal">  newargz </span><span class="symbol">=</span><span class="normal"> XMALLOC</span><span class="symbol">(</span><span class="normal">char </span><span class="symbol">*,</span><span class="normal"> argc</span><span class="symbol">+</span><span class="number">2</span><span class="symbol">);</span>
<span class="normal">EOF</span>

<span class="normal">            cat </span><span class="symbol">&gt;&gt;</span><span class="normal"> </span><span class="variable">$cwrappersource</span><span class="normal"> </span><span class="symbol">&lt;&lt;</span><span class="normal">EOF</span>
<span class="normal">  newargz</span><span class="symbol">[</span><span class="number">0</span><span class="symbol">]</span><span class="normal"> </span><span class="symbol">=</span><span class="normal"> </span><span class="symbol">(</span><span class="normal">char </span><span class="symbol">*)</span><span class="normal"> xstrdup</span><span class="symbol">(</span><span class="string">"$SHELL"</span><span class="symbol">);</span>
<span class="normal">EOF</span>

<span class="normal">            cat </span><span class="symbol">&gt;&gt;</span><span class="normal"> </span><span class="variable">$cwrappersource</span><span class="normal"> </span><span class="symbol">&lt;&lt;</span><span class="string">"EOF"</span>
<span class="normal">  newargz</span><span class="symbol">[</span><span class="number">1</span><span class="symbol">]</span><span class="normal"> </span><span class="symbol">=</span><span class="normal"> find_executable</span><span class="symbol">(</span><span class="normal">argv</span><span class="symbol">[</span><span class="number">0</span><span class="symbol">]);</span>
<span class="normal">  </span><span class="keyword">if</span><span class="normal"> </span><span class="symbol">(</span><span class="normal">newargz</span><span class="symbol">[</span><span class="number">1</span><span class="symbol">]</span><span class="normal"> </span><span class="symbol">==</span><span class="normal"> NULL</span><span class="symbol">)</span>
<span class="normal">    lt_fatal</span><span class="symbol">(</span><span class="string">"Couldn't find %s"</span><span class="symbol">,</span><span class="normal"> argv</span><span class="symbol">[</span><span class="number">0</span><span class="symbol">]);</span>
<span class="normal">  DEBUG</span><span class="symbol">(</span><span class="string">"(main) found exe at : %s</span><span class="specialchar">\n</span><span class="string">"</span><span class="symbol">,</span><span class="normal">newargz</span><span class="symbol">[</span><span class="number">1</span><span class="symbol">]);</span>
<span class="normal">  </span><span class="symbol">/*</span><span class="normal"> we know the script has the same name</span><span class="symbol">,</span><span class="normal"> without the </span><span class="symbol">.</span><span class="normal">exe </span><span class="symbol">*/</span>
<span class="normal">  </span><span class="symbol">/*</span><span class="normal"> so make sure newargz</span><span class="symbol">[</span><span class="number">1</span><span class="symbol">]</span><span class="normal"> doesn</span><span class="string">'t end in .exe */</span>
<span class="string">  strendzap(newargz[1],".exe");</span>
<span class="string">  for (i = 1; i &lt; argc; i++)</span>
<span class="string">    newargz[i+1] = xstrdup(argv[i]);</span>
<span class="string">  newargz[argc+1] = NULL;</span>

<span class="string">  for (i=0; i&lt;argc+1; i++)</span>
<span class="string">  {</span>
<span class="string">    DEBUG("(main) newargz[%d]   : %s</span><span class="specialchar">\n</span><span class="string">",i,newargz[i]);</span>
<span class="string">    ;</span>
<span class="string">  }</span>

<span class="string">EOF</span>

<span class="string">            case $host_os in</span>
<span class="string">              mingw*)</span>
<span class="string">                cat &gt;&gt; $cwrappersource &lt;&lt;EOF</span>
<span class="string">  execv("$SHELL",(char const **)newargz);</span>
<span class="string">EOF</span>
<span class="string">              ;;</span>
<span class="string">              *)</span>
<span class="string">                cat &gt;&gt; $cwrappersource &lt;&lt;EOF</span>
<span class="string">  execv("$SHELL",newargz);</span>
<span class="string">EOF</span>
<span class="string">              ;;</span>
<span class="string">            esac</span>

<span class="string">            cat &gt;&gt; $cwrappersource &lt;&lt;"EOF"</span>
<span class="string">  return 127;</span>
<span class="string">}</span>

<span class="string">void *</span>
<span class="string">xmalloc (size_t num)</span>
<span class="string">{</span>
<span class="string">  void * p = (void *) malloc (num);</span>
<span class="string">  if (!p)</span>
<span class="string">    lt_fatal ("Memory exhausted");</span>

<span class="string">  return p;</span>
<span class="string">}</span>

<span class="string">char *</span>
<span class="string">xstrdup (const char *string)</span>
<span class="string">{</span>
<span class="string">  return string ? strcpy ((char *) xmalloc (strlen (string) + 1), string) : NULL</span>
<span class="string">;</span>
<span class="string">}</span>

<span class="string">const char *</span>
<span class="string">base_name (const char *name)</span>
<span class="string">{</span>
<span class="string">  const char *base;</span>

<span class="string">#if defined (HAVE_DOS_BASED_FILE_SYSTEM)</span>
<span class="string">  /* Skip over the disk name in MSDOS pathnames. */</span>
<span class="string">  if (isalpha ((unsigned char)name[0]) &amp;&amp; name[1] == '</span><span class="symbol">:</span><span class="string">')</span>
<span class="string">    name += 2;</span>
<span class="string">#endif</span>

<span class="string">  for (base = name; *name; name++)</span>
<span class="string">    if (IS_DIR_SEPARATOR (*name))</span>
<span class="string">      base = name + 1;</span>
<span class="string">  return base;</span>
<span class="string">}</span>

<span class="string">int</span>
<span class="string">check_executable(const char * path)</span>
<span class="string">{</span>
<span class="string">  struct stat st;</span>

<span class="string">  DEBUG("(check_executable)  : %s</span><span class="specialchar">\n</span><span class="string">", path ? (*path ? path : "EMPTY!") : "NULL!");</span>
<span class="string">  if ((!path) || (!*path))</span>
<span class="string">    return 0;</span>

<span class="string">  if ((stat (path, &amp;st) &gt;= 0) &amp;&amp;</span>
<span class="string">      (</span>
<span class="string">        /* MinGW &amp; native WIN32 do not support S_IXOTH or S_IXGRP */</span>
<span class="string">#if defined (S_IXOTH)</span>
<span class="string">       ((st.st_mode &amp; S_IXOTH) == S_IXOTH) ||</span>
<span class="string">#endif</span>
<span class="string">#if defined (S_IXGRP)</span>
<span class="string">       ((st.st_mode &amp; S_IXGRP) == S_IXGRP) ||</span>
<span class="string">#endif</span>
<span class="string">       ((st.st_mode &amp; S_IXUSR) == S_IXUSR))</span>
<span class="string">      )</span>
<span class="string">    return 1;</span>
<span class="string">  else</span>
<span class="string">    return 0;</span>
<span class="string">}</span>

<span class="string">/* Searches for the full path of the wrapper.  Returns</span>
<span class="string">   newly allocated full path name if found, NULL otherwise */</span>
<span class="string">char *</span>
<span class="string">find_executable (const char* wrapper)</span>
<span class="string">{</span>
<span class="string">  int has_slash = 0;</span>
<span class="string">  const char* p;</span>
<span class="string">  const char* p_next;</span>
<span class="string">  /* static buffer for getcwd */</span>
<span class="string">  char tmp[LT_PATHMAX + 1];</span>
<span class="string">  int tmp_len;</span>
<span class="string">  char* concat_name;</span>

<span class="string">  DEBUG("(find_executable)  : %s</span><span class="specialchar">\n</span><span class="string">", wrapper ? (*wrapper ? wrapper : "EMPTY!") : "NULL!");</span>

<span class="string">  if ((wrapper == NULL) || (*wrapper == '</span><span class="symbol">\</span><span class="number">0</span><span class="string">'))</span>
<span class="string">    return NULL;</span>

<span class="string">  /* Absolute path? */</span>
<span class="string">#if defined (HAVE_DOS_BASED_FILE_SYSTEM)</span>
<span class="string">  if (isalpha ((unsigned char)wrapper[0]) &amp;&amp; wrapper[1] == '</span><span class="symbol">:</span><span class="string">')</span>
<span class="string">  {</span>
<span class="string">    concat_name = xstrdup (wrapper);</span>
<span class="string">    if (check_executable(concat_name))</span>
<span class="string">      return concat_name;</span>
<span class="string">    XFREE(concat_name);</span>
<span class="string">  }</span>
<span class="string">  else</span>
<span class="string">  {</span>
<span class="string">#endif</span>
<span class="string">    if (IS_DIR_SEPARATOR (wrapper[0]))</span>
<span class="string">    {</span>
<span class="string">      concat_name = xstrdup (wrapper);</span>
<span class="string">      if (check_executable(concat_name))</span>
<span class="string">        return concat_name;</span>
<span class="string">      XFREE(concat_name);</span>
<span class="string">    }</span>
<span class="string">#if defined (HAVE_DOS_BASED_FILE_SYSTEM)</span>
<span class="string">  }</span>
<span class="string">#endif</span>

<span class="string">  for (p = wrapper; *p; p++)</span>
<span class="string">    if (*p == '</span><span class="symbol">/</span><span class="string">')</span>
<span class="string">    {</span>
<span class="string">      has_slash = 1;</span>
<span class="string">      break;</span>
<span class="string">    }</span>
<span class="string">  if (!has_slash)</span>
<span class="string">  {</span>
<span class="string">    /* no slashes; search PATH */</span>
<span class="string">    const char* path = getenv ("PATH");</span>
<span class="string">    if (path != NULL)</span>
<span class="string">    {</span>
<span class="string">      for (p = path; *p; p = p_next)</span>
<span class="string">      {</span>
<span class="string">        const char* q;</span>
<span class="string">        size_t p_len;</span>
<span class="string">        for (q = p; *q; q++)</span>
<span class="string">          if (IS_PATH_SEPARATOR(*q))</span>
<span class="string">            break;</span>
<span class="string">        p_len = q - p;</span>
<span class="string">        p_next = (*q == '</span><span class="symbol">\</span><span class="number">0</span><span class="string">' ? q : q + 1);</span>
<span class="string">        if (p_len == 0)</span>
<span class="string">        {</span>
<span class="string">          /* empty path: current directory */</span>
<span class="string">          if (getcwd (tmp, LT_PATHMAX) == NULL)</span>
<span class="string">            lt_fatal ("getcwd failed");</span>
<span class="string">          tmp_len = strlen(tmp);</span>
<span class="string">          concat_name = XMALLOC(char, tmp_len + 1 + strlen(wrapper) + 1);</span>
<span class="string">          memcpy (concat_name, tmp, tmp_len);</span>
<span class="string">          concat_name[tmp_len] = '</span><span class="symbol">/</span><span class="string">';</span>
<span class="string">          strcpy (concat_name + tmp_len + 1, wrapper);</span>
<span class="string">        }</span>
<span class="string">        else</span>
<span class="string">        {</span>
<span class="string">          concat_name = XMALLOC(char, p_len + 1 + strlen(wrapper) + 1);</span>
<span class="string">          memcpy (concat_name, p, p_len);</span>
<span class="string">          concat_name[p_len] = '</span><span class="symbol">/</span><span class="string">';</span>
<span class="string">          strcpy (concat_name + p_len + 1, wrapper);</span>
<span class="string">        }</span>
<span class="string">        if (check_executable(concat_name))</span>
<span class="string">          return concat_name;</span>
<span class="string">        XFREE(concat_name);</span>
<span class="string">      }</span>
<span class="string">    }</span>
<span class="string">    /* not found in PATH; assume curdir */</span>
<span class="string">  }</span>
<span class="string">  /* Relative path | not found in path: prepend cwd */</span>
<span class="string">  if (getcwd (tmp, LT_PATHMAX) == NULL)</span>
<span class="string">    lt_fatal ("getcwd failed");</span>
<span class="string">  tmp_len = strlen(tmp);</span>
<span class="string">  concat_name = XMALLOC(char, tmp_len + 1 + strlen(wrapper) + 1);</span>
<span class="string">  memcpy (concat_name, tmp, tmp_len);</span>
<span class="string">  concat_name[tmp_len] = '</span><span class="symbol">/</span><span class="string">';</span>
<span class="string">  strcpy (concat_name + tmp_len + 1, wrapper);</span>

<span class="string">  if (check_executable(concat_name))</span>
<span class="string">    return concat_name;</span>
<span class="string">  XFREE(concat_name);</span>
<span class="string">  return NULL;</span>
<span class="string">}</span>

<span class="string">char *</span>
<span class="string">strendzap(char *str, const char *pat)</span>
<span class="string">{</span>
<span class="string">  size_t len, patlen;</span>

<span class="string">  assert(str != NULL);</span>
<span class="string">  assert(pat != NULL);</span>

<span class="string">  len = strlen(str);</span>
<span class="string">  patlen = strlen(pat);</span>

<span class="string">  if (patlen &lt;= len)</span>
<span class="string">  {</span>
<span class="string">    str += len - patlen;</span>
<span class="string">    if (strcmp(str, pat) == 0)</span>
<span class="string">      *str = '</span><span class="symbol">\</span><span class="number">0</span><span class="string">';</span>
<span class="string">  }</span>
<span class="string">  return str;</span>
<span class="string">}</span>

<span class="string">static void</span>
<span class="string">lt_error_core (int exit_status, const char * mode,</span>
<span class="string">          const char * message, va_list ap)</span>
<span class="string">{</span>
<span class="string">  fprintf (stderr, "%s: %s: ", program_name, mode);</span>
<span class="string">  vfprintf (stderr, message, ap);</span>
<span class="string">  fprintf (stderr, ".</span><span class="specialchar">\n</span><span class="string">");</span>

<span class="string">  if (exit_status &gt;= 0)</span>
<span class="string">    exit (exit_status);</span>
<span class="string">}</span>

<span class="string">void</span>
<span class="string">lt_fatal (const char *message, ...)</span>
<span class="string">{</span>
<span class="string">  va_list ap;</span>
<span class="string">  va_start (ap, message);</span>
<span class="string">  lt_error_core (EXIT_FAILURE, "FATAL", message, ap);</span>
<span class="string">  va_end (ap);</span>
<span class="string">}</span>
<span class="string">EOF</span>
<span class="string">          # we should really use a build-platform specific compiler</span>
<span class="string">          # here, but OTOH, the wrappers (shell script and this C one)</span>
<span class="string">          # are only useful if you want to execute the "real" binary.</span>
<span class="string">          # Since the "real" binary is built for $host, then this</span>
<span class="string">          # wrapper might as well be built for $host, too.</span>
<span class="string">          $run $LTCC $LTCFLAGS -s -o $cwrapper $cwrappersource</span>
<span class="string">          ;;</span>
<span class="string">        esac</span>
<span class="string">        $rm $output</span>
<span class="string">        trap "$rm $output; exit $EXIT_FAILURE" 1 2 15</span>

<span class="string">	$echo &gt; $output "\</span>
<span class="string">#! $SHELL</span>

<span class="string"># $output - temporary wrapper script for $objdir/$outputname</span>
<span class="string"># Generated by $PROGRAM - GNU $PACKAGE $VERSION$TIMESTAMP</span>
<span class="string">#</span>
<span class="string"># The $output program cannot be directly executed until all the libtool</span>
<span class="string"># libraries that it depends on are installed.</span>
<span class="string">#</span>
<span class="string"># This wrapper script should never be moved out of the build directory.</span>
<span class="string"># If it is, it will not operate correctly.</span>

<span class="string"># Sed substitution that helps us do robust quoting.  It backslashifies</span>
<span class="string"># metacharacters that are still active within double-quoted strings.</span>
<span class="string">Xsed='</span><span class="variable">${SED}</span><span class="normal"> -e 1s</span><span class="symbol">/^</span><span class="normal">X</span><span class="symbol">//</span><span class="string">'</span>
<span class="string">sed_quote_subst='</span><span class="variable">$sed_quote_subst</span><span class="string">'</span>

<span class="string"># Be Bourne compatible (taken from Autoconf:_AS_BOURNE_COMPATIBLE).</span>
<span class="string">if test -n </span><span class="specialchar">\"\$</span><span class="string">{ZSH_VERSION+set}</span><span class="specialchar">\"</span><span class="string"> &amp;&amp; (emulate sh) &gt;/dev/null 2&gt;&amp;1; then</span>
<span class="string">  emulate sh</span>
<span class="string">  NULLCMD=:</span>
<span class="string">  # Zsh 3.x and 4.x performs word splitting on </span><span class="specialchar">\$</span><span class="string">{1+</span><span class="specialchar">\"\$</span><span class="string">@</span><span class="specialchar">\"</span><span class="string">}, which</span>
<span class="string">  # is contrary to our usage.  Disable this feature.</span>
<span class="string">  alias -g '</span><span class="symbol">\</span><span class="variable">${1+\"\$@\"}</span><span class="string">'='</span><span class="normal">\"</span><span class="symbol">\</span><span class="variable">$@</span><span class="normal">\"</span><span class="string">'</span>
<span class="string">  setopt NO_GLOB_SUBST</span>
<span class="string">else</span>
<span class="string">  case </span><span class="specialchar">\`</span><span class="string">(set -o) 2&gt;/dev/null</span><span class="specialchar">\`</span><span class="string"> in *posix*) set -o posix;; esac</span>
<span class="string">fi</span>
<span class="string">BIN_SH=xpg4; export BIN_SH # for Tru64</span>
<span class="string">DUALCASE=1; export DUALCASE # for MKS sh</span>

<span class="string"># The HP-UX ksh and POSIX shell print the target directory to stdout</span>
<span class="string"># if CDPATH is set.</span>
<span class="string">(unset CDPATH) &gt;/dev/null 2&gt;&amp;1 &amp;&amp; unset CDPATH</span>

<span class="string">relink_command=</span><span class="specialchar">\"</span><span class="string">$relink_command</span><span class="specialchar">\"</span>

<span class="string"># This environment variable determines our operation mode.</span>
<span class="string">if test </span><span class="specialchar">\"\$</span><span class="string">libtool_install_magic</span><span class="specialchar">\"</span><span class="string"> = </span><span class="specialchar">\"</span><span class="string">$magic</span><span class="specialchar">\"</span><span class="string">; then</span>
<span class="string">  # install mode needs the following variable:</span>
<span class="string">  notinst_deplibs='</span><span class="variable">$notinst_deplibs</span><span class="string">'</span>
<span class="string">else</span>
<span class="string">  # When we are sourced in execute mode, </span><span class="specialchar">\$</span><span class="string">file and </span><span class="specialchar">\$</span><span class="string">echo are already set.</span>
<span class="string">  if test </span><span class="specialchar">\"\$</span><span class="string">libtool_execute_magic</span><span class="specialchar">\"</span><span class="string"> != </span><span class="specialchar">\"</span><span class="string">$magic</span><span class="specialchar">\"</span><span class="string">; then</span>
<span class="string">    echo=</span><span class="specialchar">\"</span><span class="string">$qecho</span><span class="specialchar">\"</span>
<span class="string">    file=</span><span class="specialchar">\"\$</span><span class="string">0</span><span class="specialchar">\"</span>
<span class="string">    # Make sure echo works.</span>
<span class="string">    if test </span><span class="specialchar">\"</span><span class="string">X</span><span class="specialchar">\$</span><span class="string">1</span><span class="specialchar">\"</span><span class="string"> = X--no-reexec; then</span>
<span class="string">      # Discard the --no-reexec flag, and continue.</span>
<span class="string">      shift</span>
<span class="string">    elif test </span><span class="specialchar">\"</span><span class="string">X</span><span class="specialchar">\`</span><span class="string">(</span><span class="specialchar">\$</span><span class="string">echo '</span><span class="symbol">\</span><span class="normal">t</span><span class="string">') 2&gt;/dev/null</span><span class="specialchar">\`\"</span><span class="string"> = '</span><span class="normal">X</span><span class="symbol">\</span><span class="normal">t</span><span class="string">'; then</span>
<span class="string">      # Yippee, </span><span class="specialchar">\$</span><span class="string">echo works!</span>
<span class="string">      :</span>
<span class="string">    else</span>
<span class="string">      # Restart under the correct shell, and then maybe </span><span class="specialchar">\$</span><span class="string">echo will work.</span>
<span class="string">      exec $SHELL </span><span class="specialchar">\"\$</span><span class="string">0</span><span class="specialchar">\"</span><span class="string"> --no-reexec </span><span class="specialchar">\$</span><span class="string">{1+</span><span class="specialchar">\"\$</span><span class="string">@</span><span class="specialchar">\"</span><span class="string">}</span>
<span class="string">    fi</span>
<span class="string">  fi\</span>
<span class="string">"</span>
<span class="string">	$echo &gt;&gt; $output "\</span>

<span class="string">  # Find the directory that this script lives in.</span>
<span class="string">  thisdir=</span><span class="specialchar">\`\$</span><span class="string">echo </span><span class="specialchar">\"</span><span class="string">X</span><span class="specialchar">\$</span><span class="string">file</span><span class="specialchar">\"</span><span class="string"> | </span><span class="specialchar">\$</span><span class="string">Xsed -e '</span><span class="normal">s</span><span class="symbol">%/[^/]*</span><span class="variable">$%</span><span class="symbol">%</span><span class="string">'</span><span class="specialchar">\`</span>
<span class="string">  test </span><span class="specialchar">\"</span><span class="string">x</span><span class="specialchar">\$</span><span class="string">thisdir</span><span class="specialchar">\"</span><span class="string"> = </span><span class="specialchar">\"</span><span class="string">x</span><span class="specialchar">\$</span><span class="string">file</span><span class="specialchar">\"</span><span class="string"> &amp;&amp; thisdir=.</span>

<span class="string">  # Follow symbolic links until we get to the real thisdir.</span>
<span class="string">  file=</span><span class="specialchar">\`</span><span class="string">ls -ld </span><span class="specialchar">\"\$</span><span class="string">file</span><span class="specialchar">\"</span><span class="string"> | ${SED} -n '</span><span class="normal">s</span><span class="symbol">/.*</span><span class="normal">-</span><span class="symbol">&gt;</span><span class="normal"> //p</span><span class="string">'</span><span class="specialchar">\`</span>
<span class="string">  while test -n </span><span class="specialchar">\"\$</span><span class="string">file</span><span class="specialchar">\"</span><span class="string">; do</span>
<span class="string">    destdir=</span><span class="specialchar">\`\$</span><span class="string">echo </span><span class="specialchar">\"</span><span class="string">X</span><span class="specialchar">\$</span><span class="string">file</span><span class="specialchar">\"</span><span class="string"> | </span><span class="specialchar">\$</span><span class="string">Xsed -e '</span><span class="normal">s</span><span class="symbol">%/[^/]*\</span><span class="variable">$%</span><span class="symbol">%</span><span class="string">'</span><span class="specialchar">\`</span>

<span class="string">    # If there was a directory component, then change thisdir.</span>
<span class="string">    if test </span><span class="specialchar">\"</span><span class="string">x</span><span class="specialchar">\$</span><span class="string">destdir</span><span class="specialchar">\"</span><span class="string"> != </span><span class="specialchar">\"</span><span class="string">x</span><span class="specialchar">\$</span><span class="string">file</span><span class="specialchar">\"</span><span class="string">; then</span>
<span class="string">      case </span><span class="specialchar">\"\$</span><span class="string">destdir</span><span class="specialchar">\"</span><span class="string"> in</span>
<span class="string">      [</span><span class="specialchar">\\\\</span><span class="string">/]* | [A-Za-z]:[</span><span class="specialchar">\\\\</span><span class="string">/]*) thisdir=</span><span class="specialchar">\"\$</span><span class="string">destdir</span><span class="specialchar">\"</span><span class="string"> ;;</span>
<span class="string">      *) thisdir=</span><span class="specialchar">\"\$</span><span class="string">thisdir/</span><span class="specialchar">\$</span><span class="string">destdir</span><span class="specialchar">\"</span><span class="string"> ;;</span>
<span class="string">      esac</span>
<span class="string">    fi</span>

<span class="string">    file=</span><span class="specialchar">\`\$</span><span class="string">echo </span><span class="specialchar">\"</span><span class="string">X</span><span class="specialchar">\$</span><span class="string">file</span><span class="specialchar">\"</span><span class="string"> | </span><span class="specialchar">\$</span><span class="string">Xsed -e '</span><span class="normal">s</span><span class="symbol">%^.*/%%</span><span class="string">'</span><span class="specialchar">\`</span>
<span class="string">    file=</span><span class="specialchar">\`</span><span class="string">ls -ld </span><span class="specialchar">\"\$</span><span class="string">thisdir/</span><span class="specialchar">\$</span><span class="string">file</span><span class="specialchar">\"</span><span class="string"> | ${SED} -n '</span><span class="normal">s</span><span class="symbol">/.*</span><span class="normal">-</span><span class="symbol">&gt;</span><span class="normal"> //p</span><span class="string">'</span><span class="specialchar">\`</span>
<span class="string">  done</span>

<span class="string">  # Try to get the absolute directory name.</span>
<span class="string">  absdir=</span><span class="specialchar">\`</span><span class="string">cd </span><span class="specialchar">\"\$</span><span class="string">thisdir</span><span class="specialchar">\"</span><span class="string"> &amp;&amp; pwd</span><span class="specialchar">\`</span>
<span class="string">  test -n </span><span class="specialchar">\"\$</span><span class="string">absdir</span><span class="specialchar">\"</span><span class="string"> &amp;&amp; thisdir=</span><span class="specialchar">\"\$</span><span class="string">absdir</span><span class="specialchar">\"</span>
<span class="string">"</span>

<span class="string">	if test "$fast_install" = yes; then</span>
<span class="string">	  $echo &gt;&gt; $output "\</span>
<span class="string">  program=lt-'</span><span class="variable">$outputname</span><span class="string">'$exeext</span>
<span class="string">  progdir=</span><span class="specialchar">\"\$</span><span class="string">thisdir/$objdir</span><span class="specialchar">\"</span>

<span class="string">  if test ! -f </span><span class="specialchar">\"\$</span><span class="string">progdir/</span><span class="specialchar">\$</span><span class="string">program</span><span class="specialchar">\"</span><span class="string"> || </span><span class="specialchar">\\</span>
<span class="string">     { file=</span><span class="specialchar">\`</span><span class="string">ls -1dt </span><span class="specialchar">\"\$</span><span class="string">progdir/</span><span class="specialchar">\$</span><span class="string">program</span><span class="specialchar">\"</span><span class="string"> </span><span class="specialchar">\"\$</span><span class="string">progdir/../</span><span class="specialchar">\$</span><span class="string">program</span><span class="specialchar">\"</span><span class="string"> 2&gt;/dev/null | ${SED} 1q</span><span class="specialchar">\`</span><span class="string">; </span><span class="specialchar">\\</span>
<span class="string">       test </span><span class="specialchar">\"</span><span class="string">X</span><span class="specialchar">\$</span><span class="string">file</span><span class="specialchar">\"</span><span class="string"> != </span><span class="specialchar">\"</span><span class="string">X</span><span class="specialchar">\$</span><span class="string">progdir/</span><span class="specialchar">\$</span><span class="string">program</span><span class="specialchar">\"</span><span class="string">; }; then</span>

<span class="string">    file=</span><span class="specialchar">\"\$\$</span><span class="string">-</span><span class="specialchar">\$</span><span class="string">program</span><span class="specialchar">\"</span>

<span class="string">    if test ! -d </span><span class="specialchar">\"\$</span><span class="string">progdir</span><span class="specialchar">\"</span><span class="string">; then</span>
<span class="string">      $mkdir </span><span class="specialchar">\"\$</span><span class="string">progdir</span><span class="specialchar">\"</span>
<span class="string">    else</span>
<span class="string">      $rm </span><span class="specialchar">\"\$</span><span class="string">progdir/</span><span class="specialchar">\$</span><span class="string">file</span><span class="specialchar">\"</span>
<span class="string">    fi"</span>

<span class="string">	  $echo &gt;&gt; $output "\</span>

<span class="string">    # relink executable if necessary</span>
<span class="string">    if test -n </span><span class="specialchar">\"\$</span><span class="string">relink_command</span><span class="specialchar">\"</span><span class="string">; then</span>
<span class="string">      if relink_command_output=</span><span class="specialchar">\`</span><span class="string">eval </span><span class="specialchar">\$</span><span class="string">relink_command 2&gt;&amp;1</span><span class="specialchar">\`</span><span class="string">; then :</span>
<span class="string">      else</span>
<span class="string">	$echo </span><span class="specialchar">\"\$</span><span class="string">relink_command_output</span><span class="specialchar">\"</span><span class="string"> &gt;&amp;2</span>
<span class="string">	$rm </span><span class="specialchar">\"\$</span><span class="string">progdir/</span><span class="specialchar">\$</span><span class="string">file</span><span class="specialchar">\"</span>
<span class="string">	exit $EXIT_FAILURE</span>
<span class="string">      fi</span>
<span class="string">    fi</span>

<span class="string">    $mv </span><span class="specialchar">\"\$</span><span class="string">progdir/</span><span class="specialchar">\$</span><span class="string">file</span><span class="specialchar">\"</span><span class="string"> </span><span class="specialchar">\"\$</span><span class="string">progdir/</span><span class="specialchar">\$</span><span class="string">program</span><span class="specialchar">\"</span><span class="string"> 2&gt;/dev/null ||</span>
<span class="string">    { $rm </span><span class="specialchar">\"\$</span><span class="string">progdir/</span><span class="specialchar">\$</span><span class="string">program</span><span class="specialchar">\"</span><span class="string">;</span>
<span class="string">      $mv </span><span class="specialchar">\"\$</span><span class="string">progdir/</span><span class="specialchar">\$</span><span class="string">file</span><span class="specialchar">\"</span><span class="string"> </span><span class="specialchar">\"\$</span><span class="string">progdir/</span><span class="specialchar">\$</span><span class="string">program</span><span class="specialchar">\"</span><span class="string">; }</span>
<span class="string">    $rm </span><span class="specialchar">\"\$</span><span class="string">progdir/</span><span class="specialchar">\$</span><span class="string">file</span><span class="specialchar">\"</span>
<span class="string">  fi"</span>
<span class="string">	else</span>
<span class="string">	  $echo &gt;&gt; $output "\</span>
<span class="string">  program='</span><span class="variable">$outputname</span><span class="string">'</span>
<span class="string">  progdir=</span><span class="specialchar">\"\$</span><span class="string">thisdir/$objdir</span><span class="specialchar">\"</span>
<span class="string">"</span>
<span class="string">	fi</span>

<span class="string">	$echo &gt;&gt; $output "\</span>

<span class="string">  if test -f </span><span class="specialchar">\"\$</span><span class="string">progdir/</span><span class="specialchar">\$</span><span class="string">program</span><span class="specialchar">\"</span><span class="string">; then"</span>

<span class="string">	# Export our shlibpath_var if we have one.</span>
<span class="string">	if test "$shlibpath_overrides_runpath" = yes &amp;&amp; test -n "$shlibpath_var" &amp;&amp; test -n "$temp_rpath"; then</span>
<span class="string">	  $echo &gt;&gt; $output "\</span>
<span class="string">    # Add our own library path to $shlibpath_var</span>
<span class="string">    $shlibpath_var=</span><span class="specialchar">\"</span><span class="string">$temp_rpath</span><span class="specialchar">\$</span><span class="string">$shlibpath_var</span><span class="specialchar">\"</span>

<span class="string">    # Some systems cannot cope with colon-terminated $shlibpath_var</span>
<span class="string">    # The second colon is a workaround for a bug in BeOS R4 sed</span>
<span class="string">    $shlibpath_var=</span><span class="specialchar">\`\$</span><span class="string">echo </span><span class="specialchar">\"</span><span class="string">X</span><span class="specialchar">\$</span><span class="string">$shlibpath_var</span><span class="specialchar">\"</span><span class="string"> | </span><span class="specialchar">\$</span><span class="string">Xsed -e '</span><span class="normal">s</span><span class="symbol">/::*\</span><span class="variable">$/</span><span class="symbol">/</span><span class="string">'</span><span class="specialchar">\`</span>

<span class="string">    export $shlibpath_var</span>
<span class="string">"</span>
<span class="string">	fi</span>

<span class="string">	# fixup the dll searchpath if we need to.</span>
<span class="string">	if test -n "$dllsearchpath"; then</span>
<span class="string">	  $echo &gt;&gt; $output "\</span>
<span class="string">    # Add the dll search path components to the executable PATH</span>
<span class="string">    PATH=$dllsearchpath:</span><span class="specialchar">\$</span><span class="string">PATH</span>
<span class="string">"</span>
<span class="string">	fi</span>

<span class="string">	$echo &gt;&gt; $output "\</span>
<span class="string">    if test </span><span class="specialchar">\"\$</span><span class="string">libtool_execute_magic</span><span class="specialchar">\"</span><span class="string"> != </span><span class="specialchar">\"</span><span class="string">$magic</span><span class="specialchar">\"</span><span class="string">; then</span>
<span class="string">      # Run the actual program with our arguments.</span>

<span class="string">      # Make sure env LD_LIBRARY_PATH does not mess us up</span>
<span class="string">      if test -n </span><span class="specialchar">\"\$</span><span class="string">{LD_LIBRARY_PATH+set}</span><span class="specialchar">\"</span><span class="string">; then</span>
<span class="string">        export LD_LIBRARY_PATH=</span><span class="specialchar">\$</span><span class="string">progdir:</span><span class="specialchar">\$</span><span class="string">LD_LIBRARY_PATH</span>
<span class="string">      fi</span>
<span class="string">"</span>
<span class="string">	case $host in</span>
<span class="string">	# Backslashes separate directories on plain windows</span>
<span class="string">	*-*-mingw | *-*-os2*)</span>
<span class="string">	  $echo &gt;&gt; $output "\</span>
<span class="string">      exec </span><span class="specialchar">\"\$</span><span class="string">progdir</span><span class="specialchar">\\\\\$</span><span class="string">program</span><span class="specialchar">\"</span><span class="string"> </span><span class="specialchar">\$</span><span class="string">{1+</span><span class="specialchar">\"\$</span><span class="string">@</span><span class="specialchar">\"</span><span class="string">}</span>
<span class="string">"</span>
<span class="string">	  ;;</span>

<span class="string">	*)</span>
<span class="string">	  $echo &gt;&gt; $output "\</span>
<span class="string">      exec </span><span class="specialchar">\"\$</span><span class="string">progdir/</span><span class="specialchar">\$</span><span class="string">program</span><span class="specialchar">\"</span><span class="string"> </span><span class="specialchar">\$</span><span class="string">{1+</span><span class="specialchar">\"\$</span><span class="string">@</span><span class="specialchar">\"</span><span class="string">}</span>
<span class="string">"</span>
<span class="string">	  ;;</span>
<span class="string">	esac</span>
<span class="string">	$echo &gt;&gt; $output "\</span>
<span class="string">      </span><span class="specialchar">\$</span><span class="string">echo </span><span class="specialchar">\"\$</span><span class="string">0: cannot exec </span><span class="specialchar">\$</span><span class="string">program </span><span class="specialchar">\$</span><span class="string">*</span><span class="specialchar">\"</span>
<span class="string">      exit $EXIT_FAILURE</span>
<span class="string">    fi</span>
<span class="string">  else</span>
<span class="string">    # The program doesn'</span><span class="normal">t exist</span><span class="symbol">.</span>
<span class="normal">    </span><span class="symbol">\</span><span class="variable">$echo</span><span class="normal"> \"</span><span class="symbol">\</span><span class="variable">$0</span><span class="symbol">:</span><span class="normal"> error</span><span class="symbol">:</span><span class="normal"> </span><span class="symbol">\\\</span><span class="normal">`</span><span class="symbol">\</span><span class="variable">$progdir</span><span class="symbol">/\</span><span class="variable">$program</span><span class="string">' does not exist</span><span class="specialchar">\"</span><span class="string"> 1&gt;&amp;2</span>
<span class="string">    </span><span class="specialchar">\$</span><span class="string">echo </span><span class="specialchar">\"</span><span class="string">This script is just a wrapper for </span><span class="specialchar">\$</span><span class="string">program.</span><span class="specialchar">\"</span><span class="string"> 1&gt;&amp;2</span>
<span class="string">    $echo </span><span class="specialchar">\"</span><span class="string">See the $PACKAGE documentation for more information.</span><span class="specialchar">\"</span><span class="string"> 1&gt;&amp;2</span>
<span class="string">    exit $EXIT_FAILURE</span>
<span class="string">  fi</span>
<span class="string">fi\</span>
<span class="string">"</span>
<span class="string">	chmod +x $output</span>
<span class="string">      fi</span>
<span class="string">      exit $EXIT_SUCCESS</span>
<span class="string">      ;;</span>
<span class="string">    esac</span>

<span class="string">    # See if we need to build an old-fashioned archive.</span>
<span class="string">    for oldlib in $oldlibs; do</span>

<span class="string">      if test "$build_libtool_libs" = convenience; then</span>
<span class="string">	oldobjs="$libobjs_save"</span>
<span class="string">	addlibs="$convenience"</span>
<span class="string">	build_libtool_libs=no</span>
<span class="string">      else</span>
<span class="string">	if test "$build_libtool_libs" = module; then</span>
<span class="string">	  oldobjs="$libobjs_save"</span>
<span class="string">	  build_libtool_libs=no</span>
<span class="string">	else</span>
<span class="string">	  oldobjs="$old_deplibs $non_pic_objects"</span>
<span class="string">	fi</span>
<span class="string">	addlibs="$old_convenience"</span>
<span class="string">      fi</span>

<span class="string">      if test -n "$addlibs"; then</span>
<span class="string">	gentop="$output_objdir/${outputname}x"</span>
<span class="string">	generated="$generated $gentop"</span>

<span class="string">	func_extract_archives $gentop $addlibs</span>
<span class="string">	oldobjs="$oldobjs $func_extract_archives_result"</span>
<span class="string">      fi</span>

<span class="string">      # Do each command in the archive commands.</span>
<span class="string">      if test -n "$old_archive_from_new_cmds" &amp;&amp; test "$build_libtool_libs" = yes; then</span>
<span class="string">       cmds=$old_archive_from_new_cmds</span>
<span class="string">      else</span>
<span class="string">	# POSIX demands no paths to be encoded in archives.  We have</span>
<span class="string">	# to avoid creating archives with duplicate basenames if we</span>
<span class="string">	# might have to extract them afterwards, e.g., when creating a</span>
<span class="string">	# static archive out of a convenience library, or when linking</span>
<span class="string">	# the entirety of a libtool archive into another (currently</span>
<span class="string">	# not supported by libtool).</span>
<span class="string">	if (for obj in $oldobjs</span>
<span class="string">	    do</span>
<span class="string">	      $echo "X$obj" | $Xsed -e '</span><span class="normal">s</span><span class="symbol">%^.*/%%</span><span class="string">'</span>
<span class="string">	    done | sort | sort -uc &gt;/dev/null 2&gt;&amp;1); then</span>
<span class="string">	  :</span>
<span class="string">	else</span>
<span class="string">	  $echo "copying selected object files to avoid basename conflicts..."</span>

<span class="string">	  if test -z "$gentop"; then</span>
<span class="string">	    gentop="$output_objdir/${outputname}x"</span>
<span class="string">	    generated="$generated $gentop"</span>

<span class="string">	    $show "${rm}r $gentop"</span>
<span class="string">	    $run ${rm}r "$gentop"</span>
<span class="string">	    $show "$mkdir $gentop"</span>
<span class="string">	    $run $mkdir "$gentop"</span>
<span class="string">	    exit_status=$?</span>
<span class="string">	    if test "$exit_status" -ne 0 &amp;&amp; test ! -d "$gentop"; then</span>
<span class="string">	      exit $exit_status</span>
<span class="string">	    fi</span>
<span class="string">	  fi</span>

<span class="string">	  save_oldobjs=$oldobjs</span>
<span class="string">	  oldobjs=</span>
<span class="string">	  counter=1</span>
<span class="string">	  for obj in $save_oldobjs</span>
<span class="string">	  do</span>
<span class="string">	    objbase=`$echo "X$obj" | $Xsed -e '</span><span class="normal">s</span><span class="symbol">%^.*/%%</span><span class="string">'`</span>
<span class="string">	    case " $oldobjs " in</span>
<span class="string">	    " ") oldobjs=$obj ;;</span>
<span class="string">	    *[</span><span class="specialchar">\ </span><span class="string">/]"$objbase "*)</span>
<span class="string">	      while :; do</span>
<span class="string">		# Make sure we don'</span><span class="normal">t pick an alternate name that also</span>
<span class="normal">		</span><span class="comment"># overlaps.</span>
<span class="normal">		</span><span class="variable">newobj</span><span class="symbol">=</span><span class="normal">lt</span><span class="variable">$counter</span><span class="normal">-</span><span class="variable">$objbase</span>
<span class="normal">		</span><span class="variable">counter</span><span class="symbol">=</span><span class="normal">`expr </span><span class="variable">$counter</span><span class="normal"> </span><span class="symbol">+</span><span class="normal"> </span><span class="number">1</span><span class="normal">`</span>
<span class="normal">		</span><span class="keyword">case</span><span class="normal"> </span><span class="string">" $oldobjs "</span><span class="normal"> </span><span class="keyword">in</span>
<span class="normal">		</span><span class="symbol">*[\</span><span class="normal"> </span><span class="symbol">/]</span><span class="string">"$newobj "</span><span class="symbol">*)</span><span class="normal"> </span><span class="symbol">;;</span>
<span class="normal">		</span><span class="symbol">*)</span><span class="normal"> </span><span class="keyword">if</span><span class="normal"> </span><span class="keyword">test</span><span class="normal"> </span><span class="symbol">!</span><span class="normal"> -f </span><span class="string">"$gentop/$newobj"</span><span class="symbol">;</span><span class="normal"> </span><span class="keyword">then</span><span class="normal"> </span><span class="keyword">break</span><span class="symbol">;</span><span class="normal"> </span><span class="keyword">fi</span><span class="normal"> </span><span class="symbol">;;</span>
<span class="normal">		</span><span class="keyword">esac</span>
<span class="normal">	      </span><span class="keyword">done</span>
<span class="normal">	      </span><span class="variable">$show</span><span class="normal"> </span><span class="string">"ln $obj $gentop/$newobj || cp $obj $gentop/$newobj"</span>
<span class="normal">	      </span><span class="variable">$run</span><span class="normal"> ln </span><span class="string">"$obj"</span><span class="normal"> </span><span class="string">"$gentop/$newobj"</span><span class="normal"> </span><span class="symbol">||</span>
<span class="normal">	      </span><span class="variable">$run</span><span class="normal"> cp </span><span class="string">"$obj"</span><span class="normal"> </span><span class="string">"$gentop/$newobj"</span>
<span class="normal">	      </span><span class="variable">oldobjs</span><span class="symbol">=</span><span class="string">"$oldobjs $gentop/$newobj"</span>
<span class="normal">	      </span><span class="symbol">;;</span>
<span class="normal">	    </span><span class="symbol">*)</span><span class="normal"> </span><span class="variable">oldobjs</span><span class="symbol">=</span><span class="string">"$oldobjs $obj"</span><span class="normal"> </span><span class="symbol">;;</span>
<span class="normal">	    </span><span class="keyword">esac</span>
<span class="normal">	  </span><span class="keyword">done</span>
<span class="normal">	</span><span class="keyword">fi</span>

<span class="normal">	</span><span class="keyword">eval</span><span class="normal"> </span><span class="variable">cmds</span><span class="symbol">=</span><span class="normal">\"</span><span class="variable">$old_archive_cmds</span><span class="normal">\"</span>

<span class="normal">	</span><span class="keyword">if</span><span class="normal"> </span><span class="variable">len</span><span class="symbol">=</span><span class="normal">`expr </span><span class="string">"X$cmds"</span><span class="normal"> </span><span class="symbol">:</span><span class="normal"> </span><span class="string">".*"</span><span class="normal">` </span><span class="symbol">&amp;&amp;</span>
<span class="normal">	     </span><span class="keyword">test</span><span class="normal"> </span><span class="string">"$len"</span><span class="normal"> -le </span><span class="string">"$max_cmd_len"</span><span class="normal"> </span><span class="symbol">||</span><span class="normal"> </span><span class="keyword">test</span><span class="normal"> </span><span class="string">"$max_cmd_len"</span><span class="normal"> -le -</span><span class="number">1</span><span class="symbol">;</span><span class="normal"> </span><span class="keyword">then</span>
<span class="normal">	  </span><span class="variable">cmds</span><span class="symbol">=</span><span class="variable">$old_archive_cmds</span>
<span class="normal">	</span><span class="keyword">else</span>
<span class="normal">	  </span><span class="comment"># the command line is too long to link in one step, link in parts</span>
<span class="normal">	  </span><span class="variable">$echo</span><span class="normal"> </span><span class="string">"using piecewise archive linking..."</span>
<span class="normal">	  </span><span class="variable">save_RANLIB</span><span class="symbol">=</span><span class="variable">$RANLIB</span>
<span class="normal">	  </span><span class="variable">RANLIB</span><span class="symbol">=:</span>
<span class="normal">	  </span><span class="variable">objlist</span><span class="symbol">=</span>
<span class="normal">	  </span><span class="variable">concat_cmds</span><span class="symbol">=</span>
<span class="normal">	  </span><span class="variable">save_oldobjs</span><span class="symbol">=</span><span class="variable">$oldobjs</span>

<span class="normal">	  </span><span class="comment"># Is there a better way of finding the last object in the list?</span>
<span class="normal">	  </span><span class="keyword">for</span><span class="normal"> obj </span><span class="keyword">in</span><span class="normal"> </span><span class="variable">$save_oldobjs</span>
<span class="normal">	  </span><span class="keyword">do</span>
<span class="normal">	    </span><span class="variable">last_oldobj</span><span class="symbol">=</span><span class="variable">$obj</span>
<span class="normal">	  </span><span class="keyword">done</span>
<span class="normal">	  </span><span class="keyword">for</span><span class="normal"> obj </span><span class="keyword">in</span><span class="normal"> </span><span class="variable">$save_oldobjs</span>
<span class="normal">	  </span><span class="keyword">do</span>
<span class="normal">	    </span><span class="variable">oldobjs</span><span class="symbol">=</span><span class="string">"$objlist $obj"</span>
<span class="normal">	    </span><span class="variable">objlist</span><span class="symbol">=</span><span class="string">"$objlist $obj"</span>
<span class="normal">	    </span><span class="keyword">eval</span><span class="normal"> </span><span class="variable">test_cmds</span><span class="symbol">=</span><span class="normal">\"</span><span class="variable">$old_archive_cmds</span><span class="normal">\"</span>
<span class="normal">	    </span><span class="keyword">if</span><span class="normal"> </span><span class="variable">len</span><span class="symbol">=</span><span class="normal">`expr </span><span class="string">"X$test_cmds"</span><span class="normal"> </span><span class="symbol">:</span><span class="normal"> </span><span class="string">".*"</span><span class="normal"> </span><span class="number">2</span><span class="symbol">&gt;</span><span class="normal">/dev/null` </span><span class="symbol">&amp;&amp;</span>
<span class="normal">	       </span><span class="keyword">test</span><span class="normal"> </span><span class="string">"$len"</span><span class="normal"> -le </span><span class="string">"$max_cmd_len"</span><span class="symbol">;</span><span class="normal"> </span><span class="keyword">then</span>
<span class="normal">	      </span><span class="symbol">:</span>
<span class="normal">	    </span><span class="keyword">else</span>
<span class="normal">	      </span><span class="comment"># the above command should be used before it gets too long</span>
<span class="normal">	      </span><span class="variable">oldobjs</span><span class="symbol">=</span><span class="variable">$objlist</span>
<span class="normal">	      </span><span class="keyword">if</span><span class="normal"> </span><span class="keyword">test</span><span class="normal"> </span><span class="string">"$obj"</span><span class="normal"> </span><span class="symbol">=</span><span class="normal"> </span><span class="string">"$last_oldobj"</span><span class="normal"> </span><span class="symbol">;</span><span class="normal"> </span><span class="keyword">then</span>
<span class="normal">	        </span><span class="variable">RANLIB</span><span class="symbol">=</span><span class="variable">$save_RANLIB</span>
<span class="normal">	      </span><span class="keyword">fi</span>
<span class="normal">	      </span><span class="keyword">test</span><span class="normal"> -z </span><span class="string">"$concat_cmds"</span><span class="normal"> </span><span class="symbol">||</span><span class="normal"> </span><span class="variable">concat_cmds</span><span class="symbol">=</span><span class="variable">$concat_cmds</span><span class="symbol">~</span>
<span class="normal">	      </span><span class="keyword">eval</span><span class="normal"> </span><span class="variable">concat_cmds</span><span class="symbol">=</span><span class="normal">\"</span><span class="symbol">\</span><span class="variable">${concat_cmds}$old_archive_cmds</span><span class="normal">\"</span>
<span class="normal">	      </span><span class="variable">objlist</span><span class="symbol">=</span>
<span class="normal">	    </span><span class="keyword">fi</span>
<span class="normal">	  </span><span class="keyword">done</span>
<span class="normal">	  </span><span class="variable">RANLIB</span><span class="symbol">=</span><span class="variable">$save_RANLIB</span>
<span class="normal">	  </span><span class="variable">oldobjs</span><span class="symbol">=</span><span class="variable">$objlist</span>
<span class="normal">	  </span><span class="keyword">if</span><span class="normal"> </span><span class="keyword">test</span><span class="normal"> </span><span class="string">"X$oldobjs"</span><span class="normal"> </span><span class="symbol">=</span><span class="normal"> </span><span class="string">"X"</span><span class="normal"> </span><span class="symbol">;</span><span class="normal"> </span><span class="keyword">then</span>
<span class="normal">	    </span><span class="keyword">eval</span><span class="normal"> </span><span class="variable">cmds</span><span class="symbol">=</span><span class="normal">\"</span><span class="symbol">\</span><span class="variable">$concat_cmds</span><span class="normal">\"</span>
<span class="normal">	  </span><span class="keyword">else</span>
<span class="normal">	    </span><span class="keyword">eval</span><span class="normal"> </span><span class="variable">cmds</span><span class="symbol">=</span><span class="normal">\"</span><span class="symbol">\</span><span class="variable">$concat_cmds</span><span class="symbol">~\</span><span class="variable">$old_archive_cmds</span><span class="normal">\"</span>
<span class="normal">	  </span><span class="keyword">fi</span>
<span class="normal">	</span><span class="keyword">fi</span>
<span class="normal">      </span><span class="keyword">fi</span>
<span class="normal">      </span><span class="variable">save_ifs</span><span class="symbol">=</span><span class="string">"$IFS"</span><span class="symbol">;</span><span class="normal"> </span><span class="variable">IFS</span><span class="symbol">=</span><span class="string">'~'</span>
<span class="normal">      </span><span class="keyword">for</span><span class="normal"> cmd </span><span class="keyword">in</span><span class="normal"> </span><span class="variable">$cmds</span><span class="symbol">;</span><span class="normal"> </span><span class="keyword">do</span>
<span class="normal">        </span><span class="keyword">eval</span><span class="normal"> </span><span class="variable">cmd</span><span class="symbol">=</span><span class="normal">\"</span><span class="variable">$cmd</span><span class="normal">\"</span>
<span class="normal">	</span><span class="variable">IFS</span><span class="symbol">=</span><span class="string">"$save_ifs"</span>
<span class="normal">	</span><span class="variable">$show</span><span class="normal"> </span><span class="string">"$cmd"</span>
<span class="normal">	</span><span class="variable">$run</span><span class="normal"> </span><span class="keyword">eval</span><span class="normal"> </span><span class="string">"$cmd"</span><span class="normal"> </span><span class="symbol">||</span><span class="normal"> </span><span class="keyword">exit</span><span class="normal"> </span><span class="variable">$?</span>
<span class="normal">      </span><span class="keyword">done</span>
<span class="normal">      </span><span class="variable">IFS</span><span class="symbol">=</span><span class="string">"$save_ifs"</span>
<span class="normal">    </span><span class="keyword">done</span>

<span class="normal">    </span><span class="keyword">if</span><span class="normal"> </span><span class="keyword">test</span><span class="normal"> -n </span><span class="string">"$generated"</span><span class="symbol">;</span><span class="normal"> </span><span class="keyword">then</span>
<span class="normal">      </span><span class="variable">$show</span><span class="normal"> </span><span class="string">"${rm}r$generated"</span>
<span class="normal">      </span><span class="variable">$run</span><span class="normal"> </span><span class="variable">${rm}</span><span class="normal">r</span><span class="variable">$generated</span>
<span class="normal">    </span><span class="keyword">fi</span>

<span class="normal">    </span><span class="comment"># Now create the libtool archive.</span>
<span class="normal">    </span><span class="keyword">case</span><span class="normal"> </span><span class="variable">$output</span><span class="normal"> </span><span class="keyword">in</span>
<span class="normal">    </span><span class="symbol">*.</span><span class="normal">la</span><span class="symbol">)</span>
<span class="normal">      </span><span class="variable">old_library</span><span class="symbol">=</span>
<span class="normal">      </span><span class="keyword">test</span><span class="normal"> </span><span class="string">"$build_old_libs"</span><span class="normal"> </span><span class="symbol">=</span><span class="normal"> yes </span><span class="symbol">&amp;&amp;</span><span class="normal"> </span><span class="variable">old_library</span><span class="symbol">=</span><span class="string">"$libname.$libext"</span>
<span class="normal">      </span><span class="variable">$show</span><span class="normal"> </span><span class="string">"creating $output"</span>

<span class="normal">      </span><span class="comment"># Preserve any variables that may affect compiler behavior</span>
<span class="normal">      </span><span class="keyword">for</span><span class="normal"> var </span><span class="keyword">in</span><span class="normal"> </span><span class="variable">$variables_saved_for_relink</span><span class="symbol">;</span><span class="normal"> </span><span class="keyword">do</span>
<span class="normal">	</span><span class="keyword">if</span><span class="normal"> </span><span class="keyword">eval</span><span class="normal"> </span><span class="keyword">test</span><span class="normal"> -z \"</span><span class="symbol">\</span><span class="variable">${$var+set}</span><span class="normal">\"</span><span class="symbol">;</span><span class="normal"> </span><span class="keyword">then</span>
<span class="normal">	  </span><span class="variable">relink_command</span><span class="symbol">=</span><span class="string">"{ test -z </span><span class="specialchar">\"\$</span><span class="string">{$var+set}</span><span class="specialchar">\"</span><span class="string"> || unset $var || { $var=; export $var; }; }; $relink_command"</span>
<span class="normal">	</span><span class="keyword">elif</span><span class="normal"> </span><span class="keyword">eval</span><span class="normal"> </span><span class="variable">var_value</span><span class="symbol">=\</span><span class="variable">$$</span><span class="normal">var</span><span class="symbol">;</span><span class="normal"> </span><span class="keyword">test</span><span class="normal"> -z </span><span class="string">"$var_value"</span><span class="symbol">;</span><span class="normal"> </span><span class="keyword">then</span>
<span class="normal">	  </span><span class="variable">relink_command</span><span class="symbol">=</span><span class="string">"$var=; export $var; $relink_command"</span>
<span class="normal">	</span><span class="keyword">else</span>
<span class="normal">	  </span><span class="variable">var_value</span><span class="symbol">=</span><span class="normal">`</span><span class="variable">$echo</span><span class="normal"> </span><span class="string">"X$var_value"</span><span class="normal"> </span><span class="symbol">|</span><span class="normal"> </span><span class="variable">$Xsed</span><span class="normal"> -e </span><span class="string">"$sed_quote_subst"</span><span class="normal">`</span>
<span class="normal">	  </span><span class="variable">relink_command</span><span class="symbol">=</span><span class="string">"$var=</span><span class="specialchar">\"</span><span class="string">$var_value</span><span class="specialchar">\"</span><span class="string">; export $var; $relink_command"</span>
<span class="normal">	</span><span class="keyword">fi</span>
<span class="normal">      </span><span class="keyword">done</span>
<span class="normal">      </span><span class="comment"># Quote the link command for shipping.</span>
<span class="normal">      </span><span class="variable">relink_command</span><span class="symbol">=</span><span class="string">"(cd `pwd`; $SHELL $progpath $preserve_args --mode=relink $libtool_args @inst_prefix_dir@)"</span>
<span class="normal">      </span><span class="variable">relink_command</span><span class="symbol">=</span><span class="normal">`</span><span class="variable">$echo</span><span class="normal"> </span><span class="string">"X$relink_command"</span><span class="normal"> </span><span class="symbol">|</span><span class="normal"> </span><span class="variable">$SP2NL</span><span class="normal"> </span><span class="symbol">|</span><span class="normal"> </span><span class="variable">$Xsed</span><span class="normal"> -e </span><span class="string">"$sed_quote_subst"</span><span class="normal"> </span><span class="symbol">|</span><span class="normal"> </span><span class="variable">$NL2SP</span><span class="normal">`</span>
<span class="normal">      </span><span class="keyword">if</span><span class="normal"> </span><span class="keyword">test</span><span class="normal"> </span><span class="string">"$hardcode_automatic"</span><span class="normal"> </span><span class="symbol">=</span><span class="normal"> yes </span><span class="symbol">;</span><span class="normal"> </span><span class="keyword">then</span>
<span class="normal">	</span><span class="variable">relink_command</span><span class="symbol">=</span>
<span class="normal">      </span><span class="keyword">fi</span>


<span class="normal">      </span><span class="comment"># Only create the output if not a dry run.</span>
<span class="normal">      </span><span class="keyword">if</span><span class="normal"> </span><span class="keyword">test</span><span class="normal"> -z </span><span class="string">"$run"</span><span class="symbol">;</span><span class="normal"> </span><span class="keyword">then</span>
<span class="normal">	</span><span class="keyword">for</span><span class="normal"> installed </span><span class="keyword">in</span><span class="normal"> no yes</span><span class="symbol">;</span><span class="normal"> </span><span class="keyword">do</span>
<span class="normal">	  </span><span class="keyword">if</span><span class="normal"> </span><span class="keyword">test</span><span class="normal"> </span><span class="string">"$installed"</span><span class="normal"> </span><span class="symbol">=</span><span class="normal"> yes</span><span class="symbol">;</span><span class="normal"> </span><span class="keyword">then</span>
<span class="normal">	    </span><span class="keyword">if</span><span class="normal"> </span><span class="keyword">test</span><span class="normal"> -z </span><span class="string">"$install_libdir"</span><span class="symbol">;</span><span class="normal"> </span><span class="keyword">then</span>
<span class="normal">	      </span><span class="keyword">break</span>
<span class="normal">	    </span><span class="keyword">fi</span>
<span class="normal">	    </span><span class="variable">output</span><span class="symbol">=</span><span class="string">"$output_objdir/$outputname"</span><span class="normal">i</span>
<span class="normal">	    </span><span class="comment"># Replace all uninstalled libtool libraries with the installed ones</span>
<span class="normal">	    </span><span class="variable">newdependency_libs</span><span class="symbol">=</span>
<span class="normal">	    </span><span class="keyword">for</span><span class="normal"> deplib </span><span class="keyword">in</span><span class="normal"> </span><span class="variable">$dependency_libs</span><span class="symbol">;</span><span class="normal"> </span><span class="keyword">do</span>
<span class="normal">	      </span><span class="keyword">case</span><span class="normal"> </span><span class="variable">$deplib</span><span class="normal"> </span><span class="keyword">in</span>
<span class="normal">	      </span><span class="symbol">*.</span><span class="normal">la</span><span class="symbol">)</span>
<span class="normal">		</span><span class="variable">name</span><span class="symbol">=</span><span class="normal">`</span><span class="variable">$echo</span><span class="normal"> </span><span class="string">"X$deplib"</span><span class="normal"> </span><span class="symbol">|</span><span class="normal"> </span><span class="variable">$Xsed</span><span class="normal"> -e </span><span class="string">'s%^.*/%%'</span><span class="normal">`</span>
<span class="normal">		</span><span class="keyword">eval</span><span class="normal"> </span><span class="variable">libdir</span><span class="symbol">=</span><span class="normal">`</span><span class="variable">${SED}</span><span class="normal"> -n -e </span><span class="string">'s/^libdir=</span><span class="specialchar">\(</span><span class="string">.*</span><span class="specialchar">\)</span><span class="string">$/</span><span class="specialchar">\1</span><span class="string">/p'</span><span class="normal"> </span><span class="variable">$deplib</span><span class="normal">`</span>
<span class="normal">		</span><span class="keyword">if</span><span class="normal"> </span><span class="keyword">test</span><span class="normal"> -z </span><span class="string">"$libdir"</span><span class="symbol">;</span><span class="normal"> </span><span class="keyword">then</span>
<span class="normal">		  </span><span class="variable">$echo</span><span class="normal"> </span><span class="string">"$modename: </span><span class="specialchar">\`</span><span class="string">$deplib' is not a valid libtool archive"</span><span class="normal"> </span><span class="number">1</span><span class="symbol">&gt;&amp;</span><span class="number">2</span>
<span class="normal">		  </span><span class="keyword">exit</span><span class="normal"> </span><span class="variable">$EXIT_FAILURE</span>
<span class="normal">		</span><span class="keyword">fi</span>
<span class="normal">		</span><span class="keyword">if</span><span class="normal"> </span><span class="keyword">test</span><span class="normal"> </span><span class="string">"X$EGREP"</span><span class="normal"> </span><span class="symbol">=</span><span class="normal"> X </span><span class="symbol">;</span><span class="normal"> </span><span class="keyword">then</span>
<span class="normal">			</span><span class="variable">EGREP</span><span class="symbol">=</span><span class="normal">egrep</span>
<span class="normal">		</span><span class="keyword">fi</span>
<span class="normal">		</span><span class="comment"># We do not want portage's install root ($D) present.  Check only for</span>
<span class="normal">		</span><span class="comment"># this if the .la is being installed.</span>
<span class="normal">		</span><span class="keyword">if</span><span class="normal"> </span><span class="keyword">test</span><span class="normal"> </span><span class="string">"$installed"</span><span class="normal"> </span><span class="symbol">=</span><span class="normal"> yes </span><span class="symbol">&amp;&amp;</span><span class="normal"> </span><span class="keyword">test</span><span class="normal"> </span><span class="string">"$D"</span><span class="symbol">;</span><span class="normal"> </span><span class="keyword">then</span>
<span class="normal">		  </span><span class="keyword">eval</span><span class="normal"> </span><span class="variable">mynewdependency_lib</span><span class="symbol">=</span><span class="normal">`echo </span><span class="string">"$libdir/$name"</span><span class="normal"> </span><span class="symbol">|</span><span class="normal">sed -e </span><span class="string">"s:$D:/:g"</span><span class="normal"> -e </span><span class="string">'s:/</span><span class="specialchar">\+</span><span class="string">:/:g'</span><span class="normal">`</span>
<span class="normal">		</span><span class="keyword">else</span>
<span class="normal">		  </span><span class="variable">mynewdependency_lib</span><span class="symbol">=</span><span class="string">"$libdir/$name"</span>
<span class="normal">		</span><span class="keyword">fi</span>
<span class="normal">		</span><span class="comment"># Do not add duplicates</span>
<span class="normal">		</span><span class="keyword">if</span><span class="normal"> </span><span class="keyword">test</span><span class="normal"> </span><span class="string">"$mynewdependency_lib"</span><span class="symbol">;</span><span class="normal"> </span><span class="keyword">then</span>
<span class="normal">		  </span><span class="variable">my_little_ninja_foo_1</span><span class="symbol">=</span><span class="normal">`echo </span><span class="variable">$newdependency_libs</span><span class="normal"> </span><span class="symbol">|</span><span class="variable">$EGREP</span><span class="normal"> -e </span><span class="string">"$mynewdependency_lib"</span><span class="normal">`</span>
<span class="normal">		  </span><span class="keyword">if</span><span class="normal"> </span><span class="keyword">test</span><span class="normal"> -z </span><span class="string">"$my_little_ninja_foo_1"</span><span class="symbol">;</span><span class="normal"> </span><span class="keyword">then</span>
<span class="normal">		    </span><span class="variable">newdependency_libs</span><span class="symbol">=</span><span class="string">"$newdependency_libs $mynewdependency_lib"</span>
<span class="normal">		  </span><span class="keyword">fi</span>
<span class="normal">		</span><span class="keyword">fi</span>
<span class="normal">		</span><span class="symbol">;;</span>
<span class="normal">		  </span><span class="symbol">*)</span>
<span class="normal">		</span><span class="keyword">if</span><span class="normal"> </span><span class="keyword">test</span><span class="normal"> </span><span class="string">"$installed"</span><span class="normal"> </span><span class="symbol">=</span><span class="normal"> yes</span><span class="symbol">;</span><span class="normal"> </span><span class="keyword">then</span>
<span class="normal">		  </span><span class="comment"># Rather use S=WORKDIR if our version of portage supports it.</span>
<span class="normal">		  </span><span class="comment"># This is because some ebuild (gcc) do not use $S as buildroot.</span>
<span class="normal">		  </span><span class="keyword">if</span><span class="normal"> </span><span class="keyword">test</span><span class="normal"> </span><span class="string">"$PWORKDIR"</span><span class="symbol">;</span><span class="normal"> </span><span class="keyword">then</span>
<span class="normal">		    </span><span class="variable">S</span><span class="symbol">=</span><span class="string">"$PWORKDIR"</span>
<span class="normal">		  </span><span class="keyword">fi</span>
<span class="normal">		  </span><span class="comment"># We do not want portage's build root ($S) present.</span>
<span class="normal">		  </span><span class="variable">my_little_ninja_foo_2</span><span class="symbol">=</span><span class="normal">`echo </span><span class="variable">$deplib</span><span class="normal"> </span><span class="symbol">|</span><span class="variable">$EGREP</span><span class="normal"> -e </span><span class="string">"$S"</span><span class="normal">`</span>
<span class="normal">		  </span><span class="comment"># We do not want portage's install root ($D) present.</span>
<span class="normal">		  </span><span class="variable">my_little_ninja_foo_3</span><span class="symbol">=</span><span class="normal">`echo </span><span class="variable">$deplib</span><span class="normal"> </span><span class="symbol">|</span><span class="variable">$EGREP</span><span class="normal"> -e </span><span class="string">"$D"</span><span class="normal">`</span>
<span class="normal">		  </span><span class="keyword">if</span><span class="normal"> </span><span class="keyword">test</span><span class="normal"> -n </span><span class="string">"$my_little_ninja_foo_2"</span><span class="normal"> </span><span class="symbol">&amp;&amp;</span><span class="normal"> </span><span class="keyword">test</span><span class="normal"> </span><span class="string">"$S"</span><span class="symbol">;</span><span class="normal"> </span><span class="keyword">then</span>
<span class="normal">		    </span><span class="variable">mynewdependency_lib</span><span class="symbol">=</span><span class="string">""</span>
<span class="normal">		  </span><span class="keyword">elif</span><span class="normal"> </span><span class="keyword">test</span><span class="normal"> -n </span><span class="string">"$my_little_ninja_foo_3"</span><span class="normal"> </span><span class="symbol">&amp;&amp;</span><span class="normal"> </span><span class="keyword">test</span><span class="normal"> </span><span class="string">"$D"</span><span class="symbol">;</span><span class="normal"> </span><span class="keyword">then</span>
<span class="normal">		    </span><span class="keyword">eval</span><span class="normal"> </span><span class="variable">mynewdependency_lib</span><span class="symbol">=</span><span class="normal">`echo </span><span class="string">"$deplib"</span><span class="normal"> </span><span class="symbol">|</span><span class="normal">sed -e </span><span class="string">"s:$D:/:g"</span><span class="normal"> -e </span><span class="string">'s:/</span><span class="specialchar">\+</span><span class="string">:/:g'</span><span class="normal">`</span>
<span class="normal">		  </span><span class="keyword">else</span>
<span class="normal">		    </span><span class="variable">mynewdependency_lib</span><span class="symbol">=</span><span class="string">"$deplib"</span>
<span class="normal">		  </span><span class="keyword">fi</span>
<span class="normal">		</span><span class="keyword">else</span>
<span class="normal">		  </span><span class="variable">mynewdependency_lib</span><span class="symbol">=</span><span class="string">"$deplib"</span>
<span class="normal">		</span><span class="keyword">fi</span>
<span class="normal">		</span><span class="comment"># Do not add duplicates</span>
<span class="normal">		</span><span class="keyword">if</span><span class="normal"> </span><span class="keyword">test</span><span class="normal"> </span><span class="string">"$mynewdependency_lib"</span><span class="symbol">;</span><span class="normal"> </span><span class="keyword">then</span>
<span class="normal">		  </span><span class="variable">my_little_ninja_foo_4</span><span class="symbol">=</span><span class="normal">`echo </span><span class="variable">$newdependency_libs</span><span class="normal"> </span><span class="symbol">|</span><span class="variable">$EGREP</span><span class="normal"> -e </span><span class="string">"$mynewdependency_lib"</span><span class="normal">`</span>
<span class="normal">		  </span><span class="keyword">if</span><span class="normal"> </span><span class="keyword">test</span><span class="normal"> -z </span><span class="string">"$my_little_ninja_foo_4"</span><span class="symbol">;</span><span class="normal"> </span><span class="keyword">then</span>
<span class="normal">			</span><span class="variable">newdependency_libs</span><span class="symbol">=</span><span class="string">"$newdependency_libs $mynewdependency_lib"</span>
<span class="normal">		  </span><span class="keyword">fi</span>
<span class="normal">		</span><span class="keyword">fi</span>
<span class="normal">		</span><span class="symbol">;;</span>
<span class="normal">	      </span><span class="keyword">esac</span>
<span class="normal">	    </span><span class="keyword">done</span>
<span class="normal">	    </span><span class="variable">dependency_libs</span><span class="symbol">=</span><span class="string">"$newdependency_libs"</span>
<span class="normal">	    </span><span class="variable">newdlfiles</span><span class="symbol">=</span>
<span class="normal">	    </span><span class="keyword">for</span><span class="normal"> lib </span><span class="keyword">in</span><span class="normal"> </span><span class="variable">$dlfiles</span><span class="symbol">;</span><span class="normal"> </span><span class="keyword">do</span>
<span class="normal">	      </span><span class="variable">name</span><span class="symbol">=</span><span class="normal">`</span><span class="variable">$echo</span><span class="normal"> </span><span class="string">"X$lib"</span><span class="normal"> </span><span class="symbol">|</span><span class="normal"> </span><span class="variable">$Xsed</span><span class="normal"> -e </span><span class="string">'s%^.*/%%'</span><span class="normal">`</span>
<span class="normal">	      </span><span class="keyword">eval</span><span class="normal"> </span><span class="variable">libdir</span><span class="symbol">=</span><span class="normal">`</span><span class="variable">${SED}</span><span class="normal"> -n -e </span><span class="string">'s/^libdir=</span><span class="specialchar">\(</span><span class="string">.*</span><span class="specialchar">\)</span><span class="string">$/</span><span class="specialchar">\1</span><span class="string">/p'</span><span class="normal"> </span><span class="variable">$lib</span><span class="normal">`</span>
<span class="normal">	      </span><span class="keyword">if</span><span class="normal"> </span><span class="keyword">test</span><span class="normal"> -z </span><span class="string">"$libdir"</span><span class="symbol">;</span><span class="normal"> </span><span class="keyword">then</span>
<span class="normal">		</span><span class="variable">$echo</span><span class="normal"> </span><span class="string">"$modename: </span><span class="specialchar">\`</span><span class="string">$lib' is not a valid libtool archive"</span><span class="normal"> </span><span class="number">1</span><span class="symbol">&gt;&amp;</span><span class="number">2</span>
<span class="normal">		</span><span class="keyword">exit</span><span class="normal"> </span><span class="variable">$EXIT_FAILURE</span>
<span class="normal">	      </span><span class="keyword">fi</span>
<span class="normal">	      </span><span class="variable">newdlfiles</span><span class="symbol">=</span><span class="string">"$newdlfiles $libdir/$name"</span>
<span class="normal">	    </span><span class="keyword">done</span>
<span class="normal">	    </span><span class="variable">dlfiles</span><span class="symbol">=</span><span class="string">"$newdlfiles"</span>
<span class="normal">	    </span><span class="variable">newdlprefiles</span><span class="symbol">=</span>
<span class="normal">	    </span><span class="keyword">for</span><span class="normal"> lib </span><span class="keyword">in</span><span class="normal"> </span><span class="variable">$dlprefiles</span><span class="symbol">;</span><span class="normal"> </span><span class="keyword">do</span>
<span class="normal">	      </span><span class="variable">name</span><span class="symbol">=</span><span class="normal">`</span><span class="variable">$echo</span><span class="normal"> </span><span class="string">"X$lib"</span><span class="normal"> </span><span class="symbol">|</span><span class="normal"> </span><span class="variable">$Xsed</span><span class="normal"> -e </span><span class="string">'s%^.*/%%'</span><span class="normal">`</span>
<span class="normal">	      </span><span class="keyword">eval</span><span class="normal"> </span><span class="variable">libdir</span><span class="symbol">=</span><span class="normal">`</span><span class="variable">${SED}</span><span class="normal"> -n -e </span><span class="string">'s/^libdir=</span><span class="specialchar">\(</span><span class="string">.*</span><span class="specialchar">\)</span><span class="string">$/</span><span class="specialchar">\1</span><span class="string">/p'</span><span class="normal"> </span><span class="variable">$lib</span><span class="normal">`</span>
<span class="normal">	      </span><span class="keyword">if</span><span class="normal"> </span><span class="keyword">test</span><span class="normal"> -z </span><span class="string">"$libdir"</span><span class="symbol">;</span><span class="normal"> </span><span class="keyword">then</span>
<span class="normal">		</span><span class="variable">$echo</span><span class="normal"> </span><span class="string">"$modename: </span><span class="specialchar">\`</span><span class="string">$lib' is not a valid libtool archive"</span><span class="normal"> </span><span class="number">1</span><span class="symbol">&gt;&amp;</span><span class="number">2</span>
<span class="normal">		</span><span class="keyword">exit</span><span class="normal"> </span><span class="variable">$EXIT_FAILURE</span>
<span class="normal">	      </span><span class="keyword">fi</span>
<span class="normal">	      </span><span class="variable">newdlprefiles</span><span class="symbol">=</span><span class="string">"$newdlprefiles $libdir/$name"</span>
<span class="normal">	    </span><span class="keyword">done</span>
<span class="normal">	    </span><span class="variable">dlprefiles</span><span class="symbol">=</span><span class="string">"$newdlprefiles"</span>
<span class="normal">	  </span><span class="keyword">else</span>
<span class="normal">	    </span><span class="variable">newdlfiles</span><span class="symbol">=</span>
<span class="normal">	    </span><span class="keyword">for</span><span class="normal"> lib </span><span class="keyword">in</span><span class="normal"> </span><span class="variable">$dlfiles</span><span class="symbol">;</span><span class="normal"> </span><span class="keyword">do</span>
<span class="normal">	      </span><span class="keyword">case</span><span class="normal"> </span><span class="variable">$lib</span><span class="normal"> </span><span class="keyword">in</span>
<span class="normal">		</span><span class="symbol">[\\/]*</span><span class="normal"> </span><span class="symbol">|</span><span class="normal"> </span><span class="symbol">[</span><span class="normal">A-Za-z</span><span class="symbol">]:[\\/]*)</span><span class="normal"> </span><span class="variable">abs</span><span class="symbol">=</span><span class="string">"$lib"</span><span class="normal"> </span><span class="symbol">;;</span>
<span class="normal">		</span><span class="symbol">*)</span><span class="normal"> </span><span class="variable">abs</span><span class="symbol">=</span><span class="normal">`pwd`</span><span class="string">"/$lib"</span><span class="normal"> </span><span class="symbol">;;</span>
<span class="normal">	      </span><span class="keyword">esac</span>
<span class="normal">	      </span><span class="variable">newdlfiles</span><span class="symbol">=</span><span class="string">"$newdlfiles $abs"</span>
<span class="normal">	    </span><span class="keyword">done</span>
<span class="normal">	    </span><span class="variable">dlfiles</span><span class="symbol">=</span><span class="string">"$newdlfiles"</span>
<span class="normal">	    </span><span class="variable">newdlprefiles</span><span class="symbol">=</span>
<span class="normal">	    </span><span class="keyword">for</span><span class="normal"> lib </span><span class="keyword">in</span><span class="normal"> </span><span class="variable">$dlprefiles</span><span class="symbol">;</span><span class="normal"> </span><span class="keyword">do</span>
<span class="normal">	      </span><span class="keyword">case</span><span class="normal"> </span><span class="variable">$lib</span><span class="normal"> </span><span class="keyword">in</span>
<span class="normal">		</span><span class="symbol">[\\/]*</span><span class="normal"> </span><span class="symbol">|</span><span class="normal"> </span><span class="symbol">[</span><span class="normal">A-Za-z</span><span class="symbol">]:[\\/]*)</span><span class="normal"> </span><span class="variable">abs</span><span class="symbol">=</span><span class="string">"$lib"</span><span class="normal"> </span><span class="symbol">;;</span>
<span class="normal">		</span><span class="symbol">*)</span><span class="normal"> </span><span class="variable">abs</span><span class="symbol">=</span><span class="normal">`pwd`</span><span class="string">"/$lib"</span><span class="normal"> </span><span class="symbol">;;</span>
<span class="normal">	      </span><span class="keyword">esac</span>
<span class="normal">	      </span><span class="variable">newdlprefiles</span><span class="symbol">=</span><span class="string">"$newdlprefiles $abs"</span>
<span class="normal">	    </span><span class="keyword">done</span>
<span class="normal">	    </span><span class="variable">dlprefiles</span><span class="symbol">=</span><span class="string">"$newdlprefiles"</span>
<span class="normal">	  </span><span class="keyword">fi</span>
<span class="normal">	  </span><span class="variable">$rm</span><span class="normal"> </span><span class="variable">$output</span>
<span class="normal">	  </span><span class="comment"># place dlname in correct position for cygwin</span>
<span class="normal">	  </span><span class="variable">tdlname</span><span class="symbol">=</span><span class="variable">$dlname</span>
<span class="normal">	  </span><span class="keyword">case</span><span class="normal"> </span><span class="variable">$host</span><span class="symbol">,</span><span class="variable">$output</span><span class="symbol">,</span><span class="variable">$installed</span><span class="symbol">,</span><span class="variable">$module</span><span class="symbol">,</span><span class="variable">$dlname</span><span class="normal"> </span><span class="keyword">in</span>
<span class="normal">	    </span><span class="symbol">*</span><span class="normal">cygwin</span><span class="symbol">*,*</span><span class="normal">lai</span><span class="symbol">,</span><span class="normal">yes</span><span class="symbol">,</span><span class="normal">no</span><span class="symbol">,*.</span><span class="normal">dll </span><span class="symbol">|</span><span class="normal"> </span><span class="symbol">*</span><span class="normal">mingw</span><span class="symbol">*,*</span><span class="normal">lai</span><span class="symbol">,</span><span class="normal">yes</span><span class="symbol">,</span><span class="normal">no</span><span class="symbol">,*.</span><span class="normal">dll</span><span class="symbol">)</span><span class="normal"> </span><span class="variable">tdlname</span><span class="symbol">=..</span><span class="normal">/bin</span><span class="symbol">/</span><span class="variable">$dlname</span><span class="normal"> </span><span class="symbol">;;</span>
<span class="normal">	  </span><span class="keyword">esac</span>
<span class="normal">	  </span><span class="comment"># Do not add duplicates</span>
<span class="normal">	  </span><span class="keyword">if</span><span class="normal"> </span><span class="keyword">test</span><span class="normal"> </span><span class="string">"$installed"</span><span class="normal"> </span><span class="symbol">=</span><span class="normal"> yes </span><span class="symbol">&amp;&amp;</span><span class="normal"> </span><span class="keyword">test</span><span class="normal"> </span><span class="string">"$D"</span><span class="symbol">;</span><span class="normal"> </span><span class="keyword">then</span>
<span class="normal">	    </span><span class="variable">install_libdir</span><span class="symbol">=</span><span class="normal">`echo </span><span class="string">"$install_libdir"</span><span class="normal"> </span><span class="symbol">|</span><span class="normal">sed -e </span><span class="string">"s:$D:/:g"</span><span class="normal"> -e </span><span class="string">'s:/</span><span class="specialchar">\+</span><span class="string">:/:g'</span><span class="normal">`</span>
<span class="normal">	  </span><span class="keyword">fi</span>
<span class="normal">	  </span><span class="variable">$echo</span><span class="normal"> </span><span class="symbol">&gt;</span><span class="normal"> </span><span class="variable">$output</span><span class="normal"> </span><span class="string">"\</span>
<span class="string"># $outputname - a libtool library file</span>
<span class="string"># Generated by $PROGRAM - GNU $PACKAGE $VERSION$TIMESTAMP</span>
<span class="string">#</span>
<span class="string"># Please DO NOT delete this file!</span>
<span class="string"># It is necessary for linking the library.</span>

<span class="string"># The name that we can dlopen(3).</span>
<span class="string">dlname='$tdlname'</span>

<span class="string"># Names of this library.</span>
<span class="string">library_names='$library_names'</span>

<span class="string"># The name of the static archive.</span>
<span class="string">old_library='$old_library'</span>

<span class="string"># Libraries that this one depends upon.</span>
<span class="string">dependency_libs='$dependency_libs'</span>

<span class="string"># Version information for $libname.</span>
<span class="string">current=$current</span>
<span class="string">age=$age</span>
<span class="string">revision=$revision</span>

<span class="string"># Is this an already installed library?</span>
<span class="string">installed=$installed</span>

<span class="string"># Should we warn about portability when linking against -modules?</span>
<span class="string">shouldnotlink=$module</span>

<span class="string"># Files to dlopen/dlpreopen</span>
<span class="string">dlopen='$dlfiles'</span>
<span class="string">dlpreopen='$dlprefiles'</span>

<span class="string"># Directory that this library needs to be installed in:</span>
<span class="string">libdir='$install_libdir'"</span>
<span class="normal">	  </span><span class="keyword">if</span><span class="normal"> </span><span class="keyword">test</span><span class="normal"> </span><span class="string">"$installed"</span><span class="normal"> </span><span class="symbol">=</span><span class="normal"> no </span><span class="symbol">&amp;&amp;</span><span class="normal"> </span><span class="keyword">test</span><span class="normal"> </span><span class="string">"$need_relink"</span><span class="normal"> </span><span class="symbol">=</span><span class="normal"> yes</span><span class="symbol">;</span><span class="normal"> </span><span class="keyword">then</span>
<span class="normal">	    </span><span class="variable">$echo</span><span class="normal"> </span><span class="symbol">&gt;&gt;</span><span class="normal"> </span><span class="variable">$output</span><span class="normal"> </span><span class="string">"\</span>
<span class="string">relink_command=</span><span class="specialchar">\"</span><span class="string">$relink_command</span><span class="specialchar">\"</span><span class="string">"</span>
<span class="normal">	  </span><span class="keyword">fi</span>
<span class="normal">	</span><span class="keyword">done</span>
<span class="normal">      </span><span class="keyword">fi</span>

<span class="normal">      </span><span class="comment"># Do a symbolic link so that the libtool archive can be found in</span>
<span class="normal">      </span><span class="comment"># LD_LIBRARY_PATH before the program is installed.</span>
<span class="normal">      </span><span class="variable">$show</span><span class="normal"> </span><span class="string">"(cd $output_objdir &amp;&amp; $rm $outputname &amp;&amp; $LN_S ../$outputname $outputname)"</span>
<span class="normal">      </span><span class="variable">$run</span><span class="normal"> </span><span class="keyword">eval</span><span class="normal"> </span><span class="string">'(cd $output_objdir &amp;&amp; $rm $outputname &amp;&amp; $LN_S ../$outputname $outputname)'</span><span class="normal"> </span><span class="symbol">||</span><span class="normal"> </span><span class="keyword">exit</span><span class="normal"> </span><span class="variable">$?</span>
<span class="normal">      </span><span class="symbol">;;</span>
<span class="normal">    </span><span class="keyword">esac</span>
<span class="normal">    </span><span class="keyword">exit</span><span class="normal"> </span><span class="variable">$EXIT_SUCCESS</span>
<span class="normal">    </span><span class="symbol">;;</span>

<span class="normal">  </span><span class="comment"># libtool install mode</span>
<span class="normal">  install</span><span class="symbol">)</span>
<span class="normal">    </span><span class="variable">modename</span><span class="symbol">=</span><span class="string">"$modename: install"</span>

<span class="normal">    </span><span class="comment"># There may be an optional sh(1) argument at the beginning of</span>
<span class="normal">    </span><span class="comment"># install_prog (especially on Windows NT).</span>
<span class="normal">    </span><span class="keyword">if</span><span class="normal"> </span><span class="keyword">test</span><span class="normal"> </span><span class="string">"$nonopt"</span><span class="normal"> </span><span class="symbol">=</span><span class="normal"> </span><span class="string">"$SHELL"</span><span class="normal"> </span><span class="symbol">||</span><span class="normal"> </span><span class="keyword">test</span><span class="normal"> </span><span class="string">"$nonopt"</span><span class="normal"> </span><span class="symbol">=</span><span class="normal"> /bin/sh </span><span class="symbol">||</span>
<span class="normal">       </span><span class="comment"># Allow the use of GNU shtool's install command.</span>
<span class="normal">       </span><span class="variable">$echo</span><span class="normal"> </span><span class="string">"X$nonopt"</span><span class="normal"> </span><span class="symbol">|</span><span class="normal"> grep shtool </span><span class="symbol">&gt;</span><span class="normal"> /dev/null</span><span class="symbol">;</span><span class="normal"> </span><span class="keyword">then</span>
<span class="normal">      </span><span class="comment"># Aesthetically quote it.</span>
<span class="normal">      </span><span class="variable">arg</span><span class="symbol">=</span><span class="normal">`</span><span class="variable">$echo</span><span class="normal"> </span><span class="string">"X$nonopt"</span><span class="normal"> </span><span class="symbol">|</span><span class="normal"> </span><span class="variable">$Xsed</span><span class="normal"> -e </span><span class="string">"$sed_quote_subst"</span><span class="normal">`</span>
<span class="normal">      </span><span class="keyword">case</span><span class="normal"> </span><span class="variable">$arg</span><span class="normal"> </span><span class="keyword">in</span>
<span class="normal">      </span><span class="symbol">*[\[\~\</span><span class="comment">#\^\&amp;\*\(\)\{\}\|\;\&lt;\&gt;\?\'\ \	]*|*]*|"")</span>
<span class="normal">	</span><span class="variable">arg</span><span class="symbol">=</span><span class="string">"</span><span class="specialchar">\"</span><span class="string">$arg</span><span class="specialchar">\"</span><span class="string">"</span>
<span class="normal">	</span><span class="symbol">;;</span>
<span class="normal">      </span><span class="keyword">esac</span>
<span class="normal">      </span><span class="variable">install_prog</span><span class="symbol">=</span><span class="string">"$arg "</span>
<span class="normal">      </span><span class="variable">arg</span><span class="symbol">=</span><span class="string">"$1"</span>
<span class="normal">      </span><span class="keyword">shift</span>
<span class="normal">    </span><span class="keyword">else</span>
<span class="normal">      </span><span class="variable">install_prog</span><span class="symbol">=</span>
<span class="normal">      </span><span class="variable">arg</span><span class="symbol">=</span><span class="variable">$nonopt</span>
<span class="normal">    </span><span class="keyword">fi</span>

<span class="normal">    </span><span class="comment"># The real first argument should be the name of the installation program.</span>
<span class="normal">    </span><span class="comment"># Aesthetically quote it.</span>
<span class="normal">    </span><span class="variable">arg</span><span class="symbol">=</span><span class="normal">`</span><span class="variable">$echo</span><span class="normal"> </span><span class="string">"X$arg"</span><span class="normal"> </span><span class="symbol">|</span><span class="normal"> </span><span class="variable">$Xsed</span><span class="normal"> -e </span><span class="string">"$sed_quote_subst"</span><span class="normal">`</span>
<span class="normal">    </span><span class="keyword">case</span><span class="normal"> </span><span class="variable">$arg</span><span class="normal"> </span><span class="keyword">in</span>
<span class="normal">    </span><span class="symbol">*[\[\~\</span><span class="comment">#\^\&amp;\*\(\)\{\}\|\;\&lt;\&gt;\?\'\ \	]*|*]*|"")</span>
<span class="normal">      </span><span class="variable">arg</span><span class="symbol">=</span><span class="string">"</span><span class="specialchar">\"</span><span class="string">$arg</span><span class="specialchar">\"</span><span class="string">"</span>
<span class="normal">      </span><span class="symbol">;;</span>
<span class="normal">    </span><span class="keyword">esac</span>
<span class="normal">    </span><span class="variable">install_prog</span><span class="symbol">=</span><span class="string">"$install_prog$arg"</span>

<span class="normal">    </span><span class="comment"># We need to accept at least all the BSD install flags.</span>
<span class="normal">    </span><span class="variable">dest</span><span class="symbol">=</span>
<span class="normal">    </span><span class="variable">files</span><span class="symbol">=</span>
<span class="normal">    </span><span class="variable">opts</span><span class="symbol">=</span>
<span class="normal">    </span><span class="variable">prev</span><span class="symbol">=</span>
<span class="normal">    </span><span class="variable">install_type</span><span class="symbol">=</span>
<span class="normal">    </span><span class="variable">isdir</span><span class="symbol">=</span><span class="normal">no</span>
<span class="normal">    </span><span class="variable">stripme</span><span class="symbol">=</span>
<span class="normal">    </span><span class="keyword">for</span><span class="normal"> arg</span>
<span class="normal">    </span><span class="keyword">do</span>
<span class="normal">      </span><span class="keyword">if</span><span class="normal"> </span><span class="keyword">test</span><span class="normal"> -n </span><span class="string">"$dest"</span><span class="symbol">;</span><span class="normal"> </span><span class="keyword">then</span>
<span class="normal">	</span><span class="variable">files</span><span class="symbol">=</span><span class="string">"$files $dest"</span>
<span class="normal">	</span><span class="variable">dest</span><span class="symbol">=</span><span class="variable">$arg</span>
<span class="normal">	</span><span class="keyword">continue</span>
<span class="normal">      </span><span class="keyword">fi</span>

<span class="normal">      </span><span class="keyword">case</span><span class="normal"> </span><span class="variable">$arg</span><span class="normal"> </span><span class="keyword">in</span>
<span class="normal">      -d</span><span class="symbol">)</span><span class="normal"> </span><span class="variable">isdir</span><span class="symbol">=</span><span class="normal">yes </span><span class="symbol">;;</span>
<span class="normal">      -f</span><span class="symbol">)</span><span class="normal"> </span>
<span class="normal">      	</span><span class="keyword">case</span><span class="normal"> </span><span class="string">" $install_prog "</span><span class="normal"> </span><span class="keyword">in</span>
<span class="normal">	</span><span class="symbol">*[\\\</span><span class="normal"> </span><span class="symbol">/]</span><span class="normal">cp</span><span class="symbol">\</span><span class="normal"> </span><span class="symbol">*)</span><span class="normal"> </span><span class="symbol">;;</span>
<span class="normal">	</span><span class="symbol">*)</span><span class="normal"> </span><span class="variable">prev</span><span class="symbol">=</span><span class="variable">$arg</span><span class="normal"> </span><span class="symbol">;;</span>
<span class="normal">	</span><span class="keyword">esac</span>
<span class="normal">	</span><span class="symbol">;;</span>
<span class="normal">      -g </span><span class="symbol">|</span><span class="normal"> -m </span><span class="symbol">|</span><span class="normal"> -o</span><span class="symbol">)</span><span class="normal"> </span><span class="variable">prev</span><span class="symbol">=</span><span class="variable">$arg</span><span class="normal"> </span><span class="symbol">;;</span>
<span class="normal">      -s</span><span class="symbol">)</span>
<span class="normal">	</span><span class="variable">stripme</span><span class="symbol">=</span><span class="string">" -s"</span>
<span class="normal">	</span><span class="keyword">continue</span>
<span class="normal">	</span><span class="symbol">;;</span>
<span class="normal">      -</span><span class="symbol">*)</span>
<span class="normal">	</span><span class="symbol">;;</span>
<span class="normal">      </span><span class="symbol">*)</span>
<span class="normal">	</span><span class="comment"># If the previous option needed an argument, then skip it.</span>
<span class="normal">	</span><span class="keyword">if</span><span class="normal"> </span><span class="keyword">test</span><span class="normal"> -n </span><span class="string">"$prev"</span><span class="symbol">;</span><span class="normal"> </span><span class="keyword">then</span>
<span class="normal">	  </span><span class="variable">prev</span><span class="symbol">=</span>
<span class="normal">	</span><span class="keyword">else</span>
<span class="normal">	  </span><span class="variable">dest</span><span class="symbol">=</span><span class="variable">$arg</span>
<span class="normal">	  </span><span class="keyword">continue</span>
<span class="normal">	</span><span class="keyword">fi</span>
<span class="normal">	</span><span class="symbol">;;</span>
<span class="normal">      </span><span class="keyword">esac</span>

<span class="normal">      </span><span class="comment"># Aesthetically quote the argument.</span>
<span class="normal">      </span><span class="variable">arg</span><span class="symbol">=</span><span class="normal">`</span><span class="variable">$echo</span><span class="normal"> </span><span class="string">"X$arg"</span><span class="normal"> </span><span class="symbol">|</span><span class="normal"> </span><span class="variable">$Xsed</span><span class="normal"> -e </span><span class="string">"$sed_quote_subst"</span><span class="normal">`</span>
<span class="normal">      </span><span class="keyword">case</span><span class="normal"> </span><span class="variable">$arg</span><span class="normal"> </span><span class="keyword">in</span>
<span class="normal">      </span><span class="symbol">*[\[\~\</span><span class="comment">#\^\&amp;\*\(\)\{\}\|\;\&lt;\&gt;\?\'\ \	]*|*]*|"")</span>
<span class="normal">	</span><span class="variable">arg</span><span class="symbol">=</span><span class="string">"</span><span class="specialchar">\"</span><span class="string">$arg</span><span class="specialchar">\"</span><span class="string">"</span>
<span class="normal">	</span><span class="symbol">;;</span>
<span class="normal">      </span><span class="keyword">esac</span>
<span class="normal">      </span><span class="variable">install_prog</span><span class="symbol">=</span><span class="string">"$install_prog $arg"</span>
<span class="normal">    </span><span class="keyword">done</span>

<span class="normal">    </span><span class="keyword">if</span><span class="normal"> </span><span class="keyword">test</span><span class="normal"> -z </span><span class="string">"$install_prog"</span><span class="symbol">;</span><span class="normal"> </span><span class="keyword">then</span>
<span class="normal">      </span><span class="variable">$echo</span><span class="normal"> </span><span class="string">"$modename: you must specify an install program"</span><span class="normal"> </span><span class="number">1</span><span class="symbol">&gt;&amp;</span><span class="number">2</span>
<span class="normal">      </span><span class="variable">$echo</span><span class="normal"> </span><span class="string">"$help"</span><span class="normal"> </span><span class="number">1</span><span class="symbol">&gt;&amp;</span><span class="number">2</span>
<span class="normal">      </span><span class="keyword">exit</span><span class="normal"> </span><span class="variable">$EXIT_FAILURE</span>
<span class="normal">    </span><span class="keyword">fi</span>

<span class="normal">    </span><span class="keyword">if</span><span class="normal"> </span><span class="keyword">test</span><span class="normal"> -n </span><span class="string">"$prev"</span><span class="symbol">;</span><span class="normal"> </span><span class="keyword">then</span>
<span class="normal">      </span><span class="variable">$echo</span><span class="normal"> </span><span class="string">"$modename: the </span><span class="specialchar">\`</span><span class="string">$prev' option requires an argument"</span><span class="normal"> </span><span class="number">1</span><span class="symbol">&gt;&amp;</span><span class="number">2</span>
<span class="normal">      </span><span class="variable">$echo</span><span class="normal"> </span><span class="string">"$help"</span><span class="normal"> </span><span class="number">1</span><span class="symbol">&gt;&amp;</span><span class="number">2</span>
<span class="normal">      </span><span class="keyword">exit</span><span class="normal"> </span><span class="variable">$EXIT_FAILURE</span>
<span class="normal">    </span><span class="keyword">fi</span>

<span class="normal">    </span><span class="keyword">if</span><span class="normal"> </span><span class="keyword">test</span><span class="normal"> -z </span><span class="string">"$files"</span><span class="symbol">;</span><span class="normal"> </span><span class="keyword">then</span>
<span class="normal">      </span><span class="keyword">if</span><span class="normal"> </span><span class="keyword">test</span><span class="normal"> -z </span><span class="string">"$dest"</span><span class="symbol">;</span><span class="normal"> </span><span class="keyword">then</span>
<span class="normal">	</span><span class="variable">$echo</span><span class="normal"> </span><span class="string">"$modename: no file or destination specified"</span><span class="normal"> </span><span class="number">1</span><span class="symbol">&gt;&amp;</span><span class="number">2</span>
<span class="normal">      </span><span class="keyword">else</span>
<span class="normal">	</span><span class="variable">$echo</span><span class="normal"> </span><span class="string">"$modename: you must specify a destination"</span><span class="normal"> </span><span class="number">1</span><span class="symbol">&gt;&amp;</span><span class="number">2</span>
<span class="normal">      </span><span class="keyword">fi</span>
<span class="normal">      </span><span class="variable">$echo</span><span class="normal"> </span><span class="string">"$help"</span><span class="normal"> </span><span class="number">1</span><span class="symbol">&gt;&amp;</span><span class="number">2</span>
<span class="normal">      </span><span class="keyword">exit</span><span class="normal"> </span><span class="variable">$EXIT_FAILURE</span>
<span class="normal">    </span><span class="keyword">fi</span>

<span class="normal">    </span><span class="comment"># Strip any trailing slash from the destination.</span>
<span class="normal">    </span><span class="variable">dest</span><span class="symbol">=</span><span class="normal">`</span><span class="variable">$echo</span><span class="normal"> </span><span class="string">"X$dest"</span><span class="normal"> </span><span class="symbol">|</span><span class="normal"> </span><span class="variable">$Xsed</span><span class="normal"> -e </span><span class="string">'s%/$%%'</span><span class="normal">`</span>

<span class="normal">    </span><span class="comment"># Check to see that the destination is a directory.</span>
<span class="normal">    </span><span class="keyword">test</span><span class="normal"> -d </span><span class="string">"$dest"</span><span class="normal"> </span><span class="symbol">&amp;&amp;</span><span class="normal"> </span><span class="variable">isdir</span><span class="symbol">=</span><span class="normal">yes</span>
<span class="normal">    </span><span class="keyword">if</span><span class="normal"> </span><span class="keyword">test</span><span class="normal"> </span><span class="string">"$isdir"</span><span class="normal"> </span><span class="symbol">=</span><span class="normal"> yes</span><span class="symbol">;</span><span class="normal"> </span><span class="keyword">then</span>
<span class="normal">      </span><span class="variable">destdir</span><span class="symbol">=</span><span class="string">"$dest"</span>
<span class="normal">      </span><span class="variable">destname</span><span class="symbol">=</span>
<span class="normal">    </span><span class="keyword">else</span>
<span class="normal">      </span><span class="variable">destdir</span><span class="symbol">=</span><span class="normal">`</span><span class="variable">$echo</span><span class="normal"> </span><span class="string">"X$dest"</span><span class="normal"> </span><span class="symbol">|</span><span class="normal"> </span><span class="variable">$Xsed</span><span class="normal"> -e </span><span class="string">'s%/[^/]*$%%'</span><span class="normal">`</span>
<span class="normal">      </span><span class="keyword">test</span><span class="normal"> </span><span class="string">"X$destdir"</span><span class="normal"> </span><span class="symbol">=</span><span class="normal"> </span><span class="string">"X$dest"</span><span class="normal"> </span><span class="symbol">&amp;&amp;</span><span class="normal"> </span><span class="variable">destdir</span><span class="symbol">=.</span>
<span class="normal">      </span><span class="variable">destname</span><span class="symbol">=</span><span class="normal">`</span><span class="variable">$echo</span><span class="normal"> </span><span class="string">"X$dest"</span><span class="normal"> </span><span class="symbol">|</span><span class="normal"> </span><span class="variable">$Xsed</span><span class="normal"> -e </span><span class="string">'s%^.*/%%'</span><span class="normal">`</span>

<span class="normal">      </span><span class="comment"># Not a directory, so check to see that there is only one file specified.</span>
<span class="normal">      </span><span class="keyword">set</span><span class="normal"> dummy </span><span class="variable">$files</span>
<span class="normal">      </span><span class="keyword">if</span><span class="normal"> </span><span class="keyword">test</span><span class="normal"> </span><span class="string">"$#"</span><span class="normal"> -gt </span><span class="number">2</span><span class="symbol">;</span><span class="normal"> </span><span class="keyword">then</span>
<span class="normal">	</span><span class="variable">$echo</span><span class="normal"> </span><span class="string">"$modename: </span><span class="specialchar">\`</span><span class="string">$dest' is not a directory"</span><span class="normal"> </span><span class="number">1</span><span class="symbol">&gt;&amp;</span><span class="number">2</span>
<span class="normal">	</span><span class="variable">$echo</span><span class="normal"> </span><span class="string">"$help"</span><span class="normal"> </span><span class="number">1</span><span class="symbol">&gt;&amp;</span><span class="number">2</span>
<span class="normal">	</span><span class="keyword">exit</span><span class="normal"> </span><span class="variable">$EXIT_FAILURE</span>
<span class="normal">      </span><span class="keyword">fi</span>
<span class="normal">    </span><span class="keyword">fi</span>
<span class="normal">    </span><span class="keyword">case</span><span class="normal"> </span><span class="variable">$destdir</span><span class="normal"> </span><span class="keyword">in</span>
<span class="normal">    </span><span class="symbol">[\\/]*</span><span class="normal"> </span><span class="symbol">|</span><span class="normal"> </span><span class="symbol">[</span><span class="normal">A-Za-z</span><span class="symbol">]:[\\/]*)</span><span class="normal"> </span><span class="symbol">;;</span>
<span class="normal">    </span><span class="symbol">*)</span>
<span class="normal">      </span><span class="keyword">for</span><span class="normal"> file </span><span class="keyword">in</span><span class="normal"> </span><span class="variable">$files</span><span class="symbol">;</span><span class="normal"> </span><span class="keyword">do</span>
<span class="normal">	</span><span class="keyword">case</span><span class="normal"> </span><span class="variable">$file</span><span class="normal"> </span><span class="keyword">in</span>
<span class="normal">	</span><span class="symbol">*.</span><span class="normal">lo</span><span class="symbol">)</span><span class="normal"> </span><span class="symbol">;;</span>
<span class="normal">	</span><span class="symbol">*)</span>
<span class="normal">	  </span><span class="variable">$echo</span><span class="normal"> </span><span class="string">"$modename: </span><span class="specialchar">\`</span><span class="string">$destdir' must be an absolute directory name"</span><span class="normal"> </span><span class="number">1</span><span class="symbol">&gt;&amp;</span><span class="number">2</span>
<span class="normal">	  </span><span class="variable">$echo</span><span class="normal"> </span><span class="string">"$help"</span><span class="normal"> </span><span class="number">1</span><span class="symbol">&gt;&amp;</span><span class="number">2</span>
<span class="normal">	  </span><span class="keyword">exit</span><span class="normal"> </span><span class="variable">$EXIT_FAILURE</span>
<span class="normal">	  </span><span class="symbol">;;</span>
<span class="normal">	</span><span class="keyword">esac</span>
<span class="normal">      </span><span class="keyword">done</span>
<span class="normal">      </span><span class="symbol">;;</span>
<span class="normal">    </span><span class="keyword">esac</span>

<span class="normal">    </span><span class="comment"># This variable tells wrapper scripts just to set variables rather</span>
<span class="normal">    </span><span class="comment"># than running their programs.</span>
<span class="normal">    </span><span class="variable">libtool_install_magic</span><span class="symbol">=</span><span class="string">"$magic"</span>

<span class="normal">    </span><span class="variable">staticlibs</span><span class="symbol">=</span>
<span class="normal">    </span><span class="variable">future_libdirs</span><span class="symbol">=</span>
<span class="normal">    </span><span class="variable">current_libdirs</span><span class="symbol">=</span>
<span class="normal">    </span><span class="keyword">for</span><span class="normal"> file </span><span class="keyword">in</span><span class="normal"> </span><span class="variable">$files</span><span class="symbol">;</span><span class="normal"> </span><span class="keyword">do</span>

<span class="normal">      </span><span class="comment"># Do each installation.</span>
<span class="normal">      </span><span class="keyword">case</span><span class="normal"> </span><span class="variable">$file</span><span class="normal"> </span><span class="keyword">in</span>
<span class="normal">      </span><span class="symbol">*.</span><span class="variable">$libext</span><span class="symbol">)</span>
<span class="normal">	</span><span class="comment"># Do the static libraries later.</span>
<span class="normal">	</span><span class="variable">staticlibs</span><span class="symbol">=</span><span class="string">"$staticlibs $file"</span>
<span class="normal">	</span><span class="symbol">;;</span>

<span class="normal">      </span><span class="symbol">*.</span><span class="normal">la</span><span class="symbol">)</span>
<span class="normal">	</span><span class="comment"># Check to see that this really is a libtool archive.</span>
<span class="normal">	</span><span class="keyword">if</span><span class="normal"> </span><span class="symbol">(</span><span class="variable">${SED}</span><span class="normal"> -e </span><span class="string">'2q'</span><span class="normal"> </span><span class="variable">$file</span><span class="normal"> </span><span class="symbol">|</span><span class="normal"> grep </span><span class="string">"^# Generated by .*$PACKAGE"</span><span class="symbol">)</span><span class="normal"> </span><span class="symbol">&gt;</span><span class="normal">/dev/null </span><span class="number">2</span><span class="symbol">&gt;&amp;</span><span class="number">1</span><span class="symbol">;</span><span class="normal"> </span><span class="keyword">then</span><span class="normal"> </span><span class="symbol">:</span>
<span class="normal">	</span><span class="keyword">else</span>
<span class="normal">	  </span><span class="variable">$echo</span><span class="normal"> </span><span class="string">"$modename: </span><span class="specialchar">\`</span><span class="string">$file' is not a valid libtool archive"</span><span class="normal"> </span><span class="number">1</span><span class="symbol">&gt;&amp;</span><span class="number">2</span>
<span class="normal">	  </span><span class="variable">$echo</span><span class="normal"> </span><span class="string">"$help"</span><span class="normal"> </span><span class="number">1</span><span class="symbol">&gt;&amp;</span><span class="number">2</span>
<span class="normal">	  </span><span class="keyword">exit</span><span class="normal"> </span><span class="variable">$EXIT_FAILURE</span>
<span class="normal">	</span><span class="keyword">fi</span>

<span class="normal">	</span><span class="variable">library_names</span><span class="symbol">=</span>
<span class="normal">	</span><span class="variable">old_library</span><span class="symbol">=</span>
<span class="normal">	</span><span class="variable">relink_command</span><span class="symbol">=</span>
<span class="normal">	</span><span class="comment"># If there is no directory component, then add one.</span>
<span class="normal">	</span><span class="keyword">case</span><span class="normal"> </span><span class="variable">$file</span><span class="normal"> </span><span class="keyword">in</span>
<span class="normal">	</span><span class="symbol">*/*</span><span class="normal"> </span><span class="symbol">|</span><span class="normal"> </span><span class="symbol">*\\*)</span><span class="normal"> </span><span class="symbol">.</span><span class="normal"> </span><span class="variable">$file</span><span class="normal"> </span><span class="symbol">;;</span>
<span class="normal">	</span><span class="symbol">*)</span><span class="normal"> </span><span class="symbol">.</span><span class="normal"> </span><span class="symbol">./</span><span class="variable">$file</span><span class="normal"> </span><span class="symbol">;;</span>
<span class="normal">	</span><span class="keyword">esac</span>

<span class="normal">	</span><span class="comment"># Add the libdir to current_libdirs if it is the destination.</span>
<span class="normal">	</span><span class="keyword">if</span><span class="normal"> </span><span class="keyword">test</span><span class="normal"> </span><span class="string">"X$destdir"</span><span class="normal"> </span><span class="symbol">=</span><span class="normal"> </span><span class="string">"X$libdir"</span><span class="symbol">;</span><span class="normal"> </span><span class="keyword">then</span>
<span class="normal">	  </span><span class="keyword">case</span><span class="normal"> </span><span class="string">"$current_libdirs "</span><span class="normal"> </span><span class="keyword">in</span>
<span class="normal">	  </span><span class="symbol">*</span><span class="string">" $libdir "</span><span class="symbol">*)</span><span class="normal"> </span><span class="symbol">;;</span>
<span class="normal">	  </span><span class="symbol">*)</span><span class="normal"> </span><span class="variable">current_libdirs</span><span class="symbol">=</span><span class="string">"$current_libdirs $libdir"</span><span class="normal"> </span><span class="symbol">;;</span>
<span class="normal">	  </span><span class="keyword">esac</span>
<span class="normal">	</span><span class="keyword">else</span>
<span class="normal">	  </span><span class="comment"># Note the libdir as a future libdir.</span>
<span class="normal">	  </span><span class="keyword">case</span><span class="normal"> </span><span class="string">"$future_libdirs "</span><span class="normal"> </span><span class="keyword">in</span>
<span class="normal">	  </span><span class="symbol">*</span><span class="string">" $libdir "</span><span class="symbol">*)</span><span class="normal"> </span><span class="symbol">;;</span>
<span class="normal">	  </span><span class="symbol">*)</span><span class="normal"> </span><span class="variable">future_libdirs</span><span class="symbol">=</span><span class="string">"$future_libdirs $libdir"</span><span class="normal"> </span><span class="symbol">;;</span>
<span class="normal">	  </span><span class="keyword">esac</span>
<span class="normal">	</span><span class="keyword">fi</span>

<span class="normal">	</span><span class="variable">dir</span><span class="symbol">=</span><span class="normal">`</span><span class="variable">$echo</span><span class="normal"> </span><span class="string">"X$file"</span><span class="normal"> </span><span class="symbol">|</span><span class="normal"> </span><span class="variable">$Xsed</span><span class="normal"> -e </span><span class="string">'s%/[^/]*$%%'</span><span class="normal">`</span><span class="symbol">/</span>
<span class="normal">	</span><span class="keyword">test</span><span class="normal"> </span><span class="string">"X$dir"</span><span class="normal"> </span><span class="symbol">=</span><span class="normal"> </span><span class="string">"X$file/"</span><span class="normal"> </span><span class="symbol">&amp;&amp;</span><span class="normal"> </span><span class="variable">dir</span><span class="symbol">=</span>
<span class="normal">	</span><span class="variable">dir</span><span class="symbol">=</span><span class="string">"$dir$objdir"</span>

<span class="normal">	</span><span class="keyword">if</span><span class="normal"> </span><span class="keyword">test</span><span class="normal"> -n </span><span class="string">"$relink_command"</span><span class="symbol">;</span><span class="normal"> </span><span class="keyword">then</span>
<span class="normal">	  </span><span class="comment"># Determine the prefix the user has applied to our future dir.</span>
<span class="normal">	  </span><span class="variable">inst_prefix_dir</span><span class="symbol">=</span><span class="normal">`</span><span class="variable">$echo</span><span class="normal"> </span><span class="string">"$destdir"</span><span class="normal"> </span><span class="symbol">|</span><span class="normal"> </span><span class="variable">$SED</span><span class="normal"> </span><span class="string">"s%$libdir</span><span class="specialchar">\$</span><span class="string">%%"</span><span class="normal">`</span>

<span class="normal">	  </span><span class="comment"># Don't allow the user to place us outside of our expected</span>
<span class="normal">	  </span><span class="comment"># location b/c this prevents finding dependent libraries that</span>
<span class="normal">	  </span><span class="comment"># are installed to the same prefix.</span>
<span class="normal">	  </span><span class="comment"># At present, this check doesn't affect windows .dll's that</span>
<span class="normal">	  </span><span class="comment"># are installed into $libdir/../bin (currently, that works fine)</span>
<span class="normal">	  </span><span class="comment"># but it's something to keep an eye on.</span>
<span class="normal">	  </span><span class="keyword">if</span><span class="normal"> </span><span class="keyword">test</span><span class="normal"> </span><span class="string">"$inst_prefix_dir"</span><span class="normal"> </span><span class="symbol">=</span><span class="normal"> </span><span class="string">"$destdir"</span><span class="symbol">;</span><span class="normal"> </span><span class="keyword">then</span>
<span class="normal">	    </span><span class="variable">$echo</span><span class="normal"> </span><span class="string">"$modename: error: cannot install </span><span class="specialchar">\`</span><span class="string">$file' to a directory not ending in $libdir"</span><span class="normal"> </span><span class="number">1</span><span class="symbol">&gt;&amp;</span><span class="number">2</span>
<span class="normal">	    </span><span class="keyword">exit</span><span class="normal"> </span><span class="variable">$EXIT_FAILURE</span>
<span class="normal">	  </span><span class="keyword">fi</span>

<span class="normal">	  </span><span class="keyword">if</span><span class="normal"> </span><span class="keyword">test</span><span class="normal"> -n </span><span class="string">"$inst_prefix_dir"</span><span class="symbol">;</span><span class="normal"> </span><span class="keyword">then</span>
<span class="normal">	    </span><span class="comment"># Stick the inst_prefix_dir data into the link command.</span>
<span class="normal">	    </span><span class="variable">relink_command</span><span class="symbol">=</span><span class="normal">`</span><span class="variable">$echo</span><span class="normal"> </span><span class="string">"$relink_command"</span><span class="normal"> </span><span class="symbol">|</span><span class="normal"> </span><span class="variable">$SP2NL</span><span class="normal"> </span><span class="symbol">|</span><span class="normal"> </span><span class="variable">$SED</span><span class="normal"> </span><span class="string">"s%@inst_prefix_dir@%-inst-prefix-dir $inst_prefix_dir%"</span><span class="normal"> </span><span class="symbol">|</span><span class="normal"> </span><span class="variable">$NL2SP</span><span class="normal">`</span>
<span class="normal">	  </span><span class="keyword">else</span>
<span class="normal">	    </span><span class="variable">relink_command</span><span class="symbol">=</span><span class="normal">`</span><span class="variable">$echo</span><span class="normal"> </span><span class="string">"$relink_command"</span><span class="normal"> </span><span class="symbol">|</span><span class="normal"> </span><span class="variable">$SP2NL</span><span class="normal"> </span><span class="symbol">|</span><span class="normal"> </span><span class="variable">$SED</span><span class="normal"> </span><span class="string">"s%@inst_prefix_dir@%%"</span><span class="normal"> </span><span class="symbol">|</span><span class="normal"> </span><span class="variable">$NL2SP</span><span class="normal">`</span>
<span class="normal">	  </span><span class="keyword">fi</span>

<span class="normal">	  </span><span class="variable">$echo</span><span class="normal"> </span><span class="string">"$modename: warning: relinking </span><span class="specialchar">\`</span><span class="string">$file'"</span><span class="normal"> </span><span class="number">1</span><span class="symbol">&gt;&amp;</span><span class="number">2</span>
<span class="normal">	  </span><span class="variable">$show</span><span class="normal"> </span><span class="string">"$relink_command"</span>
<span class="normal">	  </span><span class="keyword">if</span><span class="normal"> </span><span class="variable">$run</span><span class="normal"> </span><span class="keyword">eval</span><span class="normal"> </span><span class="string">"$relink_command"</span><span class="symbol">;</span><span class="normal"> </span><span class="keyword">then</span><span class="normal"> </span><span class="symbol">:</span>
<span class="normal">	  </span><span class="keyword">else</span>
<span class="normal">	    </span><span class="variable">$echo</span><span class="normal"> </span><span class="string">"$modename: error: relink </span><span class="specialchar">\`</span><span class="string">$file' with the above command before installing it"</span><span class="normal"> </span><span class="number">1</span><span class="symbol">&gt;&amp;</span><span class="number">2</span>
<span class="normal">	    </span><span class="keyword">exit</span><span class="normal"> </span><span class="variable">$EXIT_FAILURE</span>
<span class="normal">	  </span><span class="keyword">fi</span>
<span class="normal">	</span><span class="keyword">fi</span>

<span class="normal">	</span><span class="comment"># See the names of the shared library.</span>
<span class="normal">	</span><span class="keyword">set</span><span class="normal"> dummy </span><span class="variable">$library_names</span>
<span class="normal">	</span><span class="keyword">if</span><span class="normal"> </span><span class="keyword">test</span><span class="normal"> -n </span><span class="string">"$2"</span><span class="symbol">;</span><span class="normal"> </span><span class="keyword">then</span>
<span class="normal">	  </span><span class="variable">realname</span><span class="symbol">=</span><span class="string">"$2"</span>
<span class="normal">	  </span><span class="keyword">shift</span>
<span class="normal">	  </span><span class="keyword">shift</span>

<span class="normal">	  </span><span class="variable">srcname</span><span class="symbol">=</span><span class="string">"$realname"</span>
<span class="normal">	  </span><span class="keyword">test</span><span class="normal"> -n </span><span class="string">"$relink_command"</span><span class="normal"> </span><span class="symbol">&amp;&amp;</span><span class="normal"> </span><span class="variable">srcname</span><span class="symbol">=</span><span class="string">"$realname"</span><span class="normal">T</span>

<span class="normal">	  </span><span class="comment"># Install the shared library and build the symlinks.</span>
<span class="normal">	  </span><span class="variable">$show</span><span class="normal"> </span><span class="string">"$install_prog $dir/$srcname $destdir/$realname"</span>
<span class="normal">	  </span><span class="variable">$run</span><span class="normal"> </span><span class="keyword">eval</span><span class="normal"> </span><span class="string">"$install_prog $dir/$srcname $destdir/$realname"</span><span class="normal"> </span><span class="symbol">||</span><span class="normal"> </span><span class="keyword">exit</span><span class="normal"> </span><span class="variable">$?</span>
<span class="normal">	  </span><span class="keyword">if</span><span class="normal"> </span><span class="keyword">test</span><span class="normal"> -n </span><span class="string">"$stripme"</span><span class="normal"> </span><span class="symbol">&amp;&amp;</span><span class="normal"> </span><span class="keyword">test</span><span class="normal"> -n </span><span class="string">"$striplib"</span><span class="symbol">;</span><span class="normal"> </span><span class="keyword">then</span>
<span class="normal">	    </span><span class="variable">$show</span><span class="normal"> </span><span class="string">"$striplib $destdir/$realname"</span>
<span class="normal">	    </span><span class="variable">$run</span><span class="normal"> </span><span class="keyword">eval</span><span class="normal"> </span><span class="string">"$striplib $destdir/$realname"</span><span class="normal"> </span><span class="symbol">||</span><span class="normal"> </span><span class="keyword">exit</span><span class="normal"> </span><span class="variable">$?</span>
<span class="normal">	  </span><span class="keyword">fi</span>

<span class="normal">	  </span><span class="keyword">if</span><span class="normal"> </span><span class="keyword">test</span><span class="normal"> </span><span class="string">"$#"</span><span class="normal"> -gt </span><span class="number">0</span><span class="symbol">;</span><span class="normal"> </span><span class="keyword">then</span>
<span class="normal">	    </span><span class="comment"># Delete the old symlinks, and create new ones.</span>
<span class="normal">	    </span><span class="comment"># Try `ln -sf' first, because the `ln' binary might depend on</span>
<span class="normal">	    </span><span class="comment"># the symlink we replace!  Solaris /bin/ln does not understand -f,</span>
<span class="normal">	    </span><span class="comment"># so we also need to try rm &amp;&amp; ln -s.</span>
<span class="normal">	    </span><span class="keyword">for</span><span class="normal"> linkname</span>
<span class="normal">	    </span><span class="keyword">do</span>
<span class="normal">	      </span><span class="keyword">if</span><span class="normal"> </span><span class="keyword">test</span><span class="normal"> </span><span class="string">"$linkname"</span><span class="normal"> </span><span class="symbol">!=</span><span class="normal"> </span><span class="string">"$realname"</span><span class="symbol">;</span><span class="normal"> </span><span class="keyword">then</span>
<span class="normal">                </span><span class="variable">$show</span><span class="normal"> </span><span class="string">"(cd $destdir &amp;&amp; { $LN_S -f $realname $linkname || { $rm $linkname &amp;&amp; $LN_S $realname $linkname; }; })"</span>
<span class="normal">                </span><span class="variable">$run</span><span class="normal"> </span><span class="keyword">eval</span><span class="normal"> </span><span class="string">"(cd $destdir &amp;&amp; { $LN_S -f $realname $linkname || { $rm $linkname &amp;&amp; $LN_S $realname $linkname; }; })"</span>
<span class="normal">	      </span><span class="keyword">fi</span>
<span class="normal">	    </span><span class="keyword">done</span>
<span class="normal">	  </span><span class="keyword">fi</span>

<span class="normal">	  </span><span class="comment"># Do each command in the postinstall commands.</span>
<span class="normal">	  </span><span class="variable">lib</span><span class="symbol">=</span><span class="string">"$destdir/$realname"</span>
<span class="normal">	  </span><span class="variable">cmds</span><span class="symbol">=</span><span class="variable">$postinstall_cmds</span>
<span class="normal">	  </span><span class="variable">save_ifs</span><span class="symbol">=</span><span class="string">"$IFS"</span><span class="symbol">;</span><span class="normal"> </span><span class="variable">IFS</span><span class="symbol">=</span><span class="string">'~'</span>
<span class="normal">	  </span><span class="keyword">for</span><span class="normal"> cmd </span><span class="keyword">in</span><span class="normal"> </span><span class="variable">$cmds</span><span class="symbol">;</span><span class="normal"> </span><span class="keyword">do</span>
<span class="normal">	    </span><span class="variable">IFS</span><span class="symbol">=</span><span class="string">"$save_ifs"</span>
<span class="normal">	    </span><span class="keyword">eval</span><span class="normal"> </span><span class="variable">cmd</span><span class="symbol">=</span><span class="normal">\"</span><span class="variable">$cmd</span><span class="normal">\"</span>
<span class="normal">	    </span><span class="variable">$show</span><span class="normal"> </span><span class="string">"$cmd"</span>
<span class="normal">	    </span><span class="variable">$run</span><span class="normal"> </span><span class="keyword">eval</span><span class="normal"> </span><span class="string">"$cmd"</span><span class="normal"> </span><span class="symbol">||</span><span class="normal"> {</span>
<span class="normal">	      </span><span class="variable">lt_exit</span><span class="symbol">=</span><span class="variable">$?</span>

<span class="normal">	      </span><span class="comment"># Restore the uninstalled library and exit</span>
<span class="normal">	      </span><span class="keyword">if</span><span class="normal"> </span><span class="keyword">test</span><span class="normal"> </span><span class="string">"$mode"</span><span class="normal"> </span><span class="symbol">=</span><span class="normal"> relink</span><span class="symbol">;</span><span class="normal"> </span><span class="keyword">then</span>
<span class="normal">		</span><span class="variable">$run</span><span class="normal"> </span><span class="keyword">eval</span><span class="normal"> </span><span class="string">'(cd $output_objdir &amp;&amp; $rm ${realname}T &amp;&amp; $mv ${realname}U $realname)'</span>
<span class="normal">	      </span><span class="keyword">fi</span>

<span class="normal">	      </span><span class="keyword">exit</span><span class="normal"> </span><span class="variable">$lt_exit</span>
<span class="normal">	    }</span>
<span class="normal">	  </span><span class="keyword">done</span>
<span class="normal">	  </span><span class="variable">IFS</span><span class="symbol">=</span><span class="string">"$save_ifs"</span>
<span class="normal">	</span><span class="keyword">fi</span>

<span class="normal">	</span><span class="comment"># Install the pseudo-library for information purposes.</span>
<span class="normal">	</span><span class="variable">name</span><span class="symbol">=</span><span class="normal">`</span><span class="variable">$echo</span><span class="normal"> </span><span class="string">"X$file"</span><span class="normal"> </span><span class="symbol">|</span><span class="normal"> </span><span class="variable">$Xsed</span><span class="normal"> -e </span><span class="string">'s%^.*/%%'</span><span class="normal">`</span>
<span class="normal">	</span><span class="variable">instname</span><span class="symbol">=</span><span class="string">"$dir/$name"</span><span class="normal">i</span>
<span class="normal">	</span><span class="variable">$show</span><span class="normal"> </span><span class="string">"$install_prog $instname $destdir/$name"</span>
<span class="normal">	</span><span class="variable">$run</span><span class="normal"> </span><span class="keyword">eval</span><span class="normal"> </span><span class="string">"$install_prog $instname $destdir/$name"</span><span class="normal"> </span><span class="symbol">||</span><span class="normal"> </span><span class="keyword">exit</span><span class="normal"> </span><span class="variable">$?</span>

<span class="normal">	</span><span class="comment"># Maybe install the static library, too.</span>
<span class="normal">	</span><span class="keyword">test</span><span class="normal"> -n </span><span class="string">"$old_library"</span><span class="normal"> </span><span class="symbol">&amp;&amp;</span><span class="normal"> </span><span class="variable">staticlibs</span><span class="symbol">=</span><span class="string">"$staticlibs $dir/$old_library"</span>
<span class="normal">	</span><span class="symbol">;;</span>

<span class="normal">      </span><span class="symbol">*.</span><span class="normal">lo</span><span class="symbol">)</span>
<span class="normal">	</span><span class="comment"># Install (i.e. copy) a libtool object.</span>

<span class="normal">	</span><span class="comment"># Figure out destination file name, if it wasn't already specified.</span>
<span class="normal">	</span><span class="keyword">if</span><span class="normal"> </span><span class="keyword">test</span><span class="normal"> -n </span><span class="string">"$destname"</span><span class="symbol">;</span><span class="normal"> </span><span class="keyword">then</span>
<span class="normal">	  </span><span class="variable">destfile</span><span class="symbol">=</span><span class="string">"$destdir/$destname"</span>
<span class="normal">	</span><span class="keyword">else</span>
<span class="normal">	  </span><span class="variable">destfile</span><span class="symbol">=</span><span class="normal">`</span><span class="variable">$echo</span><span class="normal"> </span><span class="string">"X$file"</span><span class="normal"> </span><span class="symbol">|</span><span class="normal"> </span><span class="variable">$Xsed</span><span class="normal"> -e </span><span class="string">'s%^.*/%%'</span><span class="normal">`</span>
<span class="normal">	  </span><span class="variable">destfile</span><span class="symbol">=</span><span class="string">"$destdir/$destfile"</span>
<span class="normal">	</span><span class="keyword">fi</span>

<span class="normal">	</span><span class="comment"># Deduce the name of the destination old-style object file.</span>
<span class="normal">	</span><span class="keyword">case</span><span class="normal"> </span><span class="variable">$destfile</span><span class="normal"> </span><span class="keyword">in</span>
<span class="normal">	</span><span class="symbol">*.</span><span class="normal">lo</span><span class="symbol">)</span>
<span class="normal">	  </span><span class="variable">staticdest</span><span class="symbol">=</span><span class="normal">`</span><span class="variable">$echo</span><span class="normal"> </span><span class="string">"X$destfile"</span><span class="normal"> </span><span class="symbol">|</span><span class="normal"> </span><span class="variable">$Xsed</span><span class="normal"> -e </span><span class="string">"$lo2o"</span><span class="normal">`</span>
<span class="normal">	  </span><span class="symbol">;;</span>
<span class="normal">	</span><span class="symbol">*.</span><span class="variable">$objext</span><span class="symbol">)</span>
<span class="normal">	  </span><span class="variable">staticdest</span><span class="symbol">=</span><span class="string">"$destfile"</span>
<span class="normal">	  </span><span class="variable">destfile</span><span class="symbol">=</span>
<span class="normal">	  </span><span class="symbol">;;</span>
<span class="normal">	</span><span class="symbol">*)</span>
<span class="normal">	  </span><span class="variable">$echo</span><span class="normal"> </span><span class="string">"$modename: cannot copy a libtool object to </span><span class="specialchar">\`</span><span class="string">$destfile'"</span><span class="normal"> </span><span class="number">1</span><span class="symbol">&gt;&amp;</span><span class="number">2</span>
<span class="normal">	  </span><span class="variable">$echo</span><span class="normal"> </span><span class="string">"$help"</span><span class="normal"> </span><span class="number">1</span><span class="symbol">&gt;&amp;</span><span class="number">2</span>
<span class="normal">	  </span><span class="keyword">exit</span><span class="normal"> </span><span class="variable">$EXIT_FAILURE</span>
<span class="normal">	  </span><span class="symbol">;;</span>
<span class="normal">	</span><span class="keyword">esac</span>

<span class="normal">	</span><span class="comment"># Install the libtool object if requested.</span>
<span class="normal">	</span><span class="keyword">if</span><span class="normal"> </span><span class="keyword">test</span><span class="normal"> -n </span><span class="string">"$destfile"</span><span class="symbol">;</span><span class="normal"> </span><span class="keyword">then</span>
<span class="normal">	  </span><span class="variable">$show</span><span class="normal"> </span><span class="string">"$install_prog $file $destfile"</span>
<span class="normal">	  </span><span class="variable">$run</span><span class="normal"> </span><span class="keyword">eval</span><span class="normal"> </span><span class="string">"$install_prog $file $destfile"</span><span class="normal"> </span><span class="symbol">||</span><span class="normal"> </span><span class="keyword">exit</span><span class="normal"> </span><span class="variable">$?</span>
<span class="normal">	</span><span class="keyword">fi</span>

<span class="normal">	</span><span class="comment"># Install the old object if enabled.</span>
<span class="normal">	</span><span class="keyword">if</span><span class="normal"> </span><span class="keyword">test</span><span class="normal"> </span><span class="string">"$build_old_libs"</span><span class="normal"> </span><span class="symbol">=</span><span class="normal"> yes</span><span class="symbol">;</span><span class="normal"> </span><span class="keyword">then</span>
<span class="normal">	  </span><span class="comment"># Deduce the name of the old-style object file.</span>
<span class="normal">	  </span><span class="variable">staticobj</span><span class="symbol">=</span><span class="normal">`</span><span class="variable">$echo</span><span class="normal"> </span><span class="string">"X$file"</span><span class="normal"> </span><span class="symbol">|</span><span class="normal"> </span><span class="variable">$Xsed</span><span class="normal"> -e </span><span class="string">"$lo2o"</span><span class="normal">`</span>

<span class="normal">	  </span><span class="variable">$show</span><span class="normal"> </span><span class="string">"$install_prog $staticobj $staticdest"</span>
<span class="normal">	  </span><span class="variable">$run</span><span class="normal"> </span><span class="keyword">eval</span><span class="normal"> </span><span class="string">"$install_prog </span><span class="specialchar">\$</span><span class="string">staticobj </span><span class="specialchar">\$</span><span class="string">staticdest"</span><span class="normal"> </span><span class="symbol">||</span><span class="normal"> </span><span class="keyword">exit</span><span class="normal"> </span><span class="variable">$?</span>
<span class="normal">	</span><span class="keyword">fi</span>
<span class="normal">	</span><span class="keyword">exit</span><span class="normal"> </span><span class="variable">$EXIT_SUCCESS</span>
<span class="normal">	</span><span class="symbol">;;</span>

<span class="normal">      </span><span class="symbol">*)</span>
<span class="normal">	</span><span class="comment"># Figure out destination file name, if it wasn't already specified.</span>
<span class="normal">	</span><span class="keyword">if</span><span class="normal"> </span><span class="keyword">test</span><span class="normal"> -n </span><span class="string">"$destname"</span><span class="symbol">;</span><span class="normal"> </span><span class="keyword">then</span>
<span class="normal">	  </span><span class="variable">destfile</span><span class="symbol">=</span><span class="string">"$destdir/$destname"</span>
<span class="normal">	</span><span class="keyword">else</span>
<span class="normal">	  </span><span class="variable">destfile</span><span class="symbol">=</span><span class="normal">`</span><span class="variable">$echo</span><span class="normal"> </span><span class="string">"X$file"</span><span class="normal"> </span><span class="symbol">|</span><span class="normal"> </span><span class="variable">$Xsed</span><span class="normal"> -e </span><span class="string">'s%^.*/%%'</span><span class="normal">`</span>
<span class="normal">	  </span><span class="variable">destfile</span><span class="symbol">=</span><span class="string">"$destdir/$destfile"</span>
<span class="normal">	</span><span class="keyword">fi</span>

<span class="normal">	</span><span class="comment"># If the file is missing, and there is a .exe on the end, strip it</span>
<span class="normal">	</span><span class="comment"># because it is most likely a libtool script we actually want to</span>
<span class="normal">	</span><span class="comment"># install</span>
<span class="normal">	</span><span class="variable">stripped_ext</span><span class="symbol">=</span><span class="string">""</span>
<span class="normal">	</span><span class="keyword">case</span><span class="normal"> </span><span class="variable">$file</span><span class="normal"> </span><span class="keyword">in</span>
<span class="normal">	  </span><span class="symbol">*.</span><span class="normal">exe</span><span class="symbol">)</span>
<span class="normal">	    </span><span class="keyword">if</span><span class="normal"> </span><span class="keyword">test</span><span class="normal"> </span><span class="symbol">!</span><span class="normal"> -f </span><span class="string">"$file"</span><span class="symbol">;</span><span class="normal"> </span><span class="keyword">then</span>
<span class="normal">	      </span><span class="variable">file</span><span class="symbol">=</span><span class="normal">`</span><span class="variable">$echo</span><span class="normal"> </span><span class="variable">$file</span><span class="symbol">|</span><span class="variable">${SED}</span><span class="normal"> </span><span class="string">'s,.exe$,,'</span><span class="normal">`</span>
<span class="normal">	      </span><span class="variable">stripped_ext</span><span class="symbol">=</span><span class="string">".exe"</span>
<span class="normal">	    </span><span class="keyword">fi</span>
<span class="normal">	    </span><span class="symbol">;;</span>
<span class="normal">	</span><span class="keyword">esac</span>

<span class="normal">	</span><span class="comment"># Do a test to see if this is really a libtool program.</span>
<span class="normal">	</span><span class="keyword">case</span><span class="normal"> </span><span class="variable">$host</span><span class="normal"> </span><span class="keyword">in</span>
<span class="normal">	</span><span class="symbol">*</span><span class="normal">cygwin</span><span class="symbol">*|*</span><span class="normal">mingw</span><span class="symbol">*)</span>
<span class="normal">	    </span><span class="variable">wrapper</span><span class="symbol">=</span><span class="normal">`</span><span class="variable">$echo</span><span class="normal"> </span><span class="variable">$file</span><span class="normal"> </span><span class="symbol">|</span><span class="normal"> </span><span class="variable">${SED}</span><span class="normal"> -e </span><span class="string">'s,.exe$,,'</span><span class="normal">`</span>
<span class="normal">	    </span><span class="symbol">;;</span>
<span class="normal">	</span><span class="symbol">*)</span>
<span class="normal">	    </span><span class="variable">wrapper</span><span class="symbol">=</span><span class="variable">$file</span>
<span class="normal">	    </span><span class="symbol">;;</span>
<span class="normal">	</span><span class="keyword">esac</span>
<span class="normal">	</span><span class="keyword">if</span><span class="normal"> </span><span class="symbol">(</span><span class="variable">${SED}</span><span class="normal"> -e </span><span class="string">'4q'</span><span class="normal"> </span><span class="variable">$wrapper</span><span class="normal"> </span><span class="symbol">|</span><span class="normal"> grep </span><span class="string">"^# Generated by .*$PACKAGE"</span><span class="symbol">)&gt;</span><span class="normal">/dev/null </span><span class="number">2</span><span class="symbol">&gt;&amp;</span><span class="number">1</span><span class="symbol">;</span><span class="normal"> </span><span class="keyword">then</span>
<span class="normal">	  </span><span class="variable">notinst_deplibs</span><span class="symbol">=</span>
<span class="normal">	  </span><span class="variable">relink_command</span><span class="symbol">=</span>

<span class="normal">	  </span><span class="comment"># Note that it is not necessary on cygwin/mingw to append a dot to</span>
<span class="normal">	  </span><span class="comment"># foo even if both foo and FILE.exe exist: automatic-append-.exe</span>
<span class="normal">	  </span><span class="comment"># behavior happens only for exec(3), not for open(2)!  Also, sourcing</span>
<span class="normal">	  </span><span class="comment"># `FILE.' does not work on cygwin managed mounts.</span>
<span class="normal">	  </span><span class="comment">#</span>
<span class="normal">	  </span><span class="comment"># If there is no directory component, then add one.</span>
<span class="normal">	  </span><span class="keyword">case</span><span class="normal"> </span><span class="variable">$wrapper</span><span class="normal"> </span><span class="keyword">in</span>
<span class="normal">	  </span><span class="symbol">*/*</span><span class="normal"> </span><span class="symbol">|</span><span class="normal"> </span><span class="symbol">*\\*)</span><span class="normal"> </span><span class="symbol">.</span><span class="normal"> </span><span class="variable">${wrapper}</span><span class="normal"> </span><span class="symbol">;;</span>
<span class="normal">	  </span><span class="symbol">*)</span><span class="normal"> </span><span class="symbol">.</span><span class="normal"> </span><span class="symbol">./</span><span class="variable">${wrapper}</span><span class="normal"> </span><span class="symbol">;;</span>
<span class="normal">	  </span><span class="keyword">esac</span>

<span class="normal">	  </span><span class="comment"># Check the variables that should have been set.</span>
<span class="normal">	  </span><span class="keyword">if</span><span class="normal"> </span><span class="keyword">test</span><span class="normal"> -z </span><span class="string">"$notinst_deplibs"</span><span class="symbol">;</span><span class="normal"> </span><span class="keyword">then</span>
<span class="normal">	    </span><span class="variable">$echo</span><span class="normal"> </span><span class="string">"$modename: invalid libtool wrapper script </span><span class="specialchar">\`</span><span class="string">$wrapper'"</span><span class="normal"> </span><span class="number">1</span><span class="symbol">&gt;&amp;</span><span class="number">2</span>
<span class="normal">	    </span><span class="keyword">exit</span><span class="normal"> </span><span class="variable">$EXIT_FAILURE</span>
<span class="normal">	  </span><span class="keyword">fi</span>

<span class="normal">	  </span><span class="variable">finalize</span><span class="symbol">=</span><span class="normal">yes</span>
<span class="normal">	  </span><span class="keyword">for</span><span class="normal"> lib </span><span class="keyword">in</span><span class="normal"> </span><span class="variable">$notinst_deplibs</span><span class="symbol">;</span><span class="normal"> </span><span class="keyword">do</span>
<span class="normal">	    </span><span class="comment"># Check to see that each library is installed.</span>
<span class="normal">	    </span><span class="variable">libdir</span><span class="symbol">=</span>
<span class="normal">	    </span><span class="keyword">if</span><span class="normal"> </span><span class="keyword">test</span><span class="normal"> -f </span><span class="string">"$lib"</span><span class="symbol">;</span><span class="normal"> </span><span class="keyword">then</span>
<span class="normal">	      </span><span class="comment"># If there is no directory component, then add one.</span>
<span class="normal">	      </span><span class="keyword">case</span><span class="normal"> </span><span class="variable">$lib</span><span class="normal"> </span><span class="keyword">in</span>
<span class="normal">	      </span><span class="symbol">*/*</span><span class="normal"> </span><span class="symbol">|</span><span class="normal"> </span><span class="symbol">*\\*)</span><span class="normal"> </span><span class="symbol">.</span><span class="normal"> </span><span class="variable">$lib</span><span class="normal"> </span><span class="symbol">;;</span>
<span class="normal">	      </span><span class="symbol">*)</span><span class="normal"> </span><span class="symbol">.</span><span class="normal"> </span><span class="symbol">./</span><span class="variable">$lib</span><span class="normal"> </span><span class="symbol">;;</span>
<span class="normal">	      </span><span class="keyword">esac</span>
<span class="normal">	    </span><span class="keyword">fi</span>
<span class="normal">	    </span><span class="variable">libfile</span><span class="symbol">=</span><span class="string">"$libdir/"</span><span class="normal">`</span><span class="variable">$echo</span><span class="normal"> </span><span class="string">"X$lib"</span><span class="normal"> </span><span class="symbol">|</span><span class="normal"> </span><span class="variable">$Xsed</span><span class="normal"> -e </span><span class="string">'s%^.*/%%g'</span><span class="normal">` </span><span class="comment">### testsuite: skip nested quoting test</span>
<span class="normal">	    </span><span class="keyword">if</span><span class="normal"> </span><span class="keyword">test</span><span class="normal"> -n </span><span class="string">"$libdir"</span><span class="normal"> </span><span class="symbol">&amp;&amp;</span><span class="normal"> </span><span class="keyword">test</span><span class="normal"> </span><span class="symbol">!</span><span class="normal"> -f </span><span class="string">"$libfile"</span><span class="symbol">;</span><span class="normal"> </span><span class="keyword">then</span>
<span class="normal">	      </span><span class="variable">$echo</span><span class="normal"> </span><span class="string">"$modename: warning: </span><span class="specialchar">\`</span><span class="string">$lib' has not been installed in </span><span class="specialchar">\`</span><span class="string">$libdir'"</span><span class="normal"> </span><span class="number">1</span><span class="symbol">&gt;&amp;</span><span class="number">2</span>
<span class="normal">	      </span><span class="variable">finalize</span><span class="symbol">=</span><span class="normal">no</span>
<span class="normal">	    </span><span class="keyword">fi</span>
<span class="normal">	  </span><span class="keyword">done</span>

<span class="normal">	  </span><span class="variable">relink_command</span><span class="symbol">=</span>
<span class="normal">	  </span><span class="comment"># Note that it is not necessary on cygwin/mingw to append a dot to</span>
<span class="normal">	  </span><span class="comment"># foo even if both foo and FILE.exe exist: automatic-append-.exe</span>
<span class="normal">	  </span><span class="comment"># behavior happens only for exec(3), not for open(2)!  Also, sourcing</span>
<span class="normal">	  </span><span class="comment"># `FILE.' does not work on cygwin managed mounts.</span>
<span class="normal">	  </span><span class="comment">#</span>
<span class="normal">	  </span><span class="comment"># If there is no directory component, then add one.</span>
<span class="normal">	  </span><span class="keyword">case</span><span class="normal"> </span><span class="variable">$wrapper</span><span class="normal"> </span><span class="keyword">in</span>
<span class="normal">	  </span><span class="symbol">*/*</span><span class="normal"> </span><span class="symbol">|</span><span class="normal"> </span><span class="symbol">*\\*)</span><span class="normal"> </span><span class="symbol">.</span><span class="normal"> </span><span class="variable">${wrapper}</span><span class="normal"> </span><span class="symbol">;;</span>
<span class="normal">	  </span><span class="symbol">*)</span><span class="normal"> </span><span class="symbol">.</span><span class="normal"> </span><span class="symbol">./</span><span class="variable">${wrapper}</span><span class="normal"> </span><span class="symbol">;;</span>
<span class="normal">	  </span><span class="keyword">esac</span>

<span class="normal">	  </span><span class="variable">outputname</span><span class="symbol">=</span>
<span class="normal">	  </span><span class="keyword">if</span><span class="normal"> </span><span class="keyword">test</span><span class="normal"> </span><span class="string">"$fast_install"</span><span class="normal"> </span><span class="symbol">=</span><span class="normal"> no </span><span class="symbol">&amp;&amp;</span><span class="normal"> </span><span class="keyword">test</span><span class="normal"> -n </span><span class="string">"$relink_command"</span><span class="symbol">;</span><span class="normal"> </span><span class="keyword">then</span>
<span class="normal">	    </span><span class="keyword">if</span><span class="normal"> </span><span class="keyword">test</span><span class="normal"> </span><span class="string">"$finalize"</span><span class="normal"> </span><span class="symbol">=</span><span class="normal"> yes </span><span class="symbol">&amp;&amp;</span><span class="normal"> </span><span class="keyword">test</span><span class="normal"> -z </span><span class="string">"$run"</span><span class="symbol">;</span><span class="normal"> </span><span class="keyword">then</span>
<span class="normal">	      </span><span class="variable">tmpdir</span><span class="symbol">=</span><span class="normal">`func_mktempdir`</span>
<span class="normal">	      </span><span class="variable">file</span><span class="symbol">=</span><span class="normal">`</span><span class="variable">$echo</span><span class="normal"> </span><span class="string">"X$file$stripped_ext"</span><span class="normal"> </span><span class="symbol">|</span><span class="normal"> </span><span class="variable">$Xsed</span><span class="normal"> -e </span><span class="string">'s%^.*/%%'</span><span class="normal">`</span>
<span class="normal">	      </span><span class="variable">outputname</span><span class="symbol">=</span><span class="string">"$tmpdir/$file"</span>
<span class="normal">	      </span><span class="comment"># Replace the output file specification.</span>
<span class="normal">	      </span><span class="variable">relink_command</span><span class="symbol">=</span><span class="normal">`</span><span class="variable">$echo</span><span class="normal"> </span><span class="string">"X$relink_command"</span><span class="normal"> </span><span class="symbol">|</span><span class="normal"> </span><span class="variable">$SP2NL</span><span class="normal"> </span><span class="symbol">|</span><span class="normal"> </span><span class="variable">$Xsed</span><span class="normal"> -e </span><span class="string">'s%@OUTPUT@%'"$outputname"'%g'</span><span class="normal"> </span><span class="symbol">|</span><span class="normal"> </span><span class="variable">$NL2SP</span><span class="normal">`</span>

<span class="normal">	      </span><span class="variable">$show</span><span class="normal"> </span><span class="string">"$relink_command"</span>
<span class="normal">	      </span><span class="keyword">if</span><span class="normal"> </span><span class="variable">$run</span><span class="normal"> </span><span class="keyword">eval</span><span class="normal"> </span><span class="string">"$relink_command"</span><span class="symbol">;</span><span class="normal"> </span><span class="keyword">then</span><span class="normal"> </span><span class="symbol">:</span>
<span class="normal">	      </span><span class="keyword">else</span>
<span class="normal">		</span><span class="variable">$echo</span><span class="normal"> </span><span class="string">"$modename: error: relink </span><span class="specialchar">\`</span><span class="string">$file' with the above command before installing it"</span><span class="normal"> </span><span class="number">1</span><span class="symbol">&gt;&amp;</span><span class="number">2</span>
<span class="normal">		</span><span class="variable">${rm}</span><span class="normal">r </span><span class="string">"$tmpdir"</span>
<span class="normal">		</span><span class="keyword">continue</span>
<span class="normal">	      </span><span class="keyword">fi</span>
<span class="normal">	      </span><span class="variable">file</span><span class="symbol">=</span><span class="string">"$outputname"</span>
<span class="normal">	    </span><span class="keyword">else</span>
<span class="normal">	      </span><span class="variable">$echo</span><span class="normal"> </span><span class="string">"$modename: warning: cannot relink </span><span class="specialchar">\`</span><span class="string">$file'"</span><span class="normal"> </span><span class="number">1</span><span class="symbol">&gt;&amp;</span><span class="number">2</span>
<span class="normal">	    </span><span class="keyword">fi</span>
<span class="normal">	  </span><span class="keyword">else</span>
<span class="normal">	    </span><span class="comment"># Install the binary that we compiled earlier.</span>
<span class="normal">	    </span><span class="variable">file</span><span class="symbol">=</span><span class="normal">`</span><span class="variable">$echo</span><span class="normal"> </span><span class="string">"X$file$stripped_ext"</span><span class="normal"> </span><span class="symbol">|</span><span class="normal"> </span><span class="variable">$Xsed</span><span class="normal"> -e </span><span class="string">"s%</span><span class="specialchar">\(</span><span class="string">[^/]*</span><span class="specialchar">\)</span><span class="string">$%$objdir/</span><span class="specialchar">\1</span><span class="string">%"</span><span class="normal">`</span>
<span class="normal">	  </span><span class="keyword">fi</span>
<span class="normal">	</span><span class="keyword">fi</span>

<span class="normal">	</span><span class="comment"># remove .exe since cygwin /usr/bin/install will append another</span>
<span class="normal">	</span><span class="comment"># one anyway </span>
<span class="normal">	</span><span class="keyword">case</span><span class="normal"> </span><span class="variable">$install_prog</span><span class="symbol">,</span><span class="variable">$host</span><span class="normal"> </span><span class="keyword">in</span>
<span class="normal">	</span><span class="symbol">*</span><span class="normal">/usr/bin/install</span><span class="symbol">*,*</span><span class="normal">cygwin</span><span class="symbol">*)</span>
<span class="normal">	  </span><span class="keyword">case</span><span class="normal"> </span><span class="variable">$file</span><span class="symbol">:</span><span class="variable">$destfile</span><span class="normal"> </span><span class="keyword">in</span>
<span class="normal">	  </span><span class="symbol">*.</span><span class="normal">exe</span><span class="symbol">:*.</span><span class="normal">exe</span><span class="symbol">)</span>
<span class="normal">	    </span><span class="comment"># this is ok</span>
<span class="normal">	    </span><span class="symbol">;;</span>
<span class="normal">	  </span><span class="symbol">*.</span><span class="normal">exe</span><span class="symbol">:*)</span>
<span class="normal">	    </span><span class="variable">destfile</span><span class="symbol">=</span><span class="variable">$destfile</span><span class="symbol">.</span><span class="normal">exe</span>
<span class="normal">	    </span><span class="symbol">;;</span>
<span class="normal">	  </span><span class="symbol">*:*.</span><span class="normal">exe</span><span class="symbol">)</span>
<span class="normal">	    </span><span class="variable">destfile</span><span class="symbol">=</span><span class="normal">`</span><span class="variable">$echo</span><span class="normal"> </span><span class="variable">$destfile</span><span class="normal"> </span><span class="symbol">|</span><span class="normal"> </span><span class="variable">${SED}</span><span class="normal"> -e </span><span class="string">'s,.exe$,,'</span><span class="normal">`</span>
<span class="normal">	    </span><span class="symbol">;;</span>
<span class="normal">	  </span><span class="keyword">esac</span>
<span class="normal">	  </span><span class="symbol">;;</span>
<span class="normal">	</span><span class="keyword">esac</span>
<span class="normal">	</span><span class="variable">$show</span><span class="normal"> </span><span class="string">"$install_prog$stripme $file $destfile"</span>
<span class="normal">	</span><span class="variable">$run</span><span class="normal"> </span><span class="keyword">eval</span><span class="normal"> </span><span class="string">"$install_prog</span><span class="specialchar">\$</span><span class="string">stripme </span><span class="specialchar">\$</span><span class="string">file </span><span class="specialchar">\$</span><span class="string">destfile"</span><span class="normal"> </span><span class="symbol">||</span><span class="normal"> </span><span class="keyword">exit</span><span class="normal"> </span><span class="variable">$?</span>
<span class="normal">	</span><span class="keyword">test</span><span class="normal"> -n </span><span class="string">"$outputname"</span><span class="normal"> </span><span class="symbol">&amp;&amp;</span><span class="normal"> </span><span class="variable">${rm}</span><span class="normal">r </span><span class="string">"$tmpdir"</span>
<span class="normal">	</span><span class="symbol">;;</span>
<span class="normal">      </span><span class="keyword">esac</span>
<span class="normal">    </span><span class="keyword">done</span>

<span class="normal">    </span><span class="keyword">for</span><span class="normal"> file </span><span class="keyword">in</span><span class="normal"> </span><span class="variable">$staticlibs</span><span class="symbol">;</span><span class="normal"> </span><span class="keyword">do</span>
<span class="normal">      </span><span class="variable">name</span><span class="symbol">=</span><span class="normal">`</span><span class="variable">$echo</span><span class="normal"> </span><span class="string">"X$file"</span><span class="normal"> </span><span class="symbol">|</span><span class="normal"> </span><span class="variable">$Xsed</span><span class="normal"> -e </span><span class="string">'s%^.*/%%'</span><span class="normal">`</span>

<span class="normal">      </span><span class="comment"># Set up the ranlib parameters.</span>
<span class="normal">      </span><span class="variable">oldlib</span><span class="symbol">=</span><span class="string">"$destdir/$name"</span>

<span class="normal">      </span><span class="variable">$show</span><span class="normal"> </span><span class="string">"$install_prog $file $oldlib"</span>
<span class="normal">      </span><span class="variable">$run</span><span class="normal"> </span><span class="keyword">eval</span><span class="normal"> </span><span class="string">"$install_prog </span><span class="specialchar">\$</span><span class="string">file </span><span class="specialchar">\$</span><span class="string">oldlib"</span><span class="normal"> </span><span class="symbol">||</span><span class="normal"> </span><span class="keyword">exit</span><span class="normal"> </span><span class="variable">$?</span>

<span class="normal">      </span><span class="keyword">if</span><span class="normal"> </span><span class="keyword">test</span><span class="normal"> -n </span><span class="string">"$stripme"</span><span class="normal"> </span><span class="symbol">&amp;&amp;</span><span class="normal"> </span><span class="keyword">test</span><span class="normal"> -n </span><span class="string">"$old_striplib"</span><span class="symbol">;</span><span class="normal"> </span><span class="keyword">then</span>
<span class="normal">	</span><span class="variable">$show</span><span class="normal"> </span><span class="string">"$old_striplib $oldlib"</span>
<span class="normal">	</span><span class="variable">$run</span><span class="normal"> </span><span class="keyword">eval</span><span class="normal"> </span><span class="string">"$old_striplib $oldlib"</span><span class="normal"> </span><span class="symbol">||</span><span class="normal"> </span><span class="keyword">exit</span><span class="normal"> </span><span class="variable">$?</span>
<span class="normal">      </span><span class="keyword">fi</span>

<span class="normal">      </span><span class="comment"># Do each command in the postinstall commands.</span>
<span class="normal">      </span><span class="variable">cmds</span><span class="symbol">=</span><span class="variable">$old_postinstall_cmds</span>
<span class="normal">      </span><span class="variable">save_ifs</span><span class="symbol">=</span><span class="string">"$IFS"</span><span class="symbol">;</span><span class="normal"> </span><span class="variable">IFS</span><span class="symbol">=</span><span class="string">'~'</span>
<span class="normal">      </span><span class="keyword">for</span><span class="normal"> cmd </span><span class="keyword">in</span><span class="normal"> </span><span class="variable">$cmds</span><span class="symbol">;</span><span class="normal"> </span><span class="keyword">do</span>
<span class="normal">	</span><span class="variable">IFS</span><span class="symbol">=</span><span class="string">"$save_ifs"</span>
<span class="normal">	</span><span class="keyword">eval</span><span class="normal"> </span><span class="variable">cmd</span><span class="symbol">=</span><span class="normal">\"</span><span class="variable">$cmd</span><span class="normal">\"</span>
<span class="normal">	</span><span class="variable">$show</span><span class="normal"> </span><span class="string">"$cmd"</span>
<span class="normal">	</span><span class="variable">$run</span><span class="normal"> </span><span class="keyword">eval</span><span class="normal"> </span><span class="string">"$cmd"</span><span class="normal"> </span><span class="symbol">||</span><span class="normal"> </span><span class="keyword">exit</span><span class="normal"> </span><span class="variable">$?</span>
<span class="normal">      </span><span class="keyword">done</span>
<span class="normal">      </span><span class="variable">IFS</span><span class="symbol">=</span><span class="string">"$save_ifs"</span>
<span class="normal">    </span><span class="keyword">done</span>

<span class="normal">    </span><span class="keyword">if</span><span class="normal"> </span><span class="keyword">test</span><span class="normal"> -n </span><span class="string">"$future_libdirs"</span><span class="symbol">;</span><span class="normal"> </span><span class="keyword">then</span>
<span class="normal">      </span><span class="variable">$echo</span><span class="normal"> </span><span class="string">"$modename: warning: remember to run </span><span class="specialchar">\`</span><span class="string">$progname --finish$future_libdirs'"</span><span class="normal"> </span><span class="number">1</span><span class="symbol">&gt;&amp;</span><span class="number">2</span>
<span class="normal">    </span><span class="keyword">fi</span>

<span class="normal">    </span><span class="keyword">if</span><span class="normal"> </span><span class="keyword">test</span><span class="normal"> -n </span><span class="string">"$current_libdirs"</span><span class="symbol">;</span><span class="normal"> </span><span class="keyword">then</span>
<span class="normal">      </span><span class="comment"># Maybe just do a dry run.</span>
<span class="normal">      </span><span class="keyword">test</span><span class="normal"> -n </span><span class="string">"$run"</span><span class="normal"> </span><span class="symbol">&amp;&amp;</span><span class="normal"> </span><span class="variable">current_libdirs</span><span class="symbol">=</span><span class="string">" -n$current_libdirs"</span>
<span class="normal">      </span><span class="variable">exec_cmd</span><span class="symbol">=</span><span class="string">'$SHELL $progpath $preserve_args --finish$current_libdirs'</span>
<span class="normal">    </span><span class="keyword">else</span>
<span class="normal">      </span><span class="keyword">exit</span><span class="normal"> </span><span class="variable">$EXIT_SUCCESS</span>
<span class="normal">    </span><span class="keyword">fi</span>
<span class="normal">    </span><span class="symbol">;;</span>

<span class="normal">  </span><span class="comment"># libtool finish mode</span>
<span class="normal">  finish</span><span class="symbol">)</span>
<span class="normal">    </span><span class="variable">modename</span><span class="symbol">=</span><span class="string">"$modename: finish"</span>
<span class="normal">    </span><span class="variable">libdirs</span><span class="symbol">=</span><span class="string">"$nonopt"</span>
<span class="normal">    </span><span class="variable">admincmds</span><span class="symbol">=</span>

<span class="normal">    </span><span class="keyword">if</span><span class="normal"> </span><span class="keyword">test</span><span class="normal"> -n </span><span class="string">"$finish_cmds$finish_eval"</span><span class="normal"> </span><span class="symbol">&amp;&amp;</span><span class="normal"> </span><span class="keyword">test</span><span class="normal"> -n </span><span class="string">"$libdirs"</span><span class="symbol">;</span><span class="normal"> </span><span class="keyword">then</span>
<span class="normal">      </span><span class="keyword">for</span><span class="normal"> dir</span>
<span class="normal">      </span><span class="keyword">do</span>
<span class="normal">	</span><span class="variable">libdirs</span><span class="symbol">=</span><span class="string">"$libdirs $dir"</span>
<span class="normal">      </span><span class="keyword">done</span>

<span class="normal">      </span><span class="keyword">for</span><span class="normal"> libdir </span><span class="keyword">in</span><span class="normal"> </span><span class="variable">$libdirs</span><span class="symbol">;</span><span class="normal"> </span><span class="keyword">do</span>
<span class="normal">	</span><span class="keyword">if</span><span class="normal"> </span><span class="keyword">test</span><span class="normal"> -n </span><span class="string">"$finish_cmds"</span><span class="symbol">;</span><span class="normal"> </span><span class="keyword">then</span>
<span class="normal">	  </span><span class="comment"># Do each command in the finish commands.</span>
<span class="normal">	  </span><span class="variable">cmds</span><span class="symbol">=</span><span class="variable">$finish_cmds</span>
<span class="normal">	  </span><span class="variable">save_ifs</span><span class="symbol">=</span><span class="string">"$IFS"</span><span class="symbol">;</span><span class="normal"> </span><span class="variable">IFS</span><span class="symbol">=</span><span class="string">'~'</span>
<span class="normal">	  </span><span class="keyword">for</span><span class="normal"> cmd </span><span class="keyword">in</span><span class="normal"> </span><span class="variable">$cmds</span><span class="symbol">;</span><span class="normal"> </span><span class="keyword">do</span>
<span class="normal">	    </span><span class="variable">IFS</span><span class="symbol">=</span><span class="string">"$save_ifs"</span>
<span class="normal">	    </span><span class="keyword">eval</span><span class="normal"> </span><span class="variable">cmd</span><span class="symbol">=</span><span class="normal">\"</span><span class="variable">$cmd</span><span class="normal">\"</span>
<span class="normal">	    </span><span class="variable">$show</span><span class="normal"> </span><span class="string">"$cmd"</span>
<span class="normal">	    </span><span class="variable">$run</span><span class="normal"> </span><span class="keyword">eval</span><span class="normal"> </span><span class="string">"$cmd"</span><span class="normal"> </span><span class="symbol">||</span><span class="normal"> </span><span class="variable">admincmds</span><span class="symbol">=</span><span class="string">"$admincmds</span>
<span class="string">       $cmd"</span>
<span class="normal">	  </span><span class="keyword">done</span>
<span class="normal">	  </span><span class="variable">IFS</span><span class="symbol">=</span><span class="string">"$save_ifs"</span>
<span class="normal">	</span><span class="keyword">fi</span>
<span class="normal">	</span><span class="keyword">if</span><span class="normal"> </span><span class="keyword">test</span><span class="normal"> -n </span><span class="string">"$finish_eval"</span><span class="symbol">;</span><span class="normal"> </span><span class="keyword">then</span>
<span class="normal">	  </span><span class="comment"># Do the single finish_eval.</span>
<span class="normal">	  </span><span class="keyword">eval</span><span class="normal"> </span><span class="variable">cmds</span><span class="symbol">=</span><span class="normal">\"</span><span class="variable">$finish_eval</span><span class="normal">\"</span>
<span class="normal">	  </span><span class="variable">$run</span><span class="normal"> </span><span class="keyword">eval</span><span class="normal"> </span><span class="string">"$cmds"</span><span class="normal"> </span><span class="symbol">||</span><span class="normal"> </span><span class="variable">admincmds</span><span class="symbol">=</span><span class="string">"$admincmds</span>
<span class="string">       $cmds"</span>
<span class="normal">	</span><span class="keyword">fi</span>
<span class="normal">      </span><span class="keyword">done</span>
<span class="normal">    </span><span class="keyword">fi</span>

<span class="normal">    </span><span class="comment"># Exit here if they wanted silent mode.</span>
<span class="normal">    </span><span class="keyword">test</span><span class="normal"> </span><span class="string">"$show"</span><span class="normal"> </span><span class="symbol">=</span><span class="normal"> </span><span class="symbol">:</span><span class="normal"> </span><span class="symbol">&amp;&amp;</span><span class="normal"> </span><span class="keyword">exit</span><span class="normal"> </span><span class="variable">$EXIT_SUCCESS</span>

<span class="normal">    </span><span class="variable">$echo</span><span class="normal"> </span><span class="string">"X----------------------------------------------------------------------"</span><span class="normal"> </span><span class="symbol">|</span><span class="normal"> </span><span class="variable">$Xsed</span>
<span class="normal">    </span><span class="variable">$echo</span><span class="normal"> </span><span class="string">"Libraries have been installed in:"</span>
<span class="normal">    </span><span class="keyword">for</span><span class="normal"> libdir </span><span class="keyword">in</span><span class="normal"> </span><span class="variable">$libdirs</span><span class="symbol">;</span><span class="normal"> </span><span class="keyword">do</span>
<span class="normal">      </span><span class="variable">$echo</span><span class="normal"> </span><span class="string">"   $libdir"</span>
<span class="normal">    </span><span class="keyword">done</span>
<span class="normal">    </span><span class="variable">$echo</span>
<span class="normal">    </span><span class="variable">$echo</span><span class="normal"> </span><span class="string">"If you ever happen to want to link against installed libraries"</span>
<span class="normal">    </span><span class="variable">$echo</span><span class="normal"> </span><span class="string">"in a given directory, LIBDIR, you must either use libtool, and"</span>
<span class="normal">    </span><span class="variable">$echo</span><span class="normal"> </span><span class="string">"specify the full pathname of the library, or use the </span><span class="specialchar">\`</span><span class="string">-LLIBDIR'"</span>
<span class="normal">    </span><span class="variable">$echo</span><span class="normal"> </span><span class="string">"flag during linking and do at least one of the following:"</span>
<span class="normal">    </span><span class="keyword">if</span><span class="normal"> </span><span class="keyword">test</span><span class="normal"> -n </span><span class="string">"$shlibpath_var"</span><span class="symbol">;</span><span class="normal"> </span><span class="keyword">then</span>
<span class="normal">      </span><span class="variable">$echo</span><span class="normal"> </span><span class="string">"   - add LIBDIR to the </span><span class="specialchar">\`</span><span class="string">$shlibpath_var' environment variable"</span>
<span class="normal">      </span><span class="variable">$echo</span><span class="normal"> </span><span class="string">"     during execution"</span>
<span class="normal">    </span><span class="keyword">fi</span>
<span class="normal">    </span><span class="keyword">if</span><span class="normal"> </span><span class="keyword">test</span><span class="normal"> -n </span><span class="string">"$runpath_var"</span><span class="symbol">;</span><span class="normal"> </span><span class="keyword">then</span>
<span class="normal">      </span><span class="variable">$echo</span><span class="normal"> </span><span class="string">"   - add LIBDIR to the </span><span class="specialchar">\`</span><span class="string">$runpath_var' environment variable"</span>
<span class="normal">      </span><span class="variable">$echo</span><span class="normal"> </span><span class="string">"     during linking"</span>
<span class="normal">    </span><span class="keyword">fi</span>
<span class="normal">    </span><span class="keyword">if</span><span class="normal"> </span><span class="keyword">test</span><span class="normal"> -n </span><span class="string">"$hardcode_libdir_flag_spec"</span><span class="symbol">;</span><span class="normal"> </span><span class="keyword">then</span>
<span class="normal">      </span><span class="variable">libdir</span><span class="symbol">=</span><span class="normal">LIBDIR</span>
<span class="normal">      </span><span class="keyword">eval</span><span class="normal"> </span><span class="variable">flag</span><span class="symbol">=</span><span class="normal">\"</span><span class="variable">$hardcode_libdir_flag_spec</span><span class="normal">\"</span>

<span class="normal">      </span><span class="variable">$echo</span><span class="normal"> </span><span class="string">"   - use the </span><span class="specialchar">\`</span><span class="string">$flag' linker flag"</span>
<span class="normal">    </span><span class="keyword">fi</span>
<span class="normal">    </span><span class="keyword">if</span><span class="normal"> </span><span class="keyword">test</span><span class="normal"> -n </span><span class="string">"$admincmds"</span><span class="symbol">;</span><span class="normal"> </span><span class="keyword">then</span>
<span class="normal">      </span><span class="variable">$echo</span><span class="normal"> </span><span class="string">"   - have your system administrator run these commands:$admincmds"</span>
<span class="normal">    </span><span class="keyword">fi</span>
<span class="normal">    </span><span class="keyword">if</span><span class="normal"> </span><span class="keyword">test</span><span class="normal"> -f /etc/ld</span><span class="symbol">.</span><span class="normal">so</span><span class="symbol">.</span><span class="normal">conf</span><span class="symbol">;</span><span class="normal"> </span><span class="keyword">then</span>
<span class="normal">      </span><span class="variable">$echo</span><span class="normal"> </span><span class="string">"   - have your system administrator add LIBDIR to </span><span class="specialchar">\`</span><span class="string">/etc/ld.so.conf'"</span>
<span class="normal">    </span><span class="keyword">fi</span>
<span class="normal">    </span><span class="variable">$echo</span>
<span class="normal">    </span><span class="variable">$echo</span><span class="normal"> </span><span class="string">"See any operating system documentation about shared libraries for"</span>
<span class="normal">    </span><span class="variable">$echo</span><span class="normal"> </span><span class="string">"more information, such as the ld(1) and ld.so(8) manual pages."</span>
<span class="normal">    </span><span class="variable">$echo</span><span class="normal"> </span><span class="string">"X----------------------------------------------------------------------"</span><span class="normal"> </span><span class="symbol">|</span><span class="normal"> </span><span class="variable">$Xsed</span>
<span class="normal">    </span><span class="keyword">exit</span><span class="normal"> </span><span class="variable">$EXIT_SUCCESS</span>
<span class="normal">    </span><span class="symbol">;;</span>

<span class="normal">  </span><span class="comment"># libtool execute mode</span>
<span class="normal">  execute</span><span class="symbol">)</span>
<span class="normal">    </span><span class="variable">modename</span><span class="symbol">=</span><span class="string">"$modename: execute"</span>

<span class="normal">    </span><span class="comment"># The first argument is the command name.</span>
<span class="normal">    </span><span class="variable">cmd</span><span class="symbol">=</span><span class="string">"$nonopt"</span>
<span class="normal">    </span><span class="keyword">if</span><span class="normal"> </span><span class="keyword">test</span><span class="normal"> -z </span><span class="string">"$cmd"</span><span class="symbol">;</span><span class="normal"> </span><span class="keyword">then</span>
<span class="normal">      </span><span class="variable">$echo</span><span class="normal"> </span><span class="string">"$modename: you must specify a COMMAND"</span><span class="normal"> </span><span class="number">1</span><span class="symbol">&gt;&amp;</span><span class="number">2</span>
<span class="normal">      </span><span class="variable">$echo</span><span class="normal"> </span><span class="string">"$help"</span>
<span class="normal">      </span><span class="keyword">exit</span><span class="normal"> </span><span class="variable">$EXIT_FAILURE</span>
<span class="normal">    </span><span class="keyword">fi</span>

<span class="normal">    </span><span class="comment"># Handle -dlopen flags immediately.</span>
<span class="normal">    </span><span class="keyword">for</span><span class="normal"> file </span><span class="keyword">in</span><span class="normal"> </span><span class="variable">$execute_dlfiles</span><span class="symbol">;</span><span class="normal"> </span><span class="keyword">do</span>
<span class="normal">      </span><span class="keyword">if</span><span class="normal"> </span><span class="keyword">test</span><span class="normal"> </span><span class="symbol">!</span><span class="normal"> -f </span><span class="string">"$file"</span><span class="symbol">;</span><span class="normal"> </span><span class="keyword">then</span>
<span class="normal">	</span><span class="variable">$echo</span><span class="normal"> </span><span class="string">"$modename: </span><span class="specialchar">\`</span><span class="string">$file' is not a file"</span><span class="normal"> </span><span class="number">1</span><span class="symbol">&gt;&amp;</span><span class="number">2</span>
<span class="normal">	</span><span class="variable">$echo</span><span class="normal"> </span><span class="string">"$help"</span><span class="normal"> </span><span class="number">1</span><span class="symbol">&gt;&amp;</span><span class="number">2</span>
<span class="normal">	</span><span class="keyword">exit</span><span class="normal"> </span><span class="variable">$EXIT_FAILURE</span>
<span class="normal">      </span><span class="keyword">fi</span>

<span class="normal">      </span><span class="variable">dir</span><span class="symbol">=</span>
<span class="normal">      </span><span class="keyword">case</span><span class="normal"> </span><span class="variable">$file</span><span class="normal"> </span><span class="keyword">in</span>
<span class="normal">      </span><span class="symbol">*.</span><span class="normal">la</span><span class="symbol">)</span>
<span class="normal">	</span><span class="comment"># Check to see that this really is a libtool archive.</span>
<span class="normal">	</span><span class="keyword">if</span><span class="normal"> </span><span class="symbol">(</span><span class="variable">${SED}</span><span class="normal"> -e </span><span class="string">'2q'</span><span class="normal"> </span><span class="variable">$file</span><span class="normal"> </span><span class="symbol">|</span><span class="normal"> grep </span><span class="string">"^# Generated by .*$PACKAGE"</span><span class="symbol">)</span><span class="normal"> </span><span class="symbol">&gt;</span><span class="normal">/dev/null </span><span class="number">2</span><span class="symbol">&gt;&amp;</span><span class="number">1</span><span class="symbol">;</span><span class="normal"> </span><span class="keyword">then</span><span class="normal"> </span><span class="symbol">:</span>
<span class="normal">	</span><span class="keyword">else</span>
<span class="normal">	  </span><span class="variable">$echo</span><span class="normal"> </span><span class="string">"$modename: </span><span class="specialchar">\`</span><span class="string">$lib' is not a valid libtool archive"</span><span class="normal"> </span><span class="number">1</span><span class="symbol">&gt;&amp;</span><span class="number">2</span>
<span class="normal">	  </span><span class="variable">$echo</span><span class="normal"> </span><span class="string">"$help"</span><span class="normal"> </span><span class="number">1</span><span class="symbol">&gt;&amp;</span><span class="number">2</span>
<span class="normal">	  </span><span class="keyword">exit</span><span class="normal"> </span><span class="variable">$EXIT_FAILURE</span>
<span class="normal">	</span><span class="keyword">fi</span>

<span class="normal">	</span><span class="comment"># Read the libtool library.</span>
<span class="normal">	</span><span class="variable">dlname</span><span class="symbol">=</span>
<span class="normal">	</span><span class="variable">library_names</span><span class="symbol">=</span>

<span class="normal">	</span><span class="comment"># If there is no directory component, then add one.</span>
<span class="normal">	</span><span class="keyword">case</span><span class="normal"> </span><span class="variable">$file</span><span class="normal"> </span><span class="keyword">in</span>
<span class="normal">	</span><span class="symbol">*/*</span><span class="normal"> </span><span class="symbol">|</span><span class="normal"> </span><span class="symbol">*\\*)</span><span class="normal"> </span><span class="symbol">.</span><span class="normal"> </span><span class="variable">$file</span><span class="normal"> </span><span class="symbol">;;</span>
<span class="normal">	</span><span class="symbol">*)</span><span class="normal"> </span><span class="symbol">.</span><span class="normal"> </span><span class="symbol">./</span><span class="variable">$file</span><span class="normal"> </span><span class="symbol">;;</span>
<span class="normal">	</span><span class="keyword">esac</span>

<span class="normal">	</span><span class="comment"># Skip this library if it cannot be dlopened.</span>
<span class="normal">	</span><span class="keyword">if</span><span class="normal"> </span><span class="keyword">test</span><span class="normal"> -z </span><span class="string">"$dlname"</span><span class="symbol">;</span><span class="normal"> </span><span class="keyword">then</span>
<span class="normal">	  </span><span class="comment"># Warn if it was a shared library.</span>
<span class="normal">	  </span><span class="keyword">test</span><span class="normal"> -n </span><span class="string">"$library_names"</span><span class="normal"> </span><span class="symbol">&amp;&amp;</span><span class="normal"> </span><span class="variable">$echo</span><span class="normal"> </span><span class="string">"$modename: warning: </span><span class="specialchar">\`</span><span class="string">$file' was not linked with </span><span class="specialchar">\`</span><span class="string">-export-dynamic'"</span>
<span class="normal">	  </span><span class="keyword">continue</span>
<span class="normal">	</span><span class="keyword">fi</span>

<span class="normal">	</span><span class="variable">dir</span><span class="symbol">=</span><span class="normal">`</span><span class="variable">$echo</span><span class="normal"> </span><span class="string">"X$file"</span><span class="normal"> </span><span class="symbol">|</span><span class="normal"> </span><span class="variable">$Xsed</span><span class="normal"> -e </span><span class="string">'s%/[^/]*$%%'</span><span class="normal">`</span>
<span class="normal">	</span><span class="keyword">test</span><span class="normal"> </span><span class="string">"X$dir"</span><span class="normal"> </span><span class="symbol">=</span><span class="normal"> </span><span class="string">"X$file"</span><span class="normal"> </span><span class="symbol">&amp;&amp;</span><span class="normal"> </span><span class="variable">dir</span><span class="symbol">=.</span>

<span class="normal">	</span><span class="keyword">if</span><span class="normal"> </span><span class="keyword">test</span><span class="normal"> -f </span><span class="string">"$dir/$objdir/$dlname"</span><span class="symbol">;</span><span class="normal"> </span><span class="keyword">then</span>
<span class="normal">	  </span><span class="variable">dir</span><span class="symbol">=</span><span class="string">"$dir/$objdir"</span>
<span class="normal">	</span><span class="keyword">else</span>
<span class="normal">	  </span><span class="keyword">if</span><span class="normal"> </span><span class="keyword">test</span><span class="normal"> </span><span class="symbol">!</span><span class="normal"> -f </span><span class="string">"$dir/$dlname"</span><span class="symbol">;</span><span class="normal"> </span><span class="keyword">then</span>
<span class="normal">	    </span><span class="variable">$echo</span><span class="normal"> </span><span class="string">"$modename: cannot find </span><span class="specialchar">\`</span><span class="string">$dlname' in </span><span class="specialchar">\`</span><span class="string">$dir' or </span><span class="specialchar">\`</span><span class="string">$dir/$objdir'"</span><span class="normal"> </span><span class="number">1</span><span class="symbol">&gt;&amp;</span><span class="number">2</span>
<span class="normal">	    </span><span class="keyword">exit</span><span class="normal"> </span><span class="variable">$EXIT_FAILURE</span>
<span class="normal">	  </span><span class="keyword">fi</span>
<span class="normal">	</span><span class="keyword">fi</span>
<span class="normal">	</span><span class="symbol">;;</span>

<span class="normal">      </span><span class="symbol">*.</span><span class="normal">lo</span><span class="symbol">)</span>
<span class="normal">	</span><span class="comment"># Just add the directory containing the .lo file.</span>
<span class="normal">	</span><span class="variable">dir</span><span class="symbol">=</span><span class="normal">`</span><span class="variable">$echo</span><span class="normal"> </span><span class="string">"X$file"</span><span class="normal"> </span><span class="symbol">|</span><span class="normal"> </span><span class="variable">$Xsed</span><span class="normal"> -e </span><span class="string">'s%/[^/]*$%%'</span><span class="normal">`</span>
<span class="normal">	</span><span class="keyword">test</span><span class="normal"> </span><span class="string">"X$dir"</span><span class="normal"> </span><span class="symbol">=</span><span class="normal"> </span><span class="string">"X$file"</span><span class="normal"> </span><span class="symbol">&amp;&amp;</span><span class="normal"> </span><span class="variable">dir</span><span class="symbol">=.</span>
<span class="normal">	</span><span class="symbol">;;</span>

<span class="normal">      </span><span class="symbol">*)</span>
<span class="normal">	</span><span class="variable">$echo</span><span class="normal"> </span><span class="string">"$modename: warning </span><span class="specialchar">\`</span><span class="string">-dlopen' is ignored for non-libtool libraries and objects"</span><span class="normal"> </span><span class="number">1</span><span class="symbol">&gt;&amp;</span><span class="number">2</span>
<span class="normal">	</span><span class="keyword">continue</span>
<span class="normal">	</span><span class="symbol">;;</span>
<span class="normal">      </span><span class="keyword">esac</span>

<span class="normal">      </span><span class="comment"># Get the absolute pathname.</span>
<span class="normal">      </span><span class="variable">absdir</span><span class="symbol">=</span><span class="normal">`cd </span><span class="string">"$dir"</span><span class="normal"> </span><span class="symbol">&amp;&amp;</span><span class="normal"> pwd`</span>
<span class="normal">      </span><span class="keyword">test</span><span class="normal"> -n </span><span class="string">"$absdir"</span><span class="normal"> </span><span class="symbol">&amp;&amp;</span><span class="normal"> </span><span class="variable">dir</span><span class="symbol">=</span><span class="string">"$absdir"</span>

<span class="normal">      </span><span class="comment"># Now add the directory to shlibpath_var.</span>
<span class="normal">      </span><span class="keyword">if</span><span class="normal"> </span><span class="keyword">eval</span><span class="normal"> </span><span class="string">"test -z </span><span class="specialchar">\"\$</span><span class="string">$shlibpath_var</span><span class="specialchar">\"</span><span class="string">"</span><span class="symbol">;</span><span class="normal"> </span><span class="keyword">then</span>
<span class="normal">	</span><span class="keyword">eval</span><span class="normal"> </span><span class="string">"$shlibpath_var=</span><span class="specialchar">\"\$</span><span class="string">dir</span><span class="specialchar">\"</span><span class="string">"</span>
<span class="normal">      </span><span class="keyword">else</span>
<span class="normal">	</span><span class="keyword">eval</span><span class="normal"> </span><span class="string">"$shlibpath_var=</span><span class="specialchar">\"\$</span><span class="string">dir:</span><span class="specialchar">\$</span><span class="string">$shlibpath_var</span><span class="specialchar">\"</span><span class="string">"</span>
<span class="normal">      </span><span class="keyword">fi</span>
<span class="normal">    </span><span class="keyword">done</span>

<span class="normal">    </span><span class="comment"># This variable tells wrapper scripts just to set shlibpath_var</span>
<span class="normal">    </span><span class="comment"># rather than running their programs.</span>
<span class="normal">    </span><span class="variable">libtool_execute_magic</span><span class="symbol">=</span><span class="string">"$magic"</span>

<span class="normal">    </span><span class="comment"># Check if any of the arguments is a wrapper script.</span>
<span class="normal">    </span><span class="variable">args</span><span class="symbol">=</span>
<span class="normal">    </span><span class="keyword">for</span><span class="normal"> file</span>
<span class="normal">    </span><span class="keyword">do</span>
<span class="normal">      </span><span class="keyword">case</span><span class="normal"> </span><span class="variable">$file</span><span class="normal"> </span><span class="keyword">in</span>
<span class="normal">      -</span><span class="symbol">*)</span><span class="normal"> </span><span class="symbol">;;</span>
<span class="normal">      </span><span class="symbol">*)</span>
<span class="normal">	</span><span class="comment"># Do a test to see if this is really a libtool program.</span>
<span class="normal">	</span><span class="keyword">if</span><span class="normal"> </span><span class="symbol">(</span><span class="variable">${SED}</span><span class="normal"> -e </span><span class="string">'4q'</span><span class="normal"> </span><span class="variable">$file</span><span class="normal"> </span><span class="symbol">|</span><span class="normal"> grep </span><span class="string">"^# Generated by .*$PACKAGE"</span><span class="symbol">)</span><span class="normal"> </span><span class="symbol">&gt;</span><span class="normal">/dev/null </span><span class="number">2</span><span class="symbol">&gt;&amp;</span><span class="number">1</span><span class="symbol">;</span><span class="normal"> </span><span class="keyword">then</span>
<span class="normal">	  </span><span class="comment"># If there is no directory component, then add one.</span>
<span class="normal">	  </span><span class="keyword">case</span><span class="normal"> </span><span class="variable">$file</span><span class="normal"> </span><span class="keyword">in</span>
<span class="normal">	  </span><span class="symbol">*/*</span><span class="normal"> </span><span class="symbol">|</span><span class="normal"> </span><span class="symbol">*\\*)</span><span class="normal"> </span><span class="symbol">.</span><span class="normal"> </span><span class="variable">$file</span><span class="normal"> </span><span class="symbol">;;</span>
<span class="normal">	  </span><span class="symbol">*)</span><span class="normal"> </span><span class="symbol">.</span><span class="normal"> </span><span class="symbol">./</span><span class="variable">$file</span><span class="normal"> </span><span class="symbol">;;</span>
<span class="normal">	  </span><span class="keyword">esac</span>

<span class="normal">	  </span><span class="comment"># Transform arg to wrapped name.</span>
<span class="normal">	  </span><span class="variable">file</span><span class="symbol">=</span><span class="string">"$progdir/$program"</span>
<span class="normal">	</span><span class="keyword">fi</span>
<span class="normal">	</span><span class="symbol">;;</span>
<span class="normal">      </span><span class="keyword">esac</span>
<span class="normal">      </span><span class="comment"># Quote arguments (to preserve shell metacharacters).</span>
<span class="normal">      </span><span class="variable">file</span><span class="symbol">=</span><span class="normal">`</span><span class="variable">$echo</span><span class="normal"> </span><span class="string">"X$file"</span><span class="normal"> </span><span class="symbol">|</span><span class="normal"> </span><span class="variable">$Xsed</span><span class="normal"> -e </span><span class="string">"$sed_quote_subst"</span><span class="normal">`</span>
<span class="normal">      </span><span class="variable">args</span><span class="symbol">=</span><span class="string">"$args </span><span class="specialchar">\"</span><span class="string">$file</span><span class="specialchar">\"</span><span class="string">"</span>
<span class="normal">    </span><span class="keyword">done</span>

<span class="normal">    </span><span class="keyword">if</span><span class="normal"> </span><span class="keyword">test</span><span class="normal"> -z </span><span class="string">"$run"</span><span class="symbol">;</span><span class="normal"> </span><span class="keyword">then</span>
<span class="normal">      </span><span class="keyword">if</span><span class="normal"> </span><span class="keyword">test</span><span class="normal"> -n </span><span class="string">"$shlibpath_var"</span><span class="symbol">;</span><span class="normal"> </span><span class="keyword">then</span>
<span class="normal">	</span><span class="comment"># Export the shlibpath_var.</span>
<span class="normal">	</span><span class="keyword">eval</span><span class="normal"> </span><span class="string">"export $shlibpath_var"</span>
<span class="normal">      </span><span class="keyword">fi</span>

<span class="normal">      </span><span class="comment"># Restore saved environment variables</span>
<span class="normal">      </span><span class="keyword">for</span><span class="normal"> lt_var </span><span class="keyword">in</span><span class="normal"> LANG LC_ALL LC_CTYPE LC_COLLATE LC_MESSAGES</span>
<span class="normal">      </span><span class="keyword">do</span>
<span class="normal">	</span><span class="keyword">eval</span><span class="normal"> </span><span class="string">"if test </span><span class="specialchar">\"\$</span><span class="string">{save_$lt_var+set}</span><span class="specialchar">\"</span><span class="string"> = set; then</span>
<span class="string">		$lt_var=</span><span class="specialchar">\$</span><span class="string">save_$lt_var; export $lt_var</span>
<span class="string">	      else</span>
<span class="string">		$lt_unset $lt_var</span>
<span class="string">	      fi"</span>
<span class="normal">      </span><span class="keyword">done</span>

<span class="normal">      </span><span class="comment"># Now prepare to actually exec the command.</span>
<span class="normal">      </span><span class="variable">exec_cmd</span><span class="symbol">=</span><span class="string">"</span><span class="specialchar">\$</span><span class="string">cmd$args"</span>
<span class="normal">    </span><span class="keyword">else</span>
<span class="normal">      </span><span class="comment"># Display what would be done.</span>
<span class="normal">      </span><span class="keyword">if</span><span class="normal"> </span><span class="keyword">test</span><span class="normal"> -n </span><span class="string">"$shlibpath_var"</span><span class="symbol">;</span><span class="normal"> </span><span class="keyword">then</span>
<span class="normal">	</span><span class="keyword">eval</span><span class="normal"> </span><span class="string">"</span><span class="specialchar">\$</span><span class="string">echo </span><span class="specialchar">\"\$</span><span class="string">shlibpath_var=</span><span class="specialchar">\$</span><span class="string">$shlibpath_var</span><span class="specialchar">\"</span><span class="string">"</span>
<span class="normal">	</span><span class="variable">$echo</span><span class="normal"> </span><span class="string">"export $shlibpath_var"</span>
<span class="normal">      </span><span class="keyword">fi</span>
<span class="normal">      </span><span class="variable">$echo</span><span class="normal"> </span><span class="string">"$cmd$args"</span>
<span class="normal">      </span><span class="keyword">exit</span><span class="normal"> </span><span class="variable">$EXIT_SUCCESS</span>
<span class="normal">    </span><span class="keyword">fi</span>
<span class="normal">    </span><span class="symbol">;;</span>

<span class="normal">  </span><span class="comment"># libtool clean and uninstall mode</span>
<span class="normal">  clean </span><span class="symbol">|</span><span class="normal"> uninstall</span><span class="symbol">)</span>
<span class="normal">    </span><span class="variable">modename</span><span class="symbol">=</span><span class="string">"$modename: $mode"</span>
<span class="normal">    </span><span class="variable">rm</span><span class="symbol">=</span><span class="string">"$nonopt"</span>
<span class="normal">    </span><span class="variable">files</span><span class="symbol">=</span>
<span class="normal">    </span><span class="variable">rmforce</span><span class="symbol">=</span>
<span class="normal">    </span><span class="variable">exit_status</span><span class="symbol">=</span><span class="number">0</span>

<span class="normal">    </span><span class="comment"># This variable tells wrapper scripts just to set variables rather</span>
<span class="normal">    </span><span class="comment"># than running their programs.</span>
<span class="normal">    </span><span class="variable">libtool_install_magic</span><span class="symbol">=</span><span class="string">"$magic"</span>

<span class="normal">    </span><span class="keyword">for</span><span class="normal"> arg</span>
<span class="normal">    </span><span class="keyword">do</span>
<span class="normal">      </span><span class="keyword">case</span><span class="normal"> </span><span class="variable">$arg</span><span class="normal"> </span><span class="keyword">in</span>
<span class="normal">      -f</span><span class="symbol">)</span><span class="normal"> </span><span class="variable">rm</span><span class="symbol">=</span><span class="string">"$rm $arg"</span><span class="symbol">;</span><span class="normal"> </span><span class="variable">rmforce</span><span class="symbol">=</span><span class="normal">yes </span><span class="symbol">;;</span>
<span class="normal">      -</span><span class="symbol">*)</span><span class="normal"> </span><span class="variable">rm</span><span class="symbol">=</span><span class="string">"$rm $arg"</span><span class="normal"> </span><span class="symbol">;;</span>
<span class="normal">      </span><span class="symbol">*)</span><span class="normal"> </span><span class="variable">files</span><span class="symbol">=</span><span class="string">"$files $arg"</span><span class="normal"> </span><span class="symbol">;;</span>
<span class="normal">      </span><span class="keyword">esac</span>
<span class="normal">    </span><span class="keyword">done</span>

<span class="normal">    </span><span class="keyword">if</span><span class="normal"> </span><span class="keyword">test</span><span class="normal"> -z </span><span class="string">"$rm"</span><span class="symbol">;</span><span class="normal"> </span><span class="keyword">then</span>
<span class="normal">      </span><span class="variable">$echo</span><span class="normal"> </span><span class="string">"$modename: you must specify an RM program"</span><span class="normal"> </span><span class="number">1</span><span class="symbol">&gt;&amp;</span><span class="number">2</span>
<span class="normal">      </span><span class="variable">$echo</span><span class="normal"> </span><span class="string">"$help"</span><span class="normal"> </span><span class="number">1</span><span class="symbol">&gt;&amp;</span><span class="number">2</span>
<span class="normal">      </span><span class="keyword">exit</span><span class="normal"> </span><span class="variable">$EXIT_FAILURE</span>
<span class="normal">    </span><span class="keyword">fi</span>

<span class="normal">    </span><span class="variable">rmdirs</span><span class="symbol">=</span>

<span class="normal">    </span><span class="variable">origobjdir</span><span class="symbol">=</span><span class="string">"$objdir"</span>
<span class="normal">    </span><span class="keyword">for</span><span class="normal"> file </span><span class="keyword">in</span><span class="normal"> </span><span class="variable">$files</span><span class="symbol">;</span><span class="normal"> </span><span class="keyword">do</span>
<span class="normal">      </span><span class="variable">dir</span><span class="symbol">=</span><span class="normal">`</span><span class="variable">$echo</span><span class="normal"> </span><span class="string">"X$file"</span><span class="normal"> </span><span class="symbol">|</span><span class="normal"> </span><span class="variable">$Xsed</span><span class="normal"> -e </span><span class="string">'s%/[^/]*$%%'</span><span class="normal">`</span>
<span class="normal">      </span><span class="keyword">if</span><span class="normal"> </span><span class="keyword">test</span><span class="normal"> </span><span class="string">"X$dir"</span><span class="normal"> </span><span class="symbol">=</span><span class="normal"> </span><span class="string">"X$file"</span><span class="symbol">;</span><span class="normal"> </span><span class="keyword">then</span>
<span class="normal">	</span><span class="variable">dir</span><span class="symbol">=.</span>
<span class="normal">	</span><span class="variable">objdir</span><span class="symbol">=</span><span class="string">"$origobjdir"</span>
<span class="normal">      </span><span class="keyword">else</span>
<span class="normal">	</span><span class="variable">objdir</span><span class="symbol">=</span><span class="string">"$dir/$origobjdir"</span>
<span class="normal">      </span><span class="keyword">fi</span>
<span class="normal">      </span><span class="variable">name</span><span class="symbol">=</span><span class="normal">`</span><span class="variable">$echo</span><span class="normal"> </span><span class="string">"X$file"</span><span class="normal"> </span><span class="symbol">|</span><span class="normal"> </span><span class="variable">$Xsed</span><span class="normal"> -e </span><span class="string">'s%^.*/%%'</span><span class="normal">`</span>
<span class="normal">      </span><span class="keyword">test</span><span class="normal"> </span><span class="string">"$mode"</span><span class="normal"> </span><span class="symbol">=</span><span class="normal"> uninstall </span><span class="symbol">&amp;&amp;</span><span class="normal"> </span><span class="variable">objdir</span><span class="symbol">=</span><span class="string">"$dir"</span>

<span class="normal">      </span><span class="comment"># Remember objdir for removal later, being careful to avoid duplicates</span>
<span class="normal">      </span><span class="keyword">if</span><span class="normal"> </span><span class="keyword">test</span><span class="normal"> </span><span class="string">"$mode"</span><span class="normal"> </span><span class="symbol">=</span><span class="normal"> clean</span><span class="symbol">;</span><span class="normal"> </span><span class="keyword">then</span>
<span class="normal">	</span><span class="keyword">case</span><span class="normal"> </span><span class="string">" $rmdirs "</span><span class="normal"> </span><span class="keyword">in</span>
<span class="normal">	  </span><span class="symbol">*</span><span class="string">" $objdir "</span><span class="symbol">*)</span><span class="normal"> </span><span class="symbol">;;</span>
<span class="normal">	  </span><span class="symbol">*)</span><span class="normal"> </span><span class="variable">rmdirs</span><span class="symbol">=</span><span class="string">"$rmdirs $objdir"</span><span class="normal"> </span><span class="symbol">;;</span>
<span class="normal">	</span><span class="keyword">esac</span>
<span class="normal">      </span><span class="keyword">fi</span>

<span class="normal">      </span><span class="comment"># Don't error if the file doesn't exist and rm -f was used.</span>
<span class="normal">      </span><span class="keyword">if</span><span class="normal"> </span><span class="symbol">(</span><span class="keyword">test</span><span class="normal"> -L </span><span class="string">"$file"</span><span class="symbol">)</span><span class="normal"> </span><span class="symbol">&gt;</span><span class="normal">/dev/null </span><span class="number">2</span><span class="symbol">&gt;&amp;</span><span class="number">1</span><span class="normal"> </span><span class="symbol">\</span>
<span class="normal">	</span><span class="symbol">||</span><span class="normal"> </span><span class="symbol">(</span><span class="keyword">test</span><span class="normal"> -h </span><span class="string">"$file"</span><span class="symbol">)</span><span class="normal"> </span><span class="symbol">&gt;</span><span class="normal">/dev/null </span><span class="number">2</span><span class="symbol">&gt;&amp;</span><span class="number">1</span><span class="normal"> </span><span class="symbol">\</span>
<span class="normal">	</span><span class="symbol">||</span><span class="normal"> </span><span class="keyword">test</span><span class="normal"> -f </span><span class="string">"$file"</span><span class="symbol">;</span><span class="normal"> </span><span class="keyword">then</span>
<span class="normal">	</span><span class="symbol">:</span>
<span class="normal">      </span><span class="keyword">elif</span><span class="normal"> </span><span class="keyword">test</span><span class="normal"> -d </span><span class="string">"$file"</span><span class="symbol">;</span><span class="normal"> </span><span class="keyword">then</span>
<span class="normal">	</span><span class="variable">exit_status</span><span class="symbol">=</span><span class="number">1</span>
<span class="normal">	</span><span class="keyword">continue</span>
<span class="normal">      </span><span class="keyword">elif</span><span class="normal"> </span><span class="keyword">test</span><span class="normal"> </span><span class="string">"$rmforce"</span><span class="normal"> </span><span class="symbol">=</span><span class="normal"> yes</span><span class="symbol">;</span><span class="normal"> </span><span class="keyword">then</span>
<span class="normal">	</span><span class="keyword">continue</span>
<span class="normal">      </span><span class="keyword">fi</span>

<span class="normal">      </span><span class="variable">rmfiles</span><span class="symbol">=</span><span class="string">"$file"</span>

<span class="normal">      </span><span class="keyword">case</span><span class="normal"> </span><span class="variable">$name</span><span class="normal"> </span><span class="keyword">in</span>
<span class="normal">      </span><span class="symbol">*.</span><span class="normal">la</span><span class="symbol">)</span>
<span class="normal">	</span><span class="comment"># Possibly a libtool archive, so verify it.</span>
<span class="normal">	</span><span class="keyword">if</span><span class="normal"> </span><span class="symbol">(</span><span class="variable">${SED}</span><span class="normal"> -e </span><span class="string">'2q'</span><span class="normal"> </span><span class="variable">$file</span><span class="normal"> </span><span class="symbol">|</span><span class="normal"> grep </span><span class="string">"^# Generated by .*$PACKAGE"</span><span class="symbol">)</span><span class="normal"> </span><span class="symbol">&gt;</span><span class="normal">/dev/null </span><span class="number">2</span><span class="symbol">&gt;&amp;</span><span class="number">1</span><span class="symbol">;</span><span class="normal"> </span><span class="keyword">then</span>
<span class="normal">	  </span><span class="symbol">.</span><span class="normal"> </span><span class="variable">$dir</span><span class="symbol">/</span><span class="variable">$name</span>

<span class="normal">	  </span><span class="comment"># Delete the libtool libraries and symlinks.</span>
<span class="normal">	  </span><span class="keyword">for</span><span class="normal"> n </span><span class="keyword">in</span><span class="normal"> </span><span class="variable">$library_names</span><span class="symbol">;</span><span class="normal"> </span><span class="keyword">do</span>
<span class="normal">	    </span><span class="variable">rmfiles</span><span class="symbol">=</span><span class="string">"$rmfiles $objdir/$n"</span>
<span class="normal">	  </span><span class="keyword">done</span>
<span class="normal">	  </span><span class="keyword">test</span><span class="normal"> -n </span><span class="string">"$old_library"</span><span class="normal"> </span><span class="symbol">&amp;&amp;</span><span class="normal"> </span><span class="variable">rmfiles</span><span class="symbol">=</span><span class="string">"$rmfiles $objdir/$old_library"</span>

<span class="normal">	  </span><span class="keyword">case</span><span class="normal"> </span><span class="string">"$mode"</span><span class="normal"> </span><span class="keyword">in</span>
<span class="normal">	  clean</span><span class="symbol">)</span>
<span class="normal">	    </span><span class="keyword">case</span><span class="normal"> </span><span class="string">"  $library_names "</span><span class="normal"> </span><span class="keyword">in</span>
<span class="normal">	    </span><span class="comment"># "  " in the beginning catches empty $dlname</span>
<span class="normal">	    </span><span class="symbol">*</span><span class="string">" $dlname "</span><span class="symbol">*)</span><span class="normal"> </span><span class="symbol">;;</span>
<span class="normal">	    </span><span class="symbol">*)</span><span class="normal"> </span><span class="variable">rmfiles</span><span class="symbol">=</span><span class="string">"$rmfiles $objdir/$dlname"</span><span class="normal"> </span><span class="symbol">;;</span>
<span class="normal">	    </span><span class="keyword">esac</span>
<span class="normal">	     </span><span class="keyword">test</span><span class="normal"> -n </span><span class="string">"$libdir"</span><span class="normal"> </span><span class="symbol">&amp;&amp;</span><span class="normal"> </span><span class="variable">rmfiles</span><span class="symbol">=</span><span class="string">"$rmfiles $objdir/$name $objdir/${name}i"</span>
<span class="normal">	    </span><span class="symbol">;;</span>
<span class="normal">	  uninstall</span><span class="symbol">)</span>
<span class="normal">	    </span><span class="keyword">if</span><span class="normal"> </span><span class="keyword">test</span><span class="normal"> -n </span><span class="string">"$library_names"</span><span class="symbol">;</span><span class="normal"> </span><span class="keyword">then</span>
<span class="normal">	      </span><span class="comment"># Do each command in the postuninstall commands.</span>
<span class="normal">	      </span><span class="variable">cmds</span><span class="symbol">=</span><span class="variable">$postuninstall_cmds</span>
<span class="normal">	      </span><span class="variable">save_ifs</span><span class="symbol">=</span><span class="string">"$IFS"</span><span class="symbol">;</span><span class="normal"> </span><span class="variable">IFS</span><span class="symbol">=</span><span class="string">'~'</span>
<span class="normal">	      </span><span class="keyword">for</span><span class="normal"> cmd </span><span class="keyword">in</span><span class="normal"> </span><span class="variable">$cmds</span><span class="symbol">;</span><span class="normal"> </span><span class="keyword">do</span>
<span class="normal">		</span><span class="variable">IFS</span><span class="symbol">=</span><span class="string">"$save_ifs"</span>
<span class="normal">		</span><span class="keyword">eval</span><span class="normal"> </span><span class="variable">cmd</span><span class="symbol">=</span><span class="normal">\"</span><span class="variable">$cmd</span><span class="normal">\"</span>
<span class="normal">		</span><span class="variable">$show</span><span class="normal"> </span><span class="string">"$cmd"</span>
<span class="normal">		</span><span class="variable">$run</span><span class="normal"> </span><span class="keyword">eval</span><span class="normal"> </span><span class="string">"$cmd"</span>
<span class="normal">		</span><span class="keyword">if</span><span class="normal"> </span><span class="keyword">test</span><span class="normal"> </span><span class="string">"$?"</span><span class="normal"> -ne </span><span class="number">0</span><span class="normal"> </span><span class="symbol">&amp;&amp;</span><span class="normal"> </span><span class="keyword">test</span><span class="normal"> </span><span class="string">"$rmforce"</span><span class="normal"> </span><span class="symbol">!=</span><span class="normal"> yes</span><span class="symbol">;</span><span class="normal"> </span><span class="keyword">then</span>
<span class="normal">		  </span><span class="variable">exit_status</span><span class="symbol">=</span><span class="number">1</span>
<span class="normal">		</span><span class="keyword">fi</span>
<span class="normal">	      </span><span class="keyword">done</span>
<span class="normal">	      </span><span class="variable">IFS</span><span class="symbol">=</span><span class="string">"$save_ifs"</span>
<span class="normal">	    </span><span class="keyword">fi</span>

<span class="normal">	    </span><span class="keyword">if</span><span class="normal"> </span><span class="keyword">test</span><span class="normal"> -n </span><span class="string">"$old_library"</span><span class="symbol">;</span><span class="normal"> </span><span class="keyword">then</span>
<span class="normal">	      </span><span class="comment"># Do each command in the old_postuninstall commands.</span>
<span class="normal">	      </span><span class="variable">cmds</span><span class="symbol">=</span><span class="variable">$old_postuninstall_cmds</span>
<span class="normal">	      </span><span class="variable">save_ifs</span><span class="symbol">=</span><span class="string">"$IFS"</span><span class="symbol">;</span><span class="normal"> </span><span class="variable">IFS</span><span class="symbol">=</span><span class="string">'~'</span>
<span class="normal">	      </span><span class="keyword">for</span><span class="normal"> cmd </span><span class="keyword">in</span><span class="normal"> </span><span class="variable">$cmds</span><span class="symbol">;</span><span class="normal"> </span><span class="keyword">do</span>
<span class="normal">		</span><span class="variable">IFS</span><span class="symbol">=</span><span class="string">"$save_ifs"</span>
<span class="normal">		</span><span class="keyword">eval</span><span class="normal"> </span><span class="variable">cmd</span><span class="symbol">=</span><span class="normal">\"</span><span class="variable">$cmd</span><span class="normal">\"</span>
<span class="normal">		</span><span class="variable">$show</span><span class="normal"> </span><span class="string">"$cmd"</span>
<span class="normal">		</span><span class="variable">$run</span><span class="normal"> </span><span class="keyword">eval</span><span class="normal"> </span><span class="string">"$cmd"</span>
<span class="normal">		</span><span class="keyword">if</span><span class="normal"> </span><span class="keyword">test</span><span class="normal"> </span><span class="string">"$?"</span><span class="normal"> -ne </span><span class="number">0</span><span class="normal"> </span><span class="symbol">&amp;&amp;</span><span class="normal"> </span><span class="keyword">test</span><span class="normal"> </span><span class="string">"$rmforce"</span><span class="normal"> </span><span class="symbol">!=</span><span class="normal"> yes</span><span class="symbol">;</span><span class="normal"> </span><span class="keyword">then</span>
<span class="normal">		  </span><span class="variable">exit_status</span><span class="symbol">=</span><span class="number">1</span>
<span class="normal">		</span><span class="keyword">fi</span>
<span class="normal">	      </span><span class="keyword">done</span>
<span class="normal">	      </span><span class="variable">IFS</span><span class="symbol">=</span><span class="string">"$save_ifs"</span>
<span class="normal">	    </span><span class="keyword">fi</span>
<span class="normal">	    </span><span class="comment"># FIXME: should reinstall the best remaining shared library.</span>
<span class="normal">	    </span><span class="symbol">;;</span>
<span class="normal">	  </span><span class="keyword">esac</span>
<span class="normal">	</span><span class="keyword">fi</span>
<span class="normal">	</span><span class="symbol">;;</span>

<span class="normal">      </span><span class="symbol">*.</span><span class="normal">lo</span><span class="symbol">)</span>
<span class="normal">	</span><span class="comment"># Possibly a libtool object, so verify it.</span>
<span class="normal">	</span><span class="keyword">if</span><span class="normal"> </span><span class="symbol">(</span><span class="variable">${SED}</span><span class="normal"> -e </span><span class="string">'2q'</span><span class="normal"> </span><span class="variable">$file</span><span class="normal"> </span><span class="symbol">|</span><span class="normal"> grep </span><span class="string">"^# Generated by .*$PACKAGE"</span><span class="symbol">)</span><span class="normal"> </span><span class="symbol">&gt;</span><span class="normal">/dev/null </span><span class="number">2</span><span class="symbol">&gt;&amp;</span><span class="number">1</span><span class="symbol">;</span><span class="normal"> </span><span class="keyword">then</span>

<span class="normal">	  </span><span class="comment"># Read the .lo file</span>
<span class="normal">	  </span><span class="symbol">.</span><span class="normal"> </span><span class="variable">$dir</span><span class="symbol">/</span><span class="variable">$name</span>

<span class="normal">	  </span><span class="comment"># Add PIC object to the list of files to remove.</span>
<span class="normal">	  </span><span class="keyword">if</span><span class="normal"> </span><span class="keyword">test</span><span class="normal"> -n </span><span class="string">"$pic_object"</span><span class="normal"> </span><span class="symbol">\</span>
<span class="normal">	     </span><span class="symbol">&amp;&amp;</span><span class="normal"> </span><span class="keyword">test</span><span class="normal"> </span><span class="string">"$pic_object"</span><span class="normal"> </span><span class="symbol">!=</span><span class="normal"> none</span><span class="symbol">;</span><span class="normal"> </span><span class="keyword">then</span>
<span class="normal">	    </span><span class="variable">rmfiles</span><span class="symbol">=</span><span class="string">"$rmfiles $dir/$pic_object"</span>
<span class="normal">	  </span><span class="keyword">fi</span>

<span class="normal">	  </span><span class="comment"># Add non-PIC object to the list of files to remove.</span>
<span class="normal">	  </span><span class="keyword">if</span><span class="normal"> </span><span class="keyword">test</span><span class="normal"> -n </span><span class="string">"$non_pic_object"</span><span class="normal"> </span><span class="symbol">\</span>
<span class="normal">	     </span><span class="symbol">&amp;&amp;</span><span class="normal"> </span><span class="keyword">test</span><span class="normal"> </span><span class="string">"$non_pic_object"</span><span class="normal"> </span><span class="symbol">!=</span><span class="normal"> none</span><span class="symbol">;</span><span class="normal"> </span><span class="keyword">then</span>
<span class="normal">	    </span><span class="variable">rmfiles</span><span class="symbol">=</span><span class="string">"$rmfiles $dir/$non_pic_object"</span>
<span class="normal">	  </span><span class="keyword">fi</span>
<span class="normal">	</span><span class="keyword">fi</span>
<span class="normal">	</span><span class="symbol">;;</span>

<span class="normal">      </span><span class="symbol">*)</span>
<span class="normal">	</span><span class="keyword">if</span><span class="normal"> </span><span class="keyword">test</span><span class="normal"> </span><span class="string">"$mode"</span><span class="normal"> </span><span class="symbol">=</span><span class="normal"> clean </span><span class="symbol">;</span><span class="normal"> </span><span class="keyword">then</span>
<span class="normal">	  </span><span class="variable">noexename</span><span class="symbol">=</span><span class="variable">$name</span>
<span class="normal">	  </span><span class="keyword">case</span><span class="normal"> </span><span class="variable">$file</span><span class="normal"> </span><span class="keyword">in</span>
<span class="normal">	  </span><span class="symbol">*.</span><span class="normal">exe</span><span class="symbol">)</span>
<span class="normal">	    </span><span class="variable">file</span><span class="symbol">=</span><span class="normal">`</span><span class="variable">$echo</span><span class="normal"> </span><span class="variable">$file</span><span class="symbol">|</span><span class="variable">${SED}</span><span class="normal"> </span><span class="string">'s,.exe$,,'</span><span class="normal">`</span>
<span class="normal">	    </span><span class="variable">noexename</span><span class="symbol">=</span><span class="normal">`</span><span class="variable">$echo</span><span class="normal"> </span><span class="variable">$name</span><span class="symbol">|</span><span class="variable">${SED}</span><span class="normal"> </span><span class="string">'s,.exe$,,'</span><span class="normal">`</span>
<span class="normal">	    </span><span class="comment"># $file with .exe has already been added to rmfiles,</span>
<span class="normal">	    </span><span class="comment"># add $file without .exe</span>
<span class="normal">	    </span><span class="variable">rmfiles</span><span class="symbol">=</span><span class="string">"$rmfiles $file"</span>
<span class="normal">	    </span><span class="symbol">;;</span>
<span class="normal">	  </span><span class="keyword">esac</span>
<span class="normal">	  </span><span class="comment"># Do a test to see if this is a libtool program.</span>
<span class="normal">	  </span><span class="keyword">if</span><span class="normal"> </span><span class="symbol">(</span><span class="variable">${SED}</span><span class="normal"> -e </span><span class="string">'4q'</span><span class="normal"> </span><span class="variable">$file</span><span class="normal"> </span><span class="symbol">|</span><span class="normal"> grep </span><span class="string">"^# Generated by .*$PACKAGE"</span><span class="symbol">)</span><span class="normal"> </span><span class="symbol">&gt;</span><span class="normal">/dev/null </span><span class="number">2</span><span class="symbol">&gt;&amp;</span><span class="number">1</span><span class="symbol">;</span><span class="normal"> </span><span class="keyword">then</span>
<span class="normal">	    </span><span class="variable">relink_command</span><span class="symbol">=</span>
<span class="normal">	    </span><span class="symbol">.</span><span class="normal"> </span><span class="variable">$dir</span><span class="symbol">/</span><span class="variable">$noexename</span>

<span class="normal">	    </span><span class="comment"># note $name still contains .exe if it was in $file originally</span>
<span class="normal">	    </span><span class="comment"># as does the version of $file that was added into $rmfiles</span>
<span class="normal">	    </span><span class="variable">rmfiles</span><span class="symbol">=</span><span class="string">"$rmfiles $objdir/$name $objdir/${name}S.${objext}"</span>
<span class="normal">	    </span><span class="keyword">if</span><span class="normal"> </span><span class="keyword">test</span><span class="normal"> </span><span class="string">"$fast_install"</span><span class="normal"> </span><span class="symbol">=</span><span class="normal"> yes </span><span class="symbol">&amp;&amp;</span><span class="normal"> </span><span class="keyword">test</span><span class="normal"> -n </span><span class="string">"$relink_command"</span><span class="symbol">;</span><span class="normal"> </span><span class="keyword">then</span>
<span class="normal">	      </span><span class="variable">rmfiles</span><span class="symbol">=</span><span class="string">"$rmfiles $objdir/lt-$name"</span>
<span class="normal">	    </span><span class="keyword">fi</span>
<span class="normal">	    </span><span class="keyword">if</span><span class="normal"> </span><span class="keyword">test</span><span class="normal"> </span><span class="string">"X$noexename"</span><span class="normal"> </span><span class="symbol">!=</span><span class="normal"> </span><span class="string">"X$name"</span><span class="normal"> </span><span class="symbol">;</span><span class="normal"> </span><span class="keyword">then</span>
<span class="normal">	      </span><span class="variable">rmfiles</span><span class="symbol">=</span><span class="string">"$rmfiles $objdir/lt-${noexename}.c"</span>
<span class="normal">	    </span><span class="keyword">fi</span>
<span class="normal">	  </span><span class="keyword">fi</span>
<span class="normal">	</span><span class="keyword">fi</span>
<span class="normal">	</span><span class="symbol">;;</span>
<span class="normal">      </span><span class="keyword">esac</span>
<span class="normal">      </span><span class="variable">$show</span><span class="normal"> </span><span class="string">"$rm $rmfiles"</span>
<span class="normal">      </span><span class="variable">$run</span><span class="normal"> </span><span class="variable">$rm</span><span class="normal"> </span><span class="variable">$rmfiles</span><span class="normal"> </span><span class="symbol">||</span><span class="normal"> </span><span class="variable">exit_status</span><span class="symbol">=</span><span class="number">1</span>
<span class="normal">    </span><span class="keyword">done</span>
<span class="normal">    </span><span class="variable">objdir</span><span class="symbol">=</span><span class="string">"$origobjdir"</span>

<span class="normal">    </span><span class="comment"># Try to remove the ${objdir}s in the directories where we deleted files</span>
<span class="normal">    </span><span class="keyword">for</span><span class="normal"> dir </span><span class="keyword">in</span><span class="normal"> </span><span class="variable">$rmdirs</span><span class="symbol">;</span><span class="normal"> </span><span class="keyword">do</span>
<span class="normal">      </span><span class="keyword">if</span><span class="normal"> </span><span class="keyword">test</span><span class="normal"> -d </span><span class="string">"$dir"</span><span class="symbol">;</span><span class="normal"> </span><span class="keyword">then</span>
<span class="normal">	</span><span class="variable">$show</span><span class="normal"> </span><span class="string">"rmdir $dir"</span>
<span class="normal">	</span><span class="variable">$run</span><span class="normal"> rmdir </span><span class="variable">$dir</span><span class="normal"> </span><span class="symbol">&gt;</span><span class="normal">/dev/null </span><span class="number">2</span><span class="symbol">&gt;&amp;</span><span class="number">1</span>
<span class="normal">      </span><span class="keyword">fi</span>
<span class="normal">    </span><span class="keyword">done</span>

<span class="normal">    </span><span class="keyword">exit</span><span class="normal"> </span><span class="variable">$exit_status</span>
<span class="normal">    </span><span class="symbol">;;</span>

<span class="normal">  </span><span class="string">""</span><span class="symbol">)</span>
<span class="normal">    </span><span class="variable">$echo</span><span class="normal"> </span><span class="string">"$modename: you must specify a MODE"</span><span class="normal"> </span><span class="number">1</span><span class="symbol">&gt;&amp;</span><span class="number">2</span>
<span class="normal">    </span><span class="variable">$echo</span><span class="normal"> </span><span class="string">"$generic_help"</span><span class="normal"> </span><span class="number">1</span><span class="symbol">&gt;&amp;</span><span class="number">2</span>
<span class="normal">    </span><span class="keyword">exit</span><span class="normal"> </span><span class="variable">$EXIT_FAILURE</span>
<span class="normal">    </span><span class="symbol">;;</span>
<span class="normal">  </span><span class="keyword">esac</span>

<span class="normal">  </span><span class="keyword">if</span><span class="normal"> </span><span class="keyword">test</span><span class="normal"> -z </span><span class="string">"$exec_cmd"</span><span class="symbol">;</span><span class="normal"> </span><span class="keyword">then</span>
<span class="normal">    </span><span class="variable">$echo</span><span class="normal"> </span><span class="string">"$modename: invalid operation mode </span><span class="specialchar">\`</span><span class="string">$mode'"</span><span class="normal"> </span><span class="number">1</span><span class="symbol">&gt;&amp;</span><span class="number">2</span>
<span class="normal">    </span><span class="variable">$echo</span><span class="normal"> </span><span class="string">"$generic_help"</span><span class="normal"> </span><span class="number">1</span><span class="symbol">&gt;&amp;</span><span class="number">2</span>
<span class="normal">    </span><span class="keyword">exit</span><span class="normal"> </span><span class="variable">$EXIT_FAILURE</span>
<span class="normal">  </span><span class="keyword">fi</span>
<span class="keyword">fi</span><span class="normal"> </span><span class="comment"># test -z "$show_help"</span>

<span class="keyword">if</span><span class="normal"> </span><span class="keyword">test</span><span class="normal"> -n </span><span class="string">"$exec_cmd"</span><span class="symbol">;</span><span class="normal"> </span><span class="keyword">then</span>
<span class="normal">  </span><span class="keyword">eval</span><span class="normal"> </span><span class="keyword">exec</span><span class="normal"> </span><span class="variable">$exec_cmd</span>
<span class="normal">  </span><span class="keyword">exit</span><span class="normal"> </span><span class="variable">$EXIT_FAILURE</span>
<span class="keyword">fi</span>

<span class="comment"># We need to display help for each of the modes.</span>
<span class="keyword">case</span><span class="normal"> </span><span class="variable">$mode</span><span class="normal"> </span><span class="keyword">in</span>
<span class="string">""</span><span class="symbol">)</span><span class="normal"> </span><span class="variable">$echo</span><span class="normal"> </span><span class="symbol">\</span>
<span class="string">"Usage: $modename [OPTION]... [MODE-ARG]...</span>

<span class="string">Provide generalized library-building support services.</span>

<span class="string">    --config          show all configuration variables</span>
<span class="string">    --debug           enable verbose shell tracing</span>
<span class="string">-n, --dry-run         display commands without modifying any files</span>
<span class="string">    --features        display basic configuration information and exit</span>
<span class="string">    --finish          same as </span><span class="specialchar">\`</span><span class="string">--mode=finish'</span>
<span class="string">    --help            display this help message and exit</span>
<span class="string">    --mode=MODE       use operation mode MODE [default=inferred from MODE-ARGS]</span>
<span class="string">    --quiet           same as </span><span class="specialchar">\`</span><span class="string">--silent'</span>
<span class="string">    --silent          don't print informational messages</span>
<span class="string">    --tag=TAG         use configuration variables from tag TAG</span>
<span class="string">    --version         print version information</span>

<span class="string">MODE must be one of the following:</span>

<span class="string">      clean           remove files from the build directory</span>
<span class="string">      compile         compile a source file into a libtool object</span>
<span class="string">      execute         automatically set library path, then run a program</span>
<span class="string">      finish          complete the installation of libtool libraries</span>
<span class="string">      install         install libraries or executables</span>
<span class="string">      link            create a library or an executable</span>
<span class="string">      uninstall       remove libraries from an installed directory</span>

<span class="string">MODE-ARGS vary depending on the MODE.  Try </span><span class="specialchar">\`</span><span class="string">$modename --help --mode=MODE' for</span>
<span class="string">a more detailed description of MODE.</span>

<span class="string">Report bugs to &lt;bug-libtool@gnu.org&gt;."</span>
<span class="normal">  </span><span class="keyword">exit</span><span class="normal"> </span><span class="variable">$EXIT_SUCCESS</span>
<span class="normal">  </span><span class="symbol">;;</span>

<span class="normal">clean</span><span class="symbol">)</span>
<span class="normal">  </span><span class="variable">$echo</span><span class="normal"> </span><span class="symbol">\</span>
<span class="string">"Usage: $modename [OPTION]... --mode=clean RM [RM-OPTION]... FILE...</span>

<span class="string">Remove files from the build directory.</span>

<span class="string">RM is the name of the program to use to delete files associated with each FILE</span>
<span class="string">(typically </span><span class="specialchar">\`</span><span class="string">/bin/rm').  RM-OPTIONS are options (such as </span><span class="specialchar">\`</span><span class="string">-f') to be passed</span>
<span class="string">to RM.</span>

<span class="string">If FILE is a libtool library, object or program, all the files associated</span>
<span class="string">with it are deleted. Otherwise, only FILE itself is deleted using RM."</span>
<span class="normal">  </span><span class="symbol">;;</span>

<span class="normal">compile</span><span class="symbol">)</span>
<span class="normal">  </span><span class="variable">$echo</span><span class="normal"> </span><span class="symbol">\</span>
<span class="string">"Usage: $modename [OPTION]... --mode=compile COMPILE-COMMAND... SOURCEFILE</span>

<span class="string">Compile a source file into a libtool library object.</span>

<span class="string">This mode accepts the following additional options:</span>

<span class="string">  -o OUTPUT-FILE    set the output file name to OUTPUT-FILE</span>
<span class="string">  -prefer-pic       try to building PIC objects only</span>
<span class="string">  -prefer-non-pic   try to building non-PIC objects only</span>
<span class="string">  -static           always build a </span><span class="specialchar">\`</span><span class="string">.o' file suitable for static linking</span>

<span class="string">COMPILE-COMMAND is a command to be used in creating a </span><span class="specialchar">\`</span><span class="string">standard' object file</span>
<span class="string">from the given SOURCEFILE.</span>

<span class="string">The output file name is determined by removing the directory component from</span>
<span class="string">SOURCEFILE, then substituting the C source code suffix </span><span class="specialchar">\`</span><span class="string">.c' with the</span>
<span class="string">library object suffix, </span><span class="specialchar">\`</span><span class="string">.lo'."</span>
<span class="normal">  </span><span class="symbol">;;</span>

<span class="normal">execute</span><span class="symbol">)</span>
<span class="normal">  </span><span class="variable">$echo</span><span class="normal"> </span><span class="symbol">\</span>
<span class="string">"Usage: $modename [OPTION]... --mode=execute COMMAND [ARGS]...</span>

<span class="string">Automatically set library path, then run a program.</span>

<span class="string">This mode accepts the following additional options:</span>

<span class="string">  -dlopen FILE      add the directory containing FILE to the library path</span>

<span class="string">This mode sets the library path environment variable according to </span><span class="specialchar">\`</span><span class="string">-dlopen'</span>
<span class="string">flags.</span>

<span class="string">If any of the ARGS are libtool executable wrappers, then they are translated</span>
<span class="string">into their corresponding uninstalled binary, and any of their required library</span>
<span class="string">directories are added to the library path.</span>

<span class="string">Then, COMMAND is executed, with ARGS as arguments."</span>
<span class="normal">  </span><span class="symbol">;;</span>

<span class="normal">finish</span><span class="symbol">)</span>
<span class="normal">  </span><span class="variable">$echo</span><span class="normal"> </span><span class="symbol">\</span>
<span class="string">"Usage: $modename [OPTION]... --mode=finish [LIBDIR]...</span>

<span class="string">Complete the installation of libtool libraries.</span>

<span class="string">Each LIBDIR is a directory that contains libtool libraries.</span>

<span class="string">The commands that this mode executes may require superuser privileges.  Use</span>
<span class="string">the </span><span class="specialchar">\`</span><span class="string">--dry-run' option if you just want to see what would be executed."</span>
<span class="normal">  </span><span class="symbol">;;</span>

<span class="normal">install</span><span class="symbol">)</span>
<span class="normal">  </span><span class="variable">$echo</span><span class="normal"> </span><span class="symbol">\</span>
<span class="string">"Usage: $modename [OPTION]... --mode=install INSTALL-COMMAND...</span>

<span class="string">Install executables or libraries.</span>

<span class="string">INSTALL-COMMAND is the installation command.  The first component should be</span>
<span class="string">either the </span><span class="specialchar">\`</span><span class="string">install' or </span><span class="specialchar">\`</span><span class="string">cp' program.</span>

<span class="string">The rest of the components are interpreted as arguments to that command (only</span>
<span class="string">BSD-compatible install options are recognized)."</span>
<span class="normal">  </span><span class="symbol">;;</span>

<span class="normal">link</span><span class="symbol">)</span>
<span class="normal">  </span><span class="variable">$echo</span><span class="normal"> </span><span class="symbol">\</span>
<span class="string">"Usage: $modename [OPTION]... --mode=link LINK-COMMAND...</span>

<span class="string">Link object files or libraries together to form another library, or to</span>
<span class="string">create an executable program.</span>

<span class="string">LINK-COMMAND is a command using the C compiler that you would use to create</span>
<span class="string">a program from several object files.</span>

<span class="string">The following components of LINK-COMMAND are treated specially:</span>

<span class="string">  -all-static       do not do any dynamic linking at all</span>
<span class="string">  -avoid-version    do not add a version suffix if possible</span>
<span class="string">  -dlopen FILE      </span><span class="specialchar">\`</span><span class="string">-dlpreopen' FILE if it cannot be dlopened at runtime</span>
<span class="string">  -dlpreopen FILE   link in FILE and add its symbols to lt_preloaded_symbols</span>
<span class="string">  -export-dynamic   allow symbols from OUTPUT-FILE to be resolved with dlsym(3)</span>
<span class="string">  -export-symbols SYMFILE</span>
<span class="string">                    try to export only the symbols listed in SYMFILE</span>
<span class="string">  -export-symbols-regex REGEX</span>
<span class="string">                    try to export only the symbols matching REGEX</span>
<span class="string">  -LLIBDIR          search LIBDIR for required installed libraries</span>
<span class="string">  -lNAME            OUTPUT-FILE requires the installed library libNAME</span>
<span class="string">  -module           build a library that can dlopened</span>
<span class="string">  -no-fast-install  disable the fast-install mode</span>
<span class="string">  -no-install       link a not-installable executable</span>
<span class="string">  -no-undefined     declare that a library does not refer to external symbols</span>
<span class="string">  -o OUTPUT-FILE    create OUTPUT-FILE from the specified objects</span>
<span class="string">  -objectlist FILE  Use a list of object files found in FILE to specify objects</span>
<span class="string">  -precious-files-regex REGEX</span>
<span class="string">                    don't remove output files matching REGEX</span>
<span class="string">  -release RELEASE  specify package release information</span>
<span class="string">  -rpath LIBDIR     the created library will eventually be installed in LIBDIR</span>
<span class="string">  -R[ ]LIBDIR       add LIBDIR to the runtime path of programs and libraries</span>
<span class="string">  -static           do not do any dynamic linking of uninstalled libtool libraries</span>
<span class="string">  -static-libtool-libs</span>
<span class="string">                    do not do any dynamic linking of libtool libraries</span>
<span class="string">  -version-info CURRENT[:REVISION[:AGE]]</span>
<span class="string">                    specify library version info [each variable defaults to 0]</span>

<span class="string">All other options (arguments beginning with </span><span class="specialchar">\`</span><span class="string">-') are ignored.</span>

<span class="string">Every other argument is treated as a filename.  Files ending in </span><span class="specialchar">\`</span><span class="string">.la' are</span>
<span class="string">treated as uninstalled libtool libraries, other files are standard or library</span>
<span class="string">object files.</span>

<span class="string">If the OUTPUT-FILE ends in </span><span class="specialchar">\`</span><span class="string">.la', then a libtool library is created,</span>
<span class="string">only library objects (</span><span class="specialchar">\`</span><span class="string">.lo' files) may be specified, and </span><span class="specialchar">\`</span><span class="string">-rpath' is</span>
<span class="string">required, except when creating a convenience library.</span>

<span class="string">If OUTPUT-FILE ends in </span><span class="specialchar">\`</span><span class="string">.a' or </span><span class="specialchar">\`</span><span class="string">.lib', then a standard library is created</span>
<span class="string">using </span><span class="specialchar">\`</span><span class="string">ar' and </span><span class="specialchar">\`</span><span class="string">ranlib', or on Windows using </span><span class="specialchar">\`</span><span class="string">lib'.</span>

<span class="string">If OUTPUT-FILE ends in </span><span class="specialchar">\`</span><span class="string">.lo' or </span><span class="specialchar">\`</span><span class="string">.${objext}', then a reloadable object file</span>
<span class="string">is created, otherwise an executable program is created."</span>
<span class="normal">  </span><span class="symbol">;;</span>

<span class="normal">uninstall</span><span class="symbol">)</span>
<span class="normal">  </span><span class="variable">$echo</span><span class="normal"> </span><span class="symbol">\</span>
<span class="string">"Usage: $modename [OPTION]... --mode=uninstall RM [RM-OPTION]... FILE...</span>

<span class="string">Remove libraries from an installation directory.</span>

<span class="string">RM is the name of the program to use to delete files associated with each FILE</span>
<span class="string">(typically </span><span class="specialchar">\`</span><span class="string">/bin/rm').  RM-OPTIONS are options (such as </span><span class="specialchar">\`</span><span class="string">-f') to be passed</span>
<span class="string">to RM.</span>

<span class="string">If FILE is a libtool library, all the files associated with it are deleted.</span>
<span class="string">Otherwise, only FILE itself is deleted using RM."</span>
<span class="normal">  </span><span class="symbol">;;</span>

<span class="symbol">*)</span>
<span class="normal">  </span><span class="variable">$echo</span><span class="normal"> </span><span class="string">"$modename: invalid operation mode </span><span class="specialchar">\`</span><span class="string">$mode'"</span><span class="normal"> </span><span class="number">1</span><span class="symbol">&gt;&amp;</span><span class="number">2</span>
<span class="normal">  </span><span class="variable">$echo</span><span class="normal"> </span><span class="string">"$help"</span><span class="normal"> </span><span class="number">1</span><span class="symbol">&gt;&amp;</span><span class="number">2</span>
<span class="normal">  </span><span class="keyword">exit</span><span class="normal"> </span><span class="variable">$EXIT_FAILURE</span>
<span class="normal">  </span><span class="symbol">;;</span>
<span class="keyword">esac</span>

<span class="variable">$echo</span>
<span class="variable">$echo</span><span class="normal"> </span><span class="string">"Try </span><span class="specialchar">\`</span><span class="string">$modename --help' for more information about other modes."</span>

<span class="keyword">exit</span><span class="normal"> </span><span class="variable">$?</span>

<span class="comment"># The TAGs below are defined such that we never get into a situation</span>
<span class="comment"># in which we disable both kinds of libraries.  Given conflicting</span>
<span class="comment"># choices, we go for a static library, that is the most portable,</span>
<span class="comment"># since we can't tell whether shared libraries were disabled because</span>
<span class="comment"># the user asked for that or because the platform doesn't support</span>
<span class="comment"># them.  This is particularly important on AIX, because we don't</span>
<span class="comment"># support having both static and shared libraries enabled at the same</span>
<span class="comment"># time on that platform, so we default to a shared-only configuration.</span>
<span class="comment"># If a disable-shared tag is given, we'll fallback to a static-only</span>
<span class="comment"># configuration.  But we'll never go from static-only to shared-only.</span>

<span class="comment"># ### BEGIN LIBTOOL TAG CONFIG: disable-shared</span>
<span class="variable">disable_libs</span><span class="symbol">=</span><span class="normal">shared</span>
<span class="comment"># ### END LIBTOOL TAG CONFIG: disable-shared</span>

<span class="comment"># ### BEGIN LIBTOOL TAG CONFIG: disable-static</span>
<span class="variable">disable_libs</span><span class="symbol">=</span><span class="normal">static</span>
<span class="comment"># ### END LIBTOOL TAG CONFIG: disable-static</span>

<span class="comment"># Local Variables:</span>
<span class="comment"># mode:shell-script</span>
<span class="comment"># sh-indentation:2</span>
<span class="comment"># End:</span>
</tt></pre></div><div style="text-align: right; padding: 8pt; font-size: 12px"><a href="/xmlfeed/weblog-rss20.xml"><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAFAAAAAPAgMAAAAOp6AcAAAADFBMVEVmZmb/ZgD///+JjnlbTUWmAAAACXBIWXMAAABIAAAASABGyWs+AAAACXZwQWcAAABQAAAADwCexKkxAAAAWUlEQVQYlWNgwAa0VmGAFQyqoSCQ/x8J/CBFMCt0ZdTU/F/7/+1HEkydFpoKVPn+93sUlUujQvP/7UcRTAuNDJ2a//s/imDqtKVZofm/1qGYSZk7sfodGwAAiobBJtffoNAAAAAASUVORK5CYII=" alt="RSS 2.0 Weblog Feed" width="80" height="15"/></a> <a href="/xmlfeed/weblog-atom10.xml"><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAFAAAAAPAgMAAAAOp6AcAAAADFBMVEVmZmb/ZgD///+JjnlbTUWmAAAAaklEQVQYlWNgwAa0VmGAFQyqoSCQ/x8J/CBFMDV16rTQ/H/7V//69+//v/3/9oMEI6cuAwr+fv/+/b5d///v//0eJBgWOhMo+Gs9UPAdXDBy6lSYyn9wQZCZS0GCYDPXQcykzJ1Y/Y4NAABKvL80wyoMPgAAAABJRU5ErkJggg==" alt="Atom 1.0 Weblog Feed" width="80" height="15"/></a> <a href="http://validator.w3.org/check?uri=referer"><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAFAAAAAPCAMAAABEF7i9AAAB1FBMVEUHQIgIRY0MN4QNRYoSRYsXUpIYVJQeUpUhWpgjUJMjWpgmU5QnXJkuYZ0uYpwwV5YyZJ4zaKM3ZaA5aaI6aqM6a6E8ZqA8Z6BAbaRBbqdCbaVHd61KSkpKcaZQUFBUf69UgbBVVVVXfq9Yg7NZhbJZh7RagrNeXVxeh7RfjLdgYGBiiLZmZmZnZ2doirhpkbt0m8F3m8B3ncJ5lb55ocR+ocSDgX+Do8eEpMqGhoaHp8iIpMeJjnmJpseKqMeOqsqPsdCQrcyVlZWVsM2Zs9CZtNCfu9ahoaGhuNShudSivNSjtMWjvNSmpqWnpqSrw9qvxNqyxdmyxdyzsK6zs7Ozx9y0xt21yN22tra4y+K80eK/v7/AwMDExMTEy9DH2ejK2+jM2ujN3uvP0dLR0NDR3uvS3uvS3+zU4u3V1dXY2dnY4u7Y4+3b5e/d3d3d5u/d5/De3t7f39/h4uLj4uHj6/Ll7PXm7fTn7/Xo7/Tp7/bq7Ozr6unr8ffw8PDw9vvx9fny+P7z8/Pz9vnz9vv3+fv4+vz5+vz6+vr6+/36/P36///7+/77/Pz7/f37/f78/Pz8/f38/f79/f39/f79/f/9/v79///+/v7+/v////3///+tYR2LAAABKklEQVQ4y2PQoTJg0JlNVYDPQBsyAMTAqaFes8tdsmdPCtA3MDStr3GKKK6myMAprgJ9pcpWs/MlRExYJBvNZLR0sigycHYOV1S7mtjsQJ4gf+HIFPXoWMs6qIGzIRiKZs9GFoEaMRuZhhrYqqJXy8uZYauRxC/VHew7e3YTPAxnI5swG6JxNrKBNjB1EFmIgV0+HA6C8pqqzhXG7BbJJROQIwViMYQ7G2oDQQNn57JyG7kxiCfObrBmS5+BHMuYLkTzMnYDm5WY4lOZZRPKZocxes+aPbuwCFsYohiICLvZsKBAMrDTQ7K/StveU8icTzrOL8JdLpOyWJ49u8Bx9ozw8DY7UYW03hhdxZAOSg2c3jN79rSJs1vSKmfOnpFXNJmynELlvExlAADnaZpLFGEC2wAAAABJRU5ErkJggg==" alt="Valid XHTML 1.1" width="80" height="15"/></a> <a href="http://jigsaw.w3.org/css-validator/check/referer"><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAFAAAAAPCAMAAABEF7i9AAAB1FBMVEUHQIgIRY0MN4QNRYoSRYsXUpIYVJQeUpUhWpgjUJMjWpgmU5QnXJkuYZ0uYpwwV5YyZJ4zaKM3ZaA5aaI6aqM6a6E8ZqA8Z6BAbaRBbqdCbaVHd61KSkpKcaZQUFBUf69UgbBVVVVXfq9Yg7NZhbJZh7RagrNeXVxeh7RfjLdgYGBiiLZmZmZnZ2doirhpkbt0m8F3m8B3ncJ5lb55ocR+ocSDgX+Do8eEpMqGhoaHp8iIpMeJjnmJpseKqMeOqsqPsdCQrcyVlZWVsM2Zs9CZtNCfu9ahoaGhuNShudSivNSjtMWjvNSmpqWnpqSrw9qvxNqyxdmyxdyzsK6zs7Ozx9y0xt21yN22tra4y+K80eK/v7/AwMDExMTEy9DH2ejK2+jM2ujN3uvP0dLR0NDR3uvS3uvS3+zU4u3V1dXY2dnY4u7Y4+3b5e/d3d3d5u/d5/De3t7f39/h4uLj4uHj6/Ll7PXm7fTn7/Xo7/Tp7/bq7Ozr6unr8ffw8PDw9vvx9fny+P7z8/Pz9vnz9vv3+fv4+vz5+vz6+vr6+/36/P36///7+/77/Pz7/f37/f78/Pz8/f38/f79/f39/f79/f/9/v79///+/v7+/v////3///+tYR2LAAABEUlEQVQ4y2PQoTJg0JlNVYDPQBsyAMTAqaFes8tdsmdPCtA3MDStr3GKKK6myMAprgJ9pcpWs/MlRExYJBvNZLR0sigycHYOV1S7mtjsQJ4gf+HIFPXoWMs6mIEQCsIjwhKoga0qerW8nBm2Gkn8Ut3BvrNnN8HCcDYM2cBIogzs8uFwEJTXVHWuMGa3SC6ZgIgUqCEwdxJr4OxcVm4jNwbxxNkN1mzpM2ajGIjsPGK9PLtZiSk+lVk2oWx2GKP3rNmzC4tQwpDoIIQb2Okh2V+lbe8pZM4nHecX4S6XSVksz55d4Dh7Rnh4m52oQlpvjK5iSAelBk7vmT172sTZLWmVM2fPyCuaTFlOoXJepjIAANlljDGY/l5pAAAAAElFTkSuQmCC" alt="Valid CSS (2.1)" width="80" height="15"/></a><br/>Copyright 2005-2017 <a href="/about/">Timo Bingmann</a> - <a href="/about/impressum.html">Impressum</a></div><script type="text/javascript">var _paq = _paq || []; _paq.push(["trackPageView"]); _paq.push(["enableLinkTracking"]);(function() {var u=(("https:" == document.location.protocol) ? "https" : "http") + "://panthema.net/wik-331/"; _paq.push(["setTrackerUrl", u+"js/"]); _paq.push(["setSiteId", "2"]);var d=document, g=d.createElement("script"), s=d.getElementsByTagName("script")[0]; g.type="text/javascript";g.defer=true; g.async=true; g.src=u+"js/"; s.parentNode.insertBefore(g,s);})();</script><noscript><p><img src="http://panthema.net/wik-331/js/?idsite=2&amp;rec=1" style="border:0" alt="" /></p></noscript></body></html>