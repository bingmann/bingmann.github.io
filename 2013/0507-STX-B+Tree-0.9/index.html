<?xml version="1.0" encoding="iso-8859-1"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta content="text/html; charset=iso-8859-1" http-equiv="content-type" /><title>Publishing STX B+ Tree 0.9 - Speed Gains over 0.8.6 - panthema.net</title><link rel="stylesheet" type="text/css" href="/css/base.css" /><link rel="alternate" type="application/rss+xml" title="panthema.net Weblog Feed RSS 2.0" href="http://panthema.net/xmlfeed/weblog-rss20.xml" /><link rel="alternate" type="application/atom+xml" title="panthema.net Weblog Feed Atom 1.0" href="http://panthema.net/xmlfeed/weblog-atom10.xml" /><script type="text/javascript" src="/pt.js"></script><script type="text/javascript">/* <!-- */makeIEHover = function() {var lis = document.getElementById('ptnav').getElementsByTagName('li');for (var i = 0; i < lis.length; i++) {lis[i].onmouseover = function() {this.className += ' sfhover';};lis[i].onmouseout = function() {this.className = this.className.replace(new RegExp(' sfhover\b'), '');};}};if (window.attachEvent) window.attachEvent('onload', makeIEHover);/* --> */</script></head><body style="background-image: url(/img/bgfractal2.jpg)"><div class="pttopbar"><div style="float: right"><ul id="ptnav"><li class="top"><a class="ni" href="/">Weblog</a><ul style="margin-left: -6px; margin-top: 4px" class="nx"><li><a href="/2013/">2013</a></li><li><a href="/2012/">2012</a></li><li><a href="/2011/">2011</a></li><li><a href="/2010/">2010</a></li><li><a href="/2009/">2009</a></li><li><a href="/2008/">2008</a></li><li><a href="/2007/">2007</a></li><li><a href="/2006/">2006</a></li><li class="nt"><a href="/2005/">2005</a></li><li class="ns"><a href="/xmlfeed/weblog-rss20.xml">RSS Feed</a></li><li><a href="/xmlfeed/weblog-atom10.xml">XML Atom</a></li></ul></li><li class="top"><a class="ni" href="/tags/">Tags</a><div style="width: 14em; margin-left: -9em; margin-top: 4px"><a style="font-size: 10pt" href="/tags/algebra.html">algebra</a> <a style="font-size: 16pt" href="/tags/c++.html">c++</a> <a style="font-size: 12pt" href="/tags/code-example.html">code-example</a> <a style="font-size: 14pt" href="/tags/code-snippet.html">code-snippet</a> <a style="font-size: 11pt" href="/tags/coding_tricks.html">coding tricks</a> <a style="font-size: 10pt" href="/tags/compsci.html">compsci</a> <a style="font-size: 10pt" href="/tags/compsci_study_thesis.html">compsci study thesis</a> <a style="font-size: 9pt" href="/tags/crypto-speedtest.html">crypto-speedtest</a> <a style="font-size: 10pt" href="/tags/cryptography.html">cryptography</a> <a style="font-size: 9pt" href="/tags/cryptote.html">cryptote</a> <a style="font-size: 12pt" href="/tags/flex-bison-cpp-example.html">flex-bison-cpp-example</a> <a style="font-size: 12pt" href="/tags/fun.html">fun</a> <a style="font-size: 10pt" href="/tags/graphviz.html">graphviz</a> <a style="font-size: 9pt" href="http://www.hmtg.de">hartmetall</a> <a style="font-size: 9pt" href="/tags/helppc.html">helppc</a> <a style="font-size: 9pt" href="/tags/hifi_selbstbau.html">hifi selbstbau</a> <a style="font-size: 10pt" href="/tags/latex.html">latex</a> <a style="font-size: 10pt" href="/tags/librivox.html">librivox</a> <a style="font-size: 10pt" href="/tags/linux.html">linux</a> <a style="font-size: 10pt" href="/tags/maths.html">maths</a> <a style="font-size: 9pt" href="/tags/music.html">music</a> <a style="font-size: 10pt" href="/tags/netfundamentals.html">netfundamentals</a> <a style="font-size: 11pt" href="/tags/ns-3.html">ns-3</a> <a style="font-size: 9pt" href="/tags/parallel-string-sorting.html">parallel-string-sorting</a> <a style="font-size: 9pt" href="/tags/qtsqlview.html">qtsqlview</a> <a style="font-size: 10pt" href="/tags/research.html">research</a> <a style="font-size: 11pt" href="/tags/sdios06.html">sdios06</a> <a style="font-size: 9pt" href="/tags/sdlfractal.html">sdlfractal</a> <a style="font-size: 10pt" href="/tags/sorting.html">sorting</a> <a style="font-size: 10pt" href="/tags/stringology.html">stringology</a> <a style="font-size: 16pt" href="/tags/stx-btree.html">stx-btree</a> <a style="font-size: 9pt" href="/tags/stx-exparser.html">stx-exparser</a> <a style="font-size: 15pt" href="/tags/talk.html">talk</a> <a style="font-size: 10pt" href="/tags/tutorium.html">tutorium</a> <a style="font-size: 16pt" href="/tags/university.html">university</a> <a style="font-size: 13pt" href="/tags/utilities.html">utilities</a> <a style="font-size: 9pt" href="/tags/webdesign.html">webdesign</a> </div></li><li class="top"><a class="ni" href="#">Projects</a> <ul style="margin-left: -8em; margin-top: 4px" class="nx"> <li><a href="/2009/cryptote/">CryptoTE</a></li> <li><a href="/2009/digup/">digup</a></li> <li><a href="/2013/disk-filltest/">disk-filltest</a></li> <li><a href="/2012/1119-eSAIS-Inducing-Suffix-and-LCP-Arrays-in-External-Memory/">eSAIS-LCP</a></li> <li><a href="/2007/flex-bison-cpp-example/">Flex Bison C++ Example</a></li> <li><a href="/2013/malloc_count/">malloc_count</a></li> <li><a href="/2013/parallel-string-sorting/">parallel-string-sorting</a></li> <li><a href="/2013/pmbw/">Parallel Memory Bandwidth</a></li> <li><a href="/2013/sound-of-sorting/">The Sound of Sorting</a></li> <li><a href="/2007/stx-btree/">STX B+ Tree</a></li> <li><a href="/2010/stx-cbtreedb/">STX Constant BTreeDB</a></li> <li><a href="/2010/stx-execpipe/">STX ExecPipe</a></li> <li class="nt"><a href="/2007/stx-exparser/">STX Expression Parser</a></li> <li class="ns"><a href="/search.html">Search</a></li> </ul></li><li class="top"><a class="ni" href="/about/timo.html">About Me</a></li></ul></div><div style="padding: 6px"><a href="/">panthema</a>  / <a href="/2013/">2013</a> / <a href="/2013/0507-STX-B+Tree-0.9/">0507-STX-B+Tree-0.9</a></div></div><div class="ptcontent"><h1><span style="float: right; margin: 0em 0em 1.5em 1.5em; font-size: 10pt; text-align: center"><a href="/2007/stx-btree/"><img src="/2007/stx-btree/btree-thumb-border.png" width="252" height="193" alt="Small drawing of a B+ tree" title="Small drawing of a B+ tree" /></a></span>Publishing STX B+ Tree 0.9 - Speed Gains over 0.8.6</h1><p class="info">Posted on 2013-05-07 21:16 by <a href="/about/timo.html">Timo</a> at <a href="/2013/0507-STX-B+Tree-0.9/">Permlink</a> with <a href="/2013/0507-STX-B+Tree-0.9/#notes">0 Comments</a>. Tags: <a href="/tags/stx-btree.html">stx-btree</a> </p><div class="textcontent"><p>This blog post announces the new version 0.9 of my popular <a href="/2007/stx-btree">STX B+ Tree</a> library of C++ templates, speedtests and demos. Since the last release in 2011, many patches and new ideas have accumulated. Here a summary of the most prominent changes:</p><ul><li>Changed the <code>find_lower()</code> function, which is central to finding keys or insertion points to not use binary search for small node sizes. The reasoning behind this change is discussed in <a href="/2013/0504-STX-B+Tree-Binary-vs-Linear-Search/">another blog post</a>.</li><li>Added a <code>bulk_load()</code> to all <code>map</code> and <code>set</code> variants to construct a B+ tree from a pre-sorted iterator range. The sorted range is first copied into leaf nodes, over which then the B+ tree inner nodes are iteratively built.</li><li>The B+ tree template source code is now published under the <a href="http://www.boost.org/users/license.html">Boost Software License</a>! Use it!</li><li>More minor changes are listed in the <a href="/2007/stx-btree/#changelog">ChangeLog</a>.</li></ul><p>STX B+ tree version 0.9 is available <a href="/2007/stx-btree">from the usual project webpage</a>.</p><p>The switch from binary search to linear scan, and all further patches and optimization call for a direct comparison of version 0.8.6 and 0.9. Because of special optimizations to the <code>btree_set</code> specializations, the following plots differentiate between <code>set</code> and <code>map</code>s.</p><p>The full results PDF is downloadable by clicking one the plots, and is also included in the stx-btree tarball. The following plots show results from the integer pair speeds where <strong>dashed lines are from version 0.8.6</strong> while <strong>solid lines are from 0.9</strong>. All speedtests where run on the Intel i7 920, which is described in more detail on the <a href="/2007/stx-btree/speedtest">stx-btree speedtest page</a>.</p><p>The largest difference between 0.8.6 and 0.9 can be seen in the <code>find()</code> only plot of the <code>multimap</code> container:</p><p style="text-align: center"><a href="/2013/0507-STX-B+Tree-0.9/speedtest-delta.pdf"> <img width="700" height="490" title="speedtest-delta-3.png" src="/2013/0507-STX-B+Tree-0.9/speedtest-delta-3.png" alt="speedtest-delta-3.png"/></a></p><p style="text-align: center"><a href="/2013/0507-STX-B+Tree-0.9/ratio-old-over-new.pdf"> <img width="700" height="490" title="ratio-old-over-new-12.png" src="/2013/0507-STX-B+Tree-0.9/ratio-old-over-new-12.png" alt="ratio-old-over-new-12.png"/></a></p><p>First notice that both the STL map and hash maps have identical results. However, the B+ tree implementation show a <strong>significant performance gain of about 20-30%</strong> from the optimizations introduced in 0.9: mainly the linear scanning of nodes!</p><p>The overall performance of an insertion/find/deletion cycle is also improved, however not as much as pure lookup speed. However, the picture is not only positive: the patches in version 0.9 actually have a speed <strong>decrease for small number of items</strong>, smaller than the CPU&apos;s cache size. This is due to calling <code>std::copy</code> when copying key/value items. Because the B+ tree is meant for large sets of items, and the absolute times for the small item sets is relatively low, this patch was still included. For other data types than integers, the call of <code>std::copy</code> will have a greater performance benefit than this ratio plot suggests!</p><p style="text-align: center"><a href="/2013/0507-STX-B+Tree-0.9/speedtest-delta.pdf"> <img width="700" height="490" title="speedtest-delta-2.png" src="/2013/0507-STX-B+Tree-0.9/speedtest-delta-2.png" alt="speedtest-delta-2.png"/></a></p><p style="text-align: center"><a href="/2013/0507-STX-B+Tree-0.9/ratio-old-over-new.pdf"> <img width="700" height="490" title="ratio-old-over-new-08.png" src="/2013/0507-STX-B+Tree-0.9/ratio-old-over-new-08.png" alt="ratio-old-over-new-08.png"/></a></p><p>The 0.9 release also includes some specific optimizations for the <code>set</code> specialization: a lot of superfluous copying is now omitted, which was due to <code>sizeof(empty_struct) = 1</code>, instead zero. Thus the overall performance improvement of the insertion/find/deletion cycle of the <code>set</code> variant is somewhat higher than that of <code>map</code>. This is specially true for the default node size of <code>&lt;64&gt;</code>, where 0.9 is about 20% faster than 0.8.6 in the largest tests.</p><p style="text-align: center"><a href="/2013/0507-STX-B+Tree-0.9/speedtest-delta.pdf"> <img width="700" height="490" title="speedtest-delta-5.png" src="/2013/0507-STX-B+Tree-0.9/speedtest-delta-5.png" alt="speedtest-delta-5.png"/></a></p><p style="text-align: center"><a href="/2013/0507-STX-B+Tree-0.9/ratio-old-over-new.pdf"> <img width="700" height="490" title="ratio-old-over-new-20.png" src="/2013/0507-STX-B+Tree-0.9/ratio-old-over-new-20.png" alt="ratio-old-over-new-20.png"/></a></p>Cheers. </div><br/><a id="notes"></a><div class="commentframe" style="display: none; border-color: red" id="newpost_div"> <div class="commentimage"> <a href="http://www.gravatar.com/" id="newpost_imgurl"> <img id="newpost_img" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAAAAAA6fptVAAAAAXNSR0IArs4c6QAAAApJREFUCB1j+A8AAQEBADZfZ4AAAAAASUVORK5CYII=" width="80" height="80" alt="Gravatar" /> </a> </div> <div class="commenttitle">Comment by <b><span id="newpost_name">Name</span></b> at <span id="newpost_date">Date</span><span id="newpost_uri">- URI</span><a href="/2013/0507-STX-B+Tree-0.9/" rel="nofollow"></a></div> <div class="commentbody" id="newpost_body"></div> <div class="commentbody" style="text-align: right"><big>Preview (Not Saved!)</big></div></div><a id="postnote"></a><form id="noteform" method="post" action="/sendpost.php"><div class="commentform" style="text-align: center"><table class="center thinframe" style="text-align: left"> <tr> <td colspan="2" style="text-align: center">Post Comment<input type="hidden" name="previewok" value="0" /><input type="hidden" name="posturi" value="/2013/0507-STX-B+Tree-0.9/" /></td> </tr> <tr> <td>Name:</td> <td><input type="text" name="postname" size="40" /></td> </tr> <tr> <td>E-Mail or Homepage:<br /><span style="font-size: 8pt">&nbsp;</span></td> <td><input type="text" name="postmail" size="40" /><br /> <span style="font-size: 8pt">URLs (http://...) are displayed, e-mails are hidden and used for Gravatar.</span></td> </tr> <tr> <td colspan="2" style="text-align: center"> <textarea name="postbody" cols="80" rows="8"></textarea><br /> <span style="font-size: 8pt">Many common HTML elements are allowed in the text, but no CSS style.</span> </td> </tr> <tr> <td colspan="2" style="text-align: center"> <input type="button" name="Preview" value="Preview" onclick="return noteform_submit()" /> <input type="submit" name="Submit" value="Submit" disabled="disabled" id="newpost_submit" /> </td> </tr></table></div></form></div><div style="text-align: left; padding: 8pt"><a href="/xmlfeed/weblog-rss20.xml"><img src="/img/xmlfeed-rss20.png" alt="RSS 2.0 Weblog Feed" height="15" width="80" /></a> <a href="/xmlfeed/weblog-atom10.xml"><img src="/img/xmlfeed-atom10.png" alt="Atom 1.0 Weblog Feed" height="15" width="80" /></a> <a href="http://validator.w3.org/check?uri=referer"><img src="/img/w3c-xhtml10.png" alt="Valid XHTML 1.1" height="15" width="80" /></a> <a href="http://jigsaw.w3.org/css-validator/check/referer"><img src="/img/w3c-css.png" alt="Valid CSS (2.1)" height="15" width="80" /></a></div></body></html>