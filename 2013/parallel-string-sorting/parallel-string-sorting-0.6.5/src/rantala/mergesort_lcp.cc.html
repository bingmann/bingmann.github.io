<?xml version="1.0" encoding="iso-8859-1"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta content="text/html; charset=iso-8859-1" http-equiv="content-type" /><meta name="viewport" content="initial-scale=1"><title>/2013/parallel-string-sorting/parallel-string-sorting-0.6.5/src/rantala/mergesort_lcp.cc - panthema.net</title><link rel="stylesheet" type="text/css" href="/css/base.css" /><link rel="stylesheet" type="text/css" href="/css/fonts.css" /><link rel="alternate" type="application/rss+xml" title="panthema.net Weblog Feed RSS 2.0" href="http://panthema.net/xmlfeed/weblog-rss20.xml" /><link rel="alternate" type="application/atom+xml" title="panthema.net Weblog Feed Atom 1.0" href="http://panthema.net/xmlfeed/weblog-atom10.xml" /><script type="text/javascript" src="/js/base.js"></script><script type="text/javascript">/* <!-- */makeIEHover = function() {var lis = document.getElementById('ptnav').getElementsByTagName('li');for (var i = 0; i < lis.length; i++) {lis[i].onmouseover = function() {this.className += ' sfhover';};lis[i].onmouseout = function() {this.className = this.className.replace(new RegExp(' sfhover\b'), '');};}};if (window.attachEvent) window.attachEvent('onload', makeIEHover);/* --> */</script></head><body style="background-image: url(/img/bgfractal5.jpg)"><div class="pttopbar"><div style="float: right"><ul id="ptnav"><li class="top"><a class="ni" href="/"><i class="icon-book"></i> Weblog</a><ul style="margin-left: -6px; margin-top: 4px" class="nx"><li><a href="/2015/">2015</a></li><li><a href="/2014/">2014</a></li><li><a href="/2013/">2013</a></li><li><a href="/2012/">2012</a></li><li><a href="/2011/">2011</a></li><li><a href="/2010/">2010</a></li><li><a href="/2009/">2009</a></li><li><a href="/2008/">2008</a></li><li><a href="/2007/">2007</a></li><li><a href="/2006/">2006</a></li><li class="nt"><a href="/2005/">2005</a></li><li class="ns"><a href="/xmlfeed/weblog-rss20.xml">RSS Feed</a></li><li class="nt"><a href="/xmlfeed/weblog-atom10.xml">XML Atom</a></li><li class="ns"><a href="/search.html">Search</a></li></ul></li><li class="top"><a class="ni" href="/tags/"><i class="icon-tags"></i> Tags</a><div style="width: 14em; margin-left: -9em; margin-top: 4px"><a style="font-size: 10pt" href="/tags/algebra.html">algebra</a> <a style="font-size: 16pt" href="/tags/c++.html">c++</a> <a style="font-size: 12pt" href="/tags/code-example.html">code-example</a> <a style="font-size: 14pt" href="/tags/code-snippet.html">code-snippet</a> <a style="font-size: 11pt" href="/tags/coding_tricks.html">coding tricks</a> <a style="font-size: 10pt" href="/tags/compsci.html">compsci</a> <a style="font-size: 10pt" href="/tags/compsci_study_thesis.html">compsci study thesis</a> <a style="font-size: 9pt" href="/tags/crypto-speedtest.html">crypto-speedtest</a> <a style="font-size: 10pt" href="/tags/cryptography.html">cryptography</a> <a style="font-size: 9pt" href="/tags/cryptote.html">cryptote</a> <a style="font-size: 12pt" href="/tags/flex-bison-cpp-example.html">flex-bison-cpp-example</a> <a style="font-size: 16pt" href="/tags/frontpage.html">frontpage</a> <a style="font-size: 14pt" href="/tags/fun.html">fun</a> <a style="font-size: 10pt" href="/tags/graphviz.html">graphviz</a> <a style="font-size: 9pt" href="http://www.hmtg.de">hartmetall</a> <a style="font-size: 9pt" href="/tags/helppc.html">helppc</a> <a style="font-size: 9pt" href="/tags/hifi_selbstbau.html">hifi selbstbau</a> <a style="font-size: 10pt" href="/tags/latex.html">latex</a> <a style="font-size: 10pt" href="/tags/librivox.html">librivox</a> <a style="font-size: 10pt" href="/tags/linux.html">linux</a> <a style="font-size: 9pt" href="/tags/massive-sorting.html">massive-sorting</a> <a style="font-size: 10pt" href="/tags/maths.html">maths</a> <a style="font-size: 9pt" href="/tags/music.html">music</a> <a style="font-size: 10pt" href="/tags/netfundamentals.html">netfundamentals</a> <a style="font-size: 11pt" href="/tags/ns-3.html">ns-3</a> <a style="font-size: 10pt" href="/tags/parallel-string-sorting.html">parallel-string-sorting</a> <a style="font-size: 9pt" href="/tags/qtsqlview.html">qtsqlview</a> <a style="font-size: 13pt" href="/tags/research.html">research</a> <a style="font-size: 11pt" href="/tags/sdios06.html">sdios06</a> <a style="font-size: 9pt" href="/tags/sdlfractal.html">sdlfractal</a> <a style="font-size: 14pt" href="/tags/sorting.html">sorting</a> <a style="font-size: 10pt" href="/tags/stringology.html">stringology</a> <a style="font-size: 16pt" href="/tags/stx-btree.html">stx-btree</a> <a style="font-size: 9pt" href="/tags/stx-exparser.html">stx-exparser</a> <a style="font-size: 14pt" href="/tags/stxxl.html">stxxl</a> <a style="font-size: 16pt" href="/tags/talk.html">talk</a> <a style="font-size: 10pt" href="/tags/thrill.html">thrill</a> <a style="font-size: 10pt" href="/tags/tutorium.html">tutorium</a> <a style="font-size: 16pt" href="/tags/university.html">university</a> <a style="font-size: 13pt" href="/tags/utilities.html">utilities</a> <a style="font-size: 10pt" href="/tags/vncrec.html">vncrec</a> <a style="font-size: 9pt" href="/tags/webdesign.html">webdesign</a> </div></li><li class="top"> <a class="ni" href="#"><i class="icon-cubes"></i> Projects</a> <ul style="margin-left: -8em; margin-top: 4px;" class="nx"> <li><a href="/2009/cryptote/">CryptoTE</a></li> <li><a href="/2009/digup/">digup</a></li> <li><a href="/2013/disk-filltest/">disk-filltest</a></li> <li><a href="/2012/1119-eSAIS-Inducing-Suffix-and-LCP-Arrays-in-External-Memory/">eSAIS-LCP</a></li> <li><a href="/2007/flex-bison-cpp-example/">Flex Bison C++ Example</a></li> <li><a href="/2013/malloc_count/">malloc_count</a></li> <li><a href="/2013/parallel-string-sorting/">parallel-string-sorting</a></li> <li><a href="/2013/pmbw/">Parallel Memory Bandwidth</a></li> <li><a href="/2014/sqlplot-tools/">SqlPlotTools</a></li> <li><a href="/2013/sound-of-sorting/">The Sound of Sorting</a></li> <li><a href="/2007/stx-btree/">STX B+ Tree</a></li> <li><a href="/2010/stx-cbtreedb/">STX Constant BTreeDB</a></li> <li><a href="/2010/stx-execpipe/">STX ExecPipe</a></li> <li><a href="/2007/stx-exparser/">STX Expression Parser</a></li> <li><a href="/tags/stxxl.html">STXXL 1.4</a></li> <li class="nt"><a href="/2014/vncrec-rgb/">VNCrec RGB 0.4</a></li> <li class="ns"><a href="/search.html">Search</a></li> </ul></li><li class="top"> <a class="ni" href="#"><i class="icon-graduation-cap"></i> Research</a> <ul style="margin-left: -16em; margin-top: 4px" class="nx"> <li><a href="/2012/1119-eSAIS-Inducing-Suffix-and-LCP-Arrays-in-External-Memory/">eSAIS-LCP - External Memory Suffix Sorting</a></li> <li><a href="/2013/parallel-string-sorting/">Parallel String Sorting</a></li> <li><a href="/tags/massive-sorting.html">Practical Massively Parallel Sorting</a></li> <li><a href="/tags/stxxl.html">STXXL - External Memory Algorithms</a></li> <li class="ns"><a href="/search.html">Search</a></li> </ul></li><li class="top"> <a class="ni" href="/about/"><i class="icon-info-circled"></i> About</a> <ul style="margin-left: -6em; margin-top: 4px" class="nx"> <li><a href="/about/">Timo Bingmann</a></li> <li><a href="/about/impressum.html">Impressum</a></li> </ul></li><li class="top"> <a class="ni" href="/subscribe.html"><i class="icon-rss-squared"></i> Subscribe</a></li></ul></div><div style="padding: 6px"><a href="/">panthema</a>  / <a href="/2013/">2013</a> / <a href="/2013/parallel-string-sorting/">parallel-string-sorting</a> / <a href="/2013/parallel-string-sorting/parallel-string-sorting-0.6.5/">parallel-string-sorting-0.6.5</a> / <a href="/2013/parallel-string-sorting/parallel-string-sorting-0.6.5/src/">src</a> / <a href="/2013/parallel-string-sorting/parallel-string-sorting-0.6.5/src/rantala/">rantala</a> / <a href="/2013/parallel-string-sorting/parallel-string-sorting-0.6.5/src/rantala/mergesort_lcp.cc.html">mergesort_lcp.cc</a> (<a href="/2013/parallel-string-sorting/parallel-string-sorting-0.6.5/src/rantala/mergesort_lcp.cc">Download File</a>)</div></div><div class="ptfullwidth"><pre class="codesnippet" style="font-family: monospace"><tt><span class="comment">/*</span>
<span class="comment"> * Copyright 2008,2011 by Tommi Rantala </span><span class="url">&lt;tt.rantala@gmail.com&gt;</span>
<span class="comment"> *</span>
<span class="comment"> * Permission is hereby granted, free of charge, to any person obtaining a copy</span>
<span class="comment"> * of this software and associated documentation files (the "Software"), to</span>
<span class="comment"> * deal in the Software without restriction, including without limitation the</span>
<span class="comment"> * rights to use, copy, modify, merge, publish, distribute, sublicense, and/or</span>
<span class="comment"> * sell copies of the Software, and to permit persons to whom the Software is</span>
<span class="comment"> * furnished to do so, subject to the following conditions:</span>
<span class="comment"> *</span>
<span class="comment"> * The above copyright notice and this permission notice shall be included in</span>
<span class="comment"> * all copies or substantial portions of the Software.</span>
<span class="comment"> *</span>
<span class="comment"> * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR</span>
<span class="comment"> * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,</span>
<span class="comment"> * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE</span>
<span class="comment"> * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER</span>
<span class="comment"> * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING</span>
<span class="comment"> * FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS</span>
<span class="comment"> * IN THE SOFTWARE.</span>
<span class="comment"> */</span>

<span class="comment">/* Mergesort variants for sorting strings. When merging the input streams, use</span>
<span class="comment"> * previously calculated longest common prefix (LCP) values in order to avoid</span>
<span class="comment"> * string comparisons. Input stream example:</span>
<span class="comment"> *</span>
<span class="comment"> *      aaaa</span>
<span class="comment"> *      aaab   LCP with respect to 'aaaa':3</span>
<span class="comment"> *      aacd   LCP with respect to 'aaab':2</span>
<span class="comment"> *</span>
<span class="comment"> * In another variant, we also cache those characters that appear right after</span>
<span class="comment"> * the distinguishing prefix, when accessing the strings for the first time.</span>
<span class="comment"> * Later we can use both the LCP and cache values to decide which string to</span>
<span class="comment"> * merge next. Input stream example:</span>
<span class="comment"> *</span>
<span class="comment"> *      aaaa</span>
<span class="comment"> *      aaab   LCP with respect to 'aaaa':3, cache: 'b'</span>
<span class="comment"> *      aacd   LCP with respect to 'aaab':2, cache: 'c'</span>
<span class="comment"> *</span>
<span class="comment"> *</span>
<span class="comment"> * See also:</span>
<span class="comment"> *   @article{384249,</span>
<span class="comment"> *       author = {Peter Sanders},</span>
<span class="comment"> *       title = {Fast priority queues for cached memory},</span>
<span class="comment"> *       journal = {J. Exp. Algorithmics},</span>
<span class="comment"> *       volume = {5},</span>
<span class="comment"> *       year = {2000},</span>
<span class="comment"> *       issn = {1084-6654},</span>
<span class="comment"> *       pages = {7},</span>
<span class="comment"> *       doi = {</span><span class="url">http://doi.acm.org/10.1145/351827.384249</span><span class="comment">},</span>
<span class="comment"> *       publisher = {ACM},</span>
<span class="comment"> *       address = {New York, NY, USA},</span>
<span class="comment"> *   }</span>
<span class="comment"> *</span>
<span class="comment"> *   Waihong Ng and Katsuhiko Kakehi:</span>
<span class="comment"> *     “Merging String Sequences by Longest Common Prefixes”,</span>
<span class="comment"> *     IPSJ Digital Courier, Vol. 4, pp.69-78 (2008)</span>
<span class="comment"> *     </span><span class="url">http://dx.doi.org/10.2197/ipsjdc.4.69</span>
<span class="comment"> */</span>

<span class="preproc">#include</span><span class="normal"> </span><span class="string">&lt;stdlib.h&gt;</span>
<span class="preproc">#include</span><span class="normal"> </span><span class="string">&lt;assert.h&gt;</span>
<span class="preproc">#include</span><span class="normal"> </span><span class="string">&lt;stdint.h&gt;</span>
<span class="preproc">#include</span><span class="normal"> </span><span class="string">&lt;string.h&gt;</span>
<span class="preproc">#include</span><span class="normal"> </span><span class="string">&lt;iostream&gt;</span>

<span class="preproc">#include</span><span class="normal"> </span><span class="string">&lt;boost/tuple/tuple.hpp&gt;</span>

<span class="preproc">#include</span><span class="normal"> </span><span class="string">"tools/debug.h"</span>
<span class="preproc">#include</span><span class="normal"> </span><span class="string">"tools/get_char.h"</span>
<span class="preproc">#include</span><span class="normal"> </span><span class="string">"tools/insertion_sort.h"</span>
<span class="preproc">#include</span><span class="normal"> </span><span class="string">"../tools/contest.h"</span>

<span class="keyword">namespace</span><span class="normal"> rantala_mergesort_lcp </span><span class="cbracket">{</span>

<span class="keyword">using</span><span class="normal"> </span><span class="keyword">namespace</span><span class="normal"> rantala</span><span class="symbol">;</span>

<span class="comment">// Handle very long strings. I guess in most cases we could choose smaller type</span>
<span class="comment">// to save some memory.</span>
<span class="keyword">typedef</span><span class="normal"> </span><span class="usertype">size_t</span><span class="normal"> lcp_t</span><span class="symbol">;</span>

<span class="keyword">static</span><span class="normal"> lcp_t</span>
<span class="function">lcp</span><span class="symbol">(</span><span class="type">unsigned</span><span class="normal"> </span><span class="type">char</span><span class="symbol">*</span><span class="normal"> a</span><span class="symbol">,</span><span class="normal"> </span><span class="type">unsigned</span><span class="normal"> </span><span class="type">char</span><span class="symbol">*</span><span class="normal"> b</span><span class="symbol">)</span>
<span class="cbracket">{</span>
<span class="normal">	</span><span class="usertype">size_t</span><span class="normal"> i</span><span class="symbol">=</span><span class="number">0</span><span class="symbol">;</span>
<span class="normal">	</span><span class="keyword">while</span><span class="normal"> </span><span class="symbol">(</span><span class="keyword">true</span><span class="symbol">)</span><span class="normal"> </span><span class="cbracket">{</span>
<span class="normal">		</span><span class="keyword">const</span><span class="normal"> </span><span class="type">unsigned</span><span class="normal"> </span><span class="type">char</span><span class="normal"> A </span><span class="symbol">=</span><span class="normal"> </span><span class="symbol">*</span><span class="normal">a</span><span class="symbol">++;</span>
<span class="normal">		</span><span class="keyword">const</span><span class="normal"> </span><span class="type">unsigned</span><span class="normal"> </span><span class="type">char</span><span class="normal"> B </span><span class="symbol">=</span><span class="normal"> </span><span class="symbol">*</span><span class="normal">b</span><span class="symbol">++;</span>
<span class="normal">		</span><span class="keyword">if</span><span class="normal"> </span><span class="symbol">(</span><span class="normal">A</span><span class="symbol">==</span><span class="number">0</span><span class="normal"> </span><span class="usertype">or</span><span class="normal"> A </span><span class="symbol">!=</span><span class="normal"> B</span><span class="symbol">)</span><span class="normal"> </span><span class="keyword">return</span><span class="normal"> i</span><span class="symbol">;</span>
<span class="normal">		</span><span class="symbol">++</span><span class="normal">i</span><span class="symbol">;</span>
<span class="normal">	</span><span class="cbracket">}</span>
<span class="normal">	</span><span class="function">assert</span><span class="symbol">(</span><span class="number">0</span><span class="symbol">);</span>
<span class="normal">	</span><span class="keyword">return</span><span class="normal"> </span><span class="function">lcp_t</span><span class="symbol">(-</span><span class="number">1</span><span class="symbol">);</span>
<span class="cbracket">}</span>

<span class="normal">boost</span><span class="symbol">::</span><span class="normal">tuple</span><span class="symbol">&lt;</span><span class="type">int</span><span class="symbol">,</span><span class="normal"> lcp_t</span><span class="symbol">&gt;</span>
<span class="function">compare</span><span class="symbol">(</span><span class="type">unsigned</span><span class="normal"> </span><span class="type">char</span><span class="symbol">*</span><span class="normal"> a</span><span class="symbol">,</span><span class="normal"> </span><span class="type">unsigned</span><span class="normal"> </span><span class="type">char</span><span class="symbol">*</span><span class="normal"> b</span><span class="symbol">,</span><span class="normal"> </span><span class="usertype">size_t</span><span class="normal"> depth</span><span class="symbol">=</span><span class="number">0</span><span class="symbol">)</span>
<span class="cbracket">{</span>
<span class="normal">	</span><span class="function">assert</span><span class="symbol">(</span><span class="normal">a</span><span class="symbol">);</span><span class="normal"> </span><span class="function">assert</span><span class="symbol">(</span><span class="normal">b</span><span class="symbol">);</span>
<span class="normal">	</span><span class="keyword">for</span><span class="normal"> </span><span class="symbol">(</span><span class="usertype">size_t</span><span class="normal"> i</span><span class="symbol">=</span><span class="normal">depth</span><span class="symbol">;</span><span class="normal"> </span><span class="symbol">;</span><span class="normal"> </span><span class="symbol">++</span><span class="normal">i</span><span class="symbol">)</span><span class="normal"> </span><span class="cbracket">{</span>
<span class="normal">		</span><span class="keyword">const</span><span class="normal"> </span><span class="type">unsigned</span><span class="normal"> </span><span class="type">char</span><span class="normal"> A </span><span class="symbol">=</span><span class="normal"> a</span><span class="symbol">[</span><span class="normal">i</span><span class="symbol">];</span>
<span class="normal">		</span><span class="keyword">const</span><span class="normal"> </span><span class="type">unsigned</span><span class="normal"> </span><span class="type">char</span><span class="normal"> B </span><span class="symbol">=</span><span class="normal"> b</span><span class="symbol">[</span><span class="normal">i</span><span class="symbol">];</span>
<span class="normal">		</span><span class="keyword">if</span><span class="normal"> </span><span class="symbol">(</span><span class="normal">A </span><span class="symbol">==</span><span class="normal"> </span><span class="number">0</span><span class="normal"> </span><span class="usertype">or</span><span class="normal"> A </span><span class="symbol">!=</span><span class="normal"> B</span><span class="symbol">)</span><span class="normal"> </span><span class="cbracket">{</span>
<span class="normal">			</span><span class="keyword">return</span><span class="normal"> boost</span><span class="symbol">::</span><span class="function">make_tuple</span><span class="symbol">(</span><span class="type">int</span><span class="symbol">(</span><span class="normal">A</span><span class="symbol">)-</span><span class="type">int</span><span class="symbol">(</span><span class="normal">B</span><span class="symbol">),</span><span class="normal"> i</span><span class="symbol">);</span>
<span class="normal">		</span><span class="cbracket">}</span>
<span class="normal">	</span><span class="cbracket">}</span>
<span class="normal">	</span><span class="function">assert</span><span class="symbol">(</span><span class="number">0</span><span class="symbol">);</span>
<span class="normal">	</span><span class="keyword">return</span><span class="normal"> boost</span><span class="symbol">::</span><span class="function">make_tuple</span><span class="symbol">(</span><span class="type">int</span><span class="symbol">(-</span><span class="number">1</span><span class="symbol">),</span><span class="normal"> </span><span class="function">lcp_t</span><span class="symbol">(-</span><span class="number">1</span><span class="symbol">));</span>
<span class="cbracket">}</span>

<span class="keyword">enum</span><span class="normal"> MergeResult </span><span class="cbracket">{</span>
<span class="normal">	SortedInPlace</span><span class="symbol">,</span>
<span class="normal">	SortedInTemp</span><span class="symbol">,</span>
<span class="cbracket">}</span><span class="symbol">;</span>

<span class="comment">/*******************************************************************************</span>
<span class="comment"> *</span>
<span class="comment"> * mergesort_lcp_2way</span>
<span class="comment"> *</span>
<span class="comment"> ******************************************************************************/</span>

<span class="comment">/* If the template parameter OutputLCP is true, write LCP values to lcp_result.</span>
<span class="comment"> * It is set to false when performing the final merge step -- at that point we</span>
<span class="comment"> * dont need the LCP results anymore.</span>
<span class="comment"> */</span>

<span class="keyword">template</span><span class="normal"> </span><span class="symbol">&lt;</span><span class="type">bool</span><span class="normal"> OutputLCP</span><span class="symbol">&gt;</span>
<span class="keyword">static</span><span class="normal"> </span><span class="type">void</span>
<span class="function">merge_lcp_2way</span><span class="symbol">(</span><span class="type">unsigned</span><span class="normal"> </span><span class="type">char</span><span class="symbol">**</span><span class="normal"> from0</span><span class="symbol">,</span><span class="normal">  lcp_t</span><span class="symbol">*</span><span class="normal"> </span><span class="usertype">restrict</span><span class="normal"> lcp_input0</span><span class="symbol">,</span><span class="normal"> </span><span class="usertype">size_t</span><span class="normal"> n0</span><span class="symbol">,</span>
<span class="normal">               </span><span class="type">unsigned</span><span class="normal"> </span><span class="type">char</span><span class="symbol">**</span><span class="normal"> from1</span><span class="symbol">,</span><span class="normal">  lcp_t</span><span class="symbol">*</span><span class="normal"> </span><span class="usertype">restrict</span><span class="normal"> lcp_input1</span><span class="symbol">,</span><span class="normal"> </span><span class="usertype">size_t</span><span class="normal"> n1</span><span class="symbol">,</span>
<span class="normal">               </span><span class="type">unsigned</span><span class="normal"> </span><span class="type">char</span><span class="symbol">**</span><span class="normal"> result</span><span class="symbol">,</span><span class="normal"> lcp_t</span><span class="symbol">*</span><span class="normal"> </span><span class="usertype">restrict</span><span class="normal"> lcp_result</span><span class="symbol">)</span>
<span class="cbracket">{</span>
<span class="normal">	</span><span class="function">debug</span><span class="symbol">()</span><span class="normal"> </span><span class="symbol">&lt;&lt;</span><span class="normal"> __func__ </span><span class="symbol">&lt;&lt;</span><span class="normal"> </span><span class="string">"(): n0="</span><span class="normal"> </span><span class="symbol">&lt;&lt;</span><span class="normal"> n0 </span><span class="symbol">&lt;&lt;</span><span class="normal"> </span><span class="string">", n1="</span><span class="normal"> </span><span class="symbol">&lt;&lt;</span><span class="normal"> n1 </span><span class="symbol">&lt;&lt;</span><span class="normal"> </span><span class="string">'</span><span class="specialchar">\n</span><span class="string">'</span><span class="symbol">;</span>
<span class="normal">	</span><span class="usertype">lcp_t</span><span class="normal"> lcp0</span><span class="symbol">=</span><span class="number">0</span><span class="symbol">,</span><span class="normal"> lcp1</span><span class="symbol">=</span><span class="number">0</span><span class="symbol">;</span>
<span class="normal">	</span><span class="cbracket">{</span>
<span class="normal">		</span><span class="type">int</span><span class="normal"> cmp01</span><span class="symbol">;</span><span class="normal"> </span><span class="usertype">lcp_t</span><span class="normal"> lcp01</span><span class="symbol">;</span>
<span class="normal">		boost</span><span class="symbol">::</span><span class="function">tie</span><span class="symbol">(</span><span class="normal">cmp01</span><span class="symbol">,</span><span class="normal"> lcp01</span><span class="symbol">)</span><span class="normal"> </span><span class="symbol">=</span><span class="normal"> </span><span class="function">compare</span><span class="symbol">(*</span><span class="normal">from0</span><span class="symbol">,</span><span class="normal"> </span><span class="symbol">*</span><span class="normal">from1</span><span class="symbol">);</span>
<span class="normal">		</span><span class="keyword">if</span><span class="normal"> </span><span class="symbol">(</span><span class="normal">cmp01 </span><span class="symbol">&lt;=</span><span class="normal"> </span><span class="number">0</span><span class="symbol">)</span><span class="normal"> </span><span class="cbracket">{</span>
<span class="normal">			</span><span class="symbol">*</span><span class="normal">result</span><span class="symbol">++</span><span class="normal"> </span><span class="symbol">=</span><span class="normal"> </span><span class="symbol">*</span><span class="normal">from0</span><span class="symbol">++;</span>
<span class="normal">			lcp0 </span><span class="symbol">=</span><span class="normal"> </span><span class="symbol">*</span><span class="normal">lcp_input0</span><span class="symbol">++;</span>
<span class="normal">			lcp1 </span><span class="symbol">=</span><span class="normal"> lcp01</span><span class="symbol">;</span>
<span class="normal">			</span><span class="keyword">if</span><span class="normal"> </span><span class="symbol">(--</span><span class="normal">n0 </span><span class="symbol">==</span><span class="normal"> </span><span class="number">0</span><span class="symbol">)</span><span class="normal"> </span><span class="keyword">goto</span><span class="normal"> finish0</span><span class="symbol">;</span>
<span class="normal">		</span><span class="cbracket">}</span><span class="normal"> </span><span class="keyword">else</span><span class="normal"> </span><span class="cbracket">{</span>
<span class="normal">			</span><span class="symbol">*</span><span class="normal">result</span><span class="symbol">++</span><span class="normal"> </span><span class="symbol">=</span><span class="normal"> </span><span class="symbol">*</span><span class="normal">from1</span><span class="symbol">++;</span>
<span class="normal">			lcp1 </span><span class="symbol">=</span><span class="normal"> </span><span class="symbol">*</span><span class="normal">lcp_input1</span><span class="symbol">++;</span>
<span class="normal">			lcp0 </span><span class="symbol">=</span><span class="normal"> lcp01</span><span class="symbol">;</span>
<span class="normal">			</span><span class="keyword">if</span><span class="normal"> </span><span class="symbol">(--</span><span class="normal">n1 </span><span class="symbol">==</span><span class="normal"> </span><span class="number">0</span><span class="symbol">)</span><span class="normal"> </span><span class="keyword">goto</span><span class="normal"> finish1</span><span class="symbol">;</span>
<span class="normal">		</span><span class="cbracket">}</span>
<span class="normal">	</span><span class="cbracket">}</span>
<span class="normal">	</span><span class="keyword">while</span><span class="normal"> </span><span class="symbol">(</span><span class="keyword">true</span><span class="symbol">)</span><span class="normal"> </span><span class="cbracket">{</span>
<span class="normal">		</span><span class="comment">/*</span>
<span class="comment">		debug() &lt;&lt; "Starting loop, n0="&lt;&lt;n0&lt;&lt;", n1="&lt;&lt;n1&lt;&lt;" ...\n"</span>
<span class="comment">		        &lt;&lt; "\tprev  = '"&lt;&lt;*(result-1)&lt;&lt;"'\n"</span>
<span class="comment">		        &lt;&lt; "\tfrom0 = '"&lt;&lt;*from0&lt;&lt;"'\n"</span>
<span class="comment">		        &lt;&lt; "\tfrom1 = '"&lt;&lt;*from1&lt;&lt;"'\n"</span>
<span class="comment">		        &lt;&lt; "\tlcp0  = " &lt;&lt; lcp0 &lt;&lt; "\n"</span>
<span class="comment">		        &lt;&lt; "\tlcp1  = " &lt;&lt; lcp1 &lt;&lt; "\n"</span>
<span class="comment">		        &lt;&lt; "\n";</span>
<span class="comment">		*/</span>
<span class="normal">		</span><span class="keyword">if</span><span class="normal"> </span><span class="symbol">(</span><span class="normal">lcp0 </span><span class="symbol">&gt;</span><span class="normal"> lcp1</span><span class="symbol">)</span><span class="normal"> </span><span class="cbracket">{</span>
<span class="normal">			</span><span class="function">assert</span><span class="symbol">(</span><span class="function">cmp</span><span class="symbol">(*</span><span class="normal">from0</span><span class="symbol">,</span><span class="normal"> </span><span class="symbol">*</span><span class="normal">from1</span><span class="symbol">)</span><span class="normal"> </span><span class="symbol">&lt;</span><span class="normal"> </span><span class="number">0</span><span class="symbol">);</span>
<span class="normal">			</span><span class="symbol">*</span><span class="normal">result</span><span class="symbol">++</span><span class="normal"> </span><span class="symbol">=</span><span class="normal"> </span><span class="symbol">*</span><span class="normal">from0</span><span class="symbol">++;</span>
<span class="normal">			</span><span class="keyword">if</span><span class="normal"> </span><span class="symbol">(</span><span class="normal">OutputLCP</span><span class="symbol">)</span><span class="normal"> </span><span class="symbol">*</span><span class="normal">lcp_result</span><span class="symbol">++</span><span class="normal"> </span><span class="symbol">=</span><span class="normal"> lcp0</span><span class="symbol">;</span>
<span class="normal">			lcp0 </span><span class="symbol">=</span><span class="normal"> </span><span class="symbol">*</span><span class="normal">lcp_input0</span><span class="symbol">++;</span>
<span class="normal">			</span><span class="keyword">if</span><span class="normal"> </span><span class="symbol">(--</span><span class="normal">n0 </span><span class="symbol">==</span><span class="normal"> </span><span class="number">0</span><span class="symbol">)</span><span class="normal"> </span><span class="keyword">goto</span><span class="normal"> finish0</span><span class="symbol">;</span>
<span class="normal">		</span><span class="cbracket">}</span><span class="normal"> </span><span class="keyword">else</span><span class="normal"> </span><span class="keyword">if</span><span class="normal"> </span><span class="symbol">(</span><span class="normal">lcp0 </span><span class="symbol">&lt;</span><span class="normal"> lcp1</span><span class="symbol">)</span><span class="normal"> </span><span class="cbracket">{</span>
<span class="normal">			</span><span class="function">assert</span><span class="symbol">(</span><span class="function">cmp</span><span class="symbol">(*</span><span class="normal">from0</span><span class="symbol">,</span><span class="normal"> </span><span class="symbol">*</span><span class="normal">from1</span><span class="symbol">)</span><span class="normal"> </span><span class="symbol">&gt;</span><span class="normal"> </span><span class="number">0</span><span class="symbol">);</span>
<span class="normal">			</span><span class="symbol">*</span><span class="normal">result</span><span class="symbol">++</span><span class="normal"> </span><span class="symbol">=</span><span class="normal"> </span><span class="symbol">*</span><span class="normal">from1</span><span class="symbol">++;</span>
<span class="normal">			</span><span class="keyword">if</span><span class="normal"> </span><span class="symbol">(</span><span class="normal">OutputLCP</span><span class="symbol">)</span><span class="normal"> </span><span class="symbol">*</span><span class="normal">lcp_result</span><span class="symbol">++</span><span class="normal"> </span><span class="symbol">=</span><span class="normal"> lcp1</span><span class="symbol">;</span>
<span class="normal">			lcp1 </span><span class="symbol">=</span><span class="normal"> </span><span class="symbol">*</span><span class="normal">lcp_input1</span><span class="symbol">++;</span>
<span class="normal">			</span><span class="keyword">if</span><span class="normal"> </span><span class="symbol">(--</span><span class="normal">n1 </span><span class="symbol">==</span><span class="normal"> </span><span class="number">0</span><span class="symbol">)</span><span class="normal"> </span><span class="keyword">goto</span><span class="normal"> finish1</span><span class="symbol">;</span>
<span class="normal">		</span><span class="cbracket">}</span><span class="normal"> </span><span class="keyword">else</span><span class="normal"> </span><span class="cbracket">{</span>
<span class="normal">			</span><span class="type">int</span><span class="normal"> cmp01</span><span class="symbol">;</span><span class="normal"> </span><span class="usertype">lcp_t</span><span class="normal"> lcp01</span><span class="symbol">;</span>
<span class="normal">			boost</span><span class="symbol">::</span><span class="function">tie</span><span class="symbol">(</span><span class="normal">cmp01</span><span class="symbol">,</span><span class="normal">lcp01</span><span class="symbol">)</span><span class="normal"> </span><span class="symbol">=</span><span class="normal"> </span><span class="function">compare</span><span class="symbol">(*</span><span class="normal">from0</span><span class="symbol">,</span><span class="normal"> </span><span class="symbol">*</span><span class="normal">from1</span><span class="symbol">,</span><span class="normal"> lcp0</span><span class="symbol">);</span>
<span class="normal">			</span><span class="keyword">if</span><span class="normal"> </span><span class="symbol">(</span><span class="normal">OutputLCP</span><span class="symbol">)</span><span class="normal"> </span><span class="symbol">*</span><span class="normal">lcp_result</span><span class="symbol">++</span><span class="normal"> </span><span class="symbol">=</span><span class="normal"> lcp0</span><span class="symbol">;</span>
<span class="normal">			</span><span class="keyword">if</span><span class="normal"> </span><span class="symbol">(</span><span class="normal">cmp01 </span><span class="symbol">&lt;=</span><span class="normal"> </span><span class="number">0</span><span class="symbol">)</span><span class="normal"> </span><span class="cbracket">{</span>
<span class="normal">				</span><span class="symbol">*</span><span class="normal">result</span><span class="symbol">++</span><span class="normal"> </span><span class="symbol">=</span><span class="normal"> </span><span class="symbol">*</span><span class="normal">from0</span><span class="symbol">++;</span>
<span class="normal">				lcp1 </span><span class="symbol">=</span><span class="normal"> lcp01</span><span class="symbol">;</span>
<span class="normal">				</span><span class="keyword">if</span><span class="normal"> </span><span class="symbol">(--</span><span class="normal">n0 </span><span class="symbol">==</span><span class="normal"> </span><span class="number">0</span><span class="symbol">)</span><span class="normal"> </span><span class="keyword">goto</span><span class="normal"> finish0</span><span class="symbol">;</span>
<span class="normal">				lcp0 </span><span class="symbol">=</span><span class="normal"> </span><span class="symbol">*</span><span class="normal">lcp_input0</span><span class="symbol">++;</span>
<span class="normal">			</span><span class="cbracket">}</span><span class="normal"> </span><span class="keyword">else</span><span class="normal"> </span><span class="cbracket">{</span>
<span class="normal">				</span><span class="symbol">*</span><span class="normal">result</span><span class="symbol">++</span><span class="normal"> </span><span class="symbol">=</span><span class="normal"> </span><span class="symbol">*</span><span class="normal">from1</span><span class="symbol">++;</span>
<span class="normal">				lcp0 </span><span class="symbol">=</span><span class="normal"> lcp01</span><span class="symbol">;</span>
<span class="normal">				</span><span class="keyword">if</span><span class="normal"> </span><span class="symbol">(--</span><span class="normal">n1 </span><span class="symbol">==</span><span class="normal"> </span><span class="number">0</span><span class="symbol">)</span><span class="normal"> </span><span class="keyword">goto</span><span class="normal"> finish1</span><span class="symbol">;</span>
<span class="normal">				lcp1 </span><span class="symbol">=</span><span class="normal"> </span><span class="symbol">*</span><span class="normal">lcp_input1</span><span class="symbol">++;</span>
<span class="normal">			</span><span class="cbracket">}</span>
<span class="normal">		</span><span class="cbracket">}</span>
<span class="normal">	</span><span class="cbracket">}</span>
<span class="label">finish0:</span>
<span class="normal">	</span><span class="function">debug</span><span class="symbol">()</span><span class="normal"> </span><span class="symbol">&lt;&lt;</span><span class="normal"> </span><span class="string">'~'</span><span class="normal"> </span><span class="symbol">&lt;&lt;</span><span class="normal"> __func__ </span><span class="symbol">&lt;&lt;</span><span class="normal"> </span><span class="string">"(): n0="</span><span class="normal"> </span><span class="symbol">&lt;&lt;</span><span class="normal"> n0 </span><span class="symbol">&lt;&lt;</span><span class="normal"> </span><span class="string">", n1="</span><span class="normal"> </span><span class="symbol">&lt;&lt;</span><span class="normal"> n1 </span><span class="symbol">&lt;&lt;</span><span class="normal"> </span><span class="string">'</span><span class="specialchar">\n</span><span class="string">'</span><span class="symbol">;</span>
<span class="normal">	</span><span class="function">assert</span><span class="symbol">(</span><span class="usertype">not</span><span class="normal"> n0</span><span class="symbol">);</span>
<span class="normal">	</span><span class="function">assert</span><span class="symbol">(</span><span class="normal">n1</span><span class="symbol">);</span>
<span class="normal">	std</span><span class="symbol">::</span><span class="function">copy</span><span class="symbol">(</span><span class="normal">from1</span><span class="symbol">,</span><span class="normal"> from1</span><span class="symbol">+</span><span class="normal">n1</span><span class="symbol">,</span><span class="normal"> result</span><span class="symbol">);</span>
<span class="normal">	</span><span class="keyword">if</span><span class="normal"> </span><span class="symbol">(</span><span class="normal">OutputLCP</span><span class="symbol">)</span><span class="normal"> </span><span class="symbol">*</span><span class="normal">lcp_result</span><span class="symbol">++</span><span class="normal"> </span><span class="symbol">=</span><span class="normal"> lcp1</span><span class="symbol">;</span>
<span class="normal">	</span><span class="keyword">if</span><span class="normal"> </span><span class="symbol">(</span><span class="normal">OutputLCP</span><span class="symbol">)</span><span class="normal"> std</span><span class="symbol">::</span><span class="function">copy</span><span class="symbol">(</span><span class="normal">lcp_input1</span><span class="symbol">,</span><span class="normal"> lcp_input1</span><span class="symbol">+</span><span class="normal">n1</span><span class="symbol">,</span><span class="normal"> lcp_result</span><span class="symbol">);</span>
<span class="normal">	</span><span class="keyword">return</span><span class="symbol">;</span>
<span class="label">finish1:</span>
<span class="normal">	</span><span class="function">debug</span><span class="symbol">()</span><span class="normal"> </span><span class="symbol">&lt;&lt;</span><span class="normal"> </span><span class="string">'~'</span><span class="normal"> </span><span class="symbol">&lt;&lt;</span><span class="normal"> __func__ </span><span class="symbol">&lt;&lt;</span><span class="normal"> </span><span class="string">"(): n0="</span><span class="normal"> </span><span class="symbol">&lt;&lt;</span><span class="normal"> n0 </span><span class="symbol">&lt;&lt;</span><span class="normal"> </span><span class="string">", n1="</span><span class="normal"> </span><span class="symbol">&lt;&lt;</span><span class="normal"> n1 </span><span class="symbol">&lt;&lt;</span><span class="normal"> </span><span class="string">'</span><span class="specialchar">\n</span><span class="string">'</span><span class="symbol">;</span>
<span class="normal">	</span><span class="function">assert</span><span class="symbol">(</span><span class="usertype">not</span><span class="normal"> n1</span><span class="symbol">);</span>
<span class="normal">	</span><span class="function">assert</span><span class="symbol">(</span><span class="normal">n0</span><span class="symbol">);</span>
<span class="normal">	std</span><span class="symbol">::</span><span class="function">copy</span><span class="symbol">(</span><span class="normal">from0</span><span class="symbol">,</span><span class="normal"> from0</span><span class="symbol">+</span><span class="normal">n0</span><span class="symbol">,</span><span class="normal"> result</span><span class="symbol">);</span>
<span class="normal">	</span><span class="keyword">if</span><span class="normal"> </span><span class="symbol">(</span><span class="normal">OutputLCP</span><span class="symbol">)</span><span class="normal"> </span><span class="symbol">*</span><span class="normal">lcp_result</span><span class="symbol">++</span><span class="normal"> </span><span class="symbol">=</span><span class="normal"> lcp0</span><span class="symbol">;</span>
<span class="normal">	</span><span class="keyword">if</span><span class="normal"> </span><span class="symbol">(</span><span class="normal">OutputLCP</span><span class="symbol">)</span><span class="normal"> std</span><span class="symbol">::</span><span class="function">copy</span><span class="symbol">(</span><span class="normal">lcp_input0</span><span class="symbol">,</span><span class="normal"> lcp_input0</span><span class="symbol">+</span><span class="normal">n0</span><span class="symbol">,</span><span class="normal"> lcp_result</span><span class="symbol">);</span>
<span class="normal">	</span><span class="keyword">return</span><span class="symbol">;</span>
<span class="cbracket">}</span>

<span class="keyword">template</span><span class="normal"> </span><span class="symbol">&lt;</span><span class="type">bool</span><span class="normal"> OutputLCP</span><span class="symbol">&gt;</span>
<span class="normal">MergeResult</span>
<span class="function">mergesort_lcp_2way</span><span class="symbol">(</span><span class="type">unsigned</span><span class="normal"> </span><span class="type">char</span><span class="symbol">**</span><span class="normal"> </span><span class="usertype">restrict</span><span class="normal"> strings_input</span><span class="symbol">,</span>
<span class="normal">                   </span><span class="type">unsigned</span><span class="normal"> </span><span class="type">char</span><span class="symbol">**</span><span class="normal"> </span><span class="usertype">restrict</span><span class="normal"> strings_output</span><span class="symbol">,</span>
<span class="normal">                   lcp_t</span><span class="symbol">*</span><span class="normal"> </span><span class="usertype">restrict</span><span class="normal"> lcp_input</span><span class="symbol">,</span><span class="normal"> lcp_t</span><span class="symbol">*</span><span class="normal"> </span><span class="usertype">restrict</span><span class="normal"> lcp_output</span><span class="symbol">,</span>
<span class="normal">                   </span><span class="usertype">size_t</span><span class="normal"> n</span><span class="symbol">)</span>
<span class="cbracket">{</span>
<span class="normal">	</span><span class="function">assert</span><span class="symbol">(</span><span class="normal">n </span><span class="symbol">&gt;</span><span class="normal"> </span><span class="number">0</span><span class="symbol">);</span>
<span class="normal">	</span><span class="function">debug</span><span class="symbol">()</span><span class="normal"> </span><span class="symbol">&lt;&lt;</span><span class="normal"> __func__ </span><span class="symbol">&lt;&lt;</span><span class="normal"> </span><span class="string">"(): n="</span><span class="normal"> </span><span class="symbol">&lt;&lt;</span><span class="normal"> n </span><span class="symbol">&lt;&lt;</span><span class="normal"> </span><span class="string">'</span><span class="specialchar">\n</span><span class="string">'</span><span class="symbol">;</span>
<span class="normal">	</span><span class="keyword">if</span><span class="normal"> </span><span class="symbol">(</span><span class="normal">n </span><span class="symbol">&lt;</span><span class="normal"> </span><span class="number">32</span><span class="symbol">)</span><span class="normal"> </span><span class="cbracket">{</span>
<span class="normal">		</span><span class="function">insertion_sort</span><span class="symbol">(</span><span class="normal">strings_input</span><span class="symbol">,</span><span class="normal"> n</span><span class="symbol">,</span><span class="normal"> </span><span class="number">0</span><span class="symbol">);</span>
<span class="normal">		</span><span class="keyword">for</span><span class="normal"> </span><span class="symbol">(</span><span class="type">unsigned</span><span class="normal"> i</span><span class="symbol">=</span><span class="number">0</span><span class="symbol">;</span><span class="normal"> i </span><span class="symbol">&lt;</span><span class="normal"> n</span><span class="symbol">-</span><span class="number">1</span><span class="symbol">;</span><span class="normal"> </span><span class="symbol">++</span><span class="normal">i</span><span class="symbol">)</span>
<span class="normal">			lcp_input</span><span class="symbol">[</span><span class="normal">i</span><span class="symbol">]</span><span class="normal"> </span><span class="symbol">=</span><span class="normal"> </span><span class="function">lcp</span><span class="symbol">(</span><span class="normal">strings_input</span><span class="symbol">[</span><span class="normal">i</span><span class="symbol">],</span><span class="normal"> strings_input</span><span class="symbol">[</span><span class="normal">i</span><span class="symbol">+</span><span class="number">1</span><span class="symbol">]);</span>
<span class="normal">		</span><span class="keyword">return</span><span class="normal"> SortedInPlace</span><span class="symbol">;</span>
<span class="normal">	</span><span class="cbracket">}</span>
<span class="normal">	</span><span class="keyword">const</span><span class="normal"> </span><span class="usertype">size_t</span><span class="normal"> split0 </span><span class="symbol">=</span><span class="normal"> n</span><span class="symbol">/</span><span class="number">2</span><span class="symbol">;</span>
<span class="normal">	</span><span class="usertype">MergeResult</span><span class="normal"> ml </span><span class="symbol">=</span><span class="normal"> mergesort_lcp_2way</span><span class="symbol">&lt;</span><span class="keyword">true</span><span class="symbol">&gt;(</span>
<span class="normal">			strings_input</span><span class="symbol">,</span><span class="normal"> strings_output</span><span class="symbol">,</span>
<span class="normal">			lcp_input</span><span class="symbol">,</span><span class="normal">     lcp_output</span><span class="symbol">,</span>
<span class="normal">			split0</span><span class="symbol">);</span>
<span class="normal">	</span><span class="usertype">MergeResult</span><span class="normal"> mr </span><span class="symbol">=</span><span class="normal"> mergesort_lcp_2way</span><span class="symbol">&lt;</span><span class="keyword">true</span><span class="symbol">&gt;(</span>
<span class="normal">			strings_input</span><span class="symbol">+</span><span class="normal">split0</span><span class="symbol">,</span><span class="normal"> strings_output</span><span class="symbol">+</span><span class="normal">split0</span><span class="symbol">,</span>
<span class="normal">			lcp_input</span><span class="symbol">+</span><span class="normal">split0</span><span class="symbol">,</span><span class="normal">     lcp_output</span><span class="symbol">+</span><span class="normal">split0</span><span class="symbol">,</span>
<span class="normal">			n</span><span class="symbol">-</span><span class="normal">split0</span><span class="symbol">);</span>
<span class="normal">	</span><span class="keyword">if</span><span class="normal"> </span><span class="symbol">(</span><span class="normal">ml </span><span class="symbol">!=</span><span class="normal"> mr</span><span class="symbol">)</span><span class="normal"> </span><span class="cbracket">{</span>
<span class="normal">		</span><span class="keyword">if</span><span class="normal"> </span><span class="symbol">(</span><span class="normal">ml </span><span class="symbol">==</span><span class="normal"> SortedInPlace</span><span class="symbol">)</span><span class="normal"> </span><span class="cbracket">{</span>
<span class="normal">			std</span><span class="symbol">::</span><span class="function">copy</span><span class="symbol">(</span><span class="normal">strings_output</span><span class="symbol">+</span><span class="normal">split0</span><span class="symbol">,</span><span class="normal"> strings_output</span><span class="symbol">+</span><span class="normal">n</span><span class="symbol">,</span>
<span class="normal">					strings_input</span><span class="symbol">+</span><span class="normal">split0</span><span class="symbol">);</span>
<span class="normal">			std</span><span class="symbol">::</span><span class="function">copy</span><span class="symbol">(</span><span class="normal">lcp_output</span><span class="symbol">+</span><span class="normal">split0</span><span class="symbol">,</span><span class="normal"> lcp_output</span><span class="symbol">+</span><span class="normal">n</span><span class="symbol">,</span>
<span class="normal">					lcp_input</span><span class="symbol">+</span><span class="normal">split0</span><span class="symbol">);</span>
<span class="normal">			mr </span><span class="symbol">=</span><span class="normal"> SortedInPlace</span><span class="symbol">;</span>
<span class="normal">		</span><span class="cbracket">}</span><span class="normal"> </span><span class="keyword">else</span><span class="normal"> </span><span class="cbracket">{</span>
<span class="normal">			</span><span class="function">assert</span><span class="symbol">(</span><span class="number">0</span><span class="symbol">);</span>
<span class="normal">			</span><span class="function">abort</span><span class="symbol">();</span>
<span class="normal">		</span><span class="cbracket">}</span>
<span class="normal">	</span><span class="cbracket">}</span>
<span class="normal">	</span><span class="keyword">if</span><span class="normal"> </span><span class="symbol">(</span><span class="normal">ml </span><span class="symbol">==</span><span class="normal"> SortedInPlace</span><span class="symbol">)</span><span class="normal"> </span><span class="cbracket">{</span>
<span class="normal">		merge_lcp_2way</span><span class="symbol">&lt;</span><span class="normal">OutputLCP</span><span class="symbol">&gt;(</span>
<span class="normal">		           strings_input</span><span class="symbol">,</span><span class="normal">        lcp_input</span><span class="symbol">,</span><span class="normal">        split0</span><span class="symbol">,</span>
<span class="normal">		           strings_input</span><span class="symbol">+</span><span class="normal">split0</span><span class="symbol">,</span><span class="normal"> lcp_input</span><span class="symbol">+</span><span class="normal">split0</span><span class="symbol">,</span><span class="normal"> n</span><span class="symbol">-</span><span class="normal">split0</span><span class="symbol">,</span>
<span class="normal">		           strings_output</span><span class="symbol">,</span><span class="normal"> lcp_output</span><span class="symbol">);</span>
<span class="normal">		</span><span class="keyword">return</span><span class="normal"> SortedInTemp</span><span class="symbol">;</span>
<span class="normal">	</span><span class="cbracket">}</span><span class="normal"> </span><span class="keyword">else</span><span class="normal"> </span><span class="cbracket">{</span>
<span class="normal">		merge_lcp_2way</span><span class="symbol">&lt;</span><span class="normal">OutputLCP</span><span class="symbol">&gt;(</span>
<span class="normal">		           strings_output</span><span class="symbol">,</span><span class="normal">        lcp_output</span><span class="symbol">,</span><span class="normal">        split0</span><span class="symbol">,</span>
<span class="normal">		           strings_output</span><span class="symbol">+</span><span class="normal">split0</span><span class="symbol">,</span><span class="normal"> lcp_output</span><span class="symbol">+</span><span class="normal">split0</span><span class="symbol">,</span><span class="normal"> n</span><span class="symbol">-</span><span class="normal">split0</span><span class="symbol">,</span>
<span class="normal">		           strings_input</span><span class="symbol">,</span><span class="normal"> lcp_input</span><span class="symbol">);</span>
<span class="normal">		</span><span class="keyword">return</span><span class="normal"> SortedInPlace</span><span class="symbol">;</span>
<span class="normal">	</span><span class="cbracket">}</span>
<span class="cbracket">}</span>
<span class="type">void</span>
<span class="function">mergesort_lcp_2way</span><span class="symbol">(</span><span class="type">unsigned</span><span class="normal"> </span><span class="type">char</span><span class="symbol">**</span><span class="normal"> strings</span><span class="symbol">,</span><span class="normal"> </span><span class="usertype">size_t</span><span class="normal"> n</span><span class="symbol">)</span>
<span class="cbracket">{</span>
<span class="normal">	lcp_t</span><span class="symbol">*</span><span class="normal"> lcp_input  </span><span class="symbol">=</span><span class="normal"> </span><span class="keyword">static_cast</span><span class="symbol">&lt;</span><span class="normal">lcp_t</span><span class="symbol">*&gt;(</span><span class="function">malloc</span><span class="symbol">(</span><span class="normal">n</span><span class="symbol">*</span><span class="keyword">sizeof</span><span class="symbol">(</span><span class="normal">lcp_t</span><span class="symbol">)));</span>
<span class="normal">	lcp_t</span><span class="symbol">*</span><span class="normal"> lcp_output </span><span class="symbol">=</span><span class="normal"> </span><span class="keyword">static_cast</span><span class="symbol">&lt;</span><span class="normal">lcp_t</span><span class="symbol">*&gt;(</span><span class="function">malloc</span><span class="symbol">(</span><span class="normal">n</span><span class="symbol">*</span><span class="keyword">sizeof</span><span class="symbol">(</span><span class="normal">lcp_t</span><span class="symbol">)));</span>
<span class="normal">	</span><span class="type">unsigned</span><span class="normal"> </span><span class="type">char</span><span class="symbol">**</span><span class="normal"> tmp </span><span class="symbol">=</span><span class="normal"> </span><span class="keyword">static_cast</span><span class="symbol">&lt;</span><span class="type">unsigned</span><span class="normal"> </span><span class="type">char</span><span class="symbol">**&gt;(</span>
<span class="normal">			</span><span class="function">malloc</span><span class="symbol">(</span><span class="normal">n</span><span class="symbol">*</span><span class="keyword">sizeof</span><span class="symbol">(</span><span class="type">unsigned</span><span class="normal"> </span><span class="type">char</span><span class="symbol">*)));</span>
<span class="normal">	</span><span class="keyword">const</span><span class="normal"> </span><span class="usertype">MergeResult</span><span class="normal"> m </span><span class="symbol">=</span><span class="normal"> mergesort_lcp_2way</span><span class="symbol">&lt;</span><span class="keyword">false</span><span class="symbol">&gt;(</span><span class="normal">strings</span><span class="symbol">,</span><span class="normal"> tmp</span><span class="symbol">,</span>
<span class="normal">			lcp_input</span><span class="symbol">,</span><span class="normal"> lcp_output</span><span class="symbol">,</span><span class="normal"> n</span><span class="symbol">);</span>
<span class="normal">	</span><span class="keyword">if</span><span class="normal"> </span><span class="symbol">(</span><span class="normal">m </span><span class="symbol">==</span><span class="normal"> SortedInTemp</span><span class="symbol">)</span><span class="normal"> </span><span class="cbracket">{</span>
<span class="normal">		</span><span class="symbol">(</span><span class="type">void</span><span class="symbol">)</span><span class="normal"> </span><span class="function">memcpy</span><span class="symbol">(</span><span class="normal">strings</span><span class="symbol">,</span><span class="normal"> tmp</span><span class="symbol">,</span><span class="normal"> n</span><span class="symbol">*</span><span class="keyword">sizeof</span><span class="symbol">(</span><span class="type">unsigned</span><span class="normal"> </span><span class="type">char</span><span class="symbol">*));</span>
<span class="normal">	</span><span class="cbracket">}</span>
<span class="normal">	</span><span class="function">free</span><span class="symbol">(</span><span class="normal">lcp_input</span><span class="symbol">);</span>
<span class="normal">	</span><span class="function">free</span><span class="symbol">(</span><span class="normal">lcp_output</span><span class="symbol">);</span>
<span class="normal">	</span><span class="function">free</span><span class="symbol">(</span><span class="normal">tmp</span><span class="symbol">);</span>
<span class="cbracket">}</span>
<span class="function">CONTESTANT_REGISTER</span><span class="symbol">(</span><span class="normal">mergesort_lcp_2way</span><span class="symbol">,</span>
<span class="normal">                    </span><span class="string">"rantala/mergesort_lcp_2way"</span><span class="symbol">,</span>
<span class="normal">                    </span><span class="string">"mergesort LCP with 2way merger"</span><span class="symbol">)</span>

<span class="keyword">template</span><span class="normal"> </span><span class="symbol">&lt;</span><span class="type">bool</span><span class="normal"> OutputLCP</span><span class="symbol">&gt;</span>
<span class="normal">MergeResult</span>
<span class="function">mergesort_lcp_2way_parallel</span><span class="symbol">(</span>
<span class="normal">		</span><span class="type">unsigned</span><span class="normal"> </span><span class="type">char</span><span class="symbol">**</span><span class="normal"> </span><span class="usertype">restrict</span><span class="normal"> strings_input</span><span class="symbol">,</span>
<span class="normal">		</span><span class="type">unsigned</span><span class="normal"> </span><span class="type">char</span><span class="symbol">**</span><span class="normal"> </span><span class="usertype">restrict</span><span class="normal"> strings_output</span><span class="symbol">,</span>
<span class="normal">		lcp_t</span><span class="symbol">*</span><span class="normal"> </span><span class="usertype">restrict</span><span class="normal"> lcp_input</span><span class="symbol">,</span><span class="normal"> lcp_t</span><span class="symbol">*</span><span class="normal"> </span><span class="usertype">restrict</span><span class="normal"> lcp_output</span><span class="symbol">,</span>
<span class="normal">		</span><span class="usertype">size_t</span><span class="normal"> n</span><span class="symbol">)</span>
<span class="cbracket">{</span>
<span class="normal">	</span><span class="function">assert</span><span class="symbol">(</span><span class="normal">n </span><span class="symbol">&gt;</span><span class="normal"> </span><span class="number">0</span><span class="symbol">);</span>
<span class="normal">	</span><span class="function">debug</span><span class="symbol">()</span><span class="normal"> </span><span class="symbol">&lt;&lt;</span><span class="normal"> __func__ </span><span class="symbol">&lt;&lt;</span><span class="normal"> </span><span class="string">"(): n="</span><span class="normal"> </span><span class="symbol">&lt;&lt;</span><span class="normal"> n </span><span class="symbol">&lt;&lt;</span><span class="normal"> </span><span class="string">'</span><span class="specialchar">\n</span><span class="string">'</span><span class="symbol">;</span>
<span class="normal">	</span><span class="keyword">if</span><span class="normal"> </span><span class="symbol">(</span><span class="normal">n </span><span class="symbol">&lt;</span><span class="normal"> </span><span class="number">32</span><span class="symbol">)</span><span class="normal"> </span><span class="cbracket">{</span>
<span class="normal">		</span><span class="function">insertion_sort</span><span class="symbol">(</span><span class="normal">strings_input</span><span class="symbol">,</span><span class="normal"> n</span><span class="symbol">,</span><span class="normal"> </span><span class="number">0</span><span class="symbol">);</span>
<span class="normal">		</span><span class="keyword">for</span><span class="normal"> </span><span class="symbol">(</span><span class="type">unsigned</span><span class="normal"> i</span><span class="symbol">=</span><span class="number">0</span><span class="symbol">;</span><span class="normal"> i </span><span class="symbol">&lt;</span><span class="normal"> n</span><span class="symbol">-</span><span class="number">1</span><span class="symbol">;</span><span class="normal"> </span><span class="symbol">++</span><span class="normal">i</span><span class="symbol">)</span>
<span class="normal">			lcp_input</span><span class="symbol">[</span><span class="normal">i</span><span class="symbol">]</span><span class="normal"> </span><span class="symbol">=</span><span class="normal"> </span><span class="function">lcp</span><span class="symbol">(</span><span class="normal">strings_input</span><span class="symbol">[</span><span class="normal">i</span><span class="symbol">],</span><span class="normal"> strings_input</span><span class="symbol">[</span><span class="normal">i</span><span class="symbol">+</span><span class="number">1</span><span class="symbol">]);</span>
<span class="normal">		</span><span class="keyword">return</span><span class="normal"> SortedInPlace</span><span class="symbol">;</span>
<span class="normal">	</span><span class="cbracket">}</span>
<span class="normal">	</span><span class="keyword">const</span><span class="normal"> </span><span class="usertype">size_t</span><span class="normal"> split0 </span><span class="symbol">=</span><span class="normal"> n</span><span class="symbol">/</span><span class="number">2</span><span class="symbol">;</span>
<span class="normal">        </span><span class="usertype">MergeResult</span><span class="normal"> ml</span><span class="symbol">,</span><span class="normal"> mr</span><span class="symbol">;</span>

<span class="preproc">#pragma</span><span class="normal"> omp </span><span class="usertype">task</span><span class="normal"> </span><span class="function">shared</span><span class="symbol">(</span><span class="normal">ml</span><span class="symbol">)</span>
<span class="normal">        ml </span><span class="symbol">=</span><span class="normal"> mergesort_lcp_2way_parallel</span><span class="symbol">&lt;</span><span class="keyword">true</span><span class="symbol">&gt;(</span>
<span class="normal">            strings_input</span><span class="symbol">,</span><span class="normal"> strings_output</span><span class="symbol">,</span>
<span class="normal">            lcp_input</span><span class="symbol">,</span><span class="normal">     lcp_output</span><span class="symbol">,</span>
<span class="normal">            split0</span><span class="symbol">);</span>

<span class="preproc">#pragma</span><span class="normal"> omp </span><span class="usertype">task</span><span class="normal"> </span><span class="function">shared</span><span class="symbol">(</span><span class="normal">mr</span><span class="symbol">)</span>
<span class="normal">        mr </span><span class="symbol">=</span><span class="normal"> mergesort_lcp_2way_parallel</span><span class="symbol">&lt;</span><span class="keyword">true</span><span class="symbol">&gt;(</span>
<span class="normal">            strings_input</span><span class="symbol">+</span><span class="normal">split0</span><span class="symbol">,</span><span class="normal"> strings_output</span><span class="symbol">+</span><span class="normal">split0</span><span class="symbol">,</span>
<span class="normal">            lcp_input</span><span class="symbol">+</span><span class="normal">split0</span><span class="symbol">,</span><span class="normal">     lcp_output</span><span class="symbol">+</span><span class="normal">split0</span><span class="symbol">,</span>
<span class="normal">            n</span><span class="symbol">-</span><span class="normal">split0</span><span class="symbol">);</span>

<span class="preproc">#pragma</span><span class="normal"> omp taskwait</span>

<span class="normal">	</span><span class="keyword">if</span><span class="normal"> </span><span class="symbol">(</span><span class="normal">ml </span><span class="symbol">!=</span><span class="normal"> mr</span><span class="symbol">)</span><span class="normal"> </span><span class="cbracket">{</span>
<span class="normal">		</span><span class="keyword">if</span><span class="normal"> </span><span class="symbol">(</span><span class="normal">ml </span><span class="symbol">==</span><span class="normal"> SortedInPlace</span><span class="symbol">)</span><span class="normal"> </span><span class="cbracket">{</span>
<span class="normal">			std</span><span class="symbol">::</span><span class="function">copy</span><span class="symbol">(</span><span class="normal">strings_output</span><span class="symbol">+</span><span class="normal">split0</span><span class="symbol">,</span><span class="normal"> strings_output</span><span class="symbol">+</span><span class="normal">n</span><span class="symbol">,</span>
<span class="normal">					strings_input</span><span class="symbol">+</span><span class="normal">split0</span><span class="symbol">);</span>
<span class="normal">			std</span><span class="symbol">::</span><span class="function">copy</span><span class="symbol">(</span><span class="normal">lcp_output</span><span class="symbol">+</span><span class="normal">split0</span><span class="symbol">,</span><span class="normal"> lcp_output</span><span class="symbol">+</span><span class="normal">n</span><span class="symbol">,</span>
<span class="normal">					lcp_input</span><span class="symbol">+</span><span class="normal">split0</span><span class="symbol">);</span>
<span class="normal">			mr </span><span class="symbol">=</span><span class="normal"> SortedInPlace</span><span class="symbol">;</span>
<span class="normal">		</span><span class="cbracket">}</span><span class="normal"> </span><span class="keyword">else</span><span class="normal"> </span><span class="cbracket">{</span>
<span class="normal">			</span><span class="function">assert</span><span class="symbol">(</span><span class="number">0</span><span class="symbol">);</span>
<span class="normal">			</span><span class="function">abort</span><span class="symbol">();</span>
<span class="normal">		</span><span class="cbracket">}</span>
<span class="normal">	</span><span class="cbracket">}</span>
<span class="normal">	</span><span class="keyword">if</span><span class="normal"> </span><span class="symbol">(</span><span class="normal">ml </span><span class="symbol">==</span><span class="normal"> SortedInPlace</span><span class="symbol">)</span><span class="normal"> </span><span class="cbracket">{</span>
<span class="normal">		merge_lcp_2way</span><span class="symbol">&lt;</span><span class="normal">OutputLCP</span><span class="symbol">&gt;(</span>
<span class="normal">		           strings_input</span><span class="symbol">,</span><span class="normal">        lcp_input</span><span class="symbol">,</span><span class="normal">        split0</span><span class="symbol">,</span>
<span class="normal">		           strings_input</span><span class="symbol">+</span><span class="normal">split0</span><span class="symbol">,</span><span class="normal"> lcp_input</span><span class="symbol">+</span><span class="normal">split0</span><span class="symbol">,</span><span class="normal"> n</span><span class="symbol">-</span><span class="normal">split0</span><span class="symbol">,</span>
<span class="normal">		           strings_output</span><span class="symbol">,</span><span class="normal"> lcp_output</span><span class="symbol">);</span>
<span class="normal">		</span><span class="keyword">return</span><span class="normal"> SortedInTemp</span><span class="symbol">;</span>
<span class="normal">	</span><span class="cbracket">}</span><span class="normal"> </span><span class="keyword">else</span><span class="normal"> </span><span class="cbracket">{</span>
<span class="normal">		merge_lcp_2way</span><span class="symbol">&lt;</span><span class="normal">OutputLCP</span><span class="symbol">&gt;(</span>
<span class="normal">		           strings_output</span><span class="symbol">,</span><span class="normal">        lcp_output</span><span class="symbol">,</span><span class="normal">        split0</span><span class="symbol">,</span>
<span class="normal">		           strings_output</span><span class="symbol">+</span><span class="normal">split0</span><span class="symbol">,</span><span class="normal"> lcp_output</span><span class="symbol">+</span><span class="normal">split0</span><span class="symbol">,</span><span class="normal"> n</span><span class="symbol">-</span><span class="normal">split0</span><span class="symbol">,</span>
<span class="normal">		           strings_input</span><span class="symbol">,</span><span class="normal"> lcp_input</span><span class="symbol">);</span>
<span class="normal">		</span><span class="keyword">return</span><span class="normal"> SortedInPlace</span><span class="symbol">;</span>
<span class="normal">	</span><span class="cbracket">}</span>
<span class="cbracket">}</span>
<span class="type">void</span>
<span class="function">mergesort_lcp_2way_parallel</span><span class="symbol">(</span><span class="type">unsigned</span><span class="normal"> </span><span class="type">char</span><span class="symbol">**</span><span class="normal"> strings</span><span class="symbol">,</span><span class="normal"> </span><span class="usertype">size_t</span><span class="normal"> n</span><span class="symbol">)</span>
<span class="cbracket">{</span>
<span class="normal">	lcp_t</span><span class="symbol">*</span><span class="normal"> lcp_input  </span><span class="symbol">=</span><span class="normal"> </span><span class="keyword">static_cast</span><span class="symbol">&lt;</span><span class="normal">lcp_t</span><span class="symbol">*&gt;(</span><span class="function">malloc</span><span class="symbol">(</span><span class="normal">n</span><span class="symbol">*</span><span class="keyword">sizeof</span><span class="symbol">(</span><span class="normal">lcp_t</span><span class="symbol">)));</span>
<span class="normal">	lcp_t</span><span class="symbol">*</span><span class="normal"> lcp_output </span><span class="symbol">=</span><span class="normal"> </span><span class="keyword">static_cast</span><span class="symbol">&lt;</span><span class="normal">lcp_t</span><span class="symbol">*&gt;(</span><span class="function">malloc</span><span class="symbol">(</span><span class="normal">n</span><span class="symbol">*</span><span class="keyword">sizeof</span><span class="symbol">(</span><span class="normal">lcp_t</span><span class="symbol">)));</span>
<span class="normal">	</span><span class="type">unsigned</span><span class="normal"> </span><span class="type">char</span><span class="symbol">**</span><span class="normal"> tmp </span><span class="symbol">=</span><span class="normal"> </span><span class="keyword">static_cast</span><span class="symbol">&lt;</span><span class="type">unsigned</span><span class="normal"> </span><span class="type">char</span><span class="symbol">**&gt;(</span>
<span class="normal">			</span><span class="function">malloc</span><span class="symbol">(</span><span class="normal">n</span><span class="symbol">*</span><span class="keyword">sizeof</span><span class="symbol">(</span><span class="type">unsigned</span><span class="normal"> </span><span class="type">char</span><span class="symbol">*)));</span>
<span class="preproc">#pragma</span><span class="normal"> omp parallel</span>
<span class="normal">        </span><span class="cbracket">{</span>
<span class="preproc">#pragma</span><span class="normal"> omp single</span>
<span class="normal">            </span><span class="cbracket">{</span>
<span class="normal">                </span><span class="usertype">MergeResult</span><span class="normal"> m </span><span class="symbol">=</span><span class="normal"> mergesort_lcp_2way_parallel</span><span class="symbol">&lt;</span><span class="keyword">false</span><span class="symbol">&gt;(</span><span class="normal">strings</span><span class="symbol">,</span><span class="normal"> tmp</span><span class="symbol">,</span>
<span class="normal">                                                                   lcp_input</span><span class="symbol">,</span><span class="normal"> lcp_output</span><span class="symbol">,</span><span class="normal"> n</span><span class="symbol">);</span>
<span class="normal">                </span><span class="keyword">if</span><span class="normal"> </span><span class="symbol">(</span><span class="normal">m </span><span class="symbol">==</span><span class="normal"> SortedInTemp</span><span class="symbol">)</span><span class="normal"> </span><span class="cbracket">{</span>
<span class="normal">                    </span><span class="function">memcpy</span><span class="symbol">(</span><span class="normal">strings</span><span class="symbol">,</span><span class="normal"> tmp</span><span class="symbol">,</span><span class="normal"> n</span><span class="symbol">*</span><span class="keyword">sizeof</span><span class="symbol">(</span><span class="type">unsigned</span><span class="normal"> </span><span class="type">char</span><span class="symbol">*));</span>
<span class="normal">                </span><span class="cbracket">}</span>
<span class="normal">            </span><span class="cbracket">}</span>
<span class="normal">        </span><span class="cbracket">}</span>
<span class="normal">	</span><span class="function">free</span><span class="symbol">(</span><span class="normal">lcp_input</span><span class="symbol">);</span>
<span class="normal">	</span><span class="function">free</span><span class="symbol">(</span><span class="normal">lcp_output</span><span class="symbol">);</span>
<span class="normal">	</span><span class="function">free</span><span class="symbol">(</span><span class="normal">tmp</span><span class="symbol">);</span>
<span class="cbracket">}</span>
<span class="function">CONTESTANT_REGISTER_PARALLEL</span><span class="symbol">(</span><span class="normal">mergesort_lcp_2way_parallel</span><span class="symbol">,</span>
<span class="normal">                             </span><span class="string">"rantala/mergesort_lcp_2way_parallel"</span><span class="symbol">,</span>
<span class="normal">                             </span><span class="string">"mergesort_parallel LCP with 2way merger"</span><span class="symbol">)</span>

<span class="comment">/*******************************************************************************</span>
<span class="comment"> *</span>
<span class="comment"> * mergesort_lcp_3way</span>
<span class="comment"> *</span>
<span class="comment"> ******************************************************************************/</span>

<span class="keyword">static</span><span class="normal"> </span><span class="type">void</span>
<span class="function">check_lcps</span><span class="symbol">(</span><span class="type">unsigned</span><span class="normal"> </span><span class="type">char</span><span class="symbol">*</span><span class="normal"> latest</span><span class="symbol">,</span>
<span class="normal">           </span><span class="type">unsigned</span><span class="normal"> </span><span class="type">char</span><span class="symbol">*</span><span class="normal"> from0</span><span class="symbol">,</span><span class="normal"> </span><span class="usertype">lcp_t</span><span class="normal"> lcp0</span><span class="symbol">,</span>
<span class="normal">           </span><span class="type">unsigned</span><span class="normal"> </span><span class="type">char</span><span class="symbol">*</span><span class="normal"> from1</span><span class="symbol">,</span><span class="normal"> </span><span class="usertype">lcp_t</span><span class="normal"> lcp1</span><span class="symbol">,</span>
<span class="normal">           </span><span class="type">unsigned</span><span class="normal"> </span><span class="type">char</span><span class="symbol">*</span><span class="normal"> from2</span><span class="symbol">,</span><span class="normal"> </span><span class="usertype">lcp_t</span><span class="normal"> lcp2</span><span class="symbol">)</span>
<span class="cbracket">{</span>
<span class="normal">	</span><span class="function">debug</span><span class="symbol">()&lt;&lt;</span><span class="string">"******** CHECK ********</span><span class="specialchar">\n</span><span class="string">"</span>
<span class="normal">	       </span><span class="symbol">&lt;&lt;</span><span class="string">"Latest: '"</span><span class="symbol">&lt;&lt;</span><span class="normal">latest</span><span class="symbol">&lt;&lt;</span><span class="string">"'</span><span class="specialchar">\n</span><span class="string">"</span>
<span class="normal">	       </span><span class="symbol">&lt;&lt;</span><span class="string">"     0: '"</span><span class="symbol">&lt;&lt;</span><span class="normal">from0</span><span class="symbol">&lt;&lt;</span><span class="string">"', lcp="</span><span class="symbol">&lt;&lt;</span><span class="normal">lcp0</span><span class="symbol">&lt;&lt;</span><span class="string">"</span><span class="specialchar">\n</span><span class="string">"</span>
<span class="normal">	       </span><span class="symbol">&lt;&lt;</span><span class="string">"     1: '"</span><span class="symbol">&lt;&lt;</span><span class="normal">from1</span><span class="symbol">&lt;&lt;</span><span class="string">"', lcp="</span><span class="symbol">&lt;&lt;</span><span class="normal">lcp1</span><span class="symbol">&lt;&lt;</span><span class="string">"</span><span class="specialchar">\n</span><span class="string">"</span>
<span class="normal">	       </span><span class="symbol">&lt;&lt;</span><span class="string">"     2: '"</span><span class="symbol">&lt;&lt;</span><span class="normal">from2</span><span class="symbol">&lt;&lt;</span><span class="string">"', lcp="</span><span class="symbol">&lt;&lt;</span><span class="normal">lcp2</span><span class="symbol">&lt;&lt;</span><span class="string">"</span><span class="specialchar">\n</span><span class="string">"</span>
<span class="normal">	       </span><span class="symbol">&lt;&lt;</span><span class="string">"***********************</span><span class="specialchar">\n</span><span class="string">"</span><span class="symbol">;</span>
<span class="normal">	</span><span class="function">assert</span><span class="symbol">(</span><span class="function">lcp</span><span class="symbol">(</span><span class="normal">latest</span><span class="symbol">,</span><span class="normal"> from0</span><span class="symbol">)</span><span class="normal"> </span><span class="symbol">==</span><span class="normal"> lcp0</span><span class="symbol">);</span>
<span class="normal">	</span><span class="function">assert</span><span class="symbol">(</span><span class="function">lcp</span><span class="symbol">(</span><span class="normal">latest</span><span class="symbol">,</span><span class="normal"> from1</span><span class="symbol">)</span><span class="normal"> </span><span class="symbol">==</span><span class="normal"> lcp1</span><span class="symbol">);</span>
<span class="normal">	</span><span class="function">assert</span><span class="symbol">(</span><span class="function">lcp</span><span class="symbol">(</span><span class="normal">latest</span><span class="symbol">,</span><span class="normal"> from2</span><span class="symbol">)</span><span class="normal"> </span><span class="symbol">==</span><span class="normal"> lcp2</span><span class="symbol">);</span>
<span class="cbracket">}</span>

<span class="keyword">static</span><span class="normal"> </span><span class="type">void</span>
<span class="function">check_input</span><span class="symbol">(</span><span class="type">unsigned</span><span class="normal"> </span><span class="type">char</span><span class="symbol">**</span><span class="normal"> from0</span><span class="symbol">,</span><span class="normal"> lcp_t</span><span class="symbol">*</span><span class="normal"> lcp_input0</span><span class="symbol">,</span><span class="normal"> </span><span class="usertype">size_t</span><span class="normal"> n0</span><span class="symbol">)</span>
<span class="cbracket">{</span>
<span class="normal">	</span><span class="symbol">(</span><span class="type">void</span><span class="symbol">)</span><span class="normal"> from0</span><span class="symbol">;</span>
<span class="normal">	</span><span class="symbol">(</span><span class="type">void</span><span class="symbol">)</span><span class="normal"> lcp_input0</span><span class="symbol">;</span>
<span class="normal">	</span><span class="symbol">(</span><span class="type">void</span><span class="symbol">)</span><span class="normal"> n0</span><span class="symbol">;</span>
<span class="preproc">#ifndef</span><span class="normal"> NDEBUG</span>
<span class="normal">	</span><span class="keyword">for</span><span class="symbol">(</span><span class="usertype">size_t</span><span class="normal"> i</span><span class="symbol">=</span><span class="number">1</span><span class="symbol">;</span><span class="normal">i</span><span class="symbol">&lt;</span><span class="normal">n0</span><span class="symbol">;++</span><span class="normal">i</span><span class="symbol">)</span><span class="keyword">if</span><span class="symbol">(</span><span class="function">cmp</span><span class="symbol">(</span><span class="normal">from0</span><span class="symbol">[</span><span class="normal">i</span><span class="symbol">-</span><span class="number">1</span><span class="symbol">],</span><span class="normal">from0</span><span class="symbol">[</span><span class="normal">i</span><span class="symbol">])&gt;</span><span class="number">0</span><span class="symbol">)</span><span class="cbracket">{</span>
<span class="normal">		</span><span class="function">debug</span><span class="symbol">()&lt;&lt;</span><span class="string">"Oops: ''"</span><span class="symbol">&lt;&lt;</span><span class="normal">from0</span><span class="symbol">[</span><span class="normal">i</span><span class="symbol">-</span><span class="number">1</span><span class="symbol">]&lt;&lt;</span><span class="string">"'' &gt; ''"</span><span class="symbol">&lt;&lt;</span><span class="normal">from0</span><span class="symbol">[</span><span class="normal">i</span><span class="symbol">]&lt;&lt;</span><span class="string">"''</span><span class="specialchar">\n</span><span class="string">"</span><span class="symbol">;</span><span class="cbracket">}</span>
<span class="normal">	</span><span class="keyword">for</span><span class="symbol">(</span><span class="usertype">size_t</span><span class="normal"> i</span><span class="symbol">=</span><span class="number">1</span><span class="symbol">;</span><span class="normal">i</span><span class="symbol">&lt;</span><span class="normal">n0</span><span class="symbol">;++</span><span class="normal">i</span><span class="symbol">)</span><span class="keyword">if</span><span class="symbol">(</span><span class="function">lcp</span><span class="symbol">(</span><span class="normal">from0</span><span class="symbol">[</span><span class="normal">i</span><span class="symbol">-</span><span class="number">1</span><span class="symbol">],</span><span class="normal">from0</span><span class="symbol">[</span><span class="normal">i</span><span class="symbol">])!=</span><span class="normal">lcp_input0</span><span class="symbol">[</span><span class="normal">i</span><span class="symbol">-</span><span class="number">1</span><span class="symbol">])</span><span class="cbracket">{</span>
<span class="normal">		</span><span class="function">debug</span><span class="symbol">()&lt;&lt;</span><span class="string">"Oops: "</span><span class="symbol">&lt;&lt;</span><span class="string">"lcp('"</span><span class="symbol">&lt;&lt;</span><span class="normal">from0</span><span class="symbol">[</span><span class="normal">i</span><span class="symbol">-</span><span class="number">1</span><span class="symbol">]&lt;&lt;</span><span class="string">"', '"</span><span class="symbol">&lt;&lt;</span><span class="normal">from0</span><span class="symbol">[</span><span class="normal">i</span><span class="symbol">]&lt;&lt;</span><span class="string">"')="</span>
<span class="normal">			</span><span class="symbol">&lt;&lt;</span><span class="function">lcp</span><span class="symbol">(</span><span class="normal">from0</span><span class="symbol">[</span><span class="normal">i</span><span class="symbol">-</span><span class="number">1</span><span class="symbol">],</span><span class="normal">from0</span><span class="symbol">[</span><span class="normal">i</span><span class="symbol">])&lt;&lt;</span><span class="string">" != "</span><span class="symbol">&lt;&lt;</span><span class="normal">lcp_input0</span><span class="symbol">[</span><span class="normal">i</span><span class="symbol">-</span><span class="number">1</span><span class="symbol">]&lt;&lt;</span><span class="string">"</span><span class="specialchar">\n</span><span class="string">"</span><span class="symbol">;</span><span class="cbracket">}</span>
<span class="normal">	</span><span class="keyword">for</span><span class="symbol">(</span><span class="usertype">size_t</span><span class="normal"> i</span><span class="symbol">=</span><span class="number">1</span><span class="symbol">;</span><span class="normal">i</span><span class="symbol">&lt;</span><span class="normal">n0</span><span class="symbol">;++</span><span class="normal">i</span><span class="symbol">)</span><span class="function">assert</span><span class="symbol">(</span><span class="function">cmp</span><span class="symbol">(</span><span class="normal">from0</span><span class="symbol">[</span><span class="normal">i</span><span class="symbol">-</span><span class="number">1</span><span class="symbol">],</span><span class="normal">from0</span><span class="symbol">[</span><span class="normal">i</span><span class="symbol">])&lt;=</span><span class="number">0</span><span class="symbol">);</span>
<span class="normal">	</span><span class="keyword">for</span><span class="symbol">(</span><span class="usertype">size_t</span><span class="normal"> i</span><span class="symbol">=</span><span class="number">1</span><span class="symbol">;</span><span class="normal">i</span><span class="symbol">&lt;</span><span class="normal">n0</span><span class="symbol">;++</span><span class="normal">i</span><span class="symbol">)</span><span class="function">assert</span><span class="symbol">(</span><span class="function">lcp</span><span class="symbol">(</span><span class="normal">from0</span><span class="symbol">[</span><span class="normal">i</span><span class="symbol">-</span><span class="number">1</span><span class="symbol">],</span><span class="normal">from0</span><span class="symbol">[</span><span class="normal">i</span><span class="symbol">])==</span><span class="normal">lcp_input0</span><span class="symbol">[</span><span class="normal">i</span><span class="symbol">-</span><span class="number">1</span><span class="symbol">]);</span>
<span class="preproc">#endif</span>
<span class="cbracket">}</span>

<span class="keyword">template</span><span class="normal"> </span><span class="symbol">&lt;</span><span class="type">bool</span><span class="normal"> OutputLCP</span><span class="symbol">&gt;</span>
<span class="keyword">static</span><span class="normal"> </span><span class="type">void</span>
<span class="function">merge_lcp_3way</span><span class="symbol">(</span><span class="type">unsigned</span><span class="normal"> </span><span class="type">char</span><span class="symbol">**</span><span class="normal"> from0</span><span class="symbol">,</span><span class="normal"> lcp_t</span><span class="symbol">*</span><span class="normal"> lcp_input0</span><span class="symbol">,</span><span class="normal"> </span><span class="usertype">size_t</span><span class="normal"> n0</span><span class="symbol">,</span>
<span class="normal">               </span><span class="type">unsigned</span><span class="normal"> </span><span class="type">char</span><span class="symbol">**</span><span class="normal"> from1</span><span class="symbol">,</span><span class="normal"> lcp_t</span><span class="symbol">*</span><span class="normal"> lcp_input1</span><span class="symbol">,</span><span class="normal"> </span><span class="usertype">size_t</span><span class="normal"> n1</span><span class="symbol">,</span>
<span class="normal">               </span><span class="type">unsigned</span><span class="normal"> </span><span class="type">char</span><span class="symbol">**</span><span class="normal"> from2</span><span class="symbol">,</span><span class="normal"> lcp_t</span><span class="symbol">*</span><span class="normal"> lcp_input2</span><span class="symbol">,</span><span class="normal"> </span><span class="usertype">size_t</span><span class="normal"> n2</span><span class="symbol">,</span>
<span class="normal">               </span><span class="type">unsigned</span><span class="normal"> </span><span class="type">char</span><span class="symbol">**</span><span class="normal"> result</span><span class="symbol">,</span><span class="normal"> lcp_t</span><span class="symbol">*</span><span class="normal"> lcp_result</span><span class="symbol">)</span>
<span class="cbracket">{</span>
<span class="normal">	</span><span class="function">debug</span><span class="symbol">()&lt;&lt;</span><span class="normal">__func__</span><span class="symbol">&lt;&lt;</span><span class="string">"(), n0="</span><span class="symbol">&lt;&lt;</span><span class="normal">n0</span><span class="symbol">&lt;&lt;</span><span class="string">", n1="</span><span class="symbol">&lt;&lt;</span><span class="normal">n1</span><span class="symbol">&lt;&lt;</span><span class="string">", n2="</span><span class="symbol">&lt;&lt;</span><span class="normal">n2</span><span class="symbol">&lt;&lt;</span><span class="string">"</span><span class="specialchar">\n</span><span class="string">"</span><span class="symbol">;</span>
<span class="normal">	</span><span class="comment">/*</span>
<span class="comment">	debug()&lt;&lt;"*** STREAM 0 ***\n"; for (unsigned i=0;i&lt;n0;++i) { debug()&lt;&lt;"\t"&lt;&lt;from0[i]&lt;&lt;"\n"; }</span>
<span class="comment">	debug()&lt;&lt;"*** STREAM 1 ***\n"; for (unsigned i=0;i&lt;n1;++i) { debug()&lt;&lt;"\t"&lt;&lt;from1[i]&lt;&lt;"\n"; }</span>
<span class="comment">	debug()&lt;&lt;"*** STREAM 2 ***\n"; for (unsigned i=0;i&lt;n2;++i) { debug()&lt;&lt;"\t"&lt;&lt;from2[i]&lt;&lt;"\n"; }</span>
<span class="comment">	debug()&lt;&lt;"******\n";</span>
<span class="comment">	*/</span>
<span class="normal">	</span><span class="function">check_input</span><span class="symbol">(</span><span class="normal">from0</span><span class="symbol">,</span><span class="normal"> lcp_input0</span><span class="symbol">,</span><span class="normal"> n0</span><span class="symbol">);</span>
<span class="normal">	</span><span class="function">check_input</span><span class="symbol">(</span><span class="normal">from1</span><span class="symbol">,</span><span class="normal"> lcp_input1</span><span class="symbol">,</span><span class="normal"> n1</span><span class="symbol">);</span>
<span class="normal">	</span><span class="function">check_input</span><span class="symbol">(</span><span class="normal">from2</span><span class="symbol">,</span><span class="normal"> lcp_input2</span><span class="symbol">,</span><span class="normal"> n2</span><span class="symbol">);</span>
<span class="normal">	</span><span class="usertype">lcp_t</span><span class="normal"> lcp0</span><span class="symbol">=</span><span class="number">0</span><span class="symbol">,</span><span class="normal"> lcp1</span><span class="symbol">=</span><span class="number">0</span><span class="symbol">,</span><span class="normal"> lcp2</span><span class="symbol">=</span><span class="number">0</span><span class="symbol">;</span>

<span class="preproc">#define</span><span class="normal"> </span><span class="function">INITIAL_STATE</span><span class="symbol">(</span><span class="normal">output_lcps</span><span class="symbol">)</span><span class="normal">                                             </span><span class="symbol">\</span>
<span class="cbracket">{</span><span class="normal">                                                                              </span><span class="symbol">\</span>
<span class="normal">	</span><span class="function">assert</span><span class="symbol">(</span><span class="normal">lcp0 </span><span class="symbol">==</span><span class="normal"> lcp1</span><span class="symbol">);</span><span class="normal"> </span><span class="function">assert</span><span class="symbol">(</span><span class="normal">lcp1 </span><span class="symbol">==</span><span class="normal"> lcp2</span><span class="symbol">);</span><span class="normal">                            </span><span class="symbol">\</span>
<span class="normal">	</span><span class="type">int</span><span class="normal"> cmp01</span><span class="symbol">;</span><span class="normal"> </span><span class="usertype">lcp_t</span><span class="normal"> lcp01</span><span class="symbol">;</span><span class="normal">                                                </span><span class="symbol">\</span>
<span class="normal">	boost</span><span class="symbol">::</span><span class="function">tie</span><span class="symbol">(</span><span class="normal">cmp01</span><span class="symbol">,</span><span class="normal"> lcp01</span><span class="symbol">)</span><span class="normal"> </span><span class="symbol">=</span><span class="normal"> </span><span class="function">compare</span><span class="symbol">(*</span><span class="normal">from0</span><span class="symbol">,</span><span class="normal"> </span><span class="symbol">*</span><span class="normal">from1</span><span class="symbol">,</span><span class="normal"> lcp0</span><span class="symbol">);</span><span class="normal">              </span><span class="symbol">\</span>
<span class="normal">	</span><span class="keyword">if</span><span class="normal"> </span><span class="symbol">(</span><span class="normal">cmp01 </span><span class="symbol">==</span><span class="normal"> </span><span class="number">0</span><span class="symbol">)</span><span class="normal"> </span><span class="cbracket">{</span><span class="normal">                                                      </span><span class="symbol">\</span>
<span class="normal">		</span><span class="type">int</span><span class="normal"> cmp02</span><span class="symbol">;</span><span class="normal"> </span><span class="usertype">lcp_t</span><span class="normal"> lcp02</span><span class="symbol">;</span><span class="normal">                                        </span><span class="symbol">\</span>
<span class="normal">		boost</span><span class="symbol">::</span><span class="function">tie</span><span class="symbol">(</span><span class="normal">cmp02</span><span class="symbol">,</span><span class="normal"> lcp02</span><span class="symbol">)</span><span class="normal"> </span><span class="symbol">=</span><span class="normal"> </span><span class="function">compare</span><span class="symbol">(*</span><span class="normal">from0</span><span class="symbol">,</span><span class="normal"> </span><span class="symbol">*</span><span class="normal">from2</span><span class="symbol">,</span><span class="normal"> lcp0</span><span class="symbol">);</span><span class="normal">      </span><span class="symbol">\</span>
<span class="normal">		</span><span class="keyword">if</span><span class="normal"> </span><span class="symbol">(</span><span class="normal">cmp02 </span><span class="symbol">&lt;</span><span class="normal"> </span><span class="number">0</span><span class="symbol">)</span><span class="normal"> </span><span class="cbracket">{</span><span class="normal">                                               </span><span class="symbol">\</span>
<span class="normal">			</span><span class="function">debug</span><span class="symbol">()&lt;&lt;</span><span class="string">"</span><span class="specialchar">\t</span><span class="string">0 = 1 &lt; 2</span><span class="specialchar">\n</span><span class="string">"</span><span class="symbol">;</span><span class="normal">                              </span><span class="symbol">\</span>
<span class="normal">			</span><span class="function">assert</span><span class="symbol">(</span><span class="normal">lcp01 </span><span class="symbol">&gt;=</span><span class="normal"> lcp02</span><span class="symbol">);</span><span class="normal">                                 </span><span class="symbol">\</span>
<span class="normal">			</span><span class="symbol">*</span><span class="normal">result</span><span class="symbol">++</span><span class="normal"> </span><span class="symbol">=</span><span class="normal"> </span><span class="symbol">*</span><span class="normal">from0</span><span class="symbol">++;</span><span class="normal">                                  </span><span class="symbol">\</span>
<span class="normal">			</span><span class="keyword">if</span><span class="normal"> </span><span class="symbol">(</span><span class="normal">output_lcps </span><span class="symbol">&amp;&amp;</span><span class="normal"> OutputLCP</span><span class="symbol">)</span><span class="normal"> </span><span class="symbol">*</span><span class="normal">lcp_result</span><span class="symbol">++</span><span class="normal"> </span><span class="symbol">=</span><span class="normal"> lcp0</span><span class="symbol">;</span><span class="normal">    </span><span class="symbol">\</span>
<span class="normal">			lcp0 </span><span class="symbol">=</span><span class="normal"> </span><span class="symbol">*</span><span class="normal">lcp_input0</span><span class="symbol">++;</span><span class="normal">                                  </span><span class="symbol">\</span>
<span class="normal">			lcp1 </span><span class="symbol">=</span><span class="normal"> lcp01</span><span class="symbol">;</span><span class="normal">                                          </span><span class="symbol">\</span>
<span class="normal">			lcp2 </span><span class="symbol">=</span><span class="normal"> lcp02</span><span class="symbol">;</span><span class="normal">                                          </span><span class="symbol">\</span>
<span class="normal">			</span><span class="keyword">if</span><span class="normal"> </span><span class="symbol">(--</span><span class="normal">n0 </span><span class="symbol">==</span><span class="normal"> </span><span class="number">0</span><span class="symbol">)</span><span class="normal"> </span><span class="keyword">goto</span><span class="normal"> finish0</span><span class="symbol">;</span><span class="normal">                           </span><span class="symbol">\</span>
<span class="normal">			</span><span class="keyword">if</span><span class="normal"> </span><span class="symbol">(</span><span class="normal">lcp0 </span><span class="symbol">&gt;</span><span class="normal"> lcp1</span><span class="symbol">)</span><span class="normal">  </span><span class="keyword">goto</span><span class="normal"> lcp_0gt1gt2</span><span class="symbol">;</span><span class="normal">                    </span><span class="symbol">\</span>
<span class="normal">			</span><span class="keyword">if</span><span class="normal"> </span><span class="symbol">(</span><span class="normal">lcp0 </span><span class="symbol">==</span><span class="normal"> lcp1</span><span class="symbol">)</span><span class="normal"> </span><span class="keyword">goto</span><span class="normal"> lcp_0eq1gt2</span><span class="symbol">;</span><span class="normal">                    </span><span class="symbol">\</span>
<span class="normal">			</span><span class="keyword">if</span><span class="normal"> </span><span class="symbol">(</span><span class="normal">lcp0 </span><span class="symbol">&gt;</span><span class="normal"> lcp2</span><span class="symbol">)</span><span class="normal">  </span><span class="keyword">goto</span><span class="normal"> lcp_1gt0gt2</span><span class="symbol">;</span><span class="normal">                    </span><span class="symbol">\</span>
<span class="normal">			</span><span class="keyword">if</span><span class="normal"> </span><span class="symbol">(</span><span class="normal">lcp0 </span><span class="symbol">==</span><span class="normal"> lcp2</span><span class="symbol">)</span><span class="normal"> </span><span class="keyword">goto</span><span class="normal"> lcp_1gt0eq2</span><span class="symbol">;</span><span class="normal">                    </span><span class="symbol">\</span>
<span class="normal">			</span><span class="keyword">goto</span><span class="normal"> lcp_1gt2gt0</span><span class="symbol">;</span><span class="normal">                                      </span><span class="symbol">\</span>
<span class="normal">		</span><span class="cbracket">}</span><span class="normal"> </span><span class="keyword">else</span><span class="normal"> </span><span class="keyword">if</span><span class="normal"> </span><span class="symbol">(</span><span class="normal">cmp02 </span><span class="symbol">==</span><span class="normal"> </span><span class="number">0</span><span class="symbol">)</span><span class="normal"> </span><span class="cbracket">{</span><span class="normal">                                       </span><span class="symbol">\</span>
<span class="normal">			</span><span class="function">debug</span><span class="symbol">()&lt;&lt;</span><span class="string">"</span><span class="specialchar">\t</span><span class="string">0 = 1 = 2</span><span class="specialchar">\n</span><span class="string">"</span><span class="symbol">;</span><span class="normal">                              </span><span class="symbol">\</span>
<span class="normal">			</span><span class="function">assert</span><span class="symbol">(</span><span class="normal">lcp01 </span><span class="symbol">==</span><span class="normal"> lcp02</span><span class="symbol">);</span><span class="normal">                                </span><span class="symbol">\</span>
<span class="normal">			</span><span class="symbol">*</span><span class="normal">result</span><span class="symbol">++</span><span class="normal"> </span><span class="symbol">=</span><span class="normal"> </span><span class="symbol">*</span><span class="normal">from0</span><span class="symbol">++;</span><span class="normal">                                  </span><span class="symbol">\</span>
<span class="normal">			</span><span class="keyword">if</span><span class="normal"> </span><span class="symbol">(</span><span class="normal">output_lcps </span><span class="symbol">&amp;&amp;</span><span class="normal"> OutputLCP</span><span class="symbol">)</span><span class="normal"> </span><span class="symbol">*</span><span class="normal">lcp_result</span><span class="symbol">++</span><span class="normal"> </span><span class="symbol">=</span><span class="normal"> lcp0</span><span class="symbol">;</span><span class="normal">    </span><span class="symbol">\</span>
<span class="normal">			lcp0 </span><span class="symbol">=</span><span class="normal"> </span><span class="symbol">*</span><span class="normal">lcp_input0</span><span class="symbol">++;</span><span class="normal">                                  </span><span class="symbol">\</span>
<span class="normal">			lcp1 </span><span class="symbol">=</span><span class="normal"> lcp01</span><span class="symbol">;</span><span class="normal">                                          </span><span class="symbol">\</span>
<span class="normal">			lcp2 </span><span class="symbol">=</span><span class="normal"> lcp02</span><span class="symbol">;</span><span class="normal">                                          </span><span class="symbol">\</span>
<span class="normal">			</span><span class="keyword">if</span><span class="normal"> </span><span class="symbol">(--</span><span class="normal">n0 </span><span class="symbol">==</span><span class="normal"> </span><span class="number">0</span><span class="symbol">)</span><span class="normal"> </span><span class="keyword">goto</span><span class="normal"> finish0</span><span class="symbol">;</span><span class="normal">                           </span><span class="symbol">\</span>
<span class="normal">			</span><span class="keyword">if</span><span class="normal"> </span><span class="symbol">(</span><span class="normal">lcp0 </span><span class="symbol">&gt;</span><span class="normal"> lcp1</span><span class="symbol">)</span><span class="normal">  </span><span class="keyword">goto</span><span class="normal"> lcp_0gt1eq2</span><span class="symbol">;</span><span class="normal">                    </span><span class="symbol">\</span>
<span class="normal">			</span><span class="keyword">if</span><span class="normal"> </span><span class="symbol">(</span><span class="normal">lcp0 </span><span class="symbol">==</span><span class="normal"> lcp1</span><span class="symbol">)</span><span class="normal"> </span><span class="keyword">goto</span><span class="normal"> lcp_0eq1eq2</span><span class="symbol">;</span><span class="normal">                    </span><span class="symbol">\</span>
<span class="normal">			</span><span class="keyword">goto</span><span class="normal"> lcp_1eq2gt0</span><span class="symbol">;</span><span class="normal">                                      </span><span class="symbol">\</span>
<span class="normal">		</span><span class="cbracket">}</span><span class="normal"> </span><span class="keyword">else</span><span class="normal"> </span><span class="cbracket">{</span><span class="normal">                                                       </span><span class="symbol">\</span>
<span class="normal">			</span><span class="function">debug</span><span class="symbol">()&lt;&lt;</span><span class="string">"</span><span class="specialchar">\t</span><span class="string">2 &lt; 0 = 1</span><span class="specialchar">\n</span><span class="string">"</span><span class="symbol">;</span><span class="normal">                              </span><span class="symbol">\</span>
<span class="normal">			</span><span class="symbol">*</span><span class="normal">result</span><span class="symbol">++</span><span class="normal"> </span><span class="symbol">=</span><span class="normal"> </span><span class="symbol">*</span><span class="normal">from2</span><span class="symbol">++;</span><span class="normal">                                  </span><span class="symbol">\</span>
<span class="normal">			</span><span class="keyword">if</span><span class="normal"> </span><span class="symbol">(</span><span class="normal">output_lcps </span><span class="symbol">&amp;&amp;</span><span class="normal"> OutputLCP</span><span class="symbol">)</span><span class="normal"> </span><span class="symbol">*</span><span class="normal">lcp_result</span><span class="symbol">++</span><span class="normal"> </span><span class="symbol">=</span><span class="normal"> lcp2</span><span class="symbol">;</span><span class="normal">    </span><span class="symbol">\</span>
<span class="normal">			lcp0 </span><span class="symbol">=</span><span class="normal"> lcp02</span><span class="symbol">;</span><span class="normal">                                          </span><span class="symbol">\</span>
<span class="normal">			lcp1 </span><span class="symbol">=</span><span class="normal"> lcp02</span><span class="symbol">;</span><span class="normal">                                          </span><span class="symbol">\</span>
<span class="normal">			lcp2 </span><span class="symbol">=</span><span class="normal"> </span><span class="symbol">*</span><span class="normal">lcp_input2</span><span class="symbol">++;</span><span class="normal">                                  </span><span class="symbol">\</span>
<span class="normal">			</span><span class="keyword">if</span><span class="normal"> </span><span class="symbol">(--</span><span class="normal">n2 </span><span class="symbol">==</span><span class="normal"> </span><span class="number">0</span><span class="symbol">)</span><span class="normal"> </span><span class="keyword">goto</span><span class="normal"> finish2</span><span class="symbol">;</span><span class="normal">                           </span><span class="symbol">\</span>
<span class="normal">			</span><span class="keyword">if</span><span class="normal"> </span><span class="symbol">(</span><span class="normal">lcp2 </span><span class="symbol">&gt;</span><span class="normal"> lcp0</span><span class="symbol">)</span><span class="normal">  </span><span class="keyword">goto</span><span class="normal"> lcp_2gt0eq1</span><span class="symbol">;</span><span class="normal">                    </span><span class="symbol">\</span>
<span class="normal">			</span><span class="keyword">if</span><span class="normal"> </span><span class="symbol">(</span><span class="normal">lcp2 </span><span class="symbol">==</span><span class="normal"> lcp0</span><span class="symbol">)</span><span class="normal"> </span><span class="keyword">goto</span><span class="normal"> lcp_0eq1eq2</span><span class="symbol">;</span><span class="normal">                    </span><span class="symbol">\</span>
<span class="normal">			</span><span class="keyword">goto</span><span class="normal"> lcp_0eq1gt2</span><span class="symbol">;</span><span class="normal">                                      </span><span class="symbol">\</span>
<span class="normal">		</span><span class="cbracket">}</span><span class="normal">                                                              </span><span class="symbol">\</span>
<span class="normal">	</span><span class="cbracket">}</span><span class="normal"> </span><span class="keyword">else</span><span class="normal"> </span><span class="keyword">if</span><span class="normal"> </span><span class="symbol">(</span><span class="normal">cmp01 </span><span class="symbol">&lt;</span><span class="normal"> </span><span class="number">0</span><span class="symbol">)</span><span class="normal"> </span><span class="cbracket">{</span><span class="normal">                                                </span><span class="symbol">\</span>
<span class="normal">		</span><span class="type">int</span><span class="normal"> cmp12</span><span class="symbol">;</span><span class="normal"> </span><span class="usertype">lcp_t</span><span class="normal"> lcp12</span><span class="symbol">;</span><span class="normal">                                        </span><span class="symbol">\</span>
<span class="normal">		boost</span><span class="symbol">::</span><span class="function">tie</span><span class="symbol">(</span><span class="normal">cmp12</span><span class="symbol">,</span><span class="normal"> lcp12</span><span class="symbol">)</span><span class="normal"> </span><span class="symbol">=</span><span class="normal"> </span><span class="function">compare</span><span class="symbol">(*</span><span class="normal">from1</span><span class="symbol">,</span><span class="normal"> </span><span class="symbol">*</span><span class="normal">from2</span><span class="symbol">,</span><span class="normal"> lcp0</span><span class="symbol">);</span><span class="normal">      </span><span class="symbol">\</span>
<span class="normal">		</span><span class="keyword">if</span><span class="normal"> </span><span class="symbol">(</span><span class="normal">cmp12 </span><span class="symbol">==</span><span class="normal"> </span><span class="number">0</span><span class="symbol">)</span><span class="normal"> </span><span class="cbracket">{</span><span class="normal">                                              </span><span class="symbol">\</span>
<span class="normal">			</span><span class="function">debug</span><span class="symbol">()&lt;&lt;</span><span class="string">"</span><span class="specialchar">\t</span><span class="string">0 &lt; 1 = 2</span><span class="specialchar">\n</span><span class="string">"</span><span class="symbol">;</span><span class="normal">                              </span><span class="symbol">\</span>
<span class="normal">			</span><span class="symbol">*</span><span class="normal">result</span><span class="symbol">++</span><span class="normal"> </span><span class="symbol">=</span><span class="normal"> </span><span class="symbol">*</span><span class="normal">from0</span><span class="symbol">++;</span><span class="normal">                                  </span><span class="symbol">\</span>
<span class="normal">			</span><span class="keyword">if</span><span class="normal"> </span><span class="symbol">(</span><span class="normal">output_lcps </span><span class="symbol">&amp;&amp;</span><span class="normal"> OutputLCP</span><span class="symbol">)</span><span class="normal"> </span><span class="symbol">*</span><span class="normal">lcp_result</span><span class="symbol">++</span><span class="normal"> </span><span class="symbol">=</span><span class="normal"> lcp0</span><span class="symbol">;</span><span class="normal">    </span><span class="symbol">\</span>
<span class="normal">			lcp0 </span><span class="symbol">=</span><span class="normal"> </span><span class="symbol">*</span><span class="normal">lcp_input0</span><span class="symbol">++;</span><span class="normal">                                  </span><span class="symbol">\</span>
<span class="normal">			lcp1 </span><span class="symbol">=</span><span class="normal"> lcp01</span><span class="symbol">;</span><span class="normal">                                          </span><span class="symbol">\</span>
<span class="normal">			lcp2 </span><span class="symbol">=</span><span class="normal"> lcp01</span><span class="symbol">;</span><span class="normal">                                          </span><span class="symbol">\</span>
<span class="normal">			</span><span class="keyword">if</span><span class="normal"> </span><span class="symbol">(--</span><span class="normal">n0 </span><span class="symbol">==</span><span class="normal"> </span><span class="number">0</span><span class="symbol">)</span><span class="normal"> </span><span class="keyword">goto</span><span class="normal"> finish0</span><span class="symbol">;</span><span class="normal">                           </span><span class="symbol">\</span>
<span class="normal">			</span><span class="keyword">if</span><span class="normal"> </span><span class="symbol">(</span><span class="normal">lcp0 </span><span class="symbol">&gt;</span><span class="normal"> lcp1</span><span class="symbol">)</span><span class="normal">  </span><span class="keyword">goto</span><span class="normal"> lcp_0gt1eq2</span><span class="symbol">;</span><span class="normal">                    </span><span class="symbol">\</span>
<span class="normal">			</span><span class="keyword">if</span><span class="normal"> </span><span class="symbol">(</span><span class="normal">lcp0 </span><span class="symbol">==</span><span class="normal"> lcp1</span><span class="symbol">)</span><span class="normal"> </span><span class="keyword">goto</span><span class="normal"> lcp_0eq1eq2</span><span class="symbol">;</span><span class="normal">                    </span><span class="symbol">\</span>
<span class="normal">			</span><span class="keyword">goto</span><span class="normal"> lcp_1eq2gt0</span><span class="symbol">;</span><span class="normal">                                      </span><span class="symbol">\</span>
<span class="normal">		</span><span class="cbracket">}</span><span class="normal"> </span><span class="keyword">else</span><span class="normal"> </span><span class="keyword">if</span><span class="normal"> </span><span class="symbol">(</span><span class="normal">cmp12 </span><span class="symbol">&lt;</span><span class="normal"> </span><span class="number">0</span><span class="symbol">)</span><span class="normal"> </span><span class="cbracket">{</span><span class="normal">                                        </span><span class="symbol">\</span>
<span class="normal">			</span><span class="function">debug</span><span class="symbol">()&lt;&lt;</span><span class="string">"</span><span class="specialchar">\t</span><span class="string">0 &lt; 1 &lt; 2</span><span class="specialchar">\n</span><span class="string">"</span><span class="symbol">;</span><span class="normal">                              </span><span class="symbol">\</span>
<span class="normal">			</span><span class="symbol">*</span><span class="normal">result</span><span class="symbol">++</span><span class="normal"> </span><span class="symbol">=</span><span class="normal"> </span><span class="symbol">*</span><span class="normal">from0</span><span class="symbol">++;</span><span class="normal">                                  </span><span class="symbol">\</span>
<span class="normal">			</span><span class="keyword">if</span><span class="normal"> </span><span class="symbol">(</span><span class="normal">output_lcps </span><span class="symbol">&amp;&amp;</span><span class="normal"> OutputLCP</span><span class="symbol">)</span><span class="normal"> </span><span class="symbol">*</span><span class="normal">lcp_result</span><span class="symbol">++</span><span class="normal"> </span><span class="symbol">=</span><span class="normal"> lcp0</span><span class="symbol">;</span><span class="normal">    </span><span class="symbol">\</span>
<span class="normal">			lcp0 </span><span class="symbol">=</span><span class="normal"> </span><span class="symbol">*</span><span class="normal">lcp_input0</span><span class="symbol">++;</span><span class="normal">                                  </span><span class="symbol">\</span>
<span class="normal">			lcp1 </span><span class="symbol">=</span><span class="normal"> lcp01</span><span class="symbol">;</span><span class="normal">                                          </span><span class="symbol">\</span>
<span class="normal">			lcp2 </span><span class="symbol">=</span><span class="normal"> std</span><span class="symbol">::</span><span class="function">min</span><span class="symbol">(</span><span class="normal">lcp01</span><span class="symbol">,</span><span class="normal"> lcp12</span><span class="symbol">);</span><span class="normal">                         </span><span class="symbol">\</span>
<span class="normal">			</span><span class="keyword">if</span><span class="normal"> </span><span class="symbol">(--</span><span class="normal">n0 </span><span class="symbol">==</span><span class="normal"> </span><span class="number">0</span><span class="symbol">)</span><span class="normal"> </span><span class="keyword">goto</span><span class="normal"> finish0</span><span class="symbol">;</span><span class="normal">                           </span><span class="symbol">\</span>
<span class="normal">			</span><span class="function">assert</span><span class="symbol">(</span><span class="normal">lcp1 </span><span class="symbol">&gt;=</span><span class="normal"> lcp2</span><span class="symbol">);</span><span class="normal">                                  </span><span class="symbol">\</span>
<span class="normal">			</span><span class="keyword">if</span><span class="normal"> </span><span class="symbol">(</span><span class="normal">lcp1 </span><span class="symbol">&gt;</span><span class="normal"> lcp2</span><span class="symbol">)</span><span class="normal"> </span><span class="cbracket">{</span><span class="normal">                                     </span><span class="symbol">\</span>
<span class="normal">				</span><span class="keyword">if</span><span class="normal"> </span><span class="symbol">(</span><span class="normal">lcp0 </span><span class="symbol">&gt;</span><span class="normal"> lcp1</span><span class="symbol">)</span><span class="normal">  </span><span class="keyword">goto</span><span class="normal"> lcp_0gt1gt2</span><span class="symbol">;</span><span class="normal">            </span><span class="symbol">\</span>
<span class="normal">				</span><span class="keyword">if</span><span class="normal"> </span><span class="symbol">(</span><span class="normal">lcp0 </span><span class="symbol">==</span><span class="normal"> lcp1</span><span class="symbol">)</span><span class="normal"> </span><span class="keyword">goto</span><span class="normal"> lcp_0eq1gt2</span><span class="symbol">;</span><span class="normal">            </span><span class="symbol">\</span>
<span class="normal">				</span><span class="keyword">if</span><span class="normal"> </span><span class="symbol">(</span><span class="normal">lcp0 </span><span class="symbol">&gt;</span><span class="normal"> lcp2</span><span class="symbol">)</span><span class="normal">  </span><span class="keyword">goto</span><span class="normal"> lcp_1gt0gt2</span><span class="symbol">;</span><span class="normal">            </span><span class="symbol">\</span>
<span class="normal">				</span><span class="keyword">if</span><span class="normal"> </span><span class="symbol">(</span><span class="normal">lcp0 </span><span class="symbol">==</span><span class="normal"> lcp2</span><span class="symbol">)</span><span class="normal"> </span><span class="keyword">goto</span><span class="normal"> lcp_1gt0eq2</span><span class="symbol">;</span><span class="normal">            </span><span class="symbol">\</span>
<span class="normal">				</span><span class="keyword">goto</span><span class="normal"> lcp_1gt2gt0</span><span class="symbol">;</span><span class="normal">                              </span><span class="symbol">\</span>
<span class="normal">			</span><span class="cbracket">}</span><span class="normal"> </span><span class="keyword">else</span><span class="normal"> </span><span class="cbracket">{</span><span class="normal">                                               </span><span class="symbol">\</span>
<span class="normal">				</span><span class="keyword">if</span><span class="normal"> </span><span class="symbol">(</span><span class="normal">lcp0 </span><span class="symbol">&gt;</span><span class="normal"> lcp1</span><span class="symbol">)</span><span class="normal">  </span><span class="keyword">goto</span><span class="normal"> lcp_0gt1eq2</span><span class="symbol">;</span><span class="normal">            </span><span class="symbol">\</span>
<span class="normal">				</span><span class="keyword">if</span><span class="normal"> </span><span class="symbol">(</span><span class="normal">lcp0 </span><span class="symbol">==</span><span class="normal"> lcp1</span><span class="symbol">)</span><span class="normal"> </span><span class="keyword">goto</span><span class="normal"> lcp_0eq1eq2</span><span class="symbol">;</span><span class="normal">            </span><span class="symbol">\</span>
<span class="normal">				</span><span class="keyword">goto</span><span class="normal"> lcp_1eq2gt0</span><span class="symbol">;</span><span class="normal">                              </span><span class="symbol">\</span>
<span class="normal">			</span><span class="cbracket">}</span><span class="normal">                                                      </span><span class="symbol">\</span>
<span class="normal">		</span><span class="cbracket">}</span><span class="normal"> </span><span class="keyword">else</span><span class="normal"> </span><span class="cbracket">{</span><span class="normal">                                                       </span><span class="symbol">\</span>
<span class="normal">			</span><span class="comment">/* </span><span class="todo">TODO:</span><span class="comment"> possible to avoid comparison in some cases?*/</span><span class="normal"> </span><span class="symbol">\</span>
<span class="normal">                                                                               </span><span class="symbol">\</span>
<span class="normal">			</span><span class="comment">/* 0 &lt; 1 &amp;&amp; 2 &lt; 1*/</span><span class="normal">                                    </span><span class="symbol">\</span>
<span class="normal">			</span><span class="type">int</span><span class="normal"> cmp02</span><span class="symbol">;</span><span class="normal"> </span><span class="usertype">lcp_t</span><span class="normal"> lcp02</span><span class="symbol">;</span><span class="normal">                                </span><span class="symbol">\</span>
<span class="normal">			boost</span><span class="symbol">::</span><span class="function">tie</span><span class="symbol">(</span><span class="normal">cmp02</span><span class="symbol">,</span><span class="normal"> lcp02</span><span class="symbol">)=</span><span class="function">compare</span><span class="symbol">(*</span><span class="normal">from0</span><span class="symbol">,</span><span class="normal"> </span><span class="symbol">*</span><span class="normal">from2</span><span class="symbol">,</span><span class="normal"> lcp0</span><span class="symbol">);\</span>
<span class="normal">			</span><span class="keyword">if</span><span class="normal"> </span><span class="symbol">(</span><span class="normal">cmp02 </span><span class="symbol">&lt;=</span><span class="normal"> </span><span class="number">0</span><span class="symbol">)</span><span class="normal"> </span><span class="cbracket">{</span><span class="normal">                                      </span><span class="symbol">\</span>
<span class="normal">				</span><span class="function">debug</span><span class="symbol">()&lt;&lt;</span><span class="string">"</span><span class="specialchar">\t</span><span class="string">0 &lt;= 2 &lt; 1</span><span class="specialchar">\n</span><span class="string">"</span><span class="symbol">;</span><span class="normal">                     </span><span class="symbol">\</span>
<span class="normal">				</span><span class="symbol">*</span><span class="normal">result</span><span class="symbol">++</span><span class="normal"> </span><span class="symbol">=</span><span class="normal"> </span><span class="symbol">*</span><span class="normal">from0</span><span class="symbol">++;</span><span class="normal">                          </span><span class="symbol">\</span>
<span class="normal">				</span><span class="keyword">if</span><span class="normal"> </span><span class="symbol">(</span><span class="normal">output_lcps</span><span class="symbol">&amp;&amp;</span><span class="normal">OutputLCP</span><span class="symbol">)</span><span class="normal"> </span><span class="symbol">*</span><span class="normal">lcp_result</span><span class="symbol">++=</span><span class="normal">lcp0</span><span class="symbol">;\</span>
<span class="normal">				lcp0 </span><span class="symbol">=</span><span class="normal"> </span><span class="symbol">*</span><span class="normal">lcp_input0</span><span class="symbol">++;</span><span class="normal">                          </span><span class="symbol">\</span>
<span class="normal">				lcp1 </span><span class="symbol">=</span><span class="normal"> lcp01</span><span class="symbol">;</span><span class="normal">                                  </span><span class="symbol">\</span>
<span class="normal">				lcp2 </span><span class="symbol">=</span><span class="normal"> lcp02</span><span class="symbol">;</span><span class="normal">                                  </span><span class="symbol">\</span>
<span class="normal">				</span><span class="keyword">if</span><span class="normal"> </span><span class="symbol">(--</span><span class="normal">n0 </span><span class="symbol">==</span><span class="normal"> </span><span class="number">0</span><span class="symbol">)</span><span class="normal"> </span><span class="keyword">goto</span><span class="normal"> finish0</span><span class="symbol">;</span><span class="normal">                   </span><span class="symbol">\</span>
<span class="normal">			</span><span class="cbracket">}</span><span class="normal"> </span><span class="keyword">else</span><span class="normal"> </span><span class="cbracket">{</span><span class="normal">                                               </span><span class="symbol">\</span>
<span class="normal">				</span><span class="function">debug</span><span class="symbol">()&lt;&lt;</span><span class="string">"</span><span class="specialchar">\t</span><span class="string">2 &lt; 0 &lt; 1</span><span class="specialchar">\n</span><span class="string">"</span><span class="symbol">;</span><span class="normal">                      </span><span class="symbol">\</span>
<span class="normal">				</span><span class="symbol">*</span><span class="normal">result</span><span class="symbol">++</span><span class="normal"> </span><span class="symbol">=</span><span class="normal"> </span><span class="symbol">*</span><span class="normal">from2</span><span class="symbol">++;</span><span class="normal">                          </span><span class="symbol">\</span>
<span class="normal">				</span><span class="keyword">if</span><span class="normal"> </span><span class="symbol">(</span><span class="normal">output_lcps</span><span class="symbol">&amp;&amp;</span><span class="normal">OutputLCP</span><span class="symbol">)</span><span class="normal"> </span><span class="symbol">*</span><span class="normal">lcp_result</span><span class="symbol">++=</span><span class="normal">lcp2</span><span class="symbol">;\</span>
<span class="normal">				lcp0 </span><span class="symbol">=</span><span class="normal"> lcp02</span><span class="symbol">;</span><span class="normal">                                  </span><span class="symbol">\</span>
<span class="normal">				lcp1 </span><span class="symbol">=</span><span class="normal"> lcp12</span><span class="symbol">;</span><span class="normal">                                  </span><span class="symbol">\</span>
<span class="normal">				lcp2 </span><span class="symbol">=</span><span class="normal"> </span><span class="symbol">*</span><span class="normal">lcp_input2</span><span class="symbol">++;</span><span class="normal">                          </span><span class="symbol">\</span>
<span class="normal">				</span><span class="keyword">if</span><span class="normal"> </span><span class="symbol">(--</span><span class="normal">n2 </span><span class="symbol">==</span><span class="normal"> </span><span class="number">0</span><span class="symbol">)</span><span class="normal"> </span><span class="keyword">goto</span><span class="normal"> finish2</span><span class="symbol">;</span><span class="normal">                   </span><span class="symbol">\</span>
<span class="normal">				</span><span class="function">assert</span><span class="symbol">(</span><span class="normal">lcp0 </span><span class="symbol">&gt;=</span><span class="normal"> lcp1 </span><span class="symbol">&amp;&amp;</span><span class="normal"> </span><span class="string">"2&lt;0&lt;1"</span><span class="symbol">);</span><span class="normal">               </span><span class="symbol">\</span>
<span class="normal">				</span><span class="keyword">if</span><span class="normal"> </span><span class="symbol">(</span><span class="normal">lcp0 </span><span class="symbol">&gt;</span><span class="normal"> lcp1</span><span class="symbol">)</span><span class="normal"> </span><span class="cbracket">{</span><span class="normal">                             </span><span class="symbol">\</span>
<span class="normal">					</span><span class="keyword">if</span><span class="normal"> </span><span class="symbol">(</span><span class="normal">lcp2 </span><span class="symbol">&gt;</span><span class="normal"> lcp0</span><span class="symbol">)</span><span class="normal">  </span><span class="keyword">goto</span><span class="normal"> lcp_2gt0gt1</span><span class="symbol">;</span><span class="normal">    </span><span class="symbol">\</span>
<span class="normal">					</span><span class="keyword">if</span><span class="normal"> </span><span class="symbol">(</span><span class="normal">lcp2 </span><span class="symbol">==</span><span class="normal"> lcp0</span><span class="symbol">)</span><span class="normal"> </span><span class="keyword">goto</span><span class="normal"> lcp_0eq2gt1</span><span class="symbol">;</span><span class="normal">    </span><span class="symbol">\</span>
<span class="normal">					</span><span class="keyword">if</span><span class="normal"> </span><span class="symbol">(</span><span class="normal">lcp2 </span><span class="symbol">&gt;</span><span class="normal"> lcp1</span><span class="symbol">)</span><span class="normal">  </span><span class="keyword">goto</span><span class="normal"> lcp_0gt2gt1</span><span class="symbol">;</span><span class="normal">    </span><span class="symbol">\</span>
<span class="normal">					</span><span class="keyword">if</span><span class="normal"> </span><span class="symbol">(</span><span class="normal">lcp2 </span><span class="symbol">==</span><span class="normal"> lcp1</span><span class="symbol">)</span><span class="normal"> </span><span class="keyword">goto</span><span class="normal"> lcp_0gt1eq2</span><span class="symbol">;</span><span class="normal">    </span><span class="symbol">\</span>
<span class="normal">					</span><span class="keyword">goto</span><span class="normal"> lcp_0gt1gt2</span><span class="symbol">;</span><span class="normal">                      </span><span class="symbol">\</span>
<span class="normal">				</span><span class="cbracket">}</span><span class="normal"> </span><span class="keyword">else</span><span class="normal"> </span><span class="cbracket">{</span><span class="normal">                                       </span><span class="symbol">\</span>
<span class="normal">					</span><span class="keyword">if</span><span class="normal"> </span><span class="symbol">(</span><span class="normal">lcp2 </span><span class="symbol">&gt;</span><span class="normal"> lcp0</span><span class="symbol">)</span><span class="normal">  </span><span class="keyword">goto</span><span class="normal"> lcp_2gt0eq1</span><span class="symbol">;</span><span class="normal">    </span><span class="symbol">\</span>
<span class="normal">					</span><span class="keyword">if</span><span class="normal"> </span><span class="symbol">(</span><span class="normal">lcp2 </span><span class="symbol">==</span><span class="normal"> lcp0</span><span class="symbol">)</span><span class="normal"> </span><span class="keyword">goto</span><span class="normal"> lcp_0eq1eq2</span><span class="symbol">;</span><span class="normal">    </span><span class="symbol">\</span>
<span class="normal">					</span><span class="keyword">goto</span><span class="normal"> lcp_0eq1gt2</span><span class="symbol">;</span><span class="normal">                      </span><span class="symbol">\</span>
<span class="normal">				</span><span class="cbracket">}</span><span class="normal">                                              </span><span class="symbol">\</span>
<span class="normal">			</span><span class="cbracket">}</span><span class="normal">                                                      </span><span class="symbol">\</span>
<span class="normal">		</span><span class="cbracket">}</span><span class="normal">                                                              </span><span class="symbol">\</span>
<span class="normal">	</span><span class="cbracket">}</span><span class="normal"> </span><span class="keyword">else</span><span class="normal"> </span><span class="cbracket">{</span><span class="normal">                                                               </span><span class="symbol">\</span>
<span class="normal">		</span><span class="comment">/* 1 &lt; 0*/</span><span class="normal">                                                     </span><span class="symbol">\</span>
<span class="normal">		</span><span class="type">int</span><span class="normal"> cmp12</span><span class="symbol">;</span><span class="normal"> </span><span class="usertype">lcp_t</span><span class="normal"> lcp12</span><span class="symbol">;</span><span class="normal">                                        </span><span class="symbol">\</span>
<span class="normal">		boost</span><span class="symbol">::</span><span class="function">tie</span><span class="symbol">(</span><span class="normal">cmp12</span><span class="symbol">,</span><span class="normal"> lcp12</span><span class="symbol">)</span><span class="normal"> </span><span class="symbol">=</span><span class="normal"> </span><span class="function">compare</span><span class="symbol">(*</span><span class="normal">from1</span><span class="symbol">,</span><span class="normal"> </span><span class="symbol">*</span><span class="normal">from2</span><span class="symbol">,</span><span class="normal"> lcp0</span><span class="symbol">);</span><span class="normal">      </span><span class="symbol">\</span>
<span class="normal">		</span><span class="keyword">if</span><span class="normal"> </span><span class="symbol">(</span><span class="normal">cmp12 </span><span class="symbol">&lt;=</span><span class="normal"> </span><span class="number">0</span><span class="symbol">)</span><span class="normal"> </span><span class="cbracket">{</span><span class="normal">                                              </span><span class="symbol">\</span>
<span class="normal">			</span><span class="function">debug</span><span class="symbol">()&lt;&lt;</span><span class="string">"</span><span class="specialchar">\t</span><span class="string">1 &lt; 0 and 1 &lt;= 2</span><span class="specialchar">\n</span><span class="string">"</span><span class="symbol">;</span><span class="normal">                       </span><span class="symbol">\</span>
<span class="normal">			</span><span class="symbol">*</span><span class="normal">result</span><span class="symbol">++</span><span class="normal"> </span><span class="symbol">=</span><span class="normal"> </span><span class="symbol">*</span><span class="normal">from1</span><span class="symbol">++;</span><span class="normal">                                  </span><span class="symbol">\</span>
<span class="normal">			</span><span class="keyword">if</span><span class="normal"> </span><span class="symbol">(</span><span class="normal">output_lcps </span><span class="symbol">&amp;&amp;</span><span class="normal"> OutputLCP</span><span class="symbol">)</span><span class="normal"> </span><span class="symbol">*</span><span class="normal">lcp_result</span><span class="symbol">++</span><span class="normal"> </span><span class="symbol">=</span><span class="normal"> lcp1</span><span class="symbol">;</span><span class="normal">    </span><span class="symbol">\</span>
<span class="normal">			lcp0 </span><span class="symbol">=</span><span class="normal"> lcp01</span><span class="symbol">;</span><span class="normal">                                          </span><span class="symbol">\</span>
<span class="normal">			lcp1 </span><span class="symbol">=</span><span class="normal"> </span><span class="symbol">*</span><span class="normal">lcp_input1</span><span class="symbol">++;</span><span class="normal">                                  </span><span class="symbol">\</span>
<span class="normal">			lcp2 </span><span class="symbol">=</span><span class="normal"> lcp12</span><span class="symbol">;</span><span class="normal">                                          </span><span class="symbol">\</span>
<span class="normal">			</span><span class="keyword">if</span><span class="normal"> </span><span class="symbol">(--</span><span class="normal">n1 </span><span class="symbol">==</span><span class="normal"> </span><span class="number">0</span><span class="symbol">)</span><span class="normal"> </span><span class="keyword">goto</span><span class="normal"> finish1</span><span class="symbol">;</span><span class="normal">                           </span><span class="symbol">\</span>
<span class="normal">		</span><span class="cbracket">}</span><span class="normal"> </span><span class="keyword">else</span><span class="normal"> </span><span class="cbracket">{</span><span class="normal">                                                       </span><span class="symbol">\</span>
<span class="normal">			</span><span class="function">debug</span><span class="symbol">()&lt;&lt;</span><span class="string">"</span><span class="specialchar">\t</span><span class="string">2 &lt; 1 &lt; 0</span><span class="specialchar">\n</span><span class="string">"</span><span class="symbol">;</span><span class="normal">                              </span><span class="symbol">\</span>
<span class="normal">			</span><span class="symbol">*</span><span class="normal">result</span><span class="symbol">++</span><span class="normal"> </span><span class="symbol">=</span><span class="normal"> </span><span class="symbol">*</span><span class="normal">from2</span><span class="symbol">++;</span><span class="normal">                                  </span><span class="symbol">\</span>
<span class="normal">			</span><span class="keyword">if</span><span class="normal"> </span><span class="symbol">(</span><span class="normal">output_lcps </span><span class="symbol">&amp;&amp;</span><span class="normal"> OutputLCP</span><span class="symbol">)</span><span class="normal"> </span><span class="symbol">*</span><span class="normal">lcp_result</span><span class="symbol">++</span><span class="normal"> </span><span class="symbol">=</span><span class="normal"> lcp2</span><span class="symbol">;</span><span class="normal">    </span><span class="symbol">\</span>
<span class="normal">			lcp0 </span><span class="symbol">=</span><span class="normal"> std</span><span class="symbol">::</span><span class="function">min</span><span class="symbol">(</span><span class="normal">lcp01</span><span class="symbol">,</span><span class="normal"> lcp12</span><span class="symbol">);</span><span class="normal">                         </span><span class="symbol">\</span>
<span class="normal">			lcp1 </span><span class="symbol">=</span><span class="normal"> lcp12</span><span class="symbol">;</span><span class="normal">                                          </span><span class="symbol">\</span>
<span class="normal">			lcp2 </span><span class="symbol">=</span><span class="normal"> </span><span class="symbol">*</span><span class="normal">lcp_input2</span><span class="symbol">++;</span><span class="normal">                                  </span><span class="symbol">\</span>
<span class="normal">			</span><span class="keyword">if</span><span class="normal"> </span><span class="symbol">(--</span><span class="normal">n2 </span><span class="symbol">==</span><span class="normal"> </span><span class="number">0</span><span class="symbol">)</span><span class="normal"> </span><span class="keyword">goto</span><span class="normal"> finish2</span><span class="symbol">;</span><span class="normal">                           </span><span class="symbol">\</span>
<span class="normal">			</span><span class="function">assert</span><span class="symbol">(</span><span class="normal">lcp1 </span><span class="symbol">&gt;=</span><span class="normal"> lcp0</span><span class="symbol">);</span><span class="normal">                                  </span><span class="symbol">\</span>
<span class="normal">			</span><span class="keyword">if</span><span class="normal"> </span><span class="symbol">(</span><span class="normal">lcp1 </span><span class="symbol">&gt;</span><span class="normal"> lcp0</span><span class="symbol">)</span><span class="normal"> </span><span class="cbracket">{</span><span class="normal">                                     </span><span class="symbol">\</span>
<span class="normal">				</span><span class="keyword">if</span><span class="normal"> </span><span class="symbol">(</span><span class="normal">lcp2 </span><span class="symbol">&gt;</span><span class="normal"> lcp1</span><span class="symbol">)</span><span class="normal">  </span><span class="keyword">goto</span><span class="normal"> lcp_2gt1gt0</span><span class="symbol">;</span><span class="normal">            </span><span class="symbol">\</span>
<span class="normal">				</span><span class="keyword">if</span><span class="normal"> </span><span class="symbol">(</span><span class="normal">lcp2 </span><span class="symbol">==</span><span class="normal"> lcp1</span><span class="symbol">)</span><span class="normal"> </span><span class="keyword">goto</span><span class="normal"> lcp_1eq2gt0</span><span class="symbol">;</span><span class="normal">            </span><span class="symbol">\</span>
<span class="normal">				</span><span class="keyword">if</span><span class="normal"> </span><span class="symbol">(</span><span class="normal">lcp2 </span><span class="symbol">&gt;</span><span class="normal"> lcp0</span><span class="symbol">)</span><span class="normal">  </span><span class="keyword">goto</span><span class="normal"> lcp_1gt2gt0</span><span class="symbol">;</span><span class="normal">            </span><span class="symbol">\</span>
<span class="normal">				</span><span class="keyword">if</span><span class="normal"> </span><span class="symbol">(</span><span class="normal">lcp2 </span><span class="symbol">==</span><span class="normal"> lcp0</span><span class="symbol">)</span><span class="normal"> </span><span class="keyword">goto</span><span class="normal"> lcp_1gt0eq2</span><span class="symbol">;</span><span class="normal">            </span><span class="symbol">\</span>
<span class="normal">				</span><span class="keyword">goto</span><span class="normal"> lcp_1gt0gt2</span><span class="symbol">;</span><span class="normal">                              </span><span class="symbol">\</span>
<span class="normal">			</span><span class="cbracket">}</span><span class="normal"> </span><span class="keyword">else</span><span class="normal"> </span><span class="cbracket">{</span><span class="normal">                                               </span><span class="symbol">\</span>
<span class="normal">				</span><span class="keyword">if</span><span class="normal"> </span><span class="symbol">(</span><span class="normal">lcp2 </span><span class="symbol">&gt;</span><span class="normal"> lcp0</span><span class="symbol">)</span><span class="normal">  </span><span class="keyword">goto</span><span class="normal"> lcp_2gt0eq1</span><span class="symbol">;</span><span class="normal">            </span><span class="symbol">\</span>
<span class="normal">				</span><span class="keyword">if</span><span class="normal"> </span><span class="symbol">(</span><span class="normal">lcp2 </span><span class="symbol">==</span><span class="normal"> lcp0</span><span class="symbol">)</span><span class="normal"> </span><span class="keyword">goto</span><span class="normal"> lcp_0eq1eq2</span><span class="symbol">;</span><span class="normal">            </span><span class="symbol">\</span>
<span class="normal">				</span><span class="keyword">goto</span><span class="normal"> lcp_0eq1gt2</span><span class="symbol">;</span><span class="normal">                              </span><span class="symbol">\</span>
<span class="normal">			</span><span class="cbracket">}</span><span class="normal">                                                      </span><span class="symbol">\</span>
<span class="normal">		</span><span class="cbracket">}</span><span class="normal">                                                              </span><span class="symbol">\</span>
<span class="normal">	</span><span class="cbracket">}</span><span class="normal">                                                                      </span><span class="symbol">\</span>
<span class="normal">	</span><span class="function">check_lcps</span><span class="symbol">(*(</span><span class="normal">result</span><span class="symbol">-</span><span class="number">1</span><span class="symbol">),*</span><span class="normal">from0</span><span class="symbol">,</span><span class="normal">lcp0</span><span class="symbol">,*</span><span class="normal">from1</span><span class="symbol">,</span><span class="normal">lcp1</span><span class="symbol">,*</span><span class="normal">from2</span><span class="symbol">,</span><span class="normal">lcp2</span><span class="symbol">);</span><span class="normal">           </span><span class="symbol">\</span>
<span class="normal">	</span><span class="keyword">goto</span><span class="normal"> branch_by_lcp</span><span class="symbol">;</span><span class="normal">                                                    </span><span class="symbol">\</span>
<span class="cbracket">}</span>

<span class="function">INITIAL_STATE</span><span class="symbol">(</span><span class="keyword">false</span><span class="symbol">)</span>

<span class="normal">branch_by_lcp</span><span class="symbol">:</span>
<span class="normal">	</span><span class="keyword">if</span><span class="normal"> </span><span class="symbol">(</span><span class="normal">lcp0 </span><span class="symbol">&gt;</span><span class="normal"> lcp1</span><span class="symbol">)</span><span class="normal"> </span><span class="cbracket">{</span>
<span class="normal">		</span><span class="keyword">if</span><span class="normal"> </span><span class="symbol">(</span><span class="normal">lcp1 </span><span class="symbol">&gt;</span><span class="normal">  lcp2</span><span class="symbol">)</span><span class="normal"> </span><span class="keyword">goto</span><span class="normal"> lcp_0gt1gt2</span><span class="symbol">;</span>
<span class="normal">		</span><span class="keyword">if</span><span class="normal"> </span><span class="symbol">(</span><span class="normal">lcp1 </span><span class="symbol">==</span><span class="normal"> lcp2</span><span class="symbol">)</span><span class="normal"> </span><span class="keyword">goto</span><span class="normal"> lcp_0gt1eq2</span><span class="symbol">;</span>
<span class="normal">		</span><span class="keyword">if</span><span class="normal"> </span><span class="symbol">(</span><span class="normal">lcp0 </span><span class="symbol">&gt;</span><span class="normal">  lcp2</span><span class="symbol">)</span><span class="normal"> </span><span class="keyword">goto</span><span class="normal"> lcp_0gt2gt1</span><span class="symbol">;</span>
<span class="normal">		</span><span class="keyword">if</span><span class="normal"> </span><span class="symbol">(</span><span class="normal">lcp0 </span><span class="symbol">==</span><span class="normal"> lcp2</span><span class="symbol">)</span><span class="normal"> </span><span class="keyword">goto</span><span class="normal"> lcp_0eq2gt1</span><span class="symbol">;</span>
<span class="normal">		</span><span class="keyword">goto</span><span class="normal"> lcp_2gt0gt1</span><span class="symbol">;</span>
<span class="normal">	</span><span class="cbracket">}</span>
<span class="normal">	</span><span class="keyword">if</span><span class="normal"> </span><span class="symbol">(</span><span class="normal">lcp0 </span><span class="symbol">==</span><span class="normal"> lcp1</span><span class="symbol">)</span><span class="normal"> </span><span class="cbracket">{</span>
<span class="normal">		</span><span class="keyword">if</span><span class="normal"> </span><span class="symbol">(</span><span class="normal">lcp1 </span><span class="symbol">&gt;</span><span class="normal">  lcp2</span><span class="symbol">)</span><span class="normal"> </span><span class="keyword">goto</span><span class="normal"> lcp_0eq1gt2</span><span class="symbol">;</span>
<span class="normal">		</span><span class="keyword">if</span><span class="normal"> </span><span class="symbol">(</span><span class="normal">lcp1 </span><span class="symbol">==</span><span class="normal"> lcp2</span><span class="symbol">)</span><span class="normal"> </span><span class="keyword">goto</span><span class="normal"> lcp_0eq1eq2</span><span class="symbol">;</span>
<span class="normal">		</span><span class="keyword">goto</span><span class="normal"> lcp_2gt0eq1</span><span class="symbol">;</span>
<span class="normal">	</span><span class="cbracket">}</span>
<span class="normal">	</span><span class="keyword">if</span><span class="normal"> </span><span class="symbol">(</span><span class="normal">lcp0 </span><span class="symbol">&gt;</span><span class="normal">  lcp2</span><span class="symbol">)</span><span class="normal"> </span><span class="keyword">goto</span><span class="normal"> lcp_1gt0gt2</span><span class="symbol">;</span>
<span class="normal">	</span><span class="keyword">if</span><span class="normal"> </span><span class="symbol">(</span><span class="normal">lcp0 </span><span class="symbol">==</span><span class="normal"> lcp2</span><span class="symbol">)</span><span class="normal"> </span><span class="keyword">goto</span><span class="normal"> lcp_1gt0eq2</span><span class="symbol">;</span>
<span class="normal">	</span><span class="keyword">if</span><span class="normal"> </span><span class="symbol">(</span><span class="normal">lcp1 </span><span class="symbol">&gt;</span><span class="normal">  lcp2</span><span class="symbol">)</span><span class="normal"> </span><span class="keyword">goto</span><span class="normal"> lcp_1gt2gt0</span><span class="symbol">;</span>
<span class="normal">	</span><span class="keyword">if</span><span class="normal"> </span><span class="symbol">(</span><span class="normal">lcp1 </span><span class="symbol">==</span><span class="normal"> lcp2</span><span class="symbol">)</span><span class="normal"> </span><span class="keyword">goto</span><span class="normal"> lcp_1eq2gt0</span><span class="symbol">;</span>
<span class="normal">	</span><span class="keyword">goto</span><span class="normal"> lcp_2gt1gt0</span><span class="symbol">;</span>

<span class="preproc">#define</span><span class="normal"> </span><span class="function">StrictCase</span><span class="symbol">(</span><span class="normal">a</span><span class="symbol">,</span><span class="normal">b</span><span class="symbol">,</span><span class="normal">c</span><span class="symbol">)</span><span class="normal">                                                      </span><span class="symbol">\</span>
<span class="normal">        lcp_##a##gt##b##gt##c</span><span class="symbol">:</span><span class="normal">                                                 </span><span class="symbol">\</span>
<span class="normal">        </span><span class="function">debug</span><span class="symbol">()&lt;&lt;</span><span class="string">"</span><span class="specialchar">\t</span><span class="string">lcp_"</span><span class="symbol">&lt;&lt;</span><span class="normal">a</span><span class="symbol">&lt;&lt;</span><span class="string">"lt"</span><span class="symbol">&lt;&lt;</span><span class="normal">b</span><span class="symbol">&lt;&lt;</span><span class="string">"lt"</span><span class="symbol">&lt;&lt;</span><span class="normal">c</span><span class="symbol">&lt;&lt;</span><span class="string">"</span><span class="specialchar">\n</span><span class="string">"</span><span class="symbol">;</span><span class="normal">                          </span><span class="symbol">\</span>
<span class="normal">        </span><span class="function">assert</span><span class="symbol">(</span><span class="normal">lcp##a </span><span class="symbol">&gt;</span><span class="normal"> lcp##b</span><span class="symbol">);</span><span class="normal">                                               </span><span class="symbol">\</span>
<span class="normal">        </span><span class="function">assert</span><span class="symbol">(</span><span class="normal">lcp##b </span><span class="symbol">&gt;</span><span class="normal"> lcp##c</span><span class="symbol">);</span><span class="normal">                                               </span><span class="symbol">\</span>
<span class="normal">        </span><span class="function">assert</span><span class="symbol">(</span><span class="function">cmp</span><span class="symbol">(*</span><span class="normal">from##a</span><span class="symbol">,</span><span class="normal"> </span><span class="symbol">*</span><span class="normal">from##b</span><span class="symbol">)</span><span class="normal"> </span><span class="symbol">&lt;</span><span class="normal"> </span><span class="number">0</span><span class="symbol">);</span><span class="normal">                                   </span><span class="symbol">\</span>
<span class="normal">        </span><span class="function">assert</span><span class="symbol">(</span><span class="function">cmp</span><span class="symbol">(*</span><span class="normal">from##b</span><span class="symbol">,</span><span class="normal"> </span><span class="symbol">*</span><span class="normal">from##c</span><span class="symbol">)</span><span class="normal"> </span><span class="symbol">&lt;</span><span class="normal"> </span><span class="number">0</span><span class="symbol">);</span><span class="normal">                                   </span><span class="symbol">\</span>
<span class="normal">        </span><span class="function">check_lcps</span><span class="symbol">(*(</span><span class="normal">result</span><span class="symbol">-</span><span class="number">1</span><span class="symbol">),*</span><span class="normal">from0</span><span class="symbol">,</span><span class="normal">lcp0</span><span class="symbol">,*</span><span class="normal">from1</span><span class="symbol">,</span><span class="normal">lcp1</span><span class="symbol">,*</span><span class="normal">from2</span><span class="symbol">,</span><span class="normal">lcp2</span><span class="symbol">);</span><span class="normal">           </span><span class="symbol">\</span>
<span class="normal">        </span><span class="symbol">*</span><span class="normal">result</span><span class="symbol">++</span><span class="normal"> </span><span class="symbol">=</span><span class="normal"> </span><span class="symbol">*</span><span class="normal">from##a</span><span class="symbol">++;</span><span class="normal">                                                </span><span class="symbol">\</span>
<span class="normal">        </span><span class="function">debug</span><span class="symbol">()&lt;&lt;</span><span class="string">"</span><span class="specialchar">\t</span><span class="string">lcp result &lt;&lt; "</span><span class="normal"> </span><span class="symbol">&lt;&lt;</span><span class="normal"> lcp##a </span><span class="symbol">&lt;&lt;</span><span class="normal"> </span><span class="string">'</span><span class="specialchar">\n</span><span class="string">'</span><span class="symbol">;</span><span class="normal">                         </span><span class="symbol">\</span>
<span class="normal">        </span><span class="keyword">if</span><span class="normal"> </span><span class="symbol">(</span><span class="normal">OutputLCP</span><span class="symbol">)</span><span class="normal"> </span><span class="symbol">*</span><span class="normal">lcp_result</span><span class="symbol">++</span><span class="normal"> </span><span class="symbol">=</span><span class="normal"> lcp##a</span><span class="symbol">;</span><span class="normal">                                 </span><span class="symbol">\</span>
<span class="normal">        </span><span class="keyword">if</span><span class="normal"> </span><span class="symbol">(--</span><span class="normal">n##a </span><span class="symbol">==</span><span class="normal"> </span><span class="number">0</span><span class="symbol">)</span><span class="normal"> </span><span class="keyword">goto</span><span class="normal"> finish##a</span><span class="symbol">;</span><span class="normal">                                       </span><span class="symbol">\</span>
<span class="normal">        lcp##a </span><span class="symbol">=</span><span class="normal"> </span><span class="symbol">*</span><span class="normal">lcp_input##a</span><span class="symbol">++;</span><span class="normal">                                              </span><span class="symbol">\</span>
<span class="normal">        </span><span class="keyword">if</span><span class="normal"> </span><span class="symbol">(</span><span class="normal">lcp##a </span><span class="symbol">&gt;</span><span class="normal">  lcp##b</span><span class="symbol">)</span><span class="normal"> </span><span class="keyword">goto</span><span class="normal"> lcp_##a##gt##b##gt##c</span><span class="symbol">;</span><span class="normal">                      </span><span class="symbol">\</span>
<span class="normal">        </span><span class="keyword">if</span><span class="normal"> </span><span class="symbol">(</span><span class="normal">lcp##a </span><span class="symbol">==</span><span class="normal"> lcp##b</span><span class="symbol">)</span><span class="normal"> </span><span class="keyword">goto</span><span class="normal"> lcp_##a##eq##b##gt##c</span><span class="symbol">;</span><span class="normal">                      </span><span class="symbol">\</span>
<span class="normal">        </span><span class="keyword">if</span><span class="normal"> </span><span class="symbol">(</span><span class="normal">lcp##a </span><span class="symbol">&gt;</span><span class="normal">  lcp##c</span><span class="symbol">)</span><span class="normal"> </span><span class="keyword">goto</span><span class="normal"> lcp_##b##gt##a##gt##c</span><span class="symbol">;</span><span class="normal">                      </span><span class="symbol">\</span>
<span class="normal">        </span><span class="keyword">if</span><span class="normal"> </span><span class="symbol">(</span><span class="normal">lcp##a </span><span class="symbol">==</span><span class="normal"> lcp##c</span><span class="symbol">)</span><span class="normal"> </span><span class="keyword">goto</span><span class="normal"> lcp_##b##gt##a##eq##c</span><span class="symbol">;</span><span class="normal">                      </span><span class="symbol">\</span>
<span class="normal">        </span><span class="keyword">goto</span><span class="normal"> lcp_##b##gt##c##gt##a</span><span class="symbol">;</span>
<span class="normal">	</span><span class="function">StrictCase</span><span class="symbol">(</span><span class="number">0</span><span class="symbol">,</span><span class="normal"> </span><span class="number">1</span><span class="symbol">,</span><span class="normal"> </span><span class="number">2</span><span class="symbol">);</span>
<span class="normal">	</span><span class="function">StrictCase</span><span class="symbol">(</span><span class="number">0</span><span class="symbol">,</span><span class="normal"> </span><span class="number">2</span><span class="symbol">,</span><span class="normal"> </span><span class="number">1</span><span class="symbol">);</span>
<span class="normal">	</span><span class="function">StrictCase</span><span class="symbol">(</span><span class="number">1</span><span class="symbol">,</span><span class="normal"> </span><span class="number">0</span><span class="symbol">,</span><span class="normal"> </span><span class="number">2</span><span class="symbol">);</span>
<span class="normal">	</span><span class="function">StrictCase</span><span class="symbol">(</span><span class="number">1</span><span class="symbol">,</span><span class="normal"> </span><span class="number">2</span><span class="symbol">,</span><span class="normal"> </span><span class="number">0</span><span class="symbol">);</span>
<span class="normal">	</span><span class="function">StrictCase</span><span class="symbol">(</span><span class="number">2</span><span class="symbol">,</span><span class="normal"> </span><span class="number">0</span><span class="symbol">,</span><span class="normal"> </span><span class="number">1</span><span class="symbol">);</span>
<span class="normal">	</span><span class="function">StrictCase</span><span class="symbol">(</span><span class="number">2</span><span class="symbol">,</span><span class="normal"> </span><span class="number">1</span><span class="symbol">,</span><span class="normal"> </span><span class="number">0</span><span class="symbol">);</span>
<span class="preproc">#undef</span><span class="normal"> StrictCase</span>

<span class="preproc">#define</span><span class="normal"> </span><span class="function">GtEq</span><span class="symbol">(</span><span class="normal">a</span><span class="symbol">,</span><span class="normal"> b</span><span class="symbol">,</span><span class="normal"> c</span><span class="symbol">)</span><span class="normal">                                                          </span><span class="symbol">\</span>
<span class="normal">        </span><span class="function">BOOST_STATIC_ASSERT</span><span class="symbol">(</span><span class="normal">b </span><span class="symbol">&lt;</span><span class="normal"> c</span><span class="symbol">);</span><span class="normal">                                            </span><span class="symbol">\</span>
<span class="normal">        lcp_##a##gt##b##eq##c</span><span class="symbol">:</span><span class="normal">                                                 </span><span class="symbol">\</span>
<span class="normal">        </span><span class="function">debug</span><span class="symbol">()&lt;&lt;</span><span class="string">"</span><span class="specialchar">\t</span><span class="string">lcp_"</span><span class="symbol">&lt;&lt;</span><span class="normal">a</span><span class="symbol">&lt;&lt;</span><span class="string">"gt"</span><span class="symbol">&lt;&lt;</span><span class="normal">b</span><span class="symbol">&lt;&lt;</span><span class="string">"eq"</span><span class="symbol">&lt;&lt;</span><span class="normal">c</span><span class="symbol">&lt;&lt;</span><span class="string">"</span><span class="specialchar">\n</span><span class="string">"</span><span class="symbol">;</span><span class="normal">                          </span><span class="symbol">\</span>
<span class="normal">        </span><span class="function">assert</span><span class="symbol">(</span><span class="normal">lcp##a </span><span class="symbol">&gt;</span><span class="normal">  lcp##b</span><span class="symbol">);</span><span class="normal">                                              </span><span class="symbol">\</span>
<span class="normal">        </span><span class="function">assert</span><span class="symbol">(</span><span class="normal">lcp##b </span><span class="symbol">==</span><span class="normal"> lcp##c</span><span class="symbol">);</span><span class="normal">                                              </span><span class="symbol">\</span>
<span class="normal">        </span><span class="function">assert</span><span class="symbol">(</span><span class="function">cmp</span><span class="symbol">(*</span><span class="normal">from##a</span><span class="symbol">,</span><span class="normal"> </span><span class="symbol">*</span><span class="normal">from##b</span><span class="symbol">)</span><span class="normal"> </span><span class="symbol">&lt;</span><span class="normal"> </span><span class="number">0</span><span class="symbol">);</span><span class="normal">                                   </span><span class="symbol">\</span>
<span class="normal">        </span><span class="function">assert</span><span class="symbol">(</span><span class="function">cmp</span><span class="symbol">(*</span><span class="normal">from##a</span><span class="symbol">,</span><span class="normal"> </span><span class="symbol">*</span><span class="normal">from##c</span><span class="symbol">)</span><span class="normal"> </span><span class="symbol">&lt;</span><span class="normal"> </span><span class="number">0</span><span class="symbol">);</span><span class="normal">                                   </span><span class="symbol">\</span>
<span class="normal">        </span><span class="function">check_lcps</span><span class="symbol">(*(</span><span class="normal">result</span><span class="symbol">-</span><span class="number">1</span><span class="symbol">),*</span><span class="normal">from0</span><span class="symbol">,</span><span class="normal">lcp0</span><span class="symbol">,*</span><span class="normal">from1</span><span class="symbol">,</span><span class="normal">lcp1</span><span class="symbol">,*</span><span class="normal">from2</span><span class="symbol">,</span><span class="normal">lcp2</span><span class="symbol">);</span><span class="normal">           </span><span class="symbol">\</span>
<span class="normal">        </span><span class="symbol">*</span><span class="normal">result</span><span class="symbol">++</span><span class="normal"> </span><span class="symbol">=</span><span class="normal"> </span><span class="symbol">*</span><span class="normal">from##a</span><span class="symbol">++;</span><span class="normal">                                                </span><span class="symbol">\</span>
<span class="normal">        </span><span class="keyword">if</span><span class="normal"> </span><span class="symbol">(</span><span class="normal">OutputLCP</span><span class="symbol">)</span><span class="normal"> </span><span class="symbol">*</span><span class="normal">lcp_result</span><span class="symbol">++</span><span class="normal"> </span><span class="symbol">=</span><span class="normal"> lcp##a</span><span class="symbol">;</span><span class="normal">                                 </span><span class="symbol">\</span>
<span class="normal">        </span><span class="function">debug</span><span class="symbol">()&lt;&lt;</span><span class="string">"</span><span class="specialchar">\t</span><span class="string">lcp result &lt;&lt; "</span><span class="normal"> </span><span class="symbol">&lt;&lt;</span><span class="normal"> lcp##a </span><span class="symbol">&lt;&lt;</span><span class="normal"> </span><span class="string">'</span><span class="specialchar">\n</span><span class="string">'</span><span class="symbol">;</span><span class="normal">                         </span><span class="symbol">\</span>
<span class="normal">        lcp##a </span><span class="symbol">=</span><span class="normal"> </span><span class="symbol">*</span><span class="normal">lcp_input##a</span><span class="symbol">++;</span><span class="normal">                                              </span><span class="symbol">\</span>
<span class="normal">        </span><span class="keyword">if</span><span class="normal"> </span><span class="symbol">(--</span><span class="normal">n##a </span><span class="symbol">==</span><span class="normal"> </span><span class="number">0</span><span class="symbol">)</span><span class="normal"> </span><span class="keyword">goto</span><span class="normal"> finish##a</span><span class="symbol">;</span><span class="normal">                                       </span><span class="symbol">\</span>
<span class="normal">        </span><span class="keyword">if</span><span class="normal"> </span><span class="symbol">(</span><span class="normal">lcp##a </span><span class="symbol">&gt;</span><span class="normal">  lcp##b</span><span class="symbol">)</span><span class="normal"> </span><span class="keyword">goto</span><span class="normal"> lcp_##a##gt##b##eq##c</span><span class="symbol">;</span><span class="normal">                      </span><span class="symbol">\</span>
<span class="normal">        </span><span class="keyword">if</span><span class="normal"> </span><span class="symbol">(</span><span class="normal">lcp##a </span><span class="symbol">==</span><span class="normal"> lcp##b</span><span class="symbol">)</span><span class="normal"> </span><span class="keyword">goto</span><span class="normal"> lcp_##a##eq##b##eq##c</span><span class="symbol">;</span><span class="normal">                      </span><span class="symbol">\</span>
<span class="normal">        </span><span class="keyword">goto</span><span class="normal"> lcp_##b##eq##c##gt##a</span><span class="symbol">;</span>
<span class="normal">	</span><span class="function">GtEq</span><span class="symbol">(</span><span class="number">0</span><span class="symbol">,</span><span class="normal"> </span><span class="number">1</span><span class="symbol">,</span><span class="normal"> </span><span class="number">2</span><span class="symbol">);</span><span class="normal"> </span><span class="comment">// lcp0 &gt; lcp1 = lcp2</span>
<span class="normal">	</span><span class="function">GtEq</span><span class="symbol">(</span><span class="number">1</span><span class="symbol">,</span><span class="normal"> </span><span class="number">0</span><span class="symbol">,</span><span class="normal"> </span><span class="number">2</span><span class="symbol">);</span><span class="normal"> </span><span class="comment">// lcp1 &gt; lcp0 = lcp2</span>
<span class="normal">	</span><span class="function">GtEq</span><span class="symbol">(</span><span class="number">2</span><span class="symbol">,</span><span class="normal"> </span><span class="number">0</span><span class="symbol">,</span><span class="normal"> </span><span class="number">1</span><span class="symbol">);</span><span class="normal"> </span><span class="comment">// lcp2 &gt; lcp0 = lcp1</span>
<span class="normal">lcp_0gt2eq1</span><span class="symbol">:</span><span class="normal"> </span><span class="keyword">goto</span><span class="normal"> lcp_0gt1eq2</span><span class="symbol">;</span>
<span class="normal">lcp_2gt1eq0</span><span class="symbol">:</span><span class="normal"> </span><span class="keyword">goto</span><span class="normal"> lcp_2gt0eq1</span><span class="symbol">;</span>
<span class="normal">lcp_1gt2eq0</span><span class="symbol">:</span><span class="normal"> </span><span class="keyword">goto</span><span class="normal"> lcp_1gt0eq2</span><span class="symbol">;</span>
<span class="preproc">#undef</span><span class="normal"> GtEq</span>

<span class="preproc">#define</span><span class="normal"> </span><span class="function">EqGt</span><span class="symbol">(</span><span class="normal">a</span><span class="symbol">,</span><span class="normal"> b</span><span class="symbol">,</span><span class="normal"> c</span><span class="symbol">)</span><span class="normal">                                                          </span><span class="symbol">\</span>
<span class="normal">        </span><span class="function">BOOST_STATIC_ASSERT</span><span class="symbol">(</span><span class="normal">a </span><span class="symbol">&lt;</span><span class="normal"> b</span><span class="symbol">);</span><span class="normal">                                            </span><span class="symbol">\</span>
<span class="normal">        lcp_##a##eq##b##gt##c</span><span class="symbol">:</span><span class="normal">                                                 </span><span class="symbol">\</span>
<span class="cbracket">{</span><span class="normal">                                                                              </span><span class="symbol">\</span>
<span class="normal">        </span><span class="function">debug</span><span class="symbol">()&lt;&lt;</span><span class="string">"</span><span class="specialchar">\t</span><span class="string">lcp_"</span><span class="symbol">&lt;&lt;</span><span class="normal">a</span><span class="symbol">&lt;&lt;</span><span class="string">"eq"</span><span class="symbol">&lt;&lt;</span><span class="normal">b</span><span class="symbol">&lt;&lt;</span><span class="string">"gt"</span><span class="symbol">&lt;&lt;</span><span class="normal">c</span><span class="symbol">&lt;&lt;</span><span class="string">"</span><span class="specialchar">\n</span><span class="string">"</span><span class="symbol">;</span><span class="normal">                          </span><span class="symbol">\</span>
<span class="normal">        </span><span class="function">assert</span><span class="symbol">(</span><span class="normal">lcp##a </span><span class="symbol">==</span><span class="normal"> lcp##b</span><span class="symbol">);</span><span class="normal">                                              </span><span class="symbol">\</span>
<span class="normal">        </span><span class="function">assert</span><span class="symbol">(</span><span class="normal">lcp##b </span><span class="symbol">&gt;=</span><span class="normal"> lcp##c</span><span class="symbol">);</span><span class="normal">                                              </span><span class="symbol">\</span>
<span class="normal">        </span><span class="function">assert</span><span class="symbol">(</span><span class="function">cmp</span><span class="symbol">(*</span><span class="normal">from##a</span><span class="symbol">,</span><span class="normal"> </span><span class="symbol">*</span><span class="normal">from##c</span><span class="symbol">)</span><span class="normal"> </span><span class="symbol">&lt;</span><span class="normal"> </span><span class="number">0</span><span class="symbol">);</span><span class="normal">                                   </span><span class="symbol">\</span>
<span class="normal">        </span><span class="function">assert</span><span class="symbol">(</span><span class="function">cmp</span><span class="symbol">(*</span><span class="normal">from##b</span><span class="symbol">,</span><span class="normal"> </span><span class="symbol">*</span><span class="normal">from##c</span><span class="symbol">)</span><span class="normal"> </span><span class="symbol">&lt;</span><span class="normal"> </span><span class="number">0</span><span class="symbol">);</span><span class="normal">                                   </span><span class="symbol">\</span>
<span class="normal">        </span><span class="function">check_lcps</span><span class="symbol">(*(</span><span class="normal">result</span><span class="symbol">-</span><span class="number">1</span><span class="symbol">),*</span><span class="normal">from0</span><span class="symbol">,</span><span class="normal">lcp0</span><span class="symbol">,*</span><span class="normal">from1</span><span class="symbol">,</span><span class="normal">lcp1</span><span class="symbol">,*</span><span class="normal">from2</span><span class="symbol">,</span><span class="normal">lcp2</span><span class="symbol">);</span><span class="normal">           </span><span class="symbol">\</span>
<span class="normal">        </span><span class="type">int</span><span class="normal"> cmp##a##b</span><span class="symbol">;</span><span class="normal"> </span><span class="usertype">lcp_t</span><span class="normal"> lcp##a##b</span><span class="symbol">;</span><span class="normal">                                        </span><span class="symbol">\</span>
<span class="normal">        boost</span><span class="symbol">::</span><span class="function">tie</span><span class="symbol">(</span><span class="normal">cmp##a##b</span><span class="symbol">,</span><span class="normal"> lcp##a##b</span><span class="symbol">)=</span><span class="function">compare</span><span class="symbol">(*</span><span class="normal">from##a</span><span class="symbol">,</span><span class="normal"> </span><span class="symbol">*</span><span class="normal">from##b</span><span class="symbol">,</span><span class="normal"> lcp##a</span><span class="symbol">);</span><span class="normal">  </span><span class="symbol">\</span>
<span class="normal">        </span><span class="keyword">if</span><span class="normal"> </span><span class="symbol">(</span><span class="normal">cmp##a##b </span><span class="symbol">&lt;=</span><span class="normal"> </span><span class="number">0</span><span class="symbol">)</span><span class="normal"> </span><span class="cbracket">{</span><span class="normal">                                                  </span><span class="symbol">\</span>
<span class="normal">                </span><span class="symbol">*</span><span class="normal">result</span><span class="symbol">++</span><span class="normal"> </span><span class="symbol">=</span><span class="normal"> </span><span class="symbol">*</span><span class="normal">from##a</span><span class="symbol">++;</span><span class="normal">                                        </span><span class="symbol">\</span>
<span class="normal">                </span><span class="keyword">if</span><span class="normal"> </span><span class="symbol">(</span><span class="normal">OutputLCP</span><span class="symbol">)</span><span class="normal"> </span><span class="symbol">*</span><span class="normal">lcp_result</span><span class="symbol">++</span><span class="normal"> </span><span class="symbol">=</span><span class="normal"> lcp##a</span><span class="symbol">;</span><span class="normal">                         </span><span class="symbol">\</span>
<span class="normal">                </span><span class="function">debug</span><span class="symbol">()&lt;&lt;</span><span class="string">"</span><span class="specialchar">\t</span><span class="string">lcp result &lt;&lt; "</span><span class="normal"> </span><span class="symbol">&lt;&lt;</span><span class="normal"> lcp##a </span><span class="symbol">&lt;&lt;</span><span class="normal"> </span><span class="string">'</span><span class="specialchar">\n</span><span class="string">'</span><span class="symbol">;</span><span class="normal">                 </span><span class="symbol">\</span>
<span class="normal">                lcp##a </span><span class="symbol">=</span><span class="normal"> </span><span class="symbol">*</span><span class="normal">lcp_input##a</span><span class="symbol">++;</span><span class="normal">                                      </span><span class="symbol">\</span>
<span class="normal">                lcp##b </span><span class="symbol">=</span><span class="normal"> lcp##a##b</span><span class="symbol">;</span><span class="normal">                                            </span><span class="symbol">\</span>
<span class="normal">                </span><span class="keyword">if</span><span class="normal"> </span><span class="symbol">(--</span><span class="normal">n##a </span><span class="symbol">==</span><span class="normal"> </span><span class="number">0</span><span class="symbol">)</span><span class="normal"> </span><span class="keyword">goto</span><span class="normal"> finish##a</span><span class="symbol">;</span><span class="normal">                               </span><span class="symbol">\</span>
<span class="normal">        </span><span class="cbracket">}</span><span class="normal"> </span><span class="keyword">else</span><span class="normal"> </span><span class="cbracket">{</span><span class="normal">                                                               </span><span class="symbol">\</span>
<span class="normal">                </span><span class="symbol">*</span><span class="normal">result</span><span class="symbol">++</span><span class="normal"> </span><span class="symbol">=</span><span class="normal"> </span><span class="symbol">*</span><span class="normal">from##b</span><span class="symbol">++;</span><span class="normal">                                        </span><span class="symbol">\</span>
<span class="normal">                </span><span class="keyword">if</span><span class="normal"> </span><span class="symbol">(</span><span class="normal">OutputLCP</span><span class="symbol">)</span><span class="normal"> </span><span class="symbol">*</span><span class="normal">lcp_result</span><span class="symbol">++</span><span class="normal"> </span><span class="symbol">=</span><span class="normal"> lcp##b</span><span class="symbol">;</span><span class="normal">                         </span><span class="symbol">\</span>
<span class="normal">                </span><span class="function">debug</span><span class="symbol">()&lt;&lt;</span><span class="string">"</span><span class="specialchar">\t</span><span class="string">lcp result &lt;&lt; "</span><span class="normal"> </span><span class="symbol">&lt;&lt;</span><span class="normal"> lcp##a </span><span class="symbol">&lt;&lt;</span><span class="normal"> </span><span class="string">'</span><span class="specialchar">\n</span><span class="string">'</span><span class="symbol">;</span><span class="normal">                 </span><span class="symbol">\</span>
<span class="normal">                lcp##b </span><span class="symbol">=</span><span class="normal"> </span><span class="symbol">*</span><span class="normal">lcp_input##b</span><span class="symbol">++;</span><span class="normal">                                      </span><span class="symbol">\</span>
<span class="normal">                lcp##a </span><span class="symbol">=</span><span class="normal"> lcp##a##b</span><span class="symbol">;</span><span class="normal">                                            </span><span class="symbol">\</span>
<span class="normal">                </span><span class="keyword">if</span><span class="normal"> </span><span class="symbol">(--</span><span class="normal">n##b </span><span class="symbol">==</span><span class="normal"> </span><span class="number">0</span><span class="symbol">)</span><span class="normal"> </span><span class="keyword">goto</span><span class="normal"> finish##b</span><span class="symbol">;</span><span class="normal">                               </span><span class="symbol">\</span>
<span class="normal">        </span><span class="cbracket">}</span><span class="normal">                                                                      </span><span class="symbol">\</span>
<span class="normal">        </span><span class="keyword">goto</span><span class="normal"> branch_by_lcp</span><span class="symbol">;</span><span class="normal">                                                    </span><span class="symbol">\</span>
<span class="cbracket">}</span>
<span class="normal">	</span><span class="function">EqGt</span><span class="symbol">(</span><span class="number">0</span><span class="symbol">,</span><span class="normal"> </span><span class="number">1</span><span class="symbol">,</span><span class="normal"> </span><span class="number">2</span><span class="symbol">);</span><span class="normal"> </span><span class="comment">// lcp0 = lcp1 &gt; lcp2</span>
<span class="normal">	</span><span class="function">EqGt</span><span class="symbol">(</span><span class="number">0</span><span class="symbol">,</span><span class="normal"> </span><span class="number">2</span><span class="symbol">,</span><span class="normal"> </span><span class="number">1</span><span class="symbol">);</span><span class="normal"> </span><span class="comment">// lcp0 = lcp2 &gt; lcp1</span>
<span class="normal">	</span><span class="function">EqGt</span><span class="symbol">(</span><span class="number">1</span><span class="symbol">,</span><span class="normal"> </span><span class="number">2</span><span class="symbol">,</span><span class="normal"> </span><span class="number">0</span><span class="symbol">);</span><span class="normal"> </span><span class="comment">// lcp1 = lcp2 &gt; lcp0</span>
<span class="normal">lcp_1eq0gt2</span><span class="symbol">:</span><span class="normal"> </span><span class="keyword">goto</span><span class="normal"> lcp_0eq1gt2</span><span class="symbol">;</span>
<span class="normal">lcp_2eq0gt1</span><span class="symbol">:</span><span class="normal"> </span><span class="keyword">goto</span><span class="normal"> lcp_0eq2gt1</span><span class="symbol">;</span>
<span class="normal">lcp_2eq1gt0</span><span class="symbol">:</span><span class="normal"> </span><span class="keyword">goto</span><span class="normal"> lcp_1eq2gt0</span><span class="symbol">;</span>
<span class="preproc">#undef</span><span class="normal"> EqGt</span>

<span class="normal">lcp_1eq0eq2</span><span class="symbol">:</span>
<span class="normal">lcp_2eq0eq1</span><span class="symbol">:</span>
<span class="normal">lcp_0eq1eq2</span><span class="symbol">:</span><span class="normal"> </span><span class="function">INITIAL_STATE</span><span class="symbol">(</span><span class="keyword">true</span><span class="symbol">)</span>

<span class="label">finish0:</span>
<span class="normal">	</span><span class="function">assert</span><span class="symbol">(</span><span class="normal">n0 </span><span class="symbol">==</span><span class="normal"> </span><span class="number">0</span><span class="symbol">);</span>
<span class="normal">	</span><span class="keyword">if</span><span class="normal"> </span><span class="symbol">(</span><span class="normal">OutputLCP</span><span class="symbol">)</span><span class="normal"> </span><span class="symbol">*</span><span class="normal">lcp_result</span><span class="symbol">++</span><span class="normal"> </span><span class="symbol">=</span><span class="normal"> std</span><span class="symbol">::</span><span class="function">max</span><span class="symbol">(</span><span class="normal">lcp1</span><span class="symbol">,</span><span class="normal"> lcp2</span><span class="symbol">);</span>
<span class="normal">	merge_lcp_2way</span><span class="symbol">&lt;</span><span class="normal">OutputLCP</span><span class="symbol">&gt;(</span><span class="normal">from1</span><span class="symbol">,</span><span class="normal"> lcp_input1</span><span class="symbol">,</span><span class="normal"> n1</span><span class="symbol">,</span>
<span class="normal">	                          from2</span><span class="symbol">,</span><span class="normal"> lcp_input2</span><span class="symbol">,</span><span class="normal"> n2</span><span class="symbol">,</span>
<span class="normal">	                          result</span><span class="symbol">,</span><span class="normal"> lcp_result</span><span class="symbol">);</span>
<span class="normal">	</span><span class="function">debug</span><span class="symbol">()</span><span class="normal"> </span><span class="symbol">&lt;&lt;</span><span class="normal"> </span><span class="string">'~'</span><span class="normal"> </span><span class="symbol">&lt;&lt;</span><span class="normal"> __func__ </span><span class="symbol">&lt;&lt;</span><span class="normal"> </span><span class="string">'</span><span class="specialchar">\n</span><span class="string">'</span><span class="symbol">;</span>
<span class="normal">	</span><span class="keyword">return</span><span class="symbol">;</span>
<span class="label">finish1:</span>
<span class="normal">	</span><span class="function">assert</span><span class="symbol">(</span><span class="normal">n1 </span><span class="symbol">==</span><span class="normal"> </span><span class="number">0</span><span class="symbol">);</span>
<span class="normal">	</span><span class="keyword">if</span><span class="normal"> </span><span class="symbol">(</span><span class="normal">OutputLCP</span><span class="symbol">)</span><span class="normal"> </span><span class="symbol">*</span><span class="normal">lcp_result</span><span class="symbol">++</span><span class="normal"> </span><span class="symbol">=</span><span class="normal"> std</span><span class="symbol">::</span><span class="function">max</span><span class="symbol">(</span><span class="normal">lcp0</span><span class="symbol">,</span><span class="normal"> lcp2</span><span class="symbol">);</span>
<span class="normal">	merge_lcp_2way</span><span class="symbol">&lt;</span><span class="normal">OutputLCP</span><span class="symbol">&gt;(</span><span class="normal">from0</span><span class="symbol">,</span><span class="normal"> lcp_input0</span><span class="symbol">,</span><span class="normal"> n0</span><span class="symbol">,</span>
<span class="normal">	                          from2</span><span class="symbol">,</span><span class="normal"> lcp_input2</span><span class="symbol">,</span><span class="normal"> n2</span><span class="symbol">,</span>
<span class="normal">	                          result</span><span class="symbol">,</span><span class="normal"> lcp_result</span><span class="symbol">);</span>
<span class="normal">	</span><span class="function">debug</span><span class="symbol">()</span><span class="normal"> </span><span class="symbol">&lt;&lt;</span><span class="normal"> </span><span class="string">'~'</span><span class="normal"> </span><span class="symbol">&lt;&lt;</span><span class="normal"> __func__ </span><span class="symbol">&lt;&lt;</span><span class="normal"> </span><span class="string">'</span><span class="specialchar">\n</span><span class="string">'</span><span class="symbol">;</span>
<span class="normal">	</span><span class="keyword">return</span><span class="symbol">;</span>
<span class="label">finish2:</span>
<span class="normal">	</span><span class="function">assert</span><span class="symbol">(</span><span class="normal">n2 </span><span class="symbol">==</span><span class="normal"> </span><span class="number">0</span><span class="symbol">);</span>
<span class="normal">	</span><span class="keyword">if</span><span class="normal"> </span><span class="symbol">(</span><span class="normal">OutputLCP</span><span class="symbol">)</span><span class="normal"> </span><span class="symbol">*</span><span class="normal">lcp_result</span><span class="symbol">++</span><span class="normal"> </span><span class="symbol">=</span><span class="normal"> std</span><span class="symbol">::</span><span class="function">max</span><span class="symbol">(</span><span class="normal">lcp0</span><span class="symbol">,</span><span class="normal"> lcp1</span><span class="symbol">);</span>
<span class="normal">	merge_lcp_2way</span><span class="symbol">&lt;</span><span class="normal">OutputLCP</span><span class="symbol">&gt;(</span><span class="normal">from0</span><span class="symbol">,</span><span class="normal"> lcp_input0</span><span class="symbol">,</span><span class="normal"> n0</span><span class="symbol">,</span>
<span class="normal">	                          from1</span><span class="symbol">,</span><span class="normal"> lcp_input1</span><span class="symbol">,</span><span class="normal"> n1</span><span class="symbol">,</span>
<span class="normal">	                          result</span><span class="symbol">,</span><span class="normal"> lcp_result</span><span class="symbol">);</span>
<span class="normal">	</span><span class="function">debug</span><span class="symbol">()</span><span class="normal"> </span><span class="symbol">&lt;&lt;</span><span class="normal"> </span><span class="string">'~'</span><span class="normal"> </span><span class="symbol">&lt;&lt;</span><span class="normal"> __func__ </span><span class="symbol">&lt;&lt;</span><span class="normal"> </span><span class="string">'</span><span class="specialchar">\n</span><span class="string">'</span><span class="symbol">;</span>
<span class="normal">	</span><span class="keyword">return</span><span class="symbol">;</span>
<span class="cbracket">}</span>

<span class="keyword">template</span><span class="normal"> </span><span class="symbol">&lt;</span><span class="type">bool</span><span class="normal"> OutputLCP</span><span class="symbol">&gt;</span>
<span class="normal">MergeResult</span>
<span class="function">mergesort_lcp_3way</span><span class="symbol">(</span><span class="type">unsigned</span><span class="normal"> </span><span class="type">char</span><span class="symbol">**</span><span class="normal"> </span><span class="usertype">restrict</span><span class="normal"> strings_input</span><span class="symbol">,</span>
<span class="normal">                   </span><span class="type">unsigned</span><span class="normal"> </span><span class="type">char</span><span class="symbol">**</span><span class="normal"> </span><span class="usertype">restrict</span><span class="normal"> strings_output</span><span class="symbol">,</span>
<span class="normal">                   lcp_t</span><span class="symbol">*</span><span class="normal"> </span><span class="usertype">restrict</span><span class="normal"> lcp_input</span><span class="symbol">,</span><span class="normal"> lcp_t</span><span class="symbol">*</span><span class="normal"> </span><span class="usertype">restrict</span><span class="normal"> lcp_output</span><span class="symbol">,</span>
<span class="normal">                   </span><span class="usertype">size_t</span><span class="normal"> n</span><span class="symbol">)</span>
<span class="cbracket">{</span>
<span class="normal">	</span><span class="function">debug</span><span class="symbol">()</span><span class="normal"> </span><span class="symbol">&lt;&lt;</span><span class="normal"> __func__ </span><span class="symbol">&lt;&lt;</span><span class="normal"> </span><span class="string">"(): n="</span><span class="normal"> </span><span class="symbol">&lt;&lt;</span><span class="normal"> n </span><span class="symbol">&lt;&lt;</span><span class="normal"> </span><span class="string">'</span><span class="specialchar">\n</span><span class="string">'</span><span class="symbol">;</span>
<span class="normal">	</span><span class="keyword">if</span><span class="normal"> </span><span class="symbol">(</span><span class="normal">n </span><span class="symbol">&lt;</span><span class="normal"> </span><span class="number">32</span><span class="symbol">)</span><span class="normal"> </span><span class="cbracket">{</span>
<span class="normal">		</span><span class="function">insertion_sort</span><span class="symbol">(</span><span class="normal">strings_input</span><span class="symbol">,</span><span class="normal"> n</span><span class="symbol">,</span><span class="normal"> </span><span class="number">0</span><span class="symbol">);</span>
<span class="normal">		</span><span class="keyword">for</span><span class="normal"> </span><span class="symbol">(</span><span class="type">unsigned</span><span class="normal"> i</span><span class="symbol">=</span><span class="number">0</span><span class="symbol">;</span><span class="normal"> i </span><span class="symbol">&lt;</span><span class="normal"> n</span><span class="symbol">-</span><span class="number">1</span><span class="symbol">;</span><span class="normal"> </span><span class="symbol">++</span><span class="normal">i</span><span class="symbol">)</span>
<span class="normal">			lcp_input</span><span class="symbol">[</span><span class="normal">i</span><span class="symbol">]</span><span class="normal"> </span><span class="symbol">=</span><span class="normal"> </span><span class="function">lcp</span><span class="symbol">(</span><span class="normal">strings_input</span><span class="symbol">[</span><span class="normal">i</span><span class="symbol">],</span><span class="normal"> strings_input</span><span class="symbol">[</span><span class="normal">i</span><span class="symbol">+</span><span class="number">1</span><span class="symbol">]);</span>
<span class="normal">		</span><span class="keyword">return</span><span class="normal"> SortedInPlace</span><span class="symbol">;</span>
<span class="normal">	</span><span class="cbracket">}</span>
<span class="normal">	</span><span class="keyword">const</span><span class="normal"> </span><span class="usertype">size_t</span><span class="normal"> split0 </span><span class="symbol">=</span><span class="normal"> n</span><span class="symbol">/</span><span class="number">3</span><span class="symbol">,</span>
<span class="normal">	             split1 </span><span class="symbol">=</span><span class="normal"> </span><span class="function">size_t</span><span class="symbol">((</span><span class="number">2.0</span><span class="symbol">/</span><span class="number">3.0</span><span class="symbol">)*</span><span class="normal">n</span><span class="symbol">);</span>
<span class="normal">	</span><span class="usertype">MergeResult</span><span class="normal"> m0 </span><span class="symbol">=</span><span class="normal"> mergesort_lcp_3way</span><span class="symbol">&lt;</span><span class="keyword">true</span><span class="symbol">&gt;(</span>
<span class="normal">			strings_input</span><span class="symbol">,</span><span class="normal">        strings_output</span><span class="symbol">,</span>
<span class="normal">			lcp_input</span><span class="symbol">,</span><span class="normal">            lcp_output</span><span class="symbol">,</span>
<span class="normal">			split0</span><span class="symbol">);</span>
<span class="normal">	</span><span class="function">debug</span><span class="symbol">()</span><span class="normal"> </span><span class="symbol">&lt;&lt;</span><span class="normal"> __func__ </span><span class="symbol">&lt;&lt;</span><span class="normal"> </span><span class="string">"(): checking first merge</span><span class="specialchar">\n</span><span class="string">"</span><span class="symbol">;</span>
<span class="normal">	</span><span class="keyword">if</span><span class="normal"> </span><span class="symbol">(</span><span class="normal">m0 </span><span class="symbol">==</span><span class="normal"> SortedInPlace</span><span class="symbol">)</span><span class="normal"> </span><span class="function">check_input</span><span class="symbol">(</span><span class="normal">strings_input</span><span class="symbol">,</span><span class="normal">  lcp_input</span><span class="symbol">,</span><span class="normal">  split0</span><span class="symbol">);</span>
<span class="normal">	</span><span class="keyword">else</span><span class="normal">                     </span><span class="function">check_input</span><span class="symbol">(</span><span class="normal">strings_output</span><span class="symbol">,</span><span class="normal"> lcp_output</span><span class="symbol">,</span><span class="normal"> split0</span><span class="symbol">);</span>
<span class="normal">	</span><span class="usertype">MergeResult</span><span class="normal"> m1 </span><span class="symbol">=</span><span class="normal"> mergesort_lcp_3way</span><span class="symbol">&lt;</span><span class="keyword">true</span><span class="symbol">&gt;(</span>
<span class="normal">			strings_input</span><span class="symbol">+</span><span class="normal">split0</span><span class="symbol">,</span><span class="normal"> strings_output</span><span class="symbol">+</span><span class="normal">split0</span><span class="symbol">,</span>
<span class="normal">			lcp_input</span><span class="symbol">+</span><span class="normal">split0</span><span class="symbol">,</span><span class="normal">     lcp_output</span><span class="symbol">+</span><span class="normal">split0</span><span class="symbol">,</span>
<span class="normal">			split1</span><span class="symbol">-</span><span class="normal">split0</span><span class="symbol">);</span>
<span class="normal">	</span><span class="function">debug</span><span class="symbol">()</span><span class="normal"> </span><span class="symbol">&lt;&lt;</span><span class="normal"> __func__ </span><span class="symbol">&lt;&lt;</span><span class="normal"> </span><span class="string">"(): checking second merge</span><span class="specialchar">\n</span><span class="string">"</span><span class="symbol">;</span>
<span class="normal">	</span><span class="keyword">if</span><span class="normal"> </span><span class="symbol">(</span><span class="normal">m1 </span><span class="symbol">==</span><span class="normal"> SortedInPlace</span><span class="symbol">)</span><span class="normal"> </span><span class="function">check_input</span><span class="symbol">(</span><span class="normal">strings_input</span><span class="symbol">+</span><span class="normal">split0</span><span class="symbol">,</span><span class="normal">  lcp_input</span><span class="symbol">+</span><span class="normal">split0</span><span class="symbol">,</span><span class="normal">  split1</span><span class="symbol">-</span><span class="normal">split0</span><span class="symbol">);</span>
<span class="normal">	</span><span class="keyword">else</span><span class="normal">                     </span><span class="function">check_input</span><span class="symbol">(</span><span class="normal">strings_output</span><span class="symbol">+</span><span class="normal">split0</span><span class="symbol">,</span><span class="normal"> lcp_output</span><span class="symbol">+</span><span class="normal">split0</span><span class="symbol">,</span><span class="normal"> split1</span><span class="symbol">-</span><span class="normal">split0</span><span class="symbol">);</span>
<span class="normal">	</span><span class="usertype">MergeResult</span><span class="normal"> m2 </span><span class="symbol">=</span><span class="normal"> mergesort_lcp_3way</span><span class="symbol">&lt;</span><span class="keyword">true</span><span class="symbol">&gt;(</span>
<span class="normal">			strings_input</span><span class="symbol">+</span><span class="normal">split1</span><span class="symbol">,</span><span class="normal"> strings_output</span><span class="symbol">+</span><span class="normal">split1</span><span class="symbol">,</span>
<span class="normal">			lcp_input</span><span class="symbol">+</span><span class="normal">split1</span><span class="symbol">,</span><span class="normal">     lcp_output</span><span class="symbol">+</span><span class="normal">split1</span><span class="symbol">,</span>
<span class="normal">			n</span><span class="symbol">-</span><span class="normal">split1</span><span class="symbol">);</span>
<span class="normal">	</span><span class="function">debug</span><span class="symbol">()</span><span class="normal"> </span><span class="symbol">&lt;&lt;</span><span class="normal"> __func__ </span><span class="symbol">&lt;&lt;</span><span class="normal"> </span><span class="string">"(): checking third merge</span><span class="specialchar">\n</span><span class="string">"</span><span class="symbol">;</span>
<span class="normal">	</span><span class="keyword">if</span><span class="normal"> </span><span class="symbol">(</span><span class="normal">m2 </span><span class="symbol">==</span><span class="normal"> SortedInPlace</span><span class="symbol">)</span><span class="normal"> </span><span class="function">check_input</span><span class="symbol">(</span><span class="normal">strings_input</span><span class="symbol">+</span><span class="normal">split1</span><span class="symbol">,</span><span class="normal">  lcp_input</span><span class="symbol">+</span><span class="normal">split1</span><span class="symbol">,</span><span class="normal">  n</span><span class="symbol">-</span><span class="normal">split1</span><span class="symbol">);</span>
<span class="normal">	</span><span class="keyword">else</span><span class="normal">                     </span><span class="function">check_input</span><span class="symbol">(</span><span class="normal">strings_output</span><span class="symbol">+</span><span class="normal">split1</span><span class="symbol">,</span><span class="normal"> lcp_output</span><span class="symbol">+</span><span class="normal">split1</span><span class="symbol">,</span><span class="normal"> n</span><span class="symbol">-</span><span class="normal">split1</span><span class="symbol">);</span>
<span class="normal">	</span><span class="function">debug</span><span class="symbol">()</span><span class="normal"> </span><span class="symbol">&lt;&lt;</span><span class="normal"> __func__ </span><span class="symbol">&lt;&lt;</span><span class="normal"> </span><span class="string">"(): m0="</span><span class="symbol">&lt;&lt;</span><span class="normal">m0</span><span class="symbol">&lt;&lt;</span><span class="string">", m1="</span><span class="symbol">&lt;&lt;</span><span class="normal">m1</span><span class="symbol">&lt;&lt;</span><span class="string">", m2="</span><span class="symbol">&lt;&lt;</span><span class="normal">m2</span><span class="symbol">&lt;&lt;</span><span class="string">"</span><span class="specialchar">\n</span><span class="string">"</span><span class="symbol">;</span>
<span class="normal">	</span><span class="keyword">if</span><span class="normal"> </span><span class="symbol">(</span><span class="normal">m0 </span><span class="symbol">!=</span><span class="normal"> m1</span><span class="symbol">)</span><span class="normal"> </span><span class="cbracket">{</span>
<span class="normal">		</span><span class="keyword">if</span><span class="normal"> </span><span class="symbol">(</span><span class="normal">m1 </span><span class="symbol">!=</span><span class="normal"> m2</span><span class="symbol">)</span><span class="normal"> </span><span class="cbracket">{</span>
<span class="normal">			</span><span class="comment">// m0 == m2 != m1</span>
<span class="normal">			</span><span class="keyword">if</span><span class="normal"> </span><span class="symbol">(</span><span class="normal">m1 </span><span class="symbol">==</span><span class="normal"> SortedInPlace</span><span class="symbol">)</span><span class="normal"> </span><span class="cbracket">{</span>
<span class="normal">				std</span><span class="symbol">::</span><span class="function">copy</span><span class="symbol">(</span><span class="normal">strings_input</span><span class="symbol">+</span><span class="normal">split0</span><span class="symbol">,</span><span class="normal"> strings_input</span><span class="symbol">+</span><span class="normal">split1</span><span class="symbol">,</span>
<span class="normal">						strings_output</span><span class="symbol">+</span><span class="normal">split0</span><span class="symbol">);</span>
<span class="normal">				std</span><span class="symbol">::</span><span class="function">copy</span><span class="symbol">(</span><span class="normal">lcp_input</span><span class="symbol">+</span><span class="normal">split0</span><span class="symbol">,</span><span class="normal"> lcp_input</span><span class="symbol">+</span><span class="normal">split1</span><span class="symbol">,</span>
<span class="normal">						lcp_output</span><span class="symbol">+</span><span class="normal">split0</span><span class="symbol">);</span>
<span class="normal">				m1 </span><span class="symbol">=</span><span class="normal"> SortedInTemp</span><span class="symbol">;</span>
<span class="normal">			</span><span class="cbracket">}</span><span class="normal"> </span><span class="keyword">else</span><span class="normal"> </span><span class="cbracket">{</span>
<span class="normal">				std</span><span class="symbol">::</span><span class="function">copy</span><span class="symbol">(</span><span class="normal">strings_output</span><span class="symbol">+</span><span class="normal">split0</span><span class="symbol">,</span><span class="normal"> strings_output</span><span class="symbol">+</span><span class="normal">split1</span><span class="symbol">,</span>
<span class="normal">						strings_input</span><span class="symbol">+</span><span class="normal">split0</span><span class="symbol">);</span>
<span class="normal">				std</span><span class="symbol">::</span><span class="function">copy</span><span class="symbol">(</span><span class="normal">lcp_output</span><span class="symbol">+</span><span class="normal">split0</span><span class="symbol">,</span><span class="normal"> lcp_output</span><span class="symbol">+</span><span class="normal">split1</span><span class="symbol">,</span>
<span class="normal">						lcp_input</span><span class="symbol">+</span><span class="normal">split0</span><span class="symbol">);</span>
<span class="normal">				m1 </span><span class="symbol">=</span><span class="normal"> SortedInPlace</span><span class="symbol">;</span>
<span class="normal">			</span><span class="cbracket">}</span>
<span class="normal">		</span><span class="cbracket">}</span><span class="normal"> </span><span class="keyword">else</span><span class="normal"> </span><span class="cbracket">{</span>
<span class="normal">			</span><span class="comment">// m0 != m1 == m2</span>
<span class="normal">			</span><span class="keyword">if</span><span class="normal"> </span><span class="symbol">(</span><span class="normal">m0 </span><span class="symbol">==</span><span class="normal"> SortedInPlace</span><span class="symbol">)</span><span class="normal"> </span><span class="cbracket">{</span>
<span class="normal">				std</span><span class="symbol">::</span><span class="function">copy</span><span class="symbol">(</span><span class="normal">strings_input</span><span class="symbol">,</span><span class="normal"> strings_input</span><span class="symbol">+</span><span class="normal">split0</span><span class="symbol">,</span>
<span class="normal">						strings_output</span><span class="symbol">);</span>
<span class="normal">				std</span><span class="symbol">::</span><span class="function">copy</span><span class="symbol">(</span><span class="normal">lcp_input</span><span class="symbol">,</span><span class="normal"> lcp_input</span><span class="symbol">+</span><span class="normal">split0</span><span class="symbol">,</span>
<span class="normal">						lcp_output</span><span class="symbol">);</span>
<span class="normal">				m0 </span><span class="symbol">=</span><span class="normal"> SortedInTemp</span><span class="symbol">;</span>
<span class="normal">			</span><span class="cbracket">}</span><span class="normal"> </span><span class="keyword">else</span><span class="normal"> </span><span class="cbracket">{</span>
<span class="normal">				std</span><span class="symbol">::</span><span class="function">copy</span><span class="symbol">(</span><span class="normal">strings_output</span><span class="symbol">,</span><span class="normal"> strings_output</span><span class="symbol">+</span><span class="normal">split0</span><span class="symbol">,</span>
<span class="normal">						strings_input</span><span class="symbol">);</span>
<span class="normal">				std</span><span class="symbol">::</span><span class="function">copy</span><span class="symbol">(</span><span class="normal">lcp_output</span><span class="symbol">,</span><span class="normal"> lcp_output</span><span class="symbol">+</span><span class="normal">split0</span><span class="symbol">,</span>
<span class="normal">						lcp_input</span><span class="symbol">);</span>
<span class="normal">				m0 </span><span class="symbol">=</span><span class="normal"> SortedInPlace</span><span class="symbol">;</span>
<span class="normal">			</span><span class="cbracket">}</span>
<span class="normal">		</span><span class="cbracket">}</span>
<span class="normal">	</span><span class="cbracket">}</span>
<span class="normal">	</span><span class="keyword">if</span><span class="normal"> </span><span class="symbol">(</span><span class="normal">m1 </span><span class="symbol">!=</span><span class="normal"> m2</span><span class="symbol">)</span><span class="normal"> </span><span class="cbracket">{</span>
<span class="normal">		</span><span class="keyword">if</span><span class="normal"> </span><span class="symbol">(</span><span class="normal">m2 </span><span class="symbol">==</span><span class="normal"> SortedInPlace</span><span class="symbol">)</span><span class="normal"> </span><span class="cbracket">{</span>
<span class="normal">			std</span><span class="symbol">::</span><span class="function">copy</span><span class="symbol">(</span><span class="normal">strings_input</span><span class="symbol">+</span><span class="normal">split1</span><span class="symbol">,</span><span class="normal"> strings_input</span><span class="symbol">+</span><span class="normal">n</span><span class="symbol">,</span>
<span class="normal">					strings_output</span><span class="symbol">+</span><span class="normal">split1</span><span class="symbol">);</span>
<span class="normal">			std</span><span class="symbol">::</span><span class="function">copy</span><span class="symbol">(</span><span class="normal">lcp_input</span><span class="symbol">+</span><span class="normal">split1</span><span class="symbol">,</span><span class="normal"> lcp_input</span><span class="symbol">+</span><span class="normal">n</span><span class="symbol">,</span>
<span class="normal">					lcp_output</span><span class="symbol">+</span><span class="normal">split1</span><span class="symbol">);</span>
<span class="normal">			m2 </span><span class="symbol">=</span><span class="normal"> SortedInTemp</span><span class="symbol">;</span>
<span class="normal">		</span><span class="cbracket">}</span><span class="normal"> </span><span class="keyword">else</span><span class="normal"> </span><span class="cbracket">{</span>
<span class="normal">			std</span><span class="symbol">::</span><span class="function">copy</span><span class="symbol">(</span><span class="normal">strings_output</span><span class="symbol">+</span><span class="normal">split1</span><span class="symbol">,</span><span class="normal"> strings_output</span><span class="symbol">+</span><span class="normal">n</span><span class="symbol">,</span>
<span class="normal">					strings_input</span><span class="symbol">+</span><span class="normal">split1</span><span class="symbol">);</span>
<span class="normal">			std</span><span class="symbol">::</span><span class="function">copy</span><span class="symbol">(</span><span class="normal">lcp_output</span><span class="symbol">+</span><span class="normal">split1</span><span class="symbol">,</span><span class="normal"> lcp_output</span><span class="symbol">+</span><span class="normal">n</span><span class="symbol">,</span>
<span class="normal">					lcp_input</span><span class="symbol">+</span><span class="normal">split1</span><span class="symbol">);</span>
<span class="normal">			m2 </span><span class="symbol">=</span><span class="normal"> SortedInPlace</span><span class="symbol">;</span>
<span class="normal">		</span><span class="cbracket">}</span>
<span class="normal">	</span><span class="cbracket">}</span>
<span class="normal">	</span><span class="function">assert</span><span class="symbol">(</span><span class="normal">m0 </span><span class="symbol">==</span><span class="normal"> m1</span><span class="symbol">);</span><span class="normal"> </span><span class="function">assert</span><span class="symbol">(</span><span class="normal">m1 </span><span class="symbol">==</span><span class="normal"> m2</span><span class="symbol">);</span>
<span class="normal">	</span><span class="keyword">if</span><span class="normal"> </span><span class="symbol">(</span><span class="normal">m0 </span><span class="symbol">==</span><span class="normal"> SortedInPlace</span><span class="symbol">)</span><span class="normal"> </span><span class="cbracket">{</span>
<span class="normal">		merge_lcp_3way</span><span class="symbol">&lt;</span><span class="normal">OutputLCP</span><span class="symbol">&gt;(</span>
<span class="normal">			   strings_input</span><span class="symbol">,</span><span class="normal">        lcp_input</span><span class="symbol">,</span><span class="normal">        split0</span><span class="symbol">,</span>
<span class="normal">			   strings_input</span><span class="symbol">+</span><span class="normal">split0</span><span class="symbol">,</span><span class="normal"> lcp_input</span><span class="symbol">+</span><span class="normal">split0</span><span class="symbol">,</span><span class="normal"> split1</span><span class="symbol">-</span><span class="normal">split0</span><span class="symbol">,</span>
<span class="normal">			   strings_input</span><span class="symbol">+</span><span class="normal">split1</span><span class="symbol">,</span><span class="normal"> lcp_input</span><span class="symbol">+</span><span class="normal">split1</span><span class="symbol">,</span><span class="normal"> n</span><span class="symbol">-</span><span class="normal">split1</span><span class="symbol">,</span>
<span class="normal">			   strings_output</span><span class="symbol">,</span><span class="normal"> lcp_output</span><span class="symbol">);</span>
<span class="normal">		</span><span class="comment">//debug() &lt;&lt; __func__ &lt;&lt; "(): checking merged result, in -&gt; out\n";</span>
<span class="normal">		</span><span class="keyword">if</span><span class="normal"> </span><span class="symbol">(</span><span class="normal">OutputLCP</span><span class="symbol">)</span><span class="normal"> </span><span class="function">check_input</span><span class="symbol">(</span><span class="normal">strings_output</span><span class="symbol">,</span><span class="normal"> lcp_output</span><span class="symbol">,</span><span class="normal"> n</span><span class="symbol">);</span>
<span class="normal">		</span><span class="keyword">return</span><span class="normal"> SortedInTemp</span><span class="symbol">;</span>
<span class="normal">	</span><span class="cbracket">}</span><span class="normal"> </span><span class="keyword">else</span><span class="normal"> </span><span class="cbracket">{</span>
<span class="normal">		merge_lcp_3way</span><span class="symbol">&lt;</span><span class="normal">OutputLCP</span><span class="symbol">&gt;(</span>
<span class="normal">			   strings_output</span><span class="symbol">,</span><span class="normal">        lcp_output</span><span class="symbol">,</span><span class="normal">        split0</span><span class="symbol">,</span>
<span class="normal">			   strings_output</span><span class="symbol">+</span><span class="normal">split0</span><span class="symbol">,</span><span class="normal"> lcp_output</span><span class="symbol">+</span><span class="normal">split0</span><span class="symbol">,</span><span class="normal"> split1</span><span class="symbol">-</span><span class="normal">split0</span><span class="symbol">,</span>
<span class="normal">			   strings_output</span><span class="symbol">+</span><span class="normal">split1</span><span class="symbol">,</span><span class="normal"> lcp_output</span><span class="symbol">+</span><span class="normal">split1</span><span class="symbol">,</span><span class="normal"> n</span><span class="symbol">-</span><span class="normal">split1</span><span class="symbol">,</span>
<span class="normal">			   strings_input</span><span class="symbol">,</span><span class="normal"> lcp_input</span><span class="symbol">);</span>
<span class="normal">		</span><span class="comment">//debug() &lt;&lt; __func__ &lt;&lt; "(): checking merged result, out -&gt; in\n";</span>
<span class="normal">		</span><span class="keyword">if</span><span class="normal"> </span><span class="symbol">(</span><span class="normal">OutputLCP</span><span class="symbol">)</span><span class="normal"> </span><span class="function">check_input</span><span class="symbol">(</span><span class="normal">strings_input</span><span class="symbol">,</span><span class="normal"> lcp_input</span><span class="symbol">,</span><span class="normal"> n</span><span class="symbol">);</span>
<span class="normal">		</span><span class="keyword">return</span><span class="normal"> SortedInPlace</span><span class="symbol">;</span>
<span class="normal">	</span><span class="cbracket">}</span>
<span class="cbracket">}</span>
<span class="type">void</span>
<span class="function">mergesort_lcp_3way</span><span class="symbol">(</span><span class="type">unsigned</span><span class="normal"> </span><span class="type">char</span><span class="symbol">**</span><span class="normal"> strings</span><span class="symbol">,</span><span class="normal"> </span><span class="usertype">size_t</span><span class="normal"> n</span><span class="symbol">)</span>
<span class="cbracket">{</span>
<span class="normal">	</span><span class="function">debug</span><span class="symbol">()</span><span class="normal"> </span><span class="symbol">&lt;&lt;</span><span class="normal"> __func__ </span><span class="symbol">&lt;&lt;</span><span class="normal"> </span><span class="string">'</span><span class="specialchar">\n</span><span class="string">'</span><span class="symbol">;</span>
<span class="normal">	lcp_t</span><span class="symbol">*</span><span class="normal"> lcp_input </span><span class="symbol">=</span><span class="normal"> </span><span class="symbol">(</span><span class="normal">lcp_t</span><span class="symbol">*)</span><span class="normal"> </span><span class="function">malloc</span><span class="symbol">(</span><span class="normal">n</span><span class="symbol">*</span><span class="keyword">sizeof</span><span class="symbol">(</span><span class="normal">lcp_t</span><span class="symbol">));</span>
<span class="normal">	lcp_t</span><span class="symbol">*</span><span class="normal"> lcp_tmp   </span><span class="symbol">=</span><span class="normal"> </span><span class="symbol">(</span><span class="normal">lcp_t</span><span class="symbol">*)</span><span class="normal"> </span><span class="function">malloc</span><span class="symbol">(</span><span class="normal">n</span><span class="symbol">*</span><span class="keyword">sizeof</span><span class="symbol">(</span><span class="normal">lcp_t</span><span class="symbol">));</span>
<span class="normal">	</span><span class="type">unsigned</span><span class="normal"> </span><span class="type">char</span><span class="symbol">**</span><span class="normal"> input_tmp </span><span class="symbol">=</span><span class="normal"> </span><span class="symbol">(</span><span class="type">unsigned</span><span class="normal"> </span><span class="type">char</span><span class="symbol">**)</span>
<span class="normal">		</span><span class="function">malloc</span><span class="symbol">(</span><span class="normal">n</span><span class="symbol">*</span><span class="keyword">sizeof</span><span class="symbol">(</span><span class="type">unsigned</span><span class="normal"> </span><span class="type">char</span><span class="symbol">*));</span>
<span class="normal">	</span><span class="keyword">const</span><span class="normal"> </span><span class="usertype">MergeResult</span><span class="normal"> m </span><span class="symbol">=</span><span class="normal"> mergesort_lcp_3way</span><span class="symbol">&lt;</span><span class="keyword">false</span><span class="symbol">&gt;(</span><span class="normal">strings</span><span class="symbol">,</span><span class="normal"> input_tmp</span><span class="symbol">,</span>
<span class="normal">			lcp_input</span><span class="symbol">,</span><span class="normal"> lcp_tmp</span><span class="symbol">,</span><span class="normal"> n</span><span class="symbol">);</span>
<span class="normal">	</span><span class="keyword">if</span><span class="normal"> </span><span class="symbol">(</span><span class="normal">m </span><span class="symbol">==</span><span class="normal"> SortedInTemp</span><span class="symbol">)</span><span class="normal"> </span><span class="cbracket">{</span>
<span class="normal">		</span><span class="symbol">(</span><span class="type">void</span><span class="symbol">)</span><span class="normal"> </span><span class="function">memcpy</span><span class="symbol">(</span><span class="normal">strings</span><span class="symbol">,</span><span class="normal"> input_tmp</span><span class="symbol">,</span><span class="normal"> n</span><span class="symbol">*</span><span class="keyword">sizeof</span><span class="symbol">(</span><span class="type">unsigned</span><span class="normal"> </span><span class="type">char</span><span class="symbol">*));</span>
<span class="normal">	</span><span class="cbracket">}</span>
<span class="normal">	</span><span class="function">free</span><span class="symbol">(</span><span class="normal">lcp_input</span><span class="symbol">);</span>
<span class="normal">	</span><span class="function">free</span><span class="symbol">(</span><span class="normal">lcp_tmp</span><span class="symbol">);</span>
<span class="normal">	</span><span class="function">free</span><span class="symbol">(</span><span class="normal">input_tmp</span><span class="symbol">);</span>
<span class="cbracket">}</span>
<span class="comment">// broken: CONTESTANT_REGISTER(mergesort_lcp_3way,</span>
<span class="comment">//                            "rantala/mergesort_lcp_3way",</span>
<span class="comment">//                            "mergesort LCP with 3way merger")</span>

<span class="keyword">template</span><span class="normal"> </span><span class="symbol">&lt;</span><span class="type">bool</span><span class="normal"> OutputLCP</span><span class="symbol">&gt;</span>
<span class="normal">MergeResult</span>
<span class="function">mergesort_lcp_3way_parallel</span><span class="symbol">(</span><span class="type">unsigned</span><span class="normal"> </span><span class="type">char</span><span class="symbol">**</span><span class="normal"> </span><span class="usertype">restrict</span><span class="normal"> strings_input</span><span class="symbol">,</span>
<span class="normal">                   </span><span class="type">unsigned</span><span class="normal"> </span><span class="type">char</span><span class="symbol">**</span><span class="normal"> </span><span class="usertype">restrict</span><span class="normal"> strings_output</span><span class="symbol">,</span>
<span class="normal">                   lcp_t</span><span class="symbol">*</span><span class="normal"> </span><span class="usertype">restrict</span><span class="normal"> lcp_input</span><span class="symbol">,</span><span class="normal"> lcp_t</span><span class="symbol">*</span><span class="normal"> </span><span class="usertype">restrict</span><span class="normal"> lcp_output</span><span class="symbol">,</span>
<span class="normal">                   </span><span class="usertype">size_t</span><span class="normal"> n</span><span class="symbol">)</span>
<span class="cbracket">{</span>
<span class="normal">	</span><span class="function">debug</span><span class="symbol">()</span><span class="normal"> </span><span class="symbol">&lt;&lt;</span><span class="normal"> __func__ </span><span class="symbol">&lt;&lt;</span><span class="normal"> </span><span class="string">"(): n="</span><span class="normal"> </span><span class="symbol">&lt;&lt;</span><span class="normal"> n </span><span class="symbol">&lt;&lt;</span><span class="normal"> </span><span class="string">'</span><span class="specialchar">\n</span><span class="string">'</span><span class="symbol">;</span>
<span class="normal">	</span><span class="keyword">if</span><span class="normal"> </span><span class="symbol">(</span><span class="normal">n </span><span class="symbol">&lt;</span><span class="normal"> </span><span class="number">32</span><span class="symbol">)</span><span class="normal"> </span><span class="cbracket">{</span>
<span class="normal">		</span><span class="function">insertion_sort</span><span class="symbol">(</span><span class="normal">strings_input</span><span class="symbol">,</span><span class="normal"> n</span><span class="symbol">,</span><span class="normal"> </span><span class="number">0</span><span class="symbol">);</span>
<span class="normal">		</span><span class="keyword">for</span><span class="normal"> </span><span class="symbol">(</span><span class="type">unsigned</span><span class="normal"> i</span><span class="symbol">=</span><span class="number">0</span><span class="symbol">;</span><span class="normal"> i </span><span class="symbol">&lt;</span><span class="normal"> n</span><span class="symbol">-</span><span class="number">1</span><span class="symbol">;</span><span class="normal"> </span><span class="symbol">++</span><span class="normal">i</span><span class="symbol">)</span>
<span class="normal">			lcp_input</span><span class="symbol">[</span><span class="normal">i</span><span class="symbol">]</span><span class="normal"> </span><span class="symbol">=</span><span class="normal"> </span><span class="function">lcp</span><span class="symbol">(</span><span class="normal">strings_input</span><span class="symbol">[</span><span class="normal">i</span><span class="symbol">],</span><span class="normal"> strings_input</span><span class="symbol">[</span><span class="normal">i</span><span class="symbol">+</span><span class="number">1</span><span class="symbol">]);</span>
<span class="normal">		</span><span class="keyword">return</span><span class="normal"> SortedInPlace</span><span class="symbol">;</span>
<span class="normal">	</span><span class="cbracket">}</span>
<span class="normal">	</span><span class="keyword">const</span><span class="normal"> </span><span class="usertype">size_t</span><span class="normal"> split0 </span><span class="symbol">=</span><span class="normal"> n</span><span class="symbol">/</span><span class="number">3</span><span class="symbol">,</span>
<span class="normal">	             split1 </span><span class="symbol">=</span><span class="normal"> </span><span class="function">size_t</span><span class="symbol">((</span><span class="number">2.0</span><span class="symbol">/</span><span class="number">3.0</span><span class="symbol">)*</span><span class="normal">n</span><span class="symbol">);</span>
<span class="normal">	</span><span class="usertype">MergeResult</span><span class="normal"> m0</span><span class="symbol">,</span><span class="normal"> m1</span><span class="symbol">,</span><span class="normal"> m2</span><span class="symbol">;</span>
<span class="preproc">#pragma</span><span class="normal"> omp parallel sections</span>
<span class="normal">	</span><span class="cbracket">{</span>
<span class="preproc">#pragma</span><span class="normal"> omp section</span>
<span class="normal">	m0 </span><span class="symbol">=</span><span class="normal"> mergesort_lcp_3way_parallel</span><span class="symbol">&lt;</span><span class="keyword">true</span><span class="symbol">&gt;(</span>
<span class="normal">			strings_input</span><span class="symbol">,</span><span class="normal">        strings_output</span><span class="symbol">,</span>
<span class="normal">			lcp_input</span><span class="symbol">,</span><span class="normal">            lcp_output</span><span class="symbol">,</span>
<span class="normal">			split0</span><span class="symbol">);</span>
<span class="preproc">#pragma</span><span class="normal"> omp section</span>
<span class="normal">	m1 </span><span class="symbol">=</span><span class="normal"> mergesort_lcp_3way_parallel</span><span class="symbol">&lt;</span><span class="keyword">true</span><span class="symbol">&gt;(</span>
<span class="normal">			strings_input</span><span class="symbol">+</span><span class="normal">split0</span><span class="symbol">,</span><span class="normal"> strings_output</span><span class="symbol">+</span><span class="normal">split0</span><span class="symbol">,</span>
<span class="normal">			lcp_input</span><span class="symbol">+</span><span class="normal">split0</span><span class="symbol">,</span><span class="normal">     lcp_output</span><span class="symbol">+</span><span class="normal">split0</span><span class="symbol">,</span>
<span class="normal">			split1</span><span class="symbol">-</span><span class="normal">split0</span><span class="symbol">);</span>
<span class="preproc">#pragma</span><span class="normal"> omp section</span>
<span class="normal">	m2 </span><span class="symbol">=</span><span class="normal"> mergesort_lcp_3way_parallel</span><span class="symbol">&lt;</span><span class="keyword">true</span><span class="symbol">&gt;(</span>
<span class="normal">			strings_input</span><span class="symbol">+</span><span class="normal">split1</span><span class="symbol">,</span><span class="normal"> strings_output</span><span class="symbol">+</span><span class="normal">split1</span><span class="symbol">,</span>
<span class="normal">			lcp_input</span><span class="symbol">+</span><span class="normal">split1</span><span class="symbol">,</span><span class="normal">     lcp_output</span><span class="symbol">+</span><span class="normal">split1</span><span class="symbol">,</span>
<span class="normal">			n</span><span class="symbol">-</span><span class="normal">split1</span><span class="symbol">);</span>
<span class="normal">	</span><span class="cbracket">}</span>
<span class="normal">	</span><span class="function">debug</span><span class="symbol">()</span><span class="normal"> </span><span class="symbol">&lt;&lt;</span><span class="normal"> __func__ </span><span class="symbol">&lt;&lt;</span><span class="normal"> </span><span class="string">"(): m0="</span><span class="symbol">&lt;&lt;</span><span class="normal">m0</span><span class="symbol">&lt;&lt;</span><span class="string">", m1="</span><span class="symbol">&lt;&lt;</span><span class="normal">m1</span><span class="symbol">&lt;&lt;</span><span class="string">", m2="</span><span class="symbol">&lt;&lt;</span><span class="normal">m2</span><span class="symbol">&lt;&lt;</span><span class="string">"</span><span class="specialchar">\n</span><span class="string">"</span><span class="symbol">;</span>
<span class="normal">	</span><span class="keyword">if</span><span class="normal"> </span><span class="symbol">(</span><span class="normal">m0 </span><span class="symbol">!=</span><span class="normal"> m1</span><span class="symbol">)</span><span class="normal"> </span><span class="cbracket">{</span>
<span class="normal">		</span><span class="keyword">if</span><span class="normal"> </span><span class="symbol">(</span><span class="normal">m1 </span><span class="symbol">!=</span><span class="normal"> m2</span><span class="symbol">)</span><span class="normal"> </span><span class="cbracket">{</span>
<span class="normal">			</span><span class="comment">// m0 == m2 != m1</span>
<span class="normal">			</span><span class="keyword">if</span><span class="normal"> </span><span class="symbol">(</span><span class="normal">m1 </span><span class="symbol">==</span><span class="normal"> SortedInPlace</span><span class="symbol">)</span><span class="normal"> </span><span class="cbracket">{</span>
<span class="normal">				std</span><span class="symbol">::</span><span class="function">copy</span><span class="symbol">(</span><span class="normal">strings_input</span><span class="symbol">+</span><span class="normal">split0</span><span class="symbol">,</span><span class="normal"> strings_input</span><span class="symbol">+</span><span class="normal">split1</span><span class="symbol">,</span>
<span class="normal">						strings_output</span><span class="symbol">+</span><span class="normal">split0</span><span class="symbol">);</span>
<span class="normal">				std</span><span class="symbol">::</span><span class="function">copy</span><span class="symbol">(</span><span class="normal">lcp_input</span><span class="symbol">+</span><span class="normal">split0</span><span class="symbol">,</span><span class="normal"> lcp_input</span><span class="symbol">+</span><span class="normal">split1</span><span class="symbol">,</span>
<span class="normal">						lcp_output</span><span class="symbol">+</span><span class="normal">split0</span><span class="symbol">);</span>
<span class="normal">				m1 </span><span class="symbol">=</span><span class="normal"> SortedInTemp</span><span class="symbol">;</span>
<span class="normal">			</span><span class="cbracket">}</span><span class="normal"> </span><span class="keyword">else</span><span class="normal"> </span><span class="cbracket">{</span>
<span class="normal">				std</span><span class="symbol">::</span><span class="function">copy</span><span class="symbol">(</span><span class="normal">strings_output</span><span class="symbol">+</span><span class="normal">split0</span><span class="symbol">,</span><span class="normal"> strings_output</span><span class="symbol">+</span><span class="normal">split1</span><span class="symbol">,</span>
<span class="normal">						strings_input</span><span class="symbol">+</span><span class="normal">split0</span><span class="symbol">);</span>
<span class="normal">				std</span><span class="symbol">::</span><span class="function">copy</span><span class="symbol">(</span><span class="normal">lcp_output</span><span class="symbol">+</span><span class="normal">split0</span><span class="symbol">,</span><span class="normal"> lcp_output</span><span class="symbol">+</span><span class="normal">split1</span><span class="symbol">,</span>
<span class="normal">						lcp_input</span><span class="symbol">+</span><span class="normal">split0</span><span class="symbol">);</span>
<span class="normal">				m1 </span><span class="symbol">=</span><span class="normal"> SortedInPlace</span><span class="symbol">;</span>
<span class="normal">			</span><span class="cbracket">}</span>
<span class="normal">		</span><span class="cbracket">}</span><span class="normal"> </span><span class="keyword">else</span><span class="normal"> </span><span class="cbracket">{</span>
<span class="normal">			</span><span class="comment">// m0 != m1 == m2</span>
<span class="normal">			</span><span class="keyword">if</span><span class="normal"> </span><span class="symbol">(</span><span class="normal">m0 </span><span class="symbol">==</span><span class="normal"> SortedInPlace</span><span class="symbol">)</span><span class="normal"> </span><span class="cbracket">{</span>
<span class="normal">				std</span><span class="symbol">::</span><span class="function">copy</span><span class="symbol">(</span><span class="normal">strings_input</span><span class="symbol">,</span><span class="normal"> strings_input</span><span class="symbol">+</span><span class="normal">split0</span><span class="symbol">,</span>
<span class="normal">						strings_output</span><span class="symbol">);</span>
<span class="normal">				std</span><span class="symbol">::</span><span class="function">copy</span><span class="symbol">(</span><span class="normal">lcp_input</span><span class="symbol">,</span><span class="normal"> lcp_input</span><span class="symbol">+</span><span class="normal">split0</span><span class="symbol">,</span>
<span class="normal">						lcp_output</span><span class="symbol">);</span>
<span class="normal">				m0 </span><span class="symbol">=</span><span class="normal"> SortedInTemp</span><span class="symbol">;</span>
<span class="normal">			</span><span class="cbracket">}</span><span class="normal"> </span><span class="keyword">else</span><span class="normal"> </span><span class="cbracket">{</span>
<span class="normal">				std</span><span class="symbol">::</span><span class="function">copy</span><span class="symbol">(</span><span class="normal">strings_output</span><span class="symbol">,</span><span class="normal"> strings_output</span><span class="symbol">+</span><span class="normal">split0</span><span class="symbol">,</span>
<span class="normal">						strings_input</span><span class="symbol">);</span>
<span class="normal">				std</span><span class="symbol">::</span><span class="function">copy</span><span class="symbol">(</span><span class="normal">lcp_output</span><span class="symbol">,</span><span class="normal"> lcp_output</span><span class="symbol">+</span><span class="normal">split0</span><span class="symbol">,</span>
<span class="normal">						lcp_input</span><span class="symbol">);</span>
<span class="normal">				m0 </span><span class="symbol">=</span><span class="normal"> SortedInPlace</span><span class="symbol">;</span>
<span class="normal">			</span><span class="cbracket">}</span>
<span class="normal">		</span><span class="cbracket">}</span>
<span class="normal">	</span><span class="cbracket">}</span>
<span class="normal">	</span><span class="keyword">if</span><span class="normal"> </span><span class="symbol">(</span><span class="normal">m1 </span><span class="symbol">!=</span><span class="normal"> m2</span><span class="symbol">)</span><span class="normal"> </span><span class="cbracket">{</span>
<span class="normal">		</span><span class="keyword">if</span><span class="normal"> </span><span class="symbol">(</span><span class="normal">m2 </span><span class="symbol">==</span><span class="normal"> SortedInPlace</span><span class="symbol">)</span><span class="normal"> </span><span class="cbracket">{</span>
<span class="normal">			std</span><span class="symbol">::</span><span class="function">copy</span><span class="symbol">(</span><span class="normal">strings_input</span><span class="symbol">+</span><span class="normal">split1</span><span class="symbol">,</span><span class="normal"> strings_input</span><span class="symbol">+</span><span class="normal">n</span><span class="symbol">,</span>
<span class="normal">					strings_output</span><span class="symbol">+</span><span class="normal">split1</span><span class="symbol">);</span>
<span class="normal">			std</span><span class="symbol">::</span><span class="function">copy</span><span class="symbol">(</span><span class="normal">lcp_input</span><span class="symbol">+</span><span class="normal">split1</span><span class="symbol">,</span><span class="normal"> lcp_input</span><span class="symbol">+</span><span class="normal">n</span><span class="symbol">,</span>
<span class="normal">					lcp_output</span><span class="symbol">+</span><span class="normal">split1</span><span class="symbol">);</span>
<span class="normal">			m2 </span><span class="symbol">=</span><span class="normal"> SortedInTemp</span><span class="symbol">;</span>
<span class="normal">		</span><span class="cbracket">}</span><span class="normal"> </span><span class="keyword">else</span><span class="normal"> </span><span class="cbracket">{</span>
<span class="normal">			std</span><span class="symbol">::</span><span class="function">copy</span><span class="symbol">(</span><span class="normal">strings_output</span><span class="symbol">+</span><span class="normal">split1</span><span class="symbol">,</span><span class="normal"> strings_output</span><span class="symbol">+</span><span class="normal">n</span><span class="symbol">,</span>
<span class="normal">					strings_input</span><span class="symbol">+</span><span class="normal">split1</span><span class="symbol">);</span>
<span class="normal">			std</span><span class="symbol">::</span><span class="function">copy</span><span class="symbol">(</span><span class="normal">lcp_output</span><span class="symbol">+</span><span class="normal">split1</span><span class="symbol">,</span><span class="normal"> lcp_output</span><span class="symbol">+</span><span class="normal">n</span><span class="symbol">,</span>
<span class="normal">					lcp_input</span><span class="symbol">+</span><span class="normal">split1</span><span class="symbol">);</span>
<span class="normal">			m2 </span><span class="symbol">=</span><span class="normal"> SortedInPlace</span><span class="symbol">;</span>
<span class="normal">		</span><span class="cbracket">}</span>
<span class="normal">	</span><span class="cbracket">}</span>
<span class="normal">	</span><span class="function">assert</span><span class="symbol">(</span><span class="normal">m0 </span><span class="symbol">==</span><span class="normal"> m1</span><span class="symbol">);</span><span class="normal"> </span><span class="function">assert</span><span class="symbol">(</span><span class="normal">m1 </span><span class="symbol">==</span><span class="normal"> m2</span><span class="symbol">);</span>
<span class="normal">	</span><span class="keyword">if</span><span class="normal"> </span><span class="symbol">(</span><span class="normal">m0 </span><span class="symbol">==</span><span class="normal"> SortedInPlace</span><span class="symbol">)</span><span class="normal"> </span><span class="cbracket">{</span>
<span class="normal">		merge_lcp_3way</span><span class="symbol">&lt;</span><span class="normal">OutputLCP</span><span class="symbol">&gt;(</span>
<span class="normal">			   strings_input</span><span class="symbol">,</span><span class="normal">        lcp_input</span><span class="symbol">,</span><span class="normal">        split0</span><span class="symbol">,</span>
<span class="normal">			   strings_input</span><span class="symbol">+</span><span class="normal">split0</span><span class="symbol">,</span><span class="normal"> lcp_input</span><span class="symbol">+</span><span class="normal">split0</span><span class="symbol">,</span><span class="normal"> split1</span><span class="symbol">-</span><span class="normal">split0</span><span class="symbol">,</span>
<span class="normal">			   strings_input</span><span class="symbol">+</span><span class="normal">split1</span><span class="symbol">,</span><span class="normal"> lcp_input</span><span class="symbol">+</span><span class="normal">split1</span><span class="symbol">,</span><span class="normal"> n</span><span class="symbol">-</span><span class="normal">split1</span><span class="symbol">,</span>
<span class="normal">			   strings_output</span><span class="symbol">,</span><span class="normal"> lcp_output</span><span class="symbol">);</span>
<span class="normal">		</span><span class="comment">//debug() &lt;&lt; __func__ &lt;&lt; "(): checking merged result, in -&gt; out\n";</span>
<span class="normal">		</span><span class="keyword">if</span><span class="normal"> </span><span class="symbol">(</span><span class="normal">OutputLCP</span><span class="symbol">)</span><span class="normal"> </span><span class="function">check_input</span><span class="symbol">(</span><span class="normal">strings_output</span><span class="symbol">,</span><span class="normal"> lcp_output</span><span class="symbol">,</span><span class="normal"> n</span><span class="symbol">);</span>
<span class="normal">		</span><span class="keyword">return</span><span class="normal"> SortedInTemp</span><span class="symbol">;</span>
<span class="normal">	</span><span class="cbracket">}</span><span class="normal"> </span><span class="keyword">else</span><span class="normal"> </span><span class="cbracket">{</span>
<span class="normal">		merge_lcp_3way</span><span class="symbol">&lt;</span><span class="normal">OutputLCP</span><span class="symbol">&gt;(</span>
<span class="normal">			   strings_output</span><span class="symbol">,</span><span class="normal">        lcp_output</span><span class="symbol">,</span><span class="normal">        split0</span><span class="symbol">,</span>
<span class="normal">			   strings_output</span><span class="symbol">+</span><span class="normal">split0</span><span class="symbol">,</span><span class="normal"> lcp_output</span><span class="symbol">+</span><span class="normal">split0</span><span class="symbol">,</span><span class="normal"> split1</span><span class="symbol">-</span><span class="normal">split0</span><span class="symbol">,</span>
<span class="normal">			   strings_output</span><span class="symbol">+</span><span class="normal">split1</span><span class="symbol">,</span><span class="normal"> lcp_output</span><span class="symbol">+</span><span class="normal">split1</span><span class="symbol">,</span><span class="normal"> n</span><span class="symbol">-</span><span class="normal">split1</span><span class="symbol">,</span>
<span class="normal">			   strings_input</span><span class="symbol">,</span><span class="normal"> lcp_input</span><span class="symbol">);</span>
<span class="normal">		</span><span class="comment">//debug() &lt;&lt; __func__ &lt;&lt; "(): checking merged result, out -&gt; in\n";</span>
<span class="normal">		</span><span class="keyword">if</span><span class="normal"> </span><span class="symbol">(</span><span class="normal">OutputLCP</span><span class="symbol">)</span><span class="normal"> </span><span class="function">check_input</span><span class="symbol">(</span><span class="normal">strings_input</span><span class="symbol">,</span><span class="normal"> lcp_input</span><span class="symbol">,</span><span class="normal"> n</span><span class="symbol">);</span>
<span class="normal">		</span><span class="keyword">return</span><span class="normal"> SortedInPlace</span><span class="symbol">;</span>
<span class="normal">	</span><span class="cbracket">}</span>
<span class="cbracket">}</span>
<span class="type">void</span>
<span class="function">mergesort_lcp_3way_parallel</span><span class="symbol">(</span><span class="type">unsigned</span><span class="normal"> </span><span class="type">char</span><span class="symbol">**</span><span class="normal"> strings</span><span class="symbol">,</span><span class="normal"> </span><span class="usertype">size_t</span><span class="normal"> n</span><span class="symbol">)</span>
<span class="cbracket">{</span>
<span class="normal">	</span><span class="function">debug</span><span class="symbol">()</span><span class="normal"> </span><span class="symbol">&lt;&lt;</span><span class="normal"> __func__ </span><span class="symbol">&lt;&lt;</span><span class="normal"> </span><span class="string">'</span><span class="specialchar">\n</span><span class="string">'</span><span class="symbol">;</span>
<span class="normal">	lcp_t</span><span class="symbol">*</span><span class="normal"> lcp_input </span><span class="symbol">=</span><span class="normal"> </span><span class="symbol">(</span><span class="normal">lcp_t</span><span class="symbol">*)</span><span class="normal"> </span><span class="function">malloc</span><span class="symbol">(</span><span class="normal">n</span><span class="symbol">*</span><span class="keyword">sizeof</span><span class="symbol">(</span><span class="normal">lcp_t</span><span class="symbol">));</span>
<span class="normal">	lcp_t</span><span class="symbol">*</span><span class="normal"> lcp_tmp   </span><span class="symbol">=</span><span class="normal"> </span><span class="symbol">(</span><span class="normal">lcp_t</span><span class="symbol">*)</span><span class="normal"> </span><span class="function">malloc</span><span class="symbol">(</span><span class="normal">n</span><span class="symbol">*</span><span class="keyword">sizeof</span><span class="symbol">(</span><span class="normal">lcp_t</span><span class="symbol">));</span>
<span class="normal">	</span><span class="type">unsigned</span><span class="normal"> </span><span class="type">char</span><span class="symbol">**</span><span class="normal"> input_tmp </span><span class="symbol">=</span><span class="normal"> </span><span class="symbol">(</span><span class="type">unsigned</span><span class="normal"> </span><span class="type">char</span><span class="symbol">**)</span>
<span class="normal">		</span><span class="function">malloc</span><span class="symbol">(</span><span class="normal">n</span><span class="symbol">*</span><span class="keyword">sizeof</span><span class="symbol">(</span><span class="type">unsigned</span><span class="normal"> </span><span class="type">char</span><span class="symbol">*));</span>
<span class="normal">	</span><span class="keyword">const</span><span class="normal"> </span><span class="usertype">MergeResult</span><span class="normal"> m </span><span class="symbol">=</span><span class="normal"> mergesort_lcp_3way_parallel</span><span class="symbol">&lt;</span><span class="keyword">false</span><span class="symbol">&gt;(</span><span class="normal">strings</span><span class="symbol">,</span><span class="normal"> input_tmp</span><span class="symbol">,</span>
<span class="normal">			lcp_input</span><span class="symbol">,</span><span class="normal"> lcp_tmp</span><span class="symbol">,</span><span class="normal"> n</span><span class="symbol">);</span>
<span class="normal">	</span><span class="keyword">if</span><span class="normal"> </span><span class="symbol">(</span><span class="normal">m </span><span class="symbol">==</span><span class="normal"> SortedInTemp</span><span class="symbol">)</span><span class="normal"> </span><span class="cbracket">{</span>
<span class="normal">		</span><span class="symbol">(</span><span class="type">void</span><span class="symbol">)</span><span class="normal"> </span><span class="function">memcpy</span><span class="symbol">(</span><span class="normal">strings</span><span class="symbol">,</span><span class="normal"> input_tmp</span><span class="symbol">,</span><span class="normal"> n</span><span class="symbol">*</span><span class="keyword">sizeof</span><span class="symbol">(</span><span class="type">unsigned</span><span class="normal"> </span><span class="type">char</span><span class="symbol">*));</span>
<span class="normal">	</span><span class="cbracket">}</span>
<span class="normal">	</span><span class="function">free</span><span class="symbol">(</span><span class="normal">lcp_input</span><span class="symbol">);</span>
<span class="normal">	</span><span class="function">free</span><span class="symbol">(</span><span class="normal">lcp_tmp</span><span class="symbol">);</span>
<span class="normal">	</span><span class="function">free</span><span class="symbol">(</span><span class="normal">input_tmp</span><span class="symbol">);</span>
<span class="cbracket">}</span>
<span class="comment">// broken: CONTESTANT_REGISTER_PARALLEL(mergesort_lcp_3way_parallel,</span>
<span class="comment">//                                     "rantala/mergesort_lcp_3way_parallel",</span>
<span class="comment">//                                     "mergesort_parallel LCP with 3way merger")</span>

<span class="comment">/*******************************************************************************</span>
<span class="comment"> *</span>
<span class="comment"> * mergesort_cache_lcp_2way</span>
<span class="comment"> *</span>
<span class="comment"> ******************************************************************************/</span>

<span class="preproc">#if</span><span class="normal"> </span><span class="number">0</span>
<span class="keyword">static</span><span class="normal"> </span><span class="type">int</span><span class="normal"> STAT_try_cache</span><span class="symbol">=</span><span class="number">0</span><span class="symbol">;</span>
<span class="keyword">static</span><span class="normal"> </span><span class="type">int</span><span class="normal"> STAT_cache_useless</span><span class="symbol">=</span><span class="number">0</span><span class="symbol">;</span>
<span class="keyword">static</span><span class="normal"> </span><span class="keyword">inline</span><span class="normal"> </span><span class="type">void</span><span class="normal"> </span><span class="function">stat_try_cache</span><span class="symbol">()</span><span class="normal">     </span><span class="cbracket">{</span><span class="normal"> </span><span class="symbol">++</span><span class="normal">STAT_try_cache</span><span class="symbol">;</span><span class="normal">     </span><span class="cbracket">}</span>
<span class="keyword">static</span><span class="normal"> </span><span class="keyword">inline</span><span class="normal"> </span><span class="type">void</span><span class="normal"> </span><span class="function">stat_cache_useless</span><span class="symbol">()</span><span class="normal"> </span><span class="cbracket">{</span><span class="normal"> </span><span class="symbol">++</span><span class="normal">STAT_cache_useless</span><span class="symbol">;</span><span class="normal"> </span><span class="cbracket">}</span>
<span class="keyword">static</span><span class="normal"> </span><span class="keyword">inline</span><span class="normal"> </span><span class="type">void</span><span class="normal"> </span><span class="function">stat_print</span><span class="symbol">()</span>
<span class="cbracket">{</span>
<span class="normal">	std</span><span class="symbol">::</span><span class="normal">cout </span><span class="symbol">&lt;&lt;</span><span class="normal"> </span><span class="string">"[Cache useful: "</span>
<span class="normal">	          </span><span class="symbol">&lt;&lt;</span><span class="normal"> </span><span class="type">int</span><span class="symbol">(</span><span class="number">100</span><span class="symbol">*</span><span class="type">double</span><span class="symbol">(</span><span class="normal">STAT_try_cache</span><span class="symbol">-</span><span class="normal">STAT_cache_useless</span><span class="symbol">)</span>
<span class="normal">	                             </span><span class="symbol">/</span><span class="type">double</span><span class="symbol">(</span><span class="normal">STAT_try_cache</span><span class="symbol">))</span>
<span class="normal">	          </span><span class="symbol">&lt;&lt;</span><span class="normal"> </span><span class="string">"%, "</span><span class="normal"> </span><span class="symbol">&lt;&lt;</span><span class="normal"> STAT_try_cache</span>
<span class="normal">	          </span><span class="symbol">&lt;&lt;</span><span class="normal"> </span><span class="string">"/"</span><span class="normal"> </span><span class="symbol">&lt;&lt;</span><span class="normal"> STAT_try_cache</span><span class="symbol">-</span><span class="normal">STAT_cache_useless</span>
<span class="normal">	          </span><span class="symbol">&lt;&lt;</span><span class="normal"> </span><span class="string">"/"</span><span class="normal"> </span><span class="symbol">&lt;&lt;</span><span class="normal"> STAT_cache_useless </span><span class="symbol">&lt;&lt;</span><span class="normal"> </span><span class="string">"]</span><span class="specialchar">\n</span><span class="string">"</span><span class="symbol">;</span>
<span class="cbracket">}</span>
<span class="preproc">#else</span>
<span class="keyword">static</span><span class="normal"> </span><span class="keyword">inline</span><span class="normal"> </span><span class="type">void</span><span class="normal"> </span><span class="function">stat_try_cache</span><span class="symbol">()</span><span class="normal">     </span><span class="cbracket">{}</span>
<span class="keyword">static</span><span class="normal"> </span><span class="keyword">inline</span><span class="normal"> </span><span class="type">void</span><span class="normal"> </span><span class="function">stat_cache_useless</span><span class="symbol">()</span><span class="normal"> </span><span class="cbracket">{}</span>
<span class="keyword">static</span><span class="normal"> </span><span class="keyword">inline</span><span class="normal"> </span><span class="type">void</span><span class="normal"> </span><span class="function">stat_print</span><span class="symbol">()</span><span class="normal">         </span><span class="cbracket">{}</span>
<span class="preproc">#endif</span>

<span class="keyword">static</span><span class="normal"> std</span><span class="symbol">::</span><span class="usertype">string</span><span class="normal"> </span><span class="function">to_str</span><span class="symbol">(</span><span class="type">unsigned</span><span class="normal"> </span><span class="type">char</span><span class="normal"> c</span><span class="symbol">)</span>
<span class="cbracket">{</span>
<span class="normal">	std</span><span class="symbol">::</span><span class="usertype">ostringstream</span><span class="normal"> strm</span><span class="symbol">;</span>
<span class="normal">	</span><span class="keyword">if</span><span class="normal"> </span><span class="symbol">(</span><span class="function">isprint</span><span class="symbol">(</span><span class="normal">c</span><span class="symbol">))</span><span class="normal"> strm </span><span class="symbol">&lt;&lt;</span><span class="normal"> c</span><span class="symbol">;</span>
<span class="normal">	</span><span class="keyword">else</span><span class="normal">            strm </span><span class="symbol">&lt;&lt;</span><span class="normal"> </span><span class="string">'&lt;'</span><span class="normal"> </span><span class="symbol">&lt;&lt;</span><span class="normal"> </span><span class="type">int</span><span class="symbol">(</span><span class="normal">c</span><span class="symbol">)</span><span class="normal"> </span><span class="symbol">&lt;&lt;</span><span class="normal"> </span><span class="string">'&gt;'</span><span class="symbol">;</span>
<span class="normal">	</span><span class="keyword">return</span><span class="normal"> strm</span><span class="symbol">.</span><span class="function">str</span><span class="symbol">();</span>
<span class="cbracket">}</span>
<span class="keyword">static</span><span class="normal"> std</span><span class="symbol">::</span><span class="usertype">string</span><span class="normal"> </span><span class="function">to_str</span><span class="symbol">(</span><span class="usertype">uint16_t</span><span class="normal"> c</span><span class="symbol">)</span>
<span class="cbracket">{</span><span class="normal"> </span><span class="keyword">return</span><span class="normal"> </span><span class="function">to_str</span><span class="symbol">(</span><span class="function">uint8_t</span><span class="symbol">((</span><span class="number">0xFF00</span><span class="normal"> </span><span class="symbol">&amp;</span><span class="normal"> c</span><span class="symbol">)</span><span class="normal"> </span><span class="symbol">&gt;&gt;</span><span class="normal"> </span><span class="number">8</span><span class="symbol">))</span><span class="normal"> </span><span class="symbol">+</span><span class="normal"> </span><span class="function">to_str</span><span class="symbol">(</span><span class="function">uint8_t</span><span class="symbol">(</span><span class="normal">c</span><span class="symbol">));</span><span class="normal"> </span><span class="cbracket">}</span>
<span class="keyword">static</span><span class="normal"> std</span><span class="symbol">::</span><span class="usertype">string</span><span class="normal"> </span><span class="function">to_str</span><span class="symbol">(</span><span class="usertype">uint32_t</span><span class="normal"> c</span><span class="symbol">)</span>
<span class="cbracket">{</span><span class="normal"> </span><span class="keyword">return</span><span class="normal"> </span><span class="function">to_str</span><span class="symbol">(</span><span class="function">uint16_t</span><span class="symbol">((</span><span class="number">0xFFFF0000</span><span class="normal"> </span><span class="symbol">&amp;</span><span class="normal"> c</span><span class="symbol">)</span><span class="normal"> </span><span class="symbol">&gt;&gt;</span><span class="normal"> </span><span class="number">16</span><span class="symbol">))</span><span class="normal"> </span><span class="symbol">+</span><span class="normal"> </span><span class="function">to_str</span><span class="symbol">(</span><span class="function">uint16_t</span><span class="symbol">(</span><span class="normal">c</span><span class="symbol">));</span><span class="normal"> </span><span class="cbracket">}</span>

<span class="comment">// Calculates the LCP between two string caches.</span>
<span class="keyword">static</span><span class="normal"> </span><span class="keyword">inline</span><span class="normal"> </span><span class="type">unsigned</span><span class="normal"> </span><span class="function">lcp</span><span class="symbol">(</span><span class="type">unsigned</span><span class="normal"> </span><span class="type">char</span><span class="normal"> a</span><span class="symbol">,</span><span class="normal"> </span><span class="type">unsigned</span><span class="normal"> </span><span class="type">char</span><span class="normal"> b</span><span class="symbol">)</span>
<span class="cbracket">{</span>
<span class="normal">	</span><span class="function">assert</span><span class="symbol">(</span><span class="number">0</span><span class="symbol">);</span>
<span class="normal">	</span><span class="symbol">(</span><span class="type">void</span><span class="symbol">)</span><span class="normal"> a</span><span class="symbol">;</span>
<span class="normal">	</span><span class="symbol">(</span><span class="type">void</span><span class="symbol">)</span><span class="normal"> b</span><span class="symbol">;</span>
<span class="normal">	</span><span class="keyword">return</span><span class="normal"> </span><span class="number">0</span><span class="symbol">;</span>
<span class="cbracket">}</span>
<span class="keyword">static</span><span class="normal"> </span><span class="keyword">inline</span><span class="normal"> </span><span class="type">unsigned</span><span class="normal"> </span><span class="function">lcp</span><span class="symbol">(</span><span class="usertype">uint16_t</span><span class="normal"> a</span><span class="symbol">,</span><span class="normal"> </span><span class="usertype">uint16_t</span><span class="normal"> b</span><span class="symbol">)</span>
<span class="cbracket">{</span>
<span class="normal">	</span><span class="function">assert</span><span class="symbol">(</span><span class="normal">a </span><span class="symbol">!=</span><span class="normal"> b </span><span class="usertype">or</span><span class="normal"> a</span><span class="symbol">==</span><span class="number">0</span><span class="symbol">);</span>
<span class="normal">	</span><span class="type">unsigned</span><span class="normal"> A</span><span class="symbol">,</span><span class="normal"> B</span><span class="symbol">;</span>
<span class="normal">	A </span><span class="symbol">=</span><span class="normal"> </span><span class="number">0xFF00</span><span class="normal"> </span><span class="symbol">&amp;</span><span class="normal"> a</span><span class="symbol">;</span>
<span class="normal">	B </span><span class="symbol">=</span><span class="normal"> </span><span class="number">0xFF00</span><span class="normal"> </span><span class="symbol">&amp;</span><span class="normal"> b</span><span class="symbol">;</span>
<span class="normal">	</span><span class="keyword">if</span><span class="normal"> </span><span class="symbol">(</span><span class="normal">A</span><span class="symbol">==</span><span class="number">0</span><span class="normal"> </span><span class="usertype">or</span><span class="normal"> A</span><span class="symbol">!=</span><span class="normal">B</span><span class="symbol">)</span><span class="normal"> </span><span class="keyword">return</span><span class="normal"> </span><span class="number">0</span><span class="symbol">;</span>
<span class="normal">	</span><span class="keyword">return</span><span class="normal"> </span><span class="number">1</span><span class="symbol">;</span>
<span class="cbracket">}</span>
<span class="keyword">static</span><span class="normal"> </span><span class="keyword">inline</span><span class="normal"> </span><span class="type">unsigned</span><span class="normal"> </span><span class="function">lcp</span><span class="symbol">(</span><span class="usertype">uint32_t</span><span class="normal"> a</span><span class="symbol">,</span><span class="normal"> </span><span class="usertype">uint32_t</span><span class="normal"> b</span><span class="symbol">)</span>
<span class="cbracket">{</span>
<span class="normal">	</span><span class="function">assert</span><span class="symbol">(</span><span class="normal">a </span><span class="symbol">!=</span><span class="normal"> b </span><span class="usertype">or</span><span class="normal"> a</span><span class="symbol">==</span><span class="number">0</span><span class="symbol">);</span>
<span class="normal">	</span><span class="type">unsigned</span><span class="normal"> A</span><span class="symbol">,</span><span class="normal"> B</span><span class="symbol">;</span>
<span class="normal">	A </span><span class="symbol">=</span><span class="normal"> </span><span class="number">0xFF000000</span><span class="normal"> </span><span class="symbol">&amp;</span><span class="normal"> a</span><span class="symbol">;</span>
<span class="normal">	B </span><span class="symbol">=</span><span class="normal"> </span><span class="number">0xFF000000</span><span class="normal"> </span><span class="symbol">&amp;</span><span class="normal"> b</span><span class="symbol">;</span>
<span class="normal">	</span><span class="keyword">if</span><span class="normal"> </span><span class="symbol">(</span><span class="normal">A</span><span class="symbol">==</span><span class="number">0</span><span class="normal"> </span><span class="usertype">or</span><span class="normal"> A</span><span class="symbol">!=</span><span class="normal">B</span><span class="symbol">)</span><span class="normal"> </span><span class="keyword">return</span><span class="normal"> </span><span class="number">0</span><span class="symbol">;</span>
<span class="normal">	A </span><span class="symbol">=</span><span class="normal"> </span><span class="number">0x00FF0000</span><span class="normal"> </span><span class="symbol">&amp;</span><span class="normal"> a</span><span class="symbol">;</span>
<span class="normal">	B </span><span class="symbol">=</span><span class="normal"> </span><span class="number">0x00FF0000</span><span class="normal"> </span><span class="symbol">&amp;</span><span class="normal"> b</span><span class="symbol">;</span>
<span class="normal">	</span><span class="keyword">if</span><span class="normal"> </span><span class="symbol">(</span><span class="normal">A</span><span class="symbol">==</span><span class="number">0</span><span class="normal"> </span><span class="usertype">or</span><span class="normal"> A</span><span class="symbol">!=</span><span class="normal">B</span><span class="symbol">)</span><span class="normal"> </span><span class="keyword">return</span><span class="normal"> </span><span class="number">1</span><span class="symbol">;</span>
<span class="normal">	A </span><span class="symbol">=</span><span class="normal"> </span><span class="number">0x0000FF00</span><span class="normal"> </span><span class="symbol">&amp;</span><span class="normal"> a</span><span class="symbol">;</span>
<span class="normal">	B </span><span class="symbol">=</span><span class="normal"> </span><span class="number">0x0000FF00</span><span class="normal"> </span><span class="symbol">&amp;</span><span class="normal"> b</span><span class="symbol">;</span>
<span class="normal">	</span><span class="keyword">if</span><span class="normal"> </span><span class="symbol">(</span><span class="normal">A</span><span class="symbol">==</span><span class="number">0</span><span class="normal"> </span><span class="usertype">or</span><span class="normal"> A</span><span class="symbol">!=</span><span class="normal">B</span><span class="symbol">)</span><span class="normal"> </span><span class="keyword">return</span><span class="normal"> </span><span class="number">2</span><span class="symbol">;</span>
<span class="normal">	</span><span class="keyword">return</span><span class="normal"> </span><span class="number">3</span><span class="symbol">;</span>
<span class="cbracket">}</span>

<span class="keyword">template</span><span class="normal"> </span><span class="symbol">&lt;</span><span class="keyword">typename</span><span class="normal"> </span><span class="classname">CharT</span><span class="symbol">&gt;</span>
<span class="keyword">static</span><span class="normal"> </span><span class="type">void</span>
<span class="function">check_lcp_and_cache</span><span class="symbol">(</span><span class="type">unsigned</span><span class="normal"> </span><span class="type">char</span><span class="symbol">*</span><span class="normal"> latest</span><span class="symbol">,</span>
<span class="normal">                    </span><span class="type">unsigned</span><span class="normal"> </span><span class="type">char</span><span class="symbol">*</span><span class="normal"> from0</span><span class="symbol">,</span><span class="normal"> </span><span class="usertype">lcp_t</span><span class="normal"> lcp0</span><span class="symbol">,</span><span class="normal"> </span><span class="usertype">CharT</span><span class="normal"> cache0</span><span class="symbol">,</span>
<span class="normal">                    </span><span class="type">unsigned</span><span class="normal"> </span><span class="type">char</span><span class="symbol">*</span><span class="normal"> from1</span><span class="symbol">,</span><span class="normal"> </span><span class="usertype">lcp_t</span><span class="normal"> lcp1</span><span class="symbol">,</span><span class="normal"> </span><span class="usertype">CharT</span><span class="normal"> cache1</span><span class="symbol">)</span>
<span class="cbracket">{</span>
<span class="normal">	</span><span class="symbol">(</span><span class="type">void</span><span class="symbol">)</span><span class="normal"> latest</span><span class="symbol">;</span>
<span class="normal">	</span><span class="symbol">(</span><span class="type">void</span><span class="symbol">)</span><span class="normal"> from0</span><span class="symbol">;</span><span class="normal"> </span><span class="symbol">(</span><span class="type">void</span><span class="symbol">)</span><span class="normal"> lcp0</span><span class="symbol">;</span><span class="normal"> </span><span class="symbol">(</span><span class="type">void</span><span class="symbol">)</span><span class="normal"> cache0</span><span class="symbol">;</span>
<span class="normal">	</span><span class="symbol">(</span><span class="type">void</span><span class="symbol">)</span><span class="normal"> from1</span><span class="symbol">;</span><span class="normal"> </span><span class="symbol">(</span><span class="type">void</span><span class="symbol">)</span><span class="normal"> lcp1</span><span class="symbol">;</span><span class="normal"> </span><span class="symbol">(</span><span class="type">void</span><span class="symbol">)</span><span class="normal"> cache1</span><span class="symbol">;</span>
<span class="normal">	</span><span class="comment">/*debug()&lt;&lt;"******** CHECK ********\n"</span>
<span class="comment">	       &lt;&lt;"Latest: '"&lt;&lt;latest&lt;&lt;"'\n"</span>
<span class="comment">	       &lt;&lt;"     0: '"&lt;&lt;from0&lt;&lt;"', lcp="&lt;&lt;lcp0&lt;&lt;", cache="&lt;&lt;to_str(cache0)&lt;&lt;"\n"</span>
<span class="comment">	       &lt;&lt;"     1: '"&lt;&lt;from1&lt;&lt;"', lcp="&lt;&lt;lcp1&lt;&lt;", cache="&lt;&lt;to_str(cache1)&lt;&lt;"\n"</span>
<span class="comment">	       &lt;&lt;"***********************\n";*/</span>
<span class="normal">	</span><span class="function">assert</span><span class="symbol">(</span><span class="function">lcp</span><span class="symbol">(</span><span class="normal">latest</span><span class="symbol">,</span><span class="normal"> from0</span><span class="symbol">)</span><span class="normal"> </span><span class="symbol">==</span><span class="normal"> lcp0</span><span class="symbol">);</span>
<span class="normal">	</span><span class="function">assert</span><span class="symbol">(</span><span class="function">lcp</span><span class="symbol">(</span><span class="normal">latest</span><span class="symbol">,</span><span class="normal"> from1</span><span class="symbol">)</span><span class="normal"> </span><span class="symbol">==</span><span class="normal"> lcp1</span><span class="symbol">);</span>
<span class="normal">	</span><span class="function">assert</span><span class="symbol">(</span><span class="normal">get_char</span><span class="symbol">&lt;</span><span class="normal">CharT</span><span class="symbol">&gt;(</span><span class="normal">from0</span><span class="symbol">,</span><span class="normal"> lcp0</span><span class="symbol">)</span><span class="normal"> </span><span class="symbol">==</span><span class="normal"> cache0</span><span class="symbol">);</span>
<span class="normal">	</span><span class="function">assert</span><span class="symbol">(</span><span class="normal">get_char</span><span class="symbol">&lt;</span><span class="normal">CharT</span><span class="symbol">&gt;(</span><span class="normal">from1</span><span class="symbol">,</span><span class="normal"> lcp1</span><span class="symbol">)</span><span class="normal"> </span><span class="symbol">==</span><span class="normal"> cache1</span><span class="symbol">);</span>
<span class="cbracket">}</span>

<span class="keyword">template</span><span class="normal"> </span><span class="symbol">&lt;</span><span class="keyword">typename</span><span class="normal"> </span><span class="classname">CharT</span><span class="symbol">&gt;</span>
<span class="keyword">static</span><span class="normal"> </span><span class="type">void</span>
<span class="function">check_input</span><span class="symbol">(</span><span class="type">unsigned</span><span class="normal"> </span><span class="type">char</span><span class="symbol">**</span><span class="normal"> from0</span><span class="symbol">,</span><span class="normal"> lcp_t</span><span class="symbol">*</span><span class="normal"> lcp_input0</span><span class="symbol">,</span><span class="normal"> CharT</span><span class="symbol">*</span><span class="normal"> cache_input0</span><span class="symbol">,</span><span class="normal"> </span><span class="usertype">size_t</span><span class="normal"> n0</span><span class="symbol">)</span>
<span class="cbracket">{</span>
<span class="normal">	</span><span class="symbol">(</span><span class="type">void</span><span class="symbol">)</span><span class="normal"> from0</span><span class="symbol">;</span>
<span class="normal">	</span><span class="symbol">(</span><span class="type">void</span><span class="symbol">)</span><span class="normal"> lcp_input0</span><span class="symbol">;</span>
<span class="normal">	</span><span class="symbol">(</span><span class="type">void</span><span class="symbol">)</span><span class="normal"> cache_input0</span><span class="symbol">;</span>
<span class="normal">	</span><span class="symbol">(</span><span class="type">void</span><span class="symbol">)</span><span class="normal"> n0</span><span class="symbol">;</span>
<span class="preproc">#ifndef</span><span class="normal"> NDEBUG</span>
<span class="normal">	</span><span class="keyword">for</span><span class="symbol">(</span><span class="usertype">size_t</span><span class="normal"> i</span><span class="symbol">=</span><span class="number">1</span><span class="symbol">;</span><span class="normal">i</span><span class="symbol">&lt;</span><span class="normal">n0</span><span class="symbol">;++</span><span class="normal">i</span><span class="symbol">)</span><span class="keyword">if</span><span class="symbol">(</span><span class="function">cmp</span><span class="symbol">(</span><span class="normal">from0</span><span class="symbol">[</span><span class="normal">i</span><span class="symbol">-</span><span class="number">1</span><span class="symbol">],</span><span class="normal">from0</span><span class="symbol">[</span><span class="normal">i</span><span class="symbol">])&gt;</span><span class="number">0</span><span class="symbol">)</span><span class="cbracket">{</span>
<span class="normal">		</span><span class="function">debug</span><span class="symbol">()&lt;&lt;</span><span class="string">"Oops: ''"</span><span class="symbol">&lt;&lt;</span><span class="normal">from0</span><span class="symbol">[</span><span class="normal">i</span><span class="symbol">-</span><span class="number">1</span><span class="symbol">]&lt;&lt;</span><span class="string">"'' &gt; ''"</span><span class="symbol">&lt;&lt;</span><span class="normal">from0</span><span class="symbol">[</span><span class="normal">i</span><span class="symbol">]&lt;&lt;</span><span class="string">"''</span><span class="specialchar">\n</span><span class="string">"</span><span class="symbol">;</span><span class="cbracket">}</span>
<span class="normal">	</span><span class="keyword">for</span><span class="symbol">(</span><span class="usertype">size_t</span><span class="normal"> i</span><span class="symbol">=</span><span class="number">1</span><span class="symbol">;</span><span class="normal">i</span><span class="symbol">&lt;</span><span class="normal">n0</span><span class="symbol">;++</span><span class="normal">i</span><span class="symbol">)</span><span class="keyword">if</span><span class="symbol">(</span><span class="function">lcp</span><span class="symbol">(</span><span class="normal">from0</span><span class="symbol">[</span><span class="normal">i</span><span class="symbol">-</span><span class="number">1</span><span class="symbol">],</span><span class="normal">from0</span><span class="symbol">[</span><span class="normal">i</span><span class="symbol">])!=</span><span class="normal">lcp_input0</span><span class="symbol">[</span><span class="normal">i</span><span class="symbol">-</span><span class="number">1</span><span class="symbol">])</span><span class="cbracket">{</span>
<span class="normal">		</span><span class="function">debug</span><span class="symbol">()&lt;&lt;</span><span class="string">"Oops: "</span><span class="symbol">&lt;&lt;</span><span class="string">"lcp('"</span><span class="symbol">&lt;&lt;</span><span class="normal">from0</span><span class="symbol">[</span><span class="normal">i</span><span class="symbol">-</span><span class="number">1</span><span class="symbol">]&lt;&lt;</span><span class="string">"', '"</span><span class="symbol">&lt;&lt;</span><span class="normal">from0</span><span class="symbol">[</span><span class="normal">i</span><span class="symbol">]&lt;&lt;</span><span class="string">"')="</span>
<span class="normal">			</span><span class="symbol">&lt;&lt;</span><span class="function">lcp</span><span class="symbol">(</span><span class="normal">from0</span><span class="symbol">[</span><span class="normal">i</span><span class="symbol">-</span><span class="number">1</span><span class="symbol">],</span><span class="normal">from0</span><span class="symbol">[</span><span class="normal">i</span><span class="symbol">])&lt;&lt;</span><span class="string">" != "</span><span class="symbol">&lt;&lt;</span><span class="normal">lcp_input0</span><span class="symbol">[</span><span class="normal">i</span><span class="symbol">-</span><span class="number">1</span><span class="symbol">]&lt;&lt;</span><span class="string">"</span><span class="specialchar">\n</span><span class="string">"</span><span class="symbol">;</span><span class="cbracket">}</span>
<span class="normal">	</span><span class="keyword">for</span><span class="symbol">(</span><span class="usertype">size_t</span><span class="normal"> i</span><span class="symbol">=</span><span class="number">1</span><span class="symbol">;</span><span class="normal">i</span><span class="symbol">&lt;</span><span class="normal">n0</span><span class="symbol">;++</span><span class="normal">i</span><span class="symbol">)</span><span class="function">assert</span><span class="symbol">(</span><span class="function">cmp</span><span class="symbol">(</span><span class="normal">from0</span><span class="symbol">[</span><span class="normal">i</span><span class="symbol">-</span><span class="number">1</span><span class="symbol">],</span><span class="normal">from0</span><span class="symbol">[</span><span class="normal">i</span><span class="symbol">])&lt;=</span><span class="number">0</span><span class="symbol">);</span>
<span class="normal">	</span><span class="keyword">for</span><span class="symbol">(</span><span class="usertype">size_t</span><span class="normal"> i</span><span class="symbol">=</span><span class="number">1</span><span class="symbol">;</span><span class="normal">i</span><span class="symbol">&lt;</span><span class="normal">n0</span><span class="symbol">;++</span><span class="normal">i</span><span class="symbol">)</span><span class="function">assert</span><span class="symbol">(</span><span class="function">lcp</span><span class="symbol">(</span><span class="normal">from0</span><span class="symbol">[</span><span class="normal">i</span><span class="symbol">-</span><span class="number">1</span><span class="symbol">],</span><span class="normal">from0</span><span class="symbol">[</span><span class="normal">i</span><span class="symbol">])==</span><span class="normal">lcp_input0</span><span class="symbol">[</span><span class="normal">i</span><span class="symbol">-</span><span class="number">1</span><span class="symbol">]);</span>
<span class="normal">	</span><span class="function">assert</span><span class="symbol">(</span><span class="normal">get_char</span><span class="symbol">&lt;</span><span class="normal">CharT</span><span class="symbol">&gt;(*</span><span class="normal">from0</span><span class="symbol">,</span><span class="number">0</span><span class="symbol">)==</span><span class="normal">cache_input0</span><span class="symbol">[</span><span class="number">0</span><span class="symbol">]);</span>
<span class="normal">	</span><span class="keyword">for</span><span class="symbol">(</span><span class="usertype">size_t</span><span class="normal"> i</span><span class="symbol">=</span><span class="number">1</span><span class="symbol">;</span><span class="normal">i</span><span class="symbol">&lt;</span><span class="normal">n0</span><span class="symbol">;++</span><span class="normal">i</span><span class="symbol">)</span><span class="function">assert</span><span class="symbol">(</span><span class="normal">get_char</span><span class="symbol">&lt;</span><span class="normal">CharT</span><span class="symbol">&gt;(</span><span class="normal">from0</span><span class="symbol">[</span><span class="normal">i</span><span class="symbol">],</span><span class="normal">lcp_input0</span><span class="symbol">[</span><span class="normal">i</span><span class="symbol">-</span><span class="number">1</span><span class="symbol">])</span>
<span class="normal">			</span><span class="symbol">==</span><span class="normal">cache_input0</span><span class="symbol">[</span><span class="normal">i</span><span class="symbol">]);</span>
<span class="preproc">#endif</span>
<span class="cbracket">}</span>

<span class="keyword">template</span><span class="normal"> </span><span class="symbol">&lt;</span><span class="type">bool</span><span class="normal"> OutputLCP</span><span class="symbol">,</span><span class="normal"> </span><span class="keyword">typename</span><span class="normal"> </span><span class="classname">CharT</span><span class="symbol">&gt;</span>
<span class="type">void</span>
<span class="function">merge_cache_lcp_2way</span><span class="symbol">(</span>
<span class="normal">       </span><span class="type">unsigned</span><span class="normal"> </span><span class="type">char</span><span class="symbol">**</span><span class="normal"> from0</span><span class="symbol">,</span><span class="normal">  lcp_t</span><span class="symbol">*</span><span class="normal"> </span><span class="usertype">restrict</span><span class="normal"> lcp_input0</span><span class="symbol">,</span><span class="normal"> CharT</span><span class="symbol">*</span><span class="normal"> </span><span class="usertype">restrict</span><span class="normal"> cache_input0</span><span class="symbol">,</span><span class="normal"> </span><span class="usertype">size_t</span><span class="normal"> n0</span><span class="symbol">,</span>
<span class="normal">       </span><span class="type">unsigned</span><span class="normal"> </span><span class="type">char</span><span class="symbol">**</span><span class="normal"> from1</span><span class="symbol">,</span><span class="normal">  lcp_t</span><span class="symbol">*</span><span class="normal"> </span><span class="usertype">restrict</span><span class="normal"> lcp_input1</span><span class="symbol">,</span><span class="normal"> CharT</span><span class="symbol">*</span><span class="normal"> </span><span class="usertype">restrict</span><span class="normal"> cache_input1</span><span class="symbol">,</span><span class="normal"> </span><span class="usertype">size_t</span><span class="normal"> n1</span><span class="symbol">,</span>
<span class="normal">       </span><span class="type">unsigned</span><span class="normal"> </span><span class="type">char</span><span class="symbol">**</span><span class="normal"> result</span><span class="symbol">,</span><span class="normal"> lcp_t</span><span class="symbol">*</span><span class="normal"> </span><span class="usertype">restrict</span><span class="normal"> lcp_result</span><span class="symbol">,</span><span class="normal"> CharT</span><span class="symbol">*</span><span class="normal"> </span><span class="usertype">restrict</span><span class="normal"> cache_result</span><span class="symbol">)</span>
<span class="cbracket">{</span>
<span class="normal">	</span><span class="function">debug</span><span class="symbol">()</span><span class="normal"> </span><span class="symbol">&lt;&lt;</span><span class="normal"> __func__ </span><span class="symbol">&lt;&lt;</span><span class="normal"> </span><span class="string">"(): n0="</span><span class="normal"> </span><span class="symbol">&lt;&lt;</span><span class="normal"> n0 </span><span class="symbol">&lt;&lt;</span><span class="normal"> </span><span class="string">", n1="</span><span class="normal"> </span><span class="symbol">&lt;&lt;</span><span class="normal"> n1 </span><span class="symbol">&lt;&lt;</span><span class="normal"> </span><span class="string">'</span><span class="specialchar">\n</span><span class="string">'</span><span class="symbol">;</span>

<span class="normal">	</span><span class="function">check_input</span><span class="symbol">(</span><span class="normal">from0</span><span class="symbol">,</span><span class="normal"> lcp_input0</span><span class="symbol">,</span><span class="normal"> cache_input0</span><span class="symbol">,</span><span class="normal"> n0</span><span class="symbol">);</span>
<span class="normal">	</span><span class="function">check_input</span><span class="symbol">(</span><span class="normal">from1</span><span class="symbol">,</span><span class="normal"> lcp_input1</span><span class="symbol">,</span><span class="normal"> cache_input1</span><span class="symbol">,</span><span class="normal"> n1</span><span class="symbol">);</span>

<span class="normal">	</span><span class="usertype">lcp_t</span><span class="normal"> lcp0</span><span class="symbol">=</span><span class="number">0</span><span class="symbol">,</span><span class="normal"> lcp1</span><span class="symbol">=</span><span class="number">0</span><span class="symbol">;</span>
<span class="normal">	</span><span class="usertype">CharT</span><span class="normal"> cache0 </span><span class="symbol">=</span><span class="normal"> </span><span class="symbol">*</span><span class="normal">cache_input0</span><span class="symbol">++;</span>
<span class="normal">	</span><span class="usertype">CharT</span><span class="normal"> cache1 </span><span class="symbol">=</span><span class="normal"> </span><span class="symbol">*</span><span class="normal">cache_input1</span><span class="symbol">++;</span>
<span class="normal">	</span><span class="cbracket">{</span>
<span class="normal">		</span><span class="function">stat_try_cache</span><span class="symbol">();</span>
<span class="normal">		</span><span class="keyword">if</span><span class="normal"> </span><span class="symbol">(</span><span class="normal">cache0 </span><span class="symbol">&lt;</span><span class="normal"> cache1</span><span class="symbol">)</span><span class="normal"> </span><span class="cbracket">{</span>
<span class="normal">			</span><span class="function">assert</span><span class="symbol">(</span><span class="function">cmp</span><span class="symbol">(*</span><span class="normal">from0</span><span class="symbol">,</span><span class="normal"> </span><span class="symbol">*</span><span class="normal">from1</span><span class="symbol">)</span><span class="normal"> </span><span class="symbol">&lt;</span><span class="normal"> </span><span class="number">0</span><span class="symbol">);</span>
<span class="normal">			</span><span class="keyword">if</span><span class="normal"> </span><span class="symbol">(</span><span class="keyword">sizeof</span><span class="symbol">(</span><span class="normal">CharT</span><span class="symbol">)</span><span class="normal"> </span><span class="symbol">&gt;</span><span class="normal"> </span><span class="number">1</span><span class="symbol">)</span><span class="normal"> </span><span class="cbracket">{</span>
<span class="normal">				</span><span class="keyword">const</span><span class="normal"> </span><span class="type">int</span><span class="normal"> l </span><span class="symbol">=</span><span class="normal"> </span><span class="function">lcp</span><span class="symbol">(</span><span class="normal">cache0</span><span class="symbol">,</span><span class="normal"> cache1</span><span class="symbol">);</span>
<span class="normal">				</span><span class="keyword">if</span><span class="normal"> </span><span class="symbol">(</span><span class="normal">l </span><span class="symbol">&gt;</span><span class="normal"> </span><span class="number">0</span><span class="symbol">)</span><span class="normal"> </span><span class="cbracket">{</span>
<span class="normal">					cache1 </span><span class="symbol">=</span><span class="normal"> get_char</span><span class="symbol">&lt;</span><span class="normal">CharT</span><span class="symbol">&gt;(*</span><span class="normal">from1</span><span class="symbol">,</span><span class="normal"> l</span><span class="symbol">);</span>
<span class="normal">				</span><span class="cbracket">}</span>
<span class="normal">				</span><span class="symbol">*</span><span class="normal">result</span><span class="symbol">++</span><span class="normal"> </span><span class="symbol">=</span><span class="normal"> </span><span class="symbol">*</span><span class="normal">from0</span><span class="symbol">++;</span>
<span class="normal">				</span><span class="keyword">if</span><span class="normal"> </span><span class="symbol">(</span><span class="normal">OutputLCP</span><span class="symbol">)</span><span class="normal"> </span><span class="symbol">*</span><span class="normal">cache_result</span><span class="symbol">++</span><span class="normal"> </span><span class="symbol">=</span><span class="normal"> cache0</span><span class="symbol">;</span>
<span class="normal">				lcp0 </span><span class="symbol">=</span><span class="normal"> </span><span class="symbol">*</span><span class="normal">lcp_input0</span><span class="symbol">++;</span>
<span class="normal">				lcp1 </span><span class="symbol">=</span><span class="normal"> l</span><span class="symbol">;</span>
<span class="normal">				cache0 </span><span class="symbol">=</span><span class="normal"> </span><span class="symbol">*</span><span class="normal">cache_input0</span><span class="symbol">++;</span>
<span class="normal">			</span><span class="cbracket">}</span><span class="normal"> </span><span class="keyword">else</span><span class="normal"> </span><span class="cbracket">{</span>
<span class="normal">				</span><span class="symbol">*</span><span class="normal">result</span><span class="symbol">++</span><span class="normal"> </span><span class="symbol">=</span><span class="normal"> </span><span class="symbol">*</span><span class="normal">from0</span><span class="symbol">++;</span>
<span class="normal">				</span><span class="keyword">if</span><span class="normal"> </span><span class="symbol">(</span><span class="normal">OutputLCP</span><span class="symbol">)</span><span class="normal"> </span><span class="symbol">*</span><span class="normal">cache_result</span><span class="symbol">++</span><span class="normal"> </span><span class="symbol">=</span><span class="normal"> cache0</span><span class="symbol">;</span>
<span class="normal">				lcp0 </span><span class="symbol">=</span><span class="normal"> </span><span class="symbol">*</span><span class="normal">lcp_input0</span><span class="symbol">++;</span>
<span class="normal">				cache0 </span><span class="symbol">=</span><span class="normal"> </span><span class="symbol">*</span><span class="normal">cache_input0</span><span class="symbol">++;</span>
<span class="normal">			</span><span class="cbracket">}</span>
<span class="normal">			</span><span class="keyword">if</span><span class="normal"> </span><span class="symbol">(--</span><span class="normal">n0 </span><span class="symbol">==</span><span class="normal"> </span><span class="number">0</span><span class="symbol">)</span><span class="normal"> </span><span class="keyword">goto</span><span class="normal"> finish0</span><span class="symbol">;</span>
<span class="normal">		</span><span class="cbracket">}</span><span class="normal"> </span><span class="keyword">else</span><span class="normal"> </span><span class="keyword">if</span><span class="normal"> </span><span class="symbol">(</span><span class="normal">cache0 </span><span class="symbol">&gt;</span><span class="normal"> cache1</span><span class="symbol">)</span><span class="normal"> </span><span class="cbracket">{</span>
<span class="normal">			</span><span class="function">assert</span><span class="symbol">(</span><span class="function">cmp</span><span class="symbol">(*</span><span class="normal">from0</span><span class="symbol">,</span><span class="normal"> </span><span class="symbol">*</span><span class="normal">from1</span><span class="symbol">)</span><span class="normal"> </span><span class="symbol">&gt;</span><span class="normal"> </span><span class="number">0</span><span class="symbol">);</span>
<span class="normal">			</span><span class="keyword">if</span><span class="normal"> </span><span class="symbol">(</span><span class="keyword">sizeof</span><span class="symbol">(</span><span class="normal">CharT</span><span class="symbol">)</span><span class="normal"> </span><span class="symbol">&gt;</span><span class="normal"> </span><span class="number">1</span><span class="symbol">)</span><span class="normal"> </span><span class="cbracket">{</span>
<span class="normal">				</span><span class="keyword">const</span><span class="normal"> </span><span class="type">int</span><span class="normal"> l </span><span class="symbol">=</span><span class="normal"> </span><span class="function">lcp</span><span class="symbol">(</span><span class="normal">cache0</span><span class="symbol">,</span><span class="normal"> cache1</span><span class="symbol">);</span>
<span class="normal">				</span><span class="keyword">if</span><span class="normal"> </span><span class="symbol">(</span><span class="normal">l </span><span class="symbol">&gt;</span><span class="normal"> </span><span class="number">0</span><span class="symbol">)</span><span class="normal"> </span><span class="cbracket">{</span>
<span class="normal">					cache0 </span><span class="symbol">=</span><span class="normal"> get_char</span><span class="symbol">&lt;</span><span class="normal">CharT</span><span class="symbol">&gt;(*</span><span class="normal">from0</span><span class="symbol">,</span><span class="normal"> l</span><span class="symbol">);</span>
<span class="normal">				</span><span class="cbracket">}</span>
<span class="normal">				</span><span class="symbol">*</span><span class="normal">result</span><span class="symbol">++</span><span class="normal"> </span><span class="symbol">=</span><span class="normal"> </span><span class="symbol">*</span><span class="normal">from1</span><span class="symbol">++;</span>
<span class="normal">				</span><span class="keyword">if</span><span class="normal"> </span><span class="symbol">(</span><span class="normal">OutputLCP</span><span class="symbol">)</span><span class="normal"> </span><span class="symbol">*</span><span class="normal">cache_result</span><span class="symbol">++</span><span class="normal"> </span><span class="symbol">=</span><span class="normal"> cache1</span><span class="symbol">;</span>
<span class="normal">				lcp0 </span><span class="symbol">=</span><span class="normal"> l</span><span class="symbol">;</span>
<span class="normal">				lcp1 </span><span class="symbol">=</span><span class="normal"> </span><span class="symbol">*</span><span class="normal">lcp_input1</span><span class="symbol">++;</span>
<span class="normal">				cache1 </span><span class="symbol">=</span><span class="normal"> </span><span class="symbol">*</span><span class="normal">cache_input1</span><span class="symbol">++;</span>
<span class="normal">			</span><span class="cbracket">}</span><span class="normal"> </span><span class="keyword">else</span><span class="normal"> </span><span class="cbracket">{</span>
<span class="normal">				</span><span class="symbol">*</span><span class="normal">result</span><span class="symbol">++</span><span class="normal"> </span><span class="symbol">=</span><span class="normal"> </span><span class="symbol">*</span><span class="normal">from1</span><span class="symbol">++;</span>
<span class="normal">				</span><span class="keyword">if</span><span class="normal"> </span><span class="symbol">(</span><span class="normal">OutputLCP</span><span class="symbol">)</span><span class="normal"> </span><span class="symbol">*</span><span class="normal">cache_result</span><span class="symbol">++</span><span class="normal"> </span><span class="symbol">=</span><span class="normal"> cache1</span><span class="symbol">;</span>
<span class="normal">				lcp1 </span><span class="symbol">=</span><span class="normal"> </span><span class="symbol">*</span><span class="normal">lcp_input1</span><span class="symbol">++;</span>
<span class="normal">				cache1 </span><span class="symbol">=</span><span class="normal"> </span><span class="symbol">*</span><span class="normal">cache_input1</span><span class="symbol">++;</span>
<span class="normal">			</span><span class="cbracket">}</span>
<span class="normal">			</span><span class="keyword">if</span><span class="normal"> </span><span class="symbol">(--</span><span class="normal">n1 </span><span class="symbol">==</span><span class="normal"> </span><span class="number">0</span><span class="symbol">)</span><span class="normal"> </span><span class="keyword">goto</span><span class="normal"> finish1</span><span class="symbol">;</span>
<span class="normal">		</span><span class="cbracket">}</span><span class="normal"> </span><span class="keyword">else</span><span class="normal"> </span><span class="cbracket">{</span>
<span class="normal">			</span><span class="keyword">if</span><span class="normal"> </span><span class="symbol">(</span><span class="function">is_end</span><span class="symbol">(</span><span class="normal">cache0</span><span class="symbol">))</span><span class="normal"> </span><span class="cbracket">{</span>
<span class="normal">				</span><span class="function">assert</span><span class="symbol">(</span><span class="function">cmp</span><span class="symbol">(*</span><span class="normal">from0</span><span class="symbol">,</span><span class="normal"> </span><span class="symbol">*</span><span class="normal">from1</span><span class="symbol">)</span><span class="normal"> </span><span class="symbol">==</span><span class="normal"> </span><span class="number">0</span><span class="symbol">);</span>
<span class="normal">				</span><span class="keyword">if</span><span class="normal"> </span><span class="symbol">(</span><span class="keyword">sizeof</span><span class="symbol">(</span><span class="normal">CharT</span><span class="symbol">)</span><span class="normal"> </span><span class="symbol">&gt;</span><span class="normal"> </span><span class="number">1</span><span class="symbol">)</span><span class="normal"> </span><span class="cbracket">{</span>
<span class="normal">					</span><span class="keyword">const</span><span class="normal"> </span><span class="type">int</span><span class="normal"> l </span><span class="symbol">=</span><span class="normal"> </span><span class="function">lcp</span><span class="symbol">(</span><span class="normal">cache0</span><span class="symbol">,</span><span class="normal"> cache1</span><span class="symbol">);</span>
<span class="normal">					</span><span class="symbol">*</span><span class="normal">result</span><span class="symbol">++</span><span class="normal"> </span><span class="symbol">=</span><span class="normal"> </span><span class="symbol">*</span><span class="normal">from0</span><span class="symbol">++;</span>
<span class="normal">					</span><span class="keyword">if</span><span class="normal"> </span><span class="symbol">(</span><span class="normal">OutputLCP</span><span class="symbol">)</span><span class="normal"> </span><span class="symbol">*</span><span class="normal">cache_result</span><span class="symbol">++</span><span class="normal"> </span><span class="symbol">=</span><span class="normal"> cache0</span><span class="symbol">;</span>
<span class="normal">					lcp0 </span><span class="symbol">=</span><span class="normal"> </span><span class="symbol">*</span><span class="normal">lcp_input0</span><span class="symbol">++;</span>
<span class="normal">					lcp1 </span><span class="symbol">=</span><span class="normal"> l</span><span class="symbol">;</span>
<span class="normal">					cache0 </span><span class="symbol">=</span><span class="normal"> </span><span class="symbol">*</span><span class="normal">cache_input0</span><span class="symbol">++;</span>
<span class="normal">					cache1 </span><span class="symbol">=</span><span class="normal"> </span><span class="number">0</span><span class="symbol">;</span>
<span class="normal">				</span><span class="cbracket">}</span><span class="normal"> </span><span class="keyword">else</span><span class="normal"> </span><span class="cbracket">{</span>
<span class="normal">					</span><span class="symbol">*</span><span class="normal">result</span><span class="symbol">++</span><span class="normal"> </span><span class="symbol">=</span><span class="normal"> </span><span class="symbol">*</span><span class="normal">from0</span><span class="symbol">++;</span>
<span class="normal">					</span><span class="keyword">if</span><span class="normal"> </span><span class="symbol">(</span><span class="normal">OutputLCP</span><span class="symbol">)</span><span class="normal"> </span><span class="symbol">*</span><span class="normal">cache_result</span><span class="symbol">++</span><span class="normal"> </span><span class="symbol">=</span><span class="normal"> cache0</span><span class="symbol">;</span>
<span class="normal">					lcp0 </span><span class="symbol">=</span><span class="normal"> </span><span class="symbol">*</span><span class="normal">lcp_input0</span><span class="symbol">++;</span>
<span class="normal">					cache0 </span><span class="symbol">=</span><span class="normal"> </span><span class="symbol">*</span><span class="normal">cache_input0</span><span class="symbol">++;</span>
<span class="normal">					cache1 </span><span class="symbol">=</span><span class="normal"> </span><span class="number">0</span><span class="symbol">;</span>
<span class="normal">				</span><span class="cbracket">}</span>
<span class="normal">				</span><span class="keyword">if</span><span class="normal"> </span><span class="symbol">(--</span><span class="normal">n0 </span><span class="symbol">==</span><span class="normal"> </span><span class="number">0</span><span class="symbol">)</span><span class="normal"> </span><span class="keyword">goto</span><span class="normal"> finish0</span><span class="symbol">;</span>
<span class="normal">			</span><span class="cbracket">}</span><span class="normal"> </span><span class="keyword">else</span><span class="normal"> </span><span class="cbracket">{</span>
<span class="normal">				</span><span class="function">stat_cache_useless</span><span class="symbol">();</span>
<span class="normal">				</span><span class="type">int</span><span class="normal"> cmp01</span><span class="symbol">;</span><span class="normal"> </span><span class="usertype">lcp_t</span><span class="normal"> lcp01</span><span class="symbol">;</span>
<span class="normal">				boost</span><span class="symbol">::</span><span class="function">tie</span><span class="symbol">(</span><span class="normal">cmp01</span><span class="symbol">,</span><span class="normal"> lcp01</span><span class="symbol">)</span><span class="normal"> </span><span class="symbol">=</span><span class="normal"> </span><span class="function">compare</span><span class="symbol">(*</span><span class="normal">from0</span><span class="symbol">,</span><span class="normal"> </span><span class="symbol">*</span><span class="normal">from1</span><span class="symbol">,</span><span class="normal"> </span><span class="keyword">sizeof</span><span class="symbol">(</span><span class="normal">CharT</span><span class="symbol">));</span>
<span class="normal">				</span><span class="keyword">if</span><span class="normal"> </span><span class="symbol">(</span><span class="normal">cmp01 </span><span class="symbol">&lt;</span><span class="normal"> </span><span class="number">0</span><span class="symbol">)</span><span class="normal"> </span><span class="cbracket">{</span>
<span class="normal">					</span><span class="symbol">*</span><span class="normal">result</span><span class="symbol">++</span><span class="normal"> </span><span class="symbol">=</span><span class="normal"> </span><span class="symbol">*</span><span class="normal">from0</span><span class="symbol">++;</span>
<span class="normal">					</span><span class="keyword">if</span><span class="normal"> </span><span class="symbol">(</span><span class="normal">OutputLCP</span><span class="symbol">)</span><span class="normal"> </span><span class="symbol">*</span><span class="normal">cache_result</span><span class="symbol">++</span><span class="normal"> </span><span class="symbol">=</span><span class="normal"> cache0</span><span class="symbol">;</span>
<span class="normal">					lcp0 </span><span class="symbol">=</span><span class="normal"> </span><span class="symbol">*</span><span class="normal">lcp_input0</span><span class="symbol">++;</span>
<span class="normal">					lcp1 </span><span class="symbol">=</span><span class="normal"> lcp01</span><span class="symbol">;</span>
<span class="normal">					cache0 </span><span class="symbol">=</span><span class="normal"> </span><span class="symbol">*</span><span class="normal">cache_input0</span><span class="symbol">++;</span>
<span class="normal">					cache1 </span><span class="symbol">=</span><span class="normal"> get_char</span><span class="symbol">&lt;</span><span class="normal">CharT</span><span class="symbol">&gt;(*</span><span class="normal">from1</span><span class="symbol">,</span><span class="normal"> lcp01</span><span class="symbol">);</span>
<span class="normal">					</span><span class="keyword">if</span><span class="normal"> </span><span class="symbol">(--</span><span class="normal">n0 </span><span class="symbol">==</span><span class="normal"> </span><span class="number">0</span><span class="symbol">)</span><span class="normal"> </span><span class="keyword">goto</span><span class="normal"> finish0</span><span class="symbol">;</span>
<span class="normal">				</span><span class="cbracket">}</span><span class="normal"> </span><span class="keyword">else</span><span class="normal"> </span><span class="keyword">if</span><span class="normal"> </span><span class="symbol">(</span><span class="normal">cmp01 </span><span class="symbol">==</span><span class="normal"> </span><span class="number">0</span><span class="symbol">)</span><span class="normal"> </span><span class="cbracket">{</span>
<span class="normal">					</span><span class="symbol">*</span><span class="normal">result</span><span class="symbol">++</span><span class="normal"> </span><span class="symbol">=</span><span class="normal"> </span><span class="symbol">*</span><span class="normal">from0</span><span class="symbol">++;</span>
<span class="normal">					</span><span class="keyword">if</span><span class="normal"> </span><span class="symbol">(</span><span class="normal">OutputLCP</span><span class="symbol">)</span><span class="normal"> </span><span class="symbol">*</span><span class="normal">cache_result</span><span class="symbol">++</span><span class="normal"> </span><span class="symbol">=</span><span class="normal"> cache0</span><span class="symbol">;</span>
<span class="normal">					lcp0 </span><span class="symbol">=</span><span class="normal"> </span><span class="symbol">*</span><span class="normal">lcp_input0</span><span class="symbol">++;</span>
<span class="normal">					lcp1 </span><span class="symbol">=</span><span class="normal"> lcp01</span><span class="symbol">;</span>
<span class="normal">					cache0 </span><span class="symbol">=</span><span class="normal"> </span><span class="symbol">*</span><span class="normal">cache_input0</span><span class="symbol">++;</span>
<span class="normal">					cache1 </span><span class="symbol">=</span><span class="normal"> </span><span class="number">0</span><span class="symbol">;</span>
<span class="normal">					</span><span class="keyword">if</span><span class="normal"> </span><span class="symbol">(--</span><span class="normal">n0 </span><span class="symbol">==</span><span class="normal"> </span><span class="number">0</span><span class="symbol">)</span><span class="normal"> </span><span class="keyword">goto</span><span class="normal"> finish0</span><span class="symbol">;</span>
<span class="normal">				</span><span class="cbracket">}</span><span class="normal"> </span><span class="keyword">else</span><span class="normal"> </span><span class="cbracket">{</span>
<span class="normal">					</span><span class="symbol">*</span><span class="normal">result</span><span class="symbol">++</span><span class="normal"> </span><span class="symbol">=</span><span class="normal"> </span><span class="symbol">*</span><span class="normal">from1</span><span class="symbol">++;</span>
<span class="normal">					</span><span class="keyword">if</span><span class="normal"> </span><span class="symbol">(</span><span class="normal">OutputLCP</span><span class="symbol">)</span><span class="normal"> </span><span class="symbol">*</span><span class="normal">cache_result</span><span class="symbol">++</span><span class="normal"> </span><span class="symbol">=</span><span class="normal"> cache1</span><span class="symbol">;</span>
<span class="normal">					lcp0 </span><span class="symbol">=</span><span class="normal"> lcp01</span><span class="symbol">;</span>
<span class="normal">					lcp1 </span><span class="symbol">=</span><span class="normal"> </span><span class="symbol">*</span><span class="normal">lcp_input1</span><span class="symbol">++;</span>
<span class="normal">					cache0 </span><span class="symbol">=</span><span class="normal"> get_char</span><span class="symbol">&lt;</span><span class="normal">CharT</span><span class="symbol">&gt;(*</span><span class="normal">from0</span><span class="symbol">,</span><span class="normal"> lcp01</span><span class="symbol">);</span>
<span class="normal">					cache1 </span><span class="symbol">=</span><span class="normal"> </span><span class="symbol">*</span><span class="normal">cache_input1</span><span class="symbol">++;</span>
<span class="normal">					</span><span class="keyword">if</span><span class="normal"> </span><span class="symbol">(--</span><span class="normal">n1 </span><span class="symbol">==</span><span class="normal"> </span><span class="number">0</span><span class="symbol">)</span><span class="normal"> </span><span class="keyword">goto</span><span class="normal"> finish1</span><span class="symbol">;</span>
<span class="normal">				</span><span class="cbracket">}</span>
<span class="normal">			</span><span class="cbracket">}</span>
<span class="normal">		</span><span class="cbracket">}</span>
<span class="normal">	</span><span class="cbracket">}</span>
<span class="normal">	</span><span class="keyword">while</span><span class="normal"> </span><span class="symbol">(</span><span class="keyword">true</span><span class="symbol">)</span><span class="normal"> </span><span class="cbracket">{</span>
<span class="normal">		</span><span class="function">debug</span><span class="symbol">()</span><span class="normal"> </span><span class="symbol">&lt;&lt;</span><span class="normal"> </span><span class="string">"Starting loop, n0="</span><span class="symbol">&lt;&lt;</span><span class="normal">n0</span><span class="symbol">&lt;&lt;</span><span class="string">", n1="</span><span class="symbol">&lt;&lt;</span><span class="normal">n1</span><span class="symbol">&lt;&lt;</span><span class="string">" ...</span><span class="specialchar">\n</span><span class="string">"</span>
<span class="normal">			</span><span class="symbol">&lt;&lt;</span><span class="normal"> </span><span class="string">"</span><span class="specialchar">\t</span><span class="string">prev   = '"</span><span class="symbol">&lt;&lt;*(</span><span class="normal">result</span><span class="symbol">-</span><span class="number">1</span><span class="symbol">)&lt;&lt;</span><span class="string">"'</span><span class="specialchar">\n</span><span class="string">"</span>
<span class="normal">			</span><span class="symbol">&lt;&lt;</span><span class="normal"> </span><span class="string">"</span><span class="specialchar">\t</span><span class="string">*from0 = '"</span><span class="symbol">&lt;&lt;*</span><span class="normal">from0</span><span class="symbol">&lt;&lt;</span><span class="string">"'</span><span class="specialchar">\n</span><span class="string">"</span>
<span class="normal">			</span><span class="symbol">&lt;&lt;</span><span class="normal"> </span><span class="string">"</span><span class="specialchar">\t</span><span class="string">*from1 = '"</span><span class="symbol">&lt;&lt;*</span><span class="normal">from1</span><span class="symbol">&lt;&lt;</span><span class="string">"'</span><span class="specialchar">\n</span><span class="string">"</span>
<span class="normal">			</span><span class="symbol">&lt;&lt;</span><span class="normal"> </span><span class="string">"</span><span class="specialchar">\t</span><span class="string">lcp0   = "</span><span class="normal"> </span><span class="symbol">&lt;&lt;</span><span class="normal">lcp0</span><span class="symbol">&lt;&lt;</span><span class="string">"</span><span class="specialchar">\n</span><span class="string">"</span>
<span class="normal">			</span><span class="symbol">&lt;&lt;</span><span class="normal"> </span><span class="string">"</span><span class="specialchar">\t</span><span class="string">lcp1   = "</span><span class="normal"> </span><span class="symbol">&lt;&lt;</span><span class="normal">lcp1</span><span class="symbol">&lt;&lt;</span><span class="string">"</span><span class="specialchar">\n</span><span class="string">"</span>
<span class="normal">			</span><span class="symbol">&lt;&lt;</span><span class="normal"> </span><span class="string">"</span><span class="specialchar">\t</span><span class="string">cache0 = '"</span><span class="symbol">&lt;&lt;</span><span class="function">to_str</span><span class="symbol">(</span><span class="normal">cache0</span><span class="symbol">)&lt;&lt;</span><span class="string">"'</span><span class="specialchar">\n</span><span class="string">"</span>
<span class="normal">			</span><span class="symbol">&lt;&lt;</span><span class="normal"> </span><span class="string">"</span><span class="specialchar">\t</span><span class="string">cache1 = '"</span><span class="symbol">&lt;&lt;</span><span class="function">to_str</span><span class="symbol">(</span><span class="normal">cache1</span><span class="symbol">)&lt;&lt;</span><span class="string">"'</span><span class="specialchar">\n</span><span class="string">"</span>
<span class="normal">			</span><span class="symbol">&lt;&lt;</span><span class="normal"> </span><span class="string">"</span><span class="specialchar">\n</span><span class="string">"</span><span class="symbol">;</span>
<span class="normal">		</span><span class="function">check_lcp_and_cache</span><span class="symbol">(*(</span><span class="normal">result</span><span class="symbol">-</span><span class="number">1</span><span class="symbol">),*</span><span class="normal">from0</span><span class="symbol">,</span><span class="normal">lcp0</span><span class="symbol">,</span><span class="normal">cache0</span><span class="symbol">,*</span><span class="normal">from1</span><span class="symbol">,</span><span class="normal">lcp1</span><span class="symbol">,</span><span class="normal">cache1</span><span class="symbol">);</span>
<span class="normal">		</span><span class="keyword">if</span><span class="normal"> </span><span class="symbol">(</span><span class="normal">lcp0 </span><span class="symbol">&gt;</span><span class="normal"> lcp1</span><span class="symbol">)</span><span class="normal"> </span><span class="cbracket">{</span>
<span class="normal">			</span><span class="function">debug</span><span class="symbol">()</span><span class="normal"> </span><span class="symbol">&lt;&lt;</span><span class="normal"> </span><span class="string">"</span><span class="specialchar">\t</span><span class="string">lcp0 &gt; lcp1</span><span class="specialchar">\n</span><span class="string">"</span><span class="symbol">;</span>
<span class="normal">			</span><span class="function">assert</span><span class="symbol">(</span><span class="function">cmp</span><span class="symbol">(*</span><span class="normal">from0</span><span class="symbol">,</span><span class="normal"> </span><span class="symbol">*</span><span class="normal">from1</span><span class="symbol">)</span><span class="normal"> </span><span class="symbol">&lt;</span><span class="normal"> </span><span class="number">0</span><span class="symbol">);</span>
<span class="normal">			</span><span class="symbol">*</span><span class="normal">result</span><span class="symbol">++</span><span class="normal"> </span><span class="symbol">=</span><span class="normal"> </span><span class="symbol">*</span><span class="normal">from0</span><span class="symbol">++;</span>
<span class="normal">			</span><span class="keyword">if</span><span class="normal"> </span><span class="symbol">(</span><span class="normal">OutputLCP</span><span class="symbol">)</span><span class="normal"> </span><span class="symbol">*</span><span class="normal">lcp_result</span><span class="symbol">++</span><span class="normal"> </span><span class="symbol">=</span><span class="normal"> lcp0</span><span class="symbol">;</span>
<span class="normal">			</span><span class="keyword">if</span><span class="normal"> </span><span class="symbol">(</span><span class="normal">OutputLCP</span><span class="symbol">)</span><span class="normal"> </span><span class="symbol">*</span><span class="normal">cache_result</span><span class="symbol">++</span><span class="normal"> </span><span class="symbol">=</span><span class="normal"> cache0</span><span class="symbol">;</span>
<span class="normal">			lcp0 </span><span class="symbol">=</span><span class="normal"> </span><span class="symbol">*</span><span class="normal">lcp_input0</span><span class="symbol">++;</span>
<span class="normal">			cache0 </span><span class="symbol">=</span><span class="normal"> </span><span class="symbol">*</span><span class="normal">cache_input0</span><span class="symbol">++;</span>
<span class="normal">			</span><span class="keyword">if</span><span class="normal"> </span><span class="symbol">(--</span><span class="normal">n0 </span><span class="symbol">==</span><span class="normal"> </span><span class="number">0</span><span class="symbol">)</span><span class="normal"> </span><span class="keyword">goto</span><span class="normal"> finish0</span><span class="symbol">;</span>
<span class="normal">		</span><span class="cbracket">}</span><span class="normal"> </span><span class="keyword">else</span><span class="normal"> </span><span class="keyword">if</span><span class="normal"> </span><span class="symbol">(</span><span class="normal">lcp0 </span><span class="symbol">&lt;</span><span class="normal"> lcp1</span><span class="symbol">)</span><span class="normal"> </span><span class="cbracket">{</span>
<span class="normal">			</span><span class="function">debug</span><span class="symbol">()</span><span class="normal"> </span><span class="symbol">&lt;&lt;</span><span class="normal"> </span><span class="string">"</span><span class="specialchar">\t</span><span class="string">lcp0 &lt; lcp1</span><span class="specialchar">\n</span><span class="string">"</span><span class="symbol">;</span>
<span class="normal">			</span><span class="function">assert</span><span class="symbol">(</span><span class="function">cmp</span><span class="symbol">(*</span><span class="normal">from0</span><span class="symbol">,</span><span class="normal"> </span><span class="symbol">*</span><span class="normal">from1</span><span class="symbol">)</span><span class="normal"> </span><span class="symbol">&gt;</span><span class="normal"> </span><span class="number">0</span><span class="symbol">);</span>
<span class="normal">			</span><span class="symbol">*</span><span class="normal">result</span><span class="symbol">++</span><span class="normal"> </span><span class="symbol">=</span><span class="normal"> </span><span class="symbol">*</span><span class="normal">from1</span><span class="symbol">++;</span>
<span class="normal">			</span><span class="keyword">if</span><span class="normal"> </span><span class="symbol">(</span><span class="normal">OutputLCP</span><span class="symbol">)</span><span class="normal"> </span><span class="symbol">*</span><span class="normal">lcp_result</span><span class="symbol">++</span><span class="normal"> </span><span class="symbol">=</span><span class="normal"> lcp1</span><span class="symbol">;</span>
<span class="normal">			</span><span class="keyword">if</span><span class="normal"> </span><span class="symbol">(</span><span class="normal">OutputLCP</span><span class="symbol">)</span><span class="normal"> </span><span class="symbol">*</span><span class="normal">cache_result</span><span class="symbol">++</span><span class="normal"> </span><span class="symbol">=</span><span class="normal"> cache1</span><span class="symbol">;</span>
<span class="normal">			lcp1 </span><span class="symbol">=</span><span class="normal"> </span><span class="symbol">*</span><span class="normal">lcp_input1</span><span class="symbol">++;</span>
<span class="normal">			cache1 </span><span class="symbol">=</span><span class="normal"> </span><span class="symbol">*</span><span class="normal">cache_input1</span><span class="symbol">++;</span>
<span class="normal">			</span><span class="keyword">if</span><span class="normal"> </span><span class="symbol">(--</span><span class="normal">n1 </span><span class="symbol">==</span><span class="normal"> </span><span class="number">0</span><span class="symbol">)</span><span class="normal"> </span><span class="keyword">goto</span><span class="normal"> finish1</span><span class="symbol">;</span>
<span class="normal">		</span><span class="cbracket">}</span><span class="normal"> </span><span class="keyword">else</span><span class="normal"> </span><span class="cbracket">{</span>
<span class="normal">			</span><span class="function">debug</span><span class="symbol">()</span><span class="normal"> </span><span class="symbol">&lt;&lt;</span><span class="normal"> </span><span class="string">"</span><span class="specialchar">\t</span><span class="string">lcp0 == lcp1</span><span class="specialchar">\n</span><span class="string">"</span><span class="symbol">;</span>
<span class="normal">			</span><span class="function">stat_try_cache</span><span class="symbol">();</span>
<span class="normal">			</span><span class="comment">// Both strings in the sorted sequences have the same</span>
<span class="normal">			</span><span class="comment">// prefix than the latest string in output. Check</span>
<span class="normal">			</span><span class="comment">// cached characters first.</span>
<span class="normal">			</span><span class="keyword">if</span><span class="normal"> </span><span class="symbol">(</span><span class="normal">cache0 </span><span class="symbol">&lt;</span><span class="normal"> cache1</span><span class="symbol">)</span><span class="normal"> </span><span class="cbracket">{</span>
<span class="normal">				</span><span class="function">debug</span><span class="symbol">()</span><span class="normal"> </span><span class="symbol">&lt;&lt;</span><span class="normal"> </span><span class="string">"</span><span class="specialchar">\t\t</span><span class="string">cache0 &lt; cache1</span><span class="specialchar">\n</span><span class="string">"</span><span class="symbol">;</span>
<span class="normal">				</span><span class="function">assert</span><span class="symbol">(</span><span class="function">cmp</span><span class="symbol">(*</span><span class="normal">from0</span><span class="symbol">,</span><span class="normal"> </span><span class="symbol">*</span><span class="normal">from1</span><span class="symbol">)</span><span class="normal"> </span><span class="symbol">&lt;</span><span class="normal"> </span><span class="number">0</span><span class="symbol">);</span>
<span class="normal">				</span><span class="keyword">if</span><span class="normal"> </span><span class="symbol">(</span><span class="keyword">sizeof</span><span class="symbol">(</span><span class="normal">CharT</span><span class="symbol">)</span><span class="normal"> </span><span class="symbol">&gt;</span><span class="normal"> </span><span class="number">1</span><span class="symbol">)</span><span class="normal"> </span><span class="cbracket">{</span>
<span class="normal">					</span><span class="keyword">const</span><span class="normal"> </span><span class="type">int</span><span class="normal"> l </span><span class="symbol">=</span><span class="normal"> </span><span class="function">lcp</span><span class="symbol">(</span><span class="normal">cache0</span><span class="symbol">,</span><span class="normal"> cache1</span><span class="symbol">);</span>
<span class="normal">					</span><span class="keyword">if</span><span class="normal"> </span><span class="symbol">(</span><span class="normal">l </span><span class="symbol">&gt;</span><span class="normal"> </span><span class="number">0</span><span class="symbol">)</span><span class="normal"> </span><span class="cbracket">{</span>
<span class="normal">						lcp1 </span><span class="symbol">+=</span><span class="normal"> l</span><span class="symbol">;</span>
<span class="normal">						cache1 </span><span class="symbol">=</span><span class="normal"> get_char</span><span class="symbol">&lt;</span><span class="normal">CharT</span><span class="symbol">&gt;(*</span><span class="normal">from1</span><span class="symbol">,</span><span class="normal"> lcp1</span><span class="symbol">);</span>
<span class="normal">					</span><span class="cbracket">}</span>
<span class="normal">				</span><span class="cbracket">}</span>
<span class="normal">				</span><span class="symbol">*</span><span class="normal">result</span><span class="symbol">++</span><span class="normal"> </span><span class="symbol">=</span><span class="normal"> </span><span class="symbol">*</span><span class="normal">from0</span><span class="symbol">++;</span>
<span class="normal">				</span><span class="keyword">if</span><span class="normal"> </span><span class="symbol">(</span><span class="normal">OutputLCP</span><span class="symbol">)</span><span class="normal"> </span><span class="symbol">*</span><span class="normal">lcp_result</span><span class="symbol">++</span><span class="normal"> </span><span class="symbol">=</span><span class="normal"> lcp0</span><span class="symbol">;</span>
<span class="normal">				</span><span class="keyword">if</span><span class="normal"> </span><span class="symbol">(</span><span class="normal">OutputLCP</span><span class="symbol">)</span><span class="normal"> </span><span class="symbol">*</span><span class="normal">cache_result</span><span class="symbol">++</span><span class="normal"> </span><span class="symbol">=</span><span class="normal"> cache0</span><span class="symbol">;</span>
<span class="normal">				lcp0 </span><span class="symbol">=</span><span class="normal"> </span><span class="symbol">*</span><span class="normal">lcp_input0</span><span class="symbol">++;</span>
<span class="normal">				cache0 </span><span class="symbol">=</span><span class="normal"> </span><span class="symbol">*</span><span class="normal">cache_input0</span><span class="symbol">++;</span>
<span class="normal">				</span><span class="keyword">if</span><span class="normal"> </span><span class="symbol">(--</span><span class="normal">n0 </span><span class="symbol">==</span><span class="normal"> </span><span class="number">0</span><span class="symbol">)</span><span class="normal"> </span><span class="keyword">goto</span><span class="normal"> finish0</span><span class="symbol">;</span>
<span class="normal">			</span><span class="cbracket">}</span><span class="normal"> </span><span class="keyword">else</span><span class="normal"> </span><span class="keyword">if</span><span class="normal"> </span><span class="symbol">(</span><span class="normal">cache0 </span><span class="symbol">&gt;</span><span class="normal"> cache1</span><span class="symbol">)</span><span class="normal"> </span><span class="cbracket">{</span>
<span class="normal">				</span><span class="function">debug</span><span class="symbol">()</span><span class="normal"> </span><span class="symbol">&lt;&lt;</span><span class="normal"> </span><span class="string">"</span><span class="specialchar">\t\t</span><span class="string">cache0 &gt; cache1</span><span class="specialchar">\n</span><span class="string">"</span><span class="symbol">;</span>
<span class="normal">				</span><span class="function">assert</span><span class="symbol">(</span><span class="function">cmp</span><span class="symbol">(*</span><span class="normal">from0</span><span class="symbol">,</span><span class="normal"> </span><span class="symbol">*</span><span class="normal">from1</span><span class="symbol">)</span><span class="normal"> </span><span class="symbol">&gt;</span><span class="normal"> </span><span class="number">0</span><span class="symbol">);</span>
<span class="normal">				</span><span class="keyword">if</span><span class="normal"> </span><span class="symbol">(</span><span class="keyword">sizeof</span><span class="symbol">(</span><span class="normal">CharT</span><span class="symbol">)</span><span class="normal"> </span><span class="symbol">&gt;</span><span class="normal"> </span><span class="number">1</span><span class="symbol">)</span><span class="normal"> </span><span class="cbracket">{</span>
<span class="normal">					</span><span class="keyword">const</span><span class="normal"> </span><span class="type">int</span><span class="normal"> l </span><span class="symbol">=</span><span class="normal"> </span><span class="function">lcp</span><span class="symbol">(</span><span class="normal">cache0</span><span class="symbol">,</span><span class="normal"> cache1</span><span class="symbol">);</span>
<span class="normal">					</span><span class="keyword">if</span><span class="normal"> </span><span class="symbol">(</span><span class="normal">l </span><span class="symbol">&gt;</span><span class="normal"> </span><span class="number">0</span><span class="symbol">)</span><span class="normal"> </span><span class="cbracket">{</span>
<span class="normal">						lcp0 </span><span class="symbol">+=</span><span class="normal"> l</span><span class="symbol">;</span>
<span class="normal">						cache0 </span><span class="symbol">=</span><span class="normal"> get_char</span><span class="symbol">&lt;</span><span class="normal">CharT</span><span class="symbol">&gt;(*</span><span class="normal">from0</span><span class="symbol">,</span><span class="normal"> lcp0</span><span class="symbol">);</span>
<span class="normal">					</span><span class="cbracket">}</span>
<span class="normal">				</span><span class="cbracket">}</span>
<span class="normal">				</span><span class="symbol">*</span><span class="normal">result</span><span class="symbol">++</span><span class="normal"> </span><span class="symbol">=</span><span class="normal"> </span><span class="symbol">*</span><span class="normal">from1</span><span class="symbol">++;</span>
<span class="normal">				</span><span class="keyword">if</span><span class="normal"> </span><span class="symbol">(</span><span class="normal">OutputLCP</span><span class="symbol">)</span><span class="normal"> </span><span class="symbol">*</span><span class="normal">lcp_result</span><span class="symbol">++</span><span class="normal"> </span><span class="symbol">=</span><span class="normal"> lcp1</span><span class="symbol">;</span>
<span class="normal">				</span><span class="keyword">if</span><span class="normal"> </span><span class="symbol">(</span><span class="normal">OutputLCP</span><span class="symbol">)</span><span class="normal"> </span><span class="symbol">*</span><span class="normal">cache_result</span><span class="symbol">++</span><span class="normal"> </span><span class="symbol">=</span><span class="normal"> cache1</span><span class="symbol">;</span>
<span class="normal">				lcp1 </span><span class="symbol">=</span><span class="normal"> </span><span class="symbol">*</span><span class="normal">lcp_input1</span><span class="symbol">++;</span>
<span class="normal">				cache1 </span><span class="symbol">=</span><span class="normal"> </span><span class="symbol">*</span><span class="normal">cache_input1</span><span class="symbol">++;</span>
<span class="normal">				</span><span class="keyword">if</span><span class="normal"> </span><span class="symbol">(--</span><span class="normal">n1 </span><span class="symbol">==</span><span class="normal"> </span><span class="number">0</span><span class="symbol">)</span><span class="normal"> </span><span class="keyword">goto</span><span class="normal"> finish1</span><span class="symbol">;</span>
<span class="normal">			</span><span class="cbracket">}</span><span class="normal"> </span><span class="keyword">else</span><span class="normal"> </span><span class="cbracket">{</span>
<span class="normal">				</span><span class="function">debug</span><span class="symbol">()</span><span class="normal"> </span><span class="symbol">&lt;&lt;</span><span class="normal"> </span><span class="string">"</span><span class="specialchar">\t\t</span><span class="string">cache0 == cache1</span><span class="specialchar">\n</span><span class="string">"</span><span class="symbol">;</span>
<span class="normal">				</span><span class="keyword">if</span><span class="normal"> </span><span class="symbol">(</span><span class="function">is_end</span><span class="symbol">(</span><span class="normal">cache0</span><span class="symbol">))</span><span class="normal"> </span><span class="cbracket">{</span>
<span class="normal">					</span><span class="function">assert</span><span class="symbol">(</span><span class="function">cmp</span><span class="symbol">(*</span><span class="normal">from0</span><span class="symbol">,</span><span class="normal"> </span><span class="symbol">*</span><span class="normal">from1</span><span class="symbol">)</span><span class="normal"> </span><span class="symbol">==</span><span class="normal"> </span><span class="number">0</span><span class="symbol">);</span>
<span class="normal">					</span><span class="keyword">if</span><span class="normal"> </span><span class="symbol">(</span><span class="keyword">sizeof</span><span class="symbol">(</span><span class="normal">CharT</span><span class="symbol">)</span><span class="normal"> </span><span class="symbol">&gt;</span><span class="normal"> </span><span class="number">1</span><span class="symbol">)</span><span class="normal"> </span><span class="cbracket">{</span>
<span class="normal">						</span><span class="symbol">*</span><span class="normal">result</span><span class="symbol">++</span><span class="normal"> </span><span class="symbol">=</span><span class="normal"> </span><span class="symbol">*</span><span class="normal">from0</span><span class="symbol">++;</span>
<span class="normal">						</span><span class="keyword">if</span><span class="normal"> </span><span class="symbol">(</span><span class="normal">OutputLCP</span><span class="symbol">)</span><span class="normal"> </span><span class="symbol">*</span><span class="normal">lcp_result</span><span class="symbol">++</span><span class="normal"> </span><span class="symbol">=</span><span class="normal"> lcp0 </span><span class="comment">/* == lcp1 */</span><span class="symbol">;</span>
<span class="normal">						</span><span class="keyword">if</span><span class="normal"> </span><span class="symbol">(</span><span class="normal">OutputLCP</span><span class="symbol">)</span><span class="normal"> </span><span class="symbol">*</span><span class="normal">cache_result</span><span class="symbol">++</span><span class="normal"> </span><span class="symbol">=</span><span class="normal"> cache0 </span><span class="comment">/* == cache1 */</span><span class="symbol">;</span>
<span class="normal">						lcp0 </span><span class="symbol">=</span><span class="normal"> </span><span class="symbol">*</span><span class="normal">lcp_input0</span><span class="symbol">++;</span>
<span class="normal">						lcp1 </span><span class="symbol">+=</span><span class="normal"> </span><span class="function">lcp</span><span class="symbol">(</span><span class="normal">cache0</span><span class="symbol">,</span><span class="normal"> cache1</span><span class="symbol">);</span>
<span class="normal">						cache0 </span><span class="symbol">=</span><span class="normal"> </span><span class="symbol">*</span><span class="normal">cache_input0</span><span class="symbol">++;</span>
<span class="normal">						cache1 </span><span class="symbol">=</span><span class="normal"> </span><span class="number">0</span><span class="symbol">;</span>
<span class="normal">					</span><span class="cbracket">}</span><span class="normal"> </span><span class="keyword">else</span><span class="normal"> </span><span class="cbracket">{</span>
<span class="normal">						</span><span class="symbol">*</span><span class="normal">result</span><span class="symbol">++</span><span class="normal"> </span><span class="symbol">=</span><span class="normal"> </span><span class="symbol">*</span><span class="normal">from0</span><span class="symbol">++;</span>
<span class="normal">						</span><span class="keyword">if</span><span class="normal"> </span><span class="symbol">(</span><span class="normal">OutputLCP</span><span class="symbol">)</span><span class="normal"> </span><span class="symbol">*</span><span class="normal">lcp_result</span><span class="symbol">++</span><span class="normal"> </span><span class="symbol">=</span><span class="normal"> lcp0 </span><span class="comment">/* == lcp1 */</span><span class="symbol">;</span>
<span class="normal">						</span><span class="keyword">if</span><span class="normal"> </span><span class="symbol">(</span><span class="normal">OutputLCP</span><span class="symbol">)</span><span class="normal"> </span><span class="symbol">*</span><span class="normal">cache_result</span><span class="symbol">++</span><span class="normal"> </span><span class="symbol">=</span><span class="normal"> cache0 </span><span class="comment">/* == cache1 */</span><span class="symbol">;</span>
<span class="normal">						lcp0 </span><span class="symbol">=</span><span class="normal"> </span><span class="symbol">*</span><span class="normal">lcp_input0</span><span class="symbol">++;</span>
<span class="normal">						cache0 </span><span class="symbol">=</span><span class="normal"> </span><span class="symbol">*</span><span class="normal">cache_input0</span><span class="symbol">++;</span>
<span class="normal">					</span><span class="cbracket">}</span>
<span class="normal">					</span><span class="keyword">if</span><span class="normal"> </span><span class="symbol">(--</span><span class="normal">n0 </span><span class="symbol">==</span><span class="normal"> </span><span class="number">0</span><span class="symbol">)</span><span class="normal"> </span><span class="keyword">goto</span><span class="normal"> finish0</span><span class="symbol">;</span>
<span class="normal">				</span><span class="cbracket">}</span><span class="normal"> </span><span class="keyword">else</span><span class="normal"> </span><span class="cbracket">{</span>
<span class="normal">					</span><span class="function">stat_cache_useless</span><span class="symbol">();</span>
<span class="normal">					</span><span class="type">int</span><span class="normal"> cmp01</span><span class="symbol">;</span><span class="normal"> </span><span class="usertype">lcp_t</span><span class="normal"> lcp01</span><span class="symbol">;</span>
<span class="normal">					boost</span><span class="symbol">::</span><span class="function">tie</span><span class="symbol">(</span><span class="normal">cmp01</span><span class="symbol">,</span><span class="normal"> lcp01</span><span class="symbol">)</span><span class="normal"> </span><span class="symbol">=</span><span class="normal"> </span><span class="function">compare</span><span class="symbol">(*</span><span class="normal">from0</span><span class="symbol">,</span><span class="normal"> </span><span class="symbol">*</span><span class="normal">from1</span><span class="symbol">,</span><span class="normal"> lcp0</span><span class="symbol">+</span><span class="keyword">sizeof</span><span class="symbol">(</span><span class="normal">CharT</span><span class="symbol">));</span>
<span class="normal">					</span><span class="keyword">if</span><span class="normal"> </span><span class="symbol">(</span><span class="normal">cmp01 </span><span class="symbol">&lt;</span><span class="normal"> </span><span class="number">0</span><span class="symbol">)</span><span class="normal"> </span><span class="cbracket">{</span>
<span class="normal">						</span><span class="symbol">*</span><span class="normal">result</span><span class="symbol">++</span><span class="normal"> </span><span class="symbol">=</span><span class="normal"> </span><span class="symbol">*</span><span class="normal">from0</span><span class="symbol">++;</span>
<span class="normal">						</span><span class="keyword">if</span><span class="normal"> </span><span class="symbol">(</span><span class="normal">OutputLCP</span><span class="symbol">)</span><span class="normal"> </span><span class="symbol">*</span><span class="normal">lcp_result</span><span class="symbol">++</span><span class="normal"> </span><span class="symbol">=</span><span class="normal"> lcp0 </span><span class="comment">/* == lcp1 */</span><span class="symbol">;</span>
<span class="normal">						</span><span class="keyword">if</span><span class="normal"> </span><span class="symbol">(</span><span class="normal">OutputLCP</span><span class="symbol">)</span><span class="normal"> </span><span class="symbol">*</span><span class="normal">cache_result</span><span class="symbol">++</span><span class="normal"> </span><span class="symbol">=</span><span class="normal"> cache0 </span><span class="comment">/* == cache1 */</span><span class="symbol">;</span>
<span class="normal">						lcp0 </span><span class="symbol">=</span><span class="normal"> </span><span class="symbol">*</span><span class="normal">lcp_input0</span><span class="symbol">++;</span>
<span class="normal">						lcp1 </span><span class="symbol">=</span><span class="normal"> lcp01</span><span class="symbol">;</span>
<span class="normal">						cache0 </span><span class="symbol">=</span><span class="normal"> </span><span class="symbol">*</span><span class="normal">cache_input0</span><span class="symbol">++;</span>
<span class="normal">						cache1 </span><span class="symbol">=</span><span class="normal"> get_char</span><span class="symbol">&lt;</span><span class="normal">CharT</span><span class="symbol">&gt;(*</span><span class="normal">from1</span><span class="symbol">,</span><span class="normal"> lcp01</span><span class="symbol">);</span>
<span class="normal">						</span><span class="keyword">if</span><span class="normal"> </span><span class="symbol">(--</span><span class="normal">n0 </span><span class="symbol">==</span><span class="normal"> </span><span class="number">0</span><span class="symbol">)</span><span class="normal"> </span><span class="keyword">goto</span><span class="normal"> finish0</span><span class="symbol">;</span>
<span class="normal">					</span><span class="cbracket">}</span><span class="normal"> </span><span class="keyword">else</span><span class="normal"> </span><span class="keyword">if</span><span class="normal"> </span><span class="symbol">(</span><span class="normal">cmp01 </span><span class="symbol">==</span><span class="normal"> </span><span class="number">0</span><span class="symbol">)</span><span class="normal"> </span><span class="cbracket">{</span>
<span class="normal">						</span><span class="symbol">*</span><span class="normal">result</span><span class="symbol">++</span><span class="normal"> </span><span class="symbol">=</span><span class="normal"> </span><span class="symbol">*</span><span class="normal">from0</span><span class="symbol">++;</span>
<span class="normal">						</span><span class="keyword">if</span><span class="normal"> </span><span class="symbol">(</span><span class="normal">OutputLCP</span><span class="symbol">)</span><span class="normal"> </span><span class="symbol">*</span><span class="normal">lcp_result</span><span class="symbol">++</span><span class="normal"> </span><span class="symbol">=</span><span class="normal"> lcp0 </span><span class="comment">/* == lcp1 */</span><span class="symbol">;</span>
<span class="normal">						</span><span class="keyword">if</span><span class="normal"> </span><span class="symbol">(</span><span class="normal">OutputLCP</span><span class="symbol">)</span><span class="normal"> </span><span class="symbol">*</span><span class="normal">cache_result</span><span class="symbol">++</span><span class="normal"> </span><span class="symbol">=</span><span class="normal"> cache0 </span><span class="comment">/* == cache1 */</span><span class="symbol">;</span>
<span class="normal">						lcp0 </span><span class="symbol">=</span><span class="normal"> </span><span class="symbol">*</span><span class="normal">lcp_input0</span><span class="symbol">++;</span>
<span class="normal">						lcp1 </span><span class="symbol">=</span><span class="normal"> lcp01</span><span class="symbol">;</span>
<span class="normal">						cache0 </span><span class="symbol">=</span><span class="normal"> </span><span class="symbol">*</span><span class="normal">cache_input0</span><span class="symbol">++;</span>
<span class="normal">						cache1 </span><span class="symbol">=</span><span class="normal"> </span><span class="number">0</span><span class="symbol">;</span>
<span class="normal">						</span><span class="keyword">if</span><span class="normal"> </span><span class="symbol">(--</span><span class="normal">n0 </span><span class="symbol">==</span><span class="normal"> </span><span class="number">0</span><span class="symbol">)</span><span class="normal"> </span><span class="keyword">goto</span><span class="normal"> finish0</span><span class="symbol">;</span>
<span class="normal">					</span><span class="cbracket">}</span><span class="normal"> </span><span class="keyword">else</span><span class="normal"> </span><span class="cbracket">{</span>
<span class="normal">						</span><span class="symbol">*</span><span class="normal">result</span><span class="symbol">++</span><span class="normal"> </span><span class="symbol">=</span><span class="normal"> </span><span class="symbol">*</span><span class="normal">from1</span><span class="symbol">++;</span>
<span class="normal">						</span><span class="keyword">if</span><span class="normal"> </span><span class="symbol">(</span><span class="normal">OutputLCP</span><span class="symbol">)</span><span class="normal"> </span><span class="symbol">*</span><span class="normal">lcp_result</span><span class="symbol">++</span><span class="normal"> </span><span class="symbol">=</span><span class="normal"> lcp0 </span><span class="comment">/* == lcp1 */</span><span class="symbol">;</span>
<span class="normal">						</span><span class="keyword">if</span><span class="normal"> </span><span class="symbol">(</span><span class="normal">OutputLCP</span><span class="symbol">)</span><span class="normal"> </span><span class="symbol">*</span><span class="normal">cache_result</span><span class="symbol">++</span><span class="normal"> </span><span class="symbol">=</span><span class="normal"> cache0 </span><span class="comment">/* == cache1 */</span><span class="symbol">;</span>
<span class="normal">						lcp0 </span><span class="symbol">=</span><span class="normal"> lcp01</span><span class="symbol">;</span>
<span class="normal">						lcp1 </span><span class="symbol">=</span><span class="normal"> </span><span class="symbol">*</span><span class="normal">lcp_input1</span><span class="symbol">++;</span>
<span class="normal">						cache0 </span><span class="symbol">=</span><span class="normal"> get_char</span><span class="symbol">&lt;</span><span class="normal">CharT</span><span class="symbol">&gt;(*</span><span class="normal">from0</span><span class="symbol">,</span><span class="normal"> lcp01</span><span class="symbol">);</span>
<span class="normal">						cache1 </span><span class="symbol">=</span><span class="normal"> </span><span class="symbol">*</span><span class="normal">cache_input1</span><span class="symbol">++;</span>
<span class="normal">						</span><span class="keyword">if</span><span class="normal"> </span><span class="symbol">(--</span><span class="normal">n1 </span><span class="symbol">==</span><span class="normal"> </span><span class="number">0</span><span class="symbol">)</span><span class="normal"> </span><span class="keyword">goto</span><span class="normal"> finish1</span><span class="symbol">;</span>
<span class="normal">					</span><span class="cbracket">}</span>
<span class="normal">				</span><span class="cbracket">}</span>
<span class="normal">			</span><span class="cbracket">}</span>
<span class="normal">		</span><span class="cbracket">}</span>
<span class="normal">	</span><span class="cbracket">}</span>
<span class="label">finish0:</span>
<span class="normal">	</span><span class="function">assert</span><span class="symbol">(</span><span class="normal">n0</span><span class="symbol">==</span><span class="number">0</span><span class="symbol">);</span>
<span class="normal">	</span><span class="function">assert</span><span class="symbol">(</span><span class="normal">n1</span><span class="symbol">);</span>
<span class="normal">	</span><span class="keyword">if</span><span class="normal"> </span><span class="symbol">(</span><span class="normal">OutputLCP</span><span class="symbol">)</span><span class="normal"> </span><span class="symbol">*</span><span class="normal">lcp_result</span><span class="symbol">++</span><span class="normal"> </span><span class="symbol">=</span><span class="normal"> lcp1</span><span class="symbol">;</span>
<span class="normal">	</span><span class="keyword">if</span><span class="normal"> </span><span class="symbol">(</span><span class="normal">OutputLCP</span><span class="symbol">)</span><span class="normal"> </span><span class="symbol">*</span><span class="normal">cache_result</span><span class="symbol">++</span><span class="normal"> </span><span class="symbol">=</span><span class="normal"> cache1</span><span class="symbol">;</span>
<span class="normal">	std</span><span class="symbol">::</span><span class="function">copy</span><span class="symbol">(</span><span class="normal">from1</span><span class="symbol">,</span><span class="normal"> from1</span><span class="symbol">+</span><span class="normal">n1</span><span class="symbol">,</span><span class="normal"> result</span><span class="symbol">);</span>
<span class="normal">	</span><span class="keyword">if</span><span class="normal"> </span><span class="symbol">(</span><span class="normal">OutputLCP</span><span class="symbol">)</span><span class="normal"> std</span><span class="symbol">::</span><span class="function">copy</span><span class="symbol">(</span><span class="normal">lcp_input1</span><span class="symbol">,</span><span class="normal"> lcp_input1</span><span class="symbol">+</span><span class="normal">n1</span><span class="symbol">,</span><span class="normal"> lcp_result</span><span class="symbol">);</span>
<span class="normal">	</span><span class="keyword">if</span><span class="normal"> </span><span class="symbol">(</span><span class="normal">OutputLCP</span><span class="symbol">)</span><span class="normal"> std</span><span class="symbol">::</span><span class="function">copy</span><span class="symbol">(</span><span class="normal">cache_input1</span><span class="symbol">,</span><span class="normal"> cache_input1</span><span class="symbol">+</span><span class="normal">n1</span><span class="symbol">,</span><span class="normal"> cache_result</span><span class="symbol">);</span>
<span class="normal">	</span><span class="function">debug</span><span class="symbol">()</span><span class="normal"> </span><span class="symbol">&lt;&lt;</span><span class="normal"> </span><span class="string">'~'</span><span class="normal"> </span><span class="symbol">&lt;&lt;</span><span class="normal"> __func__ </span><span class="symbol">&lt;&lt;</span><span class="normal"> </span><span class="string">'</span><span class="specialchar">\n</span><span class="string">'</span><span class="symbol">;</span>
<span class="normal">	</span><span class="keyword">return</span><span class="symbol">;</span>
<span class="label">finish1:</span>
<span class="normal">	</span><span class="function">assert</span><span class="symbol">(</span><span class="normal">n0</span><span class="symbol">);</span>
<span class="normal">	</span><span class="function">assert</span><span class="symbol">(</span><span class="normal">n1</span><span class="symbol">==</span><span class="number">0</span><span class="symbol">);</span>
<span class="normal">	</span><span class="keyword">if</span><span class="normal"> </span><span class="symbol">(</span><span class="normal">OutputLCP</span><span class="symbol">)</span><span class="normal"> </span><span class="symbol">*</span><span class="normal">lcp_result</span><span class="symbol">++</span><span class="normal"> </span><span class="symbol">=</span><span class="normal"> lcp0</span><span class="symbol">;</span>
<span class="normal">	</span><span class="keyword">if</span><span class="normal"> </span><span class="symbol">(</span><span class="normal">OutputLCP</span><span class="symbol">)</span><span class="normal"> </span><span class="symbol">*</span><span class="normal">cache_result</span><span class="symbol">++</span><span class="normal"> </span><span class="symbol">=</span><span class="normal"> cache0</span><span class="symbol">;</span>
<span class="normal">	std</span><span class="symbol">::</span><span class="function">copy</span><span class="symbol">(</span><span class="normal">from0</span><span class="symbol">,</span><span class="normal"> from0</span><span class="symbol">+</span><span class="normal">n0</span><span class="symbol">,</span><span class="normal"> result</span><span class="symbol">);</span>
<span class="normal">	</span><span class="keyword">if</span><span class="normal"> </span><span class="symbol">(</span><span class="normal">OutputLCP</span><span class="symbol">)</span><span class="normal"> std</span><span class="symbol">::</span><span class="function">copy</span><span class="symbol">(</span><span class="normal">lcp_input0</span><span class="symbol">,</span><span class="normal"> lcp_input0</span><span class="symbol">+</span><span class="normal">n0</span><span class="symbol">,</span><span class="normal"> lcp_result</span><span class="symbol">);</span>
<span class="normal">	</span><span class="keyword">if</span><span class="normal"> </span><span class="symbol">(</span><span class="normal">OutputLCP</span><span class="symbol">)</span><span class="normal"> std</span><span class="symbol">::</span><span class="function">copy</span><span class="symbol">(</span><span class="normal">cache_input0</span><span class="symbol">,</span><span class="normal"> cache_input0</span><span class="symbol">+</span><span class="normal">n0</span><span class="symbol">,</span><span class="normal"> cache_result</span><span class="symbol">);</span>
<span class="normal">	</span><span class="function">debug</span><span class="symbol">()</span><span class="normal"> </span><span class="symbol">&lt;&lt;</span><span class="normal"> </span><span class="string">'~'</span><span class="normal"> </span><span class="symbol">&lt;&lt;</span><span class="normal"> __func__ </span><span class="symbol">&lt;&lt;</span><span class="normal"> </span><span class="string">'</span><span class="specialchar">\n</span><span class="string">'</span><span class="symbol">;</span>
<span class="normal">	</span><span class="keyword">return</span><span class="symbol">;</span>
<span class="cbracket">}</span>

<span class="keyword">template</span><span class="normal"> </span><span class="symbol">&lt;</span><span class="type">bool</span><span class="normal"> OutputLCP</span><span class="symbol">,</span><span class="normal"> </span><span class="keyword">typename</span><span class="normal"> </span><span class="classname">CharT</span><span class="symbol">&gt;</span>
<span class="normal">MergeResult</span>
<span class="function">mergesort_cache_lcp_2way</span><span class="symbol">(</span>
<span class="normal">              </span><span class="type">unsigned</span><span class="normal"> </span><span class="type">char</span><span class="symbol">**</span><span class="normal"> strings_input</span><span class="symbol">,</span><span class="normal"> </span><span class="type">unsigned</span><span class="normal"> </span><span class="type">char</span><span class="symbol">**</span><span class="normal"> strings_output</span><span class="symbol">,</span>
<span class="normal">              lcp_t</span><span class="symbol">*</span><span class="normal"> </span><span class="usertype">restrict</span><span class="normal"> lcp_input</span><span class="symbol">,</span><span class="normal"> lcp_t</span><span class="symbol">*</span><span class="normal"> </span><span class="usertype">restrict</span><span class="normal"> lcp_output</span><span class="symbol">,</span>
<span class="normal">              CharT</span><span class="symbol">*</span><span class="normal"> </span><span class="usertype">restrict</span><span class="normal"> cache_input</span><span class="symbol">,</span><span class="normal"> CharT</span><span class="symbol">*</span><span class="normal"> </span><span class="usertype">restrict</span><span class="normal"> cache_output</span><span class="symbol">,</span>
<span class="normal">              </span><span class="usertype">size_t</span><span class="normal"> n</span><span class="symbol">)</span>
<span class="cbracket">{</span>
<span class="normal">	</span><span class="function">debug</span><span class="symbol">()</span><span class="normal"> </span><span class="symbol">&lt;&lt;</span><span class="normal"> __func__ </span><span class="symbol">&lt;&lt;</span><span class="normal"> </span><span class="string">"(): n="</span><span class="normal"> </span><span class="symbol">&lt;&lt;</span><span class="normal"> n </span><span class="symbol">&lt;&lt;</span><span class="normal"> </span><span class="string">'</span><span class="specialchar">\n</span><span class="string">'</span><span class="symbol">;</span>
<span class="normal">	</span><span class="keyword">if</span><span class="normal"> </span><span class="symbol">(</span><span class="normal">n </span><span class="symbol">&lt;</span><span class="normal"> </span><span class="number">32</span><span class="symbol">)</span><span class="normal"> </span><span class="cbracket">{</span>
<span class="normal">		</span><span class="function">insertion_sort</span><span class="symbol">(</span><span class="normal">strings_input</span><span class="symbol">,</span><span class="normal"> n</span><span class="symbol">,</span><span class="normal"> </span><span class="number">0</span><span class="symbol">);</span>
<span class="normal">		lcp_input</span><span class="symbol">[</span><span class="number">0</span><span class="symbol">]</span><span class="normal"> </span><span class="symbol">=</span><span class="normal"> </span><span class="function">lcp</span><span class="symbol">(</span><span class="normal">strings_input</span><span class="symbol">[</span><span class="number">0</span><span class="symbol">],</span><span class="normal"> strings_input</span><span class="symbol">[</span><span class="number">1</span><span class="symbol">]);</span>
<span class="normal">		cache_input</span><span class="symbol">[</span><span class="number">0</span><span class="symbol">]</span><span class="normal"> </span><span class="symbol">=</span><span class="normal"> get_char</span><span class="symbol">&lt;</span><span class="normal">CharT</span><span class="symbol">&gt;(</span><span class="normal">strings_input</span><span class="symbol">[</span><span class="number">0</span><span class="symbol">],</span><span class="normal"> </span><span class="number">0</span><span class="symbol">);</span>
<span class="normal">		</span><span class="keyword">for</span><span class="normal"> </span><span class="symbol">(</span><span class="type">unsigned</span><span class="normal"> i</span><span class="symbol">=</span><span class="number">1</span><span class="symbol">;</span><span class="normal"> i </span><span class="symbol">&lt;</span><span class="normal"> n</span><span class="symbol">-</span><span class="number">1</span><span class="symbol">;</span><span class="normal"> </span><span class="symbol">++</span><span class="normal">i</span><span class="symbol">)</span><span class="normal"> </span><span class="cbracket">{</span>
<span class="normal">			lcp_input</span><span class="symbol">[</span><span class="normal">i</span><span class="symbol">]</span><span class="normal"> </span><span class="symbol">=</span><span class="normal"> </span><span class="function">lcp</span><span class="symbol">(</span><span class="normal">strings_input</span><span class="symbol">[</span><span class="normal">i</span><span class="symbol">],</span><span class="normal"> strings_input</span><span class="symbol">[</span><span class="normal">i</span><span class="symbol">+</span><span class="number">1</span><span class="symbol">]);</span>
<span class="normal">			cache_input</span><span class="symbol">[</span><span class="normal">i</span><span class="symbol">]</span><span class="normal"> </span><span class="symbol">=</span><span class="normal"> get_char</span><span class="symbol">&lt;</span><span class="normal">CharT</span><span class="symbol">&gt;(</span><span class="normal">strings_input</span><span class="symbol">[</span><span class="normal">i</span><span class="symbol">],</span><span class="normal"> lcp_input</span><span class="symbol">[</span><span class="normal">i</span><span class="symbol">-</span><span class="number">1</span><span class="symbol">]);</span>
<span class="normal">		</span><span class="cbracket">}</span>
<span class="normal">		cache_input</span><span class="symbol">[</span><span class="normal">n</span><span class="symbol">-</span><span class="number">1</span><span class="symbol">]</span><span class="normal"> </span><span class="symbol">=</span><span class="normal"> get_char</span><span class="symbol">&lt;</span><span class="normal">CharT</span><span class="symbol">&gt;(</span><span class="normal">strings_input</span><span class="symbol">[</span><span class="normal">n</span><span class="symbol">-</span><span class="number">1</span><span class="symbol">],</span><span class="normal"> lcp_input</span><span class="symbol">[</span><span class="normal">n</span><span class="symbol">-</span><span class="number">2</span><span class="symbol">]);</span>
<span class="normal">		</span><span class="function">check_input</span><span class="symbol">(</span><span class="normal">strings_input</span><span class="symbol">,</span><span class="normal"> lcp_input</span><span class="symbol">,</span><span class="normal"> cache_input</span><span class="symbol">,</span><span class="normal"> n</span><span class="symbol">);</span>
<span class="normal">		</span><span class="keyword">return</span><span class="normal"> SortedInPlace</span><span class="symbol">;</span>
<span class="normal">	</span><span class="cbracket">}</span>
<span class="normal">	</span><span class="keyword">const</span><span class="normal"> </span><span class="usertype">size_t</span><span class="normal"> split0 </span><span class="symbol">=</span><span class="normal"> n</span><span class="symbol">/</span><span class="number">2</span><span class="symbol">;</span>
<span class="normal">	</span><span class="usertype">MergeResult</span><span class="normal"> m0 </span><span class="symbol">=</span><span class="normal"> mergesort_cache_lcp_2way</span><span class="symbol">&lt;</span><span class="keyword">true</span><span class="symbol">&gt;(</span>
<span class="normal">			strings_input</span><span class="symbol">,</span><span class="normal"> strings_output</span><span class="symbol">,</span>
<span class="normal">			lcp_input</span><span class="symbol">,</span><span class="normal"> lcp_output</span><span class="symbol">,</span>
<span class="normal">			cache_input</span><span class="symbol">,</span><span class="normal"> cache_output</span><span class="symbol">,</span>
<span class="normal">			split0</span><span class="symbol">);</span>

<span class="normal">	</span><span class="keyword">if</span><span class="normal"> </span><span class="symbol">(</span><span class="normal">m0</span><span class="symbol">==</span><span class="normal">SortedInPlace</span><span class="symbol">)</span><span class="normal"> </span><span class="function">check_input</span><span class="symbol">(</span><span class="normal">strings_input</span><span class="symbol">,</span><span class="normal"> lcp_input</span><span class="symbol">,</span><span class="normal"> cache_input</span><span class="symbol">,</span><span class="normal"> split0</span><span class="symbol">);</span>
<span class="normal">	</span><span class="keyword">else</span><span class="normal">                   </span><span class="function">check_input</span><span class="symbol">(</span><span class="normal">strings_output</span><span class="symbol">,</span><span class="normal"> lcp_output</span><span class="symbol">,</span><span class="normal"> cache_output</span><span class="symbol">,</span><span class="normal"> split0</span><span class="symbol">);</span>

<span class="normal">	</span><span class="usertype">MergeResult</span><span class="normal"> m1 </span><span class="symbol">=</span><span class="normal"> mergesort_cache_lcp_2way</span><span class="symbol">&lt;</span><span class="keyword">true</span><span class="symbol">&gt;(</span>
<span class="normal">			strings_input</span><span class="symbol">+</span><span class="normal">split0</span><span class="symbol">,</span><span class="normal"> strings_output</span><span class="symbol">+</span><span class="normal">split0</span><span class="symbol">,</span>
<span class="normal">			lcp_input</span><span class="symbol">+</span><span class="normal">split0</span><span class="symbol">,</span><span class="normal"> lcp_output</span><span class="symbol">+</span><span class="normal">split0</span><span class="symbol">,</span>
<span class="normal">			cache_input</span><span class="symbol">+</span><span class="normal">split0</span><span class="symbol">,</span><span class="normal"> cache_output</span><span class="symbol">+</span><span class="normal">split0</span><span class="symbol">,</span>
<span class="normal">			n</span><span class="symbol">-</span><span class="normal">split0</span><span class="symbol">);</span>

<span class="normal">	</span><span class="keyword">if</span><span class="normal"> </span><span class="symbol">(</span><span class="normal">m0</span><span class="symbol">==</span><span class="normal">SortedInPlace</span><span class="symbol">)</span><span class="normal"> </span><span class="function">check_input</span><span class="symbol">(</span><span class="normal">strings_input</span><span class="symbol">+</span><span class="normal">split0</span><span class="symbol">,</span><span class="normal"> lcp_input</span><span class="symbol">+</span><span class="normal">split0</span><span class="symbol">,</span><span class="normal"> cache_input</span><span class="symbol">+</span><span class="normal">split0</span><span class="symbol">,</span><span class="normal"> n</span><span class="symbol">-</span><span class="normal">split0</span><span class="symbol">);</span>
<span class="normal">	</span><span class="keyword">else</span><span class="normal">                   </span><span class="function">check_input</span><span class="symbol">(</span><span class="normal">strings_output</span><span class="symbol">+</span><span class="normal">split0</span><span class="symbol">,</span><span class="normal"> lcp_output</span><span class="symbol">+</span><span class="normal">split0</span><span class="symbol">,</span><span class="normal"> cache_output</span><span class="symbol">+</span><span class="normal">split0</span><span class="symbol">,</span><span class="normal"> n</span><span class="symbol">-</span><span class="normal">split0</span><span class="symbol">);</span>

<span class="normal">	</span><span class="keyword">if</span><span class="normal"> </span><span class="symbol">(</span><span class="normal">m0 </span><span class="symbol">!=</span><span class="normal"> m1</span><span class="symbol">)</span><span class="normal"> </span><span class="cbracket">{</span>
<span class="normal">		</span><span class="function">debug</span><span class="symbol">()</span><span class="normal"> </span><span class="symbol">&lt;&lt;</span><span class="normal"> </span><span class="string">"Warning: extra copying due to m0 != m1. n="</span><span class="symbol">&lt;&lt;</span><span class="normal">n</span><span class="symbol">&lt;&lt;</span><span class="string">"</span><span class="specialchar">\n</span><span class="string">"</span><span class="symbol">;</span>
<span class="normal">		</span><span class="keyword">if</span><span class="normal"> </span><span class="symbol">(</span><span class="normal">m0 </span><span class="symbol">==</span><span class="normal"> SortedInPlace</span><span class="symbol">)</span><span class="normal"> </span><span class="cbracket">{</span>
<span class="normal">			std</span><span class="symbol">::</span><span class="function">copy</span><span class="symbol">(</span><span class="normal">strings_input</span><span class="symbol">,</span><span class="normal"> strings_input</span><span class="symbol">+</span><span class="normal">split0</span><span class="symbol">,</span>
<span class="normal">					strings_output</span><span class="symbol">);</span>
<span class="normal">			std</span><span class="symbol">::</span><span class="function">copy</span><span class="symbol">(</span><span class="normal">cache_input</span><span class="symbol">,</span><span class="normal"> cache_input</span><span class="symbol">+</span><span class="normal">split0</span><span class="symbol">,</span>
<span class="normal">					cache_output</span><span class="symbol">);</span>
<span class="normal">			std</span><span class="symbol">::</span><span class="function">copy</span><span class="symbol">(</span><span class="normal">lcp_input</span><span class="symbol">,</span><span class="normal"> lcp_input</span><span class="symbol">+</span><span class="normal">split0</span><span class="symbol">,</span>
<span class="normal">					lcp_output</span><span class="symbol">);</span>
<span class="normal">			m0 </span><span class="symbol">=</span><span class="normal"> SortedInTemp</span><span class="symbol">;</span>
<span class="normal">		</span><span class="cbracket">}</span><span class="normal"> </span><span class="keyword">else</span><span class="normal"> </span><span class="cbracket">{</span>
<span class="normal">			std</span><span class="symbol">::</span><span class="function">copy</span><span class="symbol">(</span><span class="normal">strings_output</span><span class="symbol">,</span><span class="normal"> strings_output</span><span class="symbol">+</span><span class="normal">split0</span><span class="symbol">,</span>
<span class="normal">					strings_input</span><span class="symbol">);</span>
<span class="normal">			std</span><span class="symbol">::</span><span class="function">copy</span><span class="symbol">(</span><span class="normal">cache_output</span><span class="symbol">,</span><span class="normal"> cache_output</span><span class="symbol">+</span><span class="normal">split0</span><span class="symbol">,</span>
<span class="normal">					cache_input</span><span class="symbol">);</span>
<span class="normal">			std</span><span class="symbol">::</span><span class="function">copy</span><span class="symbol">(</span><span class="normal">lcp_output</span><span class="symbol">,</span><span class="normal"> lcp_output</span><span class="symbol">+</span><span class="normal">split0</span><span class="symbol">,</span>
<span class="normal">					lcp_input</span><span class="symbol">);</span>
<span class="normal">			m1 </span><span class="symbol">=</span><span class="normal"> SortedInTemp</span><span class="symbol">;</span>
<span class="normal">		</span><span class="cbracket">}</span>
<span class="normal">	</span><span class="cbracket">}</span>
<span class="normal">	</span><span class="function">assert</span><span class="symbol">(</span><span class="normal">m0 </span><span class="symbol">==</span><span class="normal"> m1</span><span class="symbol">);</span>
<span class="normal">	</span><span class="keyword">if</span><span class="normal"> </span><span class="symbol">(</span><span class="normal">m0 </span><span class="symbol">==</span><span class="normal"> SortedInPlace</span><span class="symbol">)</span><span class="normal"> </span><span class="cbracket">{</span>
<span class="normal">		merge_cache_lcp_2way</span><span class="symbol">&lt;</span><span class="normal">OutputLCP</span><span class="symbol">&gt;(</span>
<span class="normal">			strings_input</span><span class="symbol">,</span><span class="normal"> lcp_input</span><span class="symbol">,</span><span class="normal"> cache_input</span><span class="symbol">,</span><span class="normal"> split0</span><span class="symbol">,</span>
<span class="normal">			strings_input</span><span class="symbol">+</span><span class="normal">split0</span><span class="symbol">,</span><span class="normal"> lcp_input</span><span class="symbol">+</span><span class="normal">split0</span><span class="symbol">,</span><span class="normal"> cache_input</span><span class="symbol">+</span><span class="normal">split0</span><span class="symbol">,</span><span class="normal"> n</span><span class="symbol">-</span><span class="normal">split0</span><span class="symbol">,</span>
<span class="normal">			strings_output</span><span class="symbol">,</span><span class="normal"> lcp_output</span><span class="symbol">,</span><span class="normal"> cache_output</span><span class="symbol">);</span>
<span class="normal">		</span><span class="keyword">return</span><span class="normal"> SortedInTemp</span><span class="symbol">;</span>
<span class="normal">	</span><span class="cbracket">}</span><span class="normal"> </span><span class="keyword">else</span><span class="normal"> </span><span class="cbracket">{</span>
<span class="normal">		merge_cache_lcp_2way</span><span class="symbol">&lt;</span><span class="normal">OutputLCP</span><span class="symbol">&gt;(</span>
<span class="normal">			strings_output</span><span class="symbol">,</span><span class="normal"> lcp_output</span><span class="symbol">,</span><span class="normal"> cache_output</span><span class="symbol">,</span><span class="normal"> split0</span><span class="symbol">,</span>
<span class="normal">			strings_output</span><span class="symbol">+</span><span class="normal">split0</span><span class="symbol">,</span><span class="normal"> lcp_output</span><span class="symbol">+</span><span class="normal">split0</span><span class="symbol">,</span><span class="normal"> cache_output</span><span class="symbol">+</span><span class="normal">split0</span><span class="symbol">,</span><span class="normal"> n</span><span class="symbol">-</span><span class="normal">split0</span><span class="symbol">,</span>
<span class="normal">			strings_input</span><span class="symbol">,</span><span class="normal"> lcp_input</span><span class="symbol">,</span><span class="normal"> cache_input</span><span class="symbol">);</span>
<span class="normal">		</span><span class="keyword">return</span><span class="normal"> SortedInPlace</span><span class="symbol">;</span>
<span class="normal">	</span><span class="cbracket">}</span>
<span class="cbracket">}</span>

<span class="keyword">template</span><span class="normal"> </span><span class="symbol">&lt;</span><span class="keyword">typename</span><span class="normal"> </span><span class="classname">CharT</span><span class="symbol">&gt;</span>
<span class="keyword">static</span><span class="normal"> </span><span class="type">void</span>
<span class="function">mergesort_cache_lcp_2way</span><span class="symbol">(</span><span class="type">unsigned</span><span class="normal"> </span><span class="type">char</span><span class="symbol">**</span><span class="normal"> strings</span><span class="symbol">,</span><span class="normal"> </span><span class="usertype">size_t</span><span class="normal"> n</span><span class="symbol">)</span>
<span class="cbracket">{</span>
<span class="normal">	lcp_t</span><span class="symbol">*</span><span class="normal"> lcp_input </span><span class="symbol">=</span><span class="normal"> </span><span class="symbol">(</span><span class="normal">lcp_t</span><span class="symbol">*)</span><span class="normal"> </span><span class="function">malloc</span><span class="symbol">(</span><span class="normal">n</span><span class="symbol">*</span><span class="keyword">sizeof</span><span class="symbol">(</span><span class="normal">lcp_t</span><span class="symbol">));</span>
<span class="normal">	lcp_t</span><span class="symbol">*</span><span class="normal"> lcp_tmp   </span><span class="symbol">=</span><span class="normal"> </span><span class="symbol">(</span><span class="normal">lcp_t</span><span class="symbol">*)</span><span class="normal"> </span><span class="function">malloc</span><span class="symbol">(</span><span class="normal">n</span><span class="symbol">*</span><span class="keyword">sizeof</span><span class="symbol">(</span><span class="normal">lcp_t</span><span class="symbol">));</span>
<span class="normal">	</span><span class="type">unsigned</span><span class="normal"> </span><span class="type">char</span><span class="symbol">**</span><span class="normal"> input_tmp </span><span class="symbol">=</span><span class="normal"> </span><span class="symbol">(</span><span class="type">unsigned</span><span class="normal"> </span><span class="type">char</span><span class="symbol">**)</span><span class="normal"> </span><span class="function">malloc</span><span class="symbol">(</span><span class="normal">n</span><span class="symbol">*</span><span class="keyword">sizeof</span><span class="symbol">(</span><span class="type">unsigned</span><span class="normal"> </span><span class="type">char</span><span class="symbol">*));</span>
<span class="normal">	CharT</span><span class="symbol">*</span><span class="normal"> cache     </span><span class="symbol">=</span><span class="normal"> </span><span class="symbol">(</span><span class="normal">CharT</span><span class="symbol">*)</span><span class="normal"> </span><span class="function">malloc</span><span class="symbol">(</span><span class="normal">n</span><span class="symbol">*</span><span class="keyword">sizeof</span><span class="symbol">(</span><span class="normal">CharT</span><span class="symbol">));</span>
<span class="normal">	CharT</span><span class="symbol">*</span><span class="normal"> cache_tmp </span><span class="symbol">=</span><span class="normal"> </span><span class="symbol">(</span><span class="normal">CharT</span><span class="symbol">*)</span><span class="normal"> </span><span class="function">malloc</span><span class="symbol">(</span><span class="normal">n</span><span class="symbol">*</span><span class="keyword">sizeof</span><span class="symbol">(</span><span class="normal">CharT</span><span class="symbol">));</span>
<span class="normal">	</span><span class="usertype">MergeResult</span><span class="normal"> m </span><span class="symbol">=</span><span class="normal"> mergesort_cache_lcp_2way</span><span class="symbol">&lt;</span><span class="keyword">false</span><span class="symbol">&gt;(</span><span class="normal">strings</span><span class="symbol">,</span><span class="normal"> input_tmp</span><span class="symbol">,</span>
<span class="normal">			lcp_input</span><span class="symbol">,</span><span class="normal"> lcp_tmp</span><span class="symbol">,</span><span class="normal"> cache</span><span class="symbol">,</span><span class="normal"> cache_tmp</span><span class="symbol">,</span><span class="normal"> n</span><span class="symbol">);</span>
<span class="normal">	</span><span class="keyword">if</span><span class="normal"> </span><span class="symbol">(</span><span class="normal">m </span><span class="symbol">==</span><span class="normal"> SortedInTemp</span><span class="symbol">)</span><span class="normal"> </span><span class="cbracket">{</span>
<span class="normal">		</span><span class="function">memcpy</span><span class="symbol">(</span><span class="normal">strings</span><span class="symbol">,</span><span class="normal"> input_tmp</span><span class="symbol">,</span><span class="normal"> n</span><span class="symbol">*</span><span class="keyword">sizeof</span><span class="symbol">(</span><span class="type">unsigned</span><span class="normal"> </span><span class="type">char</span><span class="symbol">*));</span>
<span class="normal">	</span><span class="cbracket">}</span>
<span class="normal">	</span><span class="function">free</span><span class="symbol">(</span><span class="normal">lcp_input</span><span class="symbol">);</span>
<span class="normal">	</span><span class="function">free</span><span class="symbol">(</span><span class="normal">lcp_tmp</span><span class="symbol">);</span>
<span class="normal">	</span><span class="function">free</span><span class="symbol">(</span><span class="normal">input_tmp</span><span class="symbol">);</span>
<span class="normal">	</span><span class="function">free</span><span class="symbol">(</span><span class="normal">cache</span><span class="symbol">);</span>
<span class="normal">	</span><span class="function">free</span><span class="symbol">(</span><span class="normal">cache_tmp</span><span class="symbol">);</span>
<span class="normal">	</span><span class="function">stat_print</span><span class="symbol">();</span>
<span class="cbracket">}</span>

<span class="type">void</span><span class="normal"> </span><span class="function">mergesort_cache1_lcp_2way</span><span class="symbol">(</span><span class="type">unsigned</span><span class="normal"> </span><span class="type">char</span><span class="symbol">**</span><span class="normal"> strings</span><span class="symbol">,</span><span class="normal"> </span><span class="usertype">size_t</span><span class="normal"> n</span><span class="symbol">)</span>
<span class="cbracket">{</span><span class="normal"> mergesort_cache_lcp_2way</span><span class="symbol">&lt;</span><span class="type">unsigned</span><span class="normal"> </span><span class="type">char</span><span class="symbol">&gt;(</span><span class="normal">strings</span><span class="symbol">,</span><span class="normal"> n</span><span class="symbol">);</span><span class="normal"> </span><span class="cbracket">}</span>
<span class="type">void</span><span class="normal"> </span><span class="function">mergesort_cache2_lcp_2way</span><span class="symbol">(</span><span class="type">unsigned</span><span class="normal"> </span><span class="type">char</span><span class="symbol">**</span><span class="normal"> strings</span><span class="symbol">,</span><span class="normal"> </span><span class="usertype">size_t</span><span class="normal"> n</span><span class="symbol">)</span>
<span class="cbracket">{</span><span class="normal"> mergesort_cache_lcp_2way</span><span class="symbol">&lt;</span><span class="normal">uint16_t</span><span class="symbol">&gt;(</span><span class="normal">strings</span><span class="symbol">,</span><span class="normal"> n</span><span class="symbol">);</span><span class="normal"> </span><span class="cbracket">}</span>
<span class="type">void</span><span class="normal"> </span><span class="function">mergesort_cache4_lcp_2way</span><span class="symbol">(</span><span class="type">unsigned</span><span class="normal"> </span><span class="type">char</span><span class="symbol">**</span><span class="normal"> strings</span><span class="symbol">,</span><span class="normal"> </span><span class="usertype">size_t</span><span class="normal"> n</span><span class="symbol">)</span>
<span class="cbracket">{</span><span class="normal"> mergesort_cache_lcp_2way</span><span class="symbol">&lt;</span><span class="normal">uint32_t</span><span class="symbol">&gt;(</span><span class="normal">strings</span><span class="symbol">,</span><span class="normal"> n</span><span class="symbol">);</span><span class="normal"> </span><span class="cbracket">}</span>

<span class="function">CONTESTANT_REGISTER</span><span class="symbol">(</span><span class="normal">mergesort_cache1_lcp_2way</span><span class="symbol">,</span>
<span class="normal">                    </span><span class="string">"rantala/mergesort_cache1_lcp_2way"</span><span class="symbol">,</span>
<span class="normal">                    </span><span class="string">"mergesort LCP with 2way merger and 1byte cache"</span><span class="symbol">)</span>
<span class="function">CONTESTANT_REGISTER</span><span class="symbol">(</span><span class="normal">mergesort_cache2_lcp_2way</span><span class="symbol">,</span>
<span class="normal">                    </span><span class="string">"rantala/mergesort_cache2_lcp_2way"</span><span class="symbol">,</span>
<span class="normal">                    </span><span class="string">"mergesort LCP with 2way merger and 2byte cache"</span><span class="symbol">)</span>
<span class="function">CONTESTANT_REGISTER</span><span class="symbol">(</span><span class="normal">mergesort_cache4_lcp_2way</span><span class="symbol">,</span>
<span class="normal">                    </span><span class="string">"rantala/mergesort_cache4_lcp_2way"</span><span class="symbol">,</span>
<span class="normal">                    </span><span class="string">"mergesort LCP with 2way merger and 4byte cache"</span><span class="symbol">)</span>

<span class="keyword">template</span><span class="normal"> </span><span class="symbol">&lt;</span><span class="type">bool</span><span class="normal"> OutputLCP</span><span class="symbol">,</span><span class="normal"> </span><span class="keyword">typename</span><span class="normal"> </span><span class="classname">CharT</span><span class="symbol">&gt;</span>
<span class="normal">MergeResult</span>
<span class="function">mergesort_cache_lcp_2way_parallel</span><span class="symbol">(</span>
<span class="normal">              </span><span class="type">unsigned</span><span class="normal"> </span><span class="type">char</span><span class="symbol">**</span><span class="normal"> strings_input</span><span class="symbol">,</span><span class="normal"> </span><span class="type">unsigned</span><span class="normal"> </span><span class="type">char</span><span class="symbol">**</span><span class="normal"> strings_output</span><span class="symbol">,</span>
<span class="normal">              lcp_t</span><span class="symbol">*</span><span class="normal"> </span><span class="usertype">restrict</span><span class="normal"> lcp_input</span><span class="symbol">,</span><span class="normal"> lcp_t</span><span class="symbol">*</span><span class="normal"> </span><span class="usertype">restrict</span><span class="normal"> lcp_output</span><span class="symbol">,</span>
<span class="normal">              CharT</span><span class="symbol">*</span><span class="normal"> </span><span class="usertype">restrict</span><span class="normal"> cache_input</span><span class="symbol">,</span><span class="normal"> CharT</span><span class="symbol">*</span><span class="normal"> </span><span class="usertype">restrict</span><span class="normal"> cache_output</span><span class="symbol">,</span>
<span class="normal">              </span><span class="usertype">size_t</span><span class="normal"> n</span><span class="symbol">)</span>
<span class="cbracket">{</span>
<span class="normal">	</span><span class="function">debug</span><span class="symbol">()</span><span class="normal"> </span><span class="symbol">&lt;&lt;</span><span class="normal"> __func__ </span><span class="symbol">&lt;&lt;</span><span class="normal"> </span><span class="string">"(): n="</span><span class="normal"> </span><span class="symbol">&lt;&lt;</span><span class="normal"> n </span><span class="symbol">&lt;&lt;</span><span class="normal"> </span><span class="string">'</span><span class="specialchar">\n</span><span class="string">'</span><span class="symbol">;</span>
<span class="normal">	</span><span class="keyword">if</span><span class="normal"> </span><span class="symbol">(</span><span class="normal">n </span><span class="symbol">&lt;</span><span class="normal"> </span><span class="number">32</span><span class="symbol">)</span><span class="normal"> </span><span class="cbracket">{</span>
<span class="normal">		</span><span class="function">insertion_sort</span><span class="symbol">(</span><span class="normal">strings_input</span><span class="symbol">,</span><span class="normal"> n</span><span class="symbol">,</span><span class="normal"> </span><span class="number">0</span><span class="symbol">);</span>
<span class="normal">		lcp_input</span><span class="symbol">[</span><span class="number">0</span><span class="symbol">]</span><span class="normal"> </span><span class="symbol">=</span><span class="normal"> </span><span class="function">lcp</span><span class="symbol">(</span><span class="normal">strings_input</span><span class="symbol">[</span><span class="number">0</span><span class="symbol">],</span><span class="normal"> strings_input</span><span class="symbol">[</span><span class="number">1</span><span class="symbol">]);</span>
<span class="normal">		cache_input</span><span class="symbol">[</span><span class="number">0</span><span class="symbol">]</span><span class="normal"> </span><span class="symbol">=</span><span class="normal"> get_char</span><span class="symbol">&lt;</span><span class="normal">CharT</span><span class="symbol">&gt;(</span><span class="normal">strings_input</span><span class="symbol">[</span><span class="number">0</span><span class="symbol">],</span><span class="normal"> </span><span class="number">0</span><span class="symbol">);</span>
<span class="normal">		</span><span class="keyword">for</span><span class="normal"> </span><span class="symbol">(</span><span class="type">unsigned</span><span class="normal"> i</span><span class="symbol">=</span><span class="number">1</span><span class="symbol">;</span><span class="normal"> i </span><span class="symbol">&lt;</span><span class="normal"> n</span><span class="symbol">-</span><span class="number">1</span><span class="symbol">;</span><span class="normal"> </span><span class="symbol">++</span><span class="normal">i</span><span class="symbol">)</span><span class="normal"> </span><span class="cbracket">{</span>
<span class="normal">			lcp_input</span><span class="symbol">[</span><span class="normal">i</span><span class="symbol">]</span><span class="normal"> </span><span class="symbol">=</span><span class="normal"> </span><span class="function">lcp</span><span class="symbol">(</span><span class="normal">strings_input</span><span class="symbol">[</span><span class="normal">i</span><span class="symbol">],</span><span class="normal"> strings_input</span><span class="symbol">[</span><span class="normal">i</span><span class="symbol">+</span><span class="number">1</span><span class="symbol">]);</span>
<span class="normal">			cache_input</span><span class="symbol">[</span><span class="normal">i</span><span class="symbol">]</span><span class="normal"> </span><span class="symbol">=</span><span class="normal"> get_char</span><span class="symbol">&lt;</span><span class="normal">CharT</span><span class="symbol">&gt;(</span><span class="normal">strings_input</span><span class="symbol">[</span><span class="normal">i</span><span class="symbol">],</span><span class="normal"> lcp_input</span><span class="symbol">[</span><span class="normal">i</span><span class="symbol">-</span><span class="number">1</span><span class="symbol">]);</span>
<span class="normal">		</span><span class="cbracket">}</span>
<span class="normal">		cache_input</span><span class="symbol">[</span><span class="normal">n</span><span class="symbol">-</span><span class="number">1</span><span class="symbol">]</span><span class="normal"> </span><span class="symbol">=</span><span class="normal"> get_char</span><span class="symbol">&lt;</span><span class="normal">CharT</span><span class="symbol">&gt;(</span><span class="normal">strings_input</span><span class="symbol">[</span><span class="normal">n</span><span class="symbol">-</span><span class="number">1</span><span class="symbol">],</span><span class="normal"> lcp_input</span><span class="symbol">[</span><span class="normal">n</span><span class="symbol">-</span><span class="number">2</span><span class="symbol">]);</span>
<span class="normal">		</span><span class="function">check_input</span><span class="symbol">(</span><span class="normal">strings_input</span><span class="symbol">,</span><span class="normal"> lcp_input</span><span class="symbol">,</span><span class="normal"> cache_input</span><span class="symbol">,</span><span class="normal"> n</span><span class="symbol">);</span>
<span class="normal">		</span><span class="keyword">return</span><span class="normal"> SortedInPlace</span><span class="symbol">;</span>
<span class="normal">	</span><span class="cbracket">}</span>
<span class="normal">	</span><span class="keyword">const</span><span class="normal"> </span><span class="usertype">size_t</span><span class="normal"> split0 </span><span class="symbol">=</span><span class="normal"> n</span><span class="symbol">/</span><span class="number">2</span><span class="symbol">;</span>
<span class="normal">	</span><span class="usertype">MergeResult</span><span class="normal"> m0</span><span class="symbol">,</span><span class="normal"> m1</span><span class="symbol">;</span>
<span class="normal">	m0 </span><span class="symbol">=</span><span class="normal"> mergesort_cache_lcp_2way_parallel</span><span class="symbol">&lt;</span><span class="keyword">true</span><span class="symbol">&gt;(</span>
<span class="normal">			strings_input</span><span class="symbol">,</span><span class="normal"> strings_output</span><span class="symbol">,</span>
<span class="normal">			lcp_input</span><span class="symbol">,</span><span class="normal"> lcp_output</span><span class="symbol">,</span>
<span class="normal">			cache_input</span><span class="symbol">,</span><span class="normal"> cache_output</span><span class="symbol">,</span>
<span class="normal">			split0</span><span class="symbol">);</span>

<span class="normal">	</span><span class="keyword">if</span><span class="normal"> </span><span class="symbol">(</span><span class="normal">m0</span><span class="symbol">==</span><span class="normal">SortedInPlace</span><span class="symbol">)</span><span class="normal"> </span><span class="function">check_input</span><span class="symbol">(</span><span class="normal">strings_input</span><span class="symbol">,</span><span class="normal"> lcp_input</span><span class="symbol">,</span><span class="normal"> cache_input</span><span class="symbol">,</span><span class="normal"> split0</span><span class="symbol">);</span>
<span class="normal">	</span><span class="keyword">else</span><span class="normal">                   </span><span class="function">check_input</span><span class="symbol">(</span><span class="normal">strings_output</span><span class="symbol">,</span><span class="normal"> lcp_output</span><span class="symbol">,</span><span class="normal"> cache_output</span><span class="symbol">,</span><span class="normal"> split0</span><span class="symbol">);</span>

<span class="normal">	m1 </span><span class="symbol">=</span><span class="normal"> mergesort_cache_lcp_2way_parallel</span><span class="symbol">&lt;</span><span class="keyword">true</span><span class="symbol">&gt;(</span>
<span class="normal">			strings_input</span><span class="symbol">+</span><span class="normal">split0</span><span class="symbol">,</span><span class="normal"> strings_output</span><span class="symbol">+</span><span class="normal">split0</span><span class="symbol">,</span>
<span class="normal">			lcp_input</span><span class="symbol">+</span><span class="normal">split0</span><span class="symbol">,</span><span class="normal"> lcp_output</span><span class="symbol">+</span><span class="normal">split0</span><span class="symbol">,</span>
<span class="normal">			cache_input</span><span class="symbol">+</span><span class="normal">split0</span><span class="symbol">,</span><span class="normal"> cache_output</span><span class="symbol">+</span><span class="normal">split0</span><span class="symbol">,</span>
<span class="normal">			n</span><span class="symbol">-</span><span class="normal">split0</span><span class="symbol">);</span>

<span class="normal">	</span><span class="keyword">if</span><span class="normal"> </span><span class="symbol">(</span><span class="normal">m0</span><span class="symbol">==</span><span class="normal">SortedInPlace</span><span class="symbol">)</span><span class="normal"> </span><span class="function">check_input</span><span class="symbol">(</span><span class="normal">strings_input</span><span class="symbol">+</span><span class="normal">split0</span><span class="symbol">,</span><span class="normal"> lcp_input</span><span class="symbol">+</span><span class="normal">split0</span><span class="symbol">,</span><span class="normal"> cache_input</span><span class="symbol">+</span><span class="normal">split0</span><span class="symbol">,</span><span class="normal"> n</span><span class="symbol">-</span><span class="normal">split0</span><span class="symbol">);</span>
<span class="normal">	</span><span class="keyword">else</span><span class="normal">                   </span><span class="function">check_input</span><span class="symbol">(</span><span class="normal">strings_output</span><span class="symbol">+</span><span class="normal">split0</span><span class="symbol">,</span><span class="normal"> lcp_output</span><span class="symbol">+</span><span class="normal">split0</span><span class="symbol">,</span><span class="normal"> cache_output</span><span class="symbol">+</span><span class="normal">split0</span><span class="symbol">,</span><span class="normal"> n</span><span class="symbol">-</span><span class="normal">split0</span><span class="symbol">);</span>

<span class="normal">	</span><span class="keyword">if</span><span class="normal"> </span><span class="symbol">(</span><span class="normal">m0 </span><span class="symbol">!=</span><span class="normal"> m1</span><span class="symbol">)</span><span class="normal"> </span><span class="cbracket">{</span>
<span class="normal">		</span><span class="function">debug</span><span class="symbol">()</span><span class="normal"> </span><span class="symbol">&lt;&lt;</span><span class="normal"> </span><span class="string">"Warning: extra copying due to m0 != m1. n="</span><span class="symbol">&lt;&lt;</span><span class="normal">n</span><span class="symbol">&lt;&lt;</span><span class="string">"</span><span class="specialchar">\n</span><span class="string">"</span><span class="symbol">;</span>
<span class="normal">		</span><span class="keyword">if</span><span class="normal"> </span><span class="symbol">(</span><span class="normal">m0 </span><span class="symbol">==</span><span class="normal"> SortedInPlace</span><span class="symbol">)</span><span class="normal"> </span><span class="cbracket">{</span>
<span class="normal">			std</span><span class="symbol">::</span><span class="function">copy</span><span class="symbol">(</span><span class="normal">strings_input</span><span class="symbol">,</span><span class="normal"> strings_input</span><span class="symbol">+</span><span class="normal">split0</span><span class="symbol">,</span>
<span class="normal">					strings_output</span><span class="symbol">);</span>
<span class="normal">			std</span><span class="symbol">::</span><span class="function">copy</span><span class="symbol">(</span><span class="normal">cache_input</span><span class="symbol">,</span><span class="normal"> cache_input</span><span class="symbol">+</span><span class="normal">split0</span><span class="symbol">,</span>
<span class="normal">					cache_output</span><span class="symbol">);</span>
<span class="normal">			std</span><span class="symbol">::</span><span class="function">copy</span><span class="symbol">(</span><span class="normal">lcp_input</span><span class="symbol">,</span><span class="normal"> lcp_input</span><span class="symbol">+</span><span class="normal">split0</span><span class="symbol">,</span>
<span class="normal">					lcp_output</span><span class="symbol">);</span>
<span class="normal">			m0 </span><span class="symbol">=</span><span class="normal"> SortedInTemp</span><span class="symbol">;</span>
<span class="normal">		</span><span class="cbracket">}</span><span class="normal"> </span><span class="keyword">else</span><span class="normal"> </span><span class="cbracket">{</span>
<span class="normal">			std</span><span class="symbol">::</span><span class="function">copy</span><span class="symbol">(</span><span class="normal">strings_output</span><span class="symbol">,</span><span class="normal"> strings_output</span><span class="symbol">+</span><span class="normal">split0</span><span class="symbol">,</span>
<span class="normal">					strings_input</span><span class="symbol">);</span>
<span class="normal">			std</span><span class="symbol">::</span><span class="function">copy</span><span class="symbol">(</span><span class="normal">cache_output</span><span class="symbol">,</span><span class="normal"> cache_output</span><span class="symbol">+</span><span class="normal">split0</span><span class="symbol">,</span>
<span class="normal">					cache_input</span><span class="symbol">);</span>
<span class="normal">			std</span><span class="symbol">::</span><span class="function">copy</span><span class="symbol">(</span><span class="normal">lcp_output</span><span class="symbol">,</span><span class="normal"> lcp_output</span><span class="symbol">+</span><span class="normal">split0</span><span class="symbol">,</span>
<span class="normal">					lcp_input</span><span class="symbol">);</span>
<span class="normal">			m1 </span><span class="symbol">=</span><span class="normal"> SortedInTemp</span><span class="symbol">;</span>
<span class="normal">		</span><span class="cbracket">}</span>
<span class="normal">	</span><span class="cbracket">}</span>
<span class="normal">	</span><span class="function">assert</span><span class="symbol">(</span><span class="normal">m0 </span><span class="symbol">==</span><span class="normal"> m1</span><span class="symbol">);</span>
<span class="normal">	</span><span class="keyword">if</span><span class="normal"> </span><span class="symbol">(</span><span class="normal">m0 </span><span class="symbol">==</span><span class="normal"> SortedInPlace</span><span class="symbol">)</span><span class="normal"> </span><span class="cbracket">{</span>
<span class="normal">		merge_cache_lcp_2way</span><span class="symbol">&lt;</span><span class="normal">OutputLCP</span><span class="symbol">&gt;(</span>
<span class="normal">			strings_input</span><span class="symbol">,</span><span class="normal"> lcp_input</span><span class="symbol">,</span><span class="normal"> cache_input</span><span class="symbol">,</span><span class="normal"> split0</span><span class="symbol">,</span>
<span class="normal">			strings_input</span><span class="symbol">+</span><span class="normal">split0</span><span class="symbol">,</span><span class="normal"> lcp_input</span><span class="symbol">+</span><span class="normal">split0</span><span class="symbol">,</span><span class="normal"> cache_input</span><span class="symbol">+</span><span class="normal">split0</span><span class="symbol">,</span><span class="normal"> n</span><span class="symbol">-</span><span class="normal">split0</span><span class="symbol">,</span>
<span class="normal">			strings_output</span><span class="symbol">,</span><span class="normal"> lcp_output</span><span class="symbol">,</span><span class="normal"> cache_output</span><span class="symbol">);</span>
<span class="normal">		</span><span class="keyword">return</span><span class="normal"> SortedInTemp</span><span class="symbol">;</span>
<span class="normal">	</span><span class="cbracket">}</span><span class="normal"> </span><span class="keyword">else</span><span class="normal"> </span><span class="cbracket">{</span>
<span class="normal">		merge_cache_lcp_2way</span><span class="symbol">&lt;</span><span class="normal">OutputLCP</span><span class="symbol">&gt;(</span>
<span class="normal">			strings_output</span><span class="symbol">,</span><span class="normal"> lcp_output</span><span class="symbol">,</span><span class="normal"> cache_output</span><span class="symbol">,</span><span class="normal"> split0</span><span class="symbol">,</span>
<span class="normal">			strings_output</span><span class="symbol">+</span><span class="normal">split0</span><span class="symbol">,</span><span class="normal"> lcp_output</span><span class="symbol">+</span><span class="normal">split0</span><span class="symbol">,</span><span class="normal"> cache_output</span><span class="symbol">+</span><span class="normal">split0</span><span class="symbol">,</span><span class="normal"> n</span><span class="symbol">-</span><span class="normal">split0</span><span class="symbol">,</span>
<span class="normal">			strings_input</span><span class="symbol">,</span><span class="normal"> lcp_input</span><span class="symbol">,</span><span class="normal"> cache_input</span><span class="symbol">);</span>
<span class="normal">		</span><span class="keyword">return</span><span class="normal"> SortedInPlace</span><span class="symbol">;</span>
<span class="normal">	</span><span class="cbracket">}</span>
<span class="cbracket">}</span>

<span class="keyword">template</span><span class="normal"> </span><span class="symbol">&lt;</span><span class="keyword">typename</span><span class="normal"> </span><span class="classname">CharT</span><span class="symbol">&gt;</span>
<span class="keyword">static</span><span class="normal"> </span><span class="type">void</span>
<span class="function">mergesort_cache_lcp_2way_parallel</span><span class="symbol">(</span><span class="type">unsigned</span><span class="normal"> </span><span class="type">char</span><span class="symbol">**</span><span class="normal"> strings</span><span class="symbol">,</span><span class="normal"> </span><span class="usertype">size_t</span><span class="normal"> n</span><span class="symbol">)</span>
<span class="cbracket">{</span>
<span class="normal">	lcp_t</span><span class="symbol">*</span><span class="normal"> lcp_input </span><span class="symbol">=</span><span class="normal"> </span><span class="symbol">(</span><span class="normal">lcp_t</span><span class="symbol">*)</span><span class="normal"> </span><span class="function">malloc</span><span class="symbol">(</span><span class="normal">n</span><span class="symbol">*</span><span class="keyword">sizeof</span><span class="symbol">(</span><span class="normal">lcp_t</span><span class="symbol">));</span>
<span class="normal">	lcp_t</span><span class="symbol">*</span><span class="normal"> lcp_tmp   </span><span class="symbol">=</span><span class="normal"> </span><span class="symbol">(</span><span class="normal">lcp_t</span><span class="symbol">*)</span><span class="normal"> </span><span class="function">malloc</span><span class="symbol">(</span><span class="normal">n</span><span class="symbol">*</span><span class="keyword">sizeof</span><span class="symbol">(</span><span class="normal">lcp_t</span><span class="symbol">));</span>
<span class="normal">	</span><span class="type">unsigned</span><span class="normal"> </span><span class="type">char</span><span class="symbol">**</span><span class="normal"> input_tmp </span><span class="symbol">=</span><span class="normal"> </span><span class="symbol">(</span><span class="type">unsigned</span><span class="normal"> </span><span class="type">char</span><span class="symbol">**)</span><span class="normal"> </span><span class="function">malloc</span><span class="symbol">(</span><span class="normal">n</span><span class="symbol">*</span><span class="keyword">sizeof</span><span class="symbol">(</span><span class="type">unsigned</span><span class="normal"> </span><span class="type">char</span><span class="symbol">*));</span>
<span class="normal">	CharT</span><span class="symbol">*</span><span class="normal"> cache     </span><span class="symbol">=</span><span class="normal"> </span><span class="symbol">(</span><span class="normal">CharT</span><span class="symbol">*)</span><span class="normal"> </span><span class="function">malloc</span><span class="symbol">(</span><span class="normal">n</span><span class="symbol">*</span><span class="keyword">sizeof</span><span class="symbol">(</span><span class="normal">CharT</span><span class="symbol">));</span>
<span class="normal">	CharT</span><span class="symbol">*</span><span class="normal"> cache_tmp </span><span class="symbol">=</span><span class="normal"> </span><span class="symbol">(</span><span class="normal">CharT</span><span class="symbol">*)</span><span class="normal"> </span><span class="function">malloc</span><span class="symbol">(</span><span class="normal">n</span><span class="symbol">*</span><span class="keyword">sizeof</span><span class="symbol">(</span><span class="normal">CharT</span><span class="symbol">));</span>
<span class="normal">	</span><span class="usertype">MergeResult</span><span class="normal"> m </span><span class="symbol">=</span><span class="normal"> mergesort_cache_lcp_2way_parallel</span><span class="symbol">&lt;</span><span class="keyword">false</span><span class="symbol">&gt;(</span><span class="normal">strings</span><span class="symbol">,</span><span class="normal"> input_tmp</span><span class="symbol">,</span>
<span class="normal">			lcp_input</span><span class="symbol">,</span><span class="normal"> lcp_tmp</span><span class="symbol">,</span><span class="normal"> cache</span><span class="symbol">,</span><span class="normal"> cache_tmp</span><span class="symbol">,</span><span class="normal"> n</span><span class="symbol">);</span>
<span class="normal">	</span><span class="keyword">if</span><span class="normal"> </span><span class="symbol">(</span><span class="normal">m </span><span class="symbol">==</span><span class="normal"> SortedInTemp</span><span class="symbol">)</span><span class="normal"> </span><span class="cbracket">{</span>
<span class="normal">		</span><span class="function">memcpy</span><span class="symbol">(</span><span class="normal">strings</span><span class="symbol">,</span><span class="normal"> input_tmp</span><span class="symbol">,</span><span class="normal"> n</span><span class="symbol">*</span><span class="keyword">sizeof</span><span class="symbol">(</span><span class="type">unsigned</span><span class="normal"> </span><span class="type">char</span><span class="symbol">*));</span>
<span class="normal">	</span><span class="cbracket">}</span>
<span class="normal">	</span><span class="function">free</span><span class="symbol">(</span><span class="normal">lcp_input</span><span class="symbol">);</span>
<span class="normal">	</span><span class="function">free</span><span class="symbol">(</span><span class="normal">lcp_tmp</span><span class="symbol">);</span>
<span class="normal">	</span><span class="function">free</span><span class="symbol">(</span><span class="normal">input_tmp</span><span class="symbol">);</span>
<span class="normal">	</span><span class="function">free</span><span class="symbol">(</span><span class="normal">cache</span><span class="symbol">);</span>
<span class="normal">	</span><span class="function">free</span><span class="symbol">(</span><span class="normal">cache_tmp</span><span class="symbol">);</span>
<span class="normal">	</span><span class="function">stat_print</span><span class="symbol">();</span>
<span class="cbracket">}</span>

<span class="type">void</span><span class="normal"> </span><span class="function">mergesort_cache1_lcp_2way_parallel</span><span class="symbol">(</span><span class="type">unsigned</span><span class="normal"> </span><span class="type">char</span><span class="symbol">**</span><span class="normal"> strings</span><span class="symbol">,</span><span class="normal"> </span><span class="usertype">size_t</span><span class="normal"> n</span><span class="symbol">)</span>
<span class="cbracket">{</span><span class="normal"> mergesort_cache_lcp_2way_parallel</span><span class="symbol">&lt;</span><span class="type">unsigned</span><span class="normal"> </span><span class="type">char</span><span class="symbol">&gt;(</span><span class="normal">strings</span><span class="symbol">,</span><span class="normal"> n</span><span class="symbol">);</span><span class="normal"> </span><span class="cbracket">}</span>
<span class="type">void</span><span class="normal"> </span><span class="function">mergesort_cache2_lcp_2way_parallel</span><span class="symbol">(</span><span class="type">unsigned</span><span class="normal"> </span><span class="type">char</span><span class="symbol">**</span><span class="normal"> strings</span><span class="symbol">,</span><span class="normal"> </span><span class="usertype">size_t</span><span class="normal"> n</span><span class="symbol">)</span>
<span class="cbracket">{</span><span class="normal"> mergesort_cache_lcp_2way_parallel</span><span class="symbol">&lt;</span><span class="normal">uint16_t</span><span class="symbol">&gt;(</span><span class="normal">strings</span><span class="symbol">,</span><span class="normal"> n</span><span class="symbol">);</span><span class="normal"> </span><span class="cbracket">}</span>
<span class="type">void</span><span class="normal"> </span><span class="function">mergesort_cache4_lcp_2way_parallel</span><span class="symbol">(</span><span class="type">unsigned</span><span class="normal"> </span><span class="type">char</span><span class="symbol">**</span><span class="normal"> strings</span><span class="symbol">,</span><span class="normal"> </span><span class="usertype">size_t</span><span class="normal"> n</span><span class="symbol">)</span>
<span class="cbracket">{</span><span class="normal"> mergesort_cache_lcp_2way_parallel</span><span class="symbol">&lt;</span><span class="normal">uint32_t</span><span class="symbol">&gt;(</span><span class="normal">strings</span><span class="symbol">,</span><span class="normal"> n</span><span class="symbol">);</span><span class="normal"> </span><span class="cbracket">}</span>

<span class="function">CONTESTANT_REGISTER_PARALLEL</span><span class="symbol">(</span><span class="normal">mergesort_cache1_lcp_2way_parallel</span><span class="symbol">,</span>
<span class="normal">                             </span><span class="string">"rantala/mergesort_cache1_lcp_2way_parallel"</span><span class="symbol">,</span>
<span class="normal">                             </span><span class="string">"mergesort_parallel LCP with 2way merger and 1byte cache"</span><span class="symbol">)</span>
<span class="function">CONTESTANT_REGISTER_PARALLEL</span><span class="symbol">(</span><span class="normal">mergesort_cache2_lcp_2way_parallel</span><span class="symbol">,</span>
<span class="normal">                             </span><span class="string">"rantala/mergesort_cache2_lcp_2way_parallel"</span><span class="symbol">,</span>
<span class="normal">                             </span><span class="string">"mergesort_parallel LCP with 2way merger and 2byte cache"</span><span class="symbol">)</span>
<span class="function">CONTESTANT_REGISTER_PARALLEL</span><span class="symbol">(</span><span class="normal">mergesort_cache4_lcp_2way_parallel</span><span class="symbol">,</span>
<span class="normal">                             </span><span class="string">"rantala/mergesort_cache4_lcp_2way_parallel"</span><span class="symbol">,</span>
<span class="normal">                             </span><span class="string">"mergesort_parallel LCP with 2way merger and 4byte cache"</span><span class="symbol">)</span>

<span class="comment">/*******************************************************************************</span>
<span class="comment"> *</span>
<span class="comment"> * mergesort_lcp_2way_unstable</span>
<span class="comment"> *</span>
<span class="comment"> ******************************************************************************/</span>

<span class="keyword">static</span><span class="normal"> </span><span class="type">void</span>
<span class="function">check_lcps</span><span class="symbol">(</span><span class="type">unsigned</span><span class="normal"> </span><span class="type">char</span><span class="symbol">*</span><span class="normal"> latest</span><span class="symbol">,</span>
<span class="normal">           </span><span class="type">unsigned</span><span class="normal"> </span><span class="type">char</span><span class="symbol">*</span><span class="normal"> from0</span><span class="symbol">,</span><span class="normal"> </span><span class="usertype">lcp_t</span><span class="normal"> lcp0</span><span class="symbol">,</span>
<span class="normal">           </span><span class="type">unsigned</span><span class="normal"> </span><span class="type">char</span><span class="symbol">*</span><span class="normal"> from1</span><span class="symbol">,</span><span class="normal"> </span><span class="usertype">lcp_t</span><span class="normal"> lcp1</span><span class="symbol">)</span>
<span class="cbracket">{</span>
<span class="normal">	</span><span class="function">debug</span><span class="symbol">()&lt;&lt;</span><span class="string">"******** CHECK ********</span><span class="specialchar">\n</span><span class="string">"</span>
<span class="normal">	       </span><span class="symbol">&lt;&lt;</span><span class="string">"Latest: '"</span><span class="symbol">&lt;&lt;</span><span class="normal">latest</span><span class="symbol">&lt;&lt;</span><span class="string">"'</span><span class="specialchar">\n</span><span class="string">"</span>
<span class="normal">	       </span><span class="symbol">&lt;&lt;</span><span class="string">"     0: '"</span><span class="symbol">&lt;&lt;</span><span class="normal">from0</span><span class="symbol">&lt;&lt;</span><span class="string">"', lcp="</span><span class="symbol">&lt;&lt;</span><span class="normal">lcp0</span><span class="symbol">&lt;&lt;</span><span class="string">"</span><span class="specialchar">\n</span><span class="string">"</span>
<span class="normal">	       </span><span class="symbol">&lt;&lt;</span><span class="string">"     1: '"</span><span class="symbol">&lt;&lt;</span><span class="normal">from1</span><span class="symbol">&lt;&lt;</span><span class="string">"', lcp="</span><span class="symbol">&lt;&lt;</span><span class="normal">lcp1</span><span class="symbol">&lt;&lt;</span><span class="string">"</span><span class="specialchar">\n</span><span class="string">"</span>
<span class="normal">	       </span><span class="symbol">&lt;&lt;</span><span class="string">"***********************</span><span class="specialchar">\n</span><span class="string">"</span><span class="symbol">;</span>
<span class="normal">	</span><span class="function">assert</span><span class="symbol">(</span><span class="function">lcp</span><span class="symbol">(</span><span class="normal">latest</span><span class="symbol">,</span><span class="normal"> from0</span><span class="symbol">)</span><span class="normal"> </span><span class="symbol">==</span><span class="normal"> lcp0</span><span class="symbol">);</span>
<span class="normal">	</span><span class="function">assert</span><span class="symbol">(</span><span class="function">lcp</span><span class="symbol">(</span><span class="normal">latest</span><span class="symbol">,</span><span class="normal"> from1</span><span class="symbol">)</span><span class="normal"> </span><span class="symbol">==</span><span class="normal"> lcp1</span><span class="symbol">);</span>
<span class="cbracket">}</span>

<span class="keyword">template</span><span class="normal"> </span><span class="symbol">&lt;</span><span class="type">bool</span><span class="normal"> OutputLCP</span><span class="symbol">&gt;</span>
<span class="keyword">static</span><span class="normal"> </span><span class="type">void</span>
<span class="function">merge_lcp_2way_unstable</span><span class="symbol">(</span>
<span class="normal">               </span><span class="type">unsigned</span><span class="normal"> </span><span class="type">char</span><span class="symbol">**</span><span class="normal"> from0</span><span class="symbol">,</span><span class="normal">  lcp_t</span><span class="symbol">*</span><span class="normal"> </span><span class="usertype">restrict</span><span class="normal"> lcp_input0</span><span class="symbol">,</span><span class="normal"> </span><span class="usertype">size_t</span><span class="normal"> n0</span><span class="symbol">,</span>
<span class="normal">               </span><span class="type">unsigned</span><span class="normal"> </span><span class="type">char</span><span class="symbol">**</span><span class="normal"> from1</span><span class="symbol">,</span><span class="normal">  lcp_t</span><span class="symbol">*</span><span class="normal"> </span><span class="usertype">restrict</span><span class="normal"> lcp_input1</span><span class="symbol">,</span><span class="normal"> </span><span class="usertype">size_t</span><span class="normal"> n1</span><span class="symbol">,</span>
<span class="normal">               </span><span class="type">unsigned</span><span class="normal"> </span><span class="type">char</span><span class="symbol">**</span><span class="normal"> result</span><span class="symbol">,</span><span class="normal"> lcp_t</span><span class="symbol">*</span><span class="normal"> </span><span class="usertype">restrict</span><span class="normal"> lcp_result</span><span class="symbol">)</span>
<span class="cbracket">{</span>
<span class="normal">	</span><span class="function">debug</span><span class="symbol">()</span><span class="normal"> </span><span class="symbol">&lt;&lt;</span><span class="normal"> __func__ </span><span class="symbol">&lt;&lt;</span><span class="normal"> </span><span class="string">"(): n0="</span><span class="normal"> </span><span class="symbol">&lt;&lt;</span><span class="normal"> n0 </span><span class="symbol">&lt;&lt;</span><span class="normal"> </span><span class="string">", n1="</span><span class="normal"> </span><span class="symbol">&lt;&lt;</span><span class="normal"> n1 </span><span class="symbol">&lt;&lt;</span><span class="normal"> </span><span class="string">'</span><span class="specialchar">\n</span><span class="string">'</span><span class="symbol">;</span>
<span class="normal">	</span><span class="function">check_input</span><span class="symbol">(</span><span class="normal">from0</span><span class="symbol">,</span><span class="normal"> lcp_input0</span><span class="symbol">,</span><span class="normal"> n0</span><span class="symbol">);</span>
<span class="normal">	</span><span class="function">check_input</span><span class="symbol">(</span><span class="normal">from1</span><span class="symbol">,</span><span class="normal"> lcp_input1</span><span class="symbol">,</span><span class="normal"> n1</span><span class="symbol">);</span>
<span class="normal">	</span><span class="keyword">register</span><span class="normal"> </span><span class="usertype">lcp_t</span><span class="normal"> lcp0</span><span class="symbol">=</span><span class="number">0</span><span class="symbol">,</span><span class="normal"> lcp1</span><span class="symbol">=</span><span class="number">0</span><span class="symbol">;</span>
<span class="normal">	</span><span class="type">int</span><span class="normal"> cmp01</span><span class="symbol">;</span><span class="normal"> </span><span class="usertype">lcp_t</span><span class="normal"> lcp01</span><span class="symbol">;</span>
<span class="normal">	boost</span><span class="symbol">::</span><span class="function">tie</span><span class="symbol">(</span><span class="normal">cmp01</span><span class="symbol">,</span><span class="normal"> lcp01</span><span class="symbol">)</span><span class="normal"> </span><span class="symbol">=</span><span class="normal"> </span><span class="function">compare</span><span class="symbol">(*</span><span class="normal">from0</span><span class="symbol">,</span><span class="normal"> </span><span class="symbol">*</span><span class="normal">from1</span><span class="symbol">);</span>
<span class="normal">	</span><span class="keyword">if</span><span class="normal"> </span><span class="symbol">(</span><span class="normal">cmp01 </span><span class="symbol">&lt;=</span><span class="normal"> </span><span class="number">0</span><span class="symbol">)</span><span class="normal"> </span><span class="cbracket">{</span>
<span class="normal">		</span><span class="symbol">*</span><span class="normal">result</span><span class="symbol">++</span><span class="normal"> </span><span class="symbol">=</span><span class="normal"> </span><span class="symbol">*</span><span class="normal">from0</span><span class="symbol">++;</span>
<span class="normal">		lcp0 </span><span class="symbol">=</span><span class="normal"> </span><span class="symbol">*</span><span class="normal">lcp_input0</span><span class="symbol">++;</span>
<span class="normal">		lcp1 </span><span class="symbol">=</span><span class="normal"> lcp01</span><span class="symbol">;</span>
<span class="normal">		</span><span class="keyword">if</span><span class="normal"> </span><span class="symbol">(--</span><span class="normal">n0 </span><span class="symbol">==</span><span class="normal"> </span><span class="number">0</span><span class="symbol">)</span><span class="normal"> </span><span class="keyword">goto</span><span class="normal"> finish0</span><span class="symbol">;</span>
<span class="normal">	</span><span class="cbracket">}</span><span class="normal"> </span><span class="keyword">else</span><span class="normal"> </span><span class="cbracket">{</span>
<span class="normal">		</span><span class="symbol">*</span><span class="normal">result</span><span class="symbol">++</span><span class="normal"> </span><span class="symbol">=</span><span class="normal"> </span><span class="symbol">*</span><span class="normal">from1</span><span class="symbol">++;</span>
<span class="normal">		lcp1 </span><span class="symbol">=</span><span class="normal"> </span><span class="symbol">*</span><span class="normal">lcp_input1</span><span class="symbol">++;</span>
<span class="normal">		lcp0 </span><span class="symbol">=</span><span class="normal"> lcp01</span><span class="symbol">;</span>
<span class="normal">		</span><span class="keyword">if</span><span class="normal"> </span><span class="symbol">(--</span><span class="normal">n1 </span><span class="symbol">==</span><span class="normal"> </span><span class="number">0</span><span class="symbol">)</span><span class="normal"> </span><span class="keyword">goto</span><span class="normal"> finish1</span><span class="symbol">;</span>
<span class="normal">	</span><span class="cbracket">}</span>
<span class="normal">	</span><span class="keyword">while</span><span class="normal"> </span><span class="symbol">(</span><span class="keyword">true</span><span class="symbol">)</span><span class="normal"> </span><span class="cbracket">{</span>
<span class="normal">		</span><span class="function">debug</span><span class="symbol">()</span><span class="normal"> </span><span class="symbol">&lt;&lt;</span><span class="normal"> </span><span class="string">"Starting loop, n0="</span><span class="symbol">&lt;&lt;</span><span class="normal">n0</span><span class="symbol">&lt;&lt;</span><span class="string">", n1="</span><span class="symbol">&lt;&lt;</span><span class="normal">n1</span><span class="symbol">&lt;&lt;</span><span class="string">" ...</span><span class="specialchar">\n</span><span class="string">"</span>
<span class="normal">		        </span><span class="symbol">&lt;&lt;</span><span class="normal"> </span><span class="string">"</span><span class="specialchar">\t</span><span class="string">prev  = '"</span><span class="normal"> </span><span class="symbol">&lt;&lt;*(</span><span class="normal">result</span><span class="symbol">-</span><span class="number">1</span><span class="symbol">)&lt;&lt;</span><span class="string">"'</span><span class="specialchar">\n</span><span class="string">"</span>
<span class="normal">		        </span><span class="symbol">&lt;&lt;</span><span class="normal"> </span><span class="string">"</span><span class="specialchar">\t</span><span class="string">from0 = '"</span><span class="symbol">&lt;&lt;*</span><span class="normal">from0</span><span class="symbol">&lt;&lt;</span><span class="string">"'</span><span class="specialchar">\n</span><span class="string">"</span>
<span class="normal">		        </span><span class="symbol">&lt;&lt;</span><span class="normal"> </span><span class="string">"</span><span class="specialchar">\t</span><span class="string">from1 = '"</span><span class="symbol">&lt;&lt;*</span><span class="normal">from1</span><span class="symbol">&lt;&lt;</span><span class="string">"'</span><span class="specialchar">\n</span><span class="string">"</span>
<span class="normal">		        </span><span class="symbol">&lt;&lt;</span><span class="normal"> </span><span class="string">"</span><span class="specialchar">\t</span><span class="string">lcp0  = "</span><span class="normal"> </span><span class="symbol">&lt;&lt;</span><span class="normal"> lcp0 </span><span class="symbol">&lt;&lt;</span><span class="normal"> </span><span class="string">"</span><span class="specialchar">\n</span><span class="string">"</span>
<span class="normal">		        </span><span class="symbol">&lt;&lt;</span><span class="normal"> </span><span class="string">"</span><span class="specialchar">\t</span><span class="string">lcp1  = "</span><span class="normal"> </span><span class="symbol">&lt;&lt;</span><span class="normal"> lcp1 </span><span class="symbol">&lt;&lt;</span><span class="normal"> </span><span class="string">"</span><span class="specialchar">\n</span><span class="string">"</span>
<span class="normal">		        </span><span class="symbol">&lt;&lt;</span><span class="normal"> </span><span class="string">"</span><span class="specialchar">\n</span><span class="string">"</span><span class="symbol">;</span>
<span class="normal">		</span><span class="function">check_lcps</span><span class="symbol">(*(</span><span class="normal">result</span><span class="symbol">-</span><span class="number">1</span><span class="symbol">),*</span><span class="normal">from0</span><span class="symbol">,</span><span class="normal">lcp0</span><span class="symbol">,*</span><span class="normal">from1</span><span class="symbol">,</span><span class="normal">lcp1</span><span class="symbol">);</span>
<span class="normal">		</span><span class="keyword">if</span><span class="normal"> </span><span class="symbol">(</span><span class="normal">lcp0 </span><span class="symbol">&gt;</span><span class="normal"> lcp1</span><span class="symbol">)</span><span class="normal"> </span><span class="cbracket">{</span>
<span class="normal">			</span><span class="function">assert</span><span class="symbol">(</span><span class="function">cmp</span><span class="symbol">(*</span><span class="normal">from0</span><span class="symbol">,</span><span class="normal"> </span><span class="symbol">*</span><span class="normal">from1</span><span class="symbol">)</span><span class="normal"> </span><span class="symbol">&lt;</span><span class="normal"> </span><span class="number">0</span><span class="symbol">);</span>
<span class="normal">			</span><span class="symbol">*</span><span class="normal">result</span><span class="symbol">++</span><span class="normal"> </span><span class="symbol">=</span><span class="normal"> </span><span class="symbol">*</span><span class="normal">from0</span><span class="symbol">++;</span>
<span class="normal">			</span><span class="keyword">if</span><span class="normal"> </span><span class="symbol">(</span><span class="normal">OutputLCP</span><span class="symbol">)</span><span class="normal"> </span><span class="symbol">*</span><span class="normal">lcp_result</span><span class="symbol">++</span><span class="normal"> </span><span class="symbol">=</span><span class="normal"> lcp0</span><span class="symbol">;</span>
<span class="normal">			lcp0 </span><span class="symbol">=</span><span class="normal"> </span><span class="symbol">*</span><span class="normal">lcp_input0</span><span class="symbol">++;</span>
<span class="normal">			</span><span class="keyword">if</span><span class="normal"> </span><span class="symbol">(--</span><span class="normal">n0 </span><span class="symbol">==</span><span class="normal"> </span><span class="number">0</span><span class="symbol">)</span><span class="normal"> </span><span class="keyword">goto</span><span class="normal"> finish0</span><span class="symbol">;</span>
<span class="normal">		</span><span class="cbracket">}</span><span class="normal"> </span><span class="keyword">else</span><span class="normal"> </span><span class="keyword">if</span><span class="normal"> </span><span class="symbol">(</span><span class="normal">lcp0 </span><span class="symbol">&lt;</span><span class="normal"> lcp1</span><span class="symbol">)</span><span class="normal"> </span><span class="cbracket">{</span>
<span class="normal">			</span><span class="function">assert</span><span class="symbol">(</span><span class="function">cmp</span><span class="symbol">(*</span><span class="normal">from0</span><span class="symbol">,</span><span class="normal"> </span><span class="symbol">*</span><span class="normal">from1</span><span class="symbol">)</span><span class="normal"> </span><span class="symbol">&gt;</span><span class="normal"> </span><span class="number">0</span><span class="symbol">);</span>
<span class="normal">			</span><span class="symbol">*</span><span class="normal">result</span><span class="symbol">++</span><span class="normal"> </span><span class="symbol">=</span><span class="normal"> </span><span class="symbol">*</span><span class="normal">from1</span><span class="symbol">++;</span>
<span class="normal">			</span><span class="keyword">if</span><span class="normal"> </span><span class="symbol">(</span><span class="normal">OutputLCP</span><span class="symbol">)</span><span class="normal"> </span><span class="symbol">*</span><span class="normal">lcp_result</span><span class="symbol">++</span><span class="normal"> </span><span class="symbol">=</span><span class="normal"> lcp1</span><span class="symbol">;</span>
<span class="normal">			lcp1 </span><span class="symbol">=</span><span class="normal"> </span><span class="symbol">*</span><span class="normal">lcp_input1</span><span class="symbol">++;</span>
<span class="normal">			</span><span class="keyword">if</span><span class="normal"> </span><span class="symbol">(--</span><span class="normal">n1 </span><span class="symbol">==</span><span class="normal"> </span><span class="number">0</span><span class="symbol">)</span><span class="normal"> </span><span class="keyword">goto</span><span class="normal"> finish1</span><span class="symbol">;</span>
<span class="normal">		</span><span class="cbracket">}</span><span class="normal"> </span><span class="keyword">else</span><span class="normal"> </span><span class="cbracket">{</span>
<span class="normal">			</span><span class="type">int</span><span class="normal"> cmp01</span><span class="symbol">;</span><span class="normal"> </span><span class="usertype">lcp_t</span><span class="normal"> lcp01</span><span class="symbol">;</span>
<span class="normal">			boost</span><span class="symbol">::</span><span class="function">tie</span><span class="symbol">(</span><span class="normal">cmp01</span><span class="symbol">,</span><span class="normal">lcp01</span><span class="symbol">)</span><span class="normal"> </span><span class="symbol">=</span><span class="normal"> </span><span class="function">compare</span><span class="symbol">(*</span><span class="normal">from0</span><span class="symbol">,</span><span class="normal"> </span><span class="symbol">*</span><span class="normal">from1</span><span class="symbol">,</span><span class="normal"> lcp0</span><span class="symbol">);</span>
<span class="normal">			</span><span class="keyword">if</span><span class="normal"> </span><span class="symbol">(</span><span class="normal">cmp01 </span><span class="symbol">&lt;</span><span class="normal"> </span><span class="number">0</span><span class="symbol">)</span><span class="normal"> </span><span class="cbracket">{</span>
<span class="normal">				</span><span class="symbol">*</span><span class="normal">result</span><span class="symbol">++</span><span class="normal"> </span><span class="symbol">=</span><span class="normal"> </span><span class="symbol">*</span><span class="normal">from0</span><span class="symbol">++;</span>
<span class="normal">				</span><span class="keyword">if</span><span class="normal"> </span><span class="symbol">(</span><span class="normal">OutputLCP</span><span class="symbol">)</span><span class="normal"> </span><span class="symbol">*</span><span class="normal">lcp_result</span><span class="symbol">++</span><span class="normal"> </span><span class="symbol">=</span><span class="normal"> lcp0</span><span class="symbol">;</span>
<span class="normal">				lcp1 </span><span class="symbol">=</span><span class="normal"> lcp01</span><span class="symbol">;</span>
<span class="normal">				</span><span class="keyword">if</span><span class="normal"> </span><span class="symbol">(--</span><span class="normal">n0 </span><span class="symbol">==</span><span class="normal"> </span><span class="number">0</span><span class="symbol">)</span><span class="normal"> </span><span class="keyword">goto</span><span class="normal"> finish0</span><span class="symbol">;</span>
<span class="normal">				lcp0 </span><span class="symbol">=</span><span class="normal"> </span><span class="symbol">*</span><span class="normal">lcp_input0</span><span class="symbol">++;</span>
<span class="normal">			</span><span class="cbracket">}</span><span class="normal"> </span><span class="keyword">else</span><span class="normal"> </span><span class="keyword">if</span><span class="normal"> </span><span class="symbol">(</span><span class="normal">cmp01 </span><span class="symbol">==</span><span class="normal"> </span><span class="number">0</span><span class="symbol">)</span><span class="normal"> </span><span class="cbracket">{</span>
<span class="normal">				</span><span class="function">assert</span><span class="symbol">(</span><span class="function">cmp</span><span class="symbol">(*</span><span class="normal">from0</span><span class="symbol">,</span><span class="normal"> </span><span class="symbol">*</span><span class="normal">from1</span><span class="symbol">)==</span><span class="number">0</span><span class="symbol">);</span>
<span class="normal">				</span><span class="function">assert</span><span class="symbol">(</span><span class="normal">n0</span><span class="symbol">);</span><span class="normal"> </span><span class="function">assert</span><span class="symbol">(</span><span class="normal">n1</span><span class="symbol">);</span>
<span class="normal">				</span><span class="keyword">if</span><span class="normal"> </span><span class="symbol">(</span><span class="normal">OutputLCP</span><span class="symbol">)</span><span class="normal"> </span><span class="symbol">*</span><span class="normal">lcp_result</span><span class="symbol">++</span><span class="normal"> </span><span class="symbol">=</span><span class="normal"> lcp0</span><span class="symbol">;</span>
<span class="normal">				</span><span class="keyword">if</span><span class="normal"> </span><span class="symbol">(</span><span class="normal">OutputLCP</span><span class="symbol">)</span><span class="normal"> </span><span class="symbol">*</span><span class="normal">lcp_result</span><span class="symbol">++</span><span class="normal"> </span><span class="symbol">=</span><span class="normal"> lcp01</span><span class="symbol">;</span>
<span class="normal">				</span><span class="symbol">*</span><span class="normal">result</span><span class="symbol">++</span><span class="normal"> </span><span class="symbol">=</span><span class="normal"> </span><span class="symbol">*</span><span class="normal">from0</span><span class="symbol">++;</span>
<span class="normal">				</span><span class="symbol">*</span><span class="normal">result</span><span class="symbol">++</span><span class="normal"> </span><span class="symbol">=</span><span class="normal"> </span><span class="symbol">*</span><span class="normal">from1</span><span class="symbol">++;</span>
<span class="normal">				</span><span class="symbol">--</span><span class="normal">n0</span><span class="symbol">;</span>
<span class="normal">				</span><span class="symbol">--</span><span class="normal">n1</span><span class="symbol">;</span>
<span class="normal">				lcp0 </span><span class="symbol">=</span><span class="normal"> </span><span class="symbol">*</span><span class="normal">lcp_input0</span><span class="symbol">++;</span>
<span class="normal">				lcp1 </span><span class="symbol">=</span><span class="normal"> </span><span class="symbol">*</span><span class="normal">lcp_input1</span><span class="symbol">++;</span>
<span class="normal">				</span><span class="keyword">if</span><span class="normal"> </span><span class="symbol">(</span><span class="normal">n0 </span><span class="symbol">==</span><span class="normal"> </span><span class="number">0</span><span class="symbol">)</span><span class="normal"> </span><span class="keyword">goto</span><span class="normal"> finish0</span><span class="symbol">;</span>
<span class="normal">				</span><span class="keyword">if</span><span class="normal"> </span><span class="symbol">(</span><span class="normal">n1 </span><span class="symbol">==</span><span class="normal"> </span><span class="number">0</span><span class="symbol">)</span><span class="normal"> </span><span class="keyword">goto</span><span class="normal"> finish1</span><span class="symbol">;</span>
<span class="normal">			</span><span class="cbracket">}</span><span class="normal"> </span><span class="keyword">else</span><span class="normal"> </span><span class="cbracket">{</span>
<span class="normal">				</span><span class="symbol">*</span><span class="normal">result</span><span class="symbol">++</span><span class="normal"> </span><span class="symbol">=</span><span class="normal"> </span><span class="symbol">*</span><span class="normal">from1</span><span class="symbol">++;</span>
<span class="normal">				</span><span class="keyword">if</span><span class="normal"> </span><span class="symbol">(</span><span class="normal">OutputLCP</span><span class="symbol">)</span><span class="normal"> </span><span class="symbol">*</span><span class="normal">lcp_result</span><span class="symbol">++</span><span class="normal"> </span><span class="symbol">=</span><span class="normal"> lcp0</span><span class="symbol">;</span>
<span class="normal">				lcp0 </span><span class="symbol">=</span><span class="normal"> lcp01</span><span class="symbol">;</span>
<span class="normal">				</span><span class="keyword">if</span><span class="normal"> </span><span class="symbol">(--</span><span class="normal">n1 </span><span class="symbol">==</span><span class="normal"> </span><span class="number">0</span><span class="symbol">)</span><span class="normal"> </span><span class="keyword">goto</span><span class="normal"> finish1</span><span class="symbol">;</span>
<span class="normal">				lcp1 </span><span class="symbol">=</span><span class="normal"> </span><span class="symbol">*</span><span class="normal">lcp_input1</span><span class="symbol">++;</span>
<span class="normal">			</span><span class="cbracket">}</span>
<span class="normal">		</span><span class="cbracket">}</span>
<span class="normal">	</span><span class="cbracket">}</span>
<span class="label">finish0:</span>
<span class="normal">	</span><span class="function">debug</span><span class="symbol">()</span><span class="normal"> </span><span class="symbol">&lt;&lt;</span><span class="normal"> </span><span class="string">'~'</span><span class="normal"> </span><span class="symbol">&lt;&lt;</span><span class="normal"> __func__ </span><span class="symbol">&lt;&lt;</span><span class="normal"> </span><span class="string">"(): n0="</span><span class="normal"> </span><span class="symbol">&lt;&lt;</span><span class="normal"> n0 </span><span class="symbol">&lt;&lt;</span><span class="normal"> </span><span class="string">", n1="</span><span class="normal"> </span><span class="symbol">&lt;&lt;</span><span class="normal"> n1 </span><span class="symbol">&lt;&lt;</span><span class="normal"> </span><span class="string">'</span><span class="specialchar">\n</span><span class="string">'</span><span class="symbol">;</span>
<span class="normal">	</span><span class="function">assert</span><span class="symbol">(</span><span class="usertype">not</span><span class="normal"> n0</span><span class="symbol">);</span>
<span class="normal">	</span><span class="keyword">if</span><span class="normal"> </span><span class="symbol">(</span><span class="normal">n1</span><span class="symbol">)</span><span class="normal"> </span><span class="cbracket">{</span>
<span class="normal">		std</span><span class="symbol">::</span><span class="function">copy</span><span class="symbol">(</span><span class="normal">from1</span><span class="symbol">,</span><span class="normal"> from1</span><span class="symbol">+</span><span class="normal">n1</span><span class="symbol">,</span><span class="normal"> result</span><span class="symbol">);</span>
<span class="normal">		</span><span class="keyword">if</span><span class="normal"> </span><span class="symbol">(</span><span class="normal">OutputLCP</span><span class="symbol">)</span><span class="normal"> </span><span class="symbol">*</span><span class="normal">lcp_result</span><span class="symbol">++</span><span class="normal"> </span><span class="symbol">=</span><span class="normal"> lcp1</span><span class="symbol">;</span>
<span class="normal">		</span><span class="keyword">if</span><span class="normal"> </span><span class="symbol">(</span><span class="normal">OutputLCP</span><span class="symbol">)</span><span class="normal"> std</span><span class="symbol">::</span><span class="function">copy</span><span class="symbol">(</span><span class="normal">lcp_input1</span><span class="symbol">,</span><span class="normal"> lcp_input1</span><span class="symbol">+</span><span class="normal">n1</span><span class="symbol">,</span><span class="normal"> lcp_result</span><span class="symbol">);</span>
<span class="normal">	</span><span class="cbracket">}</span>
<span class="normal">	</span><span class="keyword">return</span><span class="symbol">;</span>
<span class="label">finish1:</span>
<span class="normal">	</span><span class="function">debug</span><span class="symbol">()</span><span class="normal"> </span><span class="symbol">&lt;&lt;</span><span class="normal"> </span><span class="string">'~'</span><span class="normal"> </span><span class="symbol">&lt;&lt;</span><span class="normal"> __func__ </span><span class="symbol">&lt;&lt;</span><span class="normal"> </span><span class="string">"(): n0="</span><span class="normal"> </span><span class="symbol">&lt;&lt;</span><span class="normal"> n0 </span><span class="symbol">&lt;&lt;</span><span class="normal"> </span><span class="string">", n1="</span><span class="normal"> </span><span class="symbol">&lt;&lt;</span><span class="normal"> n1 </span><span class="symbol">&lt;&lt;</span><span class="normal"> </span><span class="string">'</span><span class="specialchar">\n</span><span class="string">'</span><span class="symbol">;</span>
<span class="normal">	</span><span class="function">assert</span><span class="symbol">(</span><span class="usertype">not</span><span class="normal"> n1</span><span class="symbol">);</span>
<span class="normal">	</span><span class="keyword">if</span><span class="normal"> </span><span class="symbol">(</span><span class="normal">n0</span><span class="symbol">)</span><span class="normal"> </span><span class="cbracket">{</span>
<span class="normal">		std</span><span class="symbol">::</span><span class="function">copy</span><span class="symbol">(</span><span class="normal">from0</span><span class="symbol">,</span><span class="normal"> from0</span><span class="symbol">+</span><span class="normal">n0</span><span class="symbol">,</span><span class="normal"> result</span><span class="symbol">);</span>
<span class="normal">		</span><span class="keyword">if</span><span class="normal"> </span><span class="symbol">(</span><span class="normal">OutputLCP</span><span class="symbol">)</span><span class="normal"> </span><span class="symbol">*</span><span class="normal">lcp_result</span><span class="symbol">++</span><span class="normal"> </span><span class="symbol">=</span><span class="normal"> lcp0</span><span class="symbol">;</span>
<span class="normal">		</span><span class="keyword">if</span><span class="normal"> </span><span class="symbol">(</span><span class="normal">OutputLCP</span><span class="symbol">)</span><span class="normal"> std</span><span class="symbol">::</span><span class="function">copy</span><span class="symbol">(</span><span class="normal">lcp_input0</span><span class="symbol">,</span><span class="normal"> lcp_input0</span><span class="symbol">+</span><span class="normal">n0</span><span class="symbol">,</span><span class="normal"> lcp_result</span><span class="symbol">);</span>
<span class="normal">	</span><span class="cbracket">}</span>
<span class="normal">	</span><span class="keyword">return</span><span class="symbol">;</span>
<span class="cbracket">}</span>

<span class="keyword">template</span><span class="normal"> </span><span class="symbol">&lt;</span><span class="type">bool</span><span class="normal"> OutputLCP</span><span class="symbol">&gt;</span>
<span class="normal">MergeResult</span>
<span class="function">mergesort_lcp_2way_unstable</span><span class="symbol">(</span><span class="type">unsigned</span><span class="normal"> </span><span class="type">char</span><span class="symbol">**</span><span class="normal"> </span><span class="usertype">restrict</span><span class="normal"> strings_input</span><span class="symbol">,</span>
<span class="normal">                            </span><span class="type">unsigned</span><span class="normal"> </span><span class="type">char</span><span class="symbol">**</span><span class="normal"> </span><span class="usertype">restrict</span><span class="normal"> strings_output</span><span class="symbol">,</span>
<span class="normal">                            lcp_t</span><span class="symbol">*</span><span class="normal"> </span><span class="usertype">restrict</span><span class="normal"> lcp_input</span><span class="symbol">,</span>
<span class="normal">                            lcp_t</span><span class="symbol">*</span><span class="normal"> </span><span class="usertype">restrict</span><span class="normal"> lcp_output</span><span class="symbol">,</span>
<span class="normal">                            </span><span class="usertype">size_t</span><span class="normal"> n</span><span class="symbol">)</span>
<span class="cbracket">{</span>
<span class="normal">	</span><span class="function">debug</span><span class="symbol">()</span><span class="normal"> </span><span class="symbol">&lt;&lt;</span><span class="normal"> __func__ </span><span class="symbol">&lt;&lt;</span><span class="normal"> </span><span class="string">"(): n="</span><span class="normal"> </span><span class="symbol">&lt;&lt;</span><span class="normal"> n </span><span class="symbol">&lt;&lt;</span><span class="normal"> </span><span class="string">'</span><span class="specialchar">\n</span><span class="string">'</span><span class="symbol">;</span>
<span class="normal">	</span><span class="keyword">if</span><span class="normal"> </span><span class="symbol">(</span><span class="normal">n </span><span class="symbol">&lt;</span><span class="normal"> </span><span class="number">32</span><span class="symbol">)</span><span class="normal"> </span><span class="cbracket">{</span>
<span class="normal">		</span><span class="function">insertion_sort</span><span class="symbol">(</span><span class="normal">strings_input</span><span class="symbol">,</span><span class="normal"> n</span><span class="symbol">,</span><span class="normal"> </span><span class="number">0</span><span class="symbol">);</span>
<span class="normal">		</span><span class="keyword">for</span><span class="normal"> </span><span class="symbol">(</span><span class="type">unsigned</span><span class="normal"> i</span><span class="symbol">=</span><span class="number">0</span><span class="symbol">;</span><span class="normal"> i </span><span class="symbol">&lt;</span><span class="normal"> n</span><span class="symbol">-</span><span class="number">1</span><span class="symbol">;</span><span class="normal"> </span><span class="symbol">++</span><span class="normal">i</span><span class="symbol">)</span>
<span class="normal">			lcp_input</span><span class="symbol">[</span><span class="normal">i</span><span class="symbol">]</span><span class="normal"> </span><span class="symbol">=</span><span class="normal"> </span><span class="function">lcp</span><span class="symbol">(</span><span class="normal">strings_input</span><span class="symbol">[</span><span class="normal">i</span><span class="symbol">],</span><span class="normal"> strings_input</span><span class="symbol">[</span><span class="normal">i</span><span class="symbol">+</span><span class="number">1</span><span class="symbol">]);</span>
<span class="normal">		</span><span class="keyword">return</span><span class="normal"> SortedInPlace</span><span class="symbol">;</span>
<span class="normal">	</span><span class="cbracket">}</span>
<span class="normal">	</span><span class="keyword">const</span><span class="normal"> </span><span class="usertype">size_t</span><span class="normal"> split0 </span><span class="symbol">=</span><span class="normal"> n</span><span class="symbol">/</span><span class="number">2</span><span class="symbol">;</span>
<span class="normal">	</span><span class="usertype">MergeResult</span><span class="normal"> ml </span><span class="symbol">=</span><span class="normal"> mergesort_lcp_2way_unstable</span><span class="symbol">&lt;</span><span class="keyword">true</span><span class="symbol">&gt;(</span>
<span class="normal">			strings_input</span><span class="symbol">,</span><span class="normal"> strings_output</span><span class="symbol">,</span>
<span class="normal">			lcp_input</span><span class="symbol">,</span><span class="normal">     lcp_output</span><span class="symbol">,</span>
<span class="normal">			split0</span><span class="symbol">);</span>

<span class="normal">	</span><span class="function">debug</span><span class="symbol">()</span><span class="normal"> </span><span class="symbol">&lt;&lt;</span><span class="normal"> __func__ </span><span class="symbol">&lt;&lt;</span><span class="normal"> </span><span class="string">"(): checking first merge</span><span class="specialchar">\n</span><span class="string">"</span><span class="symbol">;</span>
<span class="normal">	</span><span class="keyword">if</span><span class="normal"> </span><span class="symbol">(</span><span class="normal">ml </span><span class="symbol">==</span><span class="normal"> SortedInPlace</span><span class="symbol">)</span><span class="normal"> </span><span class="function">check_input</span><span class="symbol">(</span><span class="normal">strings_input</span><span class="symbol">,</span><span class="normal">  lcp_input</span><span class="symbol">,</span><span class="normal">  split0</span><span class="symbol">);</span>
<span class="normal">	</span><span class="keyword">else</span><span class="normal">                     </span><span class="function">check_input</span><span class="symbol">(</span><span class="normal">strings_output</span><span class="symbol">,</span><span class="normal"> lcp_output</span><span class="symbol">,</span><span class="normal"> split0</span><span class="symbol">);</span>

<span class="normal">	</span><span class="usertype">MergeResult</span><span class="normal"> mr </span><span class="symbol">=</span><span class="normal"> mergesort_lcp_2way_unstable</span><span class="symbol">&lt;</span><span class="keyword">true</span><span class="symbol">&gt;(</span>
<span class="normal">			strings_input</span><span class="symbol">+</span><span class="normal">split0</span><span class="symbol">,</span><span class="normal"> strings_output</span><span class="symbol">+</span><span class="normal">split0</span><span class="symbol">,</span>
<span class="normal">			lcp_input</span><span class="symbol">+</span><span class="normal">split0</span><span class="symbol">,</span><span class="normal">     lcp_output</span><span class="symbol">+</span><span class="normal">split0</span><span class="symbol">,</span>
<span class="normal">			n</span><span class="symbol">-</span><span class="normal">split0</span><span class="symbol">);</span>

<span class="normal">	</span><span class="function">debug</span><span class="symbol">()</span><span class="normal"> </span><span class="symbol">&lt;&lt;</span><span class="normal"> __func__ </span><span class="symbol">&lt;&lt;</span><span class="normal"> </span><span class="string">"(): checking second merge</span><span class="specialchar">\n</span><span class="string">"</span><span class="symbol">;</span>
<span class="normal">	</span><span class="keyword">if</span><span class="normal"> </span><span class="symbol">(</span><span class="normal">mr </span><span class="symbol">==</span><span class="normal"> SortedInPlace</span><span class="symbol">)</span><span class="normal"> </span><span class="function">check_input</span><span class="symbol">(</span><span class="normal">strings_input</span><span class="symbol">+</span><span class="normal">split0</span><span class="symbol">,</span><span class="normal">  lcp_input</span><span class="symbol">+</span><span class="normal">split0</span><span class="symbol">,</span><span class="normal">  n</span><span class="symbol">-</span><span class="normal">split0</span><span class="symbol">);</span>
<span class="normal">	</span><span class="keyword">else</span><span class="normal">                     </span><span class="function">check_input</span><span class="symbol">(</span><span class="normal">strings_output</span><span class="symbol">+</span><span class="normal">split0</span><span class="symbol">,</span><span class="normal"> lcp_output</span><span class="symbol">+</span><span class="normal">split0</span><span class="symbol">,</span><span class="normal"> n</span><span class="symbol">-</span><span class="normal">split0</span><span class="symbol">);</span>

<span class="normal">	</span><span class="keyword">if</span><span class="normal"> </span><span class="symbol">(</span><span class="normal">ml </span><span class="symbol">!=</span><span class="normal"> mr</span><span class="symbol">)</span><span class="normal"> </span><span class="cbracket">{</span>
<span class="normal">		</span><span class="keyword">if</span><span class="normal"> </span><span class="symbol">(</span><span class="normal">ml </span><span class="symbol">==</span><span class="normal"> SortedInPlace</span><span class="symbol">)</span><span class="normal"> </span><span class="cbracket">{</span>
<span class="normal">			std</span><span class="symbol">::</span><span class="function">copy</span><span class="symbol">(</span><span class="normal">strings_output</span><span class="symbol">+</span><span class="normal">split0</span><span class="symbol">,</span><span class="normal"> strings_output</span><span class="symbol">+</span><span class="normal">n</span><span class="symbol">,</span>
<span class="normal">					strings_input</span><span class="symbol">+</span><span class="normal">split0</span><span class="symbol">);</span>
<span class="normal">			std</span><span class="symbol">::</span><span class="function">copy</span><span class="symbol">(</span><span class="normal">lcp_output</span><span class="symbol">+</span><span class="normal">split0</span><span class="symbol">,</span><span class="normal"> lcp_output</span><span class="symbol">+</span><span class="normal">n</span><span class="symbol">,</span>
<span class="normal">					lcp_input</span><span class="symbol">+</span><span class="normal">split0</span><span class="symbol">);</span>
<span class="normal">			mr </span><span class="symbol">=</span><span class="normal"> SortedInPlace</span><span class="symbol">;</span>
<span class="normal">		</span><span class="cbracket">}</span><span class="normal"> </span><span class="keyword">else</span><span class="normal"> </span><span class="cbracket">{</span>
<span class="normal">			</span><span class="function">assert</span><span class="symbol">(</span><span class="number">0</span><span class="symbol">);</span>
<span class="normal">			</span><span class="function">abort</span><span class="symbol">();</span>
<span class="normal">		</span><span class="cbracket">}</span>
<span class="normal">	</span><span class="cbracket">}</span>
<span class="normal">	</span><span class="keyword">if</span><span class="normal"> </span><span class="symbol">(</span><span class="normal">ml </span><span class="symbol">==</span><span class="normal"> SortedInPlace</span><span class="symbol">)</span><span class="normal"> </span><span class="cbracket">{</span>
<span class="normal">		merge_lcp_2way_unstable</span><span class="symbol">&lt;</span><span class="normal">OutputLCP</span><span class="symbol">&gt;(</span>
<span class="normal">		           strings_input</span><span class="symbol">,</span><span class="normal">        lcp_input</span><span class="symbol">,</span><span class="normal">        split0</span><span class="symbol">,</span>
<span class="normal">		           strings_input</span><span class="symbol">+</span><span class="normal">split0</span><span class="symbol">,</span><span class="normal"> lcp_input</span><span class="symbol">+</span><span class="normal">split0</span><span class="symbol">,</span><span class="normal"> n</span><span class="symbol">-</span><span class="normal">split0</span><span class="symbol">,</span>
<span class="normal">		           strings_output</span><span class="symbol">,</span><span class="normal"> lcp_output</span><span class="symbol">);</span>
<span class="normal">		</span><span class="keyword">return</span><span class="normal"> SortedInTemp</span><span class="symbol">;</span>
<span class="normal">	</span><span class="cbracket">}</span><span class="normal"> </span><span class="keyword">else</span><span class="normal"> </span><span class="cbracket">{</span>
<span class="normal">		merge_lcp_2way_unstable</span><span class="symbol">&lt;</span><span class="normal">OutputLCP</span><span class="symbol">&gt;(</span>
<span class="normal">		           strings_output</span><span class="symbol">,</span><span class="normal">        lcp_output</span><span class="symbol">,</span><span class="normal">        split0</span><span class="symbol">,</span>
<span class="normal">		           strings_output</span><span class="symbol">+</span><span class="normal">split0</span><span class="symbol">,</span><span class="normal"> lcp_output</span><span class="symbol">+</span><span class="normal">split0</span><span class="symbol">,</span><span class="normal"> n</span><span class="symbol">-</span><span class="normal">split0</span><span class="symbol">,</span>
<span class="normal">		           strings_input</span><span class="symbol">,</span><span class="normal"> lcp_input</span><span class="symbol">);</span>
<span class="normal">		</span><span class="keyword">return</span><span class="normal"> SortedInPlace</span><span class="symbol">;</span>
<span class="normal">	</span><span class="cbracket">}</span>
<span class="cbracket">}</span>
<span class="type">void</span>
<span class="function">mergesort_lcp_2way_unstable</span><span class="symbol">(</span><span class="type">unsigned</span><span class="normal"> </span><span class="type">char</span><span class="symbol">**</span><span class="normal"> strings</span><span class="symbol">,</span><span class="normal"> </span><span class="usertype">size_t</span><span class="normal"> n</span><span class="symbol">)</span>
<span class="cbracket">{</span>
<span class="normal">	lcp_t</span><span class="symbol">*</span><span class="normal"> lcp_input  </span><span class="symbol">=</span><span class="normal"> </span><span class="keyword">static_cast</span><span class="symbol">&lt;</span><span class="normal">lcp_t</span><span class="symbol">*&gt;(</span><span class="function">malloc</span><span class="symbol">(</span><span class="normal">n</span><span class="symbol">*</span><span class="keyword">sizeof</span><span class="symbol">(</span><span class="normal">lcp_t</span><span class="symbol">)));</span>
<span class="normal">	lcp_t</span><span class="symbol">*</span><span class="normal"> lcp_output </span><span class="symbol">=</span><span class="normal"> </span><span class="keyword">static_cast</span><span class="symbol">&lt;</span><span class="normal">lcp_t</span><span class="symbol">*&gt;(</span><span class="function">malloc</span><span class="symbol">(</span><span class="normal">n</span><span class="symbol">*</span><span class="keyword">sizeof</span><span class="symbol">(</span><span class="normal">lcp_t</span><span class="symbol">)));</span>
<span class="normal">	</span><span class="type">unsigned</span><span class="normal"> </span><span class="type">char</span><span class="symbol">**</span><span class="normal"> tmp </span><span class="symbol">=</span><span class="normal"> </span><span class="keyword">static_cast</span><span class="symbol">&lt;</span><span class="type">unsigned</span><span class="normal"> </span><span class="type">char</span><span class="symbol">**&gt;(</span>
<span class="normal">			</span><span class="function">malloc</span><span class="symbol">(</span><span class="normal">n</span><span class="symbol">*</span><span class="keyword">sizeof</span><span class="symbol">(</span><span class="type">unsigned</span><span class="normal"> </span><span class="type">char</span><span class="symbol">*)));</span>
<span class="normal">	</span><span class="keyword">const</span><span class="normal"> </span><span class="usertype">MergeResult</span><span class="normal"> m </span><span class="symbol">=</span><span class="normal"> mergesort_lcp_2way_unstable</span><span class="symbol">&lt;</span><span class="keyword">false</span><span class="symbol">&gt;(</span><span class="normal">strings</span><span class="symbol">,</span><span class="normal"> tmp</span><span class="symbol">,</span>
<span class="normal">			lcp_input</span><span class="symbol">,</span><span class="normal"> lcp_output</span><span class="symbol">,</span><span class="normal"> n</span><span class="symbol">);</span>
<span class="normal">	</span><span class="keyword">if</span><span class="normal"> </span><span class="symbol">(</span><span class="normal">m </span><span class="symbol">==</span><span class="normal"> SortedInTemp</span><span class="symbol">)</span><span class="normal"> </span><span class="cbracket">{</span>
<span class="normal">		</span><span class="symbol">(</span><span class="type">void</span><span class="symbol">)</span><span class="normal"> </span><span class="function">memcpy</span><span class="symbol">(</span><span class="normal">strings</span><span class="symbol">,</span><span class="normal"> tmp</span><span class="symbol">,</span><span class="normal"> n</span><span class="symbol">*</span><span class="keyword">sizeof</span><span class="symbol">(</span><span class="type">unsigned</span><span class="normal"> </span><span class="type">char</span><span class="symbol">*));</span>
<span class="normal">	</span><span class="cbracket">}</span>
<span class="normal">	</span><span class="function">free</span><span class="symbol">(</span><span class="normal">lcp_input</span><span class="symbol">);</span>
<span class="normal">	</span><span class="function">free</span><span class="symbol">(</span><span class="normal">lcp_output</span><span class="symbol">);</span>
<span class="normal">	</span><span class="function">free</span><span class="symbol">(</span><span class="normal">tmp</span><span class="symbol">);</span>
<span class="cbracket">}</span>
<span class="function">CONTESTANT_REGISTER</span><span class="symbol">(</span><span class="normal">mergesort_lcp_2way_unstable</span><span class="symbol">,</span>
<span class="normal">                    </span><span class="string">"rantala/mergesort_lcp_2way_unstable"</span><span class="symbol">,</span>
<span class="normal">                    </span><span class="string">"mergesort Unstable LCP with 2way merger"</span><span class="symbol">)</span>

<span class="keyword">template</span><span class="normal"> </span><span class="symbol">&lt;</span><span class="type">bool</span><span class="normal"> OutputLCP</span><span class="symbol">&gt;</span>
<span class="normal">MergeResult</span>
<span class="function">mergesort_lcp_2way_unstable_parallel</span><span class="symbol">(</span><span class="type">unsigned</span><span class="normal"> </span><span class="type">char</span><span class="symbol">**</span><span class="normal"> </span><span class="usertype">restrict</span><span class="normal"> strings_input</span><span class="symbol">,</span>
<span class="normal">                            </span><span class="type">unsigned</span><span class="normal"> </span><span class="type">char</span><span class="symbol">**</span><span class="normal"> </span><span class="usertype">restrict</span><span class="normal"> strings_output</span><span class="symbol">,</span>
<span class="normal">                            lcp_t</span><span class="symbol">*</span><span class="normal"> </span><span class="usertype">restrict</span><span class="normal"> lcp_input</span><span class="symbol">,</span>
<span class="normal">                            lcp_t</span><span class="symbol">*</span><span class="normal"> </span><span class="usertype">restrict</span><span class="normal"> lcp_output</span><span class="symbol">,</span>
<span class="normal">                            </span><span class="usertype">size_t</span><span class="normal"> n</span><span class="symbol">)</span>
<span class="cbracket">{</span>
<span class="normal">	</span><span class="function">debug</span><span class="symbol">()</span><span class="normal"> </span><span class="symbol">&lt;&lt;</span><span class="normal"> __func__ </span><span class="symbol">&lt;&lt;</span><span class="normal"> </span><span class="string">"(): n="</span><span class="normal"> </span><span class="symbol">&lt;&lt;</span><span class="normal"> n </span><span class="symbol">&lt;&lt;</span><span class="normal"> </span><span class="string">'</span><span class="specialchar">\n</span><span class="string">'</span><span class="symbol">;</span>
<span class="normal">	</span><span class="keyword">if</span><span class="normal"> </span><span class="symbol">(</span><span class="normal">n </span><span class="symbol">&lt;</span><span class="normal"> </span><span class="number">32</span><span class="symbol">)</span><span class="normal"> </span><span class="cbracket">{</span>
<span class="normal">		</span><span class="function">insertion_sort</span><span class="symbol">(</span><span class="normal">strings_input</span><span class="symbol">,</span><span class="normal"> n</span><span class="symbol">,</span><span class="normal"> </span><span class="number">0</span><span class="symbol">);</span>
<span class="normal">		</span><span class="keyword">for</span><span class="normal"> </span><span class="symbol">(</span><span class="type">unsigned</span><span class="normal"> i</span><span class="symbol">=</span><span class="number">0</span><span class="symbol">;</span><span class="normal"> i </span><span class="symbol">&lt;</span><span class="normal"> n</span><span class="symbol">-</span><span class="number">1</span><span class="symbol">;</span><span class="normal"> </span><span class="symbol">++</span><span class="normal">i</span><span class="symbol">)</span>
<span class="normal">			lcp_input</span><span class="symbol">[</span><span class="normal">i</span><span class="symbol">]</span><span class="normal"> </span><span class="symbol">=</span><span class="normal"> </span><span class="function">lcp</span><span class="symbol">(</span><span class="normal">strings_input</span><span class="symbol">[</span><span class="normal">i</span><span class="symbol">],</span><span class="normal"> strings_input</span><span class="symbol">[</span><span class="normal">i</span><span class="symbol">+</span><span class="number">1</span><span class="symbol">]);</span>
<span class="normal">		</span><span class="keyword">return</span><span class="normal"> SortedInPlace</span><span class="symbol">;</span>
<span class="normal">	</span><span class="cbracket">}</span>
<span class="normal">	</span><span class="keyword">const</span><span class="normal"> </span><span class="usertype">size_t</span><span class="normal"> split0 </span><span class="symbol">=</span><span class="normal"> n</span><span class="symbol">/</span><span class="number">2</span><span class="symbol">;</span>

<span class="normal">	</span><span class="usertype">MergeResult</span><span class="normal"> ml</span><span class="symbol">,</span><span class="normal"> mr</span><span class="symbol">;</span>
<span class="preproc">#pragma</span><span class="normal"> omp </span><span class="usertype">task</span><span class="normal"> </span><span class="function">shared</span><span class="symbol">(</span><span class="normal">ml</span><span class="symbol">)</span>
<span class="normal">	ml </span><span class="symbol">=</span><span class="normal"> mergesort_lcp_2way_unstable_parallel</span><span class="symbol">&lt;</span><span class="keyword">true</span><span class="symbol">&gt;(</span>
<span class="normal">			strings_input</span><span class="symbol">,</span><span class="normal"> strings_output</span><span class="symbol">,</span>
<span class="normal">			lcp_input</span><span class="symbol">,</span><span class="normal">     lcp_output</span><span class="symbol">,</span>
<span class="normal">			split0</span><span class="symbol">);</span>
<span class="preproc">#pragma</span><span class="normal"> omp </span><span class="usertype">task</span><span class="normal"> </span><span class="function">shared</span><span class="symbol">(</span><span class="normal">mr</span><span class="symbol">)</span>
<span class="normal">	mr </span><span class="symbol">=</span><span class="normal"> mergesort_lcp_2way_unstable_parallel</span><span class="symbol">&lt;</span><span class="keyword">true</span><span class="symbol">&gt;(</span>
<span class="normal">			strings_input</span><span class="symbol">+</span><span class="normal">split0</span><span class="symbol">,</span><span class="normal"> strings_output</span><span class="symbol">+</span><span class="normal">split0</span><span class="symbol">,</span>
<span class="normal">			lcp_input</span><span class="symbol">+</span><span class="normal">split0</span><span class="symbol">,</span><span class="normal">     lcp_output</span><span class="symbol">+</span><span class="normal">split0</span><span class="symbol">,</span>
<span class="normal">			n</span><span class="symbol">-</span><span class="normal">split0</span><span class="symbol">);</span>
<span class="preproc">#pragma</span><span class="normal"> omp taskwait</span>

<span class="normal">	</span><span class="keyword">if</span><span class="normal"> </span><span class="symbol">(</span><span class="normal">ml </span><span class="symbol">!=</span><span class="normal"> mr</span><span class="symbol">)</span><span class="normal"> </span><span class="cbracket">{</span>
<span class="normal">		</span><span class="keyword">if</span><span class="normal"> </span><span class="symbol">(</span><span class="normal">ml </span><span class="symbol">==</span><span class="normal"> SortedInPlace</span><span class="symbol">)</span><span class="normal"> </span><span class="cbracket">{</span>
<span class="normal">			std</span><span class="symbol">::</span><span class="function">copy</span><span class="symbol">(</span><span class="normal">strings_output</span><span class="symbol">+</span><span class="normal">split0</span><span class="symbol">,</span><span class="normal"> strings_output</span><span class="symbol">+</span><span class="normal">n</span><span class="symbol">,</span>
<span class="normal">					strings_input</span><span class="symbol">+</span><span class="normal">split0</span><span class="symbol">);</span>
<span class="normal">			std</span><span class="symbol">::</span><span class="function">copy</span><span class="symbol">(</span><span class="normal">lcp_output</span><span class="symbol">+</span><span class="normal">split0</span><span class="symbol">,</span><span class="normal"> lcp_output</span><span class="symbol">+</span><span class="normal">n</span><span class="symbol">,</span>
<span class="normal">					lcp_input</span><span class="symbol">+</span><span class="normal">split0</span><span class="symbol">);</span>
<span class="normal">			mr </span><span class="symbol">=</span><span class="normal"> SortedInPlace</span><span class="symbol">;</span>
<span class="normal">		</span><span class="cbracket">}</span><span class="normal"> </span><span class="keyword">else</span><span class="normal"> </span><span class="cbracket">{</span>
<span class="normal">			</span><span class="function">assert</span><span class="symbol">(</span><span class="number">0</span><span class="symbol">);</span>
<span class="normal">			</span><span class="function">abort</span><span class="symbol">();</span>
<span class="normal">		</span><span class="cbracket">}</span>
<span class="normal">	</span><span class="cbracket">}</span>
<span class="normal">	</span><span class="keyword">if</span><span class="normal"> </span><span class="symbol">(</span><span class="normal">ml </span><span class="symbol">==</span><span class="normal"> SortedInPlace</span><span class="symbol">)</span><span class="normal"> </span><span class="cbracket">{</span>
<span class="normal">		merge_lcp_2way_unstable</span><span class="symbol">&lt;</span><span class="normal">OutputLCP</span><span class="symbol">&gt;(</span>
<span class="normal">		           strings_input</span><span class="symbol">,</span><span class="normal">        lcp_input</span><span class="symbol">,</span><span class="normal">        split0</span><span class="symbol">,</span>
<span class="normal">		           strings_input</span><span class="symbol">+</span><span class="normal">split0</span><span class="symbol">,</span><span class="normal"> lcp_input</span><span class="symbol">+</span><span class="normal">split0</span><span class="symbol">,</span><span class="normal"> n</span><span class="symbol">-</span><span class="normal">split0</span><span class="symbol">,</span>
<span class="normal">		           strings_output</span><span class="symbol">,</span><span class="normal"> lcp_output</span><span class="symbol">);</span>
<span class="normal">		</span><span class="keyword">return</span><span class="normal"> SortedInTemp</span><span class="symbol">;</span>
<span class="normal">	</span><span class="cbracket">}</span><span class="normal"> </span><span class="keyword">else</span><span class="normal"> </span><span class="cbracket">{</span>
<span class="normal">		merge_lcp_2way_unstable</span><span class="symbol">&lt;</span><span class="normal">OutputLCP</span><span class="symbol">&gt;(</span>
<span class="normal">		           strings_output</span><span class="symbol">,</span><span class="normal">        lcp_output</span><span class="symbol">,</span><span class="normal">        split0</span><span class="symbol">,</span>
<span class="normal">		           strings_output</span><span class="symbol">+</span><span class="normal">split0</span><span class="symbol">,</span><span class="normal"> lcp_output</span><span class="symbol">+</span><span class="normal">split0</span><span class="symbol">,</span><span class="normal"> n</span><span class="symbol">-</span><span class="normal">split0</span><span class="symbol">,</span>
<span class="normal">		           strings_input</span><span class="symbol">,</span><span class="normal"> lcp_input</span><span class="symbol">);</span>
<span class="normal">		</span><span class="keyword">return</span><span class="normal"> SortedInPlace</span><span class="symbol">;</span>
<span class="normal">	</span><span class="cbracket">}</span>
<span class="cbracket">}</span>
<span class="type">void</span>
<span class="function">mergesort_lcp_2way_unstable_parallel</span><span class="symbol">(</span><span class="type">unsigned</span><span class="normal"> </span><span class="type">char</span><span class="symbol">**</span><span class="normal"> strings</span><span class="symbol">,</span><span class="normal"> </span><span class="usertype">size_t</span><span class="normal"> n</span><span class="symbol">)</span>
<span class="cbracket">{</span>
<span class="normal">	lcp_t</span><span class="symbol">*</span><span class="normal"> lcp_input  </span><span class="symbol">=</span><span class="normal"> </span><span class="keyword">static_cast</span><span class="symbol">&lt;</span><span class="normal">lcp_t</span><span class="symbol">*&gt;(</span><span class="function">malloc</span><span class="symbol">(</span><span class="normal">n</span><span class="symbol">*</span><span class="keyword">sizeof</span><span class="symbol">(</span><span class="normal">lcp_t</span><span class="symbol">)));</span>
<span class="normal">	lcp_t</span><span class="symbol">*</span><span class="normal"> lcp_output </span><span class="symbol">=</span><span class="normal"> </span><span class="keyword">static_cast</span><span class="symbol">&lt;</span><span class="normal">lcp_t</span><span class="symbol">*&gt;(</span><span class="function">malloc</span><span class="symbol">(</span><span class="normal">n</span><span class="symbol">*</span><span class="keyword">sizeof</span><span class="symbol">(</span><span class="normal">lcp_t</span><span class="symbol">)));</span>
<span class="normal">	</span><span class="type">unsigned</span><span class="normal"> </span><span class="type">char</span><span class="symbol">**</span><span class="normal"> tmp </span><span class="symbol">=</span><span class="normal"> </span><span class="keyword">static_cast</span><span class="symbol">&lt;</span><span class="type">unsigned</span><span class="normal"> </span><span class="type">char</span><span class="symbol">**&gt;(</span>
<span class="normal">			</span><span class="function">malloc</span><span class="symbol">(</span><span class="normal">n</span><span class="symbol">*</span><span class="keyword">sizeof</span><span class="symbol">(</span><span class="type">unsigned</span><span class="normal"> </span><span class="type">char</span><span class="symbol">*)));</span>
<span class="preproc">#pragma</span><span class="normal"> omp parallel</span>
<span class="normal">        </span><span class="cbracket">{</span>
<span class="preproc">#pragma</span><span class="normal"> omp single</span>
<span class="normal">            </span><span class="cbracket">{</span>
<span class="normal">                </span><span class="keyword">const</span><span class="normal"> </span><span class="usertype">MergeResult</span><span class="normal"> m </span><span class="symbol">=</span><span class="normal"> mergesort_lcp_2way_unstable_parallel</span><span class="symbol">&lt;</span><span class="keyword">false</span><span class="symbol">&gt;(</span><span class="normal">strings</span><span class="symbol">,</span><span class="normal"> tmp</span><span class="symbol">,</span>
<span class="normal">                             lcp_input</span><span class="symbol">,</span><span class="normal"> lcp_output</span><span class="symbol">,</span><span class="normal"> n</span><span class="symbol">);</span>
<span class="normal">                </span><span class="keyword">if</span><span class="normal"> </span><span class="symbol">(</span><span class="normal">m </span><span class="symbol">==</span><span class="normal"> SortedInTemp</span><span class="symbol">)</span><span class="normal"> </span><span class="cbracket">{</span>
<span class="normal">                    </span><span class="symbol">(</span><span class="type">void</span><span class="symbol">)</span><span class="normal"> </span><span class="function">memcpy</span><span class="symbol">(</span><span class="normal">strings</span><span class="symbol">,</span><span class="normal"> tmp</span><span class="symbol">,</span><span class="normal"> n</span><span class="symbol">*</span><span class="keyword">sizeof</span><span class="symbol">(</span><span class="type">unsigned</span><span class="normal"> </span><span class="type">char</span><span class="symbol">*));</span>
<span class="normal">                </span><span class="cbracket">}</span>
<span class="normal">            </span><span class="cbracket">}</span>
<span class="normal">        </span><span class="cbracket">}</span>
<span class="normal">	</span><span class="function">free</span><span class="symbol">(</span><span class="normal">lcp_input</span><span class="symbol">);</span>
<span class="normal">	</span><span class="function">free</span><span class="symbol">(</span><span class="normal">lcp_output</span><span class="symbol">);</span>
<span class="normal">	</span><span class="function">free</span><span class="symbol">(</span><span class="normal">tmp</span><span class="symbol">);</span>
<span class="cbracket">}</span>

<span class="function">CONTESTANT_REGISTER_PARALLEL</span><span class="symbol">(</span><span class="normal">mergesort_lcp_2way_unstable_parallel</span><span class="symbol">,</span>
<span class="normal">                             </span><span class="string">"rantala/mergesort_lcp_2way_unstable_parallel"</span><span class="symbol">,</span>
<span class="normal">                             </span><span class="string">"mergesort_parallel unstable LCP with 2way merger"</span><span class="symbol">)</span>

<span class="cbracket">}</span><span class="normal"> </span><span class="comment">// namespace rantala_mergesort_lcp</span>
</tt></pre></div><div style="text-align: right; padding: 8pt; font-size: 12px"><a href="/xmlfeed/weblog-rss20.xml"><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAFAAAAAPAgMAAAAOp6AcAAAADFBMVEVmZmb/ZgD///+JjnlbTUWmAAAACXBIWXMAAABIAAAASABGyWs+AAAACXZwQWcAAABQAAAADwCexKkxAAAAWUlEQVQYlWNgwAa0VmGAFQyqoSCQ/x8J/CBFMCt0ZdTU/F/7/+1HEkydFpoKVPn+93sUlUujQvP/7UcRTAuNDJ2a//s/imDqtKVZofm/1qGYSZk7sfodGwAAiobBJtffoNAAAAAASUVORK5CYII=" alt="RSS 2.0 Weblog Feed" width="80" height="15"/></a> <a href="/xmlfeed/weblog-atom10.xml"><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAFAAAAAPAgMAAAAOp6AcAAAADFBMVEVmZmb/ZgD///+JjnlbTUWmAAAAaklEQVQYlWNgwAa0VmGAFQyqoSCQ/x8J/CBFMDV16rTQ/H/7V//69+//v/3/9oMEI6cuAwr+fv/+/b5d///v//0eJBgWOhMo+Gs9UPAdXDBy6lSYyn9wQZCZS0GCYDPXQcykzJ1Y/Y4NAABKvL80wyoMPgAAAABJRU5ErkJggg==" alt="Atom 1.0 Weblog Feed" width="80" height="15"/></a> <a href="http://validator.w3.org/check?uri=referer"><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAFAAAAAPCAMAAABEF7i9AAAB1FBMVEUHQIgIRY0MN4QNRYoSRYsXUpIYVJQeUpUhWpgjUJMjWpgmU5QnXJkuYZ0uYpwwV5YyZJ4zaKM3ZaA5aaI6aqM6a6E8ZqA8Z6BAbaRBbqdCbaVHd61KSkpKcaZQUFBUf69UgbBVVVVXfq9Yg7NZhbJZh7RagrNeXVxeh7RfjLdgYGBiiLZmZmZnZ2doirhpkbt0m8F3m8B3ncJ5lb55ocR+ocSDgX+Do8eEpMqGhoaHp8iIpMeJjnmJpseKqMeOqsqPsdCQrcyVlZWVsM2Zs9CZtNCfu9ahoaGhuNShudSivNSjtMWjvNSmpqWnpqSrw9qvxNqyxdmyxdyzsK6zs7Ozx9y0xt21yN22tra4y+K80eK/v7/AwMDExMTEy9DH2ejK2+jM2ujN3uvP0dLR0NDR3uvS3uvS3+zU4u3V1dXY2dnY4u7Y4+3b5e/d3d3d5u/d5/De3t7f39/h4uLj4uHj6/Ll7PXm7fTn7/Xo7/Tp7/bq7Ozr6unr8ffw8PDw9vvx9fny+P7z8/Pz9vnz9vv3+fv4+vz5+vz6+vr6+/36/P36///7+/77/Pz7/f37/f78/Pz8/f38/f79/f39/f79/f/9/v79///+/v7+/v////3///+tYR2LAAABKklEQVQ4y2PQoTJg0JlNVYDPQBsyAMTAqaFes8tdsmdPCtA3MDStr3GKKK6myMAprgJ9pcpWs/MlRExYJBvNZLR0sigycHYOV1S7mtjsQJ4gf+HIFPXoWMs6qIGzIRiKZs9GFoEaMRuZhhrYqqJXy8uZYauRxC/VHew7e3YTPAxnI5swG6JxNrKBNjB1EFmIgV0+HA6C8pqqzhXG7BbJJROQIwViMYQ7G2oDQQNn57JyG7kxiCfObrBmS5+BHMuYLkTzMnYDm5WY4lOZZRPKZocxes+aPbuwCFsYohiICLvZsKBAMrDTQ7K/StveU8icTzrOL8JdLpOyWJ49u8Bx9ozw8DY7UYW03hhdxZAOSg2c3jN79rSJs1vSKmfOnpFXNJmynELlvExlAADnaZpLFGEC2wAAAABJRU5ErkJggg==" alt="Valid XHTML 1.1" width="80" height="15"/></a> <a href="http://jigsaw.w3.org/css-validator/check/referer"><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAFAAAAAPCAMAAABEF7i9AAAB1FBMVEUHQIgIRY0MN4QNRYoSRYsXUpIYVJQeUpUhWpgjUJMjWpgmU5QnXJkuYZ0uYpwwV5YyZJ4zaKM3ZaA5aaI6aqM6a6E8ZqA8Z6BAbaRBbqdCbaVHd61KSkpKcaZQUFBUf69UgbBVVVVXfq9Yg7NZhbJZh7RagrNeXVxeh7RfjLdgYGBiiLZmZmZnZ2doirhpkbt0m8F3m8B3ncJ5lb55ocR+ocSDgX+Do8eEpMqGhoaHp8iIpMeJjnmJpseKqMeOqsqPsdCQrcyVlZWVsM2Zs9CZtNCfu9ahoaGhuNShudSivNSjtMWjvNSmpqWnpqSrw9qvxNqyxdmyxdyzsK6zs7Ozx9y0xt21yN22tra4y+K80eK/v7/AwMDExMTEy9DH2ejK2+jM2ujN3uvP0dLR0NDR3uvS3uvS3+zU4u3V1dXY2dnY4u7Y4+3b5e/d3d3d5u/d5/De3t7f39/h4uLj4uHj6/Ll7PXm7fTn7/Xo7/Tp7/bq7Ozr6unr8ffw8PDw9vvx9fny+P7z8/Pz9vnz9vv3+fv4+vz5+vz6+vr6+/36/P36///7+/77/Pz7/f37/f78/Pz8/f38/f79/f39/f79/f/9/v79///+/v7+/v////3///+tYR2LAAABEUlEQVQ4y2PQoTJg0JlNVYDPQBsyAMTAqaFes8tdsmdPCtA3MDStr3GKKK6myMAprgJ9pcpWs/MlRExYJBvNZLR0sigycHYOV1S7mtjsQJ4gf+HIFPXoWMs6mIEQCsIjwhKoga0qerW8nBm2Gkn8Ut3BvrNnN8HCcDYM2cBIogzs8uFwEJTXVHWuMGa3SC6ZgIgUqCEwdxJr4OxcVm4jNwbxxNkN1mzpM2ajGIjsPGK9PLtZiSk+lVk2oWx2GKP3rNmzC4tQwpDoIIQb2Okh2V+lbe8pZM4nHecX4S6XSVksz55d4Dh7Rnh4m52oQlpvjK5iSAelBk7vmT172sTZLWmVM2fPyCuaTFlOoXJepjIAANlljDGY/l5pAAAAAElFTkSuQmCC" alt="Valid CSS (2.1)" width="80" height="15"/></a><br/>Copyright 2005-2015 <a href="/about/">Timo Bingmann</a> - <a href="/about/impressum.html">Impressum</a></div><script type="text/javascript">var _paq = _paq || []; _paq.push(["trackPageView"]); _paq.push(["enableLinkTracking"]);(function() {var u=(("https:" == document.location.protocol) ? "https" : "http") + "://panthema.net/wik-331/"; _paq.push(["setTrackerUrl", u+"js/"]); _paq.push(["setSiteId", "2"]);var d=document, g=d.createElement("script"), s=d.getElementsByTagName("script")[0]; g.type="text/javascript";g.defer=true; g.async=true; g.src=u+"js/"; s.parentNode.insertBefore(g,s);})();</script><noscript><p><img src="http://panthema.net/wik-331/js/?idsite=2&amp;rec=1" style="border:0" alt="" /></p></noscript></body></html>