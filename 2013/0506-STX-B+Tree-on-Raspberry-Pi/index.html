<?xml version="1.0" encoding="iso-8859-1"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta content="text/html; charset=iso-8859-1" http-equiv="content-type" /><title>STX B+ Tree Speed Test Measurements on Raspberry Pi (Model B) - panthema.net</title><link rel="stylesheet" type="text/css" href="/css/base.css" /><link rel="alternate" type="application/rss+xml" title="panthema.net Weblog Feed RSS 2.0" href="http://panthema.net/xmlfeed/weblog-rss20.xml" /><link rel="alternate" type="application/atom+xml" title="panthema.net Weblog Feed Atom 1.0" href="http://panthema.net/xmlfeed/weblog-atom10.xml" /><script type="text/javascript" src="/pt.js"></script><script type="text/javascript">/* <!-- */makeIEHover = function() {var lis = document.getElementById('ptnav').getElementsByTagName('li');for (var i = 0; i < lis.length; i++) {lis[i].onmouseover = function() {this.className += ' sfhover';};lis[i].onmouseout = function() {this.className = this.className.replace(new RegExp(' sfhover\b'), '');};}};if (window.attachEvent) window.attachEvent('onload', makeIEHover);/* --> */</script></head><body style="background-image: url(/img/bgfractal4.jpg)"><div class="pttopbar"><div style="float: right"><ul id="ptnav"><li class="top"><a class="ni" href="/">Weblog</a><ul style="margin-left: -6px; margin-top: 4px" class="nx"><li><a href="/2013/">2013</a></li><li><a href="/2012/">2012</a></li><li><a href="/2011/">2011</a></li><li><a href="/2010/">2010</a></li><li><a href="/2009/">2009</a></li><li><a href="/2008/">2008</a></li><li><a href="/2007/">2007</a></li><li><a href="/2006/">2006</a></li><li class="nt"><a href="/2005/">2005</a></li><li class="ns"><a href="/xmlfeed/weblog-rss20.xml">RSS Feed</a></li><li><a href="/xmlfeed/weblog-atom10.xml">XML Atom</a></li></ul></li><li class="top"><a class="ni" href="/tags/">Tags</a><div style="width: 14em; margin-left: -9em; margin-top: 4px"><a style="font-size: 10pt" href="/tags/algebra.html">algebra</a> <a style="font-size: 16pt" href="/tags/c++.html">c++</a> <a style="font-size: 12pt" href="/tags/code-example.html">code-example</a> <a style="font-size: 14pt" href="/tags/code-snippet.html">code-snippet</a> <a style="font-size: 11pt" href="/tags/coding_tricks.html">coding tricks</a> <a style="font-size: 10pt" href="/tags/compsci.html">compsci</a> <a style="font-size: 10pt" href="/tags/compsci_study_thesis.html">compsci study thesis</a> <a style="font-size: 9pt" href="/tags/crypto-speedtest.html">crypto-speedtest</a> <a style="font-size: 10pt" href="/tags/cryptography.html">cryptography</a> <a style="font-size: 9pt" href="/tags/cryptote.html">cryptote</a> <a style="font-size: 12pt" href="/tags/flex-bison-cpp-example.html">flex-bison-cpp-example</a> <a style="font-size: 13pt" href="/tags/fun.html">fun</a> <a style="font-size: 10pt" href="/tags/graphviz.html">graphviz</a> <a style="font-size: 9pt" href="http://www.hmtg.de">hartmetall</a> <a style="font-size: 9pt" href="/tags/helppc.html">helppc</a> <a style="font-size: 9pt" href="/tags/hifi_selbstbau.html">hifi selbstbau</a> <a style="font-size: 10pt" href="/tags/latex.html">latex</a> <a style="font-size: 10pt" href="/tags/librivox.html">librivox</a> <a style="font-size: 10pt" href="/tags/linux.html">linux</a> <a style="font-size: 10pt" href="/tags/maths.html">maths</a> <a style="font-size: 9pt" href="/tags/music.html">music</a> <a style="font-size: 10pt" href="/tags/netfundamentals.html">netfundamentals</a> <a style="font-size: 11pt" href="/tags/ns-3.html">ns-3</a> <a style="font-size: 9pt" href="/tags/parallel-string-sorting.html">parallel-string-sorting</a> <a style="font-size: 9pt" href="/tags/qtsqlview.html">qtsqlview</a> <a style="font-size: 10pt" href="/tags/research.html">research</a> <a style="font-size: 11pt" href="/tags/sdios06.html">sdios06</a> <a style="font-size: 9pt" href="/tags/sdlfractal.html">sdlfractal</a> <a style="font-size: 11pt" href="/tags/sorting.html">sorting</a> <a style="font-size: 10pt" href="/tags/stringology.html">stringology</a> <a style="font-size: 16pt" href="/tags/stx-btree.html">stx-btree</a> <a style="font-size: 9pt" href="/tags/stx-exparser.html">stx-exparser</a> <a style="font-size: 15pt" href="/tags/talk.html">talk</a> <a style="font-size: 10pt" href="/tags/tutorium.html">tutorium</a> <a style="font-size: 16pt" href="/tags/university.html">university</a> <a style="font-size: 13pt" href="/tags/utilities.html">utilities</a> <a style="font-size: 9pt" href="/tags/webdesign.html">webdesign</a> </div></li><li class="top"><a class="ni" href="#">Projects</a> <ul style="margin-left: -8em; margin-top: 4px" class="nx"> <li><a href="/2009/cryptote/">CryptoTE</a></li> <li><a href="/2009/digup/">digup</a></li> <li><a href="/2013/disk-filltest/">disk-filltest</a></li> <li><a href="/2012/1119-eSAIS-Inducing-Suffix-and-LCP-Arrays-in-External-Memory/">eSAIS-LCP</a></li> <li><a href="/2007/flex-bison-cpp-example/">Flex Bison C++ Example</a></li> <li><a href="/2013/malloc_count/">malloc_count</a></li> <li><a href="/2013/parallel-string-sorting/">parallel-string-sorting</a></li> <li><a href="/2013/pmbw/">Parallel Memory Bandwidth</a></li> <li><a href="/2013/sound-of-sorting/">The Sound of Sorting</a></li> <li><a href="/2007/stx-btree/">STX B+ Tree</a></li> <li><a href="/2010/stx-cbtreedb/">STX Constant BTreeDB</a></li> <li><a href="/2010/stx-execpipe/">STX ExecPipe</a></li> <li class="nt"><a href="/2007/stx-exparser/">STX Expression Parser</a></li> <li class="ns"><a href="/search.html">Search</a></li> </ul></li><li class="top"><a class="ni" href="/about/timo.html">About Me</a></li></ul></div><div style="padding: 6px"><a href="/">panthema</a>  / <a href="/2013/">2013</a> / <a href="/2013/0506-STX-B+Tree-on-Raspberry-Pi/">0506-STX-B+Tree-on-Raspberry-Pi</a></div></div><div class="ptcontent"><h1><span style="float: right; margin: 0em 0em 1.5em 1.5em; font-size: 10pt; text-align: center"><a href="/2013/0506-STX-B+Tree-on-Raspberry-Pi/"><img src="/2013/0506-STX-B+Tree-on-Raspberry-Pi/thumb.jpg" width="300" height="206" alt="Photo of my Raspberry Pi Model B" title="Photo of my Raspberry Pi Model B" /></a></span>STX B+ Tree Speed Test Measurements on Raspberry Pi (Model B)</h1><p class="info">Posted on 2013-05-06 09:48 by <a href="/about/timo.html">Timo</a> at <a href="/2013/0506-STX-B+Tree-on-Raspberry-Pi/">Permlink</a> with <a href="/2013/0506-STX-B+Tree-on-Raspberry-Pi/#notes">0 Comments</a>. Tags: <a href="/tags/stx-btree.html">stx-btree</a> </p><div class="textcontent"><p>The <a href="http://www.raspberrypi.org/">Raspberry Pi</a> is maybe one of the most hyped embedded system projects in the last year, and I also got myself one for experiments. People are doing amazing things with this Linux-in-a-box SoC. Doubtlessly, the popularity is due to the standardized platform and a large community forming around it, which makes fixing the many small problems with Linux on ARM systems feasible. For me, the Raspberry Pi is an alternative architecture on which to test my algorithms and libraries, which exhibits somewhat <strong>different characteristics</strong> than the highly optimized desktop CPUs.</p><p>So I decided to run my <a href="/2007/stx-btree/">STX B+ Tree speed test</a> on the Raspberry Pi Model B, because most people use the SoC for multimedia purposes and little other memory performance data is available. The B+ tree speed test gives <strong>insight into the platform&apos;s overall memory and processing performance</strong>, and thus yields a better assessment of how useful the system is for general purpose applications (unlike multimedia decoding). Most benchmarks focus solely on floating point or integer arithmetic, which alone are very poor indicators for overall system performance. The Raspberry Pi forums say it has performance similar to a &quot;Pentium 2 with 300 MHz&quot;, but that is for arithmetic.</p><p>The Model B sports a 700 MHz (not over-clocked) ARM1176JZF-S CPU with 512 MiB RAM, and a peak power rating of only 3.5 Watts! Apparently, the CPU has 64 KiB L2 cache, however, this cache is shared with the integrated GPU and for me it was unclear how to exclusively allocate it to CPU. Nevertheless, the B+ tree test results show that the cache works as expected. The B+ tree speed test was compiled on the Debian wheezy image from around 2013-03 with <code>g++ 4.6.3-14+rpi1</code> and <code>CXXFLAGS=-O3 -march=armv6j -mfpu=vfp -mfloat-abi=hard</code>. The special flag for ARM1176JZF was a bit slower! Due to the limited memory, the speed test was run with only at most 8 Mi inserted items.</p><p>The complete speed test data is available for download: <a title="Download raspi-btree-results.tar.bz2 (407 KiB)" href="/2013/0506-STX-B+Tree-on-Raspberry-Pi/raspi-btree-results.tar.bz2">raspi-btree-results.tar.bz2 <img width="13" height="17" style="margin-bottom: -2px" src="/img/filelink-archive.png" alt="raspi-btree-results.tar.bz2"/></a> (407 KiB), together with the following result PDF:</p><p style="text-align: center"> <a href="/2013/0506-STX-B+Tree-on-Raspberry-Pi/raspi-speedtest.pdf"> <img width="700" height="490" title="STX B+ Tree Speed Test Results on Raspberry Pi Model B" src="/2013/0506-STX-B+Tree-on-Raspberry-Pi/raspi-speedtest-9.png" alt="STX B+ Tree Speed Test Results on Raspberry Pi Model B"/> </a></p><p>I have selected the experiment with largest &quot;data movement&quot; (multimap with a complete insert/find/delete cycle) for the following discussion to gain insight into the platform&apos;s memory architecture and speed. The plot above is compared to the results from an <strong>Intel i7 920</strong> (2.67 GHz, 256 KiB L2 cache, 8 MiB L3 cache, and 12 GiB of DDR3-800 RAM), which are shown in absolute values at the bottom of this post and are included in the STX B+ tree tarball. The following plot shows the ratio of the speed test results of Raspberry Pi over the Intel i7, individually for each container.</p><p style="text-align: center"> <a href="/2013/0506-STX-B+Tree-on-Raspberry-Pi/ratio-raspi-over-i7.pdf"> <img width="700" height="490" title="Ratio of Speed of Raspberry Pi Model B over Intel i7" src="/2013/0506-STX-B+Tree-on-Raspberry-Pi/ratio-raspi-over-i7-3.png" alt="Ratio of Speed of Raspberry Pi Model B over Intel i7"/> </a></p><p>Obviously, the results differ both quantitatively <em>and</em> qualitatively. Of course, the Intel i7 architecture has a lot more sophisticated circuitry built into it than the ARM RISC system in the Raspberry Pi, so this speed comparison is <strong>quantitatively pretty unfair</strong>: the ARM is about 7-25 times slower than the Intel i7, which is a lot higher than the pure 700 MHz / 2.67 GHz ratio may suggest.</p><p>However, if one takes the price ratio of just the ARM CPU (lets assume $19 of the $35 are for the CPU) over the plain Intel i7 CPU package (currently about $380) into account, then the CPU <strong>price ratio of 20</strong> is in range of the speed ratio. If one considers the cost of a whole Intel i7-based system over the $50 of Raspberry Pi with case and SDHC card, then the Raspberry wins by a long shot. The same is much more pronounced for energy cost: where an Intel i7 desktop can easily draw 180 Watts, the Raspberry Pi is happy with just 3.5 Watts.</p><p>With these ratios in mind, the slowdown is not really that bad, and it is worth-while to look at the qualitative differences. The &quot;bump&quot; in the middle of the ratio plot is obviously due to the difference in L2/L3 cache: the Intel i7 has 128 times more cache. This <strong>cache boosts random access</strong> speeds on Intel i7 for about <strong>seven to eight powers to two</strong>, which is most of the plot. The fast random accesses are most notable for the hash table&apos;s performance, where the Raspberry Pi lacks far behind for small tables. For larger tables, the slowdown goes down, because Intel i7&apos;s cache overflows and RAM comes the bottleneck.</p><p>If one ignores the bump, it is still remarkable that generally speaking the container plots lines <strong>switch their order</strong> at the left and right ends: the B+ tree with fanout <code>&lt;200&gt;</code> begins with smallest slowdown on Raspberry Pi, but ends with the highest. Likewise, the <code>std::map</code> red-black tree has highest slowdown of the trees for small item counts, but best slowdown for high item counts. This indicates that the <strong>performance penalty of random accesses</strong> over sequential ones is higher on more sophisticated circuitry like the Intel i7. Thus on slower platforms like the ARM, the many algorithmic tricks depending on random access are more worth-while.</p><p>Summarizing the results: the Raspberry Pi&apos;s architecture shows a <strong>general slowdown of 8-10</strong> for very small and very large datasets. For medium range datasets the <strong>lack of a larger CPU cache</strong> becomes very notable, bringing the slowdown up to 16, and yielding exceptionally high slowdowns up to 25 for small hash tables. Thus when programming performance-oriented algorithms for these SoC CPUs, one must reconsider their cache hierarchy and <strong>adapt algorithms to very small cache sizes</strong>.</p><p style="text-align: center"> <a href="/2013/0506-STX-B+Tree-on-Raspberry-Pi/i7-speedtest.pdf"> <img width="700" height="490" title="STX B+ Tree Speed Test Results on Intel i7 920" src="/2013/0506-STX-B+Tree-on-Raspberry-Pi/i7-speedtest-9.png" alt="STX B+ Tree Speed Test Results on Intel i7 920"/> </a></p></div><br/><a id="notes"></a><div class="commentframe" style="display: none; border-color: red" id="newpost_div"> <div class="commentimage"> <a href="http://www.gravatar.com/" id="newpost_imgurl"> <img id="newpost_img" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAAAAAA6fptVAAAAAXNSR0IArs4c6QAAAApJREFUCB1j+A8AAQEBADZfZ4AAAAAASUVORK5CYII=" width="80" height="80" alt="Gravatar" /> </a> </div> <div class="commenttitle">Comment by <b><span id="newpost_name">Name</span></b> at <span id="newpost_date">Date</span><span id="newpost_uri">- URI</span><a href="/2013/0506-STX-B+Tree-on-Raspberry-Pi/" rel="nofollow"></a></div> <div class="commentbody" id="newpost_body"></div> <div class="commentbody" style="text-align: right"><big>Preview (Not Saved!)</big></div></div><a id="postnote"></a><form id="noteform" method="post" action="/sendpost.php"><div class="commentform" style="text-align: center"><table class="center thinframe" style="text-align: left"> <tr> <td colspan="2" style="text-align: center">Post Comment<input type="hidden" name="previewok" value="0" /><input type="hidden" name="posturi" value="/2013/0506-STX-B+Tree-on-Raspberry-Pi/" /></td> </tr> <tr> <td>Name:</td> <td><input type="text" name="postname" size="40" /></td> </tr> <tr> <td>E-Mail or Homepage:<br /><span style="font-size: 8pt">&nbsp;</span></td> <td><input type="text" name="postmail" size="40" /><br /> <span style="font-size: 8pt">URLs (http://...) are displayed, e-mails are hidden and used for Gravatar.</span></td> </tr> <tr> <td colspan="2" style="text-align: center"> <textarea name="postbody" cols="80" rows="8"></textarea><br /> <span style="font-size: 8pt">Many common HTML elements are allowed in the text, but no CSS style.</span> </td> </tr> <tr> <td colspan="2" style="text-align: center"> <input type="button" name="Preview" value="Preview" onclick="return noteform_submit()" /> <input type="submit" name="Submit" value="Submit" disabled="disabled" id="newpost_submit" /> </td> </tr></table></div></form></div><div style="text-align: left; padding: 8pt"><a href="/xmlfeed/weblog-rss20.xml"><img src="/img/xmlfeed-rss20.png" alt="RSS 2.0 Weblog Feed" height="15" width="80" /></a> <a href="/xmlfeed/weblog-atom10.xml"><img src="/img/xmlfeed-atom10.png" alt="Atom 1.0 Weblog Feed" height="15" width="80" /></a> <a href="http://validator.w3.org/check?uri=referer"><img src="/img/w3c-xhtml10.png" alt="Valid XHTML 1.1" height="15" width="80" /></a> <a href="http://jigsaw.w3.org/css-validator/check/referer"><img src="/img/w3c-css.png" alt="Valid CSS (2.1)" height="15" width="80" /></a></div></body></html>