<?xml version="1.0" encoding="iso-8859-1"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta content="text/html; charset=iso-8859-1" http-equiv="content-type" /><title>Coding Tricks 101: How to Save the Assembler Code Generated by GCC - panthema.net</title><link rel="stylesheet" type="text/css" href="/css/base.css" /><link rel="alternate" type="application/rss+xml" title="panthema.net Weblog Feed RSS 2.0" href="http://panthema.net/xmlfeed/weblog-rss20.xml" /><link rel="alternate" type="application/atom+xml" title="panthema.net Weblog Feed Atom 1.0" href="http://panthema.net/xmlfeed/weblog-atom10.xml" /><script type="text/javascript" src="/js/base.js"></script><script type="text/javascript">/* <!-- */makeIEHover = function() {var lis = document.getElementById('ptnav').getElementsByTagName('li');for (var i = 0; i < lis.length; i++) {lis[i].onmouseover = function() {this.className += ' sfhover';};lis[i].onmouseout = function() {this.className = this.className.replace(new RegExp(' sfhover\b'), '');};}};if (window.attachEvent) window.attachEvent('onload', makeIEHover);/* --> */</script></head><body style="background-image: url(/img/bgfractal6.jpg)"><div class="pttopbar"><div style="float: right"><ul id="ptnav"><li class="top"><a class="ni" href="/">Weblog</a><ul style="margin-left: -6px; margin-top: 4px" class="nx"><li><a href="/2013/">2013</a></li><li><a href="/2012/">2012</a></li><li><a href="/2011/">2011</a></li><li><a href="/2010/">2010</a></li><li><a href="/2009/">2009</a></li><li><a href="/2008/">2008</a></li><li><a href="/2007/">2007</a></li><li><a href="/2006/">2006</a></li><li class="nt"><a href="/2005/">2005</a></li><li class="ns"><a href="/xmlfeed/weblog-rss20.xml">RSS Feed</a></li><li class="nt"><a href="/xmlfeed/weblog-atom10.xml">XML Atom</a></li><li class="ns"><a href="/search.html">Search</a></li></ul></li><li class="top"><a class="ni" href="/tags/">Tags</a><div style="width: 14em; margin-left: -9em; margin-top: 4px"><a style="font-size: 10pt" href="/tags/algebra.html">algebra</a> <a style="font-size: 16pt" href="/tags/c++.html">c++</a> <a style="font-size: 12pt" href="/tags/code-example.html">code-example</a> <a style="font-size: 14pt" href="/tags/code-snippet.html">code-snippet</a> <a style="font-size: 11pt" href="/tags/coding_tricks.html">coding tricks</a> <a style="font-size: 10pt" href="/tags/compsci.html">compsci</a> <a style="font-size: 10pt" href="/tags/compsci_study_thesis.html">compsci study thesis</a> <a style="font-size: 9pt" href="/tags/crypto-speedtest.html">crypto-speedtest</a> <a style="font-size: 10pt" href="/tags/cryptography.html">cryptography</a> <a style="font-size: 9pt" href="/tags/cryptote.html">cryptote</a> <a style="font-size: 12pt" href="/tags/flex-bison-cpp-example.html">flex-bison-cpp-example</a> <a style="font-size: 13pt" href="/tags/fun.html">fun</a> <a style="font-size: 10pt" href="/tags/graphviz.html">graphviz</a> <a style="font-size: 9pt" href="http://www.hmtg.de">hartmetall</a> <a style="font-size: 9pt" href="/tags/helppc.html">helppc</a> <a style="font-size: 9pt" href="/tags/hifi_selbstbau.html">hifi selbstbau</a> <a style="font-size: 10pt" href="/tags/latex.html">latex</a> <a style="font-size: 10pt" href="/tags/librivox.html">librivox</a> <a style="font-size: 10pt" href="/tags/linux.html">linux</a> <a style="font-size: 10pt" href="/tags/maths.html">maths</a> <a style="font-size: 9pt" href="/tags/music.html">music</a> <a style="font-size: 10pt" href="/tags/netfundamentals.html">netfundamentals</a> <a style="font-size: 11pt" href="/tags/ns-3.html">ns-3</a> <a style="font-size: 9pt" href="/tags/parallel-string-sorting.html">parallel-string-sorting</a> <a style="font-size: 9pt" href="/tags/qtsqlview.html">qtsqlview</a> <a style="font-size: 10pt" href="/tags/research.html">research</a> <a style="font-size: 11pt" href="/tags/sdios06.html">sdios06</a> <a style="font-size: 9pt" href="/tags/sdlfractal.html">sdlfractal</a> <a style="font-size: 11pt" href="/tags/sorting.html">sorting</a> <a style="font-size: 10pt" href="/tags/stringology.html">stringology</a> <a style="font-size: 16pt" href="/tags/stx-btree.html">stx-btree</a> <a style="font-size: 9pt" href="/tags/stx-exparser.html">stx-exparser</a> <a style="font-size: 10pt" href="/tags/stxxl.html">stxxl</a> <a style="font-size: 15pt" href="/tags/talk.html">talk</a> <a style="font-size: 10pt" href="/tags/tutorium.html">tutorium</a> <a style="font-size: 16pt" href="/tags/university.html">university</a> <a style="font-size: 13pt" href="/tags/utilities.html">utilities</a> <a style="font-size: 9pt" href="/tags/webdesign.html">webdesign</a> </div></li><li class="top"> <a class="ni" href="#">Projects</a> <ul style="margin-left: -8em; margin-top: 4px;" class="nx"> <li><a href="/2009/cryptote/">CryptoTE</a></li> <li><a href="/2009/digup/">digup</a></li> <li><a href="/2013/disk-filltest/">disk-filltest</a></li> <li><a href="/2012/1119-eSAIS-Inducing-Suffix-and-LCP-Arrays-in-External-Memory/">eSAIS-LCP</a></li> <li><a href="/2007/flex-bison-cpp-example/">Flex Bison C++ Example</a></li> <li><a href="/2013/malloc_count/">malloc_count</a></li> <li><a href="/2013/parallel-string-sorting/">parallel-string-sorting</a></li> <li><a href="/2013/pmbw/">Parallel Memory Bandwidth</a></li> <li><a href="/2013/sound-of-sorting/">The Sound of Sorting</a></li> <li><a href="/2007/stx-btree/">STX B+ Tree</a></li> <li><a href="/2010/stx-cbtreedb/">STX Constant BTreeDB</a></li> <li><a href="/2010/stx-execpipe/">STX ExecPipe</a></li> <li><a href="/2007/stx-exparser/">STX Expression Parser</a></li> <li class="nt"><a href="/2013/1212-stxxl-1.4.0/">STXXL 1.4</a></li> <li class="ns"><a href="/search.html">Search</a></li> </ul></li><li class="top"> <a class="ni" href="#">Research</a> <ul style="margin-left: -16em; margin-top: 4px" class="nx"> <li><a href="/2012/1119-eSAIS-Inducing-Suffix-and-LCP-Arrays-in-External-Memory/">eSAIS-LCP - External Memory Suffix Sorting</a></li> <li><a href="/2013/parallel-string-sorting/">pS5 - Parallel String Sorting</a></li> <li><a href="/tags/stxxl.html">STXXL - External Memory Algorithms</a></li> <li class="ns"><a href="/search.html">Search</a></li> </ul></li><li class="top"> <a class="ni" href="/about/">About</a> <ul style="margin-left: -6em; margin-top: 4px" class="nx"> <li><a href="/about/">Timo Bingmann</a></li> <li><a href="/about/impressum.html">Impressum</a></li> </ul></li></ul></div><div style="padding: 6px"><a href="/">panthema</a>  / <a href="/2013/">2013</a> / <a href="/2013/0124-GCC-Output-Assembler-Code/">0124-GCC-Output-Assembler-Code</a></div></div><div class="ptcontent"><div style="float: right; clear: right; margin: 12pt 0pt 12pt 12pt; font-size: smaller; text-align: center"><a href="/2013/0124-GCC-Output-Assembler-Code/"><img src="/2013/0124-GCC-Output-Assembler-Code/thumb.jpg" width="300" height="209" alt="Instacode coloring of assembler code" title="Instacode coloring of assembler code" /></a></div><h1>Coding Tricks 101: How to Save the Assembler Code Generated by GCC</h1><p class="info">Posted on 2013-01-24 18:07 by <a href="/about/">Timo Bingmann</a><a href="http://plus.google.com/+TimoBingmann?rel=author"></a> at <a href="/2013/0124-GCC-Output-Assembler-Code/">Permlink</a> with <a href="/2013/0124-GCC-Output-Assembler-Code/#notes">1 Comments</a>. Tags: <a href="/tags/c++.html">c++</a> <a href="/tags/coding_tricks.html">coding tricks</a></p><div class="textcontent"><p>This is the first issue of a series of blog posts about some Linux coding tricks I have collected in the last few years.</p><p>Folklore says that compilers are among the most complex computer programs written today. They incorporate many optimization algorithms, inline functions and fold constant expressions; all without changing output, correctness or side effects of the code. If you think about it, the work <a class="exp" href="http://gcc.gnu.org"><code>gcc</code></a>, <a class="exp" href="http://www.llvm.org"><code>llvm</code></a> and other compilers do is really amazing and mostly works just great.</p><p>Sometimes, however, you want to know exactly what a compiler does with your C/C++ code. Most straight-forward questions can be answered using a debugger. However, if you want to verify whether the compiler really applies those optimizations to your program, that your intuition expects it to do, then a debugger is usually not useful, because optimized programs can look very different from the original. Some example questions are:</p><ul> <li>Is a local integer variable stored in a register and how long does it exist?</li> <li>Does the compiler use special instructions for a simple copy loop?</li> <li>Are special conditional instructions used for an <code>if</code> or <code>switch</code> statement?</li> <li>Is a specific function inlined or called each time?</li></ul><p>These questions can be answered definitely by investigating the compiler&apos;s output. On the Net, there are multiple &quot;online compilers,&quot; which can visualize the assembler output of popular compilers for small pieces of code: see the &quot;<a href="http://gcc.godbolt.org/">GCC Explorer</a>&quot; or &quot;<a href="http://assembly.ynh.io/">C/C++ to Assembly v2</a>&quot;. However, for inspecting parts of a larger project, these tools are unusable, because the interesting pieces are embedded in much larger source files.</p><p>Luckily, <code>gcc</code> does not output binary machine code directly. Instead, it internally writes assembler code, which then is translated by <code>as</code> into binary machine code (actually, <code>gcc</code> creates more intermediate structures). This internal assembler code can be outputted to a file, with some annotation to make it easier to read.</p><h2>Example with Generated Assembler Output</h2><p>In this post, we will consider the following simple C program <a title="Download test.c (295 B)" href="/2013/0124-GCC-Output-Assembler-Code/example/test.c.html">test.c.html <img width="13" height="17" style="margin-bottom: -2px" src="/img/filelink-source.png" alt="test.c"/></a>:</p><div class="codesnippet codeframe" style="font-size: 10pt; font-family: monospace"><pre><tt><span class="preproc">#include</span><span class="normal"> </span><span class="string">&lt;stdio.h&gt;</span>

<span class="type">int</span><span class="normal"> </span><span class="function">some_function</span><span class="symbol">(</span><span class="type">int</span><span class="normal"> a</span><span class="symbol">)</span>
<span class="cbracket">{</span>
<span class="normal">    a </span><span class="symbol">*=</span><span class="normal"> </span><span class="number">5</span><span class="symbol">;</span><span class="normal">     </span><span class="comment">// a is not really needed.</span>
<span class="normal">    </span><span class="keyword">return</span><span class="normal"> </span><span class="number">42</span><span class="symbol">;</span>
<span class="cbracket">}</span>

<span class="type">int</span><span class="normal"> </span><span class="function">main</span><span class="symbol">(</span><span class="type">int</span><span class="normal"> argc</span><span class="symbol">,</span><span class="normal"> </span><span class="type">char</span><span class="symbol">*</span><span class="normal"> argv</span><span class="symbol">[])</span>
<span class="cbracket">{</span>
<span class="normal">    </span><span class="type">int</span><span class="normal"> variableA </span><span class="symbol">=</span><span class="normal"> </span><span class="number">10</span><span class="symbol">;</span>

<span class="normal">    </span><span class="function">printf</span><span class="symbol">(</span><span class="string">"This is a test program.</span><span class="specialchar">\n</span><span class="string">"</span><span class="symbol">);</span>

<span class="normal">    variableA </span><span class="symbol">+=</span><span class="normal"> </span><span class="number">5</span><span class="symbol">;</span>
<span class="normal">    variableA </span><span class="symbol">+=</span><span class="normal"> </span><span class="function">some_function</span><span class="symbol">(</span><span class="number">20</span><span class="symbol">);</span>
<span class="normal">    </span>
<span class="normal">    </span><span class="keyword">return</span><span class="normal"> variableA</span><span class="symbol">;</span>
<span class="cbracket">}</span>
</tt></pre></div><p>The standard method to generate assembler code from a C program is to run <code>gcc -S test.c</code>. This will output a file <code>test.s</code>. But, with some additional command line tricks, there are much more detailed assembler outputs available. Running the following compile line will not only output the binary, but also fork the intermediate assembler code into <a title="Download test.s (5.76 KiB)" href="/2013/0124-GCC-Output-Assembler-Code/example/test.s.html">test.s.html <img width="13" height="17" style="margin-bottom: -2px" src="/img/filelink-source.png" alt="test.s"/></a>. The orange command line parameters can be added to any <code>gcc</code> call.</p><p class="codesnippet termframe">$ gcc test.c -o test <span style="color:orange">-Wa,-adhln=test.s -g -fverbose-asm -masm=intel</span></p><p>The additional compiler option <code>-Wa,-adhln=test.s</code> instructs <code>gcc</code> to pass additional options to the internally called assembler: &quot;<code>-adhln=test.s</code>&quot;. These tell <code>as</code> to output a listing to <code>test.s</code> according to the following parameters (from <code>as -help</code>):</p><div class="codesnippet codeframe" style="font-size: 10pt; font-family: monospace"><pre><tt>-a[sub-option...]    turn on listings
                     Sub-options [default hls]:
                     c      omit false conditionals
                     d      omit debugging directives
                     g      include general info
                     h      include high-level source
                     l      include assembly
                     m      include macro expansions
                     n      omit forms processing
                     s      include symbols
                     =FILE  list to FILE (must be last sub-option)</tt></pre></div><p>The non-assembler options <code>-g -fverbose-asm -masm=intel</code> yield a more detailed assembler listing. The debug <code>-g</code> interleaves the assembler listing with the original C code. With <code>-fverbose-asm</code>, <code>gcc</code> outputs some additional information about which variable is manipulated in a register. And <code>-masm=intel</code> changes the assembler mnemonics to Intel&apos;s style, instead of the AT&amp;T style. Intel&apos;s style follows the right-to-left assignment paradigm, which I prefer because it resembles the same way C assignment are defined.</p><p>For most practical analysis, you will want to look at the assembler code generated by <code>gcc</code> with additional optimization options:</p><p class="codesnippet termframe">$ gcc test.c -o test <span style="color:orange">-Wa,-adhln=test-O3.s -g -fverbose-asm -masm=intel</span> <span style="color: yellow">-O3 -march=native</span></p><p>The outputted listing <a title="Download test-O3.s (13.5 KiB)" href="/2013/0124-GCC-Output-Assembler-Code/example/test-O3.s.html">test-O3.s.html <img width="13" height="17" style="margin-bottom: -2px" src="/img/filelink-source.png" alt="test-O3.s"/></a> is rather verbose and some shortened exerts are reproduced below. The listing is composed of parts of the original C code (prefixed with <code>linenum:file ****</code>) intermingled with the assembler code generated for those lines. Obviously, the generated assembler code is not meant to be read by human eyes, but nevertheless one can usually recognize a lot of details, even with only moderate knowledge of assembler code.</p><div class="codesnippet codeframe" style="font-size: 10pt; font-family: monospace"><pre><tt><span class="symbol">[...</span><span class="normal"> header </span><span class="symbol">...]</span>
<span class="normal">  </span><span class="number">56</span><span class="normal">                            </span><span class="symbol">.</span><span class="normal">p</span><span class="number">2</span><span class="normal">align </span><span class="number">4</span><span class="symbol">,,</span><span class="number">15</span>
<span class="normal">  </span><span class="number">57</span><span class="normal">                    </span><span class="symbol">.</span><span class="normal">globl some_function</span>
<span class="normal">  </span><span class="number">59</span><span class="normal">                    some_function</span><span class="symbol">:</span>
<span class="normal">  </span><span class="number">60</span><span class="normal">                    </span><span class="symbol">.</span><span class="normal">LFB</span><span class="number">22</span><span class="symbol">:</span>
<span class="normal">  </span><span class="number">61</span><span class="normal">                            </span><span class="symbol">.</span><span class="normal">file </span><span class="number">1</span><span class="normal"> </span><span class="string">"test.c"</span>
<span class="preproc">   1:</span><span class="keyword">test</span><span class="symbol">.</span><span class="normal">c        </span><span class="symbol">****</span><span class="normal"> #</span><span class="keyword">include</span><span class="normal"> </span><span class="symbol">&lt;</span><span class="normal">stdio</span><span class="symbol">.</span><span class="normal">h</span><span class="symbol">&gt;</span>
<span class="preproc">   2:</span><span class="keyword">test</span><span class="symbol">.</span><span class="normal">c        </span><span class="symbol">****</span>
<span class="preproc">   3:</span><span class="keyword">test</span><span class="symbol">.</span><span class="normal">c        </span><span class="symbol">****</span><span class="normal"> </span><span class="keyword">int</span><span class="normal"> some_function</span><span class="symbol">(</span><span class="keyword">int</span><span class="normal"> a</span><span class="symbol">)</span>
<span class="preproc">   4:</span><span class="keyword">test</span><span class="symbol">.</span><span class="normal">c        </span><span class="symbol">****</span><span class="normal"> {</span>
<span class="normal">  </span><span class="number">62</span><span class="normal">                            </span><span class="symbol">.</span><span class="normal">loc </span><span class="number">1</span><span class="normal"> </span><span class="number">4</span><span class="normal"> </span><span class="number">0</span>
<span class="normal">  </span><span class="number">63</span><span class="normal">                            </span><span class="symbol">.</span><span class="normal">cfi_startproc</span>
<span class="normal">  </span><span class="number">64</span><span class="normal">                    </span><span class="symbol">.</span><span class="normal">LVL</span><span class="number">0</span><span class="symbol">:</span>
<span class="preproc">   5:</span><span class="keyword">test</span><span class="symbol">.</span><span class="normal">c        </span><span class="symbol">****</span><span class="normal">     a </span><span class="symbol">*=</span><span class="normal"> </span><span class="number">5</span><span class="comment">;     // a is not really needed.</span>
<span class="preproc">   6:</span><span class="keyword">test</span><span class="symbol">.</span><span class="normal">c        </span><span class="symbol">****</span><span class="normal">     return </span><span class="number">42</span><span class="comment">;</span>
<span class="preproc">   7:</span><span class="keyword">test</span><span class="symbol">.</span><span class="normal">c        </span><span class="symbol">****</span><span class="normal"> }</span>
<span class="normal">  </span><span class="number">65</span><span class="normal">                            </span><span class="symbol">.</span><span class="normal">loc </span><span class="number">1</span><span class="normal"> </span><span class="number">7</span><span class="normal"> </span><span class="number">0</span>
<span class="normal">  </span><span class="number">66</span><span class="normal"> </span><span class="number">0000</span><span class="normal"> B</span><span class="number">82</span><span class="normal">A</span><span class="number">0000</span><span class="normal">              </span><span class="keyword">mov</span><span class="normal">	</span><span class="variable">eax</span><span class="symbol">,</span><span class="normal"> </span><span class="number">42</span><span class="normal">	#</span><span class="symbol">,</span>
<span class="normal">  </span><span class="number">66</span><span class="normal">      </span><span class="number">00</span>
<span class="normal">  </span><span class="number">67</span><span class="normal"> </span><span class="number">0005</span><span class="normal"> C</span><span class="number">3</span><span class="normal">                    </span><span class="keyword">ret</span>
<span class="normal">  </span><span class="number">68</span><span class="normal">                            </span><span class="symbol">.</span><span class="normal">cfi_endproc</span></tt></pre></div><p>For example, in <code>some_function()</code>, the original <code>return 42;</code> generated the lines 66 and 67: move the value to <code>eax</code> and return. However, <code>a *= 5;</code> does not generate any code; it was optimized out. Nevertheless, the original comment from the C code is included in the listing.</p><div class="codesnippet codeframe" style="font-size: 10pt; font-family: monospace"><pre><tt><span class="normal">  </span><span class="number">69</span><span class="normal">                    </span><span class="symbol">.</span><span class="normal">LFE</span><span class="number">22</span><span class="symbol">:</span>
<span class="normal">  </span><span class="number">71</span><span class="normal">                            </span><span class="symbol">.</span><span class="normal">section	</span><span class="symbol">.</span><span class="normal">rodata</span><span class="symbol">.</span><span class="normal">str</span><span class="number">1.1</span><span class="symbol">,</span><span class="string">"aMS"</span><span class="symbol">,</span><span class="normal">@progbits</span><span class="symbol">,</span><span class="number">1</span>
<span class="normal">  </span><span class="number">72</span><span class="normal">                    </span><span class="symbol">.</span><span class="normal">LC</span><span class="number">0</span><span class="symbol">:</span>
<span class="normal">  </span><span class="number">73</span><span class="normal"> </span><span class="number">0000</span><span class="normal"> </span><span class="number">54686973</span><span class="normal">              </span><span class="symbol">.</span><span class="normal">string	</span><span class="string">"This is a test program."</span>
<span class="normal">  </span><span class="number">73</span><span class="normal">      </span><span class="number">20697320</span>
<span class="normal">  </span><span class="number">73</span><span class="normal">      </span><span class="number">61207465</span>
<span class="normal">  </span><span class="number">73</span><span class="normal">      </span><span class="number">73742070</span>
<span class="normal">  </span><span class="number">73</span><span class="normal">      </span><span class="number">726</span><span class="normal">F</span><span class="number">6772</span>
<span class="normal">  </span><span class="number">74</span><span class="normal">                            </span><span class="symbol">.</span><span class="normal">text</span>
<span class="normal">  </span><span class="number">75</span><span class="normal"> </span><span class="number">0006</span><span class="normal"> </span><span class="number">662</span><span class="normal">E</span><span class="number">0F1F</span><span class="normal">              </span><span class="symbol">.</span><span class="normal">p</span><span class="number">2</span><span class="normal">align </span><span class="number">4</span><span class="symbol">,,</span><span class="number">15</span>
<span class="normal">  </span><span class="number">75</span><span class="normal">      </span><span class="number">84000000</span>
<span class="normal">  </span><span class="number">75</span><span class="normal">      </span><span class="number">0000</span>
<span class="normal">  </span><span class="number">76</span><span class="normal">                    </span><span class="symbol">.</span><span class="normal">globl main</span>
<span class="normal">  </span><span class="number">78</span><span class="normal">                    main</span><span class="symbol">:</span>
<span class="normal">  </span><span class="number">79</span><span class="normal">                    </span><span class="symbol">.</span><span class="normal">LFB</span><span class="number">23</span><span class="symbol">:</span>
<span class="preproc">   8:</span><span class="keyword">test</span><span class="symbol">.</span><span class="normal">c        </span><span class="symbol">****</span>
<span class="preproc">   9:</span><span class="keyword">test</span><span class="symbol">.</span><span class="normal">c        </span><span class="symbol">****</span><span class="normal"> </span><span class="keyword">int</span><span class="normal"> main</span><span class="symbol">(</span><span class="keyword">int</span><span class="normal"> argc</span><span class="symbol">,</span><span class="normal"> char</span><span class="symbol">*</span><span class="normal"> argv</span><span class="symbol">[])</span>
<span class="preproc">  10:</span><span class="keyword">test</span><span class="symbol">.</span><span class="normal">c        </span><span class="symbol">****</span><span class="normal"> {</span>
<span class="normal">  </span><span class="number">80</span><span class="normal">                            </span><span class="symbol">.</span><span class="normal">loc </span><span class="number">1</span><span class="normal"> </span><span class="number">10</span><span class="normal"> </span><span class="number">0</span>
<span class="normal">  </span><span class="number">81</span><span class="normal">                            </span><span class="symbol">.</span><span class="normal">cfi_startproc</span>
<span class="normal">  </span><span class="number">82</span><span class="normal">                    </span><span class="symbol">.</span><span class="normal">LVL</span><span class="number">1</span><span class="symbol">:</span>
<span class="normal">  </span><span class="number">83</span><span class="normal"> </span><span class="number">0010</span><span class="normal"> </span><span class="number">4883</span><span class="normal">EC</span><span class="number">08</span><span class="normal">              </span><span class="keyword">sub</span><span class="normal">	rsp</span><span class="symbol">,</span><span class="normal"> </span><span class="number">8</span><span class="normal">	#</span><span class="symbol">,</span>
<span class="normal">  </span><span class="number">84</span><span class="normal">                    </span><span class="symbol">.</span><span class="normal">LCFI</span><span class="number">0</span><span class="symbol">:</span>
<span class="normal">  </span><span class="number">85</span><span class="normal">                            </span><span class="symbol">.</span><span class="normal">cfi_def_cfa_offset </span><span class="number">16</span>
<span class="normal">  </span><span class="number">86</span><span class="normal">                            </span><span class="symbol">.</span><span class="normal">file </span><span class="number">2</span><span class="normal"> </span><span class="string">"/usr/include/bits/stdio2.h"</span>
<span class="preproc">   1:</span><span class="symbol">/</span><span class="normal">usr</span><span class="symbol">/</span><span class="keyword">include</span><span class="symbol">/</span><span class="normal">bits</span><span class="symbol">/</span><span class="normal">stdio</span><span class="number">2</span><span class="symbol">.</span><span class="normal">h </span><span class="symbol">****</span><span class="normal"> </span><span class="symbol">/*</span><span class="normal"> Checking macros for stdio functions</span><span class="symbol">.</span><span class="normal"> </span><span class="symbol">*/</span>
<span class="symbol">[...</span><span class="normal"> more lines from stdio</span><span class="number">2</span><span class="symbol">.</span><span class="normal">h </span><span class="symbol">...]</span>
<span class="preproc"> 102:</span><span class="symbol">/</span><span class="normal">usr</span><span class="symbol">/</span><span class="keyword">include</span><span class="symbol">/</span><span class="normal">bits</span><span class="symbol">/</span><span class="normal">stdio</span><span class="number">2</span><span class="symbol">.</span><span class="normal">h </span><span class="symbol">****</span><span class="normal"> __extern_always_inline </span><span class="keyword">int</span>
<span class="preproc"> 103:</span><span class="symbol">/</span><span class="normal">usr</span><span class="symbol">/</span><span class="keyword">include</span><span class="symbol">/</span><span class="normal">bits</span><span class="symbol">/</span><span class="normal">stdio</span><span class="number">2</span><span class="symbol">.</span><span class="normal">h </span><span class="symbol">****</span><span class="normal"> printf </span><span class="symbol">(</span><span class="normal">__const char </span><span class="symbol">*</span><span class="normal">__restrict __fmt</span><span class="symbol">,</span><span class="normal"> </span><span class="symbol">...)</span>
<span class="preproc"> 104:</span><span class="symbol">/</span><span class="normal">usr</span><span class="symbol">/</span><span class="keyword">include</span><span class="symbol">/</span><span class="normal">bits</span><span class="symbol">/</span><span class="normal">stdio</span><span class="number">2</span><span class="symbol">.</span><span class="normal">h </span><span class="symbol">****</span><span class="normal"> {</span>
<span class="preproc"> 105:</span><span class="symbol">/</span><span class="normal">usr</span><span class="symbol">/</span><span class="keyword">include</span><span class="symbol">/</span><span class="normal">bits</span><span class="symbol">/</span><span class="normal">stdio</span><span class="number">2</span><span class="symbol">.</span><span class="normal">h </span><span class="symbol">****</span><span class="normal">   return __printf_chk </span><span class="symbol">(</span><span class="normal">__USE_FORTIFY_LEVEL </span><span class="symbol">-</span><span class="normal"> </span><span class="number">1</span><span class="symbol">,</span><span class="normal"> __fmt</span><span class="symbol">,</span><span class="normal"> __va_arg_pack </span><span class="symbol">())</span><span class="comment">;</span>
<span class="normal">  </span><span class="number">87</span><span class="normal">                            </span><span class="symbol">.</span><span class="normal">loc </span><span class="number">2</span><span class="normal"> </span><span class="number">105</span><span class="normal"> </span><span class="number">0</span>
<span class="normal">  </span><span class="number">88</span><span class="normal"> </span><span class="number">0014</span><span class="normal"> BF</span><span class="number">000000</span><span class="normal">              </span><span class="keyword">mov</span><span class="normal">	</span><span class="variable">edi</span><span class="symbol">,</span><span class="normal"> </span><span class="keyword">OFFSET</span><span class="normal"> FLAT</span><span class="symbol">:.</span><span class="normal">LC</span><span class="number">0</span><span class="normal">	#</span><span class="symbol">,</span>
<span class="normal">  </span><span class="number">88</span><span class="normal">      </span><span class="number">00</span>
<span class="normal">  </span><span class="number">89</span><span class="normal">                    </span><span class="symbol">.</span><span class="normal">LVL</span><span class="number">2</span><span class="symbol">:</span>
<span class="normal">  </span><span class="number">90</span><span class="normal"> </span><span class="number">0019</span><span class="normal"> E</span><span class="number">8000000</span><span class="normal">              </span><span class="keyword">call</span><span class="normal">	puts	#</span>
<span class="normal">  </span><span class="number">90</span><span class="normal">      </span><span class="number">00</span>
<span class="normal">  </span><span class="number">91</span><span class="normal">                    </span><span class="symbol">.</span><span class="normal">LVL</span><span class="number">3</span><span class="symbol">:</span>
<span class="preproc">  11:</span><span class="keyword">test</span><span class="symbol">.</span><span class="normal">c        </span><span class="symbol">****</span><span class="normal">     </span><span class="keyword">int</span><span class="normal"> variableA </span><span class="symbol">=</span><span class="normal"> </span><span class="number">10</span><span class="comment">;</span>
<span class="preproc">  12:</span><span class="keyword">test</span><span class="symbol">.</span><span class="normal">c        </span><span class="symbol">****</span>
<span class="preproc">  13:</span><span class="keyword">test</span><span class="symbol">.</span><span class="normal">c        </span><span class="symbol">****</span><span class="normal">     printf</span><span class="symbol">(</span><span class="string">"This is a test program.</span><span class="specialchar">\n</span><span class="string">"</span><span class="symbol">)</span><span class="comment">;</span>
<span class="preproc">  14:</span><span class="keyword">test</span><span class="symbol">.</span><span class="normal">c        </span><span class="symbol">****</span>
<span class="preproc">  15:</span><span class="keyword">test</span><span class="symbol">.</span><span class="normal">c        </span><span class="symbol">****</span><span class="normal">     variableA </span><span class="symbol">+=</span><span class="normal"> </span><span class="number">5</span><span class="comment">;</span>
<span class="preproc">  16:</span><span class="keyword">test</span><span class="symbol">.</span><span class="normal">c        </span><span class="symbol">****</span><span class="normal">     variableA </span><span class="symbol">+=</span><span class="normal"> some_function</span><span class="symbol">(</span><span class="number">20</span><span class="symbol">)</span><span class="comment">;</span>
<span class="preproc">  17:</span><span class="keyword">test</span><span class="symbol">.</span><span class="normal">c        </span><span class="symbol">****</span>
<span class="preproc">  18:</span><span class="keyword">test</span><span class="symbol">.</span><span class="normal">c        </span><span class="symbol">****</span><span class="normal">     return variableA</span><span class="comment">;</span>
<span class="preproc">  19:</span><span class="keyword">test</span><span class="symbol">.</span><span class="normal">c        </span><span class="symbol">****</span><span class="normal"> }</span>
<span class="normal">  </span><span class="number">92</span><span class="normal">                            </span><span class="symbol">.</span><span class="normal">loc </span><span class="number">1</span><span class="normal"> </span><span class="number">19</span><span class="normal"> </span><span class="number">0</span>
<span class="normal">  </span><span class="number">93</span><span class="normal"> </span><span class="number">001e</span><span class="normal"> B</span><span class="number">8390000</span><span class="normal">              </span><span class="keyword">mov</span><span class="normal">	</span><span class="variable">eax</span><span class="symbol">,</span><span class="normal"> </span><span class="number">57</span><span class="normal">	#</span><span class="symbol">,</span>
<span class="normal">  </span><span class="number">93</span><span class="normal">      </span><span class="number">00</span>
<span class="normal">  </span><span class="number">94</span><span class="normal"> </span><span class="number">0023</span><span class="normal"> </span><span class="number">4883</span><span class="normal">C</span><span class="number">408</span><span class="normal">              </span><span class="keyword">add</span><span class="normal">	rsp</span><span class="symbol">,</span><span class="normal"> </span><span class="number">8</span><span class="normal">	#</span><span class="symbol">,</span>
<span class="normal">  </span><span class="number">95</span><span class="normal">                    </span><span class="symbol">.</span><span class="normal">LCFI</span><span class="number">1</span><span class="symbol">:</span>
<span class="normal">  </span><span class="number">96</span><span class="normal">                            </span><span class="symbol">.</span><span class="normal">cfi_def_cfa_offset </span><span class="number">8</span>
<span class="normal">  </span><span class="number">97</span><span class="normal"> </span><span class="number">0027</span><span class="normal"> C</span><span class="number">3</span><span class="normal">                    </span><span class="keyword">ret</span>
<span class="normal">  </span><span class="number">98</span><span class="normal">                            </span><span class="symbol">.</span><span class="normal">cfi_endproc</span></tt></pre></div><p>Of <code>main()</code> only the bare bones are left: calling <code>puts()</code> (line 90) and returning 57 (line 93). Apparently <code>gcc</code> was able to identify that the string <code>&quot;This is a test program.\n&quot;</code> contains no formatting instructions, like <code>%d</code>, and can therefore be outputted using <code>puts()</code>. The string itself is put into the <code>.rodata</code> section as ASCII characters and labelled with <code>.LC0</code> (line 71-73).</p><p>The constant return value of <code>some_function()</code> was folded with <code>&quot;+= 5&quot;</code> and the initial 10, to just moving 57 to <code>eax</code> in line 93 and returning. Thus the binary code for <code>some_function()</code> does still exist, because it must be callable from an externally linked object, but within <code>main()</code> it is inlined.</p><p>The real challenge of inspecting larger projects is to find the assembler code corresponding to the parts you are interested in. The following methods have proven efficient:</p><ul> <li>Marking the parts with a unique C/C++ comment and then searching for it in the interleaved debug lines.</li> <li>Noting the line number of interest, and searching for &quot;<code>&lt;linenum&gt;:&lt;file&gt;</code>&quot; in the assembler listing.</li></ul><p>Some closing notes about my own observations:</p><ul> <li>Many simple loops use modern vector instructions, while more complex parts yield slower basic instructions.</li> <li>When using optimization, integral variables exist only as long as they are used, and the register allocator does exactly what you think it should.</li> <li>However, not all template inlining works as one would expect: most importantly, functor object are not inlined; e.g. for <code>std::map</code> the comparator call cannot be inlined. In general: only <code>static const</code> template attributes are inlined.</li></ul><p>Happy analysing the assembly output of <code>gcc</code>.</p></div><br/><a id="notes"></a><div class="commentframe"><div class="commentimage"> <a href="http://www.gravatar.com/6ca040fa95c3a4aa0602eed504772a8f" rel="nofollow"> <img src="/img/gravatar/6ca040fa95c3a4aa0602eed504772a8f-80.jpg" width="80" height="80" alt="Gravatar" /> </a></div><div class="commenttitle">Comment by <b><a href="http://www.gravatar.com/6ca040fa95c3a4aa0602eed504772a8f" rel="nofollow">Yohann</a></b> at 2013-02-14 17:20 UTC</div><div class="commentbody">Merci stef pour le taff que tu as fait j&apos;oublie pas<br /></div></div><div class="commentframe" style="display: none; border-color: red" id="newpost_div"> <div class="commentimage"> <a href="http://www.gravatar.com/" id="newpost_imgurl"> <img id="newpost_img" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAAAAAA6fptVAAAAAXNSR0IArs4c6QAAAApJREFUCB1j+A8AAQEBADZfZ4AAAAAASUVORK5CYII=" width="80" height="80" alt="Gravatar" /> </a> </div> <div class="commenttitle">Comment by <b><span id="newpost_name">Name</span></b> at <span id="newpost_date">Date</span><span id="newpost_uri">- URI</span><a href="/2013/0124-GCC-Output-Assembler-Code/" rel="nofollow"></a></div> <div class="commentbody" id="newpost_body"></div> <div class="commentbody" style="text-align: right"><big>Preview (Not Saved!)</big></div></div><a id="postnote"></a><form id="noteform" method="post" action="/sendpost.php"><div class="commentform" style="text-align: center"><table class="center thinframe" style="text-align: left"> <tr> <td colspan="2" style="text-align: center">Post Comment<input type="hidden" name="previewok" value="0" /><input type="hidden" name="posturi" value="/2013/0124-GCC-Output-Assembler-Code/" /></td> </tr> <tr> <td>Name:</td> <td><input type="text" name="postname" size="40" /></td> </tr> <tr> <td>E-Mail or Homepage:<br /><span style="font-size: 8pt">&nbsp;</span></td> <td><input type="text" name="postmail" size="40" /><br /> <span style="font-size: 8pt">URLs (http://...) are displayed, e-mails are hidden and used for Gravatar.</span></td> </tr> <tr> <td colspan="2" style="text-align: center"> <textarea name="postbody" cols="80" rows="8"></textarea><br /> <span style="font-size: 8pt">Many common HTML elements are allowed in the text, but no CSS style.</span> </td> </tr> <tr> <td colspan="2" style="text-align: center"> <input type="button" name="Preview" value="Preview" onclick="return noteform_submit()" /> <input type="submit" name="Submit" value="Submit" disabled="disabled" id="newpost_submit" /> </td> </tr></table></div></form></div><div style="text-align: right; padding: 8pt; font-size: 12px"><a href="/xmlfeed/weblog-rss20.xml"><img src="/img/xmlfeed-rss20.png" alt="RSS 2.0 Weblog Feed" height="15" width="80" /></a> <a href="/xmlfeed/weblog-atom10.xml"><img src="/img/xmlfeed-atom10.png" alt="Atom 1.0 Weblog Feed" height="15" width="80" /></a> <a href="http://validator.w3.org/check?uri=referer"><img src="/img/w3c-xhtml10.png" alt="Valid XHTML 1.1" height="15" width="80" /></a> <a href="http://jigsaw.w3.org/css-validator/check/referer"><img src="/img/w3c-css.png" alt="Valid CSS (2.1)" height="15" width="80" /></a><br/>Copyright 2005-2013 <a href="/about/">Timo Bingmann</a> - <a href="/about/impressum.html">Impressum</a></div><script type="text/javascript">var _paq = _paq || []; _paq.push(["trackPageView"]); _paq.push(["enableLinkTracking"]);(function() {var u=(("https:" == document.location.protocol) ? "https" : "http") + "://panthema.net/wik-331/"; _paq.push(["setTrackerUrl", u+"js/"]); _paq.push(["setSiteId", "2"]);var d=document, g=d.createElement("script"), s=d.getElementsByTagName("script")[0]; g.type="text/javascript";g.defer=true; g.async=true; g.src=u+"js/"; s.parentNode.insertBefore(g,s);})();</script><noscript><p><img src="http://panthema.net/wik-331/js/?idsite=2&amp;rec=1" style="border:0" alt="" /></p></noscript></body></html>